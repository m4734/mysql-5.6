cscope 15 /home/dcslab/cgmin/mysql-5.6/storage/rocksdb               0000980599
	@event_listener.cc

18 
	~"ev’t_li¡’”.h
"

21 
	~<¡ršg
>

22 
	~<veùÜ
>

25 
	~<my_glob®.h
>

26 
	~<mysql/¶ugš.h
>

29 
	~"ha_rocksdb.h
"

30 
	~"´İ”t›s_cŞËùÜ.h
"

31 
	~"rdb_d©adic.h
"

33 
Çme¥aû
 
	gmyrocks
 {

35 
	g¡d
::
veùÜ
<
Rdb_šdex_¡©s
>

36 
exŒaù_šdex_¡©s
(cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
fes
,

37 cÚ¡ 
rocksdb
::
TabËPrİ”t›sCŞËùiÚ
 &
´İs
) {

38 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> 
»t
;

39 autØ
	gâ
 : 
fes
) {

40 cÚ¡‡utØ
™
 = 
´İs
.
fšd
(
â
);

41 
DBUG_ASSERT
(
™
 !ğ
´İs
.
’d
());

42 
	g¡d
::
veùÜ
<
Rdb_šdex_¡©s
> 
¡©s
;

43 
	gRdb_tbl_´İ_cŞl
::
»ad_¡©s_äom_tbl_´İs
(
™
->
£cÚd
, &
¡©s
);

44 
	g»t
.
š£¹
(
»t
.
’d
(), 
¡©s
.
begš
(), stats.end());

46  
	g»t
;

49 
	gRdb_ev’t_li¡’”
::
upd©e_šdex_¡©s
(

50 cÚ¡ 
rocksdb
::
TabËPrİ”t›s
 &
´İs
) {

51 
DBUG_ASSERT
(
m_ddl_mªag”
 !ğ
nuÎ±r
);

52 cÚ¡‡utØ
	gtbl_´İs
 =

53 
¡d
::
make_sh¬ed
<cÚ¡ 
rocksdb
::
TabËPrİ”t›s
>(
´İs
);

55 
	g¡d
::
veùÜ
<
Rdb_šdex_¡©s
> 
¡©s
;

56 
	gRdb_tbl_´İ_cŞl
::
»ad_¡©s_äom_tbl_´İs
(
tbl_´İs
, &
¡©s
);

58 
	gm_ddl_mªag”
->
adju¡_¡©s
(
¡©s
);

61 
	gRdb_ev’t_li¡’”
::
OnCom·ùiÚCom¶‘ed
(

62 
rocksdb
::
DB
 *
db
, cÚ¡„ocksdb::
Com·ùiÚJobInfo
 &
ci
) {

63 
DBUG_ASSERT
(
db
 !ğ
nuÎ±r
);

64 
DBUG_ASSERT
(
m_ddl_mªag”
 !ğ
nuÎ±r
);

66 ià(
	gci
.
	g¡©us
.
ok
()) {

67 
	gm_ddl_mªag”
->
adju¡_¡©s
(

68 
exŒaù_šdex_¡©s
(
ci
.
ouut_fes
, ci.
bË_´İ”t›s
),

69 
exŒaù_šdex_¡©s
(
ci
.
šput_fes
, ci.
bË_´İ”t›s
));

73 
	gRdb_ev’t_li¡’”
::
OnFlushCom¶‘ed
(

74 
rocksdb
::
DB
 *
db
, cÚ¡„ocksdb::
FlushJobInfo
 &
æush_job_šfo
) {

75 
DBUG_ASSERT
(
db
 !ğ
nuÎ±r
);

76 
upd©e_šdex_¡©s
(
æush_job_šfo
.
bË_´İ”t›s
);

79 
	gRdb_ev’t_li¡’”
::
OnEx‹º®FeInge¡ed
(

80 
rocksdb
::
DB
 *
db
, cÚ¡„ocksdb::
Ex‹º®FeInge¡iÚInfo
 &
šfo
) {

81 
DBUG_ASSERT
(
db
 !ğ
nuÎ±r
);

82 
upd©e_šdex_¡©s
(
šfo
.
bË_´İ”t›s
);

85 
	gRdb_ev’t_li¡’”
::
OnBackgroundE¼Ü
(

86 
rocksdb
::
BackgroundE¼ÜR—sÚ
 
»asÚ
,„ocksdb::
Stus
 *
¡©us
) {

87 
rdb_log_¡©us_”rÜ
(*
¡©us
, "Error detected in background");

88 
sql_´št_”rÜ
("RocksDB: BackgroundE¼ÜR—sÚ: %d", ()
»asÚ
);

89 ià(
	g¡©us
->
IsCÜru±iÚ
()) {

90 
rdb_³rsi¡_cÜru±iÚ_m¬k”
();

91 
abÜt
();

	@event_listener.h

16 #´agm¨
Úû


18 
	~"rocksdb/li¡’”.h
"

20 
Çme¥aû
 
	gmyrocks
 {

22 
şass
 
	gRdb_ddl_mªag”
;

24 şas 
	cRdb_ev’t_li¡’”
 : 
public
 
rocksdb
::
Ev’tLi¡’”
 {

25 
public
:

26 
Rdb_ev’t_li¡’”
(cÚ¡ Rdb_ev’t_li¡’” &èğ
d–‘e
;

27 
	gRdb_ev’t_li¡’”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_ev’t_li¡’”
 &èğ
d–‘e
;

29 
ex¶ic™
 
Rdb_ev’t_li¡’”
(
Rdb_ddl_mªag”
 *cÚ¡ 
ddl_mªag”
)

30 : 
m_ddl_mªag”
(
ddl_mªag”
) {}

32 
OnCom·ùiÚCom¶‘ed
(
rocksdb
::
DB
 *
db
,

33 cÚ¡ 
rocksdb
::
Com·ùiÚJobInfo
 &
ci
è
ov”ride
;

34 
OnFlushCom¶‘ed
(
rocksdb
::
DB
 *
db
,

35 cÚ¡ 
rocksdb
::
FlushJobInfo
 &
æush_job_šfo
è
ov”ride
;

36 
OnEx‹º®FeInge¡ed
(

37 
rocksdb
::
DB
 *
db
,

38 cÚ¡ 
rocksdb
::
Ex‹º®FeInge¡iÚInfo
 &
šge¡iÚ_šfo
è
ov”ride
;

40 
OnBackgroundE¼Ü
(
rocksdb
::
BackgroundE¼ÜR—sÚ
 
»asÚ
,

41 
rocksdb
::
Stus
 *
¡©us
è
ov”ride
;

43 
	g´iv©e
:

44 
Rdb_ddl_mªag”
 *
m_ddl_mªag”
;

46 
upd©e_šdex_¡©s
(cÚ¡ 
rocksdb
::
TabËPrİ”t›s
 &
´İs
);

	@ha_rocksdb.cc

17 #ifdeà
USE_PRAGMA_IMPLEMENTATION


18 #´agm¨
im¶em’tiÚ


21 
	#MYSQL_SERVER
 1

	)

24 
	~"ha_rocksdb.h
"

27 
	~<®gÜ™hm
>

28 
	~<lim™s
>

29 
	~<m­
>

30 
	~<queue
>

31 
	~<£t
>

32 
	~<¡ršg
>

33 
	~<veùÜ
>

36 
	~"debug_sync.h
"

37 
	~"my_b™.h
"

38 
	~"my_¡ackŒaû.h
"

39 
	~"my_sys.h
"

40 
	~"sql_aud™.h
"

41 
	~"sql_bË.h
"

42 
	~<mysql/psi/mysql_bË.h
>

43 
	~<mysql/th»ad_poŞ_´iv.h
>

44 
	~<mysys_”r.h
>

48 #undeà
CACHE_LINE_SIZE


51 
	~"mÚ™Üšg/hi¡og¿m.h
"

52 
	~"rocksdb/com·ùiÚ_f‹r.h
"

53 
	~"rocksdb/’v.h
"

54 
	~"rocksdb/³rsi¡’t_ÿche.h
"

55 
	~"rocksdb/¿‹_lim™”.h
"

56 
	~"rocksdb/¦iû_ŒªsfÜm.h
"

57 
	~"rocksdb/th»ad_¡©us.h
"

58 
	~"rocksdb/ut™›s/checkpošt.h
"

59 
	~"rocksdb/ut™›s/cÚv’›nû.h
"

60 
	~"rocksdb/ut™›s/memÜy_ut.h
"

61 
	~"rocksdb/ut™›s/sim_ÿche.h
"

62 
	~"ut/¡İ_w©ch.h
"

65 
	~"ev’t_li¡’”.h
"

66 
	~"ha_rocksdb_´Ùo.h
"

67 
	~"logg”.h
"

68 
	~"rdb_cf_mªag”.h
"

69 
	~"rdb_cf_İtiÚs.h
"

70 
	~"rdb_d©adic.h
"

71 
	~"rdb_i_s.h
"

72 
	~"rdb_šdex_m”ge.h
"

73 
	~"rdb_mu‹x_w¿µ”.h
"

74 
	~"rdb_psi.h
"

75 
	~"rdb_th»ads.h
"

84 
thd_m¬k_Œª§ùiÚ_to_rŞlback
(
MYSQL_THD
 
thd
, 
boŞ
 
®l
);

91 
thd_bšlog_fÜm©
(cÚ¡ 
MYSQL_THD
 
thd
);

98 
boŞ
 
thd_bšlog_f‹r_ok
(cÚ¡ 
MYSQL_THD
 
thd
);

101 
Çme¥aû
 
myrocks
 {

103 
¡_glob®_¡©s
 
glob®_¡©s
;

104 
¡_expÜt_¡©s
 
expÜt_¡©s
;

105 
¡_memÜy_¡©s
 
memÜy_¡©s
;

106 
¡_io_¡®l_¡©s
 
io_¡®l_¡©s
;

108 cÚ¡ 
¡d
::
¡ršg
 
DEFAULT_CF_NAME
("default");

109 cÚ¡ 
¡d
::
¡ršg
 
DEFAULT_SYSTEM_CF_NAME
("__system__");

110 cÚ¡ 
¡d
::
¡ršg
 
PER_INDEX_CF_NAME
("$per_index_cf");

112 
şass
 
Rdb_ex¶ic™_¢­shÙ
;

114 
¡d
::
mu‹x
 
ex¶ic™_¢­shÙ_mu‹x
;

115 
ulÚglÚg
 
ex¶ic™_¢­shÙ_couÁ”
 = 0;

116 
¡d
::
unÜd”ed_m­
<
ulÚglÚg
, std::
w—k_±r
<
Rdb_ex¶ic™_¢­shÙ
>>

117 
ex¶ic™_¢­shÙs
;

118 
¡d
::
veùÜ
<
GL_INDEX_ID
> 
rdb_šdexes_to_»ÿlc
;

120 şas 
	cRdb_ex¶ic™_¢­shÙ
 : 
public
 
ex¶ic™_¢­shÙ
 {

121 
¡d
::
unique_±r
<
rocksdb
::
MªagedSÇpshÙ
> 
¢­shÙ
;

123 
public
:

124 
¡d
::
sh¬ed_±r
<
Rdb_ex¶ic™_¢­shÙ
>

125 
ü—‹
(
¢­shÙ_šfo_¡
 *
ss_šfo
, 
rocksdb
::
DB
 *
db
,

126 cÚ¡ 
rocksdb
::
SÇpshÙ
 *
¢­shÙ
) {

127 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
ex¶ic™_¢­shÙ_mu‹x
);

128 autØ
s
 = 
¡d
::
unique_±r
<
rocksdb
::
MªagedSÇpshÙ
>(

129 
Ãw
 
rocksdb
::
MªagedSÇpshÙ
(
db
, 
¢­shÙ
));

130 ià(!
s
) {

131  
nuÎ±r
;

133 
ss_šfo
->
¢­shÙ_id
 = ++
ex¶ic™_¢­shÙ_couÁ”
;

134 autØ
»t
 = 
¡d
::
make_sh¬ed
<
Rdb_ex¶ic™_¢­shÙ
>(*
ss_šfo
, std::
move
(
s
));

135 ià(!
»t
) {

136  
nuÎ±r
;

138 
ex¶ic™_¢­shÙs
[
ss_šfo
->
¢­shÙ_id
] = 
»t
;

139  
»t
;

142 
¡d
::
sh¬ed_±r
<
Rdb_ex¶ic™_¢­shÙ
>

143 
g‘
(cÚ¡ 
ulÚglÚg
 
¢­shÙ_id
) {

144 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
ex¶ic™_¢­shÙ_mu‹x
);

145 autØ
–em
 = 
ex¶ic™_¢­shÙs
.
fšd
(
¢­shÙ_id
);

146 ià(
–em
 =ğ
ex¶ic™_¢­shÙs
.
’d
()) {

147  
nuÎ±r
;

149  
–em
->
£cÚd
.
lock
();

152 
rocksdb
::
MªagedSÇpshÙ
 *
g‘_¢­shÙ
(è{  
¢­shÙ
.
g‘
(); }

154 
Rdb_ex¶ic™_¢­shÙ
(
¢­shÙ_šfo_¡
 
ss_šfo
,

155 
¡d
::
unique_±r
<
rocksdb
::
MªagedSÇpshÙ
> 
¢­shÙ
)

156 : 
ex¶ic™_¢­shÙ
(
ss_šfo
), 
¢­shÙ
(
¡d
::
move
(snapshot)) {}

158 
vœtu®
 ~
Rdb_ex¶ic™_¢­shÙ
() {

159 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
ex¶ic™_¢­shÙ_mu‹x
);

160 
ex¶ic™_¢­shÙs
.
”a£
(
ss_šfo
.
¢­shÙ_id
);

167 
ha_rocksdb
::
	$upd©e_row_¡©s
(cÚ¡ 
İ”©iÚ_ty³
 &
ty³
) {

168 
	`DBUG_ASSERT
(
ty³
 < 
ROWS_MAX
);

170 ià(
bË
->
s
 && 
m_tbl_def
->
m_is_mysql_sy¡em_bË
)

171 
glob®_¡©s
.
sy¡em_rows
[
ty³
].
	`šc
();

173 
glob®_¡©s
.
rows
[
ty³
].
	`šc
();

174 
	}
}

176 
dbug_dump_d©aba£
(
rocksdb
::
DB
 *
db
);

177 
hªdËr
 *
rocksdb_ü—‹_hªdËr
(
my_cÜe
::
hªdË¹Ú
 *
htÚ
,

178 
my_cÜe
::
TABLE_SHARE
 *
bË_¬g
,

179 
my_cÜe
::
MEM_ROOT
 *
mem_roÙ
);

181 
rocksdb
::
Com·ùRªgeO±iÚs
 
	$g‘Com·ùRªgeO±iÚs
() {

182 
rocksdb
::
Com·ùRªgeO±iÚs
 
com·ù_¿nge_İtiÚs
;

183 
com·ù_¿nge_İtiÚs
.
bÙtommo¡_Ëv–_com·ùiÚ
 =

184 
rocksdb
::
BÙtommo¡Lev–Com·ùiÚ
::
kFÜû
;

185 
com·ù_¿nge_İtiÚs
.
exşusive_mªu®_com·ùiÚ
 = 
çl£
;

186  
com·ù_¿nge_İtiÚs
;

187 
	}
}

192 *
rocksdb_deçuÉ_cf_İtiÚs
 = 
nuÎ±r
;

193 *
rocksdb_ov”ride_cf_İtiÚs
 = 
nuÎ±r
;

194 *
rocksdb_upd©e_cf_İtiÚs
 = 
nuÎ±r
;

199 
hªdË¹Ú
 *
rocksdb_htÚ
;

201 
rocksdb
::
T¿n§ùiÚDB
 *
rdb
 = 
nuÎ±r
;

202 
rocksdb
::
Hi¡og¿mIm¶
 *
comm™_Ï‹ncy_¡©s
 = 
nuÎ±r
;

204 
¡d
::
sh¬ed_±r
<
rocksdb
::
Sti¡ics
> 
rocksdb_¡©s
;

205 
¡d
::
unique_±r
<
rocksdb
::
Env
> 
æashÿche_aw¬e_’v
;

206 
¡d
::
sh¬ed_±r
<
Rdb_tbl_´İ_cŞl_çùÜy
> 
´İ”t›s_cŞËùÜ_çùÜy
;

208 
Rdb_diù_mªag”
 
diù_mªag”
;

209 
Rdb_cf_mªag”
 
cf_mªag”
;

210 
Rdb_ddl_mªag”
 
ddl_mªag”
;

211 
Rdb_bšlog_mªag”
 
bšlog_mªag”
;

212 
Rdb_io_w©chdog
 *
io_w©chdog
 = 
nuÎ±r
;

220 
Rdb_background_th»ad
 
rdb_bg_th»ad
;

224 
Regex_li¡_hªdËr
 *
rdb_cŞÏtiÚ_exû±iÚs
;

226 cÚ¡ *
rdb_g‘_”rÜ_mes§ge
(
Ä
);

228 
	$rocksdb_æush_®l_membËs
() {

229 cÚ¡ 
Rdb_cf_mªag”
 &
cf_mªag”
 = 
	`rdb_g‘_cf_mªag”
();

230 cÚ¡‡utØ&
cf_hªdË
 : 
cf_mªag”
.
	`g‘_®l_cf
()) {

231 
rdb
->
	`Flush
(
rocksdb
::
	`FlushO±iÚs
(), 
cf_hªdË
);

233 
	}
}

235 
	$rocksdb_com·ù_cŞumn_çmy_¡ub
(

236 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
, *cÚ¡ 
v¬_±r
,

237 cÚ¡ *cÚ¡ 
§ve
è{
	}
}

239 
	$rocksdb_com·ù_cŞumn_çmy
(
THD
 *cÚ¡ 
thd
,

240 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
,

241 *cÚ¡ 
v¬_±r
,

242 
¡_mysql_v®ue
 *cÚ¡ 
v®ue
) {

243 
buff
[
STRING_BUFFER_USUAL_SIZE
];

244 
Ën
 = (
buff
);

246 
	`DBUG_ASSERT
(
v®ue
 !ğ
nuÎ±r
);

248 ià(cÚ¡ *cÚ¡ 
cf
 = 
v®ue
->
	`v®_¡r
(v®ue, 
buff
, &
Ën
)) {

249 autØ
cfh
 = 
cf_mªag”
.
	`g‘_cf
(
cf
);

250 ià(
cfh
 !ğ
nuÎ±r
 && 
rdb
 !=‚ullptr) {

251 
	`sql_´št_šfÜm©iÚ
("RocksDB: Manual compaction of column family: %s\n",

252 
cf
);

253 
rdb
->
	`Com·ùRªge
(
	`g‘Com·ùRªgeO±iÚs
(), 
cfh
, 
nuÎ±r
,‚ullptr);

256  
HA_EXIT_SUCCESS
;

257 
	}
}

263 
Çme¥aû


266 cÚ¡ 
ulÚg
 
TABLE_HASH_SIZE
 = 32;

268 
	sRdb_İ’_bËs_m­
 {

270 
my_cÜe
::
HASH
 
m_hash
;

272 
mubË
 
mysql_mu‹x_t
 
m_mu‹x
;

274 
š™_hash
() {

275 ()
my_hash_š™
(&
m_hash
, 
my_cÜe
::
sy¡em_ch¬£t_šfo
, 
TABLE_HASH_SIZE
,

276 0, 0, (
my_hash_g‘_key
)
Rdb_İ’_bËs_m­
::
g‘_hash_key
,

280 
ä“_hash
(è{ 
my_hash_ä“
(&
m_hash
); }

282 
uch¬
 *
g‘_hash_key
(
Rdb_bË_hªdËr
 *cÚ¡ 
bË_hªdËr
,

283 
size_t
 *cÚ¡ 
Ëngth
,

284 
my_boŞ
 
nÙ_u£d
 
MY_ATTRIBUTE
((
__unu£d__
)));

286 
Rdb_bË_hªdËr
 *
g‘_bË_hªdËr
(cÚ¡ *cÚ¡ 
bË_Çme
);

287 
»Ëa£_bË_hªdËr
(
Rdb_bË_hªdËr
 *cÚ¡ 
bË_hªdËr
);

289 
¡d
::
veùÜ
<¡d::
¡ršg
> 
g‘_bË_Çmes
() const;

294 
Rdb_İ’_bËs_m­
 
rdb_İ’_bËs
;

296 
¡d
::
¡ršg
 
	$rdb_nÜm®ize_dœ
(
¡d
::
¡ršg
 
dœ
) {

297 
dœ
.
	`size
(è> 0 && dœ.
	`back
() == '/') {

298 
dœ
.
	`»size
(dœ.
	`size
() - 1);

300  
dœ
;

301 
	}
}

303 
rocksdb_ü—‹_checkpošt
(

304 
THD
 *cÚ¡ 
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

305 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

306 *cÚ¡ 
§ve
 
MY_ATTRIBUTE
((
__unu£d__
)),

307 
¡_mysql_v®ue
 *cÚ¡ 
v®ue
) {

308 
buf
[
FN_REFLEN
];

309 
Ën
 = (
buf
);

310 cÚ¡ *cÚ¡ 
checkpošt_dœ_¿w
 = 
v®ue
->
v®_¡r
(v®ue, 
buf
, &
Ën
);

311 ià(
checkpošt_dœ_¿w
) {

312 ià(
rdb
 !ğ
nuÎ±r
) {

313 
¡d
::
¡ršg
 
checkpošt_dœ
 = 
rdb_nÜm®ize_dœ
(
checkpošt_dœ_¿w
);

315 
sql_´št_šfÜm©iÚ
("RocksDB: creating checkpoint in directory : %s\n",

316 
checkpošt_dœ
.
c_¡r
());

317 
rocksdb
::
Checkpošt
 *
checkpošt
;

318 autØ
¡©us
 = 
rocksdb
::
Checkpošt
::
C»©e
(
rdb
, &
checkpošt
);

322 
rc
 
__©Œibu‹__
((
__unu£d__
));

323 ià(
¡©us
.
ok
()) {

324 
¡©us
 = 
checkpošt
->
C»©eCheckpošt
(
checkpošt_dœ
.
c_¡r
());

325 
d–‘e
 
checkpošt
;

326 ià(
¡©us
.
ok
()) {

327 
sql_´št_šfÜm©iÚ
(

329 
checkpošt_dœ
.
c_¡r
());

330  
HA_EXIT_SUCCESS
;

332 
rc
 = 
ha_rocksdb
::
rdb_”rÜ_to_mysql
(
¡©us
);

335 
rc
 = 
ha_rocksdb
::
rdb_”rÜ_to_mysql
(
¡©us
);

339  
HA_EXIT_FAILURE
;

344 
	$rocksdb_ü—‹_checkpošt_¡ub
(
THD
 *cÚ¡ 
thd
,

345 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
,

346 *cÚ¡ 
v¬_±r
,

347 cÚ¡ *cÚ¡ 
§ve
è{
	}
}

349 
	$rocksdb_fÜû_æush_membË_now_¡ub
(

350 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
, *cÚ¡ 
v¬_±r
,

351 cÚ¡ *cÚ¡ 
§ve
è{
	}
}

353 
	$rocksdb_fÜû_æush_membË_now
(

354 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
, *cÚ¡ 
v¬_±r
,

355 
¡_mysql_v®ue
 *cÚ¡ 
v®ue
) {

356 
	`sql_´št_šfÜm©iÚ
("RocksDB: Manual memtable flush.");

357 
	`rocksdb_æush_®l_membËs
();

358  
HA_EXIT_SUCCESS
;

359 
	}
}

361 
	$rocksdb_fÜû_æush_membË_ªd_lz”o_now_¡ub
(

362 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
, *cÚ¡ 
v¬_±r
,

363 cÚ¡ *cÚ¡ 
§ve
è{
	}
}

365 
	$rocksdb_fÜû_æush_membË_ªd_lz”o_now
(

366 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
, *cÚ¡ 
v¬_±r
,

367 
¡_mysql_v®ue
 *cÚ¡ 
v®ue
) {

368 
	`sql_´št_šfÜm©iÚ
("RocksDB: Manual memtable‡nd L0 flush.");

369 
	`rocksdb_æush_®l_membËs
();

371 cÚ¡ 
Rdb_cf_mªag”
 &
cf_mªag”
 = 
	`rdb_g‘_cf_mªag”
();

372 
rocksdb
::
Com·ùiÚO±iÚs
 
c_İtiÚs
 =„ocksdb::
	`Com·ùiÚO±iÚs
();

373 
rocksdb
::
CŞumnFamyM‘aD©a
 
m‘ad©a
;

374 
rocksdb
::
CŞumnFamyDesütÜ
 
cf_desü
;

376 cÚ¡‡utØ&
cf_hªdË
 : 
cf_mªag”
.
	`g‘_®l_cf
()) {

377 
rdb
->
	`G‘CŞumnFamyM‘aD©a
(
cf_hªdË
, &
m‘ad©a
);

378 
cf_hªdË
->
	`G‘DesütÜ
(&
cf_desü
);

379 
c_İtiÚs
.
ouut_fe_size_lim™
 = 
cf_desü
.
İtiÚs
.
rg‘_fe_size_ba£
;

381 
	`DBUG_ASSERT
(
m‘ad©a
.
Ëv–s
[0].
Ëv–
 == 0);

382 
¡d
::
veùÜ
<¡d::
¡ršg
> 
fe_Çmes
;

383 autØ&
fe
 : 
m‘ad©a
.
Ëv–s
[0].
fes
) {

384 
fe_Çmes
.
	`em¶aû_back
(
fe
.
db_·th
 + fe.
Çme
);

387 ià(!
fe_Çmes
.
	`em±y
()) {

388 
rocksdb
::
Stus
 
s
;

389 
s
 = 
rdb
->
	`Com·ùFes
(
c_İtiÚs
, 
cf_hªdË
, 
fe_Çmes
, 1);

391 ià(!
s
.
	`ok
(è&& !s.
	`IsAbÜ‹d
()) {

392 
	`rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_GENERAL
);

393  
HA_EXIT_FAILURE
;

398  
HA_EXIT_SUCCESS
;

399 
	}
}

401 
rocksdb_drİ_šdex_wakeup_th»ad
(

402 
my_cÜe
::
THD
 *cÚ¡ 
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

403 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

404 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
);

406 
my_boŞ
 
rocksdb_·u£_background_wÜk
 = 0;

407 
mysql_mu‹x_t
 
rdb_sysv¬s_mu‹x
;

409 
rocksdb_£t_·u£_background_wÜk
(

410 
my_cÜe
::
THD
 *cÚ¡ 
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

411 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

412 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
) {

413 
RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

414 cÚ¡ 
boŞ
 
·u£_»que¡ed
 = *
¡©ic_ÿ¡
<cÚ¡ boŞ *>(
§ve
);

415 ià(
rocksdb_·u£_background_wÜk
 !ğ
·u£_»que¡ed
) {

416 ià(
·u£_»que¡ed
) {

417 
rdb
->
Pau£BackgroundWÜk
();

419 
rdb
->
CÚtšueBackgroundWÜk
();

421 
rocksdb_·u£_background_wÜk
 = 
·u£_»que¡ed
;

423 
RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

426 
rocksdb_£t_com·ùiÚ_İtiÚs
(
THD
 *
thd
,

427 
¡_mysql_sys_v¬
 *
v¬
,

428 *
v¬_±r
, cÚ¡ *
§ve
);

430 
rocksdb_£t_bË_¡©s_§m¶šg_pù
(
THD
 *
thd
,

431 
¡_mysql_sys_v¬
 *
v¬
,

432 *
v¬_±r
,

433 cÚ¡ *
§ve
);

435 
rocksdb_£t_¿‹_lim™”_by‹s_³r_£c
(
THD
 *
thd
,

436 
¡_mysql_sys_v¬
 *
v¬
,

437 *
v¬_±r
,

438 cÚ¡ *
§ve
);

440 
rocksdb_£t_s¡_mgr_¿‹_by‹s_³r_£c
(
THD
 *
thd
,

441 
¡_mysql_sys_v¬
 *
v¬
,

442 *
v¬_±r
,

443 cÚ¡ *
§ve
);

445 
rocksdb_£t_d–ayed_wr™e_¿‹
(
THD
 *
thd
,

446 
¡_mysql_sys_v¬
 *
v¬
,

447 *
v¬_±r
, cÚ¡ *
§ve
);

449 
rocksdb_£t_max_Ï‹¡_d—dlocks
(
THD
 *
thd
,

450 
¡_mysql_sys_v¬
 *
v¬
,

451 *
v¬_±r
, cÚ¡ *
§ve
);

453 
rdb_£t_cŞÏtiÚ_exû±iÚ_li¡
(cÚ¡ *
exû±iÚ_li¡
);

454 
rocksdb_£t_cŞÏtiÚ_exû±iÚ_li¡
(
THD
 *
thd
,

455 
¡_mysql_sys_v¬
 *
v¬
,

456 *
v¬_±r
,

457 cÚ¡ *
§ve
);

459 
rocksdb_v®id©e_upd©e_cf_İtiÚs
(
THD
 *
thd
,

460 
¡_mysql_sys_v¬
 *
v¬
,

461 *
§ve
,

462 
¡_mysql_v®ue
 *
v®ue
);

464 
rocksdb_£t_upd©e_cf_İtiÚs
(
THD
 *
thd
,

465 
¡_mysql_sys_v¬
 *
v¬
,

466 *
v¬_±r
, cÚ¡ *
§ve
);

468 
rocksdb_check_bulk_lßd
(
THD
 *cÚ¡ 
thd
,

469 
¡_mysql_sys_v¬
 *
v¬


470 
MY_ATTRIBUTE
((
__unu£d__
)),

471 *
§ve
,

472 
¡_mysql_v®ue
 *
v®ue
);

474 
rocksdb_check_bulk_lßd_®low_unsÜ‹d
(

475 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

476 *
§ve
, 
¡_mysql_v®ue
 *
v®ue
);

478 
rocksdb_£t_max_background_jobs
(
THD
 *
thd
,

479 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
,

480 *cÚ¡ 
v¬_±r
,

481 cÚ¡ *cÚ¡ 
§ve
);

482 
rocksdb_£t_by‹s_³r_sync
(
THD
 *
thd
,

483 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
,

484 *cÚ¡ 
v¬_±r
,

485 cÚ¡ *cÚ¡ 
§ve
);

486 
rocksdb_£t_w®_by‹s_³r_sync
(
THD
 *
thd
,

487 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
,

488 *cÚ¡ 
v¬_±r
,

489 cÚ¡ *cÚ¡ 
§ve
);

493 
rocksdb_block_ÿche_size
;

494 
rocksdb_sim_ÿche_size
;

495 
my_boŞ
 
rocksdb_u£_şock_ÿche
;

498 
rocksdb_¿‹_lim™”_by‹s_³r_£c
;

500 
rocksdb_s¡_mgr_¿‹_by‹s_³r_£c
;

501 
rocksdb_d–ayed_wr™e_¿‹
;

502 
ušt32_t
 
rocksdb_max_Ï‹¡_d—dlocks
;

504 
rocksdb_³rsi¡’t_ÿche_size_mb
;

505 
ušt64_t
 
rocksdb_šfo_log_Ëv–
;

506 *
rocksdb_w®_dœ
;

507 *
rocksdb_³rsi¡’t_ÿche_·th
;

508 
ušt64_t
 
rocksdb_šdex_ty³
;

509 
ušt32_t
 
rocksdb_æush_log_©_Œx_comm™
;

510 
ušt32_t
 
rocksdb_debug_İtimiz”_n_rows
;

511 
my_boŞ
 
rocksdb_fÜû_compu‹_membË_¡©s
;

512 
ušt32_t
 
rocksdb_fÜû_compu‹_membË_¡©s_ÿch‘ime
;

513 
my_boŞ
 
rocksdb_debug_İtimiz”_no_z”o_ÿrdš®™y
;

514 
ušt32_t
 
rocksdb_w®_»cov”y_mode
;

515 
ušt32_t
 
rocksdb_acûss_hšt_Ú_com·ùiÚ_¡¬t
;

516 *
rocksdb_com·ù_cf_Çme
;

517 *
rocksdb_checkpošt_Çme
;

518 
my_boŞ
 
rocksdb_sigÇl_drİ_šdex_th»ad
;

519 
my_boŞ
 
rocksdb_¡riù_cŞÏtiÚ_check
 = 1;

520 
my_boŞ
 
rocksdb_ignÜe_unknown_İtiÚs
 = 1;

521 
my_boŞ
 
rocksdb_’abË_2pc
 = 0;

522 *
rocksdb_¡riù_cŞÏtiÚ_exû±iÚs
;

523 
my_boŞ
 
rocksdb_cŞËù_s¡_´İ”t›s
 = 1;

524 
my_boŞ
 
rocksdb_fÜû_æush_membË_now_v¬
 = 0;

525 
my_boŞ
 
rocksdb_fÜû_æush_membË_ªd_lz”o_now_v¬
 = 0;

526 
my_boŞ
 
rocksdb_’abË_‰l
 = 1;

527 
my_boŞ
 
rocksdb_’abË_‰l_»ad_f‹ršg
 = 1;

528 
rocksdb_debug_‰l_»c_ts
 = 0;

529 
rocksdb_debug_‰l_¢­shÙ_ts
 = 0;

530 
rocksdb_debug_‰l_»ad_f‹r_ts
 = 0;

531 
my_boŞ
 
rocksdb_debug_‰l_ignÜe_pk
 = 0;

532 
my_boŞ
 
rocksdb_»£t_¡©s
 = 0;

533 
ušt32_t
 
rocksdb_io_wr™e_timeout_£cs
 = 0;

534 
ušt32_t
 
rocksdb_£cÚds_b‘w“n_¡©_compu‹s
 = 3600;

535 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es
 = 0l;

536 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_wšdow
 = 0l;

537 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_fe_size
 = 0l;

538 
ušt32_t
 
rocksdb_v®id©e_bËs
 = 1;

539 *
rocksdb_d©adœ
;

540 
ušt32_t
 
rocksdb_bË_¡©s_§m¶šg_pù
;

541 
my_boŞ
 
rocksdb_’abË_bulk_lßd_­i
 = 1;

542 
my_boŞ
 
rocksdb_´št_¢­shÙ_cÚæiù_qu”›s
 = 0;

543 
my_boŞ
 
rocksdb_Ïrge_´efix
 = 0;

544 
my_boŞ
 
rocksdb_®low_to_¡¬t_aá”_cÜru±iÚ
 = 0;

545 
ušt64_t
 
rocksdb_wr™e_pŞicy
 =

546 
rocksdb
::
TxnDBWr™ePŞicy
::
WRITE_COMMITTED
;

547 
my_boŞ
 
rocksdb_”rÜ_Ú_subİtim®_cŞÏtiÚ
 = 1;

548 
ušt32_t
 
rocksdb_¡©s_»ÿlc_¿‹
 = 0;

550 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_row_lock_d—dlocks
(0);

551 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_row_lock_wa™_timeouts
(0);

552 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_¢­shÙ_cÚæiù_”rÜs
(0);

553 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_w®_group_syncs
(0);

555 
¡d
::
unique_±r
<
rocksdb
::
DBO±iÚs
> 
	$rdb_š™_rocksdb_db_İtiÚs
() {

556 autØ
o
 = 
¡d
::
unique_±r
<
rocksdb
::
DBO±iÚs
>(
Ãw
„ocksdb::
	`DBO±iÚs
());

558 
o
->
ü—‹_if_missšg
 = 
Œue
;

559 
o
->
li¡’”s
.
	`push_back
(
¡d
::
make_sh¬ed
<
Rdb_ev’t_li¡’”
>(&
ddl_mªag”
));

560 
o
->
šfo_log_Ëv–
 = 
rocksdb
::
InfoLogLev–
::
INFO_LEVEL
;

561 
o
->
max_subcom·ùiÚs
 = 
DEFAULT_SUBCOMPACTIONS
;

562 
o
->
max_İ’_fes
 = -2;

564 
o
->
two_wr™e_queues
 = 
Œue
;

565 
o
->
mªu®_w®_æush
 = 
Œue
;

566  
o
;

567 
	}
}

570 
¡d
::
unique_±r
<
rocksdb
::
BlockBa£dTabËO±iÚs
> 
rocksdb_tbl_İtiÚs
 =

571 
¡d
::
unique_±r
<
rocksdb
::
BlockBa£dTabËO±iÚs
>(

572 
Ãw
 
rocksdb
::
BlockBa£dTabËO±iÚs
());

573 
¡d
::
unique_±r
<
rocksdb
::
DBO±iÚs
> 
rocksdb_db_İtiÚs
 =

574 
rdb_š™_rocksdb_db_İtiÚs
();

576 
¡d
::
sh¬ed_±r
<
rocksdb
::
R©eLim™”
> 
rocksdb_¿‹_lim™”
;

579 cÚ¡ *
wr™e_pŞicy_Çmes
[] = {"write_committed", "write_prepared",

580 "wr™e_uÅ»·»d", 
NuÎS
};

582 
TYPELIB
 
wr™e_pŞicy_ty³lib
 = {
¬¿y_–em’ts
(
wr™e_pŞicy_Çmes
) - 1,

584 
wr™e_pŞicy_Çmes
, 
nuÎ±r
};

587 cÚ¡ *
šfo_log_Ëv–_Çmes
[] = {"debug_level", "info_level",

589 "çl_Ëv–", 
NuÎS
};

591 
TYPELIB
 
šfo_log_Ëv–_ty³lib
 = {

592 
¬¿y_–em’ts
(
šfo_log_Ëv–_Çmes
) - 1, "info_log_level_typelib",

593 
šfo_log_Ëv–_Çmes
, 
nuÎ±r
};

595 
	$rocksdb_£t_rocksdb_šfo_log_Ëv–
(

596 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
, *cÚ¡ 
v¬_±r
,

597 cÚ¡ *cÚ¡ 
§ve
) {

598 
	`DBUG_ASSERT
(
§ve
 !ğ
nuÎ±r
);

600 
	`RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

601 
rocksdb_šfo_log_Ëv–
 = *
¡©ic_ÿ¡
<cÚ¡ 
ušt64_t
 *>(
§ve
);

602 
rocksdb_db_İtiÚs
->
šfo_log
->
	`S‘InfoLogLev–
(

603 
¡©ic_ÿ¡
<cÚ¡ 
rocksdb
::
InfoLogLev–
>(
rocksdb_šfo_log_Ëv–
));

604 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

605 
	}
}

607 
rocksdb_£t_»£t_¡©s
(

608 
my_cÜe
::
THD
 *const ,

609 
my_cÜe
::
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

610 *cÚ¡ 
v¬_±r
, cÚ¡ *cÚ¡ 
§ve
) {

611 
DBUG_ASSERT
(
§ve
 !ğ
nuÎ±r
);

612 
DBUG_ASSERT
(
rdb
 !ğ
nuÎ±r
);

613 
DBUG_ASSERT
(
rocksdb_¡©s
 !ğ
nuÎ±r
);

615 
RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

617 *
¡©ic_ÿ¡
<
boŞ
 *>(
v¬_±r
èğ*¡©ic_ÿ¡<cÚ¡ boŞ *>(
§ve
);

619 ià(
rocksdb_»£t_¡©s
) {

620 
rocksdb
::
Stus
 
s
 = 
rdb
->
Re£tSts
();

624 
DBUG_ASSERT
(
s
 =ğ
rocksdb
::
Stus
::
OK
());

626 
s
 = 
rocksdb_¡©s
->
Re£t
();

627 
DBUG_ASSERT
(
s
 =ğ
rocksdb
::
Stus
::
OK
());

630 
RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

633 
rocksdb_£t_io_wr™e_timeout
(

634 
my_cÜe
::
THD
 *cÚ¡ 
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

635 
my_cÜe
::
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

636 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
) {

637 
DBUG_ASSERT
(
§ve
 !ğ
nuÎ±r
);

638 
DBUG_ASSERT
(
rdb
 !ğ
nuÎ±r
);

639 
DBUG_ASSERT
(
io_w©chdog
 !ğ
nuÎ±r
);

641 
RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

643 cÚ¡ 
ušt32_t
 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ ušt32_ˆ*>(
§ve
);

645 
rocksdb_io_wr™e_timeout_£cs
 = 
Ãw_v®
;

646 
io_w©chdog
->
»£t_timeout
(
rocksdb_io_wr™e_timeout_£cs
);

648 
RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

651 
rocksdb_æush_log_©_Œx_comm™_ty³
 : {

652 
FLUSH_LOG_NEVER
 = 0,

653 
FLUSH_LOG_SYNC
,

654 
FLUSH_LOG_BACKGROUND
,

655 
FLUSH_LOG_MAX


658 
	$rocksdb_v®id©e_æush_log_©_Œx_comm™
(

659 
THD
 *cÚ¡ 
thd
,

660 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
,

661 *
v¬_±r
,

662 
¡_mysql_v®ue
 *cÚ¡ 
v®ue
 ) {

663 
Ãw_v®ue
;

666 ià(
v®ue
->
	`v®_št
(v®ue, &
Ãw_v®ue
)) {

667  
HA_EXIT_FAILURE
;

670 ià(
rocksdb_db_İtiÚs
->
®low_mm­_wr™es
 && 
Ãw_v®ue
 !ğ
FLUSH_LOG_NEVER
) {

671  
HA_EXIT_FAILURE
;

674 *
¡©ic_ÿ¡
<
ušt32_t
 *>(
v¬_±r
èğ¡©ic_ÿ¡<ušt32_t>(
Ãw_v®ue
);

675  
HA_EXIT_SUCCESS
;

676 
	}
}

678 cÚ¡ *
šdex_ty³_Çmes
[] = {"kBš¬yS—rch", "kHashS—rch", 
NuÎS
};

680 
TYPELIB
 
šdex_ty³_ty³lib
 = {
¬¿y_–em’ts
(
šdex_ty³_Çmes
) - 1,

681 "šdex_ty³_ty³lib", 
šdex_ty³_Çmes
,

682 
nuÎ±r
};

684 cÚ¡ 
ulÚg
 
RDB_MAX_LOCK_WAIT_SECONDS
 = 1024 * 1024 * 1024;

685 cÚ¡ 
ulÚg
 
RDB_MAX_ROW_LOCKS
 = 1024 * 1024;

686 cÚ¡ 
ulÚg
 
RDB_DEFAULT_BULK_LOAD_SIZE
 = 1000;

687 cÚ¡ 
ulÚg
 
RDB_MAX_BULK_LOAD_SIZE
 = 1024 * 1024 * 1024;

688 cÚ¡ 
size_t
 
RDB_DEFAULT_MERGE_BUF_SIZE
 = 64 * 1024 * 1024;

689 cÚ¡ 
size_t
 
RDB_MIN_MERGE_BUF_SIZE
 = 100;

690 cÚ¡ 
size_t
 
RDB_DEFAULT_MERGE_COMBINE_READ_SIZE
 = 1024 * 1024 * 1024;

691 cÚ¡ 
size_t
 
RDB_MIN_MERGE_COMBINE_READ_SIZE
 = 100;

692 cÚ¡ 
size_t
 
RDB_DEFAULT_MERGE_TMP_FILE_REMOVAL_DELAY
 = 0;

693 cÚ¡ 
size_t
 
RDB_MIN_MERGE_TMP_FILE_REMOVAL_DELAY
 = 0;

694 cÚ¡ 
št64
 
RDB_DEFAULT_BLOCK_CACHE_SIZE
 = 512 * 1024 * 1024;

695 cÚ¡ 
št64
 
RDB_MIN_BLOCK_CACHE_SIZE
 = 1024;

696 cÚ¡ 
RDB_MAX_CHECKSUMS_PCT
 = 100;

697 cÚ¡ 
ulÚg
 
RDB_DEADLOCK_DETECT_DEPTH
 = 50;

700 
MYSQL_THDVAR_ULONG
(
lock_wa™_timeout
, 
PLUGIN_VAR_RQCMDARG
,

701 "Numb” oà£cÚd tØwa™ fÜ†ock", 
nuÎ±r
,

702 
nuÎ±r
, 1, 1,

703  
RDB_MAX_LOCK_WAIT_SECONDS
, 0);

705 
MYSQL_THDVAR_BOOL
(
d—dlock_d‘eù
, 
PLUGIN_VAR_RQCMDARG
,

706 "EÇbË d—dlock d‘eùiÚ", 
nuÎ±r
,‚uÎ±r, 
FALSE
);

708 
MYSQL_THDVAR_ULONG
(
d—dlock_d‘eù_d•th
, 
PLUGIN_VAR_RQCMDARG
,

711 
nuÎ±r
,‚ullptr,

712  
RDB_DEADLOCK_DETECT_DEPTH
,

714  
ULONG_MAX
, 0);

716 
MYSQL_THDVAR_BOOL
(

717 
comm™_time_b©ch_fÜ_»cov”y
, 
PLUGIN_VAR_RQCMDARG
,

718 "T¿n§ùiÚO±iÚs::comm™_time_b©ch_fÜ_»cov”y fÜ RocksDB", 
nuÎ±r
,

719 
nuÎ±r
, 
FALSE
);

721 
MYSQL_THDVAR_BOOL
(

722 
Œaû_s¡_­i
, 
PLUGIN_VAR_RQCMDARG
,

724 
nuÎ±r
,‚uÎ±r, 
FALSE
);

726 
MYSQL_THDVAR_BOOL
(

727 
bulk_lßd
, 
PLUGIN_VAR_RQCMDARG
,

730 
rocksdb_check_bulk_lßd
, 
nuÎ±r
, 
FALSE
);

732 
MYSQL_THDVAR_BOOL
(
bulk_lßd_®low_sk
, 
PLUGIN_VAR_RQCMDARG
,

736 
rocksdb_check_bulk_lßd_®low_unsÜ‹d
, 
nuÎ±r
,

737 
FALSE
);

739 
MYSQL_THDVAR_BOOL
(
bulk_lßd_®low_unsÜ‹d
, 
PLUGIN_VAR_RQCMDARG
,

742 
rocksdb_check_bulk_lßd_®low_unsÜ‹d
, 
nuÎ±r
,

743 
FALSE
);

745 
MYSQL_SYSVAR_BOOL
(
’abË_bulk_lßd_­i
, 
rocksdb_’abË_bulk_lßd_­i
,

746 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

748 
nuÎ±r
,‚uÎ±r, 
rocksdb_’abË_bulk_lßd_­i
);

750 
MYSQL_THDVAR_STR
(
tmpdœ
, 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_MEMALLOC
,

752 
nuÎ±r
,‚ullptr, "");

754 
MYSQL_THDVAR_STR
(

755 
sk_unique_check_bËs
, 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_MEMALLOC
,

756 "Sk uniqucÚ¡¿šˆcheckšg fÜh¥ecif›dabËs", 
nuÎ±r
,

757 
nuÎ±r
, ".*");

759 
MYSQL_THDVAR_BOOL
(

760 
comm™_š_the_middË
, 
PLUGIN_VAR_RQCMDARG
,

763 
nuÎ±r
,‚uÎ±r, 
FALSE
);

765 
MYSQL_THDVAR_BOOL
(

766 
blšd_d–‘e_´im¬y_key
, 
PLUGIN_VAR_RQCMDARG
,

769 
nuÎ±r
,‚uÎ±r, 
FALSE
);

771 
MYSQL_THDVAR_STR
(

772 
»ad_ä“_½l_bËs
, 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_MEMALLOC
,

775 
nuÎ±r
,‚ullptr, "");

777 
MYSQL_THDVAR_BOOL
(
sk_bloom_f‹r_Ú_»ad
, 
PLUGIN_VAR_RQCMDARG
,

778 "Sk usšg bloom f‹¸fÜ„—ds", 
nuÎ±r
,‚ullptr,

779 
FALSE
);

781 
MYSQL_THDVAR_ULONG
(
max_row_locks
, 
PLUGIN_VAR_RQCMDARG
,

783 
nuÎ±r
,‚ullptr,

784  
RDB_MAX_ROW_LOCKS
,

786  
RDB_MAX_ROW_LOCKS
, 0);

788 
MYSQL_THDVAR_ULONGLONG
(

789 
wr™e_b©ch_max_by‹s
, 
PLUGIN_VAR_RQCMDARG
,

790 "Maximum sizoàwr™b©ch iÀby‹s. 0 m—n nØlim™.", 
nuÎ±r
,‚ullptr,

791  0, 0, 
SIZE_T_MAX
, 1);

793 
MYSQL_THDVAR_BOOL
(

794 
lock_sÿÂed_rows
, 
PLUGIN_VAR_RQCMDARG
,

795 "Takªd hŞd†ock Ú„ow th©‡» sÿÂed buˆnÙ upd©ed", 
nuÎ±r
,

796 
nuÎ±r
, 
FALSE
);

798 
MYSQL_THDVAR_ULONG
(
bulk_lßd_size
, 
PLUGIN_VAR_RQCMDARG
,

799 "Max #»cÜd š‡ b©ch fÜ bulk-lßd mode", 
nuÎ±r
,

800 
nuÎ±r
,

801  
RDB_DEFAULT_BULK_LOAD_SIZE
,

803  
RDB_MAX_BULK_LOAD_SIZE
, 0);

805 
MYSQL_THDVAR_ULONGLONG
(

806 
m”ge_buf_size
, 
PLUGIN_VAR_RQCMDARG
,

809 
nuÎ±r
,‚ullptr,

810  
RDB_DEFAULT_MERGE_BUF_SIZE
,

811  
RDB_MIN_MERGE_BUF_SIZE
,

812  
SIZE_T_MAX
, 1);

814 
MYSQL_THDVAR_ULONGLONG
(

815 
m”ge_combše_»ad_size
, 
PLUGIN_VAR_RQCMDARG
,

819 
nuÎ±r
,‚ullptr,

820  
RDB_DEFAULT_MERGE_COMBINE_READ_SIZE
,

821  
RDB_MIN_MERGE_COMBINE_READ_SIZE
,

822  
SIZE_T_MAX
, 1);

824 
MYSQL_THDVAR_ULONGLONG
(

825 
m”ge_tmp_fe_»mov®_d–ay_ms
, 
PLUGIN_VAR_RQCMDARG
,

831 
nuÎ±r
,‚ullptr,

832  
RDB_DEFAULT_MERGE_TMP_FILE_REMOVAL_DELAY
,

833  
RDB_MIN_MERGE_TMP_FILE_REMOVAL_DELAY
,

834  
SIZE_T_MAX
, 1);

836 
MYSQL_SYSVAR_BOOL
(

837 
ü—‹_if_missšg
,

838 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
ü—‹_if_missšg
),

839 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

840 "DBO±iÚs::ü—‹_if_missšg fÜ RocksDB", 
nuÎ±r
,‚ullptr,

841 
rocksdb_db_İtiÚs
->
ü—‹_if_missšg
);

843 
MYSQL_SYSVAR_BOOL
(

844 
two_wr™e_queues
,

845 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
two_wr™e_queues
),

846 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

847 "DBO±iÚs::two_wr™e_queue fÜ RocksDB", 
nuÎ±r
,‚ullptr,

848 
rocksdb_db_İtiÚs
->
two_wr™e_queues
);

850 
MYSQL_SYSVAR_BOOL
(

851 
mªu®_w®_æush
,

852 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
mªu®_w®_æush
),

853 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

854 "DBO±iÚs::mªu®_w®_æush fÜ RocksDB", 
nuÎ±r
,‚ullptr,

855 
rocksdb_db_İtiÚs
->
mªu®_w®_æush
);

857 
MYSQL_SYSVAR_ENUM
(
wr™e_pŞicy
, 
rocksdb_wr™e_pŞicy
,

858 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

859 "DBO±iÚs::wr™e_pŞicy fÜ RocksDB", 
nuÎ±r
,

860 
nuÎ±r
, 
rocksdb
::
TxnDBWr™ePŞicy
::
WRITE_COMMITTED
,

861 &
wr™e_pŞicy_ty³lib
);

863 
MYSQL_SYSVAR_BOOL
(

864 
ü—‹_missšg_cŞumn_çm›s
,

865 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(

866 &
rocksdb_db_İtiÚs
->
ü—‹_missšg_cŞumn_çm›s
),

867 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

868 "DBO±iÚs::ü—‹_missšg_cŞumn_çm› fÜ RocksDB", 
nuÎ±r
,‚ullptr,

869 
rocksdb_db_İtiÚs
->
ü—‹_missšg_cŞumn_çm›s
);

871 
MYSQL_SYSVAR_BOOL
(

872 
”rÜ_if_exi¡s
,

873 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
”rÜ_if_exi¡s
),

874 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

875 "DBO±iÚs::”rÜ_if_exi¡ fÜ RocksDB", 
nuÎ±r
,‚ullptr,

876 
rocksdb_db_İtiÚs
->
”rÜ_if_exi¡s
);

878 
MYSQL_SYSVAR_BOOL
(

879 
·¿noid_checks
,

880 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
·¿noid_checks
),

881 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

882 "DBO±iÚs::·¿noid_check fÜ RocksDB", 
nuÎ±r
,‚ullptr,

883 
rocksdb_db_İtiÚs
->
·¿noid_checks
);

885 
MYSQL_SYSVAR_ULONGLONG
(

886 
¿‹_lim™”_by‹s_³r_£c
, 
rocksdb_¿‹_lim™”_by‹s_³r_£c
,

887 
PLUGIN_VAR_RQCMDARG
, "DBOptions::rate_limiter bytes_per_sec for RocksDB",

888 
nuÎ±r
, 
rocksdb_£t_¿‹_lim™”_by‹s_³r_£c
, 0L,

889  0L, 
MAX_RATE_LIMITER_BYTES_PER_SEC
, 0);

891 
MYSQL_SYSVAR_ULONGLONG
(

892 
s¡_mgr_¿‹_by‹s_³r_£c
, 
rocksdb_s¡_mgr_¿‹_by‹s_³r_£c
,

893 
PLUGIN_VAR_RQCMDARG
,

894 "DBO±iÚs::s¡_fe_mªag”„©e_by‹s_³r_£øfÜ RocksDB", 
nuÎ±r
,

895 
rocksdb_£t_s¡_mgr_¿‹_by‹s_³r_£c
,

896  
DEFAULT_SST_MGR_RATE_BYTES_PER_SEC
,

897  0L, 
UINT64_MAX
, 0);

899 
MYSQL_SYSVAR_ULONGLONG
(
d–ayed_wr™e_¿‹
, 
rocksdb_d–ayed_wr™e_¿‹
,

900 
PLUGIN_VAR_RQCMDARG
,

901 "DBO±iÚs::d–ayed_wr™e_¿‹", 
nuÎ±r
,

902 
rocksdb_£t_d–ayed_wr™e_¿‹
,

903 
rocksdb_db_İtiÚs
->
d–ayed_wr™e_¿‹
, 0,

904 
UINT64_MAX
, 0);

906 
MYSQL_SYSVAR_UINT
(
max_Ï‹¡_d—dlocks
, 
rocksdb_max_Ï‹¡_d—dlocks
,

907 
PLUGIN_VAR_RQCMDARG
,

910 
nuÎ±r
, 
rocksdb_£t_max_Ï‹¡_d—dlocks
,

911 
rocksdb
::
kIn™ŸlMaxD—dlocks
, 0, 
UINT32_MAX
, 0);

913 
MYSQL_SYSVAR_ENUM
(

914 
šfo_log_Ëv–
, 
rocksdb_šfo_log_Ëv–
, 
PLUGIN_VAR_RQCMDARG
,

918 
nuÎ±r
, 
rocksdb_£t_rocksdb_šfo_log_Ëv–
,

919 
rocksdb
::
InfoLogLev–
::
ERROR_LEVEL
, &
šfo_log_Ëv–_ty³lib
);

921 
MYSQL_THDVAR_INT
(

922 
³rf_cÚ‹xt_Ëv–
, 
PLUGIN_VAR_RQCMDARG
,

923 "P”àCÚ‹xˆLev– fÜ„ocksdb iÁ”ÇÈtim” sˆcŞËùiÚ", 
nuÎ±r
,

924 
nuÎ±r
,

925  
rocksdb
::
P”fLev–
::
kUnš™Ÿlized
,

926  
rocksdb
::
P”fLev–
::
kUnš™Ÿlized
,

927  
rocksdb
::
P”fLev–
::
kOutOfBounds
 - 1, 0);

929 
MYSQL_SYSVAR_UINT
(

930 
w®_»cov”y_mode
, 
rocksdb_w®_»cov”y_mode
, 
PLUGIN_VAR_RQCMDARG
,

932 
nuÎ±r
,‚ullptr,

933  (
ušt
)
rocksdb
::
WALRecov”yMode
::
kAbsŞu‹CÚsi¡’cy
,

934  (
ušt
)
rocksdb
::
WALRecov”yMode
::
kTŞ”©eCÜru±edTaRecÜds
,

935  (
ušt
)
rocksdb
::
WALRecov”yMode
::
kSkAnyCÜru±edRecÜds
, 0);

937 
MYSQL_SYSVAR_ULONG
(
com·ùiÚ_»adah—d_size
,

938 
rocksdb_db_İtiÚs
->
com·ùiÚ_»adah—d_size
,

939 
PLUGIN_VAR_RQCMDARG
,

941 
nuÎ±r
,‚ullptr,

942 
rocksdb_db_İtiÚs
->
com·ùiÚ_»adah—d_size
,

943  0L, 
ULONG_MAX
, 0);

945 
MYSQL_SYSVAR_BOOL
(

946 
Ãw_bË_»ad”_fÜ_com·ùiÚ_šputs
,

947 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(

948 &
rocksdb_db_İtiÚs
->
Ãw_bË_»ad”_fÜ_com·ùiÚ_šputs
),

949 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

950 "DBO±iÚs::Ãw_bË_»ad”_fÜ_com·ùiÚ_šput fÜ RocksDB", 
nuÎ±r
,

951 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
Ãw_bË_»ad”_fÜ_com·ùiÚ_šputs
);

953 
MYSQL_SYSVAR_UINT
(

954 
acûss_hšt_Ú_com·ùiÚ_¡¬t
, 
rocksdb_acûss_hšt_Ú_com·ùiÚ_¡¬t
,

955 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

956 "DBO±iÚs::acûss_hšt_Ú_com·ùiÚ_¡¬ˆfÜ RocksDB", 
nuÎ±r
,‚ullptr,

957  (
ušt
)
rocksdb
::
O±iÚs
::
AcûssHšt
::
NORMAL
,

958  (
ušt
)
rocksdb
::
O±iÚs
::
AcûssHšt
::
NONE
,

959  (
ušt
)
rocksdb
::
O±iÚs
::
AcûssHšt
::
WILLNEED
, 0);

961 
MYSQL_SYSVAR_BOOL
(

962 
®low_cÚcu¼’t_membË_wr™e
,

963 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(

964 &
rocksdb_db_İtiÚs
->
®low_cÚcu¼’t_membË_wr™e
),

965 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

966 "DBO±iÚs::®low_cÚcu¼’t_membË_wr™fÜ RocksDB", 
nuÎ±r
,‚ullptr,

967 
çl£
);

969 
MYSQL_SYSVAR_BOOL
(

970 
’abË_wr™e_th»ad_ad­tive_y›ld
,

971 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(

972 &
rocksdb_db_İtiÚs
->
’abË_wr™e_th»ad_ad­tive_y›ld
),

973 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

974 "DBO±iÚs::’abË_wr™e_th»ad_ad­tive_y›ld fÜ RocksDB", 
nuÎ±r
,

975 
nuÎ±r
, 
çl£
);

977 
MYSQL_SYSVAR_INT
(
max_İ’_fes
, 
rocksdb_db_İtiÚs
->max_open_files,

978 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

979 "DBO±iÚs::max_İ’_fe fÜ RocksDB", 
nuÎ±r
,

980 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
max_İ’_fes
,

981  -2, 
INT_MAX
, 0);

983 
MYSQL_SYSVAR_ULONG
(
max_tÙ®_w®_size
,

984 
rocksdb_db_İtiÚs
->
max_tÙ®_w®_size
,

985 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

986 "DBO±iÚs::max_tÙ®_w®_sizfÜ RocksDB", 
nuÎ±r
,

987 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
max_tÙ®_w®_size
,

988  0L, 
LONG_MAX
, 0);

990 
MYSQL_SYSVAR_BOOL
(

991 
u£_fsync
, *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->use_fsync),

992 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

993 "DBO±iÚs::u£_fsynøfÜ RocksDB", 
nuÎ±r
,‚ullptr,

994 
rocksdb_db_İtiÚs
->
u£_fsync
);

996 
MYSQL_SYSVAR_STR
(
w®_dœ
, 
rocksdb_w®_dœ
,

997 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

998 "DBO±iÚs::w®_dœ fÜ RocksDB", 
nuÎ±r
,‚ullptr,

999 
rocksdb_db_İtiÚs
->
w®_dœ
.
c_¡r
());

1001 
MYSQL_SYSVAR_STR
(

1002 
³rsi¡’t_ÿche_·th
, 
rocksdb_³rsi¡’t_ÿche_·th
,

1003 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1004 "P©h fÜ BlockBa£dTabËO±iÚs::³rsi¡’t_ÿchfÜ RocksDB", 
nuÎ±r
,

1005 
nuÎ±r
, "");

1007 
MYSQL_SYSVAR_ULONG
(

1008 
³rsi¡’t_ÿche_size_mb
, 
rocksdb_³rsi¡’t_ÿche_size_mb
,

1009 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1011 "fÜ RocksDB", 
nuÎ±r
,‚uÎ±r, 
rocksdb_³rsi¡’t_ÿche_size_mb
,

1012  0L, 
ULONG_MAX
, 0);

1014 
MYSQL_SYSVAR_ULONG
(

1015 
d–‘e_obsŞ‘e_fes_³riod_miüos
,

1016 
rocksdb_db_İtiÚs
->
d–‘e_obsŞ‘e_fes_³riod_miüos
,

1017 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1018 "DBO±iÚs::d–‘e_obsŞ‘e_fes_³riod_miüo fÜ RocksDB", 
nuÎ±r
,

1019 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
d–‘e_obsŞ‘e_fes_³riod_miüos
,

1020  0L, 
LONG_MAX
, 0);

1022 
MYSQL_SYSVAR_INT
(
max_background_jobs
,

1023 
rocksdb_db_İtiÚs
->
max_background_jobs
,

1024 
PLUGIN_VAR_RQCMDARG
,

1025 "DBO±iÚs::max_background_job fÜ RocksDB", 
nuÎ±r
,

1026 
rocksdb_£t_max_background_jobs
,

1027 
rocksdb_db_İtiÚs
->
max_background_jobs
,

1028  -1, 
MAX_BACKGROUND_JOBS
, 0);

1030 
MYSQL_SYSVAR_UINT
(
max_subcom·ùiÚs
,

1031 
rocksdb_db_İtiÚs
->
max_subcom·ùiÚs
,

1032 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1033 "DBO±iÚs::max_subcom·ùiÚ fÜ RocksDB", 
nuÎ±r
,

1034 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
max_subcom·ùiÚs
,

1035  1, 
MAX_SUBCOMPACTIONS
, 0);

1037 
MYSQL_SYSVAR_ULONG
(
max_log_fe_size
,

1038 
rocksdb_db_İtiÚs
->
max_log_fe_size
,

1039 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1040 "DBO±iÚs::max_log_fe_sizfÜ RocksDB", 
nuÎ±r
,

1041 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
max_log_fe_size
,

1042  0L, 
LONG_MAX
, 0);

1044 
MYSQL_SYSVAR_ULONG
(
log_fe_time_to_rŞl
,

1045 
rocksdb_db_İtiÚs
->
log_fe_time_to_rŞl
,

1046 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1048 
nuÎ±r
,‚ullptr,

1049 
rocksdb_db_İtiÚs
->
log_fe_time_to_rŞl
,

1050  0L, 
LONG_MAX
, 0);

1052 
MYSQL_SYSVAR_ULONG
(
k“p_log_fe_num
,

1053 
rocksdb_db_İtiÚs
->
k“p_log_fe_num
,

1054 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1055 "DBO±iÚs::k“p_log_fe_num fÜ RocksDB", 
nuÎ±r
,

1056 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
k“p_log_fe_num
,

1057  0L, 
LONG_MAX
, 0);

1059 
MYSQL_SYSVAR_ULONG
(
max_mªiã¡_fe_size
,

1060 
rocksdb_db_İtiÚs
->
max_mªiã¡_fe_size
,

1061 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1063 
nuÎ±r
,‚ullptr,

1064 
rocksdb_db_İtiÚs
->
max_mªiã¡_fe_size
,

1065  0L, 
ULONG_MAX
, 0);

1067 
MYSQL_SYSVAR_INT
(
bË_ÿche_numsh¬db™s
,

1068 
rocksdb_db_İtiÚs
->
bË_ÿche_numsh¬db™s
,

1069 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1071 
nuÎ±r
,‚ullptr,

1072 
rocksdb_db_İtiÚs
->
bË_ÿche_numsh¬db™s
,

1077 
MYSQL_SYSVAR_ULONG
(
w®_‰l_£cÚds
, 
rocksdb_db_İtiÚs
->
WAL_‰l_£cÚds
,

1078 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1079 "DBO±iÚs::WAL_‰l_£cÚd fÜ RocksDB", 
nuÎ±r
,

1080 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
WAL_‰l_£cÚds
,

1081  0L, 
LONG_MAX
, 0);

1083 
MYSQL_SYSVAR_ULONG
(
w®_size_lim™_mb
,

1084 
rocksdb_db_İtiÚs
->
WAL_size_lim™_MB
,

1085 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1086 "DBO±iÚs::WAL_size_lim™_MB fÜ RocksDB", 
nuÎ±r
,

1087 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
WAL_size_lim™_MB
,

1088  0L, 
LONG_MAX
, 0);

1090 
MYSQL_SYSVAR_ULONG
(
mªiã¡_´—ÎoÿtiÚ_size
,

1091 
rocksdb_db_İtiÚs
->
mªiã¡_´—ÎoÿtiÚ_size
,

1092 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1094 
nuÎ±r
,‚ullptr,

1095 
rocksdb_db_İtiÚs
->
mªiã¡_´—ÎoÿtiÚ_size
,

1096  0L, 
LONG_MAX
, 0);

1098 
MYSQL_SYSVAR_BOOL
(

1099 
u£_dœeù_»ads
,

1100 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
u£_dœeù_»ads
),

1101 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1102 "DBO±iÚs::u£_dœeù_»ad fÜ RocksDB", 
nuÎ±r
,‚ullptr,

1103 
rocksdb_db_İtiÚs
->
u£_dœeù_»ads
);

1105 
MYSQL_SYSVAR_BOOL
(

1106 
u£_dœeù_io_fÜ_æush_ªd_com·ùiÚ
,

1107 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(

1108 &
rocksdb_db_İtiÚs
->
u£_dœeù_io_fÜ_æush_ªd_com·ùiÚ
),

1109 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1110 "DBO±iÚs::u£_dœeù_io_fÜ_æush_ªd_com·ùiÚ fÜ RocksDB", 
nuÎ±r
,

1111 
nuÎ±r
, 
rocksdb_db_İtiÚs
->
u£_dœeù_io_fÜ_æush_ªd_com·ùiÚ
);

1113 
MYSQL_SYSVAR_BOOL
(

1114 
®low_mm­_»ads
,

1115 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
®low_mm­_»ads
),

1116 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1117 "DBO±iÚs::®low_mm­_»ad fÜ RocksDB", 
nuÎ±r
,‚ullptr,

1118 
rocksdb_db_İtiÚs
->
®low_mm­_»ads
);

1120 
MYSQL_SYSVAR_BOOL
(

1121 
®low_mm­_wr™es
,

1122 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
®low_mm­_wr™es
),

1123 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1124 "DBO±iÚs::®low_mm­_wr™e fÜ RocksDB", 
nuÎ±r
,‚ullptr,

1125 
rocksdb_db_İtiÚs
->
®low_mm­_wr™es
);

1127 
MYSQL_SYSVAR_BOOL
(

1128 
is_fd_şo£_Ú_exec
,

1129 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
is_fd_şo£_Ú_exec
),

1130 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1131 "DBO±iÚs::is_fd_şo£_Ú_exeøfÜ RocksDB", 
nuÎ±r
,‚ullptr,

1132 
rocksdb_db_İtiÚs
->
is_fd_şo£_Ú_exec
);

1134 
MYSQL_SYSVAR_UINT
(
¡©s_dump_³riod_£c
,

1135 
rocksdb_db_İtiÚs
->
¡©s_dump_³riod_£c
,

1136 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1138 
nuÎ±r
,‚ullptr,

1139 
rocksdb_db_İtiÚs
->
¡©s_dump_³riod_£c
,

1140  0, 
INT_MAX
, 0);

1142 
MYSQL_SYSVAR_BOOL
(

1143 
advi£_¿ndom_Ú_İ’
,

1144 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
advi£_¿ndom_Ú_İ’
),

1145 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1146 "DBO±iÚs::advi£_¿ndom_Ú_İ’ fÜ RocksDB", 
nuÎ±r
,‚ullptr,

1147 
rocksdb_db_İtiÚs
->
advi£_¿ndom_Ú_İ’
);

1149 
MYSQL_SYSVAR_ULONG
(
db_wr™e_bufãr_size
,

1150 
rocksdb_db_İtiÚs
->
db_wr™e_bufãr_size
,

1151 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1153 
nuÎ±r
,‚ullptr,

1154 
rocksdb_db_İtiÚs
->
db_wr™e_bufãr_size
,

1155  0L, 
LONG_MAX
, 0);

1157 
MYSQL_SYSVAR_BOOL
(

1158 
u£_ad­tive_mu‹x
,

1159 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
u£_ad­tive_mu‹x
),

1160 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1161 "DBO±iÚs::u£_ad­tive_mu‹x fÜ RocksDB", 
nuÎ±r
,‚ullptr,

1162 
rocksdb_db_İtiÚs
->
u£_ad­tive_mu‹x
);

1164 
MYSQL_SYSVAR_ULONG
(
by‹s_³r_sync
, 
rocksdb_db_İtiÚs
->bytes_per_sync,

1165 
PLUGIN_VAR_RQCMDARG
,

1166 "DBO±iÚs::by‹s_³r_synøfÜ RocksDB", 
nuÎ±r
,

1167 
rocksdb_£t_by‹s_³r_sync
,

1168 
rocksdb_db_İtiÚs
->
by‹s_³r_sync
,

1169  0L, 
LONG_MAX
, 0);

1171 
MYSQL_SYSVAR_ULONG
(
w®_by‹s_³r_sync
,

1172 
rocksdb_db_İtiÚs
->
w®_by‹s_³r_sync
,

1173 
PLUGIN_VAR_RQCMDARG
,

1174 "DBO±iÚs::w®_by‹s_³r_synøfÜ RocksDB", 
nuÎ±r
,

1175 
rocksdb_£t_w®_by‹s_³r_sync
,

1176 
rocksdb_db_İtiÚs
->
w®_by‹s_³r_sync
,

1177  0L, 
LONG_MAX
, 0);

1179 
MYSQL_SYSVAR_BOOL
(

1180 
’abË_th»ad_Œackšg
,

1181 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_db_İtiÚs
->
’abË_th»ad_Œackšg
),

1182 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1183 "DBO±iÚs::’abË_th»ad_Œackšg fÜ RocksDB", 
nuÎ±r
,‚uÎ±r, 
Œue
);

1185 
MYSQL_SYSVAR_LONGLONG
(
block_ÿche_size
, 
rocksdb_block_ÿche_size
,

1186 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1187 "block_ÿchsizfÜ RocksDB", 
nuÎ±r
,‚ullptr,

1188  
RDB_DEFAULT_BLOCK_CACHE_SIZE
,

1189  
RDB_MIN_BLOCK_CACHE_SIZE
,

1190  
LONGLONG_MAX
,

1191  
RDB_MIN_BLOCK_CACHE_SIZE
);

1193 
MYSQL_SYSVAR_LONGLONG
(
sim_ÿche_size
, 
rocksdb_sim_ÿche_size
,

1194 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1195 "SimuÏ‹d cachsizfÜ RocksDB", 
nuÎ±r
,

1196 
nuÎ±r
,

1199  
LONGLONG_MAX
,

1202 
MYSQL_SYSVAR_BOOL
(

1203 
u£_şock_ÿche
,

1204 
rocksdb_u£_şock_ÿche
,

1205 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1207 
nuÎ±r
,‚uÎ±r, 
çl£
);

1209 
MYSQL_SYSVAR_BOOL
(

1210 
ÿche_šdex_ªd_f‹r_blocks
,

1211 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(

1212 &
rocksdb_tbl_İtiÚs
->
ÿche_šdex_ªd_f‹r_blocks
),

1213 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1215 
nuÎ±r
,‚uÎ±r, 
Œue
);

1225 
MYSQL_SYSVAR_BOOL
(

1226 
pš_l0_f‹r_ªd_šdex_blocks_š_ÿche
,

1227 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(

1228 &
rocksdb_tbl_İtiÚs
->
pš_l0_f‹r_ªd_šdex_blocks_š_ÿche
),

1229 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1230 "pš_l0_f‹r_ªd_šdex_blocks_š_ÿchfÜ RocksDB", 
nuÎ±r
,‚ullptr,

1231 
Œue
);

1233 
MYSQL_SYSVAR_ENUM
(
šdex_ty³
, 
rocksdb_šdex_ty³
,

1234 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1236 
nuÎ±r
,‚ullptr,

1237 (
ušt64_t
)
rocksdb_tbl_İtiÚs
->
šdex_ty³
,

1238 &
šdex_ty³_ty³lib
);

1240 
MYSQL_SYSVAR_BOOL
(

1241 
hash_šdex_®low_cŞlisiÚ
,

1242 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(

1243 &
rocksdb_tbl_İtiÚs
->
hash_šdex_®low_cŞlisiÚ
),

1244 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1245 "BlockBa£dTabËO±iÚs::hash_šdex_®low_cŞlisiÚ fÜ RocksDB", 
nuÎ±r
,

1246 
nuÎ±r
, 
rocksdb_tbl_İtiÚs
->
hash_šdex_®low_cŞlisiÚ
);

1248 
MYSQL_SYSVAR_BOOL
(

1249 
no_block_ÿche
,

1250 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_tbl_İtiÚs
->
no_block_ÿche
),

1251 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1252 "BlockBa£dTabËO±iÚs::no_block_ÿchfÜ RocksDB", 
nuÎ±r
,‚ullptr,

1253 
rocksdb_tbl_İtiÚs
->
no_block_ÿche
);

1255 
MYSQL_SYSVAR_ULONG
(
block_size
, 
rocksdb_tbl_İtiÚs
->block_size,

1256 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1258 
nuÎ±r
,‚uÎ±r, 
rocksdb_tbl_İtiÚs
->
block_size
,

1259  1L, 
LONG_MAX
, 0);

1261 
MYSQL_SYSVAR_INT
(

1262 
block_size_devŸtiÚ
, 
rocksdb_tbl_İtiÚs
->block_size_deviation,

1263 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1264 "BlockBa£dTabËO±iÚs::block_size_devŸtiÚ fÜ RocksDB", 
nuÎ±r
,

1265 
nuÎ±r
, 
rocksdb_tbl_İtiÚs
->
block_size_devŸtiÚ
,

1266  0, 
INT_MAX
, 0);

1268 
MYSQL_SYSVAR_INT
(

1269 
block_»¡¬t_š‹rv®
, 
rocksdb_tbl_İtiÚs
->block_restart_interval,

1270 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1271 "BlockBa£dTabËO±iÚs::block_»¡¬t_š‹rv® fÜ RocksDB", 
nuÎ±r
,

1272 
nuÎ±r
, 
rocksdb_tbl_İtiÚs
->
block_»¡¬t_š‹rv®
,

1273  1, 
INT_MAX
, 0);

1275 
MYSQL_SYSVAR_BOOL
(

1276 
whŞe_key_f‹ršg
,

1277 *
»š‹½»t_ÿ¡
<
my_boŞ
 *>(&
rocksdb_tbl_İtiÚs
->
whŞe_key_f‹ršg
),

1278 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1279 "BlockBa£dTabËO±iÚs::whŞe_key_f‹ršg fÜ RocksDB", 
nuÎ±r
,‚ullptr,

1280 
rocksdb_tbl_İtiÚs
->
whŞe_key_f‹ršg
);

1282 
MYSQL_SYSVAR_STR
(
deçuÉ_cf_İtiÚs
, 
rocksdb_deçuÉ_cf_İtiÚs
,

1283 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1284 "deçuÉ càİtiÚ fÜ RocksDB", 
nuÎ±r
,‚ullptr, "");

1286 
MYSQL_SYSVAR_STR
(
ov”ride_cf_İtiÚs
, 
rocksdb_ov”ride_cf_İtiÚs
,

1287 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1288 "İtiÚ ov”ride ³¸càfÜ RocksDB", 
nuÎ±r
,‚ullptr,

1291 
MYSQL_SYSVAR_STR
(
upd©e_cf_İtiÚs
, 
rocksdb_upd©e_cf_İtiÚs
,

1292 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_MEMALLOC
 |

1293 
PLUGIN_VAR_ALLOCATED
,

1295 
rocksdb_v®id©e_upd©e_cf_İtiÚs
,

1296 
rocksdb_£t_upd©e_cf_İtiÚs
, 
nuÎ±r
);

1298 
MYSQL_SYSVAR_UINT
(
æush_log_©_Œx_comm™
,

1299 
rocksdb_æush_log_©_Œx_comm™
, 
PLUGIN_VAR_RQCMDARG
,

1303 
rocksdb_v®id©e_æush_log_©_Œx_comm™
, 
nuÎ±r
,

1304  
FLUSH_LOG_SYNC
,

1305  
FLUSH_LOG_NEVER
,

1306  
FLUSH_LOG_BACKGROUND
, 0);

1308 
MYSQL_THDVAR_BOOL
(
wr™e_di§bË_w®
, 
PLUGIN_VAR_RQCMDARG
,

1309 "Wr™eO±iÚs::di§bËWAL fÜ RocksDB", 
nuÎ±r
,

1310 
nuÎ±r
, 
rocksdb
::
Wr™eO±iÚs
().
di§bËWAL
);

1312 
MYSQL_THDVAR_BOOL
(

1313 
wr™e_ignÜe_missšg_cŞumn_çm›s
, 
PLUGIN_VAR_RQCMDARG
,

1314 "Wr™eO±iÚs::ignÜe_missšg_cŞumn_çm› fÜ RocksDB", 
nuÎ±r
,

1315 
nuÎ±r
, 
rocksdb
::
Wr™eO±iÚs
().
ignÜe_missšg_cŞumn_çm›s
);

1317 
MYSQL_THDVAR_BOOL
(
sk_fl_ÿche
, 
PLUGIN_VAR_RQCMDARG
,

1318 "Sk flšg block cachÚ„—d„eque¡s", 
nuÎ±r
,

1319 
nuÎ±r
, 
FALSE
);

1321 
MYSQL_THDVAR_BOOL
(

1322 
un§ã_fÜ_bšlog
, 
PLUGIN_VAR_RQCMDARG
,

1324 
nuÎ±r
,‚uÎ±r, 
FALSE
);

1326 
MYSQL_THDVAR_UINT
(
»cÜds_š_¿nge
, 
PLUGIN_VAR_RQCMDARG
,

1329 
nuÎ±r
,‚ullptr, 0,

1330  0, 
INT_MAX
, 0);

1332 
MYSQL_THDVAR_UINT
(
fÜû_šdex_»cÜds_š_¿nge
, 
PLUGIN_VAR_RQCMDARG
,

1335 
nuÎ±r
,‚ullptr, 0,

1336  0, 
INT_MAX
, 0);

1338 
MYSQL_SYSVAR_UINT
(

1339 
debug_İtimiz”_n_rows
, 
rocksdb_debug_İtimiz”_n_rows
,

1340 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
 | 
PLUGIN_VAR_NOSYSVAR
,

1342 
nuÎ±r
,‚uÎ±r, 0, 0, 
INT_MAX
, 0);

1344 
MYSQL_SYSVAR_BOOL
(
fÜû_compu‹_membË_¡©s
,

1345 
rocksdb_fÜû_compu‹_membË_¡©s
,

1346 
PLUGIN_VAR_RQCMDARG
,

1348 
nuÎ±r
,‚uÎ±r, 
TRUE
);

1350 
MYSQL_SYSVAR_UINT
(
fÜû_compu‹_membË_¡©s_ÿch‘ime
,

1351 
rocksdb_fÜû_compu‹_membË_¡©s_ÿch‘ime
,

1352 
PLUGIN_VAR_RQCMDARG
,

1353 "Timš u£c tØÿchmembËƒ¡im©es", 
nuÎ±r
,

1354 
nuÎ±r
, 60 * 1000 * 1000,

1355  0, 
INT_MAX
, 0);

1357 
MYSQL_SYSVAR_BOOL
(

1358 
debug_İtimiz”_no_z”o_ÿrdš®™y
,

1359 
rocksdb_debug_İtimiz”_no_z”o_ÿrdš®™y
, 
PLUGIN_VAR_RQCMDARG
,

1360 "IÀÿ£ iàÿrdš®™y i z”o, ov”ride ™ w™h somv®ue", 
nuÎ±r
,

1361 
nuÎ±r
, 
TRUE
);

1363 
MYSQL_SYSVAR_STR
(
com·ù_cf
, 
rocksdb_com·ù_cf_Çme
,

1364 
PLUGIN_VAR_RQCMDARG
, "Compact column family",

1365 
rocksdb_com·ù_cŞumn_çmy
,

1366 
rocksdb_com·ù_cŞumn_çmy_¡ub
, "");

1368 
MYSQL_SYSVAR_STR
(
ü—‹_checkpošt
, 
rocksdb_checkpošt_Çme
,

1369 
PLUGIN_VAR_RQCMDARG
, "Checkpoint directory",

1370 
rocksdb_ü—‹_checkpošt
,

1371 
rocksdb_ü—‹_checkpošt_¡ub
, "");

1373 
MYSQL_SYSVAR_BOOL
(
sigÇl_drİ_šdex_th»ad
,

1374 
rocksdb_sigÇl_drİ_šdex_th»ad
, 
PLUGIN_VAR_RQCMDARG
,

1375 "Waku°drİ indexh»ad", 
nuÎ±r
,

1376 
rocksdb_drİ_šdex_wakeup_th»ad
, 
FALSE
);

1378 
MYSQL_SYSVAR_BOOL
(
·u£_background_wÜk
, 
rocksdb_·u£_background_wÜk
,

1379 
PLUGIN_VAR_RQCMDARG
,

1380 "Di§bË‡Î„ocksdb background o³¿tiÚs", 
nuÎ±r
,

1381 
rocksdb_£t_·u£_background_wÜk
, 
FALSE
);

1383 
MYSQL_SYSVAR_BOOL
(

1384 
’abË_‰l
, 
rocksdb_’abË_‰l
, 
PLUGIN_VAR_RQCMDARG
,

1385 "EÇbËƒxpœed TTL„ecÜd tØbdrİ³d duršg com·ùiÚ.", 
nuÎ±r
,

1386 
nuÎ±r
, 
TRUE
);

1388 
MYSQL_SYSVAR_BOOL
(

1389 
’abË_‰l_»ad_f‹ršg
, 
rocksdb_’abË_‰l_»ad_f‹ršg
,

1390 
PLUGIN_VAR_RQCMDARG
,

1395 
nuÎ±r
,‚uÎ±r, 
TRUE
);

1397 
MYSQL_SYSVAR_INT
(

1398 
debug_‰l_»c_ts
, 
rocksdb_debug_‰l_»c_ts
, 
PLUGIN_VAR_RQCMDARG
,

1404 
nuÎ±r
,‚ullptr, 0, -3600, 3600, 0);

1406 
MYSQL_SYSVAR_INT
(

1407 
debug_‰l_¢­shÙ_ts
, 
rocksdb_debug_‰l_¢­shÙ_ts
, 
PLUGIN_VAR_RQCMDARG
,

1413 
nuÎ±r
,‚ullptr, 0, -3600, 3600, 0);

1415 
MYSQL_SYSVAR_INT
(

1416 
debug_‰l_»ad_f‹r_ts
, 
rocksdb_debug_‰l_»ad_f‹r_ts
,

1417 
PLUGIN_VAR_RQCMDARG
,

1421 
nuÎ±r
,‚ullptr, 0, -3600, 3600, 0);

1423 
MYSQL_SYSVAR_BOOL
(

1424 
debug_‰l_ignÜe_pk
, 
rocksdb_debug_‰l_ignÜe_pk
, 
PLUGIN_VAR_RQCMDARG
,

1427 
nuÎ±r
,‚uÎ±r, 
FALSE
);

1429 
MYSQL_SYSVAR_BOOL
(

1430 
»£t_¡©s
, 
rocksdb_»£t_¡©s
, 
PLUGIN_VAR_RQCMDARG
,

1431 "Re£ˆthRocksDB iÁ”ÇÈ¡©i¡ic w™houˆ»¡¬tšghDB.", 
nuÎ±r
,

1432 
rocksdb_£t_»£t_¡©s
, 
FALSE
);

1434 
MYSQL_SYSVAR_UINT
(
io_wr™e_timeout
, 
rocksdb_io_wr™e_timeout_£cs
,

1435 
PLUGIN_VAR_RQCMDARG
,

1436 "TimeouˆfÜƒx³rim’ÈI/O w©chdog.", 
nuÎ±r
,

1437 
rocksdb_£t_io_wr™e_timeout
, 0,

1439  
UINT_MAX
, 0);

1441 
MYSQL_SYSVAR_BOOL
(
’abË_2pc
, 
rocksdb_’abË_2pc
, 
PLUGIN_VAR_RQCMDARG
,

1442 "EÇbËwØpha£ comm™ fÜ MyRocks", 
nuÎ±r
,

1443 
nuÎ±r
, 
TRUE
);

1445 
MYSQL_SYSVAR_BOOL
(
ignÜe_unknown_İtiÚs
, 
rocksdb_ignÜe_unknown_İtiÚs
,

1446 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

1448 
nuÎ±r
,‚uÎ±r, 
TRUE
);

1450 
MYSQL_SYSVAR_BOOL
(
¡riù_cŞÏtiÚ_check
, 
rocksdb_¡riù_cŞÏtiÚ_check
,

1451 
PLUGIN_VAR_RQCMDARG
,

1453 
nuÎ±r
,‚uÎ±r, 
TRUE
);

1455 
MYSQL_SYSVAR_STR
(
¡riù_cŞÏtiÚ_exû±iÚs
,

1456 
rocksdb_¡riù_cŞÏtiÚ_exû±iÚs
,

1457 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_MEMALLOC
,

1460 
nuÎ±r
, 
rocksdb_£t_cŞÏtiÚ_exû±iÚ_li¡
, "");

1462 
MYSQL_SYSVAR_BOOL
(
cŞËù_s¡_´İ”t›s
, 
rocksdb_cŞËù_s¡_´İ”t›s
,

1463 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1465 
nuÎ±r
,‚uÎ±r, 
rocksdb_cŞËù_s¡_´İ”t›s
);

1467 
MYSQL_SYSVAR_BOOL
(

1468 
fÜû_æush_membË_now
, 
rocksdb_fÜû_æush_membË_now_v¬
,

1469 
PLUGIN_VAR_RQCMDARG
,

1471 
rocksdb_fÜû_æush_membË_now
, 
rocksdb_fÜû_æush_membË_now_¡ub
,

1472 
FALSE
);

1474 
MYSQL_SYSVAR_BOOL
(

1475 
fÜû_æush_membË_ªd_lz”o_now
,

1476 
rocksdb_fÜû_æush_membË_ªd_lz”o_now_v¬
, 
PLUGIN_VAR_RQCMDARG
,

1478 
rocksdb_fÜû_æush_membË_ªd_lz”o_now
,

1479 
rocksdb_fÜû_æush_membË_ªd_lz”o_now_¡ub
, 
FALSE
);

1481 
MYSQL_SYSVAR_UINT
(

1482 
£cÚds_b‘w“n_¡©_compu‹s
, 
rocksdb_£cÚds_b‘w“n_¡©_compu‹s
,

1483 
PLUGIN_VAR_RQCMDARG
,

1486 
nuÎ±r
,‚uÎ±r, 
rocksdb_£cÚds_b‘w“n_¡©_compu‹s
,

1487  0L, 
UINT_MAX
, 0);

1489 
MYSQL_SYSVAR_LONGLONG
(
com·ùiÚ_£qu’tŸl_d–‘es
,

1490 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es
,

1491 
PLUGIN_VAR_RQCMDARG
,

1495 
nuÎ±r
, 
rocksdb_£t_com·ùiÚ_İtiÚs
,

1496 
DEFAULT_COMPACTION_SEQUENTIAL_DELETES
,

1498  
MAX_COMPACTION_SEQUENTIAL_DELETES
, 0);

1500 
MYSQL_SYSVAR_LONGLONG
(

1501 
com·ùiÚ_£qu’tŸl_d–‘es_wšdow
,

1502 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_wšdow
, 
PLUGIN_VAR_RQCMDARG
,

1504 
nuÎ±r
, 
rocksdb_£t_com·ùiÚ_İtiÚs
,

1505 
DEFAULT_COMPACTION_SEQUENTIAL_DELETES_WINDOW
,

1506  0L, 
MAX_COMPACTION_SEQUENTIAL_DELETES_WINDOW
, 0);

1508 
MYSQL_SYSVAR_LONGLONG
(

1509 
com·ùiÚ_£qu’tŸl_d–‘es_fe_size
,

1510 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_fe_size
, 
PLUGIN_VAR_RQCMDARG
,

1511 "Mšimum fsiz»quœed fÜ com·ùiÚ_£qu’tŸl_d–‘es", 
nuÎ±r
,

1512 
rocksdb_£t_com·ùiÚ_İtiÚs
, 0L,

1513  -1L, 
LONGLONG_MAX
, 0);

1515 
MYSQL_SYSVAR_BOOL
(

1516 
com·ùiÚ_£qu’tŸl_d–‘es_couÁ_sd
,

1517 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_couÁ_sd
, 
PLUGIN_VAR_RQCMDARG
,

1518 "CouÁšg SšgËD–‘a rocksdb_com·ùiÚ_£qu’tŸl_d–‘es", 
nuÎ±r
,

1519 
nuÎ±r
, 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_couÁ_sd
);

1521 
MYSQL_SYSVAR_BOOL
(

1522 
´št_¢­shÙ_cÚæiù_qu”›s
, 
rocksdb_´št_¢­shÙ_cÚæiù_qu”›s
,

1523 
PLUGIN_VAR_RQCMDARG
,

1524 "Loggšg qu”› th© gÙ sÇpshÙ cÚæiùƒ¼Ü štØ*.”¸log", 
nuÎ±r
,

1525 
nuÎ±r
, 
rocksdb_´št_¢­shÙ_cÚæiù_qu”›s
);

1527 
MYSQL_THDVAR_INT
(
checksums_pù
, 
PLUGIN_VAR_RQCMDARG
,

1529 
nuÎ±r
,‚uÎ±r, 
RDB_MAX_CHECKSUMS_PCT
,

1530  0, 
RDB_MAX_CHECKSUMS_PCT
, 0);

1532 
MYSQL_THDVAR_BOOL
(
¡Üe_row_debug_checksums
, 
PLUGIN_VAR_RQCMDARG
,

1534 
nuÎ±r
,‚uÎ±r, 
çl£
 );

1536 
MYSQL_THDVAR_BOOL
(
v”ify_row_debug_checksums
, 
PLUGIN_VAR_RQCMDARG
,

1538 
nuÎ±r
,‚uÎ±r, 
çl£
 );

1540 
MYSQL_THDVAR_BOOL
(
ma¡”_sk_tx_­i
, 
PLUGIN_VAR_RQCMDARG
,

1543 
nuÎ±r
,‚uÎ±r, 
çl£
);

1545 
MYSQL_SYSVAR_UINT
(

1546 
v®id©e_bËs
, 
rocksdb_v®id©e_bËs
,

1547 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

1550 
nuÎ±r
,‚ullptr, 1 , 0 ,

1553 
MYSQL_SYSVAR_STR
(
d©adœ
, 
rocksdb_d©adœ
,

1554 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

1555 "RocksDB d©¨dœeùÜy", 
nuÎ±r
,‚ullptr,

1558 
MYSQL_SYSVAR_UINT
(

1559 
bË_¡©s_§m¶šg_pù
, 
rocksdb_bË_¡©s_§m¶šg_pù
,

1560 
PLUGIN_VAR_RQCMDARG
,

1563 "[" 
STRINGIFY_ARG
(
RDB_TBL_STATS_SAMPLE_PCT_MIN
) ".." STRINGIFY_ARG(

1564 
RDB_TBL_STATS_SAMPLE_PCT_MAX
) "]. "

1565 "By deçuÉ " 
STRINGIFY_ARG
(

1566 
RDB_DEFAULT_TBL_STATS_SAMPLE_PCT
) "% "

1580 
nuÎ±r
, 
rocksdb_£t_bË_¡©s_§m¶šg_pù
,

1581 
RDB_DEFAULT_TBL_STATS_SAMPLE_PCT
, 0,

1582  
RDB_TBL_STATS_SAMPLE_PCT_MAX
, 0);

1584 
MYSQL_SYSVAR_UINT
(

1585 
¡©s_»ÿlc_¿‹
, 
rocksdb_¡©s_»ÿlc_¿‹
, 
PLUGIN_VAR_RQCMDARG
,

1588 
nuÎ±r
,‚ullptr, 0 , 0 ,

1589 
UINT_MAX
 , 0);

1591 
MYSQL_SYSVAR_BOOL
(

1592 
Ïrge_´efix
, 
rocksdb_Ïrge_´efix
, 
PLUGIN_VAR_RQCMDARG
,

1595 
nuÎ±r
,‚uÎ±r, 
FALSE
);

1597 
MYSQL_SYSVAR_BOOL
(

1598 
®low_to_¡¬t_aá”_cÜru±iÚ
, 
rocksdb_®low_to_¡¬t_aá”_cÜru±iÚ
,

1599 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

1602 
nuÎ±r
,‚uÎ±r, 
FALSE
);

1604 
MYSQL_SYSVAR_BOOL
(
”rÜ_Ú_subİtim®_cŞÏtiÚ
,

1605 
rocksdb_”rÜ_Ú_subİtim®_cŞÏtiÚ
,

1606 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

1609 
nuÎ±r
,‚uÎ±r, 
TRUE
);

1611 cÚ¡ 
ROCKSDB_ASSUMED_KEY_VALUE_DISK_SIZE
 = 100;

1613 
¡_mysql_sys_v¬
 *
rocksdb_sy¡em_v¬ŸbËs
[] = {

1614 
MYSQL_SYSVAR
(
lock_wa™_timeout
),

1615 
MYSQL_SYSVAR
(
d—dlock_d‘eù
),

1616 
MYSQL_SYSVAR
(
d—dlock_d‘eù_d•th
),

1617 
MYSQL_SYSVAR
(
comm™_time_b©ch_fÜ_»cov”y
),

1618 
MYSQL_SYSVAR
(
max_row_locks
),

1619 
MYSQL_SYSVAR
(
wr™e_b©ch_max_by‹s
),

1620 
MYSQL_SYSVAR
(
lock_sÿÂed_rows
),

1621 
MYSQL_SYSVAR
(
bulk_lßd
),

1622 
MYSQL_SYSVAR
(
bulk_lßd_®low_sk
),

1623 
MYSQL_SYSVAR
(
bulk_lßd_®low_unsÜ‹d
),

1624 
MYSQL_SYSVAR
(
sk_unique_check_bËs
),

1625 
MYSQL_SYSVAR
(
Œaû_s¡_­i
),

1626 
MYSQL_SYSVAR
(
comm™_š_the_middË
),

1627 
MYSQL_SYSVAR
(
blšd_d–‘e_´im¬y_key
),

1628 
MYSQL_SYSVAR
(
»ad_ä“_½l_bËs
),

1629 
MYSQL_SYSVAR
(
bulk_lßd_size
),

1630 
MYSQL_SYSVAR
(
m”ge_buf_size
),

1631 
MYSQL_SYSVAR
(
’abË_bulk_lßd_­i
),

1632 
MYSQL_SYSVAR
(
tmpdœ
),

1633 
MYSQL_SYSVAR
(
m”ge_combše_»ad_size
),

1634 
MYSQL_SYSVAR
(
m”ge_tmp_fe_»mov®_d–ay_ms
),

1635 
MYSQL_SYSVAR
(
sk_bloom_f‹r_Ú_»ad
),

1637 
MYSQL_SYSVAR
(
ü—‹_if_missšg
),

1638 
MYSQL_SYSVAR
(
two_wr™e_queues
),

1639 
MYSQL_SYSVAR
(
mªu®_w®_æush
),

1640 
MYSQL_SYSVAR
(
wr™e_pŞicy
),

1641 
MYSQL_SYSVAR
(
ü—‹_missšg_cŞumn_çm›s
),

1642 
MYSQL_SYSVAR
(
”rÜ_if_exi¡s
),

1643 
MYSQL_SYSVAR
(
·¿noid_checks
),

1644 
MYSQL_SYSVAR
(
¿‹_lim™”_by‹s_³r_£c
),

1645 
MYSQL_SYSVAR
(
s¡_mgr_¿‹_by‹s_³r_£c
),

1646 
MYSQL_SYSVAR
(
d–ayed_wr™e_¿‹
),

1647 
MYSQL_SYSVAR
(
max_Ï‹¡_d—dlocks
),

1648 
MYSQL_SYSVAR
(
šfo_log_Ëv–
),

1649 
MYSQL_SYSVAR
(
max_İ’_fes
),

1650 
MYSQL_SYSVAR
(
max_tÙ®_w®_size
),

1651 
MYSQL_SYSVAR
(
u£_fsync
),

1652 
MYSQL_SYSVAR
(
w®_dœ
),

1653 
MYSQL_SYSVAR
(
³rsi¡’t_ÿche_·th
),

1654 
MYSQL_SYSVAR
(
³rsi¡’t_ÿche_size_mb
),

1655 
MYSQL_SYSVAR
(
d–‘e_obsŞ‘e_fes_³riod_miüos
),

1656 
MYSQL_SYSVAR
(
max_background_jobs
),

1657 
MYSQL_SYSVAR
(
max_log_fe_size
),

1658 
MYSQL_SYSVAR
(
max_subcom·ùiÚs
),

1659 
MYSQL_SYSVAR
(
log_fe_time_to_rŞl
),

1660 
MYSQL_SYSVAR
(
k“p_log_fe_num
),

1661 
MYSQL_SYSVAR
(
max_mªiã¡_fe_size
),

1662 
MYSQL_SYSVAR
(
bË_ÿche_numsh¬db™s
),

1663 
MYSQL_SYSVAR
(
w®_‰l_£cÚds
),

1664 
MYSQL_SYSVAR
(
w®_size_lim™_mb
),

1665 
MYSQL_SYSVAR
(
mªiã¡_´—ÎoÿtiÚ_size
),

1666 
MYSQL_SYSVAR
(
u£_dœeù_»ads
),

1667 
MYSQL_SYSVAR
(
u£_dœeù_io_fÜ_æush_ªd_com·ùiÚ
),

1668 
MYSQL_SYSVAR
(
®low_mm­_»ads
),

1669 
MYSQL_SYSVAR
(
®low_mm­_wr™es
),

1670 
MYSQL_SYSVAR
(
is_fd_şo£_Ú_exec
),

1671 
MYSQL_SYSVAR
(
¡©s_dump_³riod_£c
),

1672 
MYSQL_SYSVAR
(
advi£_¿ndom_Ú_İ’
),

1673 
MYSQL_SYSVAR
(
db_wr™e_bufãr_size
),

1674 
MYSQL_SYSVAR
(
u£_ad­tive_mu‹x
),

1675 
MYSQL_SYSVAR
(
by‹s_³r_sync
),

1676 
MYSQL_SYSVAR
(
w®_by‹s_³r_sync
),

1677 
MYSQL_SYSVAR
(
’abË_th»ad_Œackšg
),

1678 
MYSQL_SYSVAR
(
³rf_cÚ‹xt_Ëv–
),

1679 
MYSQL_SYSVAR
(
w®_»cov”y_mode
),

1680 
MYSQL_SYSVAR
(
acûss_hšt_Ú_com·ùiÚ_¡¬t
),

1681 
MYSQL_SYSVAR
(
Ãw_bË_»ad”_fÜ_com·ùiÚ_šputs
),

1682 
MYSQL_SYSVAR
(
com·ùiÚ_»adah—d_size
),

1683 
MYSQL_SYSVAR
(
®low_cÚcu¼’t_membË_wr™e
),

1684 
MYSQL_SYSVAR
(
’abË_wr™e_th»ad_ad­tive_y›ld
),

1686 
MYSQL_SYSVAR
(
block_ÿche_size
),

1687 
MYSQL_SYSVAR
(
sim_ÿche_size
),

1688 
MYSQL_SYSVAR
(
u£_şock_ÿche
),

1689 
MYSQL_SYSVAR
(
ÿche_šdex_ªd_f‹r_blocks
),

1690 
MYSQL_SYSVAR
(
pš_l0_f‹r_ªd_šdex_blocks_š_ÿche
),

1691 
MYSQL_SYSVAR
(
šdex_ty³
),

1692 
MYSQL_SYSVAR
(
hash_šdex_®low_cŞlisiÚ
),

1693 
MYSQL_SYSVAR
(
no_block_ÿche
),

1694 
MYSQL_SYSVAR
(
block_size
),

1695 
MYSQL_SYSVAR
(
block_size_devŸtiÚ
),

1696 
MYSQL_SYSVAR
(
block_»¡¬t_š‹rv®
),

1697 
MYSQL_SYSVAR
(
whŞe_key_f‹ršg
),

1699 
MYSQL_SYSVAR
(
deçuÉ_cf_İtiÚs
),

1700 
MYSQL_SYSVAR
(
ov”ride_cf_İtiÚs
),

1701 
MYSQL_SYSVAR
(
upd©e_cf_İtiÚs
),

1703 
MYSQL_SYSVAR
(
æush_log_©_Œx_comm™
),

1704 
MYSQL_SYSVAR
(
wr™e_di§bË_w®
),

1705 
MYSQL_SYSVAR
(
wr™e_ignÜe_missšg_cŞumn_çm›s
),

1707 
MYSQL_SYSVAR
(
sk_fl_ÿche
),

1708 
MYSQL_SYSVAR
(
un§ã_fÜ_bšlog
),

1710 
MYSQL_SYSVAR
(
»cÜds_š_¿nge
),

1711 
MYSQL_SYSVAR
(
fÜû_šdex_»cÜds_š_¿nge
),

1712 
MYSQL_SYSVAR
(
debug_İtimiz”_n_rows
),

1713 
MYSQL_SYSVAR
(
fÜû_compu‹_membË_¡©s
),

1714 
MYSQL_SYSVAR
(
fÜû_compu‹_membË_¡©s_ÿch‘ime
),

1715 
MYSQL_SYSVAR
(
debug_İtimiz”_no_z”o_ÿrdš®™y
),

1717 
MYSQL_SYSVAR
(
com·ù_cf
),

1718 
MYSQL_SYSVAR
(
sigÇl_drİ_šdex_th»ad
),

1719 
MYSQL_SYSVAR
(
·u£_background_wÜk
),

1720 
MYSQL_SYSVAR
(
’abË_2pc
),

1721 
MYSQL_SYSVAR
(
ignÜe_unknown_İtiÚs
),

1722 
MYSQL_SYSVAR
(
¡riù_cŞÏtiÚ_check
),

1723 
MYSQL_SYSVAR
(
¡riù_cŞÏtiÚ_exû±iÚs
),

1724 
MYSQL_SYSVAR
(
cŞËù_s¡_´İ”t›s
),

1725 
MYSQL_SYSVAR
(
fÜû_æush_membË_now
),

1726 
MYSQL_SYSVAR
(
fÜû_æush_membË_ªd_lz”o_now
),

1727 
MYSQL_SYSVAR
(
’abË_‰l
),

1728 
MYSQL_SYSVAR
(
’abË_‰l_»ad_f‹ršg
),

1729 
MYSQL_SYSVAR
(
debug_‰l_»c_ts
),

1730 
MYSQL_SYSVAR
(
debug_‰l_¢­shÙ_ts
),

1731 
MYSQL_SYSVAR
(
debug_‰l_»ad_f‹r_ts
),

1732 
MYSQL_SYSVAR
(
debug_‰l_ignÜe_pk
),

1733 
MYSQL_SYSVAR
(
»£t_¡©s
),

1734 
MYSQL_SYSVAR
(
io_wr™e_timeout
),

1735 
MYSQL_SYSVAR
(
£cÚds_b‘w“n_¡©_compu‹s
),

1737 
MYSQL_SYSVAR
(
com·ùiÚ_£qu’tŸl_d–‘es
),

1738 
MYSQL_SYSVAR
(
com·ùiÚ_£qu’tŸl_d–‘es_wšdow
),

1739 
MYSQL_SYSVAR
(
com·ùiÚ_£qu’tŸl_d–‘es_fe_size
),

1740 
MYSQL_SYSVAR
(
com·ùiÚ_£qu’tŸl_d–‘es_couÁ_sd
),

1741 
MYSQL_SYSVAR
(
´št_¢­shÙ_cÚæiù_qu”›s
),

1743 
MYSQL_SYSVAR
(
d©adœ
),

1744 
MYSQL_SYSVAR
(
ü—‹_checkpošt
),

1746 
MYSQL_SYSVAR
(
checksums_pù
),

1747 
MYSQL_SYSVAR
(
¡Üe_row_debug_checksums
),

1748 
MYSQL_SYSVAR
(
v”ify_row_debug_checksums
),

1749 
MYSQL_SYSVAR
(
ma¡”_sk_tx_­i
),

1751 
MYSQL_SYSVAR
(
v®id©e_bËs
),

1752 
MYSQL_SYSVAR
(
bË_¡©s_§m¶šg_pù
),

1754 
MYSQL_SYSVAR
(
Ïrge_´efix
),

1755 
MYSQL_SYSVAR
(
®low_to_¡¬t_aá”_cÜru±iÚ
),

1756 
MYSQL_SYSVAR
(
”rÜ_Ú_subİtim®_cŞÏtiÚ
),

1757 
MYSQL_SYSVAR
(
¡©s_»ÿlc_¿‹
),

1758 
nuÎ±r
};

1760 
rocksdb
::
Wr™eO±iÚs


1761 
	$rdb_g‘_rocksdb_wr™e_İtiÚs
(
my_cÜe
::
THD
 *cÚ¡ 
thd
) {

1762 
rocksdb
::
Wr™eO±iÚs
 
İt
;

1764 
İt
.
sync
 = (
rocksdb_æush_log_©_Œx_comm™
 =ğ
FLUSH_LOG_SYNC
);

1765 
İt
.
di§bËWAL
 = 
	`THDVAR
(
thd
, 
wr™e_di§bË_w®
);

1766 
İt
.
ignÜe_missšg_cŞumn_çm›s
 =

1767 
	`THDVAR
(
thd
, 
wr™e_ignÜe_missšg_cŞumn_çm›s
);

1769  
İt
;

1770 
	}
}

1779 
uch¬
 *

1780 
Rdb_İ’_bËs_m­
::
g‘_hash_key
(
Rdb_bË_hªdËr
 *cÚ¡ 
bË_hªdËr
,

1781 
size_t
 *cÚ¡ 
Ëngth
,

1782 
my_boŞ
 
nÙ_u£d
 
MY_ATTRIBUTE
((
__unu£d__
))) {

1783 *
Ëngth
 = 
bË_hªdËr
->
m_bË_Çme_Ëngth
;

1784  
»š‹½»t_ÿ¡
<
uch¬
 *>(
bË_hªdËr
->
m_bË_Çme
);

1791 
Rdb_drİ_šdex_th»ad
 
rdb_drİ_idx_th»ad
;

1793 
rocksdb_drİ_šdex_wakeup_th»ad
(

1794 
my_cÜe
::
THD
 *cÚ¡ 
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

1795 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

1796 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
) {

1797 ià(*
¡©ic_ÿ¡
<cÚ¡ 
boŞ
 *>(
§ve
)) {

1798 
rdb_drİ_idx_th»ad
.
sigÇl
();

1802 
šlše
 
ušt32_t
 
	$rocksdb_³rf_cÚ‹xt_Ëv–
(
THD
 *cÚ¡ 
thd
) {

1803 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

1805 cÚ¡ 
£ssiÚ_³rf_cÚ‹xt_Ëv–
 = 
	`THDVAR
(
thd
, 
³rf_cÚ‹xt_Ëv–
);

1806 ià(
£ssiÚ_³rf_cÚ‹xt_Ëv–
 > 
rocksdb
::
P”fLev–
::
kUnš™Ÿlized
) {

1807  
£ssiÚ_³rf_cÚ‹xt_Ëv–
;

1815 cÚ¡ 
glob®_³rf_cÚ‹xt_Ëv–
 = 
	`THDVAR
(
nuÎ±r
, 
³rf_cÚ‹xt_Ëv–
);

1816 ià(
glob®_³rf_cÚ‹xt_Ëv–
 > 
rocksdb
::
P”fLev–
::
kUnš™Ÿlized
) {

1817  
glob®_³rf_cÚ‹xt_Ëv–
;

1820  
rocksdb
::
P”fLev–
::
kDi§bË
;

1821 
	}
}

1828 
š‹rçû
 
Rdb_tx_li¡_w®k”
 {

1829 
vœtu®
 ~
Rdb_tx_li¡_w®k”
() {}

1830 
vœtu®
 
´oûss_Œª
(cÚ¡ 
Rdb_Œª§ùiÚ
 *const) = 0;

1838 şas 
	cRdb_¢­shÙ_nÙif›r
 : 
public
 
rocksdb
::
T¿n§ùiÚNÙif›r
 {

1839 
Rdb_Œª§ùiÚ
 *
m_ownšg_tx
;

1841 
SÇpshÙC»©ed
(cÚ¡ 
rocksdb
::
SÇpshÙ
 *
¢­shÙ
è
ov”ride
;

1843 
public
:

1844 
Rdb_¢­shÙ_nÙif›r
(cÚ¡ Rdb_¢­shÙ_nÙif›¸&èğ
d–‘e
;

1845 
Rdb_¢­shÙ_nÙif›r
 &
İ”©Ü
=(cÚ¡ Rdb_¢­shÙ_nÙif›¸&èğ
d–‘e
;

1847 
ex¶ic™
 
Rdb_¢­shÙ_nÙif›r
(
Rdb_Œª§ùiÚ
 *cÚ¡ 
ownšg_tx
)

1848 : 
m_ownšg_tx
(
ownšg_tx
) {}

1852 
d‘ach
(è{ 
m_ownšg_tx
 = 
nuÎ±r
; }

1857 şas 
	cRdb_Œª§ùiÚ
 {

1858 
´Ùeùed
:

1859 
ulÚglÚg
 
m_wr™e_couÁ
 = 0;

1860 
ulÚglÚg
 
m_š£¹_couÁ
 = 0;

1861 
ulÚglÚg
 
m_upd©e_couÁ
 = 0;

1862 
ulÚglÚg
 
m_d–‘e_couÁ
 = 0;

1863 
ulÚglÚg
 
m_lock_couÁ
 = 0;

1864 
¡d
::
unÜd”ed_m­
<
GL_INDEX_ID
, 
ulÚglÚg
> 
m_auto_šü_m­
;

1866 
boŞ
 
m_is_d–ayed_¢­shÙ
 = 
çl£
;

1867 
boŞ
 
m_is_two_pha£
 = 
çl£
;

1869 
´iv©e
:

1871 
m_n_§v•ošts
;

1877 
ulÚglÚg
 
m_wr™es_©_Ï¡_§v•ošt
;

1879 
´Ùeùed
:

1880 
THD
 *
m_thd
 = 
nuÎ±r
;

1882 
¡d
::
muÉi£t
<
Rdb_Œª§ùiÚ
 *> 
s_tx_li¡
;

1883 
mysql_mu‹x_t
 
s_tx_li¡_mu‹x
;

1885 
Rdb_io_³rf
 *
m_tbl_io_³rf
;

1887 
boŞ
 
m_tx_»ad_Úly
 = 
çl£
;

1889 
m_timeout_£c
;

1892 
ulÚglÚg
 
m_max_row_locks
;

1894 
boŞ
 
m_is_tx_çed
 = 
çl£
;

1895 
boŞ
 
m_rŞlback_Úly
 = 
çl£
;

1897 
¡d
::
sh¬ed_±r
<
Rdb_¢­shÙ_nÙif›r
> 
m_nÙif›r
;

1900 
vœtu®
 
rocksdb
::
Wr™eB©chBa£
 *
g‘_wr™e_b©ch
() = 0;

1901 
vœtu®
 
boŞ
 
comm™_no_bšlog
() = 0;

1902 
vœtu®
 
rocksdb
::
I‹¿tÜ
 *

1903 
g‘_™”©Ü
(cÚ¡ 
rocksdb
::
R—dO±iÚs
 &
İtiÚs
,

1904 
rocksdb
::
CŞumnFamyHªdË
 *
cŞumn_çmy
) = 0;

1914 
rocksdb
::
Stus
 
m”ge_auto_šü_m­
Ôocksdb::
Wr™eB©chBa£
 *cÚ¡ 
wb
) {

1915 
DBUG_EXECUTE_IF
("myrocks_autošc_upg¿de",  
rocksdb
::
Stus
::
OK
(););

1918 
rocksdb
::
Stus
 
s
;

1919 autØ&
™
 : 
m_auto_šü_m­
) {

1920 
s
 = 
diù_mªag”
.
put_auto_šü_v®
(
wb
, 
™
.
fœ¡
, it.
£cÚd
);

1921 ià(!
s
.
ok
()) {

1922  
s
;

1925 
m_auto_šü_m­
.
ş—r
();

1926  
s
;

1929 
´Ùeùed
:

1934 
vœtu®
 
do_£t_§v•ošt
() = 0;

1935 
vœtu®
 
do_rŞlback_to_§v•ošt
() = 0;

1937 
public
:

1938 
rocksdb
::
R—dO±iÚs
 
m_»ad_İts
;

1939 cÚ¡ *
m_mysql_log_fe_Çme
;

1940 
my_off_t
 
m_mysql_log_off£t
;

1941 cÚ¡ *
m_mysql_gtid
;

1942 cÚ¡ *
m_mysql_max_gtid
;

1943 
SŒšg
 
m_d‘aed_”rÜ
;

1944 
št64_t
 
m_¢­shÙ_time¡amp
 = 0;

1945 
boŞ
 
m_ddl_Œª§ùiÚ
;

1946 
¡d
::
sh¬ed_±r
<
Rdb_ex¶ic™_¢­shÙ
> 
m_ex¶ic™_¢­shÙ
;

1952 
št64_t
 
m_n_mysql_bËs_š_u£
 = 0;

1958 
vœtu®
 
boŞ
 
is_wr™eb©ch_Œx
() const = 0;

1960 
š™_mu‹x
() {

1961 
mysql_mu‹x_š™
(
key_mu‹x_tx_li¡
, &
s_tx_li¡_mu‹x
, 
MY_MUTEX_INIT_FAST
);

1964 
‹rm_mu‹x
() {

1965 
DBUG_ASSERT
(
s_tx_li¡
.
size
() == 0);

1966 
mysql_mu‹x_de¡roy
(&
s_tx_li¡_mu‹x
);

1969 
w®k_tx_li¡
(
Rdb_tx_li¡_w®k”
 *
w®k”
) {

1970 
DBUG_ASSERT
(
w®k”
 !ğ
nuÎ±r
);

1972 
RDB_MUTEX_LOCK_CHECK
(
s_tx_li¡_mu‹x
);

1974 autØ
™
 : 
s_tx_li¡
)

1975 
w®k”
->
´oûss_Œª
(
™
);

1977 
RDB_MUTEX_UNLOCK_CHECK
(
s_tx_li¡_mu‹x
);

1980 
£t_¡©us_”rÜ
(
THD
 *cÚ¡ 
thd
, cÚ¡ 
rocksdb
::
Stus
 &
s
,

1981 cÚ¡ 
Rdb_key_def
 &
kd
, 
Rdb_tbl_def
 *cÚ¡ 
tbl_def
,

1982 
Rdb_bË_hªdËr
 *cÚ¡ 
bË_hªdËr
) {

1983 
DBUG_ASSERT
(!
s
.
ok
());

1984 
DBUG_ASSERT
(
tbl_def
 !ğ
nuÎ±r
);

1986 ià(
s
.
IsTimedOut
()) {

1995 
my_cÜe
::
thd_m¬k_Œª§ùiÚ_to_rŞlback
(
thd
, 
çl£
 );

1996 
m_d‘aed_”rÜ
.
cİy
(
timeout_mes§ge
(

1997 "šdex", 
tbl_def
->
fuÎ_bËÇme
().
c_¡r
(), 
kd
.
g‘_Çme
().c_str()));

1998 
bË_hªdËr
->
m_lock_wa™_timeout_couÁ”
.
šc
();

1999 
rocksdb_row_lock_wa™_timeouts
++;

2001  
HA_ERR_LOCK_WAIT_TIMEOUT
;

2004 ià(
s
.
IsD—dlock
()) {

2005 
my_cÜe
::
thd_m¬k_Œª§ùiÚ_to_rŞlback
(
thd
,

2006 
çl£
 );

2007 
m_d‘aed_”rÜ
 = 
SŒšg
();

2008 
bË_hªdËr
->
m_d—dlock_couÁ”
.
šc
();

2009 
rocksdb_row_lock_d—dlocks
++;

2010  
HA_ERR_LOCK_DEADLOCK
;

2011 } ià(
s
.
IsBusy
()) {

2012 
rocksdb_¢­shÙ_cÚæiù_”rÜs
++;

2013 ià(
rocksdb_´št_¢­shÙ_cÚæiù_qu”›s
) {

2014 
u£r_ho¡_buff
[
MAX_USER_HOST_SIZE
 + 1];

2015 
make_u£r_Çme
(
thd
, 
u£r_ho¡_buff
);

2017 
sql_´št_w¬nšg
("Got snapshot conflictƒrrors: User: %s "

2019 
u£r_ho¡_buff
, 
thd
->
qu”y
());

2021 
m_d‘aed_”rÜ
 = 
SŒšg
(" (¢­shÙ cÚæiù)", 
sy¡em_ch¬£t_šfo
);

2022 
bË_hªdËr
->
m_d—dlock_couÁ”
.
šc
();

2023  
HA_ERR_LOCK_DEADLOCK
;

2026 ià(
s
.
IsIOE¼Ü
(è|| s.
IsCÜru±iÚ
()) {

2027 
rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_GENERAL
);

2030  
ha_rocksdb
::
rdb_”rÜ_to_mysql
(
s
);

2033 
THD
 *
g‘_thd
(ècÚ¡ {  
m_thd
; }

2036 
io_³rf_¡¬t
(
Rdb_io_³rf
 *cÚ¡ 
io_³rf
) {

2052 ià(
m_tbl_io_³rf
 =ğ
nuÎ±r
 &&

2053 
io_³rf
->
¡¬t
(
rocksdb_³rf_cÚ‹xt_Ëv–
(
m_thd
))) {

2054 
m_tbl_io_³rf
 = 
io_³rf
;

2058 
io_³rf_’d_ªd_»cÜd
() {

2059 ià(
m_tbl_io_³rf
 !ğ
nuÎ±r
) {

2060 
m_tbl_io_³rf
->
’d_ªd_»cÜd
(
rocksdb_³rf_cÚ‹xt_Ëv–
(
m_thd
));

2061 
m_tbl_io_³rf
 = 
nuÎ±r
;

2065 
io_³rf_’d_ªd_»cÜd
(
Rdb_io_³rf
 *cÚ¡ 
io_³rf
) {

2066 ià(
m_tbl_io_³rf
 =ğ
io_³rf
) {

2067 
io_³rf_’d_ªd_»cÜd
();

2071 
upd©e_by‹s_wr™‹n
(
ulÚglÚg
 
by‹s_wr™‹n
) {

2072 ià(
m_tbl_io_³rf
 !ğ
nuÎ±r
) {

2073 
m_tbl_io_³rf
->
upd©e_by‹s_wr™‹n
(
rocksdb_³rf_cÚ‹xt_Ëv–
(
m_thd
),

2074 
by‹s_wr™‹n
);

2078 
£t_·¿ms
(
timeout_£c_¬g
, 
max_row_locks_¬g
) {

2079 
m_timeout_£c
 = 
timeout_£c_¬g
;

2080 
m_max_row_locks
 = 
max_row_locks_¬g
;

2081 
£t_lock_timeout
(
timeout_£c_¬g
);

2084 
vœtu®
 
£t_lock_timeout
(
timeout_£c_¬g
) = 0;

2086 
ulÚglÚg
 
g‘_wr™e_couÁ
(ècÚ¡ {  
m_wr™e_couÁ
; }

2088 
ulÚglÚg
 
g‘_š£¹_couÁ
(ècÚ¡ {  
m_š£¹_couÁ
; }

2090 
ulÚglÚg
 
g‘_upd©e_couÁ
(ècÚ¡ {  
m_upd©e_couÁ
; }

2092 
ulÚglÚg
 
g‘_d–‘e_couÁ
(ècÚ¡ {  
m_d–‘e_couÁ
; }

2094 
šü_š£¹_couÁ
(è{ ++
m_š£¹_couÁ
; }

2096 
šü_upd©e_couÁ
(è{ ++
m_upd©e_couÁ
; }

2098 
šü_d–‘e_couÁ
(è{ ++
m_d–‘e_couÁ
; }

2100 
g‘_timeout_£c
(ècÚ¡ {  
m_timeout_£c
; }

2102 
ulÚglÚg
 
g‘_lock_couÁ
(ècÚ¡ {  
m_lock_couÁ
; }

2104 
vœtu®
 
£t_sync
(
boŞ
 
sync
) = 0;

2106 
vœtu®
 
»Ëa£_lock
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2107 cÚ¡ 
¡d
::
¡ršg
 &
rowkey
) = 0;

2109 
vœtu®
 
boŞ
 
´•¬e
(cÚ¡ 
rocksdb
::
T¿n§ùiÚName
 &
Çme
) = 0;

2111 
boŞ
 
comm™_Ü_rŞlback
() {

2112 
boŞ
 
»s
;

2113 ià(
m_is_tx_çed
) {

2114 
rŞlback
();

2115 
»s
 = 
çl£
;

2117 
»s
 = 
comm™
();

2118  
»s
;

2121 
boŞ
 
comm™
() {

2122 ià(
g‘_wr™e_couÁ
() == 0) {

2123 
rŞlback
();

2124  
çl£
;

2125 } ià(
m_rŞlback_Úly
) {

2135 
my_”rÜ
(
ER_ROLLBACK_ONLY
, 
MYF
(0));

2136 
rŞlback
();

2137  
Œue
;

2139 
my_cÜe
::
thd_bšlog_pos
(
m_thd
, &
m_mysql_log_fe_Çme
,

2140 &
m_mysql_log_off£t
, &
m_mysql_gtid
,

2141 &
m_mysql_max_gtid
);

2142 
bšlog_mªag”
.
upd©e
(
m_mysql_log_fe_Çme
, 
m_mysql_log_off£t
,

2143 
m_mysql_max_gtid
, 
g‘_wr™e_b©ch
());

2144  
comm™_no_bšlog
();

2148 
vœtu®
 
rŞlback
() = 0;

2150 
¢­shÙ_ü—‹d
(cÚ¡ 
rocksdb
::
SÇpshÙ
 *cÚ¡ 
¢­shÙ
) {

2151 
DBUG_ASSERT
(
¢­shÙ
 !ğ
nuÎ±r
);

2153 
m_»ad_İts
.
¢­shÙ
 = snapshot;

2154 
rdb
->
G‘Env
()->
G‘Cu¼’tTime
(&
m_¢­shÙ_time¡amp
);

2155 
m_is_d–ayed_¢­shÙ
 = 
çl£
;

2158 
vœtu®
 
acquœe_¢­shÙ
(
boŞ
 
acquœe_now
) = 0;

2159 
vœtu®
 
»Ëa£_¢­shÙ
() = 0;

2161 
boŞ
 
has_¢­shÙ
(ècÚ¡ {  
m_»ad_İts
.
¢­shÙ
 !ğ
nuÎ±r
; }

2163 
´iv©e
:

2166 
¡d
::
veùÜ
<¡d::
sh¬ed_±r
<
Rdb_s¡_šfo
>> 
m_cu¼_bulk_lßd
;

2167 
¡d
::
¡ršg
 
m_cu¼_bulk_lßd_bËÇme
;

2170 
¡d
::
unÜd”ed_m­
<
GL_INDEX_ID
, 
Rdb_šdex_m”ge
> 
m_key_m”ge
;

2172 
public
:

2173 
g‘_key_m”ge
(
GL_INDEX_ID
 
kd_gl_id
, 
rocksdb
::
CŞumnFamyHªdË
 *
cf
,

2174 
Rdb_šdex_m”ge
 **
key_m”ge
) {

2175 
»s
;

2176 autØ
™
 = 
m_key_m”ge
.
fšd
(
kd_gl_id
);

2177 ià(
™
 =ğ
m_key_m”ge
.
’d
()) {

2178 
m_key_m”ge
.
em¶aû
(

2179 
¡d
::
p›ûwi£_cÚ¡ruù
, std::
make_tu¶e
(
kd_gl_id
),

2180 
¡d
::
make_tu¶e
(

2181 
g‘_rocksdb_tmpdœ
(), 
THDVAR
(
g‘_thd
(), 
m”ge_buf_size
),

2182 
THDVAR
(
g‘_thd
(), 
m”ge_combše_»ad_size
),

2183 
THDVAR
(
g‘_thd
(), 
m”ge_tmp_fe_»mov®_d–ay_ms
), 
cf
));

2184 
™
 = 
m_key_m”ge
.
fšd
(
kd_gl_id
);

2185 ià((
»s
 = 
™
->
£cÚd
.
š™
()) != 0) {

2186  
»s
;

2189 *
key_m”ge
 = &
™
->
£cÚd
;

2190  
HA_EXIT_SUCCESS
;

2193 
fšish_bulk_lßd
(
´št_ş›Á_”rÜ
 = 
Œue
) {

2194 
rc
 = 0, 
rc2
;

2196 
¡d
::
veùÜ
<¡d::
sh¬ed_±r
<
Rdb_s¡_šfo
>>::
™”©Ü
 
™
;

2197 
™
 = 
m_cu¼_bulk_lßd
.
begš
(); iˆ!ğm_cu¼_bulk_lßd.
’d
(); it++) {

2198 
rc2
 = (*
™
)->
comm™
(
´št_ş›Á_”rÜ
);

2199 ià(
rc2
 !ğ0 && 
rc
 == 0) {

2200 
rc
 = 
rc2
;

2203 
m_cu¼_bulk_lßd
.
ş—r
();

2204 
m_cu¼_bulk_lßd_bËÇme
.
ş—r
();

2205 
DBUG_ASSERT
(
m_cu¼_bulk_lßd
.
size
() == 0);

2208 ià(!
m_key_m”ge
.
em±y
()) {

2209 
rocksdb
::
Sliû
 
m”ge_key
;

2210 
rocksdb
::
Sliû
 
m”ge_v®
;

2211 autØ
™
 = 
m_key_m”ge
.
begš
(); iˆ!ğm_key_m”ge.
’d
(); it++) {

2212 
GL_INDEX_ID
 
šdex_id
 = 
™
->
fœ¡
;

2213 
¡d
::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
> 
keydef
 =

2214 
ddl_mªag”
.
§ã_fšd
(
šdex_id
);

2215 
¡d
::
¡ršg
 
bË_Çme
 = 
ddl_mªag”
.
§ã_g‘_bË_Çme
(
šdex_id
);

2225 ià(
keydef
 =ğ
nuÎ±r
 || 
bË_Çme
.
em±y
()) {

2226 
rc2
 = 
HA_ERR_ROCKSDB_BULK_LOAD
;

2229 cÚ¡ 
¡d
::
¡ršg
 &
šdex_Çme
 = 
keydef
->
g‘_Çme
();

2230 
Rdb_šdex_m”ge
 &
rdb_m”ge
 = 
™
->
£cÚd
;

2234 
¡d
::
»¶aû
(
bË_Çme
.
begš
(),abË_Çme.
’d
(), '.', '/');

2235 
bË_Çme
 = "./" +able_name;

2236 
Rdb_s¡_šfo
 
s¡_šfo
(
rdb
, 
bË_Çme
, 
šdex_Çme
, 
rdb_m”ge
.
g‘_cf
(),

2237 *
rocksdb_db_İtiÚs
,

2238 
THDVAR
(
g‘_thd
(), 
Œaû_s¡_­i
));

2240 (
rc2
 = 
rdb_m”ge
.
Ãxt
(&
m”ge_key
, &
m”ge_v®
)) == 0) {

2241 ià((
rc2
 = 
s¡_šfo
.
put
(
m”ge_key
, 
m”ge_v®
)) != 0) {

2247 ià(
rc2
 > 0 || (rc2 = 
s¡_šfo
.
comm™
(
´št_ş›Á_”rÜ
)) != 0) {

2248 ià(
rc
 == 0) {

2249 
rc
 = 
rc2
;

2254 
m_key_m”ge
.
ş—r
();

2261 
purge_®l_jem®loc_¬’as
();

2263  
rc
;

2266 
¡¬t_bulk_lßd
(
ha_rocksdb
 *cÚ¡ 
bulk_lßd
,

2267 
¡d
::
sh¬ed_±r
<
Rdb_s¡_šfo
> 
s¡_šfo
) {

2274 
DBUG_ASSERT
(
bulk_lßd
 !ğ
nuÎ±r
);

2276 ià(!
m_cu¼_bulk_lßd
.
em±y
() &&

2277 
bulk_lßd
->
g‘_bË_ba£Çme
(è!ğ
m_cu¼_bulk_lßd_bËÇme
) {

2278 cÚ¡‡utØ
»s
 = 
fšish_bulk_lßd
();

2279 ià(
»s
 !ğ
HA_EXIT_SUCCESS
) {

2280 
m_cu¼_bulk_lßd
.
ş—r
();

2281 
m_cu¼_bulk_lßd_bËÇme
.
ş—r
();

2282  
»s
;

2297 
m_cu¼_bulk_lßd
.
push_back
(
s¡_šfo
);

2298 
m_cu¼_bulk_lßd_bËÇme
 = 
bulk_lßd
->
g‘_bË_ba£Çme
();

2299  
HA_EXIT_SUCCESS
;

2302 
num_Úgošg_bulk_lßd
(ècÚ¡ {  
m_cu¼_bulk_lßd
.
size
(); }

2304 cÚ¡ *
g‘_rocksdb_tmpdœ
() const {

2305 cÚ¡ *
tmp_dœ
 = 
THDVAR
(
g‘_thd
(), 
tmpdœ
);

2311 ià(
tmp_dœ
 !ğ
nuÎ±r
 && *tmp_dir == '\0') {

2312 
tmp_dœ
 = 
nuÎ±r
;

2314  (
tmp_dœ
);

2330 
boŞ
 
æush_b©ch
() {

2331 ià(
g‘_wr™e_couÁ
() == 0)

2332  
çl£
;

2335 ià(
comm™_no_bšlog
())

2336  
Œue
;

2339 
¡¬t_tx
();

2340  
çl£
;

2343 
£t_auto_šü
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
, 
ulÚglÚg
 
cu¼_id
) {

2344 
m_auto_šü_m­
[
gl_šdex_id
] =

2345 
¡d
::
max
(
m_auto_šü_m­
[
gl_šdex_id
], 
cu¼_id
);

2348 #iâdeà
NDEBUG


2349 
ulÚglÚg
 
g‘_auto_šü
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) {

2350 ià(
m_auto_šü_m­
.
couÁ
(
gl_šdex_id
) > 0) {

2351  
m_auto_šü_m­
[
gl_šdex_id
];

2357 
vœtu®
 
rocksdb
::
Stus
 
put
Ôocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2358 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

2359 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
) = 0;

2360 
vœtu®
 
rocksdb
::
Stus


2361 
d–‘e_key
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2362 cÚ¡ 
rocksdb
::
Sliû
 &
key
) = 0;

2363 
vœtu®
 
rocksdb
::
Stus


2364 
sšgË_d–‘e
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2365 cÚ¡ 
rocksdb
::
Sliû
 &
key
) = 0;

2367 
vœtu®
 
boŞ
 
has_modifiÿtiÚs
() const = 0;

2369 
vœtu®
 
rocksdb
::
Wr™eB©chBa£
 *
g‘_šdexed_wr™e_b©ch
() = 0;

2374 
rocksdb
::
Wr™eB©chBa£
 *
g‘_blšd_wr™e_b©ch
() {

2375  
g‘_šdexed_wr™e_b©ch
()->
G‘Wr™eB©ch
();

2378 
vœtu®
 
rocksdb
::
Stus
 
g‘
Ôocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2379 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

2380 
rocksdb
::
PšÇbËSliû
 *cÚ¡ 
v®ue
) const = 0;

2381 
vœtu®
 
rocksdb
::
Stus


2382 
g‘_fÜ_upd©e
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2383 cÚ¡ 
rocksdb
::
Sliû
 &
key
,„ocksdb::
PšÇbËSliû
 *cÚ¡ 
v®ue
,

2384 
boŞ
 
exşusive
) = 0;

2386 
rocksdb
::
I‹¿tÜ
 *

2387 
g‘_™”©Ü
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2388 
boŞ
 
sk_bloom_f‹r
, boŞ 
fl_ÿche
,

2389 cÚ¡ 
rocksdb
::
Sliû
 &
eq_cÚd_low”_bound
,

2390 cÚ¡ 
rocksdb
::
Sliû
 &
eq_cÚd_uµ”_bound
,

2391 
boŞ
 
»ad_cu¼’t
 = 
çl£
, boŞ 
ü—‹_¢­shÙ
 = 
Œue
) {

2395 
DBUG_ASSERT
(
cŞumn_çmy
 !ğ
nuÎ±r
);

2396 
DBUG_ASSERT
(!
»ad_cu¼’t
 || !
ü—‹_¢­shÙ
);

2398 ià(
ü—‹_¢­shÙ
)

2399 
acquœe_¢­shÙ
(
Œue
);

2401 
rocksdb
::
R—dO±iÚs
 
İtiÚs
 = 
m_»ad_İts
;

2403 ià(
sk_bloom_f‹r
) {

2404 
İtiÚs
.
tÙ®_Üd”_£ek
 = 
Œue
;

2405 
İtiÚs
.
™”©e_low”_bound
 = &
eq_cÚd_low”_bound
;

2406 
İtiÚs
.
™”©e_uµ”_bound
 = &
eq_cÚd_uµ”_bound
;

2411 
İtiÚs
.
´efix_§me_as_¡¬t
 = 
Œue
;

2413 
İtiÚs
.
fl_ÿche
 = fill_cache;

2414 ià(
»ad_cu¼’t
) {

2415 
İtiÚs
.
¢­shÙ
 = 
nuÎ±r
;

2417  
g‘_™”©Ü
(
İtiÚs
, 
cŞumn_çmy
);

2420 
vœtu®
 
boŞ
 
is_tx_¡¬‹d
() const = 0;

2421 
vœtu®
 
¡¬t_tx
() = 0;

2422 
vœtu®
 
¡¬t_¡mt
() = 0;

2424 
£t_š™Ÿl_§v•ošt
() {

2430 
do_£t_§v•ošt
();

2431 
m_n_§v•ošts
= 1;

2432 
m_wr™es_©_Ï¡_§v•ošt
ğ
m_wr™e_couÁ
;

2439 
make_¡mt_§v•ošt_³rmª’t
() {

2444 ià(
m_wr™es_©_Ï¡_§v•ošt
 !ğ
m_wr™e_couÁ
)

2446 
do_£t_§v•ošt
();

2447 
m_wr™es_©_Ï¡_§v•ošt
ğ
m_wr™e_couÁ
;

2448 
m_n_§v•ošts
++;

2456 
rŞlback_to_¡mt_§v•ošt
() {

2457 ià(
m_wr™es_©_Ï¡_§v•ošt
 !ğ
m_wr™e_couÁ
) {

2458 
do_rŞlback_to_§v•ošt
();

2459 ià(!--
m_n_§v•ošts
) {

2460 
do_£t_§v•ošt
();

2461 
m_n_§v•ošts
= 1;

2463 
m_wr™es_©_Ï¡_§v•ošt
ğ
m_wr™e_couÁ
;

2467 
vœtu®
 
rŞlback_¡mt
() = 0;

2469 
£t_tx_çed
(
boŞ
 
çed_¬g
è{ 
m_is_tx_çed
 = failed_arg; }

2471 
boŞ
 
ÿn_´•¬e
() const {

2472 ià(
m_rŞlback_Úly
) {

2473 
my_”rÜ
(
ER_ROLLBACK_ONLY
, 
MYF
(0));

2474  
çl£
;

2476  
Œue
;

2479 
rŞlback_to_§v•ošt
(*cÚ¡ 
§v•ošt
) {

2480 ià(
has_modifiÿtiÚs
()) {

2481 
my_”rÜ
(
ER_ROLLBACK_TO_SAVEPOINT
, 
MYF
(0));

2482 
m_rŞlback_Úly
 = 
Œue
;

2483  
HA_EXIT_FAILURE
;

2485  
HA_EXIT_SUCCESS
;

2494 
boŞ
 
is_tx_»ad_Úly
(ècÚ¡ {  
m_tx_»ad_Úly
; }

2496 
boŞ
 
is_two_pha£
(ècÚ¡ {  
m_is_two_pha£
; }

2498 
£t_tx_»ad_Úly
(
boŞ
 
v®
è{ 
m_tx_»ad_Úly
 = val; }

2500 
ex¶ic™
 
Rdb_Œª§ùiÚ
(
THD
 *cÚ¡ 
thd
)

2501 : 
m_thd
(
thd
), 
m_tbl_io_³rf
(
nuÎ±r
) {

2502 
RDB_MUTEX_LOCK_CHECK
(
s_tx_li¡_mu‹x
);

2503 
s_tx_li¡
.
š£¹
(
this
);

2504 
RDB_MUTEX_UNLOCK_CHECK
(
s_tx_li¡_mu‹x
);

2507 
vœtu®
 ~
Rdb_Œª§ùiÚ
() {

2508 
RDB_MUTEX_LOCK_CHECK
(
s_tx_li¡_mu‹x
);

2509 
s_tx_li¡
.
”a£
(
this
);

2510 
RDB_MUTEX_UNLOCK_CHECK
(
s_tx_li¡_mu‹x
);

2523 şas 
	cRdb_Œª§ùiÚ_im¶
 : 
public
 
Rdb_Œª§ùiÚ
 {

2524 
rocksdb
::
T¿n§ùiÚ
 *
m_rocksdb_tx
 = 
nuÎ±r
;

2525 
rocksdb
::
T¿n§ùiÚ
 *
m_rocksdb_»u£_tx
 = 
nuÎ±r
;

2527 
public
:

2528 
£t_lock_timeout
(
timeout_£c_¬g
è
ov”ride
 {

2529 ià(
m_rocksdb_tx
)

2530 
m_rocksdb_tx
->
S‘LockTimeout
(
rdb_cÚv”t_£c_to_ms
(
m_timeout_£c
));

2533 
£t_sync
(
boŞ
 
sync
è
ov”ride
 {

2534 
m_rocksdb_tx
->
G‘Wr™eO±iÚs
()->
sync
 = sync;

2537 
»Ëa£_lock
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2538 cÚ¡ 
¡d
::
¡ršg
 &
rowkey
è
ov”ride
 {

2539 ià(!
THDVAR
(
m_thd
, 
lock_sÿÂed_rows
)) {

2540 
m_rocksdb_tx
->
UndoG‘FÜUpd©e
(
cŞumn_çmy
, 
rocksdb
::
Sliû
(
rowkey
));

2544 
vœtu®
 
boŞ
 
is_wr™eb©ch_Œx
(ècÚ¡ 
ov”ride
 {  
çl£
; }

2546 
´iv©e
:

2547 
»Ëa£_tx
() {

2550 
DBUG_ASSERT
(
m_rocksdb_»u£_tx
 =ğ
nuÎ±r
);

2551 
m_rocksdb_»u£_tx
 = 
m_rocksdb_tx
;

2552 
m_rocksdb_tx
 = 
nuÎ±r
;

2555 
boŞ
 
´•¬e
(cÚ¡ 
rocksdb
::
T¿n§ùiÚName
 &
Çme
è
ov”ride
 {

2556 
rocksdb
::
Stus
 
s
;

2557 
s
 = 
m_rocksdb_tx
->
S‘Name
(
Çme
);

2558 ià(!
s
.
ok
()) {

2559 
rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_TX_COMMIT
);

2560  
çl£
;

2563 
s
 = 
m”ge_auto_šü_m­
(
m_rocksdb_tx
->
G‘Wr™eB©ch
()->GetWriteBatch());

2564 ià(!
s
.
ok
()) {

2565 
rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_TX_COMMIT
);

2566  
çl£
;

2569 
s
 = 
m_rocksdb_tx
->
P»·»
();

2570 ià(!
s
.
ok
()) {

2571 
rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_TX_COMMIT
);

2572  
çl£
;

2574  
Œue
;

2577 
boŞ
 
comm™_no_bšlog
(è
ov”ride
 {

2578 
boŞ
 
»s
 = 
çl£
;

2579 
rocksdb
::
Stus
 
s
;

2581 
s
 = 
m”ge_auto_šü_m­
(
m_rocksdb_tx
->
G‘Wr™eB©ch
()->GetWriteBatch());

2582 ià(!
s
.
ok
()) {

2583 
rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_TX_COMMIT
);

2584 
»s
 = 
Œue
;

2585 
”rÜ
;

2588 
»Ëa£_¢­shÙ
();

2589 
s
 = 
m_rocksdb_tx
->
Comm™
();

2590 ià(!
s
.
ok
()) {

2591 
rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_TX_COMMIT
);

2592 
»s
 = 
Œue
;

2593 
”rÜ
;

2596 
”rÜ
:

2598 
»Ëa£_tx
();

2600 
m_wr™e_couÁ
 = 0;

2601 
m_š£¹_couÁ
 = 0;

2602 
m_upd©e_couÁ
 = 0;

2603 
m_d–‘e_couÁ
 = 0;

2604 
m_lock_couÁ
 = 0;

2605 
£t_tx_»ad_Úly
(
çl£
);

2606 
m_rŞlback_Úly
 = 
çl£
;

2607  
»s
;

2610 
public
:

2611 
rŞlback
(è
ov”ride
 {

2612 
m_wr™e_couÁ
 = 0;

2613 
m_š£¹_couÁ
 = 0;

2614 
m_upd©e_couÁ
 = 0;

2615 
m_d–‘e_couÁ
 = 0;

2616 
m_lock_couÁ
 = 0;

2617 
m_auto_šü_m­
.
ş—r
();

2618 
m_ddl_Œª§ùiÚ
 = 
çl£
;

2619 ià(
m_rocksdb_tx
) {

2620 
»Ëa£_¢­shÙ
();

2622 
m_rocksdb_tx
->
RŞlback
();

2625 
»Ëa£_tx
();

2627 
£t_tx_»ad_Úly
(
çl£
);

2628 
m_rŞlback_Úly
 = 
çl£
;

2632 
acquœe_¢­shÙ
(
boŞ
 
acquœe_now
è
ov”ride
 {

2633 autØ
thd_ss
 = 
¡d
::
¡©ic_poš‹r_ÿ¡
<
Rdb_ex¶ic™_¢­shÙ
>(

2634 
m_thd
->
g‘_ex¶ic™_¢­shÙ
());

2635 ià(
thd_ss
) {

2636 
m_ex¶ic™_¢­shÙ
 = 
thd_ss
;

2638 ià(
m_»ad_İts
.
¢­shÙ
 =ğ
nuÎ±r
) {

2639 ià(
m_ex¶ic™_¢­shÙ
) {

2640 autØ
¢­shÙ
 = 
m_ex¶ic™_¢­shÙ
->
g‘_¢­shÙ
()->snapshot();

2641 
¢­shÙ_ü—‹d
(
¢­shÙ
);

2642 } ià(
is_tx_»ad_Úly
()) {

2643 
¢­shÙ_ü—‹d
(
rdb
->
G‘SÇpshÙ
());

2644 } ià(
acquœe_now
) {

2645 
m_rocksdb_tx
->
S‘SÇpshÙ
();

2646 
¢­shÙ_ü—‹d
(
m_rocksdb_tx
->
G‘SÇpshÙ
());

2647 } ià(!
m_is_d–ayed_¢­shÙ
) {

2648 
m_rocksdb_tx
->
S‘SÇpshÙOnNextO³¿tiÚ
(
m_nÙif›r
);

2649 
m_is_d–ayed_¢­shÙ
 = 
Œue
;

2654 
»Ëa£_¢­shÙ
(è
ov”ride
 {

2655 
boŞ
 
Ãed_ş—r
 = 
m_is_d–ayed_¢­shÙ
;

2657 ià(
m_»ad_İts
.
¢­shÙ
 !ğ
nuÎ±r
) {

2658 
m_¢­shÙ_time¡amp
 = 0;

2659 ià(
m_ex¶ic™_¢­shÙ
) {

2660 
m_ex¶ic™_¢­shÙ
.
»£t
();

2661 
Ãed_ş—r
 = 
çl£
;

2662 } ià(
is_tx_»ad_Úly
()) {

2663 
rdb
->
R–—£SÇpshÙ
(
m_»ad_İts
.
¢­shÙ
);

2664 
Ãed_ş—r
 = 
çl£
;

2666 
Ãed_ş—r
 = 
Œue
;

2668 
m_»ad_İts
.
¢­shÙ
 = 
nuÎ±r
;

2671 ià(
Ãed_ş—r
 && 
m_rocksdb_tx
 !ğ
nuÎ±r
)

2672 
m_rocksdb_tx
->
CË¬SÇpshÙ
();

2675 
boŞ
 
has_¢­shÙ
(è{  
m_»ad_İts
.
¢­shÙ
 !ğ
nuÎ±r
; }

2677 
rocksdb
::
Stus
 
put
Ôocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2678 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

2679 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
è
ov”ride
 {

2680 ++
m_wr™e_couÁ
;

2681 ++
m_lock_couÁ
;

2682 ià(
m_wr™e_couÁ
 > 
m_max_row_locks
 || 
m_lock_couÁ
 > m_max_row_locks)

2683  
rocksdb
::
Stus
::
AbÜ‹d
Ôocksdb::Stus::
kLockLim™
);

2684  
m_rocksdb_tx
->
Put
(
cŞumn_çmy
, 
key
, 
v®ue
);

2687 
rocksdb
::
Stus
 
d–‘e_key
Ôocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2688 cÚ¡ 
rocksdb
::
Sliû
 &
key
è
ov”ride
 {

2689 ++
m_wr™e_couÁ
;

2690 ++
m_lock_couÁ
;

2691 ià(
m_wr™e_couÁ
 > 
m_max_row_locks
 || 
m_lock_couÁ
 > m_max_row_locks)

2692  
rocksdb
::
Stus
::
AbÜ‹d
Ôocksdb::Stus::
kLockLim™
);

2693  
m_rocksdb_tx
->
D–‘e
(
cŞumn_çmy
, 
key
);

2696 
rocksdb
::
Stus


2697 
sšgË_d–‘e
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2698 cÚ¡ 
rocksdb
::
Sliû
 &
key
è
ov”ride
 {

2699 ++
m_wr™e_couÁ
;

2700 ++
m_lock_couÁ
;

2701 ià(
m_wr™e_couÁ
 > 
m_max_row_locks
 || 
m_lock_couÁ
 > m_max_row_locks)

2702  
rocksdb
::
Stus
::
AbÜ‹d
Ôocksdb::Stus::
kLockLim™
);

2703  
m_rocksdb_tx
->
SšgËD–‘e
(
cŞumn_çmy
, 
key
);

2706 
boŞ
 
has_modifiÿtiÚs
(ècÚ¡ 
ov”ride
 {

2707  
m_rocksdb_tx
->
G‘Wr™eB©ch
() &&

2708 
m_rocksdb_tx
->
G‘Wr™eB©ch
()->GetWriteBatch() &&

2709 
m_rocksdb_tx
->
G‘Wr™eB©ch
()->G‘Wr™eB©ch()->
CouÁ
() > 0;

2712 
rocksdb
::
Wr™eB©chBa£
 *
g‘_wr™e_b©ch
(è
ov”ride
 {

2713 ià(
is_two_pha£
()) {

2714  
m_rocksdb_tx
->
G‘Comm™TimeWr™eB©ch
();

2716  
m_rocksdb_tx
->
G‘Wr™eB©ch
()->GetWriteBatch();

2723 
rocksdb
::
Wr™eB©chBa£
 *
g‘_šdexed_wr™e_b©ch
(è
ov”ride
 {

2724 ++
m_wr™e_couÁ
;

2725  
m_rocksdb_tx
->
G‘Wr™eB©ch
();

2728 
rocksdb
::
Stus
 
g‘
Ôocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2729 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

2730 
rocksdb
::
PšÇbËSliû
 *cÚ¡ 
v®ue
ècÚ¡ 
ov”ride
 {

2734 
v®ue
->
Re£t
();

2735 
glob®_¡©s
.
qu”›s
[
QUERIES_POINT
].
šc
();

2736  
m_rocksdb_tx
->
G‘
(
m_»ad_İts
, 
cŞumn_çmy
, 
key
, 
v®ue
);

2739 
rocksdb
::
Stus


2740 
g‘_fÜ_upd©e
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2741 cÚ¡ 
rocksdb
::
Sliû
 &
key
,„ocksdb::
PšÇbËSliû
 *cÚ¡ 
v®ue
,

2742 
boŞ
 
exşusive
è
ov”ride
 {

2743 ià(++
m_lock_couÁ
 > 
m_max_row_locks
)

2744  
rocksdb
::
Stus
::
AbÜ‹d
Ôocksdb::Stus::
kLockLim™
);

2746 ià(
v®ue
 !ğ
nuÎ±r
) {

2747 
v®ue
->
Re£t
();

2749  
m_rocksdb_tx
->
G‘FÜUpd©e
(
m_»ad_İts
, 
cŞumn_çmy
, 
key
, 
v®ue
,

2750 
exşusive
);

2753 
rocksdb
::
I‹¿tÜ
 *

2754 
g‘_™”©Ü
(cÚ¡ 
rocksdb
::
R—dO±iÚs
 &
İtiÚs
,

2755 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
è
ov”ride
 {

2756 
glob®_¡©s
.
qu”›s
[
QUERIES_RANGE
].
šc
();

2757  
m_rocksdb_tx
->
G‘I‹¿tÜ
(
İtiÚs
, 
cŞumn_çmy
);

2760 cÚ¡ 
rocksdb
::
T¿n§ùiÚ
 *
g‘_rdb_Œx
(ècÚ¡ {  
m_rocksdb_tx
; }

2762 
boŞ
 
is_tx_¡¬‹d
(ècÚ¡ 
ov”ride
 {  (
m_rocksdb_tx
 !ğ
nuÎ±r
); }

2764 
¡¬t_tx
(è
ov”ride
 {

2765 
rocksdb
::
T¿n§ùiÚO±iÚs
 
tx_İts
;

2766 
rocksdb
::
Wr™eO±iÚs
 
wr™e_İts
;

2767 
tx_İts
.
£t_¢­shÙ
 = 
çl£
;

2768 
tx_İts
.
lock_timeout
 = 
rdb_cÚv”t_£c_to_ms
(
m_timeout_£c
);

2769 
tx_İts
.
d—dlock_d‘eù
 = 
THDVAR
(
m_thd
, deadlock_detect);

2770 
tx_İts
.
d—dlock_d‘eù_d•th
 = 
THDVAR
(
m_thd
, deadlock_detect_depth);

2773 
tx_İts
.
u£_Úly_the_Ï¡_comm™_time_b©ch_fÜ_»cov”y
 =

2774 
THDVAR
(
m_thd
, 
comm™_time_b©ch_fÜ_»cov”y
);

2775 
tx_İts
.
max_wr™e_b©ch_size
 = 
THDVAR
(
m_thd
, 
wr™e_b©ch_max_by‹s
);

2777 
wr™e_İts
.
sync
 = (
rocksdb_æush_log_©_Œx_comm™
 =ğ
FLUSH_LOG_SYNC
);

2778 
wr™e_İts
.
di§bËWAL
 = 
THDVAR
(
m_thd
, 
wr™e_di§bË_w®
);

2779 
wr™e_İts
.
ignÜe_missšg_cŞumn_çm›s
 =

2780 
THDVAR
(
m_thd
, 
wr™e_ignÜe_missšg_cŞumn_çm›s
);

2781 
m_is_two_pha£
 = 
rocksdb_’abË_2pc
;

2787 
m_rocksdb_tx
 =

2788 
rdb
->
BegšT¿n§ùiÚ
(
wr™e_İts
, 
tx_İts
, 
m_rocksdb_»u£_tx
);

2789 
m_rocksdb_»u£_tx
 = 
nuÎ±r
;

2791 
m_»ad_İts
 = 
rocksdb
::
R—dO±iÚs
();

2793 
£t_š™Ÿl_§v•ošt
();

2795 
m_ddl_Œª§ùiÚ
 = 
çl£
;

2799 
do_£t_§v•ošt
(è
ov”ride
 {

2800 
m_rocksdb_tx
->
S‘SavePošt
();

2803 
do_rŞlback_to_§v•ošt
(è
ov”ride
 {

2804 
m_rocksdb_tx
->
RŞlbackToSavePošt
();

2816 
¡¬t_¡mt
(è
ov”ride
 {

2818 
acquœe_¢­shÙ
(
çl£
);

2825 
rŞlback_¡mt
(è
ov”ride
 {

2827 ià(
m_rocksdb_tx
) {

2828 cÚ¡ 
rocksdb
::
SÇpshÙ
 *cÚ¡ 
Üg_¢­shÙ
 = 
m_rocksdb_tx
->
G‘SÇpshÙ
();

2829 
rŞlback_to_¡mt_§v•ošt
();

2831 cÚ¡ 
rocksdb
::
SÇpshÙ
 *cÚ¡ 
cur_¢­shÙ
 = 
m_rocksdb_tx
->
G‘SÇpshÙ
();

2832 ià(
Üg_¢­shÙ
 !ğ
cur_¢­shÙ
) {

2833 ià(
Üg_¢­shÙ
 !ğ
nuÎ±r
)

2834 
m_¢­shÙ_time¡amp
 = 0;

2836 
m_»ad_İts
.
¢­shÙ
 = 
cur_¢­shÙ
;

2837 ià(
cur_¢­shÙ
 !ğ
nuÎ±r
)

2838 
rdb
->
G‘Env
()->
G‘Cu¼’tTime
(&
m_¢­shÙ_time¡amp
);

2840 
m_is_d–ayed_¢­shÙ
 = 
Œue
;

2845 
ex¶ic™
 
Rdb_Œª§ùiÚ_im¶
(
THD
 *cÚ¡ 
thd
)

2846 : 
Rdb_Œª§ùiÚ
(
thd
), 
m_rocksdb_tx
(
nuÎ±r
) {

2848 
m_nÙif›r
 = 
¡d
::
make_sh¬ed
<
Rdb_¢­shÙ_nÙif›r
>(
this
);

2851 
vœtu®
 ~
Rdb_Œª§ùiÚ_im¶
() {

2852 
rŞlback
();

2857 
m_nÙif›r
->
d‘ach
();

2860 
d–‘e
 
m_rocksdb_»u£_tx
;

2861 
DBUG_ASSERT
(
m_rocksdb_tx
 =ğ
nuÎ±r
);

2873 şas 
	cRdb_wr™eb©ch_im¶
 : 
public
 
Rdb_Œª§ùiÚ
 {

2874 
rocksdb
::
Wr™eB©chW™hIndex
 *
m_b©ch
;

2875 
rocksdb
::
Wr™eO±iÚs
 
wr™e_İts
;

2877 
»£t
() {

2878 
m_b©ch
->
CË¬
();

2879 
m_»ad_İts
 = 
rocksdb
::
R—dO±iÚs
();

2880 
m_ddl_Œª§ùiÚ
 = 
çl£
;

2883 
´iv©e
:

2884 
boŞ
 
´•¬e
(cÚ¡ 
rocksdb
::
T¿n§ùiÚName
 &
Çme
è
ov”ride
 {  
Œue
; }

2886 
boŞ
 
comm™_no_bšlog
(è
ov”ride
 {

2887 
boŞ
 
»s
 = 
çl£
;

2888 
rocksdb
::
Stus
 
s
;

2889 
rocksdb
::
T¿n§ùiÚDBWr™eO±imiz©iÚs
 
İtimize
;

2890 
İtimize
.
sk_cÚcu¼’cy_cÚŒŞ
 = 
Œue
;

2892 
s
 = 
m”ge_auto_šü_m­
(
m_b©ch
->
G‘Wr™eB©ch
());

2893 ià(!
s
.
ok
()) {

2894 
rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_TX_COMMIT
);

2895 
»s
 = 
Œue
;

2896 
”rÜ
;

2899 
»Ëa£_¢­shÙ
();

2901 
s
 = 
rdb
->
Wr™e
(
wr™e_İts
, 
İtimize
, 
m_b©ch
->
G‘Wr™eB©ch
());

2902 ià(!
s
.
ok
()) {

2903 
rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_TX_COMMIT
);

2904 
»s
 = 
Œue
;

2905 
”rÜ
;

2907 
”rÜ
:

2908 
»£t
();

2910 
m_wr™e_couÁ
 = 0;

2911 
m_š£¹_couÁ
 = 0;

2912 
m_upd©e_couÁ
 = 0;

2913 
m_d–‘e_couÁ
 = 0;

2914 
£t_tx_»ad_Úly
(
çl£
);

2915 
m_rŞlback_Úly
 = 
çl£
;

2916  
»s
;

2920 
do_£t_§v•ošt
(è
ov”ride
 {

2921 
m_b©ch
->
S‘SavePošt
();

2924 
do_rŞlback_to_§v•ošt
(è
ov”ride
 {

2925 
m_b©ch
->
RŞlbackToSavePošt
();

2928 
public
:

2929 
boŞ
 
is_wr™eb©ch_Œx
(ècÚ¡ 
ov”ride
 {  
Œue
; }

2931 
£t_lock_timeout
(
timeout_£c_¬g
è
ov”ride
 {

2935 
£t_sync
(
boŞ
 
sync
è
ov”ride
 { 
wr™e_İts
.sync = sync; }

2937 
»Ëa£_lock
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2938 cÚ¡ 
¡d
::
¡ršg
 &
rowkey
è
ov”ride
 {

2942 
rŞlback
(è
ov”ride
 {

2943 
m_wr™e_couÁ
 = 0;

2944 
m_š£¹_couÁ
 = 0;

2945 
m_upd©e_couÁ
 = 0;

2946 
m_d–‘e_couÁ
 = 0;

2947 
m_lock_couÁ
 = 0;

2948 
»Ëa£_¢­shÙ
();

2950 
»£t
();

2951 
£t_tx_»ad_Úly
(
çl£
);

2952 
m_rŞlback_Úly
 = 
çl£
;

2955 
acquœe_¢­shÙ
(
boŞ
 
acquœe_now
è
ov”ride
 {

2956 ià(
m_»ad_İts
.
¢­shÙ
 =ğ
nuÎ±r
)

2957 
¢­shÙ_ü—‹d
(
rdb
->
G‘SÇpshÙ
());

2960 
»Ëa£_¢­shÙ
(è
ov”ride
 {

2961 ià(
m_»ad_İts
.
¢­shÙ
 !ğ
nuÎ±r
) {

2962 
rdb
->
R–—£SÇpshÙ
(
m_»ad_İts
.
¢­shÙ
);

2963 
m_»ad_İts
.
¢­shÙ
 = 
nuÎ±r
;

2967 
rocksdb
::
Stus
 
put
Ôocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2968 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

2969 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
è
ov”ride
 {

2970 ++
m_wr™e_couÁ
;

2971 
m_b©ch
->
Put
(
cŞumn_çmy
, 
key
, 
v®ue
);

2974  
rocksdb
::
Stus
::
OK
();

2977 
rocksdb
::
Stus
 
d–‘e_key
Ôocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2978 cÚ¡ 
rocksdb
::
Sliû
 &
key
è
ov”ride
 {

2979 ++
m_wr™e_couÁ
;

2980 
m_b©ch
->
D–‘e
(
cŞumn_çmy
, 
key
);

2981  
rocksdb
::
Stus
::
OK
();

2984 
rocksdb
::
Stus


2985 
sšgË_d–‘e
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

2986 cÚ¡ 
rocksdb
::
Sliû
 &
key
è
ov”ride
 {

2987 ++
m_wr™e_couÁ
;

2988 
m_b©ch
->
SšgËD–‘e
(
cŞumn_çmy
, 
key
);

2989  
rocksdb
::
Stus
::
OK
();

2992 
boŞ
 
has_modifiÿtiÚs
(ècÚ¡ 
ov”ride
 {

2993  
m_b©ch
->
G‘Wr™eB©ch
()->
CouÁ
() > 0;

2996 
rocksdb
::
Wr™eB©chBa£
 *
g‘_wr™e_b©ch
(è
ov”ride
 {  
m_b©ch
; }

2998 
rocksdb
::
Wr™eB©chBa£
 *
g‘_šdexed_wr™e_b©ch
(è
ov”ride
 {

2999 ++
m_wr™e_couÁ
;

3000  
m_b©ch
;

3003 
rocksdb
::
Stus
 
g‘
Ôocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

3004 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

3005 
rocksdb
::
PšÇbËSliû
 *cÚ¡ 
v®ue
ècÚ¡ 
ov”ride
 {

3006 
v®ue
->
Re£t
();

3007  
m_b©ch
->
G‘FromB©chAndDB
(
rdb
, 
m_»ad_İts
, 
cŞumn_çmy
, 
key
,

3008 
v®ue
);

3011 
rocksdb
::
Stus


3012 
g‘_fÜ_upd©e
(
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

3013 cÚ¡ 
rocksdb
::
Sliû
 &
key
,„ocksdb::
PšÇbËSliû
 *cÚ¡ 
v®ue
,

3014 
boŞ
 
exşusive
è
ov”ride
 {

3015  
g‘
(
cŞumn_çmy
, 
key
, 
v®ue
);

3018 
rocksdb
::
I‹¿tÜ
 *

3019 
g‘_™”©Ü
(cÚ¡ 
rocksdb
::
R—dO±iÚs
 &
İtiÚs
,

3020 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
è
ov”ride
 {

3021 cÚ¡‡utØ
™
 = 
rdb
->
NewI‹¿tÜ
(
İtiÚs
);

3022  
m_b©ch
->
NewI‹¿tÜW™hBa£
(
™
);

3025 
boŞ
 
is_tx_¡¬‹d
(ècÚ¡ 
ov”ride
 {  (
m_b©ch
 !ğ
nuÎ±r
); }

3027 
¡¬t_tx
(è
ov”ride
 {

3028 
»£t
();

3029 
wr™e_İts
.
sync
 = (
rocksdb_æush_log_©_Œx_comm™
 =ğ
FLUSH_LOG_SYNC
);

3030 
wr™e_İts
.
di§bËWAL
 = 
THDVAR
(
m_thd
, 
wr™e_di§bË_w®
);

3031 
wr™e_İts
.
ignÜe_missšg_cŞumn_çm›s
 =

3032 
THDVAR
(
m_thd
, 
wr™e_ignÜe_missšg_cŞumn_çm›s
);

3034 
£t_š™Ÿl_§v•ošt
();

3037 
¡¬t_¡mt
(è
ov”ride
 {}

3039 
rŞlback_¡mt
(è
ov”ride
 {

3040 ià(
m_b©ch
)

3041 
rŞlback_to_¡mt_§v•ošt
();

3044 
ex¶ic™
 
Rdb_wr™eb©ch_im¶
(
THD
 *cÚ¡ 
thd
)

3045 : 
Rdb_Œª§ùiÚ
(
thd
), 
m_b©ch
(
nuÎ±r
) {

3046 
m_b©ch
 = 
Ãw
 
rocksdb
::
Wr™eB©chW™hIndex
Ôocksdb::
By‹wi£Com·¿tÜ
(), 0,

3047 
Œue
);

3050 
vœtu®
 ~
Rdb_wr™eb©ch_im¶
() {

3051 
rŞlback
();

3052 
d–‘e
 
m_b©ch
;

3056 
Rdb_¢­shÙ_nÙif›r
::
	$SÇpshÙC»©ed
(

3057 cÚ¡ 
rocksdb
::
SÇpshÙ
 *cÚ¡ 
¢­shÙ
) {

3058 ià(
m_ownšg_tx
 !ğ
nuÎ±r
) {

3059 
m_ownšg_tx
->
	`¢­shÙ_ü—‹d
(
¢­shÙ
);

3061 
	}
}

3063 
¡d
::
muÉi£t
<
Rdb_Œª§ùiÚ
 *> Rdb_Œª§ùiÚ::
s_tx_li¡
;

3064 
mysql_mu‹x_t
 
Rdb_Œª§ùiÚ
::
s_tx_li¡_mu‹x
;

3066 
Rdb_Œª§ùiÚ
 *&
	$g‘_tx_äom_thd
(
THD
 *cÚ¡ 
thd
) {

3067  *
»š‹½»t_ÿ¡
<
Rdb_Œª§ùiÚ
 **>(

3068 
my_cÜe
::
	`thd_ha_d©a
(
thd
, 
rocksdb_htÚ
));

3069 
	}
}

3071 
Çme¥aû
 {

3073 şas 
	cRdb_³rf_cÚ‹xt_gu¬d
 {

3074 
Rdb_io_³rf
 
m_io_³rf
;

3075 
Rdb_io_³rf
 *
m_io_³rf_±r
;

3076 
Rdb_Œª§ùiÚ
 *
m_tx
;

3077 
ušt
 
m_Ëv–
;

3079 
public
:

3080 
Rdb_³rf_cÚ‹xt_gu¬d
(cÚ¡ Rdb_³rf_cÚ‹xt_gu¬d &èğ
d–‘e
;

3081 
Rdb_³rf_cÚ‹xt_gu¬d
 &
İ”©Ü
=(cÚ¡ Rdb_³rf_cÚ‹xt_gu¬d &èğ
d–‘e
;

3083 
ex¶ic™
 
Rdb_³rf_cÚ‹xt_gu¬d
(
Rdb_io_³rf
 *
io_³rf
, 
ušt
 
Ëv–
)

3084 : 
m_io_³rf_±r
(
io_³rf
), 
m_tx
(
nuÎ±r
), 
m_Ëv–
(
Ëv–
) {

3085 
m_io_³rf_±r
->
¡¬t
(
m_Ëv–
);

3088 
ex¶ic™
 
Rdb_³rf_cÚ‹xt_gu¬d
(
Rdb_Œª§ùiÚ
 *
tx
, 
ušt
 
Ëv–
)

3089 : 
m_io_³rf_±r
(
nuÎ±r
), 
m_tx
(
tx
), 
m_Ëv–
(
Ëv–
) {

3094 ià(
tx
 !ğ
nuÎ±r
) {

3095 
tx
->
io_³rf_¡¬t
(&
m_io_³rf
);

3099 ~
Rdb_³rf_cÚ‹xt_gu¬d
() {

3100 ià(
m_tx
 !ğ
nuÎ±r
) {

3101 
m_tx
->
io_³rf_’d_ªd_»cÜd
();

3102 } ià(
m_io_³rf_±r
 !ğ
nuÎ±r
) {

3103 
m_io_³rf_±r
->
’d_ªd_»cÜd
(
m_Ëv–
);

3114 
Rdb_Œª§ùiÚ
 *
g‘_Ü_ü—‹_tx
(

3115 
THD
 *cÚ¡ 
thd
,

3116 
¡d
::
sh¬ed_±r
<
Rdb_ex¶ic™_¢­shÙ
> 
ex¶ic™_¢­shÙ
 = 
nuÎ±r
) {

3117 
Rdb_Œª§ùiÚ
 *&
tx
 = 
g‘_tx_äom_thd
(
thd
);

3119 ià(
tx
 =ğ
nuÎ±r
) {

3120 ià((
½l_sk_tx_­i
 && 
thd
->
¾i_¦ave
) ||

3121 (
THDVAR
(
thd
, 
ma¡”_sk_tx_­i
è&& !thd->
¾i_¦ave
))

3123 
tx
 = 
Ãw
 
Rdb_wr™eb©ch_im¶
(
thd
);

3127 
tx
 = 
Ãw
 
Rdb_Œª§ùiÚ_im¶
(
thd
);

3129 
tx
->
£t_·¿ms
(
THDVAR
(
thd
, 
lock_wa™_timeout
), THDVARÑhd, 
max_row_locks
));

3130 
tx
->
¡¬t_tx
();

3132 
tx
->
£t_·¿ms
(
THDVAR
(
thd
, 
lock_wa™_timeout
), THDVARÑhd, 
max_row_locks
));

3133 ià(!
tx
->
is_tx_¡¬‹d
()) {

3134 
tx
->
¡¬t_tx
();

3138 ià(
ex¶ic™_¢­shÙ
) {

3139 
tx
->
m_ex¶ic™_¢­shÙ
 = 
ex¶ic™_¢­shÙ
;

3142  
tx
;

3145 
	$rocksdb_şo£_cÚÃùiÚ
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
) {

3146 
Rdb_Œª§ùiÚ
 *&
tx
 = 
	`g‘_tx_äom_thd
(
thd
);

3147 ià(
tx
 !ğ
nuÎ±r
) {

3148 
rc
 = 
tx
->
	`fšish_bulk_lßd
(
çl£
);

3149 ià(
rc
 != 0) {

3151 
	`sql_´št_”rÜ
("RocksDB: Error %d finalizing†ast SST file while "

3153 
rc
);

3156 
d–‘e
 
tx
;

3157 
tx
 = 
nuÎ±r
;

3159  
HA_EXIT_SUCCESS
;

3160 
	}
}

3166 
¡d
::
¡ršg
 
	$rdb_xid_to_¡ršg
(cÚ¡ 
XID
 &
¤c
) {

3167 
	`DBUG_ASSERT
(
¤c
.
gŒid_Ëngth
 >ğ0 && src.gŒid_Ëngth <ğ
MAXGTRIDSIZE
);

3168 
	`DBUG_ASSERT
(
¤c
.
bqu®_Ëngth
 >ğ0 && src.bqu®_Ëngth <ğ
MAXBQUALSIZE
);

3170 
¡d
::
¡ršg
 
buf
;

3171 
buf
.
	`»£rve
(
RDB_XIDHDR_LEN
 + 
¤c
.
gŒid_Ëngth
 + src.
bqu®_Ëngth
);

3177 
uch¬
 
fidbuf
[
RDB_FORMATID_SZ
];

3178 
št64
 
sigÃd_fid8
 = 
¤c
.
fÜm©ID
;

3179 cÚ¡ 
ušt64
 
¿w_fid8
 = *
»š‹½»t_ÿ¡
<ušt64 *>(&
sigÃd_fid8
);

3180 
	`rdb_Ãtbuf_¡Üe_ušt64
(
fidbuf
, 
¿w_fid8
);

3181 
buf
.
	`­³nd
(
»š‹½»t_ÿ¡
<cÚ¡ *>(
fidbuf
), 
RDB_FORMATID_SZ
);

3183 
buf
.
	`push_back
(
¤c
.
gŒid_Ëngth
);

3184 
buf
.
	`push_back
(
¤c
.
bqu®_Ëngth
);

3185 
buf
.
	`­³nd
(
¤c
.
d©a
, (¤c.
gŒid_Ëngth
è+ (¤c.
bqu®_Ëngth
));

3186  
buf
;

3187 
	}
}

3193 
boŞ
 
rocksdb_æush_w®
(
hªdË¹Ú
 *cÚ¡ 
htÚ
 
MY_ATTRIBUTE
((
__unu£d__
)),

3194 
ulÚglÚg
 
rg‘_l¢
 
MY_ATTRIBUTE
((
__unu£d__
))) {

3195 
DBUG_ASSERT
(
rdb
 !ğ
nuÎ±r
);

3197 
rocksdb
::
Stus
 
s
;

3201 ià((
rg‘_l¢
 =ğ0 && !
rocksdb_db_İtiÚs
->
®low_mm­_wr™es
) ||

3202 
rocksdb_æush_log_©_Œx_comm™
 !ğ
FLUSH_LOG_NEVER
) {

3203 
rocksdb_w®_group_syncs
++;

3204 
s
 = 
rdb
->
FlushWAL
(
rg‘_l¢
 == 0 ||

3205 
rocksdb_æush_log_©_Œx_comm™
 =ğ
FLUSH_LOG_SYNC
);

3208 ià(!
s
.
ok
()) {

3209 
rdb_log_¡©us_”rÜ
(
s
);

3210  
HA_EXIT_FAILURE
;

3212  
HA_EXIT_SUCCESS
;

3219 
	$rocksdb_´•¬e
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
,

3220 
boŞ
 
´•¬e_tx
, boŞ 
async
) {

3221 
Rdb_Œª§ùiÚ
 *&
tx
 = 
	`g‘_tx_äom_thd
(
thd
);

3222 ià(!
tx
->
	`ÿn_´•¬e
()) {

3223  
HA_EXIT_FAILURE
;

3225 ià(
´•¬e_tx
 ||

3226 (!
my_cÜe
::
	`thd_‹¡_İtiÚs
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
))) {

3229 
¡d
::
veùÜ
<
¡_¦ave_gtid_šfo
> 
¦ave_gtid_šfo
;

3230 
my_cÜe
::
	`thd_¦ave_gtid_šfo
(
thd
, &
¦ave_gtid_šfo
);

3231 cÚ¡‡utØ&
™
 : 
¦ave_gtid_šfo
) {

3232 
rocksdb
::
Wr™eB©chBa£
 *cÚ¡ 
wr™e_b©ch
 = 
tx
->
	`g‘_blšd_wr™e_b©ch
();

3233 
bšlog_mªag”
.
	`upd©e_¦ave_gtid_šfo
(
™
.
id
, it.
db
, it.
gtid
, 
wr™e_b©ch
);

3236 ià(
tx
->
	`is_two_pha£
()) {

3237 ià(
thd
->
du¿b™y_´İ”ty
 =ğ
HA_IGNORE_DURABILITY
 || 
async
) {

3238 
tx
->
	`£t_sync
(
çl£
);

3240 
XID
 
xid
;

3241 
	`thd_g‘_xid
(
thd
, 
»š‹½»t_ÿ¡
<
MYSQL_XID
 *>(&
xid
));

3242 ià(!
tx
->
	`´•¬e
(
	`rdb_xid_to_¡ršg
(
xid
))) {

3243  
HA_EXIT_FAILURE
;

3245 ià(
thd
->
du¿b™y_´İ”ty
 =ğ
HA_IGNORE_DURABILITY
 &&

3246 (
rocksdb_æush_log_©_Œx_comm™
 !ğ
FLUSH_LOG_NEVER
)) {

3250 
	`thd_¡Üe_l¢
(
thd
, 1, 
DB_TYPE_ROCKSDB
);

3254 
	`DEBUG_SYNC
(
thd
, "rocksdb.prepared");

3257 
tx
->
	`make_¡mt_§v•ošt_³rmª’t
();

3259  
HA_EXIT_SUCCESS
;

3260 
	}
}

3266 
	$rocksdb_comm™_by_xid
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
XID
 *cÚ¡ 
xid
) {

3267 
	`DBUG_ENTER_FUNC
();

3269 
	`DBUG_ASSERT
(
htÚ
 !ğ
nuÎ±r
);

3270 
	`DBUG_ASSERT
(
xid
 !ğ
nuÎ±r
);

3271 
	`DBUG_ASSERT
(
comm™_Ï‹ncy_¡©s
 !ğ
nuÎ±r
);

3273 
rocksdb
::
StİW©chNªo
 
	`tim”
Ôocksdb::
Env
::
	`DeçuÉ
(), 
Œue
);

3275 cÚ¡‡utØ
Çme
 = 
	`rdb_xid_to_¡ršg
(*
xid
);

3276 
	`DBUG_ASSERT
(!
Çme
.
	`em±y
());

3278 
rocksdb
::
T¿n§ùiÚ
 *cÚ¡ 
Œx
 = 
rdb
->
	`G‘T¿n§ùiÚByName
(
Çme
);

3280 ià(
Œx
 =ğ
nuÎ±r
) {

3281 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

3284 cÚ¡ 
rocksdb
::
Stus
 
s
 = 
Œx
->
	`Comm™
();

3286 ià(!
s
.
	`ok
()) {

3287 
	`rdb_log_¡©us_”rÜ
(
s
);

3288 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

3291 
d–‘e
 
Œx
;

3294 
comm™_Ï‹ncy_¡©s
->
	`Add
(
tim”
.
	`EÏp£dNªos
() / 1000);

3296 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

3297 
	}
}

3300 
rocksdb_rŞlback_by_xid
(
hªdË¹Ú
 *cÚ¡ 
htÚ
 
MY_ATTRIBUTE
((
__unu£d__
)),

3301 
XID
 *cÚ¡ 
xid
) {

3302 
DBUG_ENTER_FUNC
();

3304 
DBUG_ASSERT
(
htÚ
 !ğ
nuÎ±r
);

3305 
DBUG_ASSERT
(
xid
 !ğ
nuÎ±r
);

3306 
DBUG_ASSERT
(
rdb
 !ğ
nuÎ±r
);

3308 cÚ¡‡utØ
Çme
 = 
rdb_xid_to_¡ršg
(*
xid
);

3310 
rocksdb
::
T¿n§ùiÚ
 *cÚ¡ 
Œx
 = 
rdb
->
G‘T¿n§ùiÚByName
(
Çme
);

3312 ià(
Œx
 =ğ
nuÎ±r
) {

3313 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

3316 cÚ¡ 
rocksdb
::
Stus
 
s
 = 
Œx
->
RŞlback
();

3318 ià(!
s
.
ok
()) {

3319 
rdb_log_¡©us_”rÜ
(
s
);

3320 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

3323 
d–‘e
 
Œx
;

3325 
DBUG_RETURN
(
HA_EXIT_SUCCESS
);

3331 
	$rdb_xid_äom_¡ršg
(cÚ¡ 
¡d
::
¡ršg
 &
¤c
, 
XID
 *cÚ¡ 
d¡
) {

3332 
	`DBUG_ASSERT
(
d¡
 !ğ
nuÎ±r
);

3333 
ušt
 
off£t
 = 0;

3334 
ušt64
 
¿w_fid8
 =

3335 
	`rdb_Ãtbuf_to_ušt64
(
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
¤c
.
	`d©a
()));

3336 cÚ¡ 
št64
 
sigÃd_fid8
 = *
»š‹½»t_ÿ¡
<št64 *>(&
¿w_fid8
);

3337 
d¡
->
fÜm©ID
 = 
sigÃd_fid8
;

3338 
off£t
 +ğ
RDB_FORMATID_SZ
;

3339 
d¡
->
gŒid_Ëngth
 = 
¤c
.
	`©
(
off£t
);

3340 
off£t
 +ğ
RDB_GTRID_SZ
;

3341 
d¡
->
bqu®_Ëngth
 = 
¤c
.
	`©
(
off£t
);

3342 
off£t
 +ğ
RDB_BQUAL_SZ
;

3344 
	`DBUG_ASSERT
(
d¡
->
gŒid_Ëngth
 >ğ0 && d¡->gŒid_Ëngth <ğ
MAXGTRIDSIZE
);

3345 
	`DBUG_ASSERT
(
d¡
->
bqu®_Ëngth
 >ğ0 && d¡->bqu®_Ëngth <ğ
MAXBQUALSIZE
);

3347 
¤c
.
	`cİy
(
d¡
->
d©a
, (d¡->
gŒid_Ëngth
è+ (d¡->
bqu®_Ëngth
),

3348 
RDB_XIDHDR_LEN
);

3349 
	}
}

3355 
	$rocksdb_»cov”
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
XID
 *cÚ¡ 
xid_li¡
,

3356 
ušt
 
Ën
, *cÚ¡ 
bšlog_fe
,

3357 
my_off_t
 *cÚ¡ 
bšlog_pos
,

3358 
Gtid
 *cÚ¡ 
bšlog_max_gtid
) {

3359 ià(
bšlog_fe
 && 
bšlog_pos
) {

3360 
fe_buf
[
FN_REFLEN
 + 1] = {0};

3361 
my_off_t
 
pos
;

3362 
gtid_buf
[
FN_REFLEN
 + 1] = {0};

3363 ià(
bšlog_mªag”
.
	`»ad
(
fe_buf
, &
pos
, 
gtid_buf
)) {

3364 ià(
	`is_bšlog_advªûd
(
bšlog_fe
, *
bšlog_pos
, 
fe_buf
, 
pos
)) {

3365 
	`memıy
(
bšlog_fe
, 
fe_buf
, 
FN_REFLEN
 + 1);

3366 *
bšlog_pos
 = 
pos
;

3367 
	`årštf
(
¡d”r
, "RocksDB: Last binlog file…osition %llu,"

3369 
pos
, 
fe_buf
);

3370 ià(*
gtid_buf
) {

3371 
glob®_sid_lock
->
	`rdlock
();

3372 
bšlog_max_gtid
->
	`·r£
(
glob®_sid_m­
, 
gtid_buf
);

3373 
glob®_sid_lock
->
	`uÆock
();

3374 
	`årštf
(
¡d”r
, "RocksDB: La¡ MySQL Gtid %s\n", 
gtid_buf
);

3380 ià(
Ën
 =ğ0 || 
xid_li¡
 =ğ
nuÎ±r
) {

3381  
HA_EXIT_SUCCESS
;

3384 
¡d
::
veùÜ
<
rocksdb
::
T¿n§ùiÚ
 *> 
Œªs_li¡
;

3385 
rdb
->
	`G‘AÎP»·»dT¿n§ùiÚs
(&
Œªs_li¡
);

3387 
ušt
 
couÁ
 = 0;

3388 autØ&
Œªs
 : 
Œªs_li¡
) {

3389 ià(
couÁ
 >ğ
Ën
) {

3392 autØ
Çme
 = 
Œªs
->
	`G‘Name
();

3393 
	`rdb_xid_äom_¡ršg
(
Çme
, &
xid_li¡
[
couÁ
]);

3394 
couÁ
++;

3396  
couÁ
;

3397 
	}
}

3399 
	$rocksdb_comm™
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
,

3400 
boŞ
 
comm™_tx
, bool) {

3401 
	`DBUG_ENTER_FUNC
();

3403 
	`DBUG_ASSERT
(
htÚ
 !ğ
nuÎ±r
);

3404 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

3405 
	`DBUG_ASSERT
(
comm™_Ï‹ncy_¡©s
 !ğ
nuÎ±r
);

3407 
rocksdb
::
StİW©chNªo
 
	`tim”
Ôocksdb::
Env
::
	`DeçuÉ
(), 
Œue
);

3410 
Rdb_Œª§ùiÚ
 *&
tx
 = 
	`g‘_tx_äom_thd
(
thd
);

3413 
Rdb_³rf_cÚ‹xt_gu¬d
 
	`gu¬d
(
tx
, 
	`rocksdb_³rf_cÚ‹xt_Ëv–
(
thd
));

3415 ià(
tx
 !ğ
nuÎ±r
) {

3416 ià(
comm™_tx
 || (!
my_cÜe
::
	`thd_‹¡_İtiÚs
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 |

3417 
OPTION_BEGIN
))) {

3423 ià(
tx
->
	`comm™
()) {

3424 
	`DBUG_RETURN
(
HA_ERR_ROCKSDB_COMMIT_FAILED
);

3430 
tx
->
	`£t_tx_çed
(
çl£
);

3431 
tx
->
	`make_¡mt_§v•ošt_³rmª’t
();

3434 ià(
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
thd
è<ğ
ISO_READ_COMMITTED
) {

3437 
tx
->
	`»Ëa£_¢­shÙ
();

3442 
comm™_Ï‹ncy_¡©s
->
	`Add
(
tim”
.
	`EÏp£dNªos
() / 1000);

3444 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

3445 
	}
}

3447 
	$rocksdb_rŞlback
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
,

3448 
boŞ
 
rŞlback_tx
) {

3449 
Rdb_Œª§ùiÚ
 *&
tx
 = 
	`g‘_tx_äom_thd
(
thd
);

3450 
Rdb_³rf_cÚ‹xt_gu¬d
 
	`gu¬d
(
tx
, 
	`rocksdb_³rf_cÚ‹xt_Ëv–
(
thd
));

3452 ià(
tx
 !ğ
nuÎ±r
) {

3453 ià(
rŞlback_tx
) {

3460 
tx
->
	`rŞlback
();

3469 
tx
->
	`rŞlback_¡mt
();

3470 
tx
->
	`£t_tx_çed
(
Œue
);

3473 ià(
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
thd
è<ğ
ISO_READ_COMMITTED
) {

3476 
tx
->
	`»Ëa£_¢­shÙ
();

3479  
HA_EXIT_SUCCESS
;

3480 
	}
}

3482 
boŞ
 
	$´št_¡©s
(
THD
 *cÚ¡ 
thd
, 
¡d
::
¡ršg
 cÚ¡ &
ty³
,

3483 
¡d
::
¡ršg
 cÚ¡ &
Çme
, std::¡ršg cÚ¡ &
¡©us
,

3484 
¡©_´št_â
 *
¡©_´št
) {

3485  
	`¡©_´št
(
thd
, 
ty³
.
	`c_¡r
(),y³.
	`size
(), 
Çme
.c_str(),‚ame.size(),

3486 
¡©us
.
	`c_¡r
(), stus.
	`size
());

3487 
	}
}

3489 
¡d
::
¡ršg
 
	$fÜm©_¡ršg
(cÚ¡ *cÚ¡ 
fÜm©
, ...) {

3490 
¡d
::
¡ršg
 
»s
;

3491 
va_li¡
 
¬gs
;

3492 
va_li¡
 
¬gs_cİy
;

3493 
¡©ic_buff
[256];

3495 
	`DBUG_ASSERT
(
fÜm©
 !ğ
nuÎ±r
);

3497 
	`va_¡¬t
(
¬gs
, 
fÜm©
);

3498 
	`va_cİy
(
¬gs_cİy
, 
¬gs
);

3501 
Ën
 = 
	`v¢´štf
(
nuÎ±r
, 0, 
fÜm©
, 
¬gs
);

3502 
	`va_’d
(
¬gs
);

3504 ià(
Ën
 < 0) {

3505 
»s
 = 
¡d
::
	`¡ršg
("<formatƒrror>");

3506 } ià(
Ën
 == 0) {

3508 
»s
 = 
¡d
::
	`¡ršg
("");

3511 *
buff
 = 
¡©ic_buff
;

3512 
¡d
::
unique_±r
<[]> 
dyÇmic_buff
 = 
nuÎ±r
;

3514 
Ën
++;

3517 ià(
¡©ic_ÿ¡
<
ušt
>(
Ën
è> (
¡©ic_buff
)) {

3518 
dyÇmic_buff
.
	`»£t
(
Ãw
 [
Ën
]);

3519 
buff
 = 
dyÇmic_buff
.
	`g‘
();

3523 ()
	`v¢´štf
(
buff
, 
Ën
, 
fÜm©
, 
¬gs_cİy
);

3530 
»s
 = 
¡d
::
	`¡ršg
(
buff
);

3533 
	`va_’d
(
¬gs_cİy
);

3535  
»s
;

3536 
	}
}

3538 şas 
	cRdb_¢­shÙ_¡©us
 : 
public
 
Rdb_tx_li¡_w®k”
 {

3539 
´iv©e
:

3540 
¡d
::
¡ršg
 
m_d©a
;

3542 
¡d
::
¡ršg
 
cu¼’t_time¡amp
() {

3543 cÚ¡ *cÚ¡ 
fÜm©
 = "%d-%02d-%02d %02d:%02d:%02d";

3544 
time_t
 
cu¼time
;

3545 
tm
 
cu¼tm
;

3547 
time
(&
cu¼time
);

3549 
loÿÉime_r
(&
cu¼time
, &
cu¼tm
);

3551  
fÜm©_¡ršg
(
fÜm©
, 
cu¼tm
.
tm_y—r
 + 1900, cu¼tm.
tm_mÚ
 + 1,

3552 
cu¼tm
.
tm_mday
, cu¼tm.
tm_hour
, cu¼tm.
tm_mš
,

3553 
cu¼tm
.
tm_£c
);

3556 
¡d
::
¡ršg
 
g‘_h—d”
() {

3558 
cu¼’t_time¡amp
() +

3567 
¡d
::
¡ršg
 
g‘_foÙ”
() {

3573 
Rdb_d—dlock_šfo
::
Rdb_dl_Œx_šfo


3574 
g‘_dl_txn_šfo
(cÚ¡ 
rocksdb
::
D—dlockInfo
 &
txn
,

3575 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) {

3576 
Rdb_d—dlock_šfo
::
Rdb_dl_Œx_šfo
 
txn_d©a
;

3578 
txn_d©a
.
Œx_id
 = 
txn
.
m_txn_id
;

3580 
txn_d©a
.
bË_Çme
 = 
ddl_mªag”
.
§ã_g‘_bË_Çme
(
gl_šdex_id
);

3581 ià(
txn_d©a
.
bË_Çme
.
em±y
()) {

3582 
txn_d©a
.
bË_Çme
 =

3583 "NOT FOUND; INDEX_ID: " + 
¡d
::
to_¡ršg
(
gl_šdex_id
.
šdex_id
);

3586 autØ
kd
 = 
ddl_mªag”
.
§ã_fšd
(
gl_šdex_id
);

3587 
txn_d©a
.
šdex_Çme
 =

3588 (
kd
è? kd->
g‘_Çme
()

3589 : "NOT FOUND; INDEX_ID: " + 
¡d
::
to_¡ršg
(
gl_šdex_id
.
šdex_id
);

3591 
rocksdb
::
CŞumnFamyHªdË
 *
cfh
 = 
cf_mªag”
.
g‘_cf
(
txn
.
m_cf_id
);

3592 
txn_d©a
.
cf_Çme
 = 
cfh
->
G‘Name
();

3594 
txn_d©a
.
wa™šg_key
 =

3595 
rdb_hexdump
(
txn
.
m_wa™šg_key
.
c_¡r
(),xn.m_wa™šg_key.
Ëngth
());

3597 
txn_d©a
.
exşusive_lock
 = 
txn
.
m_exşusive
;

3599  
txn_d©a
;

3602 
Rdb_d—dlock_šfo


3603 
g‘_dl_·th_Œx_šfo
(cÚ¡ 
rocksdb
::
D—dlockP©h
 &
·th_’Œy
) {

3604 
Rdb_d—dlock_šfo
 
d—dlock_šfo
;

3606 autØ
™
 = 
·th_’Œy
.
·th
.
begš
(); iˆ!ğ·th_’Œy.·th.
’d
();

3607 
™
++) {

3608 autØ
txn
 = *
™
;

3609 cÚ¡ 
GL_INDEX_ID
 
gl_šdex_id
 = {

3610 
txn
.
m_cf_id
, 
rdb_Ãtbuf_to_ušt32
(
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(

3611 
txn
.
m_wa™šg_key
.
c_¡r
()))};

3612 
d—dlock_šfo
.
·th
.
push_back
(
g‘_dl_txn_šfo
(
txn
, 
gl_šdex_id
));

3614 
DBUG_ASSERT_IFF
(
·th_’Œy
.
lim™_exûeded
,…©h_’Œy.
·th
.
em±y
());

3616 ià(!
·th_’Œy
.
·th
.
em±y
(è&& !·th_’Œy.
lim™_exûeded
) {

3617 autØ
d—dlockšg_txn
 = *(
·th_’Œy
.
·th
.
’d
() - 1);

3618 
d—dlock_šfo
.
viùim_Œx_id
 = 
d—dlockšg_txn
.
m_txn_id
;

3620  
d—dlock_šfo
;

3623 
public
:

3624 
Rdb_¢­shÙ_¡©us
(è: 
m_d©a
(
g‘_h—d”
()) {}

3626 
¡d
::
¡ršg
 
g‘ResuÉ
(è{  
m_d©a
 + 
g‘_foÙ”
(); }

3630 
´oûss_Œª
(cÚ¡ 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
è
ov”ride
 {

3631 
DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

3634 
št64_t
 
¢­shÙ_time¡amp
 = 
tx
->
m_¢­shÙ_time¡amp
;

3635 ià(
¢­shÙ_time¡amp
 != 0) {

3636 
št64_t
 
cu¼_time
;

3637 
rdb
->
G‘Env
()->
G‘Cu¼’tTime
(&
cu¼_time
);

3639 
THD
 *
thd
 = 
tx
->
g‘_thd
();

3640 
bufãr
[1024];

3641 
thd_£cur™y_cÚ‹xt
(
thd
, 
bufãr
,  buffer, 0);

3642 
m_d©a
 +ğ
fÜm©_¡ršg
(

3647 
cu¼_time
 - 
¢­shÙ_time¡amp
, 
bufãr
, 
tx
->
g‘_lock_couÁ
(),

3648 
tx
->
g‘_wr™e_couÁ
(),x->
g‘_š£¹_couÁ
(),x->
g‘_upd©e_couÁ
(),

3649 
tx
->
g‘_d–‘e_couÁ
());

3653 
pİuÏ‹_d—dlock_bufãr
() {

3654 autØ
dlock_bufãr
 = 
rdb
->
G‘D—dlockInfoBufãr
();

3655 
m_d©a
 += "----------LATEST DETECTED DEADLOCKS----------\n";

3657 autØ
·th_’Œy
 : 
dlock_bufãr
) {

3658 
¡d
::
¡ršg
 
·th_d©a
;

3659 ià(
·th_’Œy
.
lim™_exûeded
) {

3660 
·th_d©a
 += "\n-------DEADLOCK EXCEEDED MAX DEPTH-------\n";

3662 
·th_d©a
 += "\n*** DEADLOCK PATH\n"

3664 cÚ¡‡utØ
dl_šfo
 = 
g‘_dl_·th_Œx_šfo
(
·th_’Œy
);

3665 autØ
™
 = 
dl_šfo
.
·th
.
begš
(); iˆ!ğdl_šfo.·th.
’d
(); it++) {

3666 cÚ¡‡utØ
Œx_šfo
 = *
™
;

3667 
·th_d©a
 +ğ
fÜm©_¡ršg
(

3674 
Œx_šfo
.
Œx_id
,rx_šfo.
cf_Çme
.
c_¡r
(),

3675 
Œx_šfo
.
wa™šg_key
.
c_¡r
(),

3676 
Œx_šfo
.
exşusive_lock
 ? "EXCLUSIVE" : "SHARED",

3677 
Œx_šfo
.
šdex_Çme
.
c_¡r
(),rx_šfo.
bË_Çme
.c_str());

3678 ià(
™
 !ğ
dl_šfo
.
·th
.
’d
() - 1) {

3679 
·th_d©a
 += "---------------WAITING FOR---------------\n";

3682 
·th_d©a
 +=

3683 
fÜm©_¡ršg
("\n--------TRANSACTION ID: %u GOT DEADLOCK---------\n",

3684 
dl_šfo
.
viùim_Œx_id
);

3686 
m_d©a
 +ğ
·th_d©a
;

3690 
¡d
::
veùÜ
<
Rdb_d—dlock_šfo
> 
g‘_d—dlock_šfo
() {

3691 
¡d
::
veùÜ
<
Rdb_d—dlock_šfo
> 
d—dlock_šfo
;

3692 autØ
dlock_bufãr
 = 
rdb
->
G‘D—dlockInfoBufãr
();

3693 autØ
·th_’Œy
 : 
dlock_bufãr
) {

3694 ià(!
·th_’Œy
.
lim™_exûeded
) {

3695 
d—dlock_šfo
.
push_back
(
g‘_dl_·th_Œx_šfo
(
·th_’Œy
));

3698  
d—dlock_šfo
;

3707 şas 
	cRdb_Œx_šfo_agg»g©Ü
 : 
public
 
Rdb_tx_li¡_w®k”
 {

3708 
´iv©e
:

3709 
¡d
::
veùÜ
<
Rdb_Œx_šfo
> *
m_Œx_šfo
;

3711 
public
:

3712 
ex¶ic™
 
Rdb_Œx_šfo_agg»g©Ü
(
¡d
::
veùÜ
<
Rdb_Œx_šfo
> *cÚ¡ 
Œx_šfo
)

3713 : 
m_Œx_šfo
(
Œx_šfo
) {}

3715 
´oûss_Œª
(cÚ¡ 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
è
ov”ride
 {

3716 cÚ¡ 
¡d
::
m­
<, std::
¡ršg
> 
¡©e_m­
 = {

3717 {
rocksdb
::
T¿n§ùiÚ
::
STARTED
, "STARTED"},

3718 {
rocksdb
::
T¿n§ùiÚ
::
AWAITING_PREPARE
, "AWAITING_PREPARE"},

3719 {
rocksdb
::
T¿n§ùiÚ
::
PREPARED
, "PREPARED"},

3720 {
rocksdb
::
T¿n§ùiÚ
::
AWAITING_COMMIT
, "AWAITING_COMMIT"},

3721 {
rocksdb
::
T¿n§ùiÚ
::
COMMITED
, "COMMITED"},

3722 {
rocksdb
::
T¿n§ùiÚ
::
AWAITING_ROLLBACK
, "AWAITING_ROLLBACK"},

3723 {
rocksdb
::
T¿n§ùiÚ
::
ROLLEDBACK
, "ROLLEDBACK"},

3726 
DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

3728 
THD
 *cÚ¡ 
thd
 = 
tx
->
g‘_thd
();

3729 
ulÚg
 
th»ad_id
 = 
thd_th»ad_id
(
thd
);

3731 ià(
tx
->
is_wr™eb©ch_Œx
()) {

3732 cÚ¡‡utØ
wb_im¶
 = 
¡©ic_ÿ¡
<cÚ¡ 
Rdb_wr™eb©ch_im¶
 *>(
tx
);

3733 
DBUG_ASSERT
(
wb_im¶
);

3734 
m_Œx_šfo
->
push_back
(

3737 
wb_im¶
->
g‘_wr™e_couÁ
(), 0,

3744 
wb_im¶
->
is_tx_»ad_Úly
(), 0,

3745 
wb_im¶
->
num_Úgošg_bulk_lßd
(), 
th»ad_id
, "" });

3747 cÚ¡‡utØ
tx_im¶
 = 
¡©ic_ÿ¡
<cÚ¡ 
Rdb_Œª§ùiÚ_im¶
 *>(
tx
);

3748 
DBUG_ASSERT
(
tx_im¶
);

3749 cÚ¡ 
rocksdb
::
T¿n§ùiÚ
 *
rdb_Œx
 = 
tx_im¶
->
g‘_rdb_Œx
();

3751 ià(
rdb_Œx
 =ğ
nuÎ±r
) {

3755 
¡d
::
¡ršg
 
qu”y_¡r
;

3756 
LEX_STRING
 *cÚ¡ 
Ëx_¡r
 = 
thd_qu”y_¡ršg
(
thd
);

3757 ià(
Ëx_¡r
 !ğ
nuÎ±r
 &&†ex_¡r->
¡r
 !=‚ullptr) {

3758 
qu”y_¡r
 = 
¡d
::
¡ršg
(
Ëx_¡r
->
¡r
);

3761 cÚ¡‡utØ
¡©e_™
 = 
¡©e_m­
.
fšd
(
rdb_Œx
->
G‘S‹
());

3762 
DBUG_ASSERT
(
¡©e_™
 !ğ
¡©e_m­
.
’d
());

3763 cÚ¡ 
is_»¶iÿtiÚ
 = (
thd
->
¾i_¦ave
 !ğ
nuÎ±r
);

3764 
ušt32_t
 
wa™šg_cf_id
;

3765 
¡d
::
¡ršg
 
wa™šg_key
;

3766 
rdb_Œx
->
G‘Wa™šgTxns
(&
wa™šg_cf_id
, &
wa™šg_key
),

3768 
m_Œx_šfo
->
push_back
(

3769 {
rdb_Œx
->
G‘Name
(),„db_Œx->
G‘ID
(), 
tx_im¶
->
g‘_wr™e_couÁ
(),

3770 
tx_im¶
->
g‘_lock_couÁ
(),x_im¶->
g‘_timeout_£c
(),

3771 
¡©e_™
->
£cÚd
, 
wa™šg_key
, 
wa™šg_cf_id
, 
is_»¶iÿtiÚ
,

3773 
tx_im¶
->
is_tx_»ad_Úly
(), 
rdb_Œx
->
IsD—dlockD‘eù
(),

3774 
tx_im¶
->
num_Úgošg_bulk_lßd
(), 
th»ad_id
, 
qu”y_¡r
});

3783 
¡d
::
veùÜ
<
Rdb_Œx_šfo
> 
	$rdb_g‘_®l_Œx_šfo
() {

3784 
¡d
::
veùÜ
<
Rdb_Œx_šfo
> 
Œx_šfo
;

3785 
Rdb_Œx_šfo_agg»g©Ü
 
	`Œx_šfo_agg
(&
Œx_šfo
);

3786 
Rdb_Œª§ùiÚ
::
	`w®k_tx_li¡
(&
Œx_šfo_agg
);

3787  
Œx_šfo
;

3788 
	}
}

3794 
¡d
::
veùÜ
<
Rdb_d—dlock_šfo
> 
	$rdb_g‘_d—dlock_šfo
() {

3795 
Rdb_¢­shÙ_¡©us
 
showStus
;

3796 
Rdb_Œª§ùiÚ
::
	`w®k_tx_li¡
(&
showStus
);

3797  
showStus
.
	`g‘_d—dlock_šfo
();

3798 
	}
}

3801 
boŞ
 
	$rocksdb_show_¢­shÙ_¡©us
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
,

3802 
¡©_´št_â
 *cÚ¡ 
¡©_´št
) {

3803 
Rdb_¢­shÙ_¡©us
 
showStus
;

3805 
Rdb_Œª§ùiÚ
::
	`w®k_tx_li¡
(&
showStus
);

3806 
showStus
.
	`pİuÏ‹_d—dlock_bufãr
();

3809  
	`´št_¡©s
(
thd
, "rocksdb", "", 
showStus
.
	`g‘ResuÉ
(), 
¡©_´št
);

3810 
	}
}

3818 
boŞ
 
	$rocksdb_show_¡©us
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
,

3819 
¡©_´št_â
 *cÚ¡ 
¡©_´št
,

3820 
ha_¡©_ty³
 
¡©_ty³
) {

3821 
	`DBUG_ASSERT
(
htÚ
 !ğ
nuÎ±r
);

3822 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

3823 
	`DBUG_ASSERT
(
¡©_´št
 !ğ
nuÎ±r
);

3825 
boŞ
 
»s
 = 
çl£
;

3826 
buf
[100] = {'\0'};

3828 ià(
¡©_ty³
 =ğ
HA_ENGINE_STATUS
) {

3829 
	`DBUG_ASSERT
(
rdb
 !ğ
nuÎ±r
);

3831 
¡d
::
¡ršg
 
¡r
;

3834 ià(
rocksdb_¡©s
) {

3835 
¡r
 = 
rocksdb_¡©s
->
	`ToSŒšg
();

3839 
	`DBUG_ASSERT
(
comm™_Ï‹ncy_¡©s
 !ğ
nuÎ±r
);

3841 
	`¢´štf
(
buf
, (buf), "rocksdb.commit_latency statistics "

3844 
comm™_Ï‹ncy_¡©s
->
	`P”ûÁe
(50),

3845 
comm™_Ï‹ncy_¡©s
->
	`P”ûÁe
(95),

3846 
comm™_Ï‹ncy_¡©s
->
	`P”ûÁe
(99),

3847 
comm™_Ï‹ncy_¡©s
->
	`P”ûÁe
(100));

3848 
¡r
.
	`­³nd
(
buf
);

3850 
ušt64_t
 
v
 = 0;

3859 ià(
rdb
->
	`G‘IÁPrİ”ty
("rocksdb.is-wr™e-¡İ³d", &
v
)) {

3860 
	`¢´štf
(
buf
, (buf), "rocksdb.is_wr™e_¡İ³d COUNT : %lu\n", 
v
);

3861 
¡r
.
	`­³nd
(
buf
);

3864 ià(
rdb
->
	`G‘IÁPrİ”ty
("rocksdb.aùu®-d–ayed-wr™e-¿‹", &
v
)) {

3865 
	`¢´štf
(
buf
, (buf), "rocksdb.actual_delayed_write_rate "

3867 
v
);

3868 
¡r
.
	`­³nd
(
buf
);

3871 
»s
 |ğ
	`´št_¡©s
(
thd
, "STATISTICS", "rocksdb", 
¡r
, 
¡©_´št
);

3875 ià(
rdb
->
	`G‘Prİ”ty
("rocksdb.db¡©s", &
¡r
)) {

3876 
»s
 |ğ
	`´št_¡©s
(
thd
, "DBSTATS", "rocksdb", 
¡r
, 
¡©_´št
);

3880 cÚ¡‡utØ&
cf_Çme
 : 
cf_mªag”
.
	`g‘_cf_Çmes
()) {

3881 
rocksdb
::
CŞumnFamyHªdË
 *
cfh
 = 
cf_mªag”
.
	`g‘_cf
(
cf_Çme
);

3882 ià(
cfh
 =ğ
nuÎ±r
) {

3886 ià(!
rdb
->
	`G‘Prİ”ty
(
cfh
, "rocksdb.cf¡©s", &
¡r
)) {

3890 
»s
 |ğ
	`´št_¡©s
(
thd
, "CF_COMPACTION", 
cf_Çme
, 
¡r
, 
¡©_´št
);

3894 
¡d
::
veùÜ
<
rocksdb
::
DB
 *> 
dbs
;

3895 
¡d
::
unÜd”ed_£t
<cÚ¡ 
rocksdb
::
Cache
 *> 
ÿche_£t
;

3896 
size_t
 
š‹º®_ÿche_couÁ
 = 0;

3897 
size_t
 
kDeçuÉIÁ”ÇlCacheSize
 = 8 * 1024 * 1024;

3899 
dbs
.
	`push_back
(
rdb
);

3900 
ÿche_£t
.
	`š£¹
(
rocksdb_tbl_İtiÚs
->
block_ÿche
.
	`g‘
());

3902 cÚ¡‡utØ&
cf_hªdË
 : 
cf_mªag”
.
	`g‘_®l_cf
()) {

3903 
rocksdb
::
CŞumnFamyDesütÜ
 
cf_desc
;

3904 
cf_hªdË
->
	`G‘DesütÜ
(&
cf_desc
);

3905 autØ*cÚ¡ 
bË_çùÜy
 = 
cf_desc
.
İtiÚs
.bË_çùÜy.
	`g‘
();

3907 ià(
bË_çùÜy
 !ğ
nuÎ±r
) {

3908 
¡d
::
¡ršg
 
tf_Çme
 = 
bË_çùÜy
->
	`Name
();

3910 ià(
tf_Çme
.
	`fšd
("BlockBa£dTabË"è!ğ
¡d
::
¡ršg
::
Åos
) {

3911 cÚ¡ 
rocksdb
::
BlockBa£dTabËO±iÚs
 *cÚ¡ 
bbt_İt
 =

3912 
»š‹½»t_ÿ¡
<
rocksdb
::
BlockBa£dTabËO±iÚs
 *>(

3913 
bË_çùÜy
->
	`G‘O±iÚs
());

3915 ià(
bbt_İt
 !ğ
nuÎ±r
) {

3916 ià(
bbt_İt
->
block_ÿche
.
	`g‘
(è!ğ
nuÎ±r
) {

3917 
ÿche_£t
.
	`š£¹
(
bbt_İt
->
block_ÿche
.
	`g‘
());

3919 
š‹º®_ÿche_couÁ
++;

3921 
ÿche_£t
.
	`š£¹
(
bbt_İt
->
block_ÿche_com´es£d
.
	`g‘
());

3927 
¡d
::
m­
<
rocksdb
::
MemÜyUt
::
U§geTy³
, 
ušt64_t
> 
‹mp_u§ge_by_ty³
;

3928 
¡r
.
	`ş—r
();

3929 
rocksdb
::
MemÜyUt
::
	`G‘Aµroxim©eMemÜyU§geByTy³
(
dbs
, 
ÿche_£t
,

3930 &
‹mp_u§ge_by_ty³
);

3932 
	`¢´štf
(
buf
, (buf), "\nMemTable Total: %lu",

3933 
‹mp_u§ge_by_ty³
[
rocksdb
::
MemÜyUt
::
kMemTabËTÙ®
]);

3934 
¡r
.
	`­³nd
(
buf
);

3935 
	`¢´štf
(
buf
, (buf), "\nMemTable Unflushed: %lu",

3936 
‹mp_u§ge_by_ty³
[
rocksdb
::
MemÜyUt
::
kMemTabËUnFlushed
]);

3937 
¡r
.
	`­³nd
(
buf
);

3938 
	`¢´štf
(
buf
, (buf), "\nTable Readers Total: %lu",

3939 
‹mp_u§ge_by_ty³
[
rocksdb
::
MemÜyUt
::
kTabËR—d”sTÙ®
]);

3940 
¡r
.
	`­³nd
(
buf
);

3941 
	`¢´štf
(
buf
, (buf), "\nCache Total: %lu",

3942 
‹mp_u§ge_by_ty³
[
rocksdb
::
MemÜyUt
::
kCacheTÙ®
]);

3943 
¡r
.
	`­³nd
(
buf
);

3944 
	`¢´štf
(
buf
, (buf), "\nDefault Cache Capacity: %lu",

3945 
š‹º®_ÿche_couÁ
 * 
kDeçuÉIÁ”ÇlCacheSize
);

3946 
¡r
.
	`­³nd
(
buf
);

3947 
»s
 |ğ
	`´št_¡©s
(
thd
, "MEMORY_STATS", "rocksdb", 
¡r
, 
¡©_´št
);

3950 
¡d
::
veùÜ
<
rocksdb
::
Th»adStus
> 
th»ad_li¡
;

3951 
rocksdb
::
Stus
 
s
 = 
rdb
->
	`G‘Env
()->
	`G‘Th»adLi¡
(&
th»ad_li¡
);

3953 ià(!
s
.
	`ok
()) {

3954 
	`sql_´št_”rÜ
("RocksDB: Returnedƒrror (%s) from GetThreadList.\n",

3955 
s
.
	`ToSŒšg
().
	`c_¡r
());

3956 
»s
 |ğ
Œue
;

3959 autØ&
™
 : 
th»ad_li¡
) {

3961 ià(
™
.
th»ad_ty³
 > 
rocksdb
::
Th»adStus
::
LOW_PRIORITY
) {

3965 
¡r
 = "\Áh»ad_ty³: " + 
™
.
	`G‘Th»adTy³Name
(™.
th»ad_ty³
) +

3966 "\ncf_Çme: " + 
™
.
cf_Çme
 +

3967 "\nİ”©iÚ_ty³: " + 
™
.
	`G‘O³¿tiÚName
(™.
İ”©iÚ_ty³
) +

3969 
™
.
	`G‘O³¿tiÚSgeName
(™.
İ”©iÚ_¡age
) +

3971 
™
.
	`MiüosToSŒšg
(™.
İ_–­£d_miüos
);

3973 autØ&
™_´İs
 :

3974 
™
.
	`IÁ”´‘O³¿tiÚPrİ”t›s
(™.
İ”©iÚ_ty³
,

3975 
™
.
İ_´İ”t›s
)) {

3976 
¡r
 +ğ"\n" + 
™_´İs
.
fœ¡
 + ": " + 
¡d
::
	`to_¡ršg
(™_´İs.
£cÚd
);

3979 
¡r
 +ğ"\n¡©e_ty³: " + 
™
.
	`G‘S‹Name
(™.
¡©e_ty³
);

3981 
»s
 |ğ
	`´št_¡©s
(
thd
, "BG_THREADS", 
¡d
::
	`to_¡ršg
(
™
.
th»ad_id
),

3982 
¡r
, 
¡©_´št
);

3987 
¡r
.
	`ş—r
();

3989 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
	`lock
(
ex¶ic™_¢­shÙ_mu‹x
);

3990 cÚ¡‡utØ&
–em
 : 
ex¶ic™_¢­shÙs
) {

3991 cÚ¡‡utØ&
ss
 = 
–em
.
£cÚd
.
	`lock
();

3992 
	`DBUG_ASSERT
(
ss
 !ğ
nuÎ±r
);

3993 cÚ¡‡utØ&
šfo
 = 
ss
->
ss_šfo
;

3994 
¡r
 +ğ"\nSÇpshÙ ID: " + 
¡d
::
	`to_¡ršg
(
šfo
.
¢­shÙ_id
) +

3995 "\nBšlog Fe: " + 
šfo
.
bšlog_fe
 +

3996 "\nBšlog Pos: " + 
¡d
::
	`to_¡ršg
(
šfo
.
bšlog_pos
) +

3997 "\nGtid Execu‹d: " + 
šfo
.
gtid_execu‹d
 + "\n";

4000 ià(!
¡r
.
	`em±y
()) {

4001 
»s
 |ğ
	`´št_¡©s
(
thd
, "EXPLICIT_SNAPSHOTS", "rocksdb", 
¡r
, 
¡©_´št
);

4003 } ià(
¡©_ty³
 =ğ
HA_ENGINE_TRX
) {

4005 
»s
 |ğ
	`rocksdb_show_¢­shÙ_¡©us
(
htÚ
, 
thd
, 
¡©_´št
);

4008  
»s
;

4009 
	}
}

4011 
šlše
 
	$rocksdb_»gi¡”_tx
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
,

4012 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
) {

4013 
	`DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

4015 
	`Œªs_»gi¡”_ha
(
thd
, 
FALSE
, 
rocksdb_htÚ
);

4016 ià(
my_cÜe
::
	`thd_‹¡_İtiÚs
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)) {

4017 
tx
->
	`¡¬t_¡mt
();

4018 
	`Œªs_»gi¡”_ha
(
thd
, 
TRUE
, 
rocksdb_htÚ
);

4020 
	}
}

4022 
boŞ
 
	$rocksdb_ex¶ic™_¢­shÙ
(

4023 
hªdË¹Ú
 *const ,

4024 
THD
 *cÚ¡ 
thd
,

4025 
¢­shÙ_šfo_¡
 *
ss_šfo
)

4027 
ss_šfo
->
İ
) {

4028 
¢­shÙ_İ”©iÚ
::
SNAPSHOT_CREATE
: {

4029 ià(
	`mysql_bš_log_is_İ’
()) {

4030 
	`mysql_bš_log_lock_comm™s
(
ss_šfo
);

4032 autØ
s
 = 
Rdb_ex¶ic™_¢­shÙ
::
	`ü—‹
(
ss_šfo
, 
rdb
,„db->
	`G‘SÇpshÙ
());

4033 ià(
	`mysql_bš_log_is_İ’
()) {

4034 
	`mysql_bš_log_uÆock_comm™s
(
ss_šfo
);

4037 
thd
->
	`£t_ex¶ic™_¢­shÙ
(
s
);

4038  
s
 =ğ
nuÎ±r
;

4040 
¢­shÙ_İ”©iÚ
::
SNAPSHOT_ATTACH
: {

4041 autØ
s
 = 
Rdb_ex¶ic™_¢­shÙ
::
	`g‘
(
ss_šfo
->
¢­shÙ_id
);

4042 ià(!
s
) {

4043  
Œue
;

4045 *
ss_šfo
 = 
s
->ss_info;

4046 
thd
->
	`£t_ex¶ic™_¢­shÙ
(
s
);

4047  
çl£
;

4049 
¢­shÙ_İ”©iÚ
::
SNAPSHOT_RELEASE
: {

4050 *
ss_šfo
 = 
thd
->
	`g‘_ex¶ic™_¢­shÙ
()->ss_info;

4051 
thd
->
	`£t_ex¶ic™_¢­shÙ
(
nuÎ±r
);

4052  
çl£
;

4055 
	`DBUG_ASSERT
(
çl£
);

4056  
Œue
;

4058  
Œue
;

4059 
	}
}

4082 
	$rocksdb_¡¬t_tx_ªd_assign_»ad_v›w
(

4083 
hªdË¹Ú
 *cÚ¡ 
htÚ
,

4084 
THD
 *cÚ¡ 
thd
,

4087 
¢­shÙ_šfo_¡
 *
ss_šfo
)

4090 
ulÚg
 cÚ¡ 
tx_isŞ©iÚ
 = 
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
thd
);

4092 ià(
tx_isŞ©iÚ
 !ğ
ISO_REPEATABLE_READ
) {

4093 
	`my_”rÜ
(
ER_ISOLATION_LEVEL_WITH_CONSISTENT_SNAPSHOT
, 
	`MYF
(0));

4094  
HA_EXIT_FAILURE
;

4097 ià(
ss_šfo
) {

4098 ià(
	`mysql_bš_log_is_İ’
()) {

4099 
	`mysql_bš_log_lock_comm™s
(
ss_šfo
);

4101  
HA_EXIT_FAILURE
;

4105 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
thd
);

4106 
Rdb_³rf_cÚ‹xt_gu¬d
 
	`gu¬d
(
tx
, 
	`rocksdb_³rf_cÚ‹xt_Ëv–
(
thd
));

4108 
	`DBUG_ASSERT
(!
tx
->
	`has_¢­shÙ
());

4109 
tx
->
	`£t_tx_»ad_Úly
(
Œue
);

4110 
	`rocksdb_»gi¡”_tx
(
htÚ
, 
thd
, 
tx
);

4111 
tx
->
	`acquœe_¢­shÙ
(
Œue
);

4113 ià(
ss_šfo
) {

4114 
	`mysql_bš_log_uÆock_comm™s
(
ss_šfo
);

4117  
HA_EXIT_SUCCESS
;

4118 
	}
}

4120 
	$rocksdb_¡¬t_tx_w™h_sh¬ed_»ad_v›w
(

4121 
hªdË¹Ú
 *cÚ¡ 
htÚ
,

4122 
THD
 *cÚ¡ 
thd
,

4125 
¢­shÙ_šfo_¡
 *
ss_šfo
)

4128 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

4129 
	`DBUG_ASSERT
(
ss_šfo
 !ğ
nuÎ±r
);

4131 
ulÚg
 cÚ¡ 
tx_isŞ©iÚ
 = 
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
thd
);

4132 ià(
tx_isŞ©iÚ
 !ğ
ISO_REPEATABLE_READ
) {

4133 
	`my_”rÜ
(
ER_ISOLATION_LEVEL_WITH_CONSISTENT_SNAPSHOT
, 
	`MYF
(0));

4134  
HA_EXIT_FAILURE
;

4137 
¡d
::
sh¬ed_±r
<
Rdb_ex¶ic™_¢­shÙ
> 
ex¶ic™_¢­shÙ
;

4140 ià(
ss_šfo
->
İ
 =ğ
¢­shÙ_İ”©iÚ
::
SNAPSHOT_CREATE
 &&

4141 
	`mysql_bš_log_is_İ’
()) {

4142 
	`mysql_bš_log_lock_comm™s
(
ss_šfo
);

4145 ià(
ss_šfo
->
İ
 =ğ
¢­shÙ_İ”©iÚ
::
SNAPSHOT_ATTACH
) {

4146 
ex¶ic™_¢­shÙ
 = 
Rdb_ex¶ic™_¢­shÙ
::
	`g‘
(
ss_šfo
->
¢­shÙ_id
);

4147 ià(!
ex¶ic™_¢­shÙ
) {

4148 
	`my_´štf_”rÜ
(
ER_UNKNOWN_ERROR
, "SÇpshÙ %Îu dÛ nÙƒxi¡", 
	`MYF
(0),

4149 
ss_šfo
->
¢­shÙ_id
);

4150  
HA_EXIT_FAILURE
;

4152 *
ss_šfo
 = 
ex¶ic™_¢­shÙ
->ss_info;

4153 
ss_šfo
->
İ
 = 
¢­shÙ_İ”©iÚ
::
SNAPSHOT_ATTACH
;

4156 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
thd
, 
ex¶ic™_¢­shÙ
);

4157 
Rdb_³rf_cÚ‹xt_gu¬d
 
	`gu¬d
(
tx
, 
	`rocksdb_³rf_cÚ‹xt_Ëv–
(
thd
));

4159 
	`DBUG_ASSERT
(!
tx
->
	`has_¢­shÙ
());

4160 
tx
->
	`£t_tx_»ad_Úly
(
Œue
);

4161 
	`rocksdb_»gi¡”_tx
(
htÚ
, 
thd
, 
tx
);

4162 
tx
->
	`acquœe_¢­shÙ
(
Œue
);

4165 ià(!
tx
->
m_ex¶ic™_¢­shÙ
) {

4166 autØ
s
 =

4167 
Rdb_ex¶ic™_¢­shÙ
::
	`ü—‹
(
ss_šfo
, 
rdb
, 
tx
->
m_»ad_İts
.
¢­shÙ
);

4168 
tx
->
m_ex¶ic™_¢­shÙ
 = 
s
;

4169 
ss_šfo
->
¢­shÙ_id
 = 
s
->ss_info.snapshot_id;

4173 ià(
ss_šfo
->
İ
 =ğ
¢­shÙ_İ”©iÚ
::
SNAPSHOT_CREATE
 &&

4174 
	`mysql_bš_log_is_İ’
()) {

4175 
	`mysql_bš_log_uÆock_comm™s
(
ss_šfo
);

4178  
HA_EXIT_SUCCESS
;

4179 
	}
}

4186 
	$rocksdb_§v•ošt
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
,

4187 *cÚ¡ 
§v•ošt
) {

4188  
HA_EXIT_SUCCESS
;

4189 
	}
}

4191 
	$rocksdb_rŞlback_to_§v•ošt
(
hªdË¹Ú
 *cÚ¡ 
htÚ
, 
THD
 *cÚ¡ 
thd
,

4192 *cÚ¡ 
§v•ošt
) {

4193 
Rdb_Œª§ùiÚ
 *&
tx
 = 
	`g‘_tx_äom_thd
(
thd
);

4194  
tx
->
	`rŞlback_to_§v•ošt
(
§v•ošt
);

4195 
	}
}

4197 
boŞ


4198 
	$rocksdb_rŞlback_to_§v•ošt_ÿn_»Ëa£_mdl
(
hªdË¹Ú
 *cÚ¡ 
htÚ
,

4199 
THD
 *cÚ¡ 
thd
) {

4200  
Œue
;

4201 
	}
}

4206 
rocksdb_upd©e_bË_¡©s
(

4208 (*
cb
)(cÚ¡ *
db
, cÚ¡ *
tbl
, 
boŞ
 
is_·¹™iÚ
,

4209 
my_io_³rf_t
 *
r
, my_io_³rf_ˆ*
w
, my_io_³rf_ˆ*
r_blob
,

4210 
my_io_³rf_t
 *
r_´im¬y
, my_io_³rf_ˆ*
r_£cÚd¬y
,

4211 
·ge_¡©s_t
 *
·ge_¡©s
, 
comp_¡©s_t
 *
comp_¡©s
,

4212 
n_lock_wa™
, 
n_lock_wa™_timeout
, 
n_lock_d—dlock
,

4213 cÚ¡ *
’gše
)) {

4214 
my_io_³rf_t
 
io_³rf_»ad
;

4215 
my_io_³rf_t
 
io_³rf_wr™e
;

4216 
my_io_³rf_t
 
io_³rf
;

4217 
·ge_¡©s_t
 
·ge_¡©s
;

4218 
comp_¡©s_t
 
comp_¡©s
;

4219 
ušt
 
lock_wa™_timeout_¡©s
;

4220 
ušt
 
d—dlock_¡©s
;

4221 
ušt
 
lock_wa™_¡©s
;

4222 
¡d
::
veùÜ
<¡d::
¡ršg
> 
bËÇmes
;

4228 
	`mem£t
(&
io_³rf
, 0, (io_perf));

4229 
	`mem£t
(&
·ge_¡©s
, 0, (page_stats));

4230 
	`mem£t
(&
comp_¡©s
, 0, (comp_stats));

4231 
	`mem£t
(&
io_³rf_wr™e
, 0, (io_perf_write));

4233 
bËÇmes
 = 
rdb_İ’_bËs
.
	`g‘_bË_Çmes
();

4235 cÚ¡‡utØ&
™
 : 
bËÇmes
) {

4236 
Rdb_bË_hªdËr
 *
bË_hªdËr
;

4237 
¡d
::
¡ršg
 
¡r
, 
dbÇme
, 
bËÇme
, 
·¹Çme
;

4238 
dbÇme_sys
[
NAME_LEN
 + 1];

4239 
bËÇme_sys
[
NAME_LEN
 + 1];

4240 
boŞ
 
is_·¹™iÚ
;

4242 ià(
	`rdb_nÜm®ize_bËÇme
(
™
, &
¡r
è!ğ
HA_EXIT_SUCCESS
) {

4247 
	`SHIP_ASSERT
(
çl£
);

4251 ià(
	`rdb_¥l™_nÜm®ized_bËÇme
(
¡r
, &
dbÇme
, &
bËÇme
, &
·¹Çme
)) {

4255 
is_·¹™iÚ
 = (
·¹Çme
.
	`size
() != 0);

4257 
bË_hªdËr
 = 
rdb_İ’_bËs
.
	`g‘_bË_hªdËr
(
™
.
	`c_¡r
());

4258 ià(
bË_hªdËr
 =ğ
nuÎ±r
) {

4262 
io_³rf_»ad
.
by‹s
 = 
bË_hªdËr
->
m_io_³rf_»ad
.by‹s.
	`lßd
();

4263 
io_³rf_»ad
.
»que¡s
 = 
bË_hªdËr
->
m_io_³rf_»ad
.»que¡s.
	`lßd
();

4264 
io_³rf_wr™e
.
by‹s
 = 
bË_hªdËr
->
m_io_³rf_wr™e
.by‹s.
	`lßd
();

4265 
io_³rf_wr™e
.
»que¡s
 = 
bË_hªdËr
->
m_io_³rf_wr™e
.»que¡s.
	`lßd
();

4266 
lock_wa™_timeout_¡©s
 = 
bË_hªdËr
->
m_lock_wa™_timeout_couÁ”
.
	`lßd
();

4267 
d—dlock_¡©s
 = 
bË_hªdËr
->
m_d—dlock_couÁ”
.
	`lßd
();

4268 
lock_wa™_¡©s
 =

4269 
bË_hªdËr
->
m_bË_³rf_cÚ‹xt
.
m_v®ue
[
PC_KEY_LOCK_WAIT_COUNT
]

4270 .
	`lßd
();

4277 
io_³rf_»ad
.
svc_time
 = 
my_cÜe
::
	`miüo£cÚds_to_my_tim”
(

4278 
bË_hªdËr
->
m_io_³rf_»ad
.
svc_time
.
	`lßd
() / 1000);

4279 
io_³rf_»ad
.
svc_time_max
 = 
my_cÜe
::
	`miüo£cÚds_to_my_tim”
(

4280 
bË_hªdËr
->
m_io_³rf_»ad
.
svc_time_max
.
	`lßd
() / 1000);

4281 
io_³rf_»ad
.
wa™_time
 = 
my_cÜe
::
	`miüo£cÚds_to_my_tim”
(

4282 
bË_hªdËr
->
m_io_³rf_»ad
.
wa™_time
.
	`lßd
() / 1000);

4283 
io_³rf_»ad
.
wa™_time_max
 = 
my_cÜe
::
	`miüo£cÚds_to_my_tim”
(

4284 
bË_hªdËr
->
m_io_³rf_»ad
.
wa™_time_max
.
	`lßd
() / 1000);

4285 
io_³rf_»ad
.
¦ow_ios
 = 
bË_hªdËr
->
m_io_³rf_»ad
.¦ow_ios.
	`lßd
();

4286 
rdb_İ’_bËs
.
	`»Ëa£_bË_hªdËr
(
bË_hªdËr
);

4292 
my_cÜe
::
	`f’ame_to_bËÇme
(
dbÇme
.
	`c_¡r
(), 
dbÇme_sys
,

4293 (
dbÇme_sys
));

4294 
my_cÜe
::
	`f’ame_to_bËÇme
(
bËÇme
.
	`c_¡r
(), 
bËÇme_sys
,

4295 (
bËÇme_sys
));

4296 (*
cb
)(
dbÇme_sys
, 
bËÇme_sys
, 
is_·¹™iÚ
, &
io_³rf_»ad
,

4297 &
io_³rf_wr™e
, &
io_³rf
, &io_³rf, &io_³rf, &
·ge_¡©s
,

4298 &
comp_¡©s
, 
lock_wa™_¡©s
, 
lock_wa™_timeout_¡©s
, 
d—dlock_¡©s
,

4299 
rocksdb_htÚ_Çme
);

4301 
	}
}

4303 
rocksdb
::
Stus
 
check_rocksdb_İtiÚs_com·tib™y
(

4304 cÚ¡ *cÚ¡ 
db·th
, cÚ¡ 
rocksdb
::
O±iÚs
 &
maš_İts
,

4305 cÚ¡ 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> &
cf_desü
) {

4306 
DBUG_ASSERT
(
rocksdb_d©adœ
 !ğ
nuÎ±r
);

4308 
rocksdb
::
DBO±iÚs
 
lßded_db_İt
;

4309 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> 
lßded_cf_descs
;

4310 
rocksdb
::
Stus
 
¡©us
 =

4311 
LßdL©e¡O±iÚs
(
db·th
, 
rocksdb
::
Env
::
DeçuÉ
(), &
lßded_db_İt
,

4312 &
lßded_cf_descs
, 
rocksdb_ignÜe_unknown_İtiÚs
);

4317 ià(
¡©us
.
IsNÙFound
()) {

4318  
rocksdb
::
Stus
::
OK
();

4321 ià(!
¡©us
.
ok
()) {

4322  
¡©us
;

4325 ià(
lßded_cf_descs
.
size
(è!ğ
cf_desü
.size()) {

4326  
rocksdb
::
Stus
::
NÙSuµÜ‹d
("Mismatched size of column family "

4332 
size_t
 
i
 = 0; i < 
lßded_cf_descs
.
size
(); i++) {

4333 
lßded_cf_descs
[
i
].
İtiÚs
.
com·ùiÚ_f‹r
 =

4334 
cf_desü
[
i
].
İtiÚs
.
com·ùiÚ_f‹r
;

4335 
lßded_cf_descs
[
i
].
İtiÚs
.
com·ùiÚ_f‹r_çùÜy
 =

4336 
cf_desü
[
i
].
İtiÚs
.
com·ùiÚ_f‹r_çùÜy
;

4337 
lßded_cf_descs
[
i
].
İtiÚs
.
com·¿tÜ
 = 
cf_desü
[i].options.comparator;

4338 
lßded_cf_descs
[
i
].
İtiÚs
.
membË_çùÜy
 =

4339 
cf_desü
[
i
].
İtiÚs
.
membË_çùÜy
;

4340 
lßded_cf_descs
[
i
].
İtiÚs
.
m”ge_İ”©Ü
 =

4341 
cf_desü
[
i
].
İtiÚs
.
m”ge_İ”©Ü
;

4342 
lßded_cf_descs
[
i
].
İtiÚs
.
´efix_exŒaùÜ
 =

4343 
cf_desü
[
i
].
İtiÚs
.
´efix_exŒaùÜ
;

4344 
lßded_cf_descs
[
i
].
İtiÚs
.
bË_çùÜy
 =

4345 
cf_desü
[
i
].
İtiÚs
.
bË_çùÜy
;

4350 
¡©us
 = 
CheckO±iÚsCom·tib™y
(
db·th
, 
rocksdb
::
Env
::
DeçuÉ
(), 
maš_İts
,

4351 
lßded_cf_descs
,

4352 
rocksdb_ignÜe_unknown_İtiÚs
);

4354  
¡©us
;

4361 
	$rocksdb_š™_func
(*cÚ¡ 
p
) {

4362 
	`DBUG_ENTER_FUNC
();

4364 ià(
	`rdb_check_rocksdb_cÜru±iÚ
()) {

4365 
	`sql_´št_”rÜ
("RocksDB: There was‡ corruption detected in RockDB files. "

4367 ià(
rocksdb_®low_to_¡¬t_aá”_cÜru±iÚ
) {

4368 
	`sql_´št_šfÜm©iÚ
(

4372 
	`sql_´št_”rÜ
("RocksDB: The server willƒxit‚ormally‡nd stop„estart "

4375 
	`rdb_cÜru±iÚ_m¬k”_fe_Çme
().
	`c_¡r
());

4376 
	`ex™
(0);

4381 
	`¡©ic_as£¹
((
lÚglÚg
) == 8, "Assuminghat†onglong is 8 bytes.");

4383 
	`š™_rocksdb_psi_keys
();

4385 
rocksdb_htÚ
 = (
hªdË¹Ú
 *)
p
;

4386 
	`mysql_mu‹x_š™
(
rdb_psi_İ’_tbls_mu‹x_key
, &
rdb_İ’_bËs
.
m_mu‹x
,

4387 
MY_MUTEX_INIT_FAST
);

4388 #ifdeà
HAVE_PSI_INTERFACE


4389 
rdb_bg_th»ad
.
	`š™
(
rdb_sigÇl_bg_psi_mu‹x_key
, 
rdb_sigÇl_bg_psi_cÚd_key
);

4390 
rdb_drİ_idx_th»ad
.
	`š™
(
rdb_sigÇl_drİ_idx_psi_mu‹x_key
,

4391 
rdb_sigÇl_drİ_idx_psi_cÚd_key
);

4393 
rdb_bg_th»ad
.
	`š™
();

4394 
rdb_drİ_idx_th»ad
.
	`š™
();

4396 
	`mysql_mu‹x_š™
(
rdb_cŞÏtiÚ_d©a_mu‹x_key
, &
rdb_cŞÏtiÚ_d©a_mu‹x
,

4397 
MY_MUTEX_INIT_FAST
);

4398 
	`mysql_mu‹x_š™
(
rdb_mem_cmp_¥aû_mu‹x_key
, &
rdb_mem_cmp_¥aû_mu‹x
,

4399 
MY_MUTEX_INIT_FAST
);

4401 #ià
	`defšed
(
HAVE_PSI_INTERFACE
)

4402 
rdb_cŞÏtiÚ_exû±iÚs
 =

4403 
Ãw
 
	`Regex_li¡_hªdËr
(
key_rwlock_cŞÏtiÚ_exû±iÚ_li¡
);

4405 
rdb_cŞÏtiÚ_exû±iÚs
 = 
Ãw
 
	`Regex_li¡_hªdËr
();

4408 
	`mysql_mu‹x_š™
(
rdb_sysv¬s_psi_mu‹x_key
, &
rdb_sysv¬s_mu‹x
,

4409 
MY_MUTEX_INIT_FAST
);

4410 
rdb_İ’_bËs
.
	`š™_hash
();

4411 
Rdb_Œª§ùiÚ
::
	`š™_mu‹x
();

4413 
rocksdb_htÚ
->
¡©e
 = 
SHOW_OPTION_YES
;

4414 
rocksdb_htÚ
->
ü—‹
 = 
rocksdb_ü—‹_hªdËr
;

4415 
rocksdb_htÚ
->
şo£_cÚÃùiÚ
 = 
rocksdb_şo£_cÚÃùiÚ
;

4416 
rocksdb_htÚ
->
´•¬e
 = 
rocksdb_´•¬e
;

4417 
rocksdb_htÚ
->
comm™_by_xid
 = 
rocksdb_comm™_by_xid
;

4418 
rocksdb_htÚ
->
rŞlback_by_xid
 = 
rocksdb_rŞlback_by_xid
;

4419 
rocksdb_htÚ
->
»cov”
 = 
rocksdb_»cov”
;

4420 
rocksdb_htÚ
->
comm™
 = 
rocksdb_comm™
;

4421 
rocksdb_htÚ
->
rŞlback
 = 
rocksdb_rŞlback
;

4422 
rocksdb_htÚ
->
db_ty³
 = 
DB_TYPE_ROCKSDB
;

4423 
rocksdb_htÚ
->
show_¡©us
 = 
rocksdb_show_¡©us
;

4424 
rocksdb_htÚ
->
ex¶ic™_¢­shÙ
 = 
rocksdb_ex¶ic™_¢­shÙ
;

4425 
rocksdb_htÚ
->
¡¬t_cÚsi¡’t_¢­shÙ
 =

4426 
rocksdb_¡¬t_tx_ªd_assign_»ad_v›w
;

4427 
rocksdb_htÚ
->
¡¬t_sh¬ed_¢­shÙ
 = 
rocksdb_¡¬t_tx_w™h_sh¬ed_»ad_v›w
;

4428 
rocksdb_htÚ
->
§v•ošt_£t
 = 
rocksdb_§v•ošt
;

4429 
rocksdb_htÚ
->
§v•ošt_rŞlback
 = 
rocksdb_rŞlback_to_§v•ošt
;

4430 
rocksdb_htÚ
->
§v•ošt_rŞlback_ÿn_»Ëa£_mdl
 =

4431 
rocksdb_rŞlback_to_§v•ošt_ÿn_»Ëa£_mdl
;

4432 
rocksdb_htÚ
->
upd©e_bË_¡©s
 = 
rocksdb_upd©e_bË_¡©s
;

4433 
rocksdb_htÚ
->
æush_logs
 = 
rocksdb_æush_w®
;

4435 
rocksdb_htÚ
->
æags
 = 
HTON_TEMPORARY_NOT_SUPPORTED
 |

4436 
HTON_SUPPORTS_EXTENDED_KEYS
 | 
HTON_CAN_RECREATE
;

4438 
	`DBUG_ASSERT
(!
mysqld_embedded
);

4440 ià(
rocksdb_db_İtiÚs
->
max_İ’_fes
 > ()
İ’_fes_lim™
) {

4441 
	`sql_´št_šfÜm©iÚ
("RocksDB:„ocksdb_max_open_files should‚ot be "

4445 
rocksdb_db_İtiÚs
->
max_İ’_fes
 = 
İ’_fes_lim™
 / 2;

4446 } ià(
rocksdb_db_İtiÚs
->
max_İ’_fes
 == -2) {

4447 
rocksdb_db_İtiÚs
->
max_İ’_fes
 = 
İ’_fes_lim™
 / 2;

4450 
rocksdb_¡©s
 = 
rocksdb
::
	`C»©eDBSti¡ics
();

4451 
rocksdb_db_İtiÚs
->
¡©i¡ics
 = 
rocksdb_¡©s
;

4453 ià(
rocksdb_¿‹_lim™”_by‹s_³r_£c
 != 0) {

4454 
rocksdb_¿‹_lim™”
.
	`»£t
(

4455 
rocksdb
::
	`NewG’”icR©eLim™”
(
rocksdb_¿‹_lim™”_by‹s_³r_£c
));

4456 
rocksdb_db_İtiÚs
->
¿‹_lim™”
 = 
rocksdb_¿‹_lim™”
;

4459 
rocksdb_db_İtiÚs
->
d–ayed_wr™e_¿‹
 = 
rocksdb_d–ayed_wr™e_¿‹
;

4461 
¡d
::
sh¬ed_±r
<
Rdb_logg”
> 
myrocks_logg”
 = std::
make_sh¬ed
<Rdb_logger>();

4462 
rocksdb
::
Stus
 
s
 =„ocksdb::
	`C»©eLogg”FromO±iÚs
(

4463 
rocksdb_d©adœ
, *
rocksdb_db_İtiÚs
, &rocksdb_db_İtiÚs->
šfo_log
);

4464 ià(
s
.
	`ok
()) {

4465 
myrocks_logg”
->
	`S‘RocksDBLogg”
(
rocksdb_db_İtiÚs
->
šfo_log
);

4468 
rocksdb_db_İtiÚs
->
šfo_log
 = 
myrocks_logg”
;

4469 
myrocks_logg”
->
	`S‘InfoLogLev–
(

4470 
¡©ic_ÿ¡
<
rocksdb
::
InfoLogLev–
>(
rocksdb_šfo_log_Ëv–
));

4471 
rocksdb_db_İtiÚs
->
w®_dœ
 = 
rocksdb_w®_dœ
;

4473 
rocksdb_db_İtiÚs
->
w®_»cov”y_mode
 =

4474 
¡©ic_ÿ¡
<
rocksdb
::
WALRecov”yMode
>(
rocksdb_w®_»cov”y_mode
);

4476 
rocksdb_db_İtiÚs
->
acûss_hšt_Ú_com·ùiÚ_¡¬t
 =

4477 
¡©ic_ÿ¡
<
rocksdb
::
O±iÚs
::
AcûssHšt
>(

4478 
rocksdb_acûss_hšt_Ú_com·ùiÚ_¡¬t
);

4480 ià(
rocksdb_db_İtiÚs
->
®low_mm­_»ads
 &&

4481 
rocksdb_db_İtiÚs
->
u£_dœeù_»ads
) {

4484 
	`sql_´št_”rÜ
("RocksDB: Can'tƒnable both use_direct_reads "

4486 
rdb_İ’_bËs
.
	`ä“_hash
();

4487 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4491 ià(
rocksdb_db_İtiÚs
->
u£_dœeù_»ads
) {

4492 
rocksdb
::
EnvO±iÚs
 
sİtiÚs
;

4493 
rocksdb
::
Stus
 
check_¡©us
;

4494 
rocksdb
::
Env
 *cÚ¡ 
’v
 = 
rocksdb_db_İtiÚs
->env;

4496 
¡d
::
¡ršg
 
âame
 = 
	`fÜm©_¡ršg
("%s/DIRECT_CHECK", 
rocksdb_d©adœ
);

4497 ià(
’v
->
	`FeExi¡s
(
âame
).
	`ok
()) {

4498 
¡d
::
unique_±r
<
rocksdb
::
Sequ’tŸlFe
> 
fe
;

4499 
sİtiÚs
.
u£_dœeù_»ads
 = 
Œue
;

4500 
check_¡©us
 = 
’v
->
	`NewSequ’tŸlFe
(
âame
, &
fe
, 
sİtiÚs
);

4502 
¡d
::
unique_±r
<
rocksdb
::
Wr™abËFe
> 
fe
;

4503 
sİtiÚs
.
u£_dœeù_wr™es
 = 
Œue
;

4504 
check_¡©us
 = 
’v
->
	`Reİ’Wr™abËFe
(
âame
, &
fe
, 
sİtiÚs
);

4505 ià(
fe
 !ğ
nuÎ±r
) {

4506 
fe
->
	`Clo£
();

4508 
’v
->
	`D–‘eFe
(
âame
);

4511 ià(!
check_¡©us
.
	`ok
()) {

4512 
	`sql_´št_”rÜ
("RocksDB: Unableo use direct io in„ocksdb-datadir:"

4513 "(%s)", 
check_¡©us
.
	`g‘S‹
());

4514 
rdb_İ’_bËs
.
	`ä“_hash
();

4515 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4519 ià(
rocksdb_db_İtiÚs
->
®low_mm­_wr™es
 &&

4520 
rocksdb_db_İtiÚs
->
u£_dœeù_io_fÜ_æush_ªd_com·ùiÚ
) {

4522 
	`sql_´št_”rÜ
("RocksDB: Can'tƒnable both "

4525 
rdb_İ’_bËs
.
	`ä“_hash
();

4526 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4529 ià(
rocksdb_db_İtiÚs
->
®low_mm­_wr™es
 &&

4530 
rocksdb_æush_log_©_Œx_comm™
 !ğ
FLUSH_LOG_NEVER
) {

4532 
	`sql_´št_”rÜ
("RocksDB:„ocksdb_flush_log_at_trx_commit‚eedso be 0 "

4534 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4539 
¡d
::
¡ršg
 
Œash_dœ
 = std::
	`¡ršg
(
rocksdb_d©adœ
) + "/trash";

4540 
rocksdb_db_İtiÚs
->
s¡_fe_mªag”
.
	`»£t
(
	`NewS¡FeMªag”
(

4541 
rocksdb_db_İtiÚs
->
’v
, 
myrocks_logg”
, 
Œash_dœ
,

4542 
rocksdb_s¡_mgr_¿‹_by‹s_³r_£c
, 
Œue
 ));

4544 
¡d
::
veùÜ
<¡d::
¡ršg
> 
cf_Çmes
;

4545 
rocksdb
::
Stus
 
¡©us
;

4546 
¡©us
 = 
rocksdb
::
DB
::
	`Li¡CŞumnFam›s
(*
rocksdb_db_İtiÚs
, 
rocksdb_d©adœ
,

4547 &
cf_Çmes
);

4548 ià(!
¡©us
.
	`ok
()) {

4554 ià(
¡©us
.
	`IsIOE¼Ü
(è&& 
”ºo
 =ğ
ENOENT
) {

4555 
	`sql_´št_šfÜm©iÚ
("RocksDB: Got ENOENT when†isting column families");

4556 
	`sql_´št_šfÜm©iÚ
(

4559 
rdb_İ’_bËs
.
	`ä“_hash
();

4560 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "Error†isting column families");

4561 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4564 
	`sql_´št_šfÜm©iÚ
("RocksDB: %ld column families found",

4565 
cf_Çmes
.
	`size
());

4567 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> 
cf_desü
;

4568 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *> 
cf_hªdËs
;

4570 
rocksdb_tbl_İtiÚs
->
šdex_ty³
 =

4571 (
rocksdb
::
BlockBa£dTabËO±iÚs
::
IndexTy³
)
rocksdb_šdex_ty³
;

4573 ià(!
rocksdb_tbl_İtiÚs
->
no_block_ÿche
) {

4574 
¡d
::
sh¬ed_±r
<
rocksdb
::
Cache
> 
block_ÿche
 = 
rocksdb_u£_şock_ÿche


4575 ? 
rocksdb
::
	`NewClockCache
(
rocksdb_block_ÿche_size
)

4576 : 
rocksdb
::
	`NewLRUCache
(
rocksdb_block_ÿche_size
);

4577 ià(
rocksdb_sim_ÿche_size
 > 0) {

4580 
rocksdb_tbl_İtiÚs
->
block_ÿche
 =

4581 
rocksdb
::
	`NewSimCache
(
block_ÿche
, 
rocksdb_sim_ÿche_size
, 6);

4584 
rocksdb_tbl_İtiÚs
->
block_ÿche
 = block_cache;

4591 
rocksdb_tbl_İtiÚs
->
fÜm©_v”siÚ
 = 2;

4593 ià(
rocksdb_cŞËù_s¡_´İ”t›s
) {

4594 
´İ”t›s_cŞËùÜ_çùÜy
 =

4595 
¡d
::
make_sh¬ed
<
Rdb_tbl_´İ_cŞl_çùÜy
>(&
ddl_mªag”
);

4597 
	`rocksdb_£t_com·ùiÚ_İtiÚs
(
nuÎ±r
,‚ullptr,‚ullptr,‚ullptr);

4599 
	`RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

4601 
	`DBUG_ASSERT
(
rocksdb_bË_¡©s_§m¶šg_pù
 <=

4602 
RDB_TBL_STATS_SAMPLE_PCT_MAX
);

4603 
´İ”t›s_cŞËùÜ_çùÜy
->
	`S‘TabËStsSam¶šgPù
(

4604 
rocksdb_bË_¡©s_§m¶šg_pù
);

4606 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

4609 ià(
rocksdb_³rsi¡’t_ÿche_size_mb
 > 0) {

4610 
¡d
::
sh¬ed_±r
<
rocksdb
::
P”si¡’tCache
> 
pÿche
;

4611 
ušt64_t
 
ÿche_size_by‹s
ğ
rocksdb_³rsi¡’t_ÿche_size_mb
 * 1024 * 1024;

4612 
¡©us
 = 
rocksdb
::
	`NewP”si¡’tCache
(

4613 
rocksdb
::
Env
::
	`DeçuÉ
(), 
¡d
::
	`¡ršg
(
rocksdb_³rsi¡’t_ÿche_·th
),

4614 
ÿche_size_by‹s
, 
myrocks_logg”
, 
Œue
, &
pÿche
);

4615 ià(!
¡©us
.
	`ok
()) {

4617 
	`sql_´št_”rÜ
("RocksDB: Persistent cache„eturnedƒrror: (%s)",

4618 
¡©us
.
	`g‘S‹
());

4619 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4621 
rocksdb_tbl_İtiÚs
->
³rsi¡’t_ÿche
 = 
pÿche
;

4622 } ià(
	`¡¾’
(
rocksdb_³rsi¡’t_ÿche_·th
)) {

4623 
	`sql_´št_”rÜ
("RocksDB: Must specify„ocksdb_persistent_cache_size_mb");

4624 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4627 
¡d
::
unique_±r
<
Rdb_cf_İtiÚs
> 
	`cf_İtiÚs_m­
(
Ãw
 
	`Rdb_cf_İtiÚs
());

4628 ià(!
cf_İtiÚs_m­
->
	`š™
(*
rocksdb_tbl_İtiÚs
, 
´İ”t›s_cŞËùÜ_çùÜy
,

4629 
rocksdb_deçuÉ_cf_İtiÚs
,

4630 
rocksdb_ov”ride_cf_İtiÚs
)) {

4632 
	`sql_´št_”rÜ
("RocksDB: Failedo initialize CF options map.");

4633 
rdb_İ’_bËs
.
	`ä“_hash
();

4634 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4641 ià(
cf_Çmes
.
	`size
() == 0)

4642 
cf_Çmes
.
	`push_back
(
DEFAULT_CF_NAME
);

4644 
¡d
::
veùÜ
<> 
com·ùiÚ_’abËd_cf_šdiûs
;

4645 
	`sql_´št_šfÜm©iÚ
("RocksDB: Column Families‡t start:");

4646 
size_t
 
i
 = 0; i < 
cf_Çmes
.
	`size
(); ++i) {

4647 
rocksdb
::
CŞumnFamyO±iÚs
 
İts
;

4648 
cf_İtiÚs_m­
->
	`g‘_cf_İtiÚs
(
cf_Çmes
[
i
], &
İts
);

4650 
	`sql_´št_šfÜm©iÚ
(" cf=%s", 
cf_Çmes
[
i
].
	`c_¡r
());

4651 
	`sql_´št_šfÜm©iÚ
(" wr™e_bufãr_size=%ld", 
İts
.
wr™e_bufãr_size
);

4652 
	`sql_´št_šfÜm©iÚ
("¬g‘_fe_size_ba£=%" 
PRIu64
,

4653 
İts
.
rg‘_fe_size_ba£
);

4659 ià(!
İts
.
di§bË_auto_com·ùiÚs
) {

4660 
com·ùiÚ_’abËd_cf_šdiûs
.
	`push_back
(
i
);

4661 
İts
.
di§bË_auto_com·ùiÚs
 = 
Œue
;

4663 
cf_desü
.
	`push_back
(
rocksdb
::
	`CŞumnFamyDesütÜ
(
cf_Çmes
[
i
], 
İts
));

4666 
rocksdb
::
O±iÚs
 
	`maš_İts
(*
rocksdb_db_İtiÚs
,

4667 
cf_İtiÚs_m­
->
	`g‘_deçuÉs
());

4669 
rocksdb
::
T¿n§ùiÚDBO±iÚs
 
tx_db_İtiÚs
;

4670 
tx_db_İtiÚs
.
Œª§ùiÚ_lock_timeout
 = 2;

4671 
tx_db_İtiÚs
.
cu¡om_mu‹x_çùÜy
 = 
¡d
::
make_sh¬ed
<
Rdb_mu‹x_çùÜy
>();

4672 
tx_db_İtiÚs
.
wr™e_pŞicy
 =

4673 
¡©ic_ÿ¡
<
rocksdb
::
TxnDBWr™ePŞicy
>(
rocksdb_wr™e_pŞicy
);

4675 
¡©us
 =

4676 
	`check_rocksdb_İtiÚs_com·tib™y
(
rocksdb_d©adœ
, 
maš_İts
, 
cf_desü
);

4680 ià(!
¡©us
.
	`ok
()) {

4681 
	`rdb_log_¡©us_”rÜ
(

4682 
¡©us
, "Compatibility check‡gainstƒxisting database options failed");

4683 
rdb_İ’_bËs
.
	`ä“_hash
();

4684 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4687 
¡©us
 = 
rocksdb
::
T¿n§ùiÚDB
::
	`O³n
(

4688 
maš_İts
, 
tx_db_İtiÚs
, 
rocksdb_d©adœ
, 
cf_desü
, &
cf_hªdËs
, &
rdb
);

4690 ià(!
¡©us
.
	`ok
()) {

4691 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "Error opening instance");

4692 
rdb_İ’_bËs
.
	`ä“_hash
();

4693 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4695 
cf_mªag”
.
	`š™
(
¡d
::
	`move
(
cf_İtiÚs_m­
), &
cf_hªdËs
);

4697 ià(
diù_mªag”
.
	`š™
(
rdb
, &
cf_mªag”
)) {

4699 
	`sql_´št_”rÜ
("RocksDB: Failedo initialize data dictionary.");

4700 
rdb_İ’_bËs
.
	`ä“_hash
();

4701 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4704 ià(
bšlog_mªag”
.
	`š™
(&
diù_mªag”
)) {

4706 
	`sql_´št_”rÜ
("RocksDB: Failedo initialize binlog manager.");

4707 
rdb_İ’_bËs
.
	`ä“_hash
();

4708 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4711 ià(
ddl_mªag”
.
	`š™
(&
diù_mªag”
, &
cf_mªag”
, 
rocksdb_v®id©e_bËs
)) {

4713 
	`sql_´št_”rÜ
("RocksDB: Failedo initialize DDL manager.");

4714 
rdb_İ’_bËs
.
	`ä“_hash
();

4715 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4718 
Rdb_s¡_šfo
::
	`š™
(
rdb
);

4724 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *> 
com·ùiÚ_’abËd_cf_hªdËs
;

4725 
com·ùiÚ_’abËd_cf_hªdËs
.
	`»£rve
(
com·ùiÚ_’abËd_cf_šdiûs
.
	`size
());

4726 cÚ¡‡utØ&
šdex
 : 
com·ùiÚ_’abËd_cf_šdiûs
) {

4727 
com·ùiÚ_’abËd_cf_hªdËs
.
	`push_back
(
cf_hªdËs
[
šdex
]);

4730 
¡©us
 = 
rdb
->
	`EÇbËAutoCom·ùiÚ
(
com·ùiÚ_’abËd_cf_hªdËs
);

4732 ià(!
¡©us
.
	`ok
()) {

4733 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "Errorƒnabling compaction");

4734 
rdb_İ’_bËs
.
	`ä“_hash
();

4735 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4738 autØ
”r
 = 
rdb_bg_th»ad
.
	`ü—‹_th»ad
(
BG_THREAD_NAME


4739 #ifdeà
HAVE_PSI_INTERFACE


4741 
rdb_background_psi_th»ad_key


4744 ià(
”r
 != 0) {

4745 
	`sql_´št_”rÜ
("RocksDB: Couldn't starthe backgroundhread: (errno=%d)",

4746 
”r
);

4747 
rdb_İ’_bËs
.
	`ä“_hash
();

4748 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4751 
”r
 = 
rdb_drİ_idx_th»ad
.
	`ü—‹_th»ad
(
INDEX_THREAD_NAME


4752 #ifdeà
HAVE_PSI_INTERFACE


4754 
rdb_drİ_idx_psi_th»ad_key


4757 ià(
”r
 != 0) {

4758 
	`sql_´št_”rÜ
("RocksDB: Couldn't starthe drop indexhread: (errno=%d)",

4759 
”r
);

4760 
rdb_İ’_bËs
.
	`ä“_hash
();

4761 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4764 
	`rdb_£t_cŞÏtiÚ_exû±iÚ_li¡
(
rocksdb_¡riù_cŞÏtiÚ_exû±iÚs
);

4766 ià(
rocksdb_·u£_background_wÜk
) {

4767 
rdb
->
	`Pau£BackgroundWÜk
();

4771 
	`sql_´št_šfÜm©iÚ
("RocksDB: global statistics using %s indexer",

4772 
	`STRINGIFY_ARG
(
RDB_INDEXER
));

4773 #ià
	`defšed
(
HAVE_SCHED_GETCPU
)

4774 ià(
	`sched_g‘ıu
() == -1) {

4776 
	`sql_´št_šfÜm©iÚ
(

4782 
”r
 = 
	`my_”rÜ_»gi¡”
(
rdb_g‘_”rÜ_mes§ge
, 
HA_ERR_ROCKSDB_FIRST
,

4783 
HA_ERR_ROCKSDB_LAST
);

4784 ià(
”r
 != 0) {

4786 
	`sql_´št_”rÜ
("RocksDB: Couldn't initializeƒrror messages");

4787 
rdb_İ’_bËs
.
	`ä“_hash
();

4788 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

4793 
comm™_Ï‹ncy_¡©s
 = 
Ãw
 
rocksdb
::
	`Hi¡og¿mIm¶
();

4797 
¡d
::
veùÜ
<¡d::
¡ršg
> 
dœeùÜ›s
;

4800 
dœeùÜ›s
.
	`push_back
(
mysql_»®_d©a_home
);

4803 ià(
myrocks
::
rocksdb_w®_dœ
 && *myrocks::rocksdb_wal_dir) {

4804 
dœeùÜ›s
.
	`push_back
(
myrocks
::
rocksdb_w®_dœ
);

4807 
io_w©chdog
 = 
Ãw
 
	`Rdb_io_w©chdog
(
dœeùÜ›s
);

4808 
io_w©chdog
->
	`»£t_timeout
(
rocksdb_io_wr™e_timeout_£cs
);

4811 
	`sql_´št_šfÜm©iÚ
("MyRocks storageƒngine…lugin has been successfully "

4814 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

4815 
	}
}

4821 
	$rocksdb_dÚe_func
(*cÚ¡ 
p
) {

4822 
	`DBUG_ENTER_FUNC
();

4824 
”rÜ
 = 0;

4827 
rdb_drİ_idx_th»ad
.
	`sigÇl
(
Œue
);

4830 
	`rocksdb_æush_®l_membËs
();

4833 
	`CªûlAÎBackgroundWÜk
(
rdb
->
	`G‘Ba£DB
(), 
Œue
);

4840 
rdb_bg_th»ad
.
	`sigÇl
(
Œue
);

4843 autØ
”r
 = 
rdb_bg_th»ad
.
	`još
();

4844 ià(
”r
 != 0) {

4848 
	`sql_´št_”rÜ
("RocksDB: Couldn't stophe backgroundhread: (errno=%d)",

4849 
”r
);

4853 
”r
 = 
rdb_drİ_idx_th»ad
.
	`još
();

4854 ià(
”r
 != 0) {

4856 
	`sql_´št_”rÜ
("RocksDB: Couldn'ˆ¡İhšdexh»ad: (”ºo=%d)", 
”r
);

4859 ià(
rdb_İ’_bËs
.
m_hash
.
»cÜds
) {

4862 
”rÜ
 = 1;

4865 
rdb_İ’_bËs
.
	`ä“_hash
();

4866 
	`mysql_mu‹x_de¡roy
(&
rdb_İ’_bËs
.
m_mu‹x
);

4867 
	`mysql_mu‹x_de¡roy
(&
rdb_sysv¬s_mu‹x
);

4869 
d–‘e
 
rdb_cŞÏtiÚ_exû±iÚs
;

4870 
	`mysql_mu‹x_de¡roy
(&
rdb_cŞÏtiÚ_d©a_mu‹x
);

4871 
	`mysql_mu‹x_de¡roy
(&
rdb_mem_cmp_¥aû_mu‹x
);

4873 
Rdb_Œª§ùiÚ
::
	`‹rm_mu‹x
();

4875 autØ&
™
 : 
rdb_cŞÏtiÚ_d©a
) {

4876 
d–‘e
 
™
;

4877 
™
 = 
nuÎ±r
;

4880 
ddl_mªag”
.
	`ş—nup
();

4881 
bšlog_mªag”
.
	`ş—nup
();

4882 
diù_mªag”
.
	`ş—nup
();

4883 
cf_mªag”
.
	`ş—nup
();

4885 
d–‘e
 
rdb
;

4886 
rdb
 = 
nuÎ±r
;

4888 
d–‘e
 
comm™_Ï‹ncy_¡©s
;

4889 
comm™_Ï‹ncy_¡©s
 = 
nuÎ±r
;

4891 
d–‘e
 
io_w©chdog
;

4892 
io_w©chdog
 = 
nuÎ±r
;

4897 #iâdeà
HAVE_purify


4898 ià(
rocksdb_tbl_İtiÚs
->
block_ÿche
) {

4899 
rocksdb_tbl_İtiÚs
->
block_ÿche
->
	`DisownD©a
();

4903 
rocksdb_db_İtiÚs
 = 
nuÎ±r
;

4904 
rocksdb_tbl_İtiÚs
 = 
nuÎ±r
;

4905 
rocksdb_¡©s
 = 
nuÎ±r
;

4907 
	`my_”rÜ_uÄegi¡”
(
HA_ERR_ROCKSDB_FIRST
, 
HA_ERR_ROCKSDB_LAST
);

4909 
	`DBUG_RETURN
(
”rÜ
);

4910 
	}
}

4912 
šlše
 
	$rocksdb_sm¬t_£ek
(
boŞ
 
£ek_backw¬d
,

4913 
rocksdb
::
I‹¿tÜ
 *cÚ¡ 
™”
,

4914 cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
) {

4915 ià(
£ek_backw¬d
) {

4916 
™”
->
	`S“kFÜP»v
(
key_¦iû
);

4918 
™”
->
	`S“k
(
key_¦iû
);

4920 
	}
}

4922 
šlše
 
	$rocksdb_sm¬t_Ãxt
(
boŞ
 
£ek_backw¬d
,

4923 
rocksdb
::
I‹¿tÜ
 *cÚ¡ 
™”
) {

4924 ià(
£ek_backw¬d
) {

4925 
™”
->
	`P»v
();

4927 
™”
->
	`Next
();

4929 
	}
}

4931 #iâdeà
NDEBUG


4933 
	$dbug_chªge_¡©us_to_cÜru±ed
(
rocksdb
::
Stus
 *
¡©us
) {

4934 *
¡©us
 = 
rocksdb
::
Stus
::
	`CÜru±iÚ
();

4935 
	}
}

4941 
šlše
 
boŞ
 
	$is_v®id
(
rocksdb
::
I‹¿tÜ
 *
sÿn_™
) {

4942 ià(
sÿn_™
->
	`V®id
()) {

4943  
Œue
;

4945 
rocksdb
::
Stus
 
s
 = 
sÿn_™
->
	`¡©us
();

4946 
	`DBUG_EXECUTE_IF
("rocksdb_return_status_corrupted",

4947 
	`dbug_chªge_¡©us_to_cÜru±ed
(&
s
););

4948 ià(
s
.
	`IsIOE¼Ü
(è|| s.
	`IsCÜru±iÚ
()) {

4949 ià(
s
.
	`IsCÜru±iÚ
()) {

4950 
	`rdb_³rsi¡_cÜru±iÚ_m¬k”
();

4952 
	`rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_GENERAL
);

4954  
çl£
;

4956 
	}
}

4966 
Rdb_bË_hªdËr
 *

4967 
Rdb_İ’_bËs_m­
::
	$g‘_bË_hªdËr
(cÚ¡ *cÚ¡ 
bË_Çme
) {

4968 
Rdb_bË_hªdËr
 *
bË_hªdËr
;

4969 
ušt
 
Ëngth
;

4970 *
tmp_Çme
;

4972 
	`DBUG_ASSERT
(
bË_Çme
 !ğ
nuÎ±r
);

4973 
Ëngth
 = (
ušt
)
	`¡¾’
(
bË_Çme
);

4976 
	`RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

4977 ià(!(
bË_hªdËr
 = 
»š‹½»t_ÿ¡
<
Rdb_bË_hªdËr
 *>(
	`my_hash_£¬ch
(

4978 &
m_hash
, 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
bË_Çme
), 
Ëngth
)))) {

4981 ià(!(
bË_hªdËr
 = 
»š‹½»t_ÿ¡
<
Rdb_bË_hªdËr
 *>(
	`my_muÉi_m®loc
(

4982 
	`MYF
(
MY_WME
 | 
MY_ZEROFILL
), &
bË_hªdËr
, (*table_handler),

4983 &
tmp_Çme
, 
Ëngth
 + 1, 
NuÎS
)))) {

4985 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

4986  
nuÎ±r
;

4989 
bË_hªdËr
->
m_»f_couÁ
 = 0;

4990 
bË_hªdËr
->
m_bË_Çme_Ëngth
 = 
Ëngth
;

4991 
bË_hªdËr
->
m_bË_Çme
 = 
tmp_Çme
;

4992 
	`¡rmov
(
bË_hªdËr
->
m_bË_Çme
, 
bË_Çme
);

4994 ià(
	`my_hash_š£¹
(&
m_hash
, 
»š‹½»t_ÿ¡
<
uch¬
 *>(
bË_hªdËr
))) {

4996 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

4997 
	`my_ä“
(
bË_hªdËr
);

4998  
nuÎ±r
;

5001 
	`thr_lock_š™
(&
bË_hªdËr
->
m_thr_lock
);

5002 
bË_hªdËr
->
m_io_³rf_»ad
.
	`š™
();

5003 
bË_hªdËr
->
m_io_³rf_wr™e
.
	`š™
();

5005 
	`DBUG_ASSERT
(
bË_hªdËr
->
m_»f_couÁ
 >= 0);

5006 
bË_hªdËr
->
m_»f_couÁ
++;

5008 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

5010  
bË_hªdËr
;

5011 
	}
}

5013 
¡d
::
veùÜ
<¡d::
¡ršg
> 
	$rdb_g‘_İ’_bË_Çmes
() {

5014  
rdb_İ’_bËs
.
	`g‘_bË_Çmes
();

5015 
	}
}

5017 
¡d
::
veùÜ
<¡d::
¡ršg
> 
Rdb_İ’_bËs_m­
::
	$g‘_bË_Çmes
() const {

5018 
ulÚg
 
i
;

5019 cÚ¡ 
Rdb_bË_hªdËr
 *
bË_hªdËr
;

5020 
¡d
::
veùÜ
<¡d::
¡ršg
> 
Çmes
;

5022 
	`RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

5023 
i
 = 0; (
bË_hªdËr
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
Rdb_bË_hªdËr
 *>(

5024 
	`my_hash_cÚ¡_–em’t
(&
m_hash
, 
i
)));

5025 
i
++) {

5026 
	`DBUG_ASSERT
(
bË_hªdËr
 !ğ
nuÎ±r
);

5027 
Çmes
.
	`push_back
(
bË_hªdËr
->
m_bË_Çme
);

5029 
	`DBUG_ASSERT
(
i
 =ğ
m_hash
.
»cÜds
);

5030 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

5032  
Çmes
;

5033 
	}
}

5039 
ulÚglÚg
 
	$rdb_g‘_št_cŞ_max_v®ue
(cÚ¡ 
F›ld
 *
f›ld
) {

5040 
ulÚglÚg
 
max_v®ue
 = 0;

5041 
f›ld
->
	`key_ty³
()) {

5042 
HA_KEYTYPE_BINARY
:

5043 
max_v®ue
 = 0xFFULL;

5045 
HA_KEYTYPE_INT8
:

5046 
max_v®ue
 = 0x7FULL;

5048 
HA_KEYTYPE_USHORT_INT
:

5049 
max_v®ue
 = 0xFFFFULL;

5051 
HA_KEYTYPE_SHORT_INT
:

5052 
max_v®ue
 = 0x7FFFULL;

5054 
HA_KEYTYPE_UINT24
:

5055 
max_v®ue
 = 0xFFFFFFULL;

5057 
HA_KEYTYPE_INT24
:

5058 
max_v®ue
 = 0x7FFFFFULL;

5060 
HA_KEYTYPE_ULONG_INT
:

5061 
max_v®ue
 = 0xFFFFFFFFULL;

5063 
HA_KEYTYPE_LONG_INT
:

5064 
max_v®ue
 = 0x7FFFFFFFULL;

5066 
HA_KEYTYPE_ULONGLONG
:

5067 
max_v®ue
 = 0xFFFFFFFFFFFFFFFFULL;

5069 
HA_KEYTYPE_LONGLONG
:

5070 
max_v®ue
 = 0x7FFFFFFFFFFFFFFFULL;

5072 
HA_KEYTYPE_FLOAT
:

5073 
max_v®ue
 = 0x1000000ULL;

5075 
HA_KEYTYPE_DOUBLE
:

5076 
max_v®ue
 = 0x20000000000000ULL;

5079 
	`abÜt
();

5082  
max_v®ue
;

5083 
	}
}

5085 
ha_rocksdb
::
	$lßd_auto_šü_v®ue
() {

5086 
ulÚglÚg
 
auto_šü
 = 0;

5087 
boŞ
 
v®id©e_Ï¡
 = 
çl£
, 
u£_d©adic
 = 
Œue
;

5088 #iâdeà
NDEBUG


5089 
	`DBUG_EXECUTE_IF
("myrocks_autošc_upg¿de", 
u£_d©adic
 = 
çl£
;);

5090 
v®id©e_Ï¡
 = 
Œue
;

5093 ià(
u£_d©adic
 && 
diù_mªag”
.
	`g‘_auto_šü_v®
(

5094 
m_tbl_def
->
	`g‘_autošü_gl_šdex_id
(), &
auto_šü
)) {

5095 
	`upd©e_auto_šü_v®
(
auto_šü
);

5106 ià(
auto_šü
 =ğ0 || 
v®id©e_Ï¡
) {

5107 
auto_šü
 = 
	`lßd_auto_šü_v®ue_äom_šdex
();

5108 
	`upd©e_auto_šü_v®
(
auto_šü
);

5113 ià(
m_tbl_def
->
m_auto_šü_v®
 == 0) {

5114 
	`upd©e_auto_šü_v®
(1);

5116 
	}
}

5118 
ulÚglÚg
 
ha_rocksdb
::
	$lßd_auto_šü_v®ue_äom_šdex
() {

5119 cÚ¡ 
§ve_aùive_šdex
 = 
aùive_šdex
;

5120 
aùive_šdex
 = 
bË
->
s
->
Ãxt_numb”_šdex
;

5121 cÚ¡ 
ušt8
 
§ve_bË_¡©us
 = 
bË
->
¡©us
;

5122 
ulÚglÚg
 
Ï¡_v®
 = 0;

5124 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

5125 cÚ¡ 
boŞ
 
is_Ãw_¢­shÙ
 = !
tx
->
	`has_¢­shÙ
();

5126 ià(
is_Ãw_¢­shÙ
) {

5127 
tx
->
	`acquœe_¢­shÙ
(
Œue
);

5133 cÚ¡ 
boŞ
 
§ve_key»ad_Úly
 = 
m_key»ad_Úly
;

5134 
m_key»ad_Úly
 = 
Œue
;

5135 
m_key_»que¡ed
 = 
Œue
;

5137 ià(!
	`šdex_Ï¡
(
bË
->
»cÜd
[0])) {

5138 
F›ld
 *
f›ld
 =

5139 
bË
->
key_šfo
[bË->
s
->
Ãxt_numb”_šdex
].
key_·¹
[0].
f›ld
;

5140 
ulÚglÚg
 
max_v®
 = 
	`rdb_g‘_št_cŞ_max_v®ue
(
f›ld
);

5141 
my_b™m­_m­
 *cÚ¡ 
Şd_m­
 =

5142 
	`dbug_tmp_u£_®l_cŞumns
(
bË
,abË->
»ad_£t
);

5143 
Ï¡_v®
 = 
f›ld
->
	`v®_št
();

5144 ià(
Ï¡_v®
 !ğ
max_v®
) {

5145 
Ï¡_v®
++;

5147 #iâdeà
NDEBUG


5148 
ulÚglÚg
 
dd_v®
;

5149 ià(
Ï¡_v®
 <ğ
max_v®
) {

5150 cÚ¡‡utØ&
gl_šdex_id
 = 
m_tbl_def
->
	`g‘_autošü_gl_šdex_id
();

5151 ià(
diù_mªag”
.
	`g‘_auto_šü_v®
(
gl_šdex_id
, &
dd_v®
) &&

5152 
tx
->
	`g‘_auto_šü
(
gl_šdex_id
) == 0) {

5153 
	`DBUG_ASSERT
(
dd_v®
 >ğ
Ï¡_v®
);

5157 
	`dbug_tmp_»¡Üe_cŞumn_m­
(
bË
->
»ad_£t
, 
Şd_m­
);

5160 
m_key»ad_Úly
 = 
§ve_key»ad_Úly
;

5161 ià(
is_Ãw_¢­shÙ
) {

5162 
tx
->
	`»Ëa£_¢­shÙ
();

5165 
bË
->
¡©us
 = 
§ve_bË_¡©us
;

5166 
aùive_šdex
 = 
§ve_aùive_šdex
;

5173 
	`»Ëa£_sÿn_™”©Ü
();

5175  
Ï¡_v®
;

5176 
	}
}

5178 
ha_rocksdb
::
	$upd©e_auto_šü_v®
(
ulÚglÚg
 
v®
) {

5179 
ulÚglÚg
 
auto_šü_v®
 = 
m_tbl_def
->
m_auto_šü_v®
;

5181 
auto_šü_v®
 < 
v®
 &&

5182 !
m_tbl_def
->
m_auto_šü_v®
.
	`com·»_exchªge_w—k
(
auto_šü_v®
, 
v®
)) {

5186 
	}
}

5188 
ha_rocksdb
::
	$upd©e_auto_šü_v®_äom_f›ld
() {

5189 
F›ld
 *
f›ld
;

5190 
ulÚglÚg
 
Ãw_v®
, 
max_v®
;

5191 
f›ld
 = 
bË
->
key_šfo
[bË->
s
->
Ãxt_numb”_šdex
].
key_·¹
[0].field;

5192 
max_v®
 = 
	`rdb_g‘_št_cŞ_max_v®ue
(
f›ld
);

5194 
my_b™m­_m­
 *cÚ¡ 
Şd_m­
 =

5195 
	`dbug_tmp_u£_®l_cŞumns
(
bË
,abË->
»ad_£t
);

5196 
Ãw_v®
 = 
f›ld
->
	`v®_št
();

5198 ià(
Ãw_v®
 !ğ
max_v®
) {

5199 
Ãw_v®
++;

5202 
	`dbug_tmp_»¡Üe_cŞumn_m­
(
bË
->
»ad_£t
, 
Şd_m­
);

5205 ià(
Ãw_v®
 <ğ
max_v®
) {

5206 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

5207 
tx
->
	`£t_auto_šü
(
m_tbl_def
->
	`g‘_autošü_gl_šdex_id
(), 
Ãw_v®
);

5210 
	`upd©e_auto_šü_v®
(
Ãw_v®
);

5212 
	}
}

5214 
ha_rocksdb
::
	$lßd_hidd’_pk_v®ue
() {

5215 cÚ¡ 
§ve_aùive_šdex
 = 
aùive_šdex
;

5216 
aùive_šdex
 = 
m_tbl_def
->
m_key_couÁ
 - 1;

5217 cÚ¡ 
ušt8
 
§ve_bË_¡©us
 = 
bË
->
¡©us
;

5219 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

5220 cÚ¡ 
boŞ
 
is_Ãw_¢­shÙ
 = !
tx
->
	`has_¢­shÙ
();

5222 
lÚglÚg
 
hidd’_pk_id
 = 1;

5224 ià(!
	`šdex_Ï¡
(
bË
->
»cÜd
[0])) {

5228 autØ
”r
 = 
	`»ad_hidd’_pk_id_äom_rowkey
(&
hidd’_pk_id
);

5229 ià(
”r
) {

5230 ià(
is_Ãw_¢­shÙ
) {

5231 
tx
->
	`»Ëa£_¢­shÙ
();

5233  
”r
;

5236 
hidd’_pk_id
++;

5239 
lÚglÚg
 
Şd
 = 
m_tbl_def
->
m_hidd’_pk_v®
;

5240 
Şd
 < 
hidd’_pk_id
 &&

5241 !
m_tbl_def
->
m_hidd’_pk_v®
.
	`com·»_exchªge_w—k
(
Şd
, 
hidd’_pk_id
)) {

5244 ià(
is_Ãw_¢­shÙ
) {

5245 
tx
->
	`»Ëa£_¢­shÙ
();

5248 
bË
->
¡©us
 = 
§ve_bË_¡©us
;

5249 
aùive_šdex
 = 
§ve_aùive_šdex
;

5251 
	`»Ëa£_sÿn_™”©Ü
();

5253  
HA_EXIT_SUCCESS
;

5254 
	}
}

5257 
lÚglÚg
 
ha_rocksdb
::
	$upd©e_hidd’_pk_v®
() {

5258 
	`DBUG_ASSERT
(
	`has_hidd’_pk
(
bË
));

5259 cÚ¡ 
lÚglÚg
 
Ãw_v®
 = 
m_tbl_def
->
m_hidd’_pk_v®
++;

5260  
Ãw_v®
;

5261 
	}
}

5264 
ha_rocksdb
::
	$»ad_hidd’_pk_id_äom_rowkey
(
lÚglÚg
 *cÚ¡ 
hidd’_pk_id
) {

5265 
	`DBUG_ASSERT
(
hidd’_pk_id
 !ğ
nuÎ±r
);

5266 
	`DBUG_ASSERT
(
bË
 !ğ
nuÎ±r
);

5267 
	`DBUG_ASSERT
(
	`has_hidd’_pk
(
bË
));

5269 
rocksdb
::
Sliû
 
	`rowkey_¦iû
(
m_Ï¡_rowkey
.
	`±r
(), m_Ï¡_rowkey.
	`Ëngth
());

5272 
Rdb_¡ršg_»ad”
 
	`»ad”
(&
rowkey_¦iû
);

5273 ià((!
»ad”
.
	`»ad
(
Rdb_key_def
::
INDEX_NUMBER_SIZE
)))

5274  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5276 cÚ¡ 
Ëngth
 = 
F›ld_lÚglÚg
::
PACK_LENGTH
;

5277 cÚ¡ 
uch¬
 *
äom
 = 
»š‹½»t_ÿ¡
<cÚ¡ uch¬ *>(
»ad”
.
	`»ad
(
Ëngth
));

5278 ià(
äom
 =ğ
nuÎ±r
) {

5280  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5283 *
hidd’_pk_id
 = 
	`rdb_Ãtbuf_»ad_ušt64
(&
äom
);

5284  
HA_EXIT_SUCCESS
;

5285 
	}
}

5294 
Rdb_İ’_bËs_m­
::
	$»Ëa£_bË_hªdËr
(

5295 
Rdb_bË_hªdËr
 *cÚ¡ 
bË_hªdËr
) {

5296 
	`RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

5298 
	`DBUG_ASSERT
(
bË_hªdËr
 !ğ
nuÎ±r
);

5299 
	`DBUG_ASSERT
(
bË_hªdËr
->
m_»f_couÁ
 > 0);

5300 ià(!--
bË_hªdËr
->
m_»f_couÁ
) {

5302 cÚ¡‡utØ
»t
 
	`MY_ATTRIBUTE
((
__unu£d__
)) =

5303 
	`my_hash_d–‘e
(&
m_hash
, 
»š‹½»t_ÿ¡
<
uch¬
 *>(
bË_hªdËr
));

5304 
	`DBUG_ASSERT
(!
»t
);

5305 
my_cÜe
::
	`thr_lock_d–‘e
(&
bË_hªdËr
->
m_thr_lock
);

5306 
	`my_ä“
(
bË_hªdËr
);

5309 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

5310 
	}
}

5312 
hªdËr
 *
	$rocksdb_ü—‹_hªdËr
(
my_cÜe
::
hªdË¹Ú
 *cÚ¡ 
htÚ
,

5313 
my_cÜe
::
TABLE_SHARE
 *cÚ¡ 
bË_¬g
,

5314 
my_cÜe
::
MEM_ROOT
 *cÚ¡ 
mem_roÙ
) {

5315  
	`Ãw
 (
mem_roÙ
è
	`ha_rocksdb
(
htÚ
, 
bË_¬g
);

5316 
	}
}

5318 
ha_rocksdb
::
	$ha_rocksdb
(
my_cÜe
::
hªdË¹Ú
 *cÚ¡ 
htÚ
,

5319 
my_cÜe
::
TABLE_SHARE
 *cÚ¡ 
bË_¬g
)

5320 : 
	`hªdËr
(
htÚ
, 
bË_¬g
), 
	`m_bË_hªdËr
(
nuÎ±r
), 
	`m_sÿn_™
(nullptr),

5321 
	`m_sÿn_™_sks_bloom
(
çl£
), 
	`m_sÿn_™_¢­shÙ
(
nuÎ±r
),

5322 
	`m_sÿn_™_low”_bound
(
nuÎ±r
), 
	`m_sÿn_™_uµ”_bound
(nullptr),

5323 
	`m_tbl_def
(
nuÎ±r
), 
	`m_pk_desü
ÒuÎ±r), 
	`m_key_desü_¬r
(nullptr),

5324 
	`m_pk_ÿn_be_decoded
(
çl£
), 
	`m_maybe_uÅack_šfo
(false),

5325 
	`m_pk_tu¶e
(
nuÎ±r
), 
	`m_pk_·cked_tu¶e
(nullptr),

5326 
	`m_sk_·cked_tu¶e
(
nuÎ±r
), 
	`m_’d_key_·cked_tu¶e
(nullptr),

5327 
	`m_sk_m©ch_´efix
(
nuÎ±r
), 
	`m_sk_m©ch_´efix_buf
(nullptr),

5328 
	`m_sk_·cked_tu¶e_Şd
(
nuÎ±r
), 
	`m_dup_sk_·cked_tu¶e
(nullptr),

5329 
	`m_dup_sk_·cked_tu¶e_Şd
(
nuÎ±r
), 
	`m_·ck_bufãr
(nullptr),

5330 
	`m_lock_rows
(
RDB_LOCK_NONE
), 
	`m_key»ad_Úly
(
FALSE
), 
	`m_’cod”_¬r
(
nuÎ±r
),

5331 
	`m_row_checksums_checked
(0), 
	`m_š_½l_d–‘e_rows
(
çl£
),

5332 
	`m_š_½l_upd©e_rows
(
çl£
), 
	$m_fÜû_sk_unique_check
(
çl£
è{
	}
}

5334 cÚ¡ *
ha_rocksdb_exts
[] = {
NuÎS
};

5336 cÚ¡ **
ha_rocksdb
::
	$bas_ext
() const {

5337 
	`DBUG_ENTER_FUNC
();

5339 
	`DBUG_RETURN
(
ha_rocksdb_exts
);

5340 
	}
}

5342 cÚ¡ 
¡d
::
¡ršg
 &
ha_rocksdb
::
	$g‘_bË_ba£Çme
() const {

5343  
m_tbl_def
->
	`ba£_bËÇme
();

5344 
	}
}

5351 
boŞ
 
ha_rocksdb
::
	$š™_w™h_f›lds
() {

5352 
	`DBUG_ENTER_FUNC
();

5354 cÚ¡ 
ušt
 
pk
 = 
bË_sh¬e
->
´im¬y_key
;

5355 ià(
pk
 !ğ
MAX_KEY
) {

5356 cÚ¡ 
ušt
 
key_·¹s
 = 
bË_sh¬e
->
key_šfo
[
pk
].
u£r_defšed_key_·¹s
;

5357 
	`check_key»ad_®lowed
(
pk
 , 
key_·¹s
 - 1, 
Œue
);

5359 
m_pk_ÿn_be_decoded
 = 
çl£
;

5361 
ÿched_bË_æags
 = 
	`bË_æags
();

5363 
	`DBUG_RETURN
(
çl£
);

5364 
	}
}

5377 
boŞ
 
ha_rocksdb
::
	$should_hide_‰l_»c
(cÚ¡ 
Rdb_key_def
 &
kd
,

5378 cÚ¡ 
rocksdb
::
Sliû
 &
‰l_»c_v®
,

5379 cÚ¡ 
št64_t
 
cu¼_ts
) {

5380 
	`DBUG_ASSERT
(
kd
.
	`has_‰l
());

5381 
	`DBUG_ASSERT
(
kd
.
m_‰l_»c_off£t
 !ğ
UINT_MAX
);

5392 ià(
cu¼_ts
 == 0) {

5393 
	`upd©e_row_¡©s
(
ROWS_HIDDEN_NO_SNAPSHOT
);

5394  
çl£
;

5397 ià(!
	`rdb_is_‰l_»ad_f‹ršg_’abËd
(è|| !
	`rdb_is_‰l_’abËd
()) {

5398  
çl£
;

5401 
Rdb_¡ršg_»ad”
 
	`»ad”
(&
‰l_»c_v®
);

5406 
ušt64
 
ts
;

5407 ià(!
»ad”
.
	`»ad
(
kd
.
m_‰l_»c_off£t
è||„—d”.
	`»ad_ušt64
(&
ts
)) {

5412 
¡d
::
¡ršg
 
buf
;

5413 
buf
 = 
	`rdb_hexdump
(
‰l_»c_v®
.
	`d©a
(),_»c_v®.
	`size
(),

5414 
RDB_MAX_HEXDUMP_LEN
);

5415 cÚ¡ 
GL_INDEX_ID
 
gl_šdex_id
 = 
kd
.
	`g‘_gl_šdex_id
();

5417 
	`sql_´št_”rÜ
("Decodingtl from PK value failed, "

5419 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
, 
buf
.
	`c_¡r
());

5420 
	`DBUG_ASSERT
(0);

5421  
çl£
;

5425 
ušt64
 
»ad_f‹r_ts
 = 0;

5426 #iâdeà
NDEBUG


5427 
»ad_f‹r_ts
 +ğ
	`rdb_dbug_£t_‰l_»ad_f‹r_ts
();

5429 
boŞ
 
is_hide_‰l
 =

5430 
ts
 + 
kd
.
m_‰l_du¿tiÚ
 + 
»ad_f‹r_ts
 <ğ
¡©ic_ÿ¡
<
ušt64
>(
cu¼_ts
);

5431 ià(
is_hide_‰l
) {

5432 
	`upd©e_row_¡©s
(
ROWS_FILTERED
);

5434  
is_hide_‰l
;

5435 
	}
}

5437 
ha_rocksdb
::
	$rocksdb_sk_expœed_»cÜds
(cÚ¡ 
Rdb_key_def
 &
kd
,

5438 
rocksdb
::
I‹¿tÜ
 *cÚ¡ 
™”
,

5439 
boŞ
 
£ek_backw¬d
) {

5440 ià(
kd
.
	`has_‰l
()) {

5441 
™”
->
	`V®id
() &&

5442 
	`should_hide_‰l_»c
(

5443 
kd
, 
™”
->
	`v®ue
(),

5444 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
)->
m_¢­shÙ_time¡amp
)) {

5445 
	`rocksdb_sm¬t_Ãxt
(
£ek_backw¬d
, 
™”
);

5448 
	}
}

5459 
ha_rocksdb
::
	$cÚv”t_»cÜd_to_¡Üage_fÜm©
(

5460 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
, 
rocksdb
::
Sliû
 *cÚ¡ 
·cked_»c
) {

5461 
	`DBUG_ASSERT_IMP
(
m_maybe_uÅack_šfo
, 
row_šfo
.
Ãw_pk_uÅack_šfo
);

5462 
	`DBUG_ASSERT
(
m_pk_desü
 !ğ
nuÎ±r
);

5464 cÚ¡ 
rocksdb
::
Sliû
 &
pk_·cked_¦iû
 = 
row_šfo
.
Ãw_pk_¦iû
;

5465 
Rdb_¡ršg_wr™”
 *cÚ¡ 
pk_uÅack_šfo
 = 
row_šfo
.
Ãw_pk_uÅack_šfo
;

5466 
boŞ
 
has_‰l
 = 
m_pk_desü
->
	`has_‰l
();

5467 
boŞ
 
has_‰l_cŞumn
 = !
m_pk_desü
->
m_‰l_cŞumn
.
	`em±y
();

5468 
boŞ
 
‰l_š_pk
 = 
has_‰l_cŞumn
 && (
row_šfo
.
‰l_pk_off£t
 !ğ
UINT_MAX
);

5470 
m_¡Üage_»cÜd
.
	`Ëngth
(0);

5472 ià(
has_‰l
) {

5474 
m_¡Üage_»cÜd
.
	`fl
(
ROCKSDB_SIZEOF_TTL_RECORD
 + 
m_nuÎ_by‹s_š_»c
, 0);

5475 
m_‰l_by‹s_upd©ed
 = 
çl£
;

5481 ià(
‰l_š_pk
) {

5482 
Rdb_¡ršg_»ad”
 
	`»ad”
(&
pk_·cked_¦iû
);

5483 cÚ¡ *
ts
;

5484 ià(!
»ad”
.
	`»ad
(
row_šfo
.
‰l_pk_off£t
) ||

5485 !(
ts
 = 
»ad”
.
	`»ad
(
ROCKSDB_SIZEOF_TTL_RECORD
))) {

5486 
¡d
::
¡ršg
 
buf
;

5487 
buf
 = 
	`rdb_hexdump
(
pk_·cked_¦iû
.
	`d©a
(),…k_·cked_¦iû.
	`size
(),

5488 
RDB_MAX_HEXDUMP_LEN
);

5489 cÚ¡ 
GL_INDEX_ID
 
gl_šdex_id
 = 
m_pk_desü
->
	`g‘_gl_šdex_id
();

5491 
	`sql_´št_”rÜ
("Decodingtl from PK failed during insert, "

5493 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
, 
buf
.
	`c_¡r
());

5494  
HA_EXIT_FAILURE
;

5497 *cÚ¡ 
d©a
 = 
cÚ¡_ÿ¡
<*>(
m_¡Üage_»cÜd
.
	`±r
());

5498 
	`memıy
(
d©a
, 
ts
, 
ROCKSDB_SIZEOF_TTL_RECORD
);

5499 #iâdeà
NDEBUG


5501 
	`rdb_Ãtbuf_¡Üe_ušt64
(

5502 
»š‹½»t_ÿ¡
<
uch¬
 *>(
d©a
),

5503 
	`rdb_Ãtbuf_to_ušt64
(
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
d©a
)) +

5504 
	`rdb_dbug_£t_‰l_»c_ts
());

5507 
	`memıy
(
m_‰l_by‹s
, 
d©a
, 
ROCKSDB_SIZEOF_TTL_RECORD
);

5508 } ià(!
has_‰l_cŞumn
) {

5516 ià(!
row_šfo
.
Şd_pk_¦iû
.
	`em±y
()) {

5517 *cÚ¡ 
d©a
 = 
cÚ¡_ÿ¡
<*>(
m_¡Üage_»cÜd
.
	`±r
());

5518 
	`memıy
(
d©a
, 
m_‰l_by‹s
, (
ušt64
));

5520 
ušt64
 
ts
 = 
¡©ic_ÿ¡
<ušt64>(
¡d
::
	`time
(
nuÎ±r
));

5521 #iâdeà
NDEBUG


5522 
ts
 +ğ
	`rdb_dbug_£t_‰l_»c_ts
();

5524 *cÚ¡ 
d©a
 = 
cÚ¡_ÿ¡
<*>(
m_¡Üage_»cÜd
.
	`±r
());

5525 
	`rdb_Ãtbuf_¡Üe_ušt64
(
»š‹½»t_ÿ¡
<
uch¬
 *>(
d©a
), 
ts
);

5527 
	`memıy
(
m_‰l_by‹s
, 
d©a
, 
ROCKSDB_SIZEOF_TTL_RECORD
);

5532 
m_¡Üage_»cÜd
.
	`fl
(
m_nuÎ_by‹s_š_»c
, 0);

5538 ià(
m_maybe_uÅack_šfo
) {

5539 
m_¡Üage_»cÜd
.
	`­³nd
(
»š‹½»t_ÿ¡
<*>(
pk_uÅack_šfo
->
	`±r
()),

5540 
pk_uÅack_šfo
->
	`g‘_cu¼’t_pos
());

5543 
ušt
 
i
 = 0; i < 
bË
->
s
->
f›lds
; i++) {

5545 ià(
m_’cod”_¬r
[
i
].
m_¡Üage_ty³
 !ğ
Rdb_f›ld_’cod”
::
STORE_ALL
) {

5549 
F›ld
 *cÚ¡ 
f›ld
 = 
bË
->f›ld[
i
];

5550 ià(
m_’cod”_¬r
[
i
].
	`maybe_nuÎ
()) {

5551 *
d©a
 = 
cÚ¡_ÿ¡
<*>(
m_¡Üage_»cÜd
.
	`±r
());

5552 ià(
has_‰l
) {

5553 
d©a
 +ğ
ROCKSDB_SIZEOF_TTL_RECORD
;

5556 ià(
f›ld
->
	`is_nuÎ
()) {

5557 
d©a
[
m_’cod”_¬r
[
i
].
m_nuÎ_off£t
] |ğm_’cod”_¬r[i].
m_nuÎ_mask
;

5563 ià(
m_’cod”_¬r
[
i
].
m_f›ld_ty³
 =ğ
MYSQL_TYPE_BLOB
) {

5564 
my_cÜe
::
F›ld_blob
 *
blob
 = (my_cÜe::F›ld_blob *)
f›ld
;

5566 cÚ¡ 
ušt
 
Ëngth_by‹s
 = 
blob
->
	`·ck_Ëngth
(è- 
pÜbË_sizeof_ch¬_±r
;

5569 
m_¡Üage_»cÜd
.
	`­³nd
(
»š‹½»t_ÿ¡
<*>(
blob
->
±r
),

5570 
Ëngth_by‹s
);

5573 *
d©a_±r
;

5574 
	`memıy
(&
d©a_±r
, 
blob
->
±r
 + 
Ëngth_by‹s
, (
uch¬
 **));

5575 
m_¡Üage_»cÜd
.
	`­³nd
(
d©a_±r
, 
blob
->
	`g‘_Ëngth
());

5576 } ià(
m_’cod”_¬r
[
i
].
m_f›ld_ty³
 =ğ
MYSQL_TYPE_VARCHAR
) {

5577 
F›ld_v¬¡ršg
 *cÚ¡ 
f›ld_v¬
 = (F›ld_v¬¡ršg *)
f›ld
;

5578 
ušt
 
d©a_Ën
;

5580 ià(
f›ld_v¬
->
Ëngth_by‹s
 == 1) {

5581 
d©a_Ën
 = 
f›ld_v¬
->
±r
[0];

5583 
	`DBUG_ASSERT
(
f›ld_v¬
->
Ëngth_by‹s
 == 2);

5584 
d©a_Ën
 = 
	`ušt2kÜr
(
f›ld_v¬
->
±r
);

5586 
m_¡Üage_»cÜd
.
	`­³nd
(
»š‹½»t_ÿ¡
<*>(
f›ld_v¬
->
±r
),

5587 
f›ld_v¬
->
Ëngth_by‹s
 + 
d©a_Ën
);

5590 cÚ¡ 
ušt
 
Ën
 = 
f›ld
->
	`·ck_Ëngth_š_»c
();

5591 
m_¡Üage_»cÜd
.
	`­³nd
(
»š‹½»t_ÿ¡
<*>(
f›ld
->
±r
), 
Ën
);

5597 ià(
has_‰l
 && 
has_‰l_cŞumn
 &&

5598 
i
 =ğ
m_pk_desü
->
	`g‘_‰l_f›ld_off£t
()) {

5599 
	`DBUG_ASSERT
(
Ën
 =ğ
ROCKSDB_SIZEOF_TTL_RECORD
);

5600 
	`DBUG_ASSERT
(
f›ld
->
	`»®_ty³
(è=ğ
MYSQL_TYPE_LONGLONG
);

5601 
	`DBUG_ASSERT
(
m_pk_desü
->
	`g‘_‰l_f›ld_off£t
(è!ğ
UINT_MAX
);

5603 *cÚ¡ 
d©a
 = 
cÚ¡_ÿ¡
<*>(
m_¡Üage_»cÜd
.
	`±r
());

5604 
ušt64
 
ts
 = 
	`ušt8kÜr
(
f›ld
->
±r
);

5605 #iâdeà
NDEBUG


5606 
ts
 +ğ
	`rdb_dbug_£t_‰l_»c_ts
();

5608 
	`rdb_Ãtbuf_¡Üe_ušt64
(
»š‹½»t_ÿ¡
<
uch¬
 *>(
d©a
), 
ts
);

5612 ià(!
row_šfo
.
Şd_pk_¦iû
.
	`em±y
()) {

5613 
m_‰l_by‹s_upd©ed
 =

5614 
	`memcmp
(
m_‰l_by‹s
, 
d©a
, 
ROCKSDB_SIZEOF_TTL_RECORD
);

5617 
	`memıy
(
m_‰l_by‹s
, 
d©a
, 
ROCKSDB_SIZEOF_TTL_RECORD
);

5622 ià(
	`should_¡Üe_row_debug_checksums
()) {

5623 cÚ¡ 
ušt32_t
 
key_üc32
 = 
my_cÜe
::
	`üc32
(

5624 0, 
	`rdb_¦iû_to_uch¬_±r
(&
pk_·cked_¦iû
),…k_·cked_¦iû.
	`size
());

5625 cÚ¡ 
ušt32_t
 
v®_üc32
 =

5626 
my_cÜe
::
	`üc32
(0, 
	`rdb_mysql_¡r_to_uch¬_¡r
(&
m_¡Üage_»cÜd
),

5627 
m_¡Üage_»cÜd
.
	`Ëngth
());

5628 
uch¬
 
key_üc_buf
[
RDB_CHECKSUM_SIZE
];

5629 
uch¬
 
v®_üc_buf
[
RDB_CHECKSUM_SIZE
];

5630 
	`rdb_Ãtbuf_¡Üe_ušt32
(
key_üc_buf
, 
key_üc32
);

5631 
	`rdb_Ãtbuf_¡Üe_ušt32
(
v®_üc_buf
, 
v®_üc32
);

5632 
m_¡Üage_»cÜd
.
	`­³nd
((cÚ¡ *)&
RDB_CHECKSUM_DATA_TAG
, 1);

5633 
m_¡Üage_»cÜd
.
	`­³nd
((cÚ¡ *)
key_üc_buf
, 
RDB_CHECKSUM_SIZE
);

5634 
m_¡Üage_»cÜd
.
	`­³nd
((cÚ¡ *)
v®_üc_buf
, 
RDB_CHECKSUM_SIZE
);

5637 *
·cked_»c
 =

5638 
rocksdb
::
	`Sliû
(
m_¡Üage_»cÜd
.
	`±r
(), m_¡Üage_»cÜd.
	`Ëngth
());

5640  
HA_EXIT_SUCCESS
;

5641 
	}
}

5659 
ha_rocksdb
::
	$£tup_»ad_decod”s
() {

5660 
m_decod”s_veù
.
	`ş—r
();

5661 
m_key_»que¡ed
 = 
çl£
;

5663 
Ï¡_u£ful
 = 0;

5664 
sk_size
 = 0;

5666 
ušt
 
i
 = 0; i < 
bË
->
s
->
f›lds
; i++) {

5668 cÚ¡ 
boŞ
 
f›ld_»que¡ed
 =

5669 
m_lock_rows
 =ğ
RDB_LOCK_WRITE
 || 
m_v”ify_row_debug_checksums
 ||

5670 
	`b™m­_is_ş—r_®l
(
bË
->
»ad_£t
) ||

5671 
	`b™m­_is_£t
(
bË
->
»ad_£t
,abË->
f›ld
[
i
]->
f›ld_šdex
);

5674 ià(
m_’cod”_¬r
[
i
].
m_¡Üage_ty³
 !ğ
Rdb_f›ld_’cod”
::
STORE_ALL
) {

5676 ià(
f›ld_»que¡ed
) {

5678 
m_key_»que¡ed
 = 
Œue
;

5683 ià(
f›ld_»que¡ed
) {

5685 
m_decod”s_veù
.
	`push_back
({&
m_’cod”_¬r
[
i
], 
Œue
, 
sk_size
});

5686 
Ï¡_u£ful
 = 
m_decod”s_veù
.
	`size
();

5687 
sk_size
 = 0;

5689 ià(
m_’cod”_¬r
[
i
].
	`u£s_v¬ŸbË_Ën_’codšg
() ||

5690 
m_’cod”_¬r
[
i
].
	`maybe_nuÎ
()) {

5692 
m_decod”s_veù
.
	`push_back
({&
m_’cod”_¬r
[
i
], 
çl£
, 
sk_size
});

5693 
sk_size
 = 0;

5697 
sk_size
 +ğ
m_’cod”_¬r
[
i
].
m_·ck_Ëngth_š_»c
;

5704 
m_decod”s_veù
.
	`”a£
(m_decod”s_veù.
	`begš
(è+ 
Ï¡_u£ful
,

5705 
m_decod”s_veù
.
	`’d
());

5706 
	}
}

5708 #iâdeà
NDEBUG


5709 
	$dbug_­³nd_g¬bage_©_’d
(
rocksdb
::
PšÇbËSliû
 *
Ú_disk_»c
) {

5710 
¡d
::
¡ršg
 
	`¡r
(
Ú_disk_»c
->
	`d©a
(), on_disk_»c->
	`size
());

5711 
Ú_disk_»c
->
	`Re£t
();

5712 
¡r
.
	`­³nd
("abc");

5713 
Ú_disk_»c
->
	`PšS–f
(
rocksdb
::
	`Sliû
(
¡r
));

5714 
	}
}

5716 
	$dbug_Œunÿ‹_»cÜd
(
rocksdb
::
PšÇbËSliû
 *
Ú_disk_»c
) {

5717 
Ú_disk_»c
->
	`»move_suffix
(Ú_disk_»c->
	`size
());

5718 
	}
}

5720 
	$dbug_modify_»c_v¬ch¬12
(
rocksdb
::
PšÇbËSliû
 *
Ú_disk_»c
) {

5721 
¡d
::
¡ršg
 
»s
;

5724 
»s
.
	`­³nd
("\0", 1);

5726 
»s
.
	`­³nd
("\xC", 1);

5727 
»s
.
	`­³nd
("123456789ab", 12);

5729 
Ú_disk_»c
->
	`Re£t
();

5730 
Ú_disk_»c
->
	`PšS–f
(
rocksdb
::
	`Sliû
(
»s
));

5731 
	}
}

5733 
	$dbug_modify_key_v¬ch¬8
(
SŒšg
 &
Ú_disk_»c
) {

5734 
¡d
::
¡ršg
 
»s
;

5736 
»s
.
	`­³nd
(
Ú_disk_»c
.
	`±r
(), 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

5739 
»s
.
	`­³nd
("ABCDE\0\0\0\xFC", 9);

5740 
Ú_disk_»c
.
	`Ëngth
(0);

5741 
Ú_disk_»c
.
	`­³nd
(
»s
.
	`d©a
(),„es.
	`size
());

5742 
	}
}

5744 
	$dbug_ü—‹_”r_š¶aû_®‹r
() {

5745 
	`my_´štf_”rÜ
(
ER_UNKNOWN_ERROR
,

5746 "IÁ’tiÚ® fau» iÀš¶aû‡É” occu¼ed.", 
	`MYF
(0));

5747 
	}
}

5750 
ha_rocksdb
::
	$cÚv”t_»cÜd_äom_¡Üage_fÜm©
(

5751 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
key
, 
uch¬
 *cÚ¡ 
buf
) {

5753 
	`DBUG_EXECUTE_IF
("myrocks_simulate_bad_row_read1",

5754 
	`dbug_­³nd_g¬bage_©_’d
(&
m_»Œ›ved_»cÜd
););

5755 
	`DBUG_EXECUTE_IF
("myrocks_simulate_bad_row_read2",

5756 
	`dbug_Œunÿ‹_»cÜd
(&
m_»Œ›ved_»cÜd
););

5757 
	`DBUG_EXECUTE_IF
("myrocks_simulate_bad_row_read3",

5758 
	`dbug_modify_»c_v¬ch¬12
(&
m_»Œ›ved_»cÜd
););

5760  
	`cÚv”t_»cÜd_äom_¡Üage_fÜm©
(
key
, &
m_»Œ›ved_»cÜd
, 
buf
);

5761 
	}
}

5763 
ha_rocksdb
::
	$cÚv”t_blob_äom_¡Üage_fÜm©
(

5764 
my_cÜe
::
F›ld_blob
 *cÚ¡ 
blob
,

5765 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

5766 
boŞ
 
decode
)

5769 cÚ¡ 
ušt
 
Ëngth_by‹s
 = 
blob
->
	`·ck_Ëngth
(è- 
pÜbË_sizeof_ch¬_±r
;

5771 cÚ¡ *
d©a_Ën_¡r
;

5772 ià(!(
d©a_Ën_¡r
 = 
»ad”
->
	`»ad
(
Ëngth_by‹s
))) {

5773  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5776 
	`memıy
(
blob
->
±r
, 
d©a_Ën_¡r
, 
Ëngth_by‹s
);

5778 cÚ¡ 
ušt32
 
d©a_Ën
 = 
blob
->
	`g‘_Ëngth
(

5779 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
*>(
d©a_Ën_¡r
), 
Ëngth_by‹s
,

5780 
bË
->
s
->
db_low_by‹_fœ¡
);

5781 cÚ¡ *
blob_±r
;

5782 ià(!(
blob_±r
 = 
»ad”
->
	`»ad
(
d©a_Ën
))) {

5783  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5786 ià(
decode
) {

5789 
	`mem£t
(
blob
->
±r
 + 
Ëngth_by‹s
, 0, 8);

5790 
	`memıy
(
blob
->
±r
 + 
Ëngth_by‹s
, &
blob_±r
, (
uch¬
 **));

5793  
HA_EXIT_SUCCESS
;

5794 
	}
}

5796 
ha_rocksdb
::
	$cÚv”t_v¬ch¬_äom_¡Üage_fÜm©
(

5797 
my_cÜe
::
F›ld_v¬¡ršg
 *cÚ¡ 
f›ld_v¬
,

5798 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

5799 
boŞ
 
decode
)

5801 cÚ¡ *
d©a_Ën_¡r
;

5802 ià(!(
d©a_Ën_¡r
 = 
»ad”
->
	`»ad
(
f›ld_v¬
->
Ëngth_by‹s
)))

5803  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5805 
ušt
 
d©a_Ën
;

5807 ià(
f›ld_v¬
->
Ëngth_by‹s
 == 1) {

5808 
d©a_Ën
 = (
uch¬
)
d©a_Ën_¡r
[0];

5810 
	`DBUG_ASSERT
(
f›ld_v¬
->
Ëngth_by‹s
 == 2);

5811 
d©a_Ën
 = 
	`ušt2kÜr
(
d©a_Ën_¡r
);

5814 ià(
d©a_Ën
 > 
f›ld_v¬
->
f›ld_Ëngth
) {

5816  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5819 ià(!
»ad”
->
	`»ad
(
d©a_Ën
)) {

5820  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5823 ià(
decode
) {

5824 
	`memıy
(
f›ld_v¬
->
±r
, 
d©a_Ën_¡r
, f›ld_v¬->
Ëngth_by‹s
 + 
d©a_Ën
);

5827  
HA_EXIT_SUCCESS
;

5828 
	}
}

5830 
ha_rocksdb
::
	$cÚv”t_f›ld_äom_¡Üage_fÜm©
(

5831 
my_cÜe
::
F›ld
 *cÚ¡ 
f›ld
,

5832 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

5833 
boŞ
 
decode
,

5834 
ušt
 
Ën
)

5836 cÚ¡ *
d©a_by‹s
;

5837 ià(
Ën
 > 0) {

5838 ià((
d©a_by‹s
 = 
»ad”
->
	`»ad
(
Ën
)è=ğ
nuÎ±r
) {

5839  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5842 ià(
decode
)

5843 
	`memıy
(
f›ld
->
±r
, 
d©a_by‹s
, 
Ën
);

5846  
HA_EXIT_SUCCESS
;

5847 
	}
}

5873 
ha_rocksdb
::
	$cÚv”t_»cÜd_äom_¡Üage_fÜm©
(

5874 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
key
, cÚ¡„ocksdb::Sliû *cÚ¡ 
v®ue
,

5875 
uch¬
 *cÚ¡ 
buf
) {

5876 
	`DBUG_ASSERT
(
key
 !ğ
nuÎ±r
);

5877 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

5879 
Rdb_¡ršg_»ad”
 
	`»ad”
(
v®ue
);

5884 
	`DBUG_EXECUTE_IF
("myrocks_simulate_bad_pk_read1",

5885 
	`dbug_modify_key_v¬ch¬8
(
m_Ï¡_rowkey
););

5887 cÚ¡ 
rocksdb
::
Sliû
 
	`rowkey_¦iû
(
m_Ï¡_rowkey
.
	`±r
(),

5888 
m_Ï¡_rowkey
.
	`Ëngth
());

5889 cÚ¡ *
uÅack_šfo
 = 
nuÎ±r
;

5890 
ušt16
 
uÅack_šfo_Ën
 = 0;

5891 
rocksdb
::
Sliû
 
uÅack_¦iû
;

5894 cÚ¡ *
‰l_by‹s
;

5895 ià(
m_pk_desü
->
	`has_‰l
()) {

5896 ià((
‰l_by‹s
 = 
»ad”
.
	`»ad
(
ROCKSDB_SIZEOF_TTL_RECORD
))) {

5897 
	`memıy
(
m_‰l_by‹s
, 
‰l_by‹s
, 
ROCKSDB_SIZEOF_TTL_RECORD
);

5899  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5904 cÚ¡ *
nuÎ_by‹s
 = 
nuÎ±r
;

5905 ià(
m_nuÎ_by‹s_š_»c
 && !(
nuÎ_by‹s
 = 
»ad”
.
	`»ad
(m_null_bytes_in_rec))) {

5906  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5909 ià(
m_maybe_uÅack_šfo
) {

5910 
uÅack_šfo
 = 
»ad”
.
	`g‘_cu¼’t_±r
();

5911 ià(!
uÅack_šfo
 || !
Rdb_key_def
::
	`is_uÅack_d©a_g
(unpack_info[0]) ||

5912 !
»ad”
.
	`»ad
(
Rdb_key_def
::
	`g‘_uÅack_h—d”_size
(
uÅack_šfo
[0]))) {

5913  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5916 
uÅack_šfo_Ën
 =

5917 
	`rdb_Ãtbuf_to_ušt16
(
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
uÅack_šfo
 + 1));

5918 
uÅack_¦iû
 = 
rocksdb
::
	`Sliû
(
uÅack_šfo
, 
uÅack_šfo_Ën
);

5920 
»ad”
.
	`»ad
(
uÅack_šfo_Ën
 -

5921 
Rdb_key_def
::
	`g‘_uÅack_h—d”_size
(
uÅack_šfo
[0]));

5924 
”r
 = 
HA_EXIT_SUCCESS
;

5925 ià(
m_key_»que¡ed
) {

5926 
”r
 = 
m_pk_desü
->
	`uÅack_»cÜd
(
bË
, 
buf
, &
rowkey_¦iû
,

5927 
uÅack_šfo
 ? &
uÅack_¦iû
 : 
nuÎ±r
,

5928 
çl£
 );

5931 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

5932  
”r
;

5935 autØ
™
 = 
m_decod”s_veù
.
	`begš
(); iˆ!ğm_decod”s_veù.
	`’d
(); it++) {

5936 cÚ¡ 
Rdb_f›ld_’cod”
 *cÚ¡ 
f›ld_dec
 = 
™
->
m_f›ld_’c
;

5937 cÚ¡ 
boŞ
 
decode
 = 
™
->
m_decode
;

5938 cÚ¡ 
boŞ
 
isNuÎ
 =

5939 
f›ld_dec
->
	`maybe_nuÎ
() &&

5940 ((
nuÎ_by‹s
[
f›ld_dec
->
m_nuÎ_off£t
] & f›ld_dec->
m_nuÎ_mask
) != 0);

5942 
F›ld
 *cÚ¡ 
f›ld
 = 
bË
->f›ld[
f›ld_dec
->
m_f›ld_šdex
];

5945 ià(
™
->
m_sk
 && !
»ad”
.
	`»ad
(it->m_skip)) {

5946  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

5949 
ušt
 
f›ld_off£t
 = 
f›ld
->
±r
 - 
bË
->
»cÜd
[0];

5950 
ušt
 
nuÎ_off£t
 = 
f›ld
->
	`nuÎ_off£t
();

5951 
boŞ
 
maybe_nuÎ
 = 
f›ld
->
	`»®_maybe_nuÎ
();

5952 
f›ld
->
	`move_f›ld
(
buf
 + 
f›ld_off£t
,

5953 
maybe_nuÎ
 ? 
buf
 + 
nuÎ_off£t
 : 
nuÎ±r
,

5954 
f›ld
->
nuÎ_b™
);

5957 ià(
isNuÎ
) {

5958 ià(
decode
) {

5960 
f›ld
->
	`£t_nuÎ
();

5965 
	`memıy
(
f›ld
->
±r
, 
bË
->
s
->
deçuÉ_v®ues
 + 
f›ld_off£t
,

5966 
f›ld
->
	`·ck_Ëngth
());

5969 ià(
decode
) {

5970 
f›ld
->
	`£t_nÙnuÎ
();

5973 ià(
f›ld_dec
->
m_f›ld_ty³
 =ğ
MYSQL_TYPE_BLOB
) {

5974 
”r
 = 
	`cÚv”t_blob_äom_¡Üage_fÜm©
(

5975 (
my_cÜe
::
F›ld_blob
 *è
f›ld
, &
»ad”
, 
decode
);

5976 } ià(
f›ld_dec
->
m_f›ld_ty³
 =ğ
MYSQL_TYPE_VARCHAR
) {

5977 
”r
 = 
	`cÚv”t_v¬ch¬_äom_¡Üage_fÜm©
(

5978 (
my_cÜe
::
F›ld_v¬¡ršg
 *è
f›ld
, &
»ad”
, 
decode
);

5980 
”r
 = 
	`cÚv”t_f›ld_äom_¡Üage_fÜm©
(

5981 
f›ld
, &
»ad”
, 
decode
, 
f›ld_dec
->
m_·ck_Ëngth_š_»c
);

5986 
f›ld
->
	`move_f›ld
(
bË
->
»cÜd
[0] + 
f›ld_off£t
,

5987 
maybe_nuÎ
 ? 
bË
->
»cÜd
[0] + 
nuÎ_off£t
 : 
nuÎ±r
,

5988 
f›ld
->
nuÎ_b™
);

5990 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

5991  
”r
;

5995 ià(
m_v”ify_row_debug_checksums
) {

5996 ià(
»ad”
.
	`»maššg_by‹s
(è=ğ
RDB_CHECKSUM_CHUNK_SIZE
 &&

5997 
»ad”
.
	`»ad
(1)[0] =ğ
RDB_CHECKSUM_DATA_TAG
) {

5998 
ušt32_t
 
¡Üed_key_chksum
 =

5999 
	`rdb_Ãtbuf_to_ušt32
((cÚ¡ 
uch¬
 *)
»ad”
.
	`»ad
(
RDB_CHECKSUM_SIZE
));

6000 
ušt32_t
 
¡Üed_v®_chksum
 =

6001 
	`rdb_Ãtbuf_to_ušt32
((cÚ¡ 
uch¬
 *)
»ad”
.
	`»ad
(
RDB_CHECKSUM_SIZE
));

6003 cÚ¡ 
ušt32_t
 
compu‹d_key_chksum
 =

6004 
my_cÜe
::
	`üc32
(0, 
	`rdb_¦iû_to_uch¬_±r
(
key
), key->
	`size
());

6005 cÚ¡ 
ušt32_t
 
compu‹d_v®_chksum
 =

6006 
my_cÜe
::
	`üc32
(0, 
	`rdb_¦iû_to_uch¬_±r
(
v®ue
),

6007 
v®ue
->
	`size
(è- 
RDB_CHECKSUM_CHUNK_SIZE
);

6009 
	`DBUG_EXECUTE_IF
("myrocks_simulate_bad_pk_checksum1",

6010 
¡Üed_key_chksum
++;);

6012 ià(
¡Üed_key_chksum
 !ğ
compu‹d_key_chksum
) {

6013 
m_pk_desü
->
	`»pÜt_checksum_mism©ch
(
Œue
, 
key
->
	`d©a
(), key->
	`size
());

6014  
HA_ERR_ROCKSDB_CHECKSUM_MISMATCH
;

6017 
	`DBUG_EXECUTE_IF
("myrocks_simulate_bad_pk_checksum2",

6018 
¡Üed_v®_chksum
++;);

6019 ià(
¡Üed_v®_chksum
 !ğ
compu‹d_v®_chksum
) {

6020 
m_pk_desü
->
	`»pÜt_checksum_mism©ch
(
çl£
, 
v®ue
->
	`d©a
(),

6021 
v®ue
->
	`size
());

6022  
HA_ERR_ROCKSDB_CHECKSUM_MISMATCH
;

6025 
m_row_checksums_checked
++;

6027 ià(
»ad”
.
	`»maššg_by‹s
())

6028  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

6031  
HA_EXIT_SUCCESS
;

6032 
	}
}

6034 
ha_rocksdb
::
	$g‘_¡Üage_ty³
(
Rdb_f›ld_’cod”
 *cÚ¡ 
’cod”
,

6035 cÚ¡ 
ušt
 &
kp
) {

6037 ià(
m_pk_desü
->
	`has_uÅack_šfo
(
kp
)) {

6038 
	`DBUG_ASSERT
(
m_pk_desü
->
	`ÿn_uÅack
(
kp
));

6039 
’cod”
->
m_¡Üage_ty³
 = 
Rdb_f›ld_’cod”
::
STORE_SOME
;

6040 
m_maybe_uÅack_šfo
 = 
Œue
;

6041 } ià(
m_pk_desü
->
	`ÿn_uÅack
(
kp
)) {

6042 
’cod”
->
m_¡Üage_ty³
 = 
Rdb_f›ld_’cod”
::
STORE_NONE
;

6044 
	}
}

6055 
ha_rocksdb
::
	$£tup_f›ld_cÚv”‹rs
() {

6056 
ušt
 
i
;

6057 
ušt
 
nuÎ_by‹s
 = 0;

6058 
uch¬
 
cur_nuÎ_mask
 = 0x1;

6060 
	`DBUG_ASSERT
(
m_’cod”_¬r
 =ğ
nuÎ±r
);

6061 
m_’cod”_¬r
 = 
¡©ic_ÿ¡
<
Rdb_f›ld_’cod”
 *>(

6062 
	`my_m®loc
(
bË
->
s
->
f›lds
 * (
Rdb_f›ld_’cod”
), 
	`MYF
(0)));

6063 ià(
m_’cod”_¬r
 =ğ
nuÎ±r
) {

6067 
i
 = 0; i < 
bË
->
s
->
f›lds
; i++) {

6068 
F›ld
 *cÚ¡ 
f›ld
 = 
bË
->f›ld[
i
];

6069 
m_’cod”_¬r
[
i
].
m_¡Üage_ty³
 = 
Rdb_f›ld_’cod”
::
STORE_ALL
;

6081 ià(!
	`has_hidd’_pk
(
bË
)) {

6082 
KEY
 *cÚ¡ 
pk_šfo
 = &
bË
->
key_šfo
[bË->
s
->
´im¬y_key
];

6083 
ušt
 
kp
 = 0; k°< 
pk_šfo
->
u£r_defšed_key_·¹s
; kp++) {

6085 ià(
f›ld
->
f›ld_šdex
 + 1 =ğ
pk_šfo
->
key_·¹
[
kp
].
f›ldÄ
) {

6086 
	`g‘_¡Üage_ty³
(&
m_’cod”_¬r
[
i
], 
kp
);

6092 
m_’cod”_¬r
[
i
].
m_f›ld_ty³
 = 
f›ld
->
	`»®_ty³
();

6093 
m_’cod”_¬r
[
i
].
m_f›ld_šdex
 = i;

6094 
m_’cod”_¬r
[
i
].
m_·ck_Ëngth_š_»c
 = 
f›ld
->
	`·ck_Ëngth_š_»c
();

6096 ià(
f›ld
->
	`»®_maybe_nuÎ
()) {

6097 
m_’cod”_¬r
[
i
].
m_nuÎ_mask
 = 
cur_nuÎ_mask
;

6098 
m_’cod”_¬r
[
i
].
m_nuÎ_off£t
 = 
nuÎ_by‹s
;

6099 ià(
cur_nuÎ_mask
 == 0x80) {

6100 
cur_nuÎ_mask
 = 0x1;

6101 
nuÎ_by‹s
++;

6103 
cur_nuÎ_mask
 = cur_null_mask << 1;

6105 
m_’cod”_¬r
[
i
].
m_nuÎ_mask
 = 0;

6110 ià(
cur_nuÎ_mask
 != 0x1)

6111 
nuÎ_by‹s
++;

6113 
m_nuÎ_by‹s_š_»c
 = 
nuÎ_by‹s
;

6114 
	}
}

6116 
ha_rocksdb
::
	$®loc_key_bufãrs
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

6117 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

6118 
boŞ
 
®loc_®‹r_bufãrs
) {

6119 
	`DBUG_ENTER_FUNC
();

6121 
	`DBUG_ASSERT
(
m_pk_tu¶e
 =ğ
nuÎ±r
);

6122 
	`DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

6124 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
kd_¬r
 = 
tbl_def_¬g
->
m_key_desü_¬r
;

6126 
ušt
 
key_Ën
 = 0;

6127 
ušt
 
max_·cked_sk_Ën
 = 0;

6128 
ušt
 
·ck_key_Ën
 = 0;

6130 
m_pk_desü
 = 
kd_¬r
[
	`pk_šdex
(
bË_¬g
, 
tbl_def_¬g
)];

6131 ià(
	`has_hidd’_pk
(
bË_¬g
)) {

6132 
m_pk_key_·¹s
 = 1;

6134 
m_pk_key_·¹s
 =

6135 
bË
->
key_šfo
[bË->
s
->
´im¬y_key
].
u£r_defšed_key_·¹s
;

6136 
key_Ën
 = 
bË
->
key_šfo
[bË->
s
->
´im¬y_key
].
key_Ëngth
;

6140 
m_pk_desü
->
	`£tup
(
bË_¬g
, 
tbl_def_¬g
);

6142 
m_pk_tu¶e
 = 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
key_Ën
, 
	`MYF
(0)));

6144 
·ck_key_Ën
 = 
m_pk_desü
->
	`max_¡Üage_fmt_Ëngth
();

6145 
m_pk_·cked_tu¶e
 =

6146 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
·ck_key_Ën
, 
	`MYF
(0)));

6149 
max_·cked_sk_Ën
 = 
·ck_key_Ën
;

6150 
ušt
 
i
 = 0; i < 
bË_¬g
->
s
->
keys
; i++) {

6151 ià(
i
 =ğ
bË_¬g
->
s
->
´im¬y_key
)

6155 
kd_¬r
[
i
]->
	`£tup
(
bË_¬g
, 
tbl_def_¬g
);

6157 cÚ¡ 
ušt
 
·cked_Ën
 = 
kd_¬r
[
i
]->
	`max_¡Üage_fmt_Ëngth
();

6158 ià(
·cked_Ën
 > 
max_·cked_sk_Ën
) {

6159 
max_·cked_sk_Ën
 = 
·cked_Ën
;

6163 
m_sk_·cked_tu¶e
 =

6164 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6165 
m_sk_m©ch_´efix_buf
 =

6166 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6167 
m_sk_·cked_tu¶e_Şd
 =

6168 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6169 
m_’d_key_·cked_tu¶e
 =

6170 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6171 
m_·ck_bufãr
 =

6172 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6174 
m_sÿn_™_low”_bound
 =

6175 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6176 
m_sÿn_™_uµ”_bound
 =

6177 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6183 ià(
®loc_®‹r_bufãrs
) {

6184 
m_dup_sk_·cked_tu¶e
 =

6185 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6186 
m_dup_sk_·cked_tu¶e_Şd
 =

6187 
»š‹½»t_ÿ¡
<
uch¬
 *>(
	`my_m®loc
(
max_·cked_sk_Ën
, 
	`MYF
(0)));

6190 ià(
m_pk_tu¶e
 =ğ
nuÎ±r
 || 
m_pk_·cked_tu¶e
 ==‚ullptr ||

6191 
m_sk_·cked_tu¶e
 =ğ
nuÎ±r
 || 
m_sk_·cked_tu¶e_Şd
 ==‚ullptr ||

6192 
m_’d_key_·cked_tu¶e
 =ğ
nuÎ±r
 || 
m_·ck_bufãr
 ==‚ullptr ||

6193 
m_sÿn_™_uµ”_bound
 =ğ
nuÎ±r
 || 
m_sÿn_™_low”_bound
 ==‚ullptr ||

6194 (
®loc_®‹r_bufãrs
 && (
m_dup_sk_·cked_tu¶e
 =ğ
nuÎ±r
 ||

6195 
m_dup_sk_·cked_tu¶e_Şd
 =ğ
nuÎ±r
))) {

6197 
	`ä“_key_bufãrs
();

6199 
	`DBUG_RETURN
(
HA_ERR_OUT_OF_MEM
);

6202 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

6203 
	}
}

6205 
ha_rocksdb
::
	$ä“_key_bufãrs
() {

6206 
	`my_ä“
(
m_pk_tu¶e
);

6207 
m_pk_tu¶e
 = 
nuÎ±r
;

6209 
	`my_ä“
(
m_pk_·cked_tu¶e
);

6210 
m_pk_·cked_tu¶e
 = 
nuÎ±r
;

6212 
	`my_ä“
(
m_sk_·cked_tu¶e
);

6213 
m_sk_·cked_tu¶e
 = 
nuÎ±r
;

6215 
	`my_ä“
(
m_sk_m©ch_´efix_buf
);

6216 
m_sk_m©ch_´efix_buf
 = 
nuÎ±r
;

6218 
	`my_ä“
(
m_sk_·cked_tu¶e_Şd
);

6219 
m_sk_·cked_tu¶e_Şd
 = 
nuÎ±r
;

6221 
	`my_ä“
(
m_’d_key_·cked_tu¶e
);

6222 
m_’d_key_·cked_tu¶e
 = 
nuÎ±r
;

6224 
	`my_ä“
(
m_·ck_bufãr
);

6225 
m_·ck_bufãr
 = 
nuÎ±r
;

6227 
	`my_ä“
(
m_dup_sk_·cked_tu¶e
);

6228 
m_dup_sk_·cked_tu¶e
 = 
nuÎ±r
;

6230 
	`my_ä“
(
m_dup_sk_·cked_tu¶e_Şd
);

6231 
m_dup_sk_·cked_tu¶e_Şd
 = 
nuÎ±r
;

6233 
	`my_ä“
(
m_sÿn_™_low”_bound
);

6234 
m_sÿn_™_low”_bound
 = 
nuÎ±r
;

6236 
	`my_ä“
(
m_sÿn_™_uµ”_bound
);

6237 
m_sÿn_™_uµ”_bound
 = 
nuÎ±r
;

6238 
	}
}

6240 
ha_rocksdb
::
	$£t_u£_»ad_ä“_½l
(cÚ¡ *cÚ¡ 
wh™–i¡
) {

6241 
	`DBUG_ASSERT
(
wh™–i¡
 !ğ
nuÎ±r
);

6243 #ià
	`defšed
(
HAVE_PSI_INTERFACE
)

6244 
Regex_li¡_hªdËr
 
	`»gex_hªdËr
(
key_rwlock_»ad_ä“_½l_bËs
);

6246 
Regex_li¡_hªdËr
 
»gex_hªdËr
;

6249 ià(!
»gex_hªdËr
.
	`£t_·‰”ns
(
wh™–i¡
)) {

6250 
	`w¬n_about_bad_·‰”ns
(&
»gex_hªdËr
, "read_free_rpl_tables");

6253 
m_u£_»ad_ä“_½l
 = 
»gex_hªdËr
.
	`m©ches
(
m_tbl_def
->
	`ba£_bËÇme
());

6254 
	}
}

6256 
ha_rocksdb
::
	$£t_sk_unique_check_bËs
(cÚ¡ *cÚ¡ 
wh™–i¡
) {

6257 
	`DBUG_ASSERT
(
wh™–i¡
 !ğ
nuÎ±r
);

6259 #ià
	`defšed
(
HAVE_PSI_INTERFACE
)

6260 
Regex_li¡_hªdËr
 
	`»gex_hªdËr
(
key_rwlock_sk_unique_check_bËs
);

6262 
Regex_li¡_hªdËr
 
»gex_hªdËr
;

6265 ià(!
»gex_hªdËr
.
	`£t_·‰”ns
(
wh™–i¡
)) {

6266 
	`w¬n_about_bad_·‰”ns
(&
»gex_hªdËr
, "skip_unique_check_tables");

6269 
m_sk_unique_check
 = 
»gex_hªdËr
.
	`m©ches
(
m_tbl_def
->
	`ba£_bËÇme
());

6270 
	}
}

6277 
ha_rocksdb
::
	$İ’
(cÚ¡ *cÚ¡ 
Çme
, 
mode
, 
ušt
 
‹¡_if_locked
) {

6278 
	`DBUG_ENTER_FUNC
();

6280 
”r
 = 
	`şo£
();

6281 ià(
”r
) {

6282 
	`DBUG_RETURN
(
”r
);

6285 
m_bË_hªdËr
 = 
rdb_İ’_bËs
.
	`g‘_bË_hªdËr
(
Çme
);

6287 ià(
m_bË_hªdËr
 =ğ
nuÎ±r
) {

6288 
	`DBUG_RETURN
(
HA_ERR_OUT_OF_MEM
);

6291 
my_cÜe
::
	`thr_lock_d©a_š™
(&
m_bË_hªdËr
->
m_thr_lock
, &
m_db_lock
,

6292 
nuÎ±r
);

6293 
m_io_³rf
.
	`š™
(&
m_bË_hªdËr
->
m_bË_³rf_cÚ‹xt
,

6294 &
m_bË_hªdËr
->
m_io_³rf_»ad
,

6295 &
m_bË_hªdËr
->
m_io_³rf_wr™e
, &
¡©s
);

6296 
Rdb_³rf_cÚ‹xt_gu¬d
 
	`gu¬d
(&
m_io_³rf
,

6297 
	`rocksdb_³rf_cÚ‹xt_Ëv–
(
	`ha_thd
()));

6299 
¡d
::
¡ršg
 
fuÎÇme
;

6300 
”r
 = 
	`rdb_nÜm®ize_bËÇme
(
Çme
, &
fuÎÇme
);

6301 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

6302 
	`DBUG_RETURN
(
”r
);

6305 
m_tbl_def
 = 
ddl_mªag”
.
	`fšd
(
fuÎÇme
);

6306 ià(
m_tbl_def
 =ğ
nuÎ±r
) {

6307 
	`my_”rÜ
(
ER_INTERNAL_ERROR
, 
	`MYF
(0),

6310 
	`DBUG_RETURN
(
HA_ERR_ROCKSDB_INVALID_TABLE
);

6312 
m_lock_rows
 = 
RDB_LOCK_NONE
;

6314 
m_key_desü_¬r
 = 
m_tbl_def
->m_key_descr_arr;

6321 
key_u£d_Ú_sÿn
 = 
bË
->
s
->
´im¬y_key
;

6324 
”r
 = 
	`®loc_key_bufãrs
(
bË
, 
m_tbl_def
);

6326 ià(
”r
) {

6327 
	`DBUG_RETURN
(
”r
);

6340 
	`š™_w™h_f›lds
();

6342 
	`£tup_f›ld_cÚv”‹rs
();

6344 
	`šfo
(
HA_STATUS_NO_LOCK
 | 
HA_STATUS_VARIABLE
 | 
HA_STATUS_CONST
);

6354 
m_v”ify_row_debug_checksums
 = 
çl£
;

6357 ià(
bË
->
found_Ãxt_numb”_f›ld
 && 
m_tbl_def
->
m_auto_šü_v®
 == 0) {

6358 
	`lßd_auto_šü_v®ue
();

6362 ià(
	`has_hidd’_pk
(
bË
è&& 
m_tbl_def
->
m_hidd’_pk_v®
 == 0 &&

6363 (
”r
 = 
	`lßd_hidd’_pk_v®ue
()è!ğ
HA_EXIT_SUCCESS
) {

6364 
	`ä“_key_bufãrs
();

6365 
	`DBUG_RETURN
(
”r
);

6369 
¡©s
.
block_size
 = 
rocksdb_tbl_İtiÚs
->block_size;

6372 
	`£t_u£_»ad_ä“_½l
(
	`THDVAR
(
	`ha_thd
(), 
»ad_ä“_½l_bËs
));

6375 
	`£t_sk_unique_check_bËs
(
	`THDVAR
(
	`ha_thd
(), 
sk_unique_check_bËs
));

6377 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

6378 
	}
}

6380 
ha_rocksdb
::
	$şo£
() {

6381 
	`DBUG_ENTER_FUNC
();

6383 
m_pk_desü
 = 
nuÎ±r
;

6384 
m_key_desü_¬r
 = 
nuÎ±r
;

6386 
	`ä“_key_bufãrs
();

6388 
	`my_ä“
(
m_’cod”_¬r
);

6389 
m_’cod”_¬r
 = 
nuÎ±r
;

6391 ià(
m_bË_hªdËr
 !ğ
nuÎ±r
) {

6392 
rdb_İ’_bËs
.
	`»Ëa£_bË_hªdËr
(
m_bË_hªdËr
);

6393 
m_bË_hªdËr
 = 
nuÎ±r
;

6397 
m_¡Üage_»cÜd
.
	`ä“
();

6398 
m_Ï¡_rowkey
.
	`ä“
();

6399 
m_sk_s
.
	`ä“
();

6400 
m_sk_s_Şd
.
	`ä“
();

6401 
m_pk_uÅack_šfo
.
	`ä“
();

6403 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

6404 
	}
}

6406 cÚ¡ *
rdb_”rÜ_mes§ges
[] = {

6434 
¡©ic_as£¹
(((
rdb_”rÜ_mes§ges
) / (rdb_error_messages[0])) ==

6435 ((
HA_ERR_ROCKSDB_LAST
 - 
HA_ERR_ROCKSDB_FIRST
) + 1),

6438 cÚ¡ *
	$rdb_g‘_”rÜ_mes§ge
(
Ä
) {

6439  
rdb_”rÜ_mes§ges
[
Ä
 - 
HA_ERR_ROCKSDB_FIRST
];

6440 
	}
}

6442 
boŞ
 
ha_rocksdb
::
	$g‘_”rÜ_mes§ge
(cÚ¡ 
”rÜ
, 
SŒšg
 *cÚ¡ 
buf
) {

6443 
	`DBUG_ENTER_FUNC
();

6445 
	`¡©ic_as£¹
(
HA_ERR_ROCKSDB_LAST
 > 
HA_ERR_FIRST
,

6447 
	`¡©ic_as£¹
(
HA_ERR_ROCKSDB_LAST
 > 
HA_ERR_LAST
,

6450 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

6452 ià(
”rÜ
 =ğ
HA_ERR_LOCK_WAIT_TIMEOUT
 ||ƒ¼Ü =ğ
HA_ERR_LOCK_DEADLOCK
) {

6453 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_tx_äom_thd
(
	`ha_thd
());

6454 
	`DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

6455 
buf
->
	`­³nd
(
tx
->
m_d‘aed_”rÜ
);

6456 
	`DBUG_RETURN
(
Œue
);

6459 ià(
”rÜ
 >ğ
HA_ERR_ROCKSDB_FIRST
 &&ƒ¼Ü <ğ
HA_ERR_ROCKSDB_LAST
) {

6460 
buf
->
	`­³nd
(
rdb_”rÜ_mes§ges
[
”rÜ
 - 
HA_ERR_ROCKSDB_FIRST
]);

6467 
	`DBUG_RETURN
(
çl£
);

6468 
	}
}

6477 
ha_rocksdb
::
	$rdb_”rÜ_to_mysql
(cÚ¡ 
rocksdb
::
Stus
 &
s
,

6478 cÚ¡ *
İt_msg
) {

6479 
	`DBUG_ASSERT
(!
s
.
	`ok
());

6481 
”r
;

6482 
s
.
	`code
()) {

6483 
rocksdb
::
Stus
::
Code
::
kOk
:

6484 
”r
 = 
HA_EXIT_SUCCESS
;

6486 
rocksdb
::
Stus
::
Code
::
kNÙFound
:

6487 
”r
 = 
HA_ERR_ROCKSDB_STATUS_NOT_FOUND
;

6489 
rocksdb
::
Stus
::
Code
::
kCÜru±iÚ
:

6490 
”r
 = 
HA_ERR_ROCKSDB_STATUS_CORRUPTION
;

6492 
rocksdb
::
Stus
::
Code
::
kNÙSuµÜ‹d
:

6493 
”r
 = 
HA_ERR_ROCKSDB_STATUS_NOT_SUPPORTED
;

6495 
rocksdb
::
Stus
::
Code
::
kInv®idArgum’t
:

6496 
”r
 = 
HA_ERR_ROCKSDB_STATUS_INVALID_ARGUMENT
;

6498 
rocksdb
::
Stus
::
Code
::
kIOE¼Ü
:

6499 
”r
 = (
s
.
	`IsNoS·û
()è? 
HA_ERR_ROCKSDB_STATUS_NO_SPACE


6500 : 
HA_ERR_ROCKSDB_STATUS_IO_ERROR
;

6502 
rocksdb
::
Stus
::
Code
::
kM”geInProg»ss
:

6503 
”r
 = 
HA_ERR_ROCKSDB_STATUS_MERGE_IN_PROGRESS
;

6505 
rocksdb
::
Stus
::
Code
::
kIncom¶‘e
:

6506 
”r
 = 
HA_ERR_ROCKSDB_STATUS_INCOMPLETE
;

6508 
rocksdb
::
Stus
::
Code
::
kShutdownInProg»ss
:

6509 
”r
 = 
HA_ERR_ROCKSDB_STATUS_SHUTDOWN_IN_PROGRESS
;

6511 
rocksdb
::
Stus
::
Code
::
kTimedOut
:

6512 
”r
 = 
HA_ERR_ROCKSDB_STATUS_TIMED_OUT
;

6514 
rocksdb
::
Stus
::
Code
::
kAbÜ‹d
:

6515 
”r
 = (
s
.
	`IsLockLim™
()è? 
HA_ERR_ROCKSDB_STATUS_LOCK_LIMIT


6516 : 
HA_ERR_ROCKSDB_STATUS_ABORTED
;

6518 
rocksdb
::
Stus
::
Code
::
kBusy
:

6519 
”r
 = (
s
.
	`IsD—dlock
()è? 
HA_ERR_ROCKSDB_STATUS_DEADLOCK


6520 : 
HA_ERR_ROCKSDB_STATUS_BUSY
;

6522 
rocksdb
::
Stus
::
Code
::
kExpœed
:

6523 
”r
 = 
HA_ERR_ROCKSDB_STATUS_EXPIRED
;

6525 
rocksdb
::
Stus
::
Code
::
kTryAgaš
:

6526 
”r
 = 
HA_ERR_ROCKSDB_STATUS_TRY_AGAIN
;

6529 
	`DBUG_ASSERT
(0);

6533 ià(
İt_msg
) {

6534 
¡d
::
¡ršg
 
cÚÿ‹Ç‹d_”rÜ
 = 
s
.
	`ToSŒšg
(è+ " (" + std::
	`¡ršg
(
İt_msg
) + ")";

6535 
	`my_”rÜ
(
ER_GET_ERRMSG
, 
	`MYF
(0), 
s
.
	`code
(), 
cÚÿ‹Ç‹d_”rÜ
.
	`c_¡r
(), 
rocksdb_htÚ_Çme
);

6537 
	`my_”rÜ
(
ER_GET_ERRMSG
, 
	`MYF
(0), 
s
.
	`code
(), s.
	`ToSŒšg
().
	`c_¡r
(), 
rocksdb_htÚ_Çme
);

6540  
”r
;

6541 
	}
}

6544 cÚ¡ 
¡d
::
£t
<cÚ¡ 
my_cÜe
::
CHARSET_INFO
 *> 
RDB_INDEX_COLLATIONS
 = {

6545 &
my_ch¬£t_bš
, &
my_ch¬£t_utf8_bš
, &
my_ch¬£t_Ïtš1_bš
};

6547 
boŞ


6548 
	$rdb_is_šdex_cŞÏtiÚ_suµÜ‹d
(cÚ¡ 
my_cÜe
::
F›ld
 *cÚ¡ 
f›ld
) {

6549 cÚ¡ 
my_cÜe
::
’um_f›ld_ty³s
 
ty³
 = 
f›ld
->
	`»®_ty³
();

6551 ià(
ty³
 =ğ
MYSQL_TYPE_VARCHAR
 ||y³ =ğ
MYSQL_TYPE_STRING
 ||

6552 
ty³
 =ğ
MYSQL_TYPE_BLOB
) {

6553  
RDB_INDEX_COLLATIONS
.
	`fšd
(
f›ld
->
	`ch¬£t
()) !=

6554 
RDB_INDEX_COLLATIONS
.
	`’d
();

6556  
Œue
;

6557 
	}
}

6575 
ha_rocksdb
::
	$ü—‹_key_defs
(

6576 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

6577 cÚ¡ 
TABLE
 *cÚ¡ 
Şd_bË_¬g
 ,

6578 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
Şd_tbl_def_¬g


6580 
	`DBUG_ENTER_FUNC
();

6582 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

6583 
	`DBUG_ASSERT
(
bË_¬g
->
s
 !ğ
nuÎ±r
);

6585 
ušt
 
i
;

6592 
¡d
::
¬¿y
<
key_def_cf_šfo
, 
MAX_INDEXES
 + 1> 
cfs
;

6599 ià(
	`ü—‹_cfs
(
bË_¬g
, 
tbl_def_¬g
, &
cfs
)) {

6600 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6603 ià(!
Şd_tbl_def_¬g
) {

6611 
i
 = 0; i < 
tbl_def_¬g
->
m_key_couÁ
; i++) {

6612 ià(
	`ü—‹_key_def
(
bË_¬g
, 
i
, 
tbl_def_¬g
, &
m_key_desü_¬r
[i],

6613 
cfs
[
i
])) {

6614 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6623 ià(
	`ü—‹_š¶aû_key_defs
(
bË_¬g
, 
tbl_def_¬g
, 
Şd_bË_¬g
,

6624 
Şd_tbl_def_¬g
, 
cfs
)) {

6625 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6629 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

6630 
	}
}

6648 
ha_rocksdb
::
ü—‹_cfs
(

6649 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

6650 
¡d
::
¬¿y
<
key_def_cf_šfo
, 
MAX_INDEXES
 + 1> *cÚ¡ 
cfs
) const {

6651 
DBUG_ENTER_FUNC
();

6653 
DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

6654 
DBUG_ASSERT
(
bË_¬g
->
s
 !ğ
nuÎ±r
);

6655 
DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

6657 
bËÇme_sys
[
NAME_LEN
 + 1];

6659 
my_cÜe
::
f’ame_to_bËÇme
(
tbl_def_¬g
->
ba£_bËÇme
().
c_¡r
(),

6660 
bËÇme_sys
, (tablename_sys));

6666 
ušt
 
i
 = 0; i < 
tbl_def_¬g
->
m_key_couÁ
; i++) {

6667 
rocksdb
::
CŞumnFamyHªdË
 *
cf_hªdË
;

6669 ià(
rocksdb_¡riù_cŞÏtiÚ_check
 &&

6670 !
is_hidd’_pk
(
i
, 
bË_¬g
, 
tbl_def_¬g
) &&

6671 
tbl_def_¬g
->
ba£_bËÇme
().
fšd
(
tmp_fe_´efix
) != 0) {

6672 
ušt
 
·¹
 = 0;…¬ˆ< 
bË_¬g
->
key_šfo
[
i
].
aùu®_key_·¹s
;

6673 
·¹
++) {

6674 ià(!
rdb_is_šdex_cŞÏtiÚ_suµÜ‹d
(

6675 
bË_¬g
->
key_šfo
[
i
].
key_·¹
[
·¹
].
f›ld
) &&

6676 !
rdb_cŞÏtiÚ_exû±iÚs
->
m©ches
(
bËÇme_sys
)) {

6677 
¡d
::
¡ršg
 
cŞÏtiÚ_”r
;

6678 cÚ¡‡utØ&
cŞl
 : 
RDB_INDEX_COLLATIONS
) {

6679 ià(
cŞÏtiÚ_”r
 != "") {

6680 
cŞÏtiÚ_”r
 += ", ";

6682 
cŞÏtiÚ_”r
 +ğ
cŞl
->
Çme
;

6685 ià(
rocksdb_”rÜ_Ú_subİtim®_cŞÏtiÚ
) {

6686 
my_”rÜ
(
ER_UNSUPPORTED_COLLATION
, 
MYF
(0),

6687 
tbl_def_¬g
->
fuÎ_bËÇme
().
c_¡r
(),

6688 
bË_¬g
->
key_šfo
[
i
].
key_·¹
[
·¹
].
f›ld
->
f›ld_Çme
,

6689 
cŞÏtiÚ_”r
.
c_¡r
());

6690 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

6692 
push_w¬nšg_´štf
(

6693 
ha_thd
(), 
Sql_cÚd™iÚ
::
WARN_LEVEL_WARN
, 
ER_WRONG_ARGUMENTS
,

6696 
tbl_def_¬g
->
fuÎ_bËÇme
().
c_¡r
(),

6697 
bË_¬g
->
key_šfo
[
i
].
key_·¹
[
·¹
].
f›ld
->
f›ld_Çme
,

6698 
cŞÏtiÚ_”r
.
c_¡r
());

6707 
SHIP_ASSERT
(!
bË_¬g
->
·¹_šfo
 =ğ
tbl_def_¬g
->
ba£_·¹™iÚ
().
em±y
());

6710 
boŞ
 
³r_·¹_m©ch_found
 = 
çl£
;

6711 
¡d
::
¡ršg
 
cf_Çme
 = 
g’”©e_cf_Çme
(
i
, 
bË_¬g
, 
tbl_def_¬g
,

6712 &
³r_·¹_m©ch_found
);

6715 ià(
cf_Çme
 =ğ
DEFAULT_SYSTEM_CF_NAME
) {

6716 
my_”rÜ
(
ER_WRONG_ARGUMENTS
, 
MYF
(0),

6718 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

6724 
cf_hªdË
 = 
cf_mªag”
.
g‘_Ü_ü—‹_cf
(
rdb
, 
cf_Çme
);

6726 ià(!
cf_hªdË
) {

6727 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

6730 autØ&
cf
 = (*
cfs
)[
i
];

6732 
cf
.
cf_hªdË
 = cf_handle;

6733 
cf
.
is_»v”£_cf
 = 
Rdb_cf_mªag”
::
is_cf_Çme_»v”£
(
cf_Çme
.
c_¡r
());

6734 
cf
.
is_³r_·¹™iÚ_cf
 = 
³r_·¹_m©ch_found
;

6737 
DBUG_RETURN
(
HA_EXIT_SUCCESS
);

6754 
ha_rocksdb
::
ü—‹_š¶aû_key_defs
(

6755 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

6756 cÚ¡ 
TABLE
 *cÚ¡ 
Şd_bË_¬g
, cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
Şd_tbl_def_¬g
,

6757 cÚ¡ 
¡d
::
¬¿y
<
key_def_cf_šfo
, 
MAX_INDEXES
 + 1> &
cfs
) const {

6758 
DBUG_ENTER_FUNC
();

6760 
DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

6761 
DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

6762 
DBUG_ASSERT
(
Şd_tbl_def_¬g
 !ğ
nuÎ±r
);

6764 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
Şd_key_desü
 =

6765 
Şd_tbl_def_¬g
->
m_key_desü_¬r
;

6766 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
Ãw_key_desü
 =

6767 
tbl_def_¬g
->
m_key_desü_¬r
;

6768 cÚ¡ 
¡d
::
unÜd”ed_m­
<¡d::
¡ršg
, 
ušt
> 
Şd_key_pos
 =

6769 
g‘_Şd_key_pos™iÚs
(
bË_¬g
, 
tbl_def_¬g
, 
Şd_bË_¬g
,

6770 
Şd_tbl_def_¬g
);

6772 
ušt
 
i
;

6773 
i
 = 0; i < 
tbl_def_¬g
->
m_key_couÁ
; i++) {

6774 cÚ¡‡utØ&
™
 = 
Şd_key_pos
.
fšd
(
g‘_key_Çme
(
i
, 
bË_¬g
, 
tbl_def_¬g
));

6776 ià(
™
 !ğ
Şd_key_pos
.
’d
()) {

6781 cÚ¡ 
Rdb_key_def
 &
okd
 = *
Şd_key_desü
[
™
->
£cÚd
];

6783 cÚ¡ 
GL_INDEX_ID
 
gl_šdex_id
 = 
okd
.
g‘_gl_šdex_id
();

6784 
Rdb_šdex_šfo
 
šdex_šfo
;

6785 ià(!
diù_mªag”
.
g‘_šdex_šfo
(
gl_šdex_id
, &
šdex_šfo
)) {

6787 
sql_´št_”rÜ
("RocksDB: Could‚ot get index information "

6789 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
,

6790 
Şd_tbl_def_¬g
->
fuÎ_bËÇme
().
c_¡r
());

6791 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

6794 
ušt32
 
‰l_»c_off£t
 =

6795 
Rdb_key_def
::
has_šdex_æag
(
šdex_šfo
.
m_šdex_æags
,

6796 
Rdb_key_def
::
TTL_FLAG
)

6797 ? 
Rdb_key_def
::
ÿlcuÏ‹_šdex_æag_off£t
(

6798 
šdex_šfo
.
m_šdex_æags
, 
Rdb_key_def
::
TTL_FLAG
)

6799 : 
UINT_MAX
;

6806 
Ãw_key_desü
[
i
] = 
¡d
::
make_sh¬ed
<
Rdb_key_def
>(

6807 
okd
.
g‘_šdex_numb”
(), 
i
, okd.
g‘_cf
(),

6808 
šdex_šfo
.
m_šdex_diù_v”siÚ
, index_šfo.
m_šdex_ty³
,

6809 
šdex_šfo
.
m_kv_v”siÚ
, 
okd
.
m_is_»v”£_cf
,

6810 
okd
.
m_is_³r_·¹™iÚ_cf
, okd.
m_Çme
.
c_¡r
(),

6811 
diù_mªag”
.
g‘_¡©s
(
gl_šdex_id
), 
šdex_šfo
.
m_šdex_æags
,

6812 
‰l_»c_off£t
, 
šdex_šfo
.
m_‰l_du¿tiÚ
);

6813 } ià(
ü—‹_key_def
(
bË_¬g
, 
i
, 
tbl_def_¬g
, &
Ãw_key_desü
[i],

6814 
cfs
[
i
])) {

6815 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

6818 
DBUG_ASSERT
(
Ãw_key_desü
[
i
] !ğ
nuÎ±r
);

6819 
Ãw_key_desü
[
i
]->
£tup
(
bË_¬g
, 
tbl_def_¬g
);

6822 
DBUG_RETURN
(
HA_EXIT_SUCCESS
);

6825 
¡d
::
unÜd”ed_m­
<¡d::
¡ršg
, 
ušt
> 
ha_rocksdb
::
	$g‘_Şd_key_pos™iÚs
(

6826 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

6827 cÚ¡ 
TABLE
 *cÚ¡ 
Şd_bË_¬g
,

6828 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
Şd_tbl_def_¬g
) const {

6829 
	`DBUG_ENTER_FUNC
();

6831 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

6832 
	`DBUG_ASSERT
(
Şd_bË_¬g
 !ğ
nuÎ±r
);

6833 
	`DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

6834 
	`DBUG_ASSERT
(
Şd_tbl_def_¬g
 !ğ
nuÎ±r
);

6836 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
Şd_key_desü
 =

6837 
Şd_tbl_def_¬g
->
m_key_desü_¬r
;

6838 
¡d
::
unÜd”ed_m­
<¡d::
¡ršg
, 
ušt
> 
Şd_key_pos
;

6839 
¡d
::
unÜd”ed_m­
<¡d::
¡ršg
, 
ušt
> 
Ãw_key_pos
;

6840 
ušt
 
i
;

6842 
i
 = 0; i < 
tbl_def_¬g
->
m_key_couÁ
; i++) {

6843 
Ãw_key_pos
[
	`g‘_key_Çme
(
i
, 
bË_¬g
, 
tbl_def_¬g
)] = i;

6846 
i
 = 0; i < 
Şd_tbl_def_¬g
->
m_key_couÁ
; i++) {

6847 ià(
	`is_hidd’_pk
(
i
, 
Şd_bË_¬g
, 
Şd_tbl_def_¬g
)) {

6848 
Şd_key_pos
[
Şd_key_desü
[
i
]->
m_Çme
] = i;

6861 cÚ¡ 
KEY
 *cÚ¡ 
Şd_key
 = &
Şd_bË_¬g
->
key_šfo
[
i
];

6862 cÚ¡‡utØ&
™
 = 
Ãw_key_pos
.
	`fšd
(
Şd_key
->
Çme
);

6863 ià(
™
 =ğ
Ãw_key_pos
.
	`’d
()) {

6867 
KEY
 *cÚ¡ 
Ãw_key
 = &
bË_¬g
->
key_šfo
[
™
->
£cÚd
];

6877 
boŞ
 
unique_to_nÚ_unique
 =

6878 ((
Şd_key
->
æags
 ^ 
Ãw_key
->æagsè=ğ
HA_NOSAME
) &&

6879 (
Şd_key
->
æags
 & 
HA_NOSAME
);

6881 ià(
	`com·»_keys
(
Şd_key
, 
Ãw_key
è&& !
unique_to_nÚ_unique
) {

6886 ià(
	`com·»_key_·¹s
(
Şd_key
, 
Ãw_key
)) {

6890 
Şd_key_pos
[
Şd_key
->
Çme
] = 
i
;

6893 
	`DBUG_RETURN
(
Şd_key_pos
);

6894 
	}
}

6897 
ha_rocksdb
::
	$com·»_keys
(cÚ¡ 
KEY
 *cÚ¡ 
Şd_key
,

6898 cÚ¡ 
KEY
 *cÚ¡ 
Ãw_key
) const {

6899 
	`DBUG_ENTER_FUNC
();

6901 
	`DBUG_ASSERT
(
Şd_key
 !ğ
nuÎ±r
);

6902 
	`DBUG_ASSERT
(
Ãw_key
 !ğ
nuÎ±r
);

6905 ià(
	`¡rcmp
(
Şd_key
->
Çme
, 
Ãw_key
->name) != 0) {

6906 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6910 ià(
Şd_key
->
®gÜ™hm
 !ğ
Ãw_key
->algorithm) {

6911 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6915 ià((
Şd_key
->
æags
 ^ 
Ãw_key
->æagsè& 
HA_KEYFLAG_MASK
) {

6916 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6920 
¡d
::
¡ršg
 
	`Şd_comm’t
(
Şd_key
->
comm’t
.
¡r
, old_key->comm’t.
Ëngth
);

6921 
¡d
::
¡ršg
 
	`Ãw_comm’t
(
Ãw_key
->
comm’t
.
¡r
,‚ew_key->comm’t.
Ëngth
);

6922 ià(
Şd_comm’t
.
	`com·»
(
Ãw_comm’t
) != 0) {

6923 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6926 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

6927 
	}
}

6930 
ha_rocksdb
::
	$com·»_key_·¹s
(cÚ¡ 
KEY
 *cÚ¡ 
Şd_key
,

6931 cÚ¡ 
KEY
 *cÚ¡ 
Ãw_key
) const {

6932 
	`DBUG_ENTER_FUNC
();

6934 
	`DBUG_ASSERT
(
Şd_key
 !ğ
nuÎ±r
);

6935 
	`DBUG_ASSERT
(
Ãw_key
 !ğ
nuÎ±r
);

6938 ià(
Ãw_key
->
u£r_defšed_key_·¹s
 !ğ
Şd_key
->user_defined_key_parts) {

6939 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6943 
ušt
 
i
 = 0; i < 
Şd_key
->
u£r_defšed_key_·¹s
; i++) {

6944 ià(
	`¡rcmp
(
Şd_key
->
key_·¹
[
i
].
f›ld
->
f›ld_Çme
,

6945 
Ãw_key
->
key_·¹
[
i
].
f›ld
->
f›ld_Çme
) != 0) {

6946 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6950 ià(
Şd_key
->
key_·¹
[
i
].
Ëngth
 !ğ
Ãw_key
->key_part[i].length) {

6951 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

6955 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

6956 
	}
}

6975 
ha_rocksdb
::
ü—‹_key_def
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, cÚ¡ 
ušt
 &
i
,

6976 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

6977 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
Ãw_key_def
,

6978 cÚ¡ 
key_def_cf_šfo
 &
cf_šfo
) const {

6979 
DBUG_ENTER_FUNC
();

6981 
DBUG_ASSERT
(
Ãw_key_def
 !ğ
nuÎ±r
);

6982 
DBUG_ASSERT
(*
Ãw_key_def
 =ğ
nuÎ±r
);

6984 
ušt64
 
‰l_du¿tiÚ
 = 0;

6985 
¡d
::
¡ršg
 
‰l_cŞumn
;

6986 
ušt
 
‰l_f›ld_off£t
;

6988 
ušt
 
”r
;

6989 ià((
”r
 = 
Rdb_key_def
::
exŒaù_‰l_du¿tiÚ
(
bË_¬g
, 
tbl_def_¬g
,

6990 &
‰l_du¿tiÚ
))) {

6991 
DBUG_RETURN
(
”r
);

6994 ià((
”r
 = 
Rdb_key_def
::
exŒaù_‰l_cŞ
(
bË_¬g
, 
tbl_def_¬g
, &
‰l_cŞumn
,

6995 &
‰l_f›ld_off£t
))) {

6996 
DBUG_RETURN
(
”r
);

7000 ià(
‰l_du¿tiÚ
 > 0 && 
is_hidd’_pk
(
i
, 
bË_¬g
, 
tbl_def_¬g
)) {

7001 
my_”rÜ
(
ER_RDB_TTL_UNSUPPORTED
, 
MYF
(0));

7002 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

7009 ià(
‰l_du¿tiÚ
 =ğ0 && !
‰l_cŞumn
.
em±y
()) {

7010 
my_”rÜ
(
ER_RDB_TTL_COL_FORMAT
, 
MYF
(0), 
‰l_cŞumn
.
c_¡r
());

7011 
DBUG_RETURN
(
HA_EXIT_FAILURE
);

7014 cÚ¡ 
ušt
 
šdex_id
 = 
ddl_mªag”
.
g‘_ªd_upd©e_Ãxt_numb”
(&
diù_mªag”
);

7015 cÚ¡ 
ušt16_t
 
šdex_diù_v”siÚ
 = 
Rdb_key_def
::
INDEX_INFO_VERSION_LATEST
;

7016 
uch¬
 
šdex_ty³
;

7017 
ušt16_t
 
kv_v”siÚ
;

7019 ià(
is_hidd’_pk
(
i
, 
bË_¬g
, 
tbl_def_¬g
)) {

7020 
šdex_ty³
 = 
Rdb_key_def
::
INDEX_TYPE_HIDDEN_PRIMARY
;

7021 
kv_v”siÚ
 = 
Rdb_key_def
::
PRIMARY_FORMAT_VERSION_LATEST
;

7022 } ià(
i
 =ğ
bË_¬g
->
s
->
´im¬y_key
) {

7023 
šdex_ty³
 = 
Rdb_key_def
::
INDEX_TYPE_PRIMARY
;

7024 
ušt16
 
pk_Ï‹¡_v”siÚ
 = 
Rdb_key_def
::
PRIMARY_FORMAT_VERSION_LATEST
;

7025 
kv_v”siÚ
 = 
pk_Ï‹¡_v”siÚ
;

7027 
šdex_ty³
 = 
Rdb_key_def
::
INDEX_TYPE_SECONDARY
;

7028 
ušt16
 
sk_Ï‹¡_v”siÚ
 = 
Rdb_key_def
::
SECONDARY_FORMAT_VERSION_LATEST
;

7029 
kv_v”siÚ
 = 
sk_Ï‹¡_v”siÚ
;

7035 
DBUG_EXECUTE_IF
("MYROCKS_LEGACY_VARBINARY_FORMAT", {

7036 
kv_v”siÚ
 = 
Rdb_key_def
::
PRIMARY_FORMAT_VERSION_UPDATE1
;

7039 
DBUG_EXECUTE_IF
("MYROCKS_NO_COVERED_BITMAP_FORMAT", {

7040 ià(
šdex_ty³
 =ğ
Rdb_key_def
::
INDEX_TYPE_SECONDARY
) {

7041 
kv_v”siÚ
 = 
Rdb_key_def
::
SECONDARY_FORMAT_VERSION_UPDATE2
;

7045 
ušt32
 
šdex_æags
 = (
‰l_du¿tiÚ
 > 0 ? 
Rdb_key_def
::
TTL_FLAG
 : 0);

7047 
ušt32
 
‰l_»c_off£t
 =

7048 
Rdb_key_def
::
has_šdex_æag
(
šdex_æags
, Rdb_key_def::
TTL_FLAG
)

7049 ? 
Rdb_key_def
::
ÿlcuÏ‹_šdex_æag_off£t
(
šdex_æags
,

7050 
Rdb_key_def
::
TTL_FLAG
)

7051 : 
UINT_MAX
;

7053 cÚ¡ *cÚ¡ 
key_Çme
 = 
g‘_key_Çme
(
i
, 
bË_¬g
, 
m_tbl_def
);

7054 *
Ãw_key_def
 = 
¡d
::
make_sh¬ed
<
Rdb_key_def
>(

7055 
šdex_id
, 
i
, 
cf_šfo
.
cf_hªdË
, 
šdex_diù_v”siÚ
, 
šdex_ty³
,

7056 
kv_v”siÚ
, 
cf_šfo
.
is_»v”£_cf
, cf_šfo.
is_³r_·¹™iÚ_cf
, 
key_Çme
,

7057 
Rdb_šdex_¡©s
(), 
šdex_æags
, 
‰l_»c_off£t
, 
‰l_du¿tiÚ
);

7059 ià(!
‰l_cŞumn
.
em±y
()) {

7060 (*
Ãw_key_def
)->
m_‰l_cŞumn
 = 
‰l_cŞumn
;

7063 
DBUG_RETURN
(
HA_EXIT_SUCCESS
);

7066 
	$rdb_nÜm®ize_bËÇme
(cÚ¡ 
¡d
::
¡ršg
 &
bËÇme
,

7067 
¡d
::
¡ršg
 *cÚ¡ 
¡rbuf
) {

7068 
	`DBUG_ASSERT
(
¡rbuf
 !ğ
nuÎ±r
);

7070 ià(
bËÇme
.
	`size
() < 2 ||ablename[0] != '.' ||ablename[1] != '/') {

7071 
	`DBUG_ASSERT
(0);

7072  
HA_ERR_ROCKSDB_INVALID_TABLE
;

7075 
size_t
 
pos
 = 
bËÇme
.
	`fšd_fœ¡_of
('/', 2);

7076 ià(
pos
 =ğ
¡d
::
¡ršg
::
Åos
) {

7077 
	`DBUG_ASSERT
(0);

7078  
HA_ERR_ROCKSDB_INVALID_TABLE
;

7081 *
¡rbuf
 = 
bËÇme
.
	`sub¡r
(2, 
pos
 - 2) + "." +ablename.substr(pos + 1);

7083  
HA_EXIT_SUCCESS
;

7084 
	}
}

7090 
boŞ
 
ha_rocksdb
::
	$cÚšs_fÜeign_key
(
THD
 *cÚ¡ 
thd
) {

7091 
boŞ
 
sucûss
;

7092 cÚ¡ *
¡r
 = 
	`thd_qu”y_¡ršg
(
thd
)->str;

7094 
	`DBUG_ASSERT
(
¡r
 !ğ
nuÎ±r
);

7096 *
¡r
 != '\0') {

7098 
¡r
 = 
	`rdb_fšd_š_¡ršg
(¡r, "FOREIGN", &
sucûss
);

7099 ià(!
sucûss
) {

7100  
çl£
;

7104 
¡r
 = 
	`rdb_check_Ãxt_tok’
(&
my_ch¬£t_bš
, sŒ, "FOREIGN", &
sucûss
);

7105 
	`DBUG_ASSERT
(
sucûss
);

7107 ià(!
	`my_is¥aû
(&
my_ch¬£t_bš
, *
¡r
)) {

7108  
çl£
;

7112 
¡r
 = 
	`rdb_check_Ãxt_tok’
(&
my_ch¬£t_bš
, sŒ, "KEY", &
sucûss
);

7113 ià(!
sucûss
) {

7118 
¡r
 = 
	`rdb_check_Ãxt_tok’
(&
my_ch¬£t_bš
, sŒ, "(", &
sucûss
);

7119 ià(!
sucûss
) {

7121 
¡r
 = 
	`rdb_sk_id
(&
my_ch¬£t_bš
, str);

7124 
¡r
 = 
	`rdb_check_Ãxt_tok’
(&
my_ch¬£t_bš
, sŒ, "(", &
sucûss
);

7129  
sucûss
;

7133  
çl£
;

7134 
	}
}

7146 
	$rdb_¥l™_nÜm®ized_bËÇme
(cÚ¡ 
¡d
::
¡ršg
 &
fuÎÇme
,

7147 
¡d
::
¡ršg
 *cÚ¡ 
db
,

7148 
¡d
::
¡ršg
 *cÚ¡ 
bË
,

7149 
¡d
::
¡ršg
 *cÚ¡ 
·¹™iÚ
) {

7150 
	`DBUG_ASSERT
(!
fuÎÇme
.
	`em±y
());

7152 
	#RDB_PARTITION_STR
 "#P#"

	)

7155 
size_t
 
dÙpos
 = 
fuÎÇme
.
	`fšd
('.');

7158 ià(
dÙpos
 =ğ
¡d
::
¡ršg
::
Åos
) {

7159  
HA_ERR_ROCKSDB_INVALID_TABLE
;

7163 
	`DBUG_ASSERT
(
dÙpos
 > 0);

7165 ià(
db
 !ğ
nuÎ±r
) {

7166 *
db
 = 
fuÎÇme
.
	`sub¡r
(0, 
dÙpos
);

7169 
dÙpos
++;

7171 cÚ¡ 
size_t
 
·¹pos
 =

7172 
fuÎÇme
.
	`fšd
(
RDB_PARTITION_STR
, 
dÙpos
, 
	`¡¾’
(RDB_PARTITION_STR));

7174 ià(
·¹pos
 !ğ
¡d
::
¡ršg
::
Åos
) {

7175 
	`DBUG_ASSERT
(
·¹pos
 >ğ
dÙpos
);

7177 ià(
bË
 !ğ
nuÎ±r
) {

7178 *
bË
 = 
fuÎÇme
.
	`sub¡r
(
dÙpos
, 
·¹pos
 - dotpos);

7181 ià(
·¹™iÚ
 !ğ
nuÎ±r
) {

7182 *
·¹™iÚ
 = 
fuÎÇme
.
	`sub¡r
(
·¹pos
 + 
	`¡¾’
(
RDB_PARTITION_STR
));

7184 } ià(
bË
 !ğ
nuÎ±r
) {

7185 *
bË
 = 
fuÎÇme
.
	`sub¡r
(
dÙpos
);

7188  
HA_EXIT_SUCCESS
;

7189 
	}
}

7214 
ha_rocksdb
::
	$ü—‹
(cÚ¡ *cÚ¡ 
Çme
, 
TABLE
 *cÚ¡ 
bË_¬g
,

7215 
HA_CREATE_INFO
 *cÚ¡ 
ü—‹_šfo
) {

7216 
	`DBUG_ENTER_FUNC
();

7218 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

7219 
	`DBUG_ASSERT
(
ü—‹_šfo
 !ğ
nuÎ±r
);

7221 ià(
ü—‹_šfo
->
d©a_fe_Çme
) {

7226 
	`DBUG_RETURN
(
HA_ERR_ROCKSDB_TABLE_DATA_DIRECTORY_NOT_SUPPORTED
);

7229 ià(
ü—‹_šfo
->
šdex_fe_Çme
) {

7231 
	`DBUG_RETURN
(
HA_ERR_ROCKSDB_TABLE_INDEX_DIRECTORY_NOT_SUPPORTED
);

7234 
¡d
::
¡ršg
 
¡r
;

7235 
”r
;

7237 
THD
 *cÚ¡ 
thd
 = 
my_cÜe
::
	`thd_g‘_cu¼’t_thd
();

7239 ià(
	`g‘_bË_if_exi¡s
(
Çme
)) {

7240 ià(
thd
->
Ëx
->
sql_commªd
 =ğ
SQLCOM_TRUNCATE
) {

7241 
”r
 = 
	`d–‘e_bË
(
Çme
);

7242 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

7243 
	`DBUG_RETURN
(
”r
);

7246 
”r
 = 
	`rdb_nÜm®ize_bËÇme
(
Çme
, &
¡r
);

7247 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

7248 
	`DBUG_RETURN
(
”r
);

7250 
	`my_”rÜ
(
ER_METADATA_INCONSISTENCY
, 
	`MYF
(0), 
¡r
.
	`c_¡r
(), 
Çme
);

7251 
	`DBUG_RETURN
(
HA_ERR_ROCKSDB_CORRUPT_DATA
);

7260 
”r
 = 
	`rdb_nÜm®ize_bËÇme
(
Çme
, &
¡r
);

7261 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

7262 
	`DBUG_RETURN
(
”r
);

7265 ià(
	`cÚšs_fÜeign_key
(
thd
)) {

7266 
	`my_”rÜ
(
ER_NOT_SUPPORTED_YET
, 
	`MYF
(0),

7268 
	`DBUG_RETURN
(
HA_ERR_UNSUPPORTED
);

7271 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
diù_mªag”
.
	`begš
();

7272 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
	`g‘
();

7275 
m_tbl_def
 = 
Ãw
 
	`Rdb_tbl_def
(
¡r
);

7277 
ušt
 
n_keys
 = 
bË_¬g
->
s
->
keys
;

7283 ià(
	`has_hidd’_pk
(
bË_¬g
)) {

7284 
n_keys
 += 1;

7287 
m_key_desü_¬r
 = 
Ãw
 
¡d
::
sh¬ed_±r
<
Rdb_key_def
>[
n_keys
];

7288 
m_tbl_def
->
m_key_couÁ
 = 
n_keys
;

7289 
m_tbl_def
->
m_key_desü_¬r
 = m_key_descr_arr;

7291 
”r
 = 
	`ü—‹_key_defs
(
bË_¬g
, 
m_tbl_def
);

7292 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

7293 
”rÜ
;

7296 
m_pk_desü
 = 
m_key_desü_¬r
[
	`pk_šdex
(
bË_¬g
, 
m_tbl_def
)];

7298 ià(
ü—‹_šfo
->
auto_šüem’t_v®ue
) {

7299 
boŞ
 
autošc_upg¿de_‹¡
 = 
çl£
;

7300 
m_tbl_def
->
m_auto_šü_v®
 = 
ü—‹_šfo
->
auto_šüem’t_v®ue
;

7301 
	`DBUG_EXECUTE_IF
("myrocks_autošc_upg¿de", 
autošc_upg¿de_‹¡
 = 
Œue
;);

7302 ià(!
autošc_upg¿de_‹¡
) {

7303 autØ
s
 = 
diù_mªag”
.
	`put_auto_šü_v®
(

7304 
b©ch
, 
m_tbl_def
->
	`g‘_autošü_gl_šdex_id
(),

7305 
m_tbl_def
->
m_auto_šü_v®
);

7306 ià(!
s
.
	`ok
()) {

7307 
”rÜ
;

7312 
diù_mªag”
.
	`lock
();

7313 
”r
 = 
ddl_mªag”
.
	`put_ªd_wr™e
(
m_tbl_def
, 
b©ch
);

7314 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

7315 
diù_mªag”
.
	`uÆock
();

7316 
”rÜ
;

7319 
”r
 = 
diù_mªag”
.
	`comm™
(
b©ch
);

7320 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

7321 
diù_mªag”
.
	`uÆock
();

7322 
”rÜ
;

7325 
diù_mªag”
.
	`uÆock
();

7327 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

7329 
”rÜ
:

7331 
d–‘e
 
m_tbl_def
;

7332 
m_tbl_def
 = 
nuÎ±r
;

7333 
m_key_desü_¬r
 = 
nuÎ±r
;

7335 
	`DBUG_RETURN
(
”r
);

7336 
	}
}

7346 
boŞ
 
ha_rocksdb
::
	$check_key»ad_®lowed
(
ušt
 
šx
, ušˆ
·¹
,

7347 
boŞ
 
®l_·¹s
) const {

7348 
boŞ
 
»s
 = 
Œue
;

7349 
KEY
 *cÚ¡ 
key_šfo
 = &
bË_sh¬e
->key_šfo[
šx
];

7351 
Rdb_f›ld_·ckšg
 
dummy1
;

7352 
»s
 = 
dummy1
.
	`£tup
(
nuÎ±r
, 
key_šfo
->
key_·¹
[
·¹
].
f›ld
, 
šx
,…art,

7353 
key_šfo
->
key_·¹
[
·¹
].
Ëngth
);

7355 ià(
»s
 && 
®l_·¹s
) {

7356 
ušt
 
i
 = 0; i < 
·¹
; i++) {

7357 
F›ld
 *
f›ld
;

7358 ià((
f›ld
 = 
key_šfo
->
key_·¹
[
i
].field)) {

7359 
Rdb_f›ld_·ckšg
 
dummy
;

7360 ià(!
dummy
.
	`£tup
(
nuÎ±r
, 
f›ld
, 
šx
, 
i
,

7361 
key_šfo
->
key_·¹
[
i
].
Ëngth
)) {

7363 
»s
 = 
çl£
;

7370 cÚ¡ 
ušt
 
pk
 = 
bË_sh¬e
->
´im¬y_key
;

7371 ià(
šx
 =ğ
pk
 && 
®l_·¹s
 &&

7372 
·¹
 + 1 =ğ
bË_sh¬e
->
key_šfo
[
pk
].
u£r_defšed_key_·¹s
) {

7373 
m_pk_ÿn_be_decoded
 = 
»s
;

7376  
»s
;

7377 
	}
}

7379 
ha_rocksdb
::
	$»ad_key_exaù
(cÚ¡ 
Rdb_key_def
 &
kd
,

7380 
rocksdb
::
I‹¿tÜ
 *cÚ¡ 
™”
,

7381 cÚ¡ 
boŞ
 &
fuÎ_key_m©ch
,

7382 cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
,

7383 cÚ¡ 
št64_t
 
‰l_f‹r_ts
) {

7384 
	`DBUG_ASSERT
(
™”
 !ğ
nuÎ±r
);

7391 
	`rocksdb_sm¬t_£ek
(
kd
.
m_is_»v”£_cf
, 
™”
, 
key_¦iû
);

7393 
™”
->
	`V®id
(è&& 
kd
.
	`v®ue_m©ches_´efix
(™”->
	`key
(), 
key_¦iû
)) {

7399 ià(
kd
.
	`has_‰l
(è&& 
	`should_hide_‰l_»c
(kd, 
™”
->
	`v®ue
(), 
‰l_f‹r_ts
)) {

7400 
	`rocksdb_sm¬t_Ãxt
(
kd
.
m_is_»v”£_cf
, 
™”
);

7404  
HA_EXIT_SUCCESS
;

7411  
HA_ERR_KEY_NOT_FOUND
;

7412 
	}
}

7414 
ha_rocksdb
::
	$»ad_befÜe_key
(cÚ¡ 
Rdb_key_def
 &
kd
,

7415 cÚ¡ 
boŞ
 &
fuÎ_key_m©ch
,

7416 cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
,

7417 cÚ¡ 
št64_t
 
‰l_f‹r_ts
) {

7422 
	`rocksdb_sm¬t_£ek
(!
kd
.
m_is_»v”£_cf
, 
m_sÿn_™
, 
key_¦iû
);

7424 
	`is_v®id
(
m_sÿn_™
)) {

7432 ià((
fuÎ_key_m©ch
 &&

7433 
kd
.
	`v®ue_m©ches_´efix
(
m_sÿn_™
->
	`key
(), 
key_¦iû
)) ||

7434 (
kd
.
	`has_‰l
() &&

7435 
	`should_hide_‰l_»c
(
kd
, 
m_sÿn_™
->
	`v®ue
(), 
‰l_f‹r_ts
))) {

7436 
	`rocksdb_sm¬t_Ãxt
(!
kd
.
m_is_»v”£_cf
, 
m_sÿn_™
);

7440  
HA_EXIT_SUCCESS
;

7443  
HA_ERR_KEY_NOT_FOUND
;

7444 
	}
}

7446 
ha_rocksdb
::
	$»ad_aá”_key
(cÚ¡ 
Rdb_key_def
 &
kd
,

7447 cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
,

7448 cÚ¡ 
št64_t
 
‰l_f‹r_ts
) {

7457 
	`rocksdb_sm¬t_£ek
(
kd
.
m_is_»v”£_cf
, 
m_sÿn_™
, 
key_¦iû
);

7464 
	`is_v®id
(
m_sÿn_™
è&& 
kd
.
	`has_‰l
() &&

7465 
	`should_hide_‰l_»c
(
kd
, 
m_sÿn_™
->
	`v®ue
(), 
‰l_f‹r_ts
)) {

7466 
	`rocksdb_sm¬t_Ãxt
(
kd
.
m_is_»v”£_cf
, 
m_sÿn_™
);

7469  
	`is_v®id
(
m_sÿn_™
è? 
HA_EXIT_SUCCESS
 : 
HA_ERR_KEY_NOT_FOUND
;

7470 
	}
}

7472 
ha_rocksdb
::
	$pos™iÚ_to_cÜ»ù_key
(

7473 cÚ¡ 
Rdb_key_def
 &
kd
, cÚ¡ 
ha_rkey_funùiÚ
 &
fšd_æag
,

7474 cÚ¡ 
boŞ
 &
fuÎ_key_m©ch
, cÚ¡ 
uch¬
 *cÚ¡ 
key
,

7475 cÚ¡ 
key_·¹_m­
 &
key·¹_m­
, cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
,

7476 
boŞ
 *cÚ¡ 
move_fÜw¬d
, cÚ¡ 
št64_t
 
‰l_f‹r_ts
) {

7477 
rc
 = 0;

7479 *
move_fÜw¬d
 = 
Œue
;

7481 
fšd_æag
) {

7482 
HA_READ_KEY_EXACT
:

7483 
rc
 =

7484 
	`»ad_key_exaù
(
kd
, 
m_sÿn_™
, 
fuÎ_key_m©ch
, 
key_¦iû
, 
‰l_f‹r_ts
);

7486 
HA_READ_BEFORE_KEY
:

7487 *
move_fÜw¬d
 = 
çl£
;

7488 
rc
 = 
	`»ad_befÜe_key
(
kd
, 
fuÎ_key_m©ch
, 
key_¦iû
, 
‰l_f‹r_ts
);

7489 ià(
rc
 =ğ0 && !
kd
.
	`cov”s_key
(
m_sÿn_™
->
	`key
())) {

7491 
rc
 = 
HA_ERR_KEY_NOT_FOUND
;

7494 
HA_READ_AFTER_KEY
:

7495 
HA_READ_KEY_OR_NEXT
:

7496 
rc
 = 
	`»ad_aá”_key
(
kd
, 
key_¦iû
, 
‰l_f‹r_ts
);

7497 ià(
rc
 =ğ0 && !
kd
.
	`cov”s_key
(
m_sÿn_™
->
	`key
())) {

7499 
rc
 = 
HA_ERR_KEY_NOT_FOUND
;

7502 
HA_READ_KEY_OR_PREV
:

7503 
HA_READ_PREFIX
:

7505 
rc
 = 
HA_ERR_UNSUPPORTED
;

7507 
HA_READ_PREFIX_LAST
:

7508 
HA_READ_PREFIX_LAST_OR_PREV
:

7509 *
move_fÜw¬d
 = 
çl£
;

7519 
rc
 = 
	`»ad_befÜe_key
(
kd
, 
fuÎ_key_m©ch
, 
key_¦iû
, 
‰l_f‹r_ts
);

7520 ià(
rc
 == 0) {

7521 cÚ¡ 
rocksdb
::
Sliû
 &
rkey
 = 
m_sÿn_™
->
	`key
();

7522 ià(!
kd
.
	`cov”s_key
(
rkey
)) {

7524 
rc
 = 
HA_ERR_KEY_NOT_FOUND
;

7525 } ià(
fšd_æag
 =ğ
HA_READ_PREFIX_LAST
) {

7526 
ušt
 
size
 = 
kd
.
	`·ck_šdex_tu¶e
(
bË
, 
m_·ck_bufãr
, 
m_sk_·cked_tu¶e
,

7527 
key
, 
key·¹_m­
);

7528 
rocksdb
::
Sliû
 
	`lookup_tu¶e
(
»š‹½»t_ÿ¡
<*>(
m_sk_·cked_tu¶e
),

7529 
size
);

7532 ià(!
kd
.
	`v®ue_m©ches_´efix
(
rkey
, 
lookup_tu¶e
)) {

7533 
rc
 = 
HA_ERR_KEY_NOT_FOUND
;

7539 
	`DBUG_ASSERT
(0);

7543  
rc
;

7544 
	}
}

7546 
ha_rocksdb
::
	$ÿlc_eq_cÚd_Ën
(cÚ¡ 
Rdb_key_def
 &
kd
,

7547 cÚ¡ 
ha_rkey_funùiÚ
 &
fšd_æag
,

7548 cÚ¡ 
rocksdb
::
Sliû
 &
¦iû
,

7549 cÚ¡ &
by‹s_chªged_by_succ
,

7550 cÚ¡ 
key_¿nge
 *cÚ¡ 
’d_key
,

7551 
ušt
 *cÚ¡ 
’d_key_·cked_size
) {

7552 ià(
fšd_æag
 =ğ
HA_READ_KEY_EXACT
)

7553  
¦iû
.
	`size
();

7555 ià(
fšd_æag
 =ğ
HA_READ_PREFIX_LAST
) {

7561  
¦iû
.
	`size
(è- 
by‹s_chªged_by_succ
;

7564 ià(
’d_key
) {

7565 *
’d_key_·cked_size
 =

7566 
kd
.
	`·ck_šdex_tu¶e
(
bË
, 
m_·ck_bufãr
, 
m_’d_key_·cked_tu¶e
,

7567 
’d_key
->
key
,ƒnd_key->
key·¹_m­
);

7578 
rocksdb
::
Sliû
 
	`’d_¦iû
(
»š‹½»t_ÿ¡
<*>(
m_’d_key_·cked_tu¶e
),

7579 *
’d_key_·cked_size
);

7580  
¦iû
.
	`difã»nû_off£t
(
’d_¦iû
);

7589  
Rdb_key_def
::
INDEX_NUMBER_SIZE
;

7590 
	}
}

7592 
ha_rocksdb
::
	$»ad_row_äom_´im¬y_key
(
uch¬
 *cÚ¡ 
buf
) {

7593 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

7595 
rc
;

7596 cÚ¡ 
rocksdb
::
Sliû
 &
rkey
 = 
m_sÿn_™
->
	`key
();

7597 cÚ¡ 
ušt
 
pk_size
 = 
rkey
.
	`size
();

7598 cÚ¡ *
pk_d©a
 = 
rkey
.
	`d©a
();

7600 
	`memıy
(
m_pk_·cked_tu¶e
, 
pk_d©a
, 
pk_size
);

7601 
m_Ï¡_rowkey
.
	`cİy
(
pk_d©a
, 
pk_size
, &
my_ch¬£t_bš
);

7603 ià(
m_lock_rows
 !ğ
RDB_LOCK_NONE
) {

7605 
rc
 = 
	`g‘_row_by_rowid
(
buf
, 
m_pk_·cked_tu¶e
, 
pk_size
);

7608 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
 = 
m_sÿn_™
->
	`v®ue
();

7609 
rc
 = 
	`cÚv”t_»cÜd_äom_¡Üage_fÜm©
(&
rkey
, &
v®ue
, 
buf
);

7612  
rc
;

7613 
	}
}

7615 
ha_rocksdb
::
	$»ad_row_äom_£cÚd¬y_key
(
uch¬
 *cÚ¡ 
buf
,

7616 cÚ¡ 
Rdb_key_def
 &
kd
,

7617 
boŞ
 
move_fÜw¬d
) {

7618 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

7620 
rc
 = 0;

7621 
ušt
 
pk_size
;

7624 cÚ¡ 
rocksdb
::
Sliû
 &
rkey
 = 
m_sÿn_™
->
	`key
();

7625 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
 = 
m_sÿn_™
->
	`v®ue
();

7627 
boŞ
 
cov”ed_lookup
 =

7628 
m_key»ad_Úly
 || 
kd
.
	`cov”s_lookup
(
bË
, &
v®ue
, &
m_lookup_b™m­
);

7629 ià(
cov”ed_lookup
 && 
m_lock_rows
 =ğ
RDB_LOCK_NONE
) {

7630 
pk_size
 =

7631 
kd
.
	`g‘_´im¬y_key_tu¶e
(
bË
, *
m_pk_desü
, &
rkey
, 
m_pk_·cked_tu¶e
);

7632 ià(
pk_size
 =ğ
RDB_INVALID_KEY_LEN
) {

7633 
rc
 = 
HA_ERR_ROCKSDB_CORRUPT_DATA
;

7635 
rc
 = 
kd
.
	`uÅack_»cÜd
(
bË
, 
buf
, &
rkey
, &
v®ue
,

7636 
m_v”ify_row_debug_checksums
);

7637 
glob®_¡©s
.
cov”ed_£cÚd¬y_key_lookups
.
	`šc
();

7640 ià(
kd
.
m_is_»v”£_cf
)

7641 
move_fÜw¬d
 = !move_forward;

7643 
rc
 = 
	`fšd_iı_m©chšg_šdex_»c
(
move_fÜw¬d
, 
buf
);

7644 ià(!
rc
) {

7645 cÚ¡ 
rocksdb
::
Sliû
 &
rkey
 = 
m_sÿn_™
->
	`key
();

7646 
pk_size
 = 
kd
.
	`g‘_´im¬y_key_tu¶e
(
bË
, *
m_pk_desü
, &
rkey
,

7647 
m_pk_·cked_tu¶e
);

7648 ià(
pk_size
 =ğ
RDB_INVALID_KEY_LEN
) {

7649 
rc
 = 
HA_ERR_ROCKSDB_CORRUPT_DATA
;

7651 
rc
 = 
	`g‘_row_by_rowid
(
buf
, 
m_pk_·cked_tu¶e
, 
pk_size
);

7656 ià(!
rc
) {

7657 
m_Ï¡_rowkey
.
	`cİy
((cÚ¡ *)
m_pk_·cked_tu¶e
, 
pk_size
,

7658 &
my_ch¬£t_bš
);

7661  
rc
;

7662 
	}
}

7685 
ulÚg
 
ha_rocksdb
::
	$šdex_æags
(
ušt
 
šx
, ušˆ
·¹
, 
boŞ
 
®l_·¹s
) const {

7686 
	`DBUG_ENTER_FUNC
();

7688 
ulÚg
 
ba£_æags
 = 
HA_READ_NEXT
 |

7689 
HA_READ_ORDER
 | 
HA_READ_RANGE
 | 
HA_READ_PREV
;

7691 ià(
	`check_key»ad_®lowed
(
šx
, 
·¹
, 
®l_·¹s
))

7692 
ba£_æags
 |ğ
HA_KEYREAD_ONLY
;

7694 ià(
šx
 =ğ
bË_sh¬e
->
´im¬y_key
) {

7700 
ba£_æags
 |ğ
HA_KEYREAD_ONLY
;

7707 
ba£_æags
 |ğ
HA_DO_INDEX_COND_PUSHDOWN
;

7710 
	`DBUG_RETURN
(
ba£_æags
);

7711 
	}
}

7721 
ha_rocksdb
::
	$£cÚd¬y_šdex_»ad
(cÚ¡ 
keyno
, 
uch¬
 *cÚ¡ 
buf
) {

7722 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

7723 
	`DBUG_ASSERT
(
bË
 !ğ
nuÎ±r
);

7725 
¡©s
.
rows_»que¡ed
++;

7728 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

7730 ià(
	`is_v®id
(
m_sÿn_™
)) {

7731 
rocksdb
::
Sliû
 
key
 = 
m_sÿn_™
->
	`key
();

7734 ià(
m_key_desü_¬r
[
keyno
]->
	`cov”s_key
(
key
)) {

7735 
rc
 = 0;

7738 cÚ¡ 
ušt
 
size
 = 
m_key_desü_¬r
[
keyno
]->
	`g‘_´im¬y_key_tu¶e
(

7739 
bË
, *
m_pk_desü
, &
key
, 
m_pk_·cked_tu¶e
);

7740 ià(
size
 =ğ
RDB_INVALID_KEY_LEN
) {

7741  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

7744 
m_Ï¡_rowkey
.
	`cİy
((cÚ¡ *)
m_pk_·cked_tu¶e
, 
size
,

7745 &
my_ch¬£t_bš
);

7747 
rocksdb
::
Sliû
 
v®ue
 = 
m_sÿn_™
->
	`v®ue
();

7748 
boŞ
 
cov”ed_lookup
 =

7749 
m_key»ad_Úly
 || 
m_key_desü_¬r
[
keyno
]->
	`cov”s_lookup
(

7750 
bË
, &
v®ue
, &
m_lookup_b™m­
);

7751 ià(
cov”ed_lookup
 && 
m_lock_rows
 =ğ
RDB_LOCK_NONE
) {

7752 
rc
 = 
m_key_desü_¬r
[
keyno
]->
	`uÅack_»cÜd
(

7753 
bË
, 
buf
, &
key
, &
v®ue
, 
m_v”ify_row_debug_checksums
);

7754 
glob®_¡©s
.
cov”ed_£cÚd¬y_key_lookups
.
	`šc
();

7756 
rc
 = 
	`g‘_row_by_rowid
(
buf
, 
m_pk_·cked_tu¶e
, 
size
);

7759 ià(!
rc
) {

7760 
bË
->
¡©us
 = 0;

7761 
¡©s
.
rows_»ad
++;

7762 
¡©s
.
rows_šdex_Ãxt
++;

7763 
	`upd©e_row_¡©s
(
ROWS_READ
);

7765  
rc
;

7768  
HA_ERR_END_OF_FILE
;

7769 
	}
}

7781 
ha_rocksdb
::
	$»ad_¿nge_fœ¡
(cÚ¡ 
key_¿nge
 *cÚ¡ 
¡¬t_key
,

7782 cÚ¡ 
key_¿nge
 *cÚ¡ 
’d_key
,

7783 
boŞ
 
eq_¿nge_¬g
, boŞ 
sÜ‹d
) {

7784 
	`DBUG_ENTER_FUNC
();

7786 
»suÉ
;

7788 
eq_¿nge
 = 
eq_¿nge_¬g
;

7789 
	`£t_’d_¿nge
(
’d_key
, 
RANGE_SCAN_ASC
);

7791 
¿nge_key_·¹
 = 
bË
->
key_šfo
[
aùive_šdex
].
key_·¹
;

7793 ià(!
¡¬t_key
)

7794 
»suÉ
 = 
	`ha_šdex_fœ¡
(
bË
->
»cÜd
[0]);

7796 ià(
	`is_usšg_´ohib™ed_g­_locks
(

7797 
bË
,

7798 
	`is_usšg_fuÎ_unique_key
(
aùive_šdex
, 
¡¬t_key
->
key·¹_m­
,

7799 
¡¬t_key
->
æag
))) {

7800 
	`DBUG_RETURN
(
HA_ERR_LOCK_DEADLOCK
);

7803 
	`MYSQL_TABLE_IO_WAIT
(
m_psi
, 
PSI_TABLE_FETCH_ROW
, 
aùive_šdex
, 0, {

7804 
»suÉ
 =

7805 
	`šdex_»ad_m­_im¶
(
bË
->
»cÜd
[0], 
¡¬t_key
->
key
,

7806 
¡¬t_key
->
key·¹_m­
, s¹_key->
æag
, 
’d_key
);

7809 ià(
»suÉ
)

7810 
	`DBUG_RETURN
((
»suÉ
 =ğ
HA_ERR_KEY_NOT_FOUND
è? 
HA_ERR_END_OF_FILE
 :„esult);

7812 ià(
	`com·»_key
(
’d_¿nge
) <= 0) {

7813 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

7819 
	`uÆock_row
();

7820 
	`DBUG_RETURN
(
HA_ERR_END_OF_FILE
);

7822 
	}
}

7829 
ha_rocksdb
::
	$šdex_»ad_m­
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ uch¬ *cÚ¡ 
key
,

7830 
key_·¹_m­
 
key·¹_m­
,

7831 
ha_rkey_funùiÚ
 
fšd_æag
) {

7832 
	`DBUG_ENTER_FUNC
();

7834 
	`DBUG_RETURN
(
	`šdex_»ad_m­_im¶
(
buf
, 
key
, 
key·¹_m­
, 
fšd_æag
, 
nuÎ±r
));

7835 
	}
}

7854 
ha_rocksdb
::
	$šdex_»ad_m­_im¶
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ uch¬ *cÚ¡ 
key
,

7855 
key_·¹_m­
 
key·¹_m­
,

7856 
ha_rkey_funùiÚ
 
fšd_æag
,

7857 cÚ¡ 
key_¿nge
 *
’d_key
) {

7858 
	`DBUG_ENTER_FUNC
();

7860 
rc
 = 0;

7862 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_»ad_key_couÁ
);

7863 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
aùive_šdex
];

7864 cÚ¡ 
ušt
 
aùu®_key_·¹s
 = 
kd
.
	`g‘_key_·¹s
();

7865 
boŞ
 
usšg_fuÎ_key
 = 
	`is_usšg_fuÎ_key
(
key·¹_m­
, 
aùu®_key_·¹s
);

7867 ià(!
’d_key
)

7868 
’d_key
 = 
’d_¿nge
;

7871 
m_sk_m©ch_´efix
 = 
nuÎ±r
;

7872 
¡©s
.
rows_»que¡ed
++;

7874 ià(
aùive_šdex
 =ğ
bË
->
s
->
´im¬y_key
 && 
fšd_æag
 =ğ
HA_READ_KEY_EXACT
 &&

7875 
usšg_fuÎ_key
) {

7880 cÚ¡ 
ušt
 
size
 = 
kd
.
	`·ck_šdex_tu¶e
(
bË
, 
m_·ck_bufãr
,

7881 
m_pk_·cked_tu¶e
, 
key
, 
key·¹_m­
);

7882 
boŞ
 
sk_lookup
 = 
	`is_blšd_d–‘e_’abËd
();

7884 
rc
 = 
	`g‘_row_by_rowid
(
buf
, 
m_pk_·cked_tu¶e
, 
size
,

7885 
sk_lookup
, 
çl£
);

7887 ià(!
rc
 && !
sk_lookup
) {

7888 
¡©s
.
rows_»ad
++;

7889 
¡©s
.
rows_šdex_fœ¡
++;

7890 
	`upd©e_row_¡©s
(
ROWS_READ
);

7892 
	`DBUG_RETURN
(
rc
);

7898 
ušt
 
·cked_size
;

7899 ià(
aùive_šdex
 !ğ
bË
->
s
->
´im¬y_key
 &&

7900 
bË
->
key_šfo
[
aùive_šdex
].
æags
 & 
HA_NOSAME
 &&

7901 
fšd_æag
 =ğ
HA_READ_KEY_EXACT
 && 
usšg_fuÎ_key
) {

7902 
key_·¹_m­
 
tmp_m­
 = (
	`key_·¹_m­
(1è<< 
bË
->
key_šfo
[
aùive_šdex
]

7903 .
u£r_defšed_key_·¹s
) -

7905 
·cked_size
 = 
kd
.
	`·ck_šdex_tu¶e
(
bË
, 
m_·ck_bufãr
, 
m_sk_·cked_tu¶e
,

7906 
key
, 
tmp_m­
);

7907 ià(
bË
->
key_šfo
[
aùive_šdex
].
u£r_defšed_key_·¹s
 !=

7908 
kd
.
	`g‘_key_·¹s
())

7909 
usšg_fuÎ_key
 = 
çl£
;

7911 
·cked_size
 = 
kd
.
	`·ck_šdex_tu¶e
(
bË
, 
m_·ck_bufãr
, 
m_sk_·cked_tu¶e
,

7912 
key
, 
key·¹_m­
);

7915 ià((
pushed_idx_cÚd
 && 
pushed_idx_cÚd_keyno
 =ğ
aùive_šdex
) &&

7916 (
fšd_æag
 =ğ
HA_READ_KEY_EXACT
 || fšd_æag =ğ
HA_READ_PREFIX_LAST
)) {

7929 
m_sk_m©ch_´efix
 = 
m_sk_m©ch_´efix_buf
;

7930 
m_sk_m©ch_Ëngth
 = 
·cked_size
;

7931 
	`memıy
(
m_sk_m©ch_´efix
, 
m_sk_·cked_tu¶e
, 
·cked_size
);

7934 
by‹s_chªged_by_succ
 = 0;

7935 ià(
fšd_æag
 =ğ
HA_READ_PREFIX_LAST_OR_PREV
 ||

7936 
fšd_æag
 =ğ
HA_READ_PREFIX_LAST
 || fšd_æag =ğ
HA_READ_AFTER_KEY
) {

7938 
by‹s_chªged_by_succ
 = 
kd
.
	`sucûssÜ
(
m_sk_·cked_tu¶e
, 
·cked_size
);

7941 
rocksdb
::
Sliû
 
	`¦iû
(
»š‹½»t_ÿ¡
<cÚ¡ *>(
m_sk_·cked_tu¶e
),

7942 
·cked_size
);

7944 
ušt
 
’d_key_·cked_size
 = 0;

7945 cÚ¡ 
ušt
 
eq_cÚd_Ën
 =

7946 
	`ÿlc_eq_cÚd_Ën
(
kd
, 
fšd_æag
, 
¦iû
, 
by‹s_chªged_by_succ
, 
’d_key
,

7947 &
’d_key_·cked_size
);

7949 
boŞ
 
u£_®l_keys
 = 
çl£
;

7950 ià(
fšd_æag
 =ğ
HA_READ_KEY_EXACT
 &&

7951 
	`my_couÁ_b™s
(
key·¹_m­
è=ğ
kd
.
	`g‘_key_·¹s
())

7952 
u£_®l_keys
 = 
Œue
;

7954 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

7955 cÚ¡ 
boŞ
 
is_Ãw_¢­shÙ
 = !
tx
->
	`has_¢­shÙ
();

7963 
	`£tup_sÿn_™”©Ü
(
kd
, &
¦iû
, 
u£_®l_keys
, 
eq_cÚd_Ën
);

7969 
boŞ
 
move_fÜw¬d
;

7970 
rc
 =

7971 
	`pos™iÚ_to_cÜ»ù_key
(
kd
, 
fšd_æag
, 
usšg_fuÎ_key
, 
key
, 
key·¹_m­
,

7972 
¦iû
, &
move_fÜw¬d
, 
tx
->
m_¢­shÙ_time¡amp
);

7974 ià(
rc
) {

7976 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

7977 
	`DBUG_RETURN
(
rc
);

7980 
m_sk_sÿn_™_Ãxt_ÿÎ
 = 
çl£
;

7987 ià(
aùive_šdex
 =ğ
bË
->
s
->
´im¬y_key
)

7988 
rc
 = 
	`»ad_row_äom_´im¬y_key
(
buf
);

7990 
rc
 = 
	`»ad_row_äom_£cÚd¬y_key
(
buf
, 
kd
, 
move_fÜw¬d
);

7992 ià(
rc
 !ğ
HA_ERR_LOCK_DEADLOCK
 || !
is_Ãw_¢­shÙ
)

7996 
tx
->
	`»Ëa£_¢­shÙ
();

7997 
	`»Ëa£_sÿn_™”©Ü
();

8000 ià(
rc
) {

8002 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

8004 
bË
->
¡©us
 = 0;

8005 
¡©s
.
rows_»ad
++;

8006 
¡©s
.
rows_šdex_fœ¡
++;

8007 
	`upd©e_row_¡©s
(
ROWS_READ
);

8010 
	`DBUG_RETURN
(
rc
);

8011 
	}
}

8033 
ha_rocksdb
::
	$fšd_iı_m©chšg_šdex_»c
(cÚ¡ 
boŞ
 &
move_fÜw¬d
,

8034 
uch¬
 *cÚ¡ 
buf
) {

8035 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

8037 ià(
pushed_idx_cÚd
 && 
pushed_idx_cÚd_keyno
 =ğ
aùive_šdex
) {

8038 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
aùive_šdex
];

8041 
	`rocksdb_sk_expœed_»cÜds
(
kd
, 
m_sÿn_™
, !
move_fÜw¬d
);

8043 ià(!
	`is_v®id
(
m_sÿn_™
)) {

8044 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

8045  
HA_ERR_END_OF_FILE
;

8047 cÚ¡ 
rocksdb
::
Sliû
 
rkey
 = 
m_sÿn_™
->
	`key
();

8049 ià(!
kd
.
	`cov”s_key
(
rkey
)) {

8050 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

8051  
HA_ERR_END_OF_FILE
;

8054 ià(
m_sk_m©ch_´efix
) {

8055 cÚ¡ 
rocksdb
::
Sliû
 
	`´efix
((cÚ¡ *)
m_sk_m©ch_´efix
,

8056 
m_sk_m©ch_Ëngth
);

8057 ià(!
kd
.
	`v®ue_m©ches_´efix
(
rkey
, 
´efix
)) {

8058 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

8059  
HA_ERR_END_OF_FILE
;

8063 cÚ¡ 
rocksdb
::
Sliû
 
v®ue
 = 
m_sÿn_™
->
	`v®ue
();

8064 
”r
 = 
kd
.
	`uÅack_»cÜd
(
bË
, 
buf
, &
rkey
, &
v®ue
,

8065 
m_v”ify_row_debug_checksums
);

8066 ià(
”r
 !ğ
HA_EXIT_SUCCESS
) {

8067  
”r
;

8070 cÚ¡ 
iı_»suÉ
 
iı_¡©us
 = 
	`check_šdex_cÚd
();

8071 ià(
iı_¡©us
 =ğ
ICP_NO_MATCH
) {

8072 
	`rocksdb_sm¬t_Ãxt
(!
move_fÜw¬d
, 
m_sÿn_™
);

8074 } ià(
iı_¡©us
 =ğ
ICP_OUT_OF_RANGE
) {

8076 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

8077  
HA_ERR_END_OF_FILE
;

8094  
HA_EXIT_SUCCESS
;

8095 
	}
}

8102 
ha_rocksdb
::
	$šdex_»ad_Ï¡_m­
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ uch¬ *cÚ¡ 
key
,

8103 
key_·¹_m­
 
key·¹_m­
) {

8104 
	`DBUG_ENTER_FUNC
();

8106 
	`DBUG_RETURN
(
	`šdex_»ad_m­
(
buf
, 
key
, 
key·¹_m­
, 
HA_READ_PREFIX_LAST
));

8107 
	}
}

8114 
ha_rocksdb
::
	$check
(
THD
 *cÚ¡ 
thd
, 
HA_CHECK_OPT
 *cÚ¡ 
check_İt
) {

8115 
	`DBUG_ENTER_FUNC
();

8117 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

8118 
	`DBUG_ASSERT
(
check_İt
 !ğ
nuÎ±r
);

8120 cÚ¡ 
ušt
 
pk
 = 
	`pk_šdex
(
bË
, 
m_tbl_def
);

8121 
SŒšg
 
rowkey_cİy
;

8122 
SŒšg
 
£c_key_cİy
;

8123 cÚ¡ *cÚ¡ 
bË_Çme
 = 
bË
->
s
->bË_Çme.
¡r
;

8129 cÚ¡ 
boŞ
 
§ve_v”ify_row_debug_checksums
 = 
m_v”ify_row_debug_checksums
;

8130 
m_v”ify_row_debug_checksums
 = 
Œue
;

8134 
	`sql_´št_šfÜm©iÚ
("CHECKTABLE %s: CheckšgabË %s", 
bË_Çme
,

8135 
bË_Çme
);

8136 
ha_rows
 
	`UNINIT_VAR
(
row_checksums_©_¡¬t
);

8137 
ha_rows
 
row_checksums
 = 
	`ha_rows
(-1);

8138 
boŞ
 
fœ¡_šdex
 = 
Œue
;

8140 
ušt
 
keyno
 = 0; keynØ< 
bË
->
s
->
keys
; keyno++) {

8141 ià(
keyno
 !ğ
pk
) {

8142 
	`exŒa
(
HA_EXTRA_KEYREAD
);

8143 
	`ha_šdex_š™
(
keyno
, 
Œue
);

8144 
ha_rows
 
rows
 = 0;

8145 
ha_rows
 
checksums
 = 0;

8146 ià(
fœ¡_šdex
)

8147 
row_checksums_©_¡¬t
 = 
m_row_checksums_checked
;

8148 
»s
;

8150 
	`sql_´št_šfÜm©iÚ
("CHECKTABLE %s: Checkšg index %s", 
bË_Çme
,

8151 
bË
->
key_šfo
[
keyno
].
Çme
);

8153 ià(!
rows
)

8154 
»s
 = 
	`šdex_fœ¡
(
bË
->
»cÜd
[0]);

8156 
»s
 = 
	`šdex_Ãxt
(
bË
->
»cÜd
[0]);

8158 ià(
»s
 =ğ
HA_ERR_END_OF_FILE
)

8160 ià(
»s
) {

8163 
	`sql_´št_”rÜ
("CHECKTABLE %s: ..„ow %lld: index scanƒrror %d",

8164 
bË_Çme
, 
rows
, 
»s
);

8165 
”rÜ
;

8167 
rocksdb
::
Sliû
 
key
 = 
m_sÿn_™
->
	`key
();

8168 
£c_key_cİy
.
	`cİy
(
key
.
	`d©a
(), key.
	`size
(), &
my_ch¬£t_bš
);

8169 
rowkey_cİy
.
	`cİy
(
m_Ï¡_rowkey
.
	`±r
(), m_Ï¡_rowkey.
	`Ëngth
(),

8170 &
my_ch¬£t_bš
);

8172 ià(
m_key_desü_¬r
[
keyno
]->
	`uÅack_šfo_has_checksum
(

8173 
m_sÿn_™
->
	`v®ue
())) {

8174 
checksums
++;

8177 ià((
»s
 = 
	`g‘_row_by_rowid
(
bË
->
»cÜd
[0], 
rowkey_cİy
.
	`±r
(),

8178 
rowkey_cİy
.
	`Ëngth
()))) {

8180 
	`sql_´št_”rÜ
("CHECKTABLE %s: ..„ow %lld: "

8182 
bË_Çme
, 
rows
);

8183 
”rÜ
;

8186 
lÚglÚg
 
hidd’_pk_id
 = 0;

8187 ià(
	`has_hidd’_pk
(
bË
) &&

8188 
	`»ad_hidd’_pk_id_äom_rowkey
(&
hidd’_pk_id
))

8189 
”rÜ
;

8192 
ušt
 
·cked_size
 = 
m_pk_desü
->
	`·ck_»cÜd
(

8193 
bË
, 
m_·ck_bufãr
,abË->
»cÜd
[0], 
m_pk_·cked_tu¶e
, 
nuÎ±r
,

8194 
çl£
, 
hidd’_pk_id
);

8195 ià(
·cked_size
 !ğ
rowkey_cİy
.
	`Ëngth
() ||

8196 
	`memcmp
(
m_pk_·cked_tu¶e
, 
rowkey_cİy
.
	`±r
(), 
·cked_size
)) {

8198 
	`sql_´št_”rÜ
("CHECKTABLE %s: ..„ow %lld: PK value mismatch",

8199 
bË_Çme
, 
rows
);

8200 
´št_ªd_”rÜ
;

8204 
·cked_size
 = 
m_key_desü_¬r
[
keyno
]->
	`·ck_»cÜd
(

8205 
bË
, 
m_·ck_bufãr
,abË->
»cÜd
[0], 
m_sk_·cked_tu¶e
,

8206 &
m_sk_s
, 
çl£
, 
hidd’_pk_id
);

8207 ià(
·cked_size
 !ğ
£c_key_cİy
.
	`Ëngth
() ||

8208 
	`memcmp
(
m_sk_·cked_tu¶e
, 
£c_key_cİy
.
	`±r
(), 
·cked_size
)) {

8210 
	`sql_´št_”rÜ
("CHECKTABLE %s: ..„ow %lld: "

8212 
bË_Çme
, 
rows
);

8213 
´št_ªd_”rÜ
;

8215 
rows
++;

8218 
´št_ªd_”rÜ
 : {

8219 
¡d
::
¡ršg
 
buf
;

8220 
buf
 = 
	`rdb_hexdump
(
rowkey_cİy
.
	`±r
(),„owkey_cİy.
	`Ëngth
(),

8221 
RDB_MAX_HEXDUMP_LEN
);

8223 
	`sql_´št_”rÜ
("CHECKTABLE %s:„owkey: %s", 
bË_Çme
, 
buf
.
	`c_¡r
());

8225 
buf
 = 
	`rdb_hexdump
(
m_»Œ›ved_»cÜd
.
	`d©a
(), m_»Œ›ved_»cÜd.
	`size
(),

8226 
RDB_MAX_HEXDUMP_LEN
);

8228 
	`sql_´št_”rÜ
("CHECKTABLE %s:„ecÜd: %s", 
bË_Çme
, 
buf
.
	`c_¡r
());

8230 
buf
 = 
	`rdb_hexdump
(
£c_key_cİy
.
	`±r
(), sec_key_cİy.
	`Ëngth
(),

8231 
RDB_MAX_HEXDUMP_LEN
);

8233 
	`sql_´št_”rÜ
("CHECKTABLE %s: index: %s", 
bË_Çme
, 
buf
.
	`c_¡r
());

8235 
”rÜ
;

8239 
	`sql_´št_šfÜm©iÚ
("CHECKTABLE %s: ... %lld indexƒntries checked "

8241 
bË_Çme
, 
rows
, 
checksums
);

8243 ià(
fœ¡_šdex
) {

8244 
row_checksums
 = 
m_row_checksums_checked
 - 
row_checksums_©_¡¬t
;

8245 
fœ¡_šdex
 = 
çl£
;

8247 
	`ha_šdex_’d
();

8250 ià(
row_checksums
 !ğ
	`ha_rows
(-1)) {

8252 
	`sql_´št_šfÜm©iÚ
("CHECKTABLE %s: %lldable„ecords had checksums",

8253 
bË_Çme
, 
row_checksums
);

8255 
	`exŒa
(
HA_EXTRA_NO_KEYREAD
);

8257 
m_v”ify_row_debug_checksums
 = 
§ve_v”ify_row_debug_checksums
;

8264 
	`DBUG_RETURN
(
HA_ADMIN_OK
);

8265 
”rÜ
:

8266 
m_v”ify_row_debug_checksums
 = 
§ve_v”ify_row_debug_checksums
;

8267 
	`ha_šdex_Ü_ºd_’d
();

8268 
	`exŒa
(
HA_EXTRA_NO_KEYREAD
);

8270 
	`DBUG_RETURN
(
HA_ADMIN_CORRUPT
);

8271 
	}
}

8273 
	$dbug_dump_¡r
(
FILE
 *cÚ¡ 
out
, cÚ¡ *cÚ¡ 
¡r
, 
Ën
) {

8274 
	`årštf
(
out
, "\"");

8275 
i
 = 0; i < 
Ën
; i++) {

8276 ià(
¡r
[
i
] > 32)

8277 
	`årštf
(
out
, "%c", 
¡r
[
i
]);

8279 
	`årštf
(
out
, "\\%d", 
¡r
[
i
]);

8281 
	`årštf
(
out
, "\"");

8282 
	}
}

8290 
	$dbug_dump_d©aba£
(
rocksdb
::
DB
 *cÚ¡ 
db
) {

8291 
FILE
 *cÚ¡ 
out
 = 
	`fİ’
("/tmp/rocksdb.dump", "wt");

8292 ià(!
out
)

8295 
rocksdb
::
I‹¿tÜ
 *
™
 = 
db
->
	`NewI‹¿tÜ
Ôocksdb::
	`R—dO±iÚs
());

8296 
™
->
	`S“kToFœ¡
(); it->
	`V®id
(); it->
	`Next
()) {

8297 
rocksdb
::
Sliû
 
key
 = 
™
->
	`key
();

8298 
rocksdb
::
Sliû
 
v®
 = 
™
->
	`v®ue
();

8299 
	`dbug_dump_¡r
(
out
, 
key
.
	`d©a
(), key.
	`size
());

8300 
	`årštf
(
out
, " -> ");

8301 
	`dbug_dump_¡r
(
out
, 
v®
.
	`d©a
(), v®.
	`size
());

8302 
	`årštf
(
out
, "\n");

8305 
d–‘e
 
™
;

8306 
	`fşo£
(
out
);

8307 
	}
}

8309 
rocksdb
::
Stus
 
ha_rocksdb
::
	$g‘_fÜ_upd©e
(

8310 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
, 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

8311 cÚ¡ 
rocksdb
::
Sliû
 &
key
,„ocksdb::
PšÇbËSliû
 *cÚ¡ 
v®ue
) const {

8312 
	`DBUG_ASSERT
(
m_lock_rows
 !ğ
RDB_LOCK_NONE
);

8313 cÚ¡ 
boŞ
 
exşusive
 = 
m_lock_rows
 !ğ
RDB_LOCK_READ
;

8315 
rocksdb
::
Stus
 
s
 = 
tx
->
	`g‘_fÜ_upd©e
(
cŞumn_çmy
, 
key
, 
v®ue
, 
exşusive
);

8319 ià(
s
.
	`IsBusy
(è&& !s.
	`IsD—dlock
() &&

8320 
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
	`ha_thd
()è=ğ
ISO_READ_COMMITTED
) {

8321 
tx
->
	`»Ëa£_¢­shÙ
();

8322 
tx
->
	`acquœe_¢­shÙ
(
çl£
);

8324 
s
 = 
tx
->
	`g‘_fÜ_upd©e
(
cŞumn_çmy
, 
key
, 
v®ue
, 
exşusive
);

8327  
s
;

8328 
	}
}

8330 
boŞ
 
ha_rocksdb
::
	$is_blšd_d–‘e_’abËd
()

8332 
THD
 *
thd
 = 
	`ha_thd
();

8333  (
	`THDVAR
(
thd
, 
blšd_d–‘e_´im¬y_key
) &&

8334 
thd
->
Ëx
->
sql_commªd
 =ğ
SQLCOM_DELETE
 &&

8335 
thd
->
Ëx
->
bË_couÁ
 == 1 &&

8336 
bË
->
s
->
keys
 == 1 &&

8337 !
	`has_hidd’_pk
(
bË
) &&

8338 !
thd
->
¾i_¦ave
);

8339 
	}
}

8349 
ha_rocksdb
::
	$g‘_row_by_rowid
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ *cÚ¡ 
rowid
,

8350 cÚ¡ 
ušt
 
rowid_size
, cÚ¡ 
boŞ
 
sk_lookup
,

8351 cÚ¡ 
boŞ
 
sk_‰l_check
) {

8352 
	`DBUG_ENTER_FUNC
();

8354 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

8355 
	`DBUG_ASSERT
(
rowid
 !ğ
nuÎ±r
);

8356 
	`DBUG_ASSERT
(
bË
 !ğ
nuÎ±r
);

8358 
rc
;

8360 
rocksdb
::
Sliû
 
	`key_¦iû
(
rowid
, 
rowid_size
);

8362 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

8363 
	`DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

8365 
	`DEBUG_SYNC
(
	`ha_thd
(), "rocksdb.get_row_by_rowid");

8366 
	`DBUG_EXECUTE_IF
("dbug.rocksdb.get_row_by_rowid", {

8367 
THD
 *
thd
 = 
	`ha_thd
();

8368 cÚ¡ 
aù
[] = "now signal Reached "

8370 
	`DBUG_ASSERT
(
İt_debug_sync_timeout
 > 0);

8371 
	`DBUG_ASSERT
(!
	`debug_sync_£t_aùiÚ
(
thd
, 
	`STRING_WITH_LEN
(
aù
)));

8374 
boŞ
 
found
;

8375 
rocksdb
::
Stus
 
s
;

8378 ià(
sk_lookup
)

8380 
¡©s
.
rows_d–‘ed_blšd
++;

8381 
	`upd©e_row_¡©s
(
ROWS_DELETED_BLIND
);

8382 
m_Ï¡_rowkey
.
	`cİy
((cÚ¡ *)
rowid
, 
rowid_size
, &
my_ch¬£t_bš
);

8383 
bË
->
¡©us
 = 0;

8384 
	`DBUG_RETURN
(0);

8387 ià(
m_lock_rows
 =ğ
RDB_LOCK_NONE
) {

8388 
tx
->
	`acquœe_¢­shÙ
(
Œue
);

8389 
s
 = 
tx
->
	`g‘
(
m_pk_desü
->
	`g‘_cf
(), 
key_¦iû
, &
m_»Œ›ved_»cÜd
);

8391 
s
 = 
	`g‘_fÜ_upd©e
(
tx
, 
m_pk_desü
->
	`g‘_cf
(), 
key_¦iû
,

8392 &
m_»Œ›ved_»cÜd
);

8395 
	`DBUG_EXECUTE_IF
("rocksdb_return_status_corrupted",

8396 
	`dbug_chªge_¡©us_to_cÜru±ed
(&
s
););

8398 ià(!
s
.
	`IsNÙFound
(è&& !s.
	`ok
()) {

8399 
	`DBUG_RETURN
(
tx
->
	`£t_¡©us_”rÜ
(
bË
->
š_u£
, 
s
, *
m_pk_desü
, 
m_tbl_def
,

8400 
m_bË_hªdËr
));

8402 
found
 = !
s
.
	`IsNÙFound
();

8404 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

8405 ià(
found
) {

8407 ià(!
sk_‰l_check
 && 
m_pk_desü
->
	`has_‰l
() &&

8408 
	`should_hide_‰l_»c
(*
m_pk_desü
, 
m_»Œ›ved_»cÜd
,

8409 
tx
->
m_¢­shÙ_time¡amp
)) {

8410 
	`DBUG_RETURN
(
HA_ERR_KEY_NOT_FOUND
);

8413 
m_Ï¡_rowkey
.
	`cİy
((cÚ¡ *)
rowid
, 
rowid_size
, &
my_ch¬£t_bš
);

8414 
rc
 = 
	`cÚv”t_»cÜd_äom_¡Üage_fÜm©
(&
key_¦iû
, 
buf
);

8416 ià(!
rc
) {

8417 
bË
->
¡©us
 = 0;

8424 
rc
 = 
HA_ERR_KEY_NOT_FOUND
;

8427 
	`DBUG_RETURN
(
rc
);

8428 
	}
}

8435 
ha_rocksdb
::
	$šdex_Ãxt
(
uch¬
 *cÚ¡ 
buf
) {

8436 
	`DBUG_ENTER_FUNC
();

8438 
boŞ
 
moves_fÜw¬d
 = 
Œue
;

8439 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_»ad_Ãxt_couÁ
);

8440 ià(
m_key_desü_¬r
[
aùive_šdex
]->
m_is_»v”£_cf
) {

8441 
moves_fÜw¬d
 = 
çl£
;

8444 
rc
 = 
	`šdex_Ãxt_w™h_dœeùiÚ
(
buf
, 
moves_fÜw¬d
);

8445 ià(
rc
 =ğ
HA_ERR_KEY_NOT_FOUND
)

8446 
rc
 = 
HA_ERR_END_OF_FILE
;

8448 
	`DBUG_RETURN
(
rc
);

8449 
	}
}

8456 
ha_rocksdb
::
	$šdex_´ev
(
uch¬
 *cÚ¡ 
buf
) {

8457 
	`DBUG_ENTER_FUNC
();

8459 
boŞ
 
moves_fÜw¬d
 = 
çl£
;

8460 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_»ad_´ev_couÁ
);

8461 ià(
m_key_desü_¬r
[
aùive_šdex
]->
m_is_»v”£_cf
) {

8462 
moves_fÜw¬d
 = 
Œue
;

8465 
rc
 = 
	`šdex_Ãxt_w™h_dœeùiÚ
(
buf
, 
moves_fÜw¬d
);

8466 ià(
rc
 =ğ
HA_ERR_KEY_NOT_FOUND
)

8467 
rc
 = 
HA_ERR_END_OF_FILE
;

8469 
	`DBUG_RETURN
(
rc
);

8470 
	}
}

8472 
ha_rocksdb
::
	$šdex_Ãxt_w™h_dœeùiÚ
(
uch¬
 *cÚ¡ 
buf
, 
boŞ
 
move_fÜw¬d
) {

8473 
	`DBUG_ENTER_FUNC
();

8475 
rc
;

8477 ià(
aùive_šdex
 =ğ
	`pk_šdex
(
bË
, 
m_tbl_def
)) {

8478 
rc
 = 
	`ºd_Ãxt_w™h_dœeùiÚ
(
buf
, 
move_fÜw¬d
);

8480 ià(
m_sk_sÿn_™_Ãxt_ÿÎ
) {

8481 
m_sk_sÿn_™_Ãxt_ÿÎ
 = 
çl£
;

8483 ià(
move_fÜw¬d
)

8484 
m_sÿn_™
->
	`Next
();

8486 
m_sÿn_™
->
	`P»v
();

8488 
	`rocksdb_sk_expœed_»cÜds
(*
m_key_desü_¬r
[
aùive_šdex
], 
m_sÿn_™
,

8489 !
move_fÜw¬d
);

8490 
rc
 = 
	`fšd_iı_m©chšg_šdex_»c
(
move_fÜw¬d
, 
buf
);

8491 ià(!
rc
)

8492 
rc
 = 
	`£cÚd¬y_šdex_»ad
(
aùive_šdex
, 
buf
);

8495 
	`DBUG_RETURN
(
rc
);

8496 
	}
}

8503 
ha_rocksdb
::
	$šdex_fœ¡
(
uch¬
 *cÚ¡ 
buf
) {

8504 
	`DBUG_ENTER_FUNC
();

8506 
m_sk_m©ch_´efix
 = 
nuÎ±r
;

8507 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_»ad_fœ¡_couÁ
);

8508 
rc
 = 
m_key_desü_¬r
[
aùive_šdex
]->
m_is_»v”£_cf


8509 ? 
	`šdex_Ï¡_š‹º
(
buf
)

8510 : 
	`šdex_fœ¡_š‹º
(
buf
);

8511 ià(
rc
 =ğ
HA_ERR_KEY_NOT_FOUND
)

8512 
rc
 = 
HA_ERR_END_OF_FILE
;

8514 
	`DBUG_RETURN
(
rc
);

8515 
	}
}

8522 
ha_rocksdb
::
	$šdex_Ï¡
(
uch¬
 *cÚ¡ 
buf
) {

8523 
	`DBUG_ENTER_FUNC
();

8525 
m_sk_m©ch_´efix
 = 
nuÎ±r
;

8526 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_»ad_Ï¡_couÁ
);

8527 
rc
 = 
m_key_desü_¬r
[
aùive_šdex
]->
m_is_»v”£_cf


8528 ? 
	`šdex_fœ¡_š‹º
(
buf
)

8529 : 
	`šdex_Ï¡_š‹º
(
buf
);

8530 ià(
rc
 =ğ
HA_ERR_KEY_NOT_FOUND
)

8531 
rc
 = 
HA_ERR_END_OF_FILE
;

8533 
	`DBUG_RETURN
(
rc
);

8534 
	}
}

8567 
ha_rocksdb
::
	$šdex_fœ¡_š‹º
(
uch¬
 *cÚ¡ 
buf
) {

8568 
	`DBUG_ENTER_FUNC
();

8570 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

8572 
uch¬
 *
key
;

8573 
ušt
 
key_size
;

8574 
rc
;

8576 ià(
	`is_pk
(
aùive_šdex
, 
bË
, 
m_tbl_def
)) {

8577 
key
 = 
m_pk_·cked_tu¶e
;

8579 
key
 = 
m_sk_·cked_tu¶e
;

8582 
	`DBUG_ASSERT
(
key
 !ğ
nuÎ±r
);

8584 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
aùive_šdex
];

8585 
key_¡¬t_m©chšg_by‹s
 = 
kd
.
	`g‘_fœ¡_key
(
key
, &
key_size
);

8587 
rocksdb
::
Sliû
 
	`šdex_key
((cÚ¡ *)
key
, 
key_size
);

8589 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

8590 
	`DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

8592 cÚ¡ 
boŞ
 
is_Ãw_¢­shÙ
 = !
tx
->
	`has_¢­shÙ
();

8596 
	`£tup_sÿn_™”©Ü
(
kd
, &
šdex_key
, 
çl£
, 
key_¡¬t_m©chšg_by‹s
);

8597 
m_sÿn_™
->
	`S“k
(
šdex_key
);

8598 
m_sk_sÿn_™_Ãxt_ÿÎ
 = 
Œue
;

8600 
rc
 = 
	`šdex_Ãxt_w™h_dœeùiÚ
(
buf
, 
Œue
);

8601 ià(
rc
 !ğ
HA_ERR_LOCK_DEADLOCK
 || !
is_Ãw_¢­shÙ
)

8605 
tx
->
	`»Ëa£_¢­shÙ
();

8606 
	`»Ëa£_sÿn_™”©Ü
();

8609 ià(!
rc
) {

8614 
¡©s
.
rows_šdex_fœ¡
++;

8615 
¡©s
.
rows_šdex_Ãxt
--;

8618 
	`DBUG_RETURN
(
rc
);

8619 
	}
}

8658 
ha_rocksdb
::
	$šdex_Ï¡_š‹º
(
uch¬
 *cÚ¡ 
buf
) {

8659 
	`DBUG_ENTER_FUNC
();

8661 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

8663 
uch¬
 *
key
;

8664 
ušt
 
key_size
;

8665 
rc
;

8667 ià(
	`is_pk
(
aùive_šdex
, 
bË
, 
m_tbl_def
)) {

8668 
key
 = 
m_pk_·cked_tu¶e
;

8670 
key
 = 
m_sk_·cked_tu¶e
;

8673 
	`DBUG_ASSERT
(
key
 !ğ
nuÎ±r
);

8675 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
aùive_šdex
];

8676 ià(
kd
.
m_is_»v”£_cf
) {

8677 
kd
.
	`g‘_šfimum_key
(
key
, &
key_size
);

8679 
kd
.
	`g‘_su´emum_key
(
key
, &
key_size
);

8682 
rocksdb
::
Sliû
 
	`šdex_key
((cÚ¡ *)
key
, 
key_size
);

8684 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

8685 
	`DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

8687 
boŞ
 
is_Ãw_¢­shÙ
 = !
tx
->
	`has_¢­shÙ
();

8691 
	`£tup_sÿn_™”©Ü
(
kd
, &
šdex_key
, 
çl£
, 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

8692 
m_sÿn_™
->
	`S“kFÜP»v
(
šdex_key
);

8693 
m_sk_sÿn_™_Ãxt_ÿÎ
 = 
çl£
;

8695 ià(
	`is_pk
(
aùive_šdex
, 
bË
, 
m_tbl_def
)) {

8696 
m_sk_sÿn_™_Ãxt_ÿÎ
 = 
Œue
;

8697 
rc
 = 
	`ºd_Ãxt_w™h_dœeùiÚ
(
buf
, 
çl£
);

8699 
rc
 = 
	`fšd_iı_m©chšg_šdex_»c
(
çl£
 , 
buf
);

8700 ià(!
rc
)

8701 
rc
 = 
	`£cÚd¬y_šdex_»ad
(
aùive_šdex
, 
buf
);

8704 ià(
rc
 !ğ
HA_ERR_LOCK_DEADLOCK
 || !
is_Ãw_¢­shÙ
)

8708 
tx
->
	`»Ëa£_¢­shÙ
();

8709 
	`»Ëa£_sÿn_™”©Ü
();

8712 ià(!
rc
) {

8717 
¡©s
.
rows_šdex_fœ¡
++;

8718 
¡©s
.
rows_šdex_Ãxt
--;

8721 
	`DBUG_RETURN
(
rc
);

8722 
	}
}

8724 
ha_rocksdb
::
	$uÆock_row
() {

8725 
	`DBUG_ENTER_FUNC
();

8727 ià(
m_lock_rows
 !ğ
RDB_LOCK_NONE
) {

8728 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

8729 
tx
->
	`»Ëa£_lock
(
m_pk_desü
->
	`g‘_cf
(),

8730 
¡d
::
	`¡ršg
(
m_Ï¡_rowkey
.
	`±r
(), m_Ï¡_rowkey.
	`Ëngth
()));

8733 
DBUG_VOID_RETURN
;

8734 
	}
}

8742 
boŞ
 
ha_rocksdb
::
	$ÿn_u£_sšgË_d–‘e
(cÚ¡ 
ušt
 &
šdex
) const {

8743  (
šdex
 !ğ
	`pk_šdex
(
bË
, 
m_tbl_def
) ||

8744 (!
	`has_hidd’_pk
(
bË
) &&

8745 
bË
->
key_šfo
[
šdex
].
aùu®_key_·¹s
 =ğbË->
s
->
f›lds
));

8746 
	}
}

8748 
boŞ
 
ha_rocksdb
::
	$sk_unique_check
() const {

8759  
	`THDVAR
(
bË
->
š_u£
, 
bulk_lßd
) ||

8760 (
m_fÜû_sk_unique_check
 && 
m_sk_unique_check
) ||

8761 (
my_cÜe
::
	`thd_‹¡_İtiÚs
(
bË
->
š_u£
,

8762 
OPTION_RELAXED_UNIQUE_CHECKS
) &&

8763 
m_tbl_def
->
m_key_couÁ
 == 1);

8764 
	}
}

8766 
ha_rocksdb
::
	$£t_fÜû_sk_unique_check
(
boŞ
 
sk
) {

8767 
	`DBUG_ENTER_FUNC
();

8769 
m_fÜû_sk_unique_check
 = 
sk
;

8771 
DBUG_VOID_RETURN
;

8772 
	}
}

8774 
boŞ
 
ha_rocksdb
::
	$comm™_š_the_middË
() {

8775  
	`THDVAR
(
bË
->
š_u£
, 
bulk_lßd
) ||

8776 
	`THDVAR
(
bË
->
š_u£
, 
comm™_š_the_middË
);

8777 
	}
}

8784 
boŞ
 
ha_rocksdb
::
	$do_bulk_comm™
(
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
) {

8785 
	`DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

8786  
	`comm™_š_the_middË
() &&

8787 
tx
->
	`g‘_wr™e_couÁ
(è>ğ
	`THDVAR
(
bË
->
š_u£
, 
bulk_lßd_size
) &&

8788 
tx
->
	`æush_b©ch
();

8789 
	}
}

8797 
boŞ
 
ha_rocksdb
::
	$has_hidd’_pk
(cÚ¡ 
TABLE
 *cÚ¡ 
bË
) const {

8798 
	`DBUG_ASSERT
(
bË
 !ğ
nuÎ±r
);

8799  
Rdb_key_def
::
	`bË_has_hidd’_pk
(
bË
);

8800 
	}
}

8806 
boŞ
 
ha_rocksdb
::
	$is_hidd’_pk
(cÚ¡ 
ušt
 
šdex
, cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

8807 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
) {

8808 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

8809 
	`DBUG_ASSERT
(
bË_¬g
->
s
 !ğ
nuÎ±r
);

8810 
	`DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

8812  (
bË_¬g
->
s
->
´im¬y_key
 =ğ
MAX_INDEXES
 &&

8813 
šdex
 =ğ
tbl_def_¬g
->
m_key_couÁ
 - 1);

8814 
	}
}

8817 
ušt
 
ha_rocksdb
::
	$pk_šdex
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

8818 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
) {

8819 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

8820 
	`DBUG_ASSERT
(
bË_¬g
->
s
 !ğ
nuÎ±r
);

8821 
	`DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

8823  
bË_¬g
->
s
->
´im¬y_key
 =ğ
MAX_INDEXES
 ? 
tbl_def_¬g
->
m_key_couÁ
 - 1

8824 : 
bË_¬g
->
s
->
´im¬y_key
;

8825 
	}
}

8828 
boŞ
 
ha_rocksdb
::
	$is_pk
(cÚ¡ 
ušt
 
šdex
, cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

8829 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
) {

8830 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

8831 
	`DBUG_ASSERT
(
bË_¬g
->
s
 !ğ
nuÎ±r
);

8832 
	`DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

8834  
šdex
 =ğ
bË_¬g
->
s
->
´im¬y_key
 ||

8835 
	`is_hidd’_pk
(
šdex
, 
bË_¬g
, 
tbl_def_¬g
);

8836 
	}
}

8838 
ušt
 
ha_rocksdb
::
	$max_suµÜ‹d_key_·¹_Ëngth
() const {

8839 
	`DBUG_ENTER_FUNC
();

8840 
	`DBUG_RETURN
(
rocksdb_Ïrge_´efix
 ? 
MAX_INDEX_COL_LEN_LARGE


8841 : 
MAX_INDEX_COL_LEN_SMALL
);

8842 
	}
}

8844 cÚ¡ *
ha_rocksdb
::
	$g‘_key_Çme
(cÚ¡ 
ušt
 
šdex
,

8845 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

8846 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
) {

8847 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

8848 
	`DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

8850 ià(
	`is_hidd’_pk
(
šdex
, 
bË_¬g
, 
tbl_def_¬g
)) {

8851  
HIDDEN_PK_NAME
;

8854 
	`DBUG_ASSERT
(
bË_¬g
->
key_šfo
 !ğ
nuÎ±r
);

8855 
	`DBUG_ASSERT
(
bË_¬g
->
key_šfo
[
šdex
].
Çme
 !ğ
nuÎ±r
);

8857  
bË_¬g
->
key_šfo
[
šdex
].
Çme
;

8858 
	}
}

8860 cÚ¡ *
ha_rocksdb
::
	$g‘_key_comm’t
(cÚ¡ 
ušt
 
šdex
,

8861 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

8862 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
) {

8863 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

8864 
	`DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

8866 ià(
	`is_hidd’_pk
(
šdex
, 
bË_¬g
, 
tbl_def_¬g
)) {

8867  
nuÎ±r
;

8870 
	`DBUG_ASSERT
(
bË_¬g
->
key_šfo
 !ğ
nuÎ±r
);

8872  
bË_¬g
->
key_šfo
[
šdex
].
comm’t
.
¡r
;

8873 
	}
}

8875 cÚ¡ 
¡d
::
¡ršg
 
ha_rocksdb
::
	$g’”©e_cf_Çme
(cÚ¡ 
ušt
 
šdex
,

8876 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

8877 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

8878 
boŞ
 *
³r_·¹_m©ch_found
) {

8879 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

8880 
	`DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

8881 
	`DBUG_ASSERT
(
³r_·¹_m©ch_found
 !ğ
nuÎ±r
);

8885 *
³r_·¹_m©ch_found
 = 
çl£
;

8890 cÚ¡ *cÚ¡ 
comm’t
 = 
	`g‘_key_comm’t
(
šdex
, 
bË_¬g
, 
tbl_def_¬g
);

8893 
¡d
::
¡ršg
 
key_comm’t
 = 
comm’t
 ? comment : "";

8895 
¡d
::
¡ršg
 
cf_Çme
 = 
Rdb_key_def
::
	`·r£_comm’t_fÜ_qu®if›r
(

8896 
key_comm’t
, 
bË_¬g
, 
tbl_def_¬g
, 
³r_·¹_m©ch_found
,

8897 
RDB_CF_NAME_QUALIFIER
);

8899 ià(
bË_¬g
->
·¹_šfo
 !ğ
nuÎ±r
 && !*
³r_·¹_m©ch_found
) {

8909 ià(
cf_Çme
.
	`em±y
(è&& !
key_comm’t
.empty()) {

8910  
key_comm’t
;

8913  
cf_Çme
;

8914 
	}
}

8916 cÚ¡ 
¡d
::
¡ršg
 
ha_rocksdb
::
	$g‘_bË_comm’t
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
) {

8917 
	`DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

8918 
	`DBUG_ASSERT
(
bË_¬g
->
s
 !ğ
nuÎ±r
);

8920  
bË_¬g
->
s
->
comm’t
.
¡r
;

8921 
	}
}

8928 
ha_rocksdb
::
	$wr™e_row
(
uch¬
 *cÚ¡ 
buf
) {

8929 
	`DBUG_ENTER_FUNC
();

8931 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

8932 
	`DBUG_ASSERT
(
buf
 =ğ
bË
->
»cÜd
[0]);

8933 
	`DBUG_ASSERT
(
m_lock_rows
 =ğ
RDB_LOCK_WRITE
);

8935 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_wr™e_couÁ
);

8940 ià(
bË
->
Ãxt_numb”_f›ld
 && 
buf
 =ğbË->
»cÜd
[0]) {

8941 
”r
;

8942 ià((
”r
 = 
	`upd©e_auto_šüem’t
())) {

8943 
	`DBUG_RETURN
(
”r
);

8947 cÚ¡ 
rv
 = 
	`upd©e_wr™e_row
(
nuÎ±r
, 
buf
, 
	`sk_unique_check
());

8949 ià(
rv
 == 0) {

8950 
¡©s
.
rows_š£¹ed
++;

8951 
	`upd©e_row_¡©s
(
ROWS_INSERTED
);

8954 
	`DBUG_RETURN
(
rv
);

8955 
	}
}

8966 
ha_rocksdb
::
	$£t_Ï¡_rowkey
(cÚ¡ 
uch¬
 *cÚ¡ 
Şd_d©a
) {

8967 ià(
Şd_d©a
 && 
	`u£_»ad_ä“_½l
()) {

8968 cÚ¡ 
Şd_pk_size
 = 
m_pk_desü
->
	`·ck_»cÜd
(

8969 
bË
, 
m_·ck_bufãr
, 
Şd_d©a
, 
m_pk_·cked_tu¶e
, 
nuÎ±r
, 
çl£
);

8970 
m_Ï¡_rowkey
.
	`cİy
((cÚ¡ *)
m_pk_·cked_tu¶e
, 
Şd_pk_size
,

8971 &
my_ch¬£t_bš
);

8973 
	}
}

8975 
ha_rocksdb
::
	$g‘_pk_fÜ_upd©e
(
upd©e_row_šfo
 *cÚ¡ 
row_šfo
) {

8976 
size
;

8982 ià(!
	`has_hidd’_pk
(
bË
)) {

8983 
row_šfo
->
hidd’_pk_id
 = 0;

8985 
row_šfo
->
Ãw_pk_uÅack_šfo
 = &
m_pk_uÅack_šfo
;

8987 
size
 =

8988 
m_pk_desü
->
	`·ck_»cÜd
(
bË
, 
m_·ck_bufãr
, 
row_šfo
->
Ãw_d©a
,

8989 
m_pk_·cked_tu¶e
, 
row_šfo
->
Ãw_pk_uÅack_šfo
,

8990 
çl£
, 0, 0, 
nuÎ±r
, &
row_šfo
->
‰l_pk_off£t
);

8991 } ià(
row_šfo
->
Şd_d©a
 =ğ
nuÎ±r
) {

8992 
row_šfo
->
hidd’_pk_id
 = 
	`upd©e_hidd’_pk_v®
();

8993 
size
 =

8994 
m_pk_desü
->
	`·ck_hidd’_pk
(
row_šfo
->
hidd’_pk_id
, 
m_pk_·cked_tu¶e
);

9000 
size
 = 
row_šfo
->
Şd_pk_¦iû
.
	`size
();

9001 
	`memıy
(
m_pk_·cked_tu¶e
, 
row_šfo
->
Şd_pk_¦iû
.
	`d©a
(), 
size
);

9002 
”r
 = 
	`»ad_hidd’_pk_id_äom_rowkey
(&
row_šfo
->
hidd’_pk_id
);

9003 ià(
”r
) {

9004  
”r
;

9008 
row_šfo
->
Ãw_pk_¦iû
 =

9009 
rocksdb
::
	`Sliû
((cÚ¡ *)
m_pk_·cked_tu¶e
, 
size
);

9011  
HA_EXIT_SUCCESS
;

9012 
	}
}

9014 
ha_rocksdb
::
	$check_ªd_lock_unique_pk
(cÚ¡ 
ušt
 &
key_id
,

9015 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

9016 
boŞ
 *cÚ¡ 
found
,

9017 
boŞ
 *cÚ¡ 
pk_chªged
) {

9018 
	`DBUG_ASSERT
(
found
 !ğ
nuÎ±r
);

9019 
	`DBUG_ASSERT
(
pk_chªged
 !ğ
nuÎ±r
);

9021 *
pk_chªged
 = 
çl£
;

9027 ià(
row_šfo
.
Şd_pk_¦iû
.
	`size
() > 0) {

9031 ià(!
Rdb_pk_com·¿tÜ
::
	`by‹wi£_com·»
(
row_šfo
.
Ãw_pk_¦iû
,

9032 
row_šfo
.
Şd_pk_¦iû
)) {

9033 *
found
 = 
çl£
;

9034  
HA_EXIT_SUCCESS
;

9037 *
pk_chªged
 = 
Œue
;

9059 cÚ¡ 
rocksdb
::
Stus
 
s
 =

9060 
	`g‘_fÜ_upd©e
(
row_šfo
.
tx
, 
m_pk_desü
->
	`g‘_cf
(),„ow_šfo.
Ãw_pk_¦iû
,

9061 &
m_»Œ›ved_»cÜd
);

9062 ià(!
s
.
	`ok
(è&& !s.
	`IsNÙFound
()) {

9063  
row_šfo
.
tx
->
	`£t_¡©us_”rÜ
(

9064 
bË
->
š_u£
, 
s
, *
m_key_desü_¬r
[
key_id
], 
m_tbl_def
, 
m_bË_hªdËr
);

9067 *
found
 = !
s
.
	`IsNÙFound
();

9068  
HA_EXIT_SUCCESS
;

9069 
	}
}

9071 
ha_rocksdb
::
	$check_ªd_lock_sk
(cÚ¡ 
ušt
 &
key_id
,

9072 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

9073 
boŞ
 *cÚ¡ 
found
) {

9074 
	`DBUG_ASSERT
(
found
 !ğ
nuÎ±r
);

9075 *
found
 = 
çl£
;

9080 ià(
row_šfo
.
Şd_d©a
 !ğ
nuÎ±r
 && !
m_upd©e_scİe
.
	`is_£t
(
key_id
)) {

9081  
HA_EXIT_SUCCESS
;

9084 
KEY
 *
key_šfo
 = 
nuÎ±r
;

9085 
ušt
 
n_nuÎ_f›lds
 = 0;

9086 
ušt
 
u£r_defšed_key_·¹s
 = 1;

9088 
key_šfo
 = &
bË
->key_šfo[
key_id
];

9089 
u£r_defšed_key_·¹s
 = 
key_šfo
->user_defined_key_parts;

9094 ià(!(
key_šfo
->
æags
 & 
HA_NOSAME
)) {

9095  
HA_EXIT_SUCCESS
;

9098 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
key_id
];

9106 
size
 =

9107 
kd
.
	`·ck_»cÜd
(
bË
, 
m_·ck_bufãr
, 
row_šfo
.
Ãw_d©a
, 
m_sk_·cked_tu¶e
,

9108 
nuÎ±r
, 
çl£
, 0, 
u£r_defšed_key_·¹s
, &
n_nuÎ_f›lds
);

9109 ià(
n_nuÎ_f›lds
 > 0) {

9114  
HA_EXIT_SUCCESS
;

9117 cÚ¡ 
rocksdb
::
Sliû
 
Ãw_¦iû
 =

9118 
rocksdb
::
	`Sliû
((cÚ¡ *)
m_sk_·cked_tu¶e
, 
size
);

9123 ià(
row_šfo
.
Şd_d©a
 !ğ
nuÎ±r
) {

9124 
size
 = 
kd
.
	`·ck_»cÜd
(
bË
, 
m_·ck_bufãr
, 
row_šfo
.
Şd_d©a
,

9125 
m_sk_·cked_tu¶e_Şd
, 
nuÎ±r
, 
çl£
, 0,

9126 
u£r_defšed_key_·¹s
);

9127 cÚ¡ 
rocksdb
::
Sliû
 
Şd_¦iû
 =

9128 
rocksdb
::
	`Sliû
((cÚ¡ *)
m_sk_·cked_tu¶e_Şd
, 
size
);

9130 cÚ¡ 
rocksdb
::
Stus
 
s
 =

9131 
	`g‘_fÜ_upd©e
(
row_šfo
.
tx
, 
kd
.
	`g‘_cf
(), 
Şd_¦iû
, 
nuÎ±r
);

9132 ià(!
s
.
	`ok
()) {

9133  
row_šfo
.
tx
->
	`£t_¡©us_”rÜ
(
bË
->
š_u£
, 
s
, 
kd
, 
m_tbl_def
,

9134 
m_bË_hªdËr
);

9141 ià(!
Rdb_pk_com·¿tÜ
::
	`by‹wi£_com·»
(
Ãw_¦iû
, 
Şd_¦iû
)) {

9142  
HA_EXIT_SUCCESS
;

9154 cÚ¡ 
boŞ
 
®l_·¹s_u£d
 = (
u£r_defšed_key_·¹s
 =ğ
kd
.
	`g‘_key_·¹s
());

9167 
uch¬
 
low”_bound_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

9168 
uch¬
 
uµ”_bound_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

9169 
rocksdb
::
Sliû
 
low”_bound_¦iû
;

9170 
rocksdb
::
Sliû
 
uµ”_bound_¦iû
;

9172 cÚ¡ 
boŞ
 
tÙ®_Üd”_£ek
 = !
	`check_bloom_ªd_£t_bounds
(

9173 
	`ha_thd
(), 
kd
, 
Ãw_¦iû
, 
®l_·¹s_u£d
, 
Rdb_key_def
::
INDEX_NUMBER_SIZE
,

9174 
low”_bound_buf
, 
uµ”_bound_buf
, &
low”_bound_¦iû
, &
uµ”_bound_¦iû
);

9175 cÚ¡ 
boŞ
 
fl_ÿche
 = !
	`THDVAR
(
	`ha_thd
(), 
sk_fl_ÿche
);

9177 cÚ¡ 
rocksdb
::
Stus
 
s
 =

9178 
	`g‘_fÜ_upd©e
(
row_šfo
.
tx
, 
kd
.
	`g‘_cf
(), 
Ãw_¦iû
, 
nuÎ±r
);

9179 ià(!
s
.
	`ok
(è&& !s.
	`IsNÙFound
()) {

9180  
row_šfo
.
tx
->
	`£t_¡©us_”rÜ
(
bË
->
š_u£
, 
s
, 
kd
, 
m_tbl_def
,

9181 
m_bË_hªdËr
);

9184 
rocksdb
::
I‹¿tÜ
 *cÚ¡ 
™”
 = 
row_šfo
.
tx
->
	`g‘_™”©Ü
(

9185 
kd
.
	`g‘_cf
(), 
tÙ®_Üd”_£ek
, 
fl_ÿche
, 
low”_bound_¦iû
,

9186 
uµ”_bound_¦iû
, 
Œue
 ,

9187 
çl£
 );

9193 
™”
->
	`S“k
(
Ãw_¦iû
);

9194 *
found
 = !
	`»ad_key_exaù
(
kd
, 
™”
, 
®l_·¹s_u£d
, 
Ãw_¦iû
,

9195 
row_šfo
.
tx
->
m_¢­shÙ_time¡amp
);

9196 
d–‘e
 
™”
;

9198  
HA_EXIT_SUCCESS
;

9199 
	}
}

9201 
ha_rocksdb
::
	$check_uniqu’ess_ªd_lock
(

9202 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
, 
boŞ
 *cÚ¡ 
pk_chªged
) {

9209 
ušt
 
key_id
 = 0; key_id < 
m_tbl_def
->
m_key_couÁ
; key_id++) {

9210 
boŞ
 
found
;

9211 
rc
;

9213 ià(
	`is_pk
(
key_id
, 
bË
, 
m_tbl_def
)) {

9214 
rc
 = 
	`check_ªd_lock_unique_pk
(
key_id
, 
row_šfo
, &
found
, 
pk_chªged
);

9216 
rc
 = 
	`check_ªd_lock_sk
(
key_id
, 
row_šfo
, &
found
);

9219 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

9220  
rc
;

9228 ià(
	`is_pk
(
key_id
, 
bË
, 
m_tbl_def
è&& 
found
 && 
m_pk_desü
->
	`has_‰l
() &&

9229 
	`should_hide_‰l_»c
(*
m_pk_desü
, 
m_»Œ›ved_»cÜd
,

9230 (
row_šfo
.
tx
->
m_¢­shÙ_time¡amp


9231 ? 
row_šfo
.
tx
->
m_¢­shÙ_time¡amp


9232 : 
¡©ic_ÿ¡
<
št64_t
>(
¡d
::
	`time
(
nuÎ±r
))))) {

9233 
found
 = 
çl£
;

9236 ià(
found
) {

9238 
”rkey
 = 
key_id
;

9239 
m_duµ_”rkey
 = 
”rkey
;

9240  
HA_ERR_FOUND_DUPP_KEY
;

9244  
HA_EXIT_SUCCESS
;

9245 
	}
}

9247 
ha_rocksdb
::
	$check_du¶iÿ‹_sk
(cÚ¡ 
TABLE
 *
bË_¬g
,

9248 cÚ¡ 
Rdb_key_def
 &
šdex
,

9249 cÚ¡ 
rocksdb
::
Sliû
 *
key
,

9250 
unique_sk_buf_šfo
 *
sk_šfo
) {

9251 
ušt
 
n_nuÎ_f›lds
 = 0;

9252 cÚ¡ 
rocksdb
::
Com·¿tÜ
 *
šdex_comp
 = 
šdex
.
	`g‘_cf
()->
	`G‘Com·¿tÜ
();

9255 
uch¬
 *
sk_buf
 = 
sk_šfo
->
	`sw­_ªd_g‘_sk_buf
();

9258 
ušt
 
sk_memcmp_size
 =

9259 
šdex
.
	`g‘_memcmp_sk_·¹s
(
bË_¬g
, *
key
, 
sk_buf
, &
n_nuÎ_f›lds
);

9261 
sk_šfo
->
sk_memcmp_key
 =

9262 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
sk_buf
), 
sk_memcmp_size
);

9264 ià(
sk_šfo
->
sk_memcmp_key_Şd
.
	`size
(è> 0 && 
n_nuÎ_f›lds
 == 0 &&

9265 
šdex_comp
->
	`Com·»
(
sk_šfo
->
sk_memcmp_key
, sk_šfo->
sk_memcmp_key_Şd
) ==

9270 
sk_šfo
->
sk_memcmp_key_Şd
 = sk_šfo->
sk_memcmp_key
;

9272 
	}
}

9274 
ha_rocksdb
::
	$bulk_lßd_key
(
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
, cÚ¡ 
Rdb_key_def
 &
kd
,

9275 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

9276 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
, 
boŞ
 
sÜt
) {

9277 
	`DBUG_ENTER_FUNC
();

9278 
»s
;

9279 
rocksdb
::
CŞumnFamyHªdË
 *
cf
 = 
kd
.
	`g‘_cf
();

9284 ià(
m_s¡_šfo
 =ğ
nuÎ±r
 || m_s¡_šfo->
	`is_comm™‹d
()) {

9285 
m_s¡_šfo
.
	`»£t
(
Ãw
 
	`Rdb_s¡_šfo
(
rdb
, 
m_bË_hªdËr
->
m_bË_Çme
,

9286 
kd
.
	`g‘_Çme
(), 
cf
, *
rocksdb_db_İtiÚs
,

9287 
	`THDVAR
(
	`ha_thd
(), 
Œaû_s¡_­i
)));

9288 
»s
 = 
tx
->
	`¡¬t_bulk_lßd
(
this
, 
m_s¡_šfo
);

9289 ià(
»s
 !ğ
HA_EXIT_SUCCESS
) {

9290 
	`DBUG_RETURN
(
»s
);

9293 
	`DBUG_ASSERT
(
m_s¡_šfo
);

9295 ià(
sÜt
) {

9296 
Rdb_šdex_m”ge
 *
key_m”ge
;

9297 
	`DBUG_ASSERT
(
cf
 !ğ
nuÎ±r
);

9299 
»s
 = 
tx
->
	`g‘_key_m”ge
(
kd
.
	`g‘_gl_šdex_id
(), 
cf
, &
key_m”ge
);

9300 ià(
»s
 =ğ
HA_EXIT_SUCCESS
) {

9301 
»s
 = 
key_m”ge
->
	`add
(
key
, 
v®ue
);

9304 
»s
 = 
m_s¡_šfo
->
	`put
(
key
, 
v®ue
);

9307 
	`DBUG_RETURN
(
»s
);

9308 
	}
}

9310 
ha_rocksdb
::
	$fš®ize_bulk_lßd
(
boŞ
 
´št_ş›Á_”rÜ
) {

9311 
	`DBUG_ENTER_FUNC
();

9313 
»s
 = 
HA_EXIT_SUCCESS
;

9316 ià(
m_s¡_šfo
) {

9317 
»s
 = 
m_s¡_šfo
->
	`comm™
(
´št_ş›Á_”rÜ
);

9318 
m_s¡_šfo
.
	`»£t
();

9320 
	`DBUG_RETURN
(
»s
);

9321 
	}
}

9323 
ha_rocksdb
::
	$upd©e_pk
(cÚ¡ 
Rdb_key_def
 &
kd
,

9324 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

9325 cÚ¡ 
boŞ
 &
pk_chªged
) {

9326 cÚ¡ 
ušt
 
key_id
 = 
kd
.
	`g‘_keyno
();

9327 cÚ¡ 
boŞ
 
hidd’_pk
 = 
	`is_hidd’_pk
(
key_id
, 
bË
, 
m_tbl_def
);

9328 
ulÚglÚg
 
by‹s_wr™‹n
 = 0;

9336 ià(!
hidd’_pk
 && (
pk_chªged
 || ((
row_šfo
.
Şd_pk_¦iû
.
	`size
() > 0) &&

9337 
	`ÿn_u£_sšgË_d–‘e
(
key_id
)))) {

9338 cÚ¡ 
rocksdb
::
Stus
 
s
 = 
	`d–‘e_Ü_sšgËd–‘e
(

9339 
key_id
, 
row_šfo
.
tx
, 
kd
.
	`g‘_cf
(),„ow_šfo.
Şd_pk_¦iû
);

9340 ià(!
s
.
	`ok
()) {

9341  
row_šfo
.
tx
->
	`£t_¡©us_”rÜ
(
bË
->
š_u£
, 
s
, 
kd
, 
m_tbl_def
,

9342 
m_bË_hªdËr
);

9344 
by‹s_wr™‹n
 = 
row_šfo
.
Şd_pk_¦iû
.
	`size
();

9348 ià(
bË
->
Ãxt_numb”_f›ld
) {

9349 
	`upd©e_auto_šü_v®_äom_f›ld
();

9352 
rc
 = 
HA_EXIT_SUCCESS
;

9353 
rocksdb
::
Sliû
 
v®ue_¦iû
;

9355 ià((
rc
 = 
	`cÚv”t_»cÜd_to_¡Üage_fÜm©
(
row_šfo
, &
v®ue_¦iû
))) {

9356  
rc
;

9359 cÚ¡‡utØ
cf
 = 
m_pk_desü
->
	`g‘_cf
();

9360 ià(
rocksdb_’abË_bulk_lßd_­i
 && 
	`THDVAR
(
bË
->
š_u£
, 
bulk_lßd
) &&

9361 !
hidd’_pk
) {

9365 
rc
 = 
	`bulk_lßd_key
(
row_šfo
.
tx
, 
kd
,„ow_šfo.
Ãw_pk_¦iû
, 
v®ue_¦iû
,

9366 
	`THDVAR
(
bË
->
š_u£
, 
bulk_lßd_®low_unsÜ‹d
));

9367 } ià(
row_šfo
.
sk_unique_check
 ||„ow_šfo.
tx
->
m_ddl_Œª§ùiÚ
) {

9372 
row_šfo
.
tx
->
	`g‘_šdexed_wr™e_b©ch
()->
	`Put
(
cf
,„ow_šfo.
Ãw_pk_¦iû
,

9373 
v®ue_¦iû
);

9375 cÚ¡‡utØ
s
 = 
row_šfo
.
tx
->
	`put
(
cf
,„ow_šfo.
Ãw_pk_¦iû
, 
v®ue_¦iû
);

9376 ià(!
s
.
	`ok
()) {

9377 ià(
s
.
	`IsBusy
()) {

9378 
”rkey
 = 
bË
->
s
->
´im¬y_key
;

9379 
m_duµ_”rkey
 = 
”rkey
;

9380 
rc
 = 
HA_ERR_FOUND_DUPP_KEY
;

9382 
rc
 = 
row_šfo
.
tx
->
	`£t_¡©us_”rÜ
(
bË
->
š_u£
, 
s
, *
m_pk_desü
,

9383 
m_tbl_def
, 
m_bË_hªdËr
);

9388 ià(
rc
 =ğ
HA_EXIT_SUCCESS
) {

9389 
row_šfo
.
tx
->
	`upd©e_by‹s_wr™‹n
(

9390 
by‹s_wr™‹n
 + 
row_šfo
.
Ãw_pk_¦iû
.
	`size
(è+ 
v®ue_¦iû
.size());

9392  
rc
;

9393 
	}
}

9395 
ha_rocksdb
::
	$upd©e_sk
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, cÚ¡ 
Rdb_key_def
 &
kd
,

9396 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

9397 cÚ¡ 
boŞ
 
bulk_lßd_sk
) {

9398 
Ãw_·cked_size
;

9399 
Şd_·cked_size
;

9400 
rc
 = 
HA_EXIT_SUCCESS
;

9402 
rocksdb
::
Sliû
 
Ãw_key_¦iû
;

9403 
rocksdb
::
Sliû
 
Ãw_v®ue_¦iû
;

9404 
rocksdb
::
Sliû
 
Şd_key_¦iû
;

9406 cÚ¡ 
ušt
 
key_id
 = 
kd
.
	`g‘_keyno
();

9408 
ulÚglÚg
 
by‹s_wr™‹n
 = 0;

9414 ià(
row_šfo
.
Şd_d©a
 !ğ
nuÎ±r
 && !
m_upd©e_scİe
.
	`is_£t
(
key_id
) &&

9415 (!
kd
.
	`has_‰l
(è|| !
m_‰l_by‹s_upd©ed
)) {

9416  
HA_EXIT_SUCCESS
;

9419 cÚ¡ 
boŞ
 
¡Üe_row_debug_checksums
 = 
	`should_¡Üe_row_debug_checksums
();

9421 
Ãw_·cked_size
 =

9422 
kd
.
	`·ck_»cÜd
(
bË_¬g
, 
m_·ck_bufãr
, 
row_šfo
.
Ãw_d©a
,

9423 
m_sk_·cked_tu¶e
, &
m_sk_s
, 
¡Üe_row_debug_checksums
,

9424 
row_šfo
.
hidd’_pk_id
, 0, 
nuÎ±r
,‚uÎ±r, 
m_‰l_by‹s
);

9426 ià(
row_šfo
.
Şd_d©a
 !ğ
nuÎ±r
) {

9428 
Şd_·cked_size
 = 
kd
.
	`·ck_»cÜd
(

9429 
bË_¬g
, 
m_·ck_bufãr
, 
row_šfo
.
Şd_d©a
, 
m_sk_·cked_tu¶e_Şd
,

9430 &
m_sk_s_Şd
, 
¡Üe_row_debug_checksums
, 
row_šfo
.
hidd’_pk_id
, 0,

9431 
nuÎ±r
,‚uÎ±r, 
m_‰l_by‹s
);

9447 ià(
Şd_·cked_size
 =ğ
Ãw_·cked_size
 &&

9448 
m_sk_s_Şd
.
	`g‘_cu¼’t_pos
(è=ğ
m_sk_s
.get_current_pos() &&

9449 !(
kd
.
	`has_‰l
(è&& 
m_‰l_by‹s_upd©ed
) &&

9450 
	`memcmp
(
m_sk_·cked_tu¶e_Şd
, 
m_sk_·cked_tu¶e
, 
Şd_·cked_size
) ==

9452 
	`memcmp
(
m_sk_s_Şd
.
	`±r
(), 
m_sk_s
.ptr(),

9453 
m_sk_s
.
	`g‘_cu¼’t_pos
()) == 0) {

9454  
HA_EXIT_SUCCESS
;

9463 
Şd_key_¦iû
 = 
rocksdb
::
	`Sliû
(

9464 
»š‹½»t_ÿ¡
<cÚ¡ *>(
m_sk_·cked_tu¶e_Şd
), 
Şd_·cked_size
);

9466 
row_šfo
.
tx
->
	`g‘_šdexed_wr™e_b©ch
()->
	`SšgËD–‘e
(
kd
.
	`g‘_cf
(),

9467 
Şd_key_¦iû
);

9469 
by‹s_wr™‹n
 = 
Şd_key_¦iû
.
	`size
();

9472 
Ãw_key_¦iû
 = 
rocksdb
::
	`Sliû
(

9473 
»š‹½»t_ÿ¡
<cÚ¡ *>(
m_sk_·cked_tu¶e
), 
Ãw_·cked_size
);

9474 
Ãw_v®ue_¦iû
 =

9475 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<cÚ¡ *>(
m_sk_s
.
	`±r
()),

9476 
m_sk_s
.
	`g‘_cu¼’t_pos
());

9478 ià(
bulk_lßd_sk
 && 
row_šfo
.
Şd_d©a
 =ğ
nuÎ±r
) {

9479 
rc
 = 
	`bulk_lßd_key
(
row_šfo
.
tx
, 
kd
, 
Ãw_key_¦iû
, 
Ãw_v®ue_¦iû
, 
Œue
);

9481 
row_šfo
.
tx
->
	`g‘_šdexed_wr™e_b©ch
()->
	`Put
(
kd
.
	`g‘_cf
(), 
Ãw_key_¦iû
,

9482 
Ãw_v®ue_¦iû
);

9485 
row_šfo
.
tx
->
	`upd©e_by‹s_wr™‹n
(
by‹s_wr™‹n
 + 
Ãw_key_¦iû
.
	`size
() +

9486 
Ãw_v®ue_¦iû
.
	`size
());

9488  
rc
;

9489 
	}
}

9491 
ha_rocksdb
::
	$upd©e_šdexes
(cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

9492 cÚ¡ 
boŞ
 &
pk_chªged
) {

9493 
rc
;

9494 
boŞ
 
bulk_lßd_sk
;

9497 
rc
 = 
	`upd©e_pk
(*
m_pk_desü
, 
row_šfo
, 
pk_chªged
);

9498 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

9499  
rc
;

9504 
bulk_lßd_sk
 = 
rocksdb_’abË_bulk_lßd_­i
 &&

9505 
	`THDVAR
(
bË
->
š_u£
, 
bulk_lßd
) &&

9506 
	`THDVAR
(
bË
->
š_u£
, 
bulk_lßd_®low_sk
);

9507 
ušt
 
key_id
 = 0; key_id < 
m_tbl_def
->
m_key_couÁ
; key_id++) {

9508 ià(
	`is_pk
(
key_id
, 
bË
, 
m_tbl_def
)) {

9512 
rc
 = 
	`upd©e_sk
(
bË
, *
m_key_desü_¬r
[
key_id
], 
row_šfo
, 
bulk_lßd_sk
);

9513 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

9514  
rc
;

9518  
HA_EXIT_SUCCESS
;

9519 
	}
}

9521 
ha_rocksdb
::
	$upd©e_wr™e_row
(cÚ¡ 
uch¬
 *cÚ¡ 
Şd_d©a
,

9522 cÚ¡ 
uch¬
 *cÚ¡ 
Ãw_d©a
,

9523 cÚ¡ 
boŞ
 
sk_unique_check
) {

9524 
	`DBUG_ENTER_FUNC
();

9526 
boŞ
 
pk_chªged
 = 
çl£
;

9527 
upd©e_row_šfo
 
row_šfo
;

9529 
row_šfo
.
Şd_d©a
 = old_data;

9530 
row_šfo
.
Ãw_d©a
 =‚ew_data;

9531 
row_šfo
.
sk_unique_check
 = skip_unique_check;

9532 
row_šfo
.
Ãw_pk_uÅack_šfo
 = 
nuÎ±r
;

9534 
	`£t_Ï¡_rowkey
(
Şd_d©a
);

9536 
row_šfo
.
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

9538 ià(
Şd_d©a
 !ğ
nuÎ±r
) {

9539 
row_šfo
.
Şd_pk_¦iû
 =

9540 
rocksdb
::
	`Sliû
(
m_Ï¡_rowkey
.
	`±r
(), m_Ï¡_rowkey.
	`Ëngth
());

9543 
	`ÿlc_upd©ed_šdexes
();

9549 
rc
 = 
	`g‘_pk_fÜ_upd©e
(&
row_šfo
);

9550 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

9551 
	`DBUG_RETURN
(
rc
);

9554 ià(!
sk_unique_check
) {

9559 
rc
 = 
	`check_uniqu’ess_ªd_lock
(
row_šfo
, &
pk_chªged
);

9560 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

9561 
	`DBUG_RETURN
(
rc
);

9565 
	`DEBUG_SYNC
(
	`ha_thd
(), "rocksdb.update_write_row_after_unique_check");

9573 
rc
 = 
	`upd©e_šdexes
(
row_šfo
, 
pk_chªged
);

9574 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

9575 
	`DBUG_RETURN
(
rc
);

9578 ià(
Şd_d©a
 !ğ
nuÎ±r
) {

9579 
row_šfo
.
tx
->
	`šü_upd©e_couÁ
();

9581 
row_šfo
.
tx
->
	`šü_š£¹_couÁ
();

9584 ià(
	`do_bulk_comm™
(
row_šfo
.
tx
)) {

9585 
	`DBUG_RETURN
(
HA_ERR_ROCKSDB_BULK_LOAD
);

9588 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

9589 
	}
}

9605 
ha_rocksdb
::
	$£tup_™”©Ü_bounds
(

9606 cÚ¡ 
Rdb_key_def
 &
kd
, cÚ¡ 
rocksdb
::
Sliû
 &
eq_cÚd
, 
size_t
 
bound_Ën
,

9607 
uch¬
 *cÚ¡ 
low”_bound
, uch¬ *cÚ¡ 
uµ”_bound
,

9608 
rocksdb
::
Sliû
 *
low”_bound_¦iû
,„ocksdb::Sliû *
uµ”_bound_¦iû
) {

9609 
ušt
 
mš_Ën
 = 
¡d
::
	`mš
(
eq_cÚd
.
	`size
(), 
bound_Ën
);

9610 
	`memıy
(
uµ”_bound
, 
eq_cÚd
.
	`d©a
(), 
mš_Ën
);

9611 
kd
.
	`sucûssÜ
(
uµ”_bound
, 
mš_Ën
);

9612 
	`memıy
(
low”_bound
, 
eq_cÚd
.
	`d©a
(), 
mš_Ën
);

9613 
kd
.
	`´edeûssÜ
(
low”_bound
, 
mš_Ën
);

9615 ià(
kd
.
m_is_»v”£_cf
) {

9616 *
uµ”_bound_¦iû
 = 
rocksdb
::
	`Sliû
((cÚ¡ *)
low”_bound
, 
mš_Ën
);

9617 *
low”_bound_¦iû
 = 
rocksdb
::
	`Sliû
((cÚ¡ *)
uµ”_bound
, 
mš_Ën
);

9619 *
uµ”_bound_¦iû
 = 
rocksdb
::
	`Sliû
((cÚ¡ *)
uµ”_bound
, 
mš_Ën
);

9620 *
low”_bound_¦iû
 = 
rocksdb
::
	`Sliû
((cÚ¡ *)
low”_bound
, 
mš_Ën
);

9622 
	}
}

9628 
ha_rocksdb
::
	$£tup_sÿn_™”©Ü
(cÚ¡ 
Rdb_key_def
 &
kd
,

9629 
rocksdb
::
Sliû
 *cÚ¡ 
¦iû
,

9630 cÚ¡ 
boŞ
 
u£_®l_keys
,

9631 cÚ¡ 
ušt
 
eq_cÚd_Ën
) {

9632 
	`DBUG_ASSERT
(
¦iû
 !ğ
nuÎ±r
);

9633 
	`DBUG_ASSERT
(
¦iû
->
	`size
(è>ğ
eq_cÚd_Ën
);

9635 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

9637 
boŞ
 
sk_bloom
 = 
Œue
;

9639 cÚ¡ 
rocksdb
::
Sliû
 
	`eq_cÚd
(
¦iû
->
	`d©a
(), 
eq_cÚd_Ën
);

9640 ià(
	`check_bloom_ªd_£t_bounds
(

9641 
	`ha_thd
(), 
kd
, 
eq_cÚd
, 
u£_®l_keys
, 
eq_cÚd_Ën
,

9642 
m_sÿn_™_low”_bound
, 
m_sÿn_™_uµ”_bound
,

9643 &
m_sÿn_™_low”_bound_¦iû
, &
m_sÿn_™_uµ”_bound_¦iû
)) {

9644 
sk_bloom
 = 
çl£
;

9664 ià(
m_sÿn_™_sks_bloom
 !ğ
sk_bloom
) {

9665 
	`»Ëa£_sÿn_™”©Ü
();

9672 ià(!
m_sÿn_™
) {

9673 cÚ¡ 
boŞ
 
fl_ÿche
 = !
	`THDVAR
(
	`ha_thd
(), 
sk_fl_ÿche
);

9674 ià(
	`comm™_š_the_middË
()) {

9675 
	`DBUG_ASSERT
(
m_sÿn_™_¢­shÙ
 =ğ
nuÎ±r
);

9676 
m_sÿn_™_¢­shÙ
 = 
rdb
->
	`G‘SÇpshÙ
();

9678 autØ
»ad_İts
 = 
rocksdb
::
	`R—dO±iÚs
();

9679 
»ad_İts
.
tÙ®_Üd”_£ek
 = 
Œue
;

9680 
»ad_İts
.
¢­shÙ
 = 
m_sÿn_™_¢­shÙ
;

9681 
m_sÿn_™
 = 
rdb
->
	`NewI‹¿tÜ
(
»ad_İts
, 
kd
.
	`g‘_cf
());

9683 
m_sÿn_™
 = 
tx
->
	`g‘_™”©Ü
(
kd
.
	`g‘_cf
(), 
sk_bloom
, 
fl_ÿche
,

9684 
m_sÿn_™_low”_bound_¦iû
,

9685 
m_sÿn_™_uµ”_bound_¦iû
);

9687 
m_sÿn_™_sks_bloom
 = 
sk_bloom
;

9689 
	}
}

9691 
ha_rocksdb
::
	$»Ëa£_sÿn_™”©Ü
() {

9692 
d–‘e
 
m_sÿn_™
;

9693 
m_sÿn_™
 = 
nuÎ±r
;

9695 ià(
m_sÿn_™_¢­shÙ
) {

9696 
rdb
->
	`R–—£SÇpshÙ
(
m_sÿn_™_¢­shÙ
);

9697 
m_sÿn_™_¢­shÙ
 = 
nuÎ±r
;

9699 
	}
}

9701 
ha_rocksdb
::
	$£tup_™”©Ü_fÜ_ºd_sÿn
() {

9702 
ušt
 
key_size
;

9704 
key_¡¬t_m©chšg_by‹s
 = 
m_pk_desü
->
	`g‘_fœ¡_key
(
m_pk_·cked_tu¶e
, &
key_size
);

9706 
rocksdb
::
Sliû
 
	`bË_key
((cÚ¡ *)
m_pk_·cked_tu¶e
, 
key_size
);

9708 
	`£tup_sÿn_™”©Ü
(*
m_pk_desü
, &
bË_key
, 
çl£
,

9709 
key_¡¬t_m©chšg_by‹s
);

9710 
m_sÿn_™
->
	`S“k
(
bË_key
);

9711 
m_sk_sÿn_™_Ãxt_ÿÎ
 = 
Œue
;

9712 
	}
}

9719 
ha_rocksdb
::
	$ºd_š™
(
boŞ
 
sÿn
) {

9720 
	`DBUG_ENTER_FUNC
();

9722 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

9723 
	`£tup_»ad_decod”s
();

9725 ià(
sÿn
) {

9726 
m_ºd_sÿn_is_Ãw_¢­shÙ
 = !
tx
->
	`has_¢­shÙ
();

9727 
	`£tup_™”©Ü_fÜ_ºd_sÿn
();

9735 
tx
->
	`acquœe_¢­shÙ
(
m_lock_rows
 =ğ
RDB_LOCK_NONE
);

9737 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

9738 
	}
}

9745 
ha_rocksdb
::
	$ºd_Ãxt
(
uch¬
 *cÚ¡ 
buf
) {

9746 
	`DBUG_ENTER_FUNC
();

9748 
rc
;

9749 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_»ad_ºd_Ãxt_couÁ
);

9751 
rc
 = 
	`ºd_Ãxt_w™h_dœeùiÚ
(
buf
, 
Œue
);

9752 ià(
rc
 !ğ
HA_ERR_LOCK_DEADLOCK
 || !
m_ºd_sÿn_is_Ãw_¢­shÙ
)

9756 
Rdb_Œª§ùiÚ
 *
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

9757 
tx
->
	`»Ëa£_¢­shÙ
();

9758 
	`»Ëa£_sÿn_™”©Ü
();

9759 
	`£tup_™”©Ü_fÜ_ºd_sÿn
();

9762 
m_ºd_sÿn_is_Ãw_¢­shÙ
 = 
çl£
;

9764 ià(
rc
 =ğ
HA_ERR_KEY_NOT_FOUND
)

9765 
rc
 = 
HA_ERR_END_OF_FILE
;

9767 
	`DBUG_RETURN
(
rc
);

9768 
	}
}

9773 
ha_rocksdb
::
	$ºd_Ãxt_w™h_dœeùiÚ
(
uch¬
 *cÚ¡ 
buf
, 
boŞ
 
move_fÜw¬d
) {

9774 
	`DBUG_ENTER_FUNC
();

9776 
rc
;

9778 
bË
->
¡©us
 = 
STATUS_NOT_FOUND
;

9779 
¡©s
.
rows_»que¡ed
++;

9781 ià(!
m_sÿn_™
 || !
	`is_v®id
(m_scan_it)) {

9790 
	`DBUG_RETURN
(
HA_ERR_END_OF_FILE
);

9794 ià(
m_sk_sÿn_™_Ãxt_ÿÎ
) {

9795 
m_sk_sÿn_™_Ãxt_ÿÎ
 = 
çl£
;

9797 ià(
move_fÜw¬d
)

9798 
m_sÿn_™
->
	`Next
();

9800 
m_sÿn_™
->
	`P»v
();

9803 ià(!
	`is_v®id
(
m_sÿn_™
)) {

9804 
rc
 = 
HA_ERR_END_OF_FILE
;

9809 cÚ¡ 
rocksdb
::
Sliû
 
key
 = 
m_sÿn_™
->
	`key
();

9810 ià(!
m_pk_desü
->
	`cov”s_key
(
key
)) {

9811 
rc
 = 
HA_ERR_END_OF_FILE
;

9815 ià(
m_lock_rows
 !ğ
RDB_LOCK_NONE
) {

9822 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

9823 
	`DEBUG_SYNC
(
	`ha_thd
(), "rocksdb_concurrent_delete");

9825 ià(
m_pk_desü
->
	`has_‰l
() &&

9826 
	`should_hide_‰l_»c
(*
m_pk_desü
, 
m_sÿn_™
->
	`v®ue
(),

9827 
tx
->
m_¢­shÙ_time¡amp
)) {

9831 cÚ¡ 
rocksdb
::
Stus
 
s
 =

9832 
	`g‘_fÜ_upd©e
(
tx
, 
m_pk_desü
->
	`g‘_cf
(), 
key
, &
m_»Œ›ved_»cÜd
);

9833 ià(
s
.
	`IsNÙFound
() &&

9834 
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
	`ha_thd
()è=ğ
ISO_READ_COMMITTED
) {

9842 ià(!
s
.
	`ok
()) {

9843 
	`DBUG_RETURN
(
tx
->
	`£t_¡©us_”rÜ
(
bË
->
š_u£
, 
s
, *
m_pk_desü
,

9844 
m_tbl_def
, 
m_bË_hªdËr
));

9850 
m_Ï¡_rowkey
.
	`cİy
(
key
.
	`d©a
(), key.
	`size
(), &
my_ch¬£t_bš
);

9851 
rc
 = 
	`cÚv”t_»cÜd_äom_¡Üage_fÜm©
(&
key
, 
buf
);

9854 
rocksdb
::
Sliû
 
v®ue
 = 
m_sÿn_™
->
	`v®ue
();

9856 ià(
m_pk_desü
->
	`has_‰l
() &&

9857 
	`should_hide_‰l_»c
(

9858 *
m_pk_desü
, 
v®ue
,

9859 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
)->
m_¢­shÙ_time¡amp
)) {

9863 
m_Ï¡_rowkey
.
	`cİy
(
key
.
	`d©a
(), key.
	`size
(), &
my_ch¬£t_bš
);

9864 
rc
 = 
	`cÚv”t_»cÜd_äom_¡Üage_fÜm©
(&
key
, &
v®ue
, 
buf
);

9867 
bË
->
¡©us
 = 0;

9871 ià(!
rc
) {

9872 
¡©s
.
rows_»ad
++;

9873 
¡©s
.
rows_šdex_Ãxt
++;

9874 
	`upd©e_row_¡©s
(
ROWS_READ
);

9877 
	`DBUG_RETURN
(
rc
);

9878 
	}
}

9880 
ha_rocksdb
::
	$ºd_’d
() {

9881 
	`DBUG_ENTER_FUNC
();

9883 
	`»Ëa£_sÿn_™”©Ü
();

9885 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

9886 
	}
}

9893 
ha_rocksdb
::
	$šdex_š™
(
ušt
 
idx
, 
boŞ
 
sÜ‹d
) {

9894 
	`DBUG_ENTER_FUNC
();

9896 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

9897 
	`DBUG_ASSERT
(
tx
 !ğ
nuÎ±r
);

9899 
	`£tup_»ad_decod”s
();

9901 ià(!
m_key»ad_Úly
) {

9902 
m_key_desü_¬r
[
idx
]->
	`g‘_lookup_b™m­
(
bË
, &
m_lookup_b™m­
);

9908 
tx
->
	`acquœe_¢­shÙ
(
m_lock_rows
 =ğ
RDB_LOCK_NONE
);

9910 
aùive_šdex
 = 
idx
;

9912 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

9913 
	}
}

9919 
ha_rocksdb
::
	$šdex_’d
() {

9920 
	`DBUG_ENTER_FUNC
();

9922 
	`»Ëa£_sÿn_™”©Ü
();

9924 
	`b™m­_ä“
(&
m_lookup_b™m­
);

9926 
aùive_šdex
 = 
MAX_KEY
;

9927 
š_¿nge_check_pushed_down
 = 
FALSE
;

9929 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

9930 
	}
}

9937 
ha_rocksdb
::
	$Œunÿ‹
() {

9938 
	`DBUG_ENTER_FUNC
();

9940 
	`DBUG_ASSERT
(
m_tbl_def
 !ğ
nuÎ±r
);

9942 
m_tbl_def
->
m_auto_šü_v®
 = 1;

9943 
m_tbl_def
->
m_hidd’_pk_v®
 = 1;

9945 
	`DBUG_RETURN
(
	`»move_rows
(
m_tbl_def
));

9946 
	}
}

9960 
ha_rocksdb
::
	$d–‘e_row
(cÚ¡ 
uch¬
 *cÚ¡ 
buf
) {

9961 
	`DBUG_ENTER_FUNC
();

9963 
	`DBUG_ASSERT
(
buf
 !ğ
nuÎ±r
);

9965 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_d–‘e_couÁ
);

9966 
	`£t_Ï¡_rowkey
(
buf
);

9968 
rocksdb
::
Sliû
 
	`key_¦iû
(
m_Ï¡_rowkey
.
	`±r
(), m_Ï¡_rowkey.
	`Ëngth
());

9969 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

9970 
ulÚglÚg
 
by‹s_wr™‹n
 = 0;

9972 cÚ¡ 
ušt
 
šdex
 = 
	`pk_šdex
(
bË
, 
m_tbl_def
);

9973 
rocksdb
::
Stus
 
s
 =

9974 
	`d–‘e_Ü_sšgËd–‘e
(
šdex
, 
tx
, 
m_pk_desü
->
	`g‘_cf
(), 
key_¦iû
);

9975 ià(!
s
.
	`ok
()) {

9976 
	`DBUG_RETURN
(
tx
->
	`£t_¡©us_”rÜ
(
bË
->
š_u£
, 
s
, *
m_pk_desü
, 
m_tbl_def
,

9977 
m_bË_hªdËr
));

9979 
by‹s_wr™‹n
 = 
key_¦iû
.
	`size
();

9982 
lÚglÚg
 
hidd’_pk_id
 = 0;

9983 ià(
m_tbl_def
->
m_key_couÁ
 > 1 && 
	`has_hidd’_pk
(
bË
)) {

9984 
”r
 = 
	`»ad_hidd’_pk_id_äom_rowkey
(&
hidd’_pk_id
);

9985 ià(
”r
) {

9986 
	`DBUG_RETURN
(
”r
);

9991 
ušt
 
i
 = 0; i < 
m_tbl_def
->
m_key_couÁ
; i++) {

9992 ià(!
	`is_pk
(
i
, 
bË
, 
m_tbl_def
)) {

9993 
·cked_size
;

9994 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
i
];

9995 
·cked_size
 = 
kd
.
	`·ck_»cÜd
(
bË
, 
m_·ck_bufãr
, 
buf
, 
m_sk_·cked_tu¶e
,

9996 
nuÎ±r
, 
çl£
, 
hidd’_pk_id
);

9997 
rocksdb
::
Sliû
 
	`£cÚd¬y_key_¦iû
(

9998 
»š‹½»t_ÿ¡
<cÚ¡ *>(
m_sk_·cked_tu¶e
), 
·cked_size
);

10000 
tx
->
	`g‘_šdexed_wr™e_b©ch
()->
	`SšgËD–‘e
(
kd
.
	`g‘_cf
(),

10001 
£cÚd¬y_key_¦iû
);

10002 
by‹s_wr™‹n
 +ğ
£cÚd¬y_key_¦iû
.
	`size
();

10006 
tx
->
	`šü_d–‘e_couÁ
();

10008 ià(
	`do_bulk_comm™
(
tx
)) {

10009 
	`DBUG_RETURN
(
HA_ERR_ROCKSDB_BULK_LOAD
);

10011 
¡©s
.
rows_d–‘ed
++;

10012 
	`upd©e_row_¡©s
(
ROWS_DELETED
);

10013 
tx
->
	`upd©e_by‹s_wr™‹n
(
by‹s_wr™‹n
);

10015 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

10016 
	}
}

10018 
rocksdb
::
Stus
 
ha_rocksdb
::
	$d–‘e_Ü_sšgËd–‘e
(

10019 
ušt
 
šdex
, 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
,

10020 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

10021 cÚ¡ 
rocksdb
::
Sliû
 &
key
) {

10022 ià(
	`ÿn_u£_sšgË_d–‘e
(
šdex
))

10023  
tx
->
	`sšgË_d–‘e
(
cŞumn_çmy
, 
key
);

10024  
tx
->
	`d–‘e_key
(
cŞumn_çmy
, 
key
);

10025 
	}
}

10027 
ha_rocksdb
::
	$upd©e_¡©s
() {

10028 
	`DBUG_ENTER_FUNC
();

10030 
¡©s
.
»cÜds
 = 0;

10031 
¡©s
.
šdex_fe_Ëngth
 = 0ul;

10032 
¡©s
.
d©a_fe_Ëngth
 = 0ul;

10033 
¡©s
.
m—n_»c_Ëngth
 = 0;

10035 
ušt
 
i
 = 0; i < 
m_tbl_def
->
m_key_couÁ
; i++) {

10036 ià(
	`is_pk
(
i
, 
bË
, 
m_tbl_def
)) {

10037 
¡©s
.
d©a_fe_Ëngth
 = 
m_pk_desü
->
m_¡©s
.
m_aùu®_disk_size
;

10038 
¡©s
.
»cÜds
 = 
m_pk_desü
->
m_¡©s
.
m_rows
;

10040 
¡©s
.
šdex_fe_Ëngth
 +ğ
m_key_desü_¬r
[
i
]->
m_¡©s
.
m_aùu®_disk_size
;

10044 
DBUG_VOID_RETURN
;

10045 
	}
}

10052 
ha_rocksdb
::
	$šfo
(
ušt
 
æag
) {

10053 
	`DBUG_ENTER_FUNC
();

10055 ià(!
bË
)

10056 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

10058 ià(
æag
 & 
HA_STATUS_VARIABLE
) {

10062 
	`DBUG_EXECUTE_IF
("myrocks_simulate_negative_stats",

10063 
m_pk_desü
->
m_¡©s
.
m_aùu®_disk_size
 =

10064 -
m_pk_desü
->
m_¡©s
.
m_aùu®_disk_size
;);

10066 
	`upd©e_¡©s
();

10072 ià(
¡©ic_ÿ¡
<
lÚglÚg
>(
¡©s
.
d©a_fe_Ëngth
) < 0 ||

10073 
¡©ic_ÿ¡
<
lÚglÚg
>(
¡©s
.
šdex_fe_Ëngth
) < 0 ||

10074 
¡©ic_ÿ¡
<
lÚglÚg
>(
¡©s
.
»cÜds
) < 0) {

10075 ià(
	`ª®yze
(
nuÎ±r
,‚ullptr)) {

10076 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

10079 
	`upd©e_¡©s
();

10084 ià(
¡©s
.
»cÜds
 == 0 ||

10085 (
rocksdb_fÜû_compu‹_membË_¡©s
 &&

10086 
rocksdb_debug_İtimiz”_n_rows
 == 0))

10089 
uch¬
 
buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2];

10090 autØ
r
 = 
	`g‘_¿nge
(
	`pk_šdex
(
bË
, 
m_tbl_def
), 
buf
);

10091 
ušt64_t
 
sz
 = 0;

10093 
ušt8_t
 
šşude_æags
 = 
rocksdb
::
DB
::
INCLUDE_FILES
;

10095 ià(
¡©s
.
»cÜds
 == 0) {

10096 
rdb
->
	`G‘Aµroxim©eSizes
(
m_pk_desü
->
	`g‘_cf
(), &
r
, 1, &
sz
,

10097 
šşude_æags
);

10098 
¡©s
.
»cÜds
+ğ
sz
/
ROCKSDB_ASSUMED_KEY_VALUE_DISK_SIZE
;

10099 
¡©s
.
d©a_fe_Ëngth
+ğ
sz
;

10104 
ušt64_t
 
ÿch‘ime
 = 
rocksdb_fÜû_compu‹_membË_¡©s_ÿch‘ime
;

10105 
ušt64_t
 
time
 = (
ÿch‘ime
 =ğ0è? 0 : 
	`my_miüo_time
();

10106 ià(
ÿch‘ime
 == 0 ||

10107 
time
 > 
m_bË_hªdËr
->
m_mtÿche_Ï¡_upd©e
 + 
ÿch‘ime
) {

10108 
ušt64_t
 
membËCouÁ
;

10109 
ušt64_t
 
membËSize
;

10115 
rdb
->
	`G‘Aµroxim©eMemTabËSts
(
m_pk_desü
->
	`g‘_cf
(), 
r
,

10116 &
membËCouÁ
, &
membËSize
);

10119 ià(
ÿch‘ime
 > 0) {

10120 ià(
m_bË_hªdËr
->
m_mtÿche_lock
.
	`ãtch_add
(

10121 1, 
¡d
::
memÜy_Üd”_acquœe
) == 0) {

10122 
m_bË_hªdËr
->
m_mtÿche_couÁ
 = 
membËCouÁ
;

10123 
m_bË_hªdËr
->
m_mtÿche_size
 = 
membËSize
;

10124 
m_bË_hªdËr
->
m_mtÿche_Ï¡_upd©e
 = 
time
;

10126 
m_bË_hªdËr
->
m_mtÿche_lock
.
	`ãtch_sub
(1,

10127 
¡d
::
memÜy_Üd”_»Ëa£
);

10130 
¡©s
.
»cÜds
 +ğ
membËCouÁ
;

10131 
¡©s
.
d©a_fe_Ëngth
 +ğ
membËSize
;

10134 
¡©s
.
»cÜds
 +ğ
m_bË_hªdËr
->
m_mtÿche_couÁ
;

10135 
¡©s
.
d©a_fe_Ëngth
 +ğ
m_bË_hªdËr
->
m_mtÿche_size
;

10138 ià(
rocksdb_debug_İtimiz”_n_rows
 > 0)

10139 
¡©s
.
»cÜds
 = 
rocksdb_debug_İtimiz”_n_rows
;

10142 ià(
¡©s
.
»cÜds
 != 0)

10143 
¡©s
.
m—n_»c_Ëngth
 = sts.
d©a_fe_Ëngth
 / sts.
»cÜds
;

10145 ià(
æag
 & 
HA_STATUS_CONST
) {

10146 
»f_Ëngth
 = 
m_pk_desü
->
	`max_¡Üage_fmt_Ëngth
();

10148 
ušt
 
i
 = 0; i < 
m_tbl_def
->
m_key_couÁ
; i++) {

10149 ià(
	`is_hidd’_pk
(
i
, 
bË
, 
m_tbl_def
)) {

10152 
KEY
 *cÚ¡ 
k
 = &
bË
->
key_šfo
[
i
];

10153 
ušt
 
j
 = 0; j < 
k
->
aùu®_key_·¹s
; j++) {

10154 cÚ¡ 
Rdb_šdex_¡©s
 &
k_¡©s
 = 
m_key_desü_¬r
[
i
]->
m_¡©s
;

10155 
ušt
 
x
;

10157 ià(
k_¡©s
.
m_di¡šù_keys_³r_´efix
.
	`size
(è> 
j
 &&

10158 
k_¡©s
.
m_di¡šù_keys_³r_´efix
[
j
] > 0) {

10159 
x
 = 
k_¡©s
.
m_rows
 / k_¡©s.
m_di¡šù_keys_³r_´efix
[
j
];

10164 ià(
x
 == 0) {

10165 
x
 = 1;

10168 
x
 = 0;

10170 ià(
x
 > 
¡©s
.
»cÜds
)

10171 
x
 = 
¡©s
.
»cÜds
;

10172 ià((
x
 =ğ0 && 
rocksdb_debug_İtimiz”_no_z”o_ÿrdš®™y
) ||

10173 
rocksdb_debug_İtimiz”_n_rows
 > 0) {

10179 
x
 = 1 << (
k
->
aùu®_key_·¹s
 - 
j
 - 1);

10181 
k
->
»c_³r_key
[
j
] = 
x
;

10186 ià(
æag
 & 
HA_STATUS_ERRKEY
) {

10191 
”rkey
 = 
m_duµ_”rkey
;

10192 
dup_»f
 = 
m_pk_tu¶e
;

10195 ià(
æag
 & 
HA_STATUS_AUTO
) {

10196 
¡©s
.
auto_šüem’t_v®ue
 = 
m_tbl_def
->
m_auto_šü_v®
;

10199 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

10200 
	}
}

10202 
ha_rocksdb
::
	$pos™iÚ
(cÚ¡ 
uch¬
 *cÚ¡ 
»cÜd
) {

10203 
	`DBUG_ENTER_FUNC
();

10205 
lÚglÚg
 
hidd’_pk_id
 = 0;

10206 ià(
	`has_hidd’_pk
(
bË
è&& 
	`»ad_hidd’_pk_id_äom_rowkey
(&
hidd’_pk_id
))

10207 
	`DBUG_ASSERT
(
çl£
);

10222 cÚ¡ 
ušt
 
·cked_size
 = 
m_pk_desü
->
	`·ck_»cÜd
(

10223 
bË
, 
m_·ck_bufãr
, 
»cÜd
, 
»f
, 
nuÎ±r
, 
çl£
, 
hidd’_pk_id
);

10229 ià(
»f_Ëngth
 > 
·cked_size
)

10230 
	`mem£t
(
»f
 + 
·cked_size
, 0, 
»f_Ëngth
 -…acked_size);

10232 
DBUG_VOID_RETURN
;

10233 
	}
}

10240 
ha_rocksdb
::
	$ºd_pos
(
uch¬
 *cÚ¡ 
buf
, uch¬ *cÚ¡ 
pos
) {

10241 
	`DBUG_ENTER_FUNC
();

10243 
rc
;

10244 
size_t
 
Ën
;

10246 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_»ad_ºd_couÁ
);

10247 
¡©s
.
rows_»que¡ed
++;

10248 
Ën
 = 
m_pk_desü
->
	`key_Ëngth
(
bË
,

10249 
rocksdb
::
	`Sliû
((cÚ¡ *)
pos
, 
»f_Ëngth
));

10250 ià(
Ën
 =ğ
	`size_t
(-1)) {

10251 
	`DBUG_RETURN
(
HA_ERR_ROCKSDB_CORRUPT_DATA
);

10254 
rc
 = 
	`g‘_row_by_rowid
(
buf
, 
pos
, 
Ën
);

10256 ià(!
rc
) {

10257 
¡©s
.
rows_»ad
++;

10258 
	`upd©e_row_¡©s
(
ROWS_READ
);

10261 
	`DBUG_RETURN
(
rc
);

10262 
	}
}

10275 
ha_rocksdb
::
	$ÿlc_upd©ed_šdexes
() {

10276 ià(!
m_upd©e_scİe_is_v®id
) {

10277 
m_upd©e_scİe_is_v®id
 = 
Œue
;

10278 
m_upd©e_scİe
.
	`ş—r_®l
();

10280 
ušt
 
keyÄ
 = 0; keyÄ < 
bË
->
s
->
keys
; keynr++) {

10281 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
keyÄ
];

10283 cÚ¡ 
ušt
 
key_·¹s
 = 
kd
.
	`g‘_key_·¹s
();

10284 
ušt
 
kp
 = 0; k°< 
key_·¹s
; kp++) {

10285 ià(
	`has_hidd’_pk
(
bË
è&& 
kp
 + 1 =ğ
key_·¹s
)

10288 
F›ld
 *cÚ¡ 
f›ld
 = 
kd
.
	`g‘_bË_f›ld_fÜ_·¹_no
(
bË
, 
kp
);

10289 ià(
	`b™m­_is_£t
(
bË
->
wr™e_£t
, 
f›ld
->
f›ld_šdex
)) {

10290 
m_upd©e_scİe
.
	`£t_b™
(
keyÄ
);

10296 
	}
}

10303 
ha_rocksdb
::
	$upd©e_row
(cÚ¡ 
uch¬
 *cÚ¡ 
Şd_d©a
, uch¬ *cÚ¡ 
Ãw_d©a
) {

10304 
	`DBUG_ENTER_FUNC
();

10306 
	`DBUG_ASSERT
(
Şd_d©a
 !ğ
nuÎ±r
);

10307 
	`DBUG_ASSERT
(
Ãw_d©a
 !ğ
nuÎ±r
);

10308 
	`DBUG_ASSERT
(
m_lock_rows
 =ğ
RDB_LOCK_WRITE
);

10314 
	`DBUG_ASSERT
(
Ãw_d©a
 =ğ
bË
->
»cÜd
[0]);

10316 
	`ha_¡©i¡ic_šüem’t
(&
SSV
::
ha_upd©e_couÁ
);

10317 cÚ¡ 
rv
 = 
	`upd©e_wr™e_row
(
Şd_d©a
, 
Ãw_d©a
, 
çl£
);

10319 ià(
rv
 == 0) {

10320 
¡©s
.
rows_upd©ed
++;

10321 
	`upd©e_row_¡©s
(
ROWS_UPDATED
);

10324 
	`DBUG_RETURN
(
rv
);

10325 
	}
}

10328 
THR_LOCK_DATA
 **
ha_rocksdb
::
	$¡Üe_lock
(
THD
 *cÚ¡ 
thd
, 
THR_LOCK_DATA
 **
to
,

10329 
thr_lock_ty³
 
lock_ty³
) {

10330 
	`DBUG_ENTER_FUNC
();

10332 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

10333 
	`DBUG_ASSERT
(
to
 !ğ
nuÎ±r
);

10335 
boŞ
 
š_lock_bËs
 = 
my_cÜe
::
	`thd_š_lock_bËs
(
thd
);

10338 ià(
lock_ty³
 >ğ
TL_WRITE_ALLOW_WRITE
) {

10339 
m_lock_rows
 = 
RDB_LOCK_WRITE
;

10340 } ià(
lock_ty³
 =ğ
TL_READ_WITH_SHARED_LOCKS
) {

10341 
m_lock_rows
 = 
RDB_LOCK_READ
;

10343 
m_lock_rows
 = 
RDB_LOCK_NONE
;

10344 ià(
	`THDVAR
(
thd
, 
lock_sÿÂed_rows
)) {

10351 cÚ¡ 
ušt
 
sql_commªd
 = 
my_cÜe
::
	`thd_sql_commªd
(
thd
);

10352 ià((
lock_ty³
 =ğ
TL_READ
 && 
š_lock_bËs
) ||

10353 (
lock_ty³
 =ğ
TL_READ_HIGH_PRIORITY
 && 
š_lock_bËs
) ||

10354 
	`ÿn_hŞd_»ad_locks_Ú_£Ëù
(
thd
, 
lock_ty³
)) {

10355 
ulÚg
 
tx_isŞ©iÚ
 = 
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
thd
);

10356 ià(
sql_commªd
 !ğ
SQLCOM_CHECKSUM
 &&

10357 ((
my_cÜe
::
	`thd_‹¡_İtiÚs
(
thd
, 
OPTION_BIN_LOG
) &&

10358 
tx_isŞ©iÚ
 > 
ISO_READ_COMMITTED
) ||

10359 
tx_isŞ©iÚ
 =ğ
ISO_SERIALIZABLE
 ||

10360 (
lock_ty³
 !ğ
TL_READ
 &&†ock_ty³ !ğ
TL_READ_NO_INSERT
) ||

10361 (
sql_commªd
 !ğ
SQLCOM_INSERT_SELECT
 &&

10362 
sql_commªd
 !ğ
SQLCOM_REPLACE_SELECT
 &&

10363 
sql_commªd
 !ğ
SQLCOM_UPDATE
 && sql_commªd !ğ
SQLCOM_DELETE
 &&

10364 
sql_commªd
 !ğ
SQLCOM_CREATE_TABLE
))) {

10365 
m_lock_rows
 = 
RDB_LOCK_READ
;

10372 ià(
lock_ty³
 !ğ
TL_IGNORE
 && 
m_db_lock
.
ty³
 =ğ
TL_UNLOCK
) {

10380 ià((
lock_ty³
 >ğ
TL_WRITE_CONCURRENT_INSERT
 &&†ock_ty³ <ğ
TL_WRITE
) &&

10381 !
š_lock_bËs
 && !
my_cÜe
::
	`thd_bË¥aû_İ
(
thd
)) {

10382 
lock_ty³
 = 
TL_WRITE_ALLOW_WRITE
;

10393 ià(
lock_ty³
 =ğ
TL_READ_NO_INSERT
 && !
š_lock_bËs
) {

10394 
lock_ty³
 = 
TL_READ
;

10397 
m_db_lock
.
ty³
 = 
lock_ty³
;

10400 *
to
++ = &
m_db_lock
;

10402 
	`DBUG_RETURN
(
to
);

10403 
	}
}

10405 
ha_rocksdb
::
	$»ad_thd_v¬s
(
THD
 *cÚ¡ 
thd
) {

10406 
m_¡Üe_row_debug_checksums
 = 
	`THDVAR
(
thd
, 
¡Üe_row_debug_checksums
);

10407 
m_v”ify_row_debug_checksums
 = 
	`THDVAR
(
thd
, 
v”ify_row_debug_checksums
);

10408 
m_checksums_pù
 = 
	`THDVAR
(
thd
, 
checksums_pù
);

10409 
	}
}

10416 
ha_rocksdb
::
	$ex‹º®_lock
(
THD
 *cÚ¡ 
thd
, 
lock_ty³
) {

10417 
	`DBUG_ENTER_FUNC
();

10419 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

10421 
»s
 = 
HA_EXIT_SUCCESS
;

10422 
bšlog_fÜm©
 = 
my_cÜe
::
	`thd_bšlog_fÜm©
(
thd
);

10423 
boŞ
 
un§ã_fÜ_bšlog
 = 
	`THDVAR
(
	`ha_thd
(), unsafe_for_binlog);

10424 ià(
lock_ty³
 =ğ
F_WRLCK
 && !
thd
->
¾i_¦ave
 && !
un§ã_fÜ_bšlog
 &&

10425 
bšlog_fÜm©
 !ğ
BINLOG_FORMAT_ROW
 &&

10426 
bšlog_fÜm©
 !ğ
BINLOG_FORMAT_UNSPEC
 &&

10427 
my_cÜe
::
	`thd_bšlog_f‹r_ok
(
thd
)) {

10428 
	`my_”rÜ
(
ER_REQUIRE_ROW_BINLOG_FORMAT
, 
	`MYF
(0));

10429 
	`DBUG_RETURN
(
HA_ERR_UNSUPPORTED
);

10432 ià(
lock_ty³
 =ğ
F_UNLCK
) {

10433 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_tx_äom_thd
(
thd
);

10435 ià(
tx
) {

10436 
tx
->
	`io_³rf_’d_ªd_»cÜd
(&
m_io_³rf
);

10437 
tx
->
m_n_mysql_bËs_š_u£
--;

10438 ià(
tx
->
m_n_mysql_bËs_š_u£
 == 0 &&

10439 !
my_cÜe
::
	`thd_‹¡_İtiÚs
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)) {

10448 ià(
tx
->
	`comm™_Ü_rŞlback
()) {

10449 
»s
 = 
HA_ERR_INTERNAL_ERROR
;

10454 ià(
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
thd
è< 
ISO_READ_COMMITTED
 ||

10455 
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
thd
è> 
ISO_REPEATABLE_READ
) {

10456 
	`my_”rÜ
(
ER_ISOLATION_MODE_NOT_SUPPORTED
, 
	`MYF
(0),

10457 
tx_isŞ©iÚ_Çmes
[
my_cÜe
::
	`thd_tx_isŞ©iÚ
(
thd
)]);

10458 
	`DBUG_RETURN
(
HA_ERR_UNSUPPORTED
);

10465 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
thd
);

10466 
	`»ad_thd_v¬s
(
thd
);

10468 
m_upd©e_scİe_is_v®id
 = 
çl£
;

10470 ià(
	`sk_unique_check
()) {

10471 ià((
thd
->
Ëx
->
sql_commªd
 =ğ
SQLCOM_INSERT
 ||

10472 
thd
->
Ëx
->
sql_commªd
 =ğ
SQLCOM_LOAD
 ||

10473 
thd
->
Ëx
->
sql_commªd
 =ğ
SQLCOM_REPLACE
) &&

10474 (
thd
->
Ëx
->
du¶iÿ‹s
 =ğ
DUP_REPLACE
 ||

10475 
thd
->
Ëx
->
du¶iÿ‹s
 =ğ
DUP_UPDATE
)) {

10476 
	`my_”rÜ
(
ER_ON_DUPLICATE_DISABLED
, 
	`MYF
(0), 
thd
->
	`qu”y
());

10477 
	`DBUG_RETURN
(
HA_ERR_UNSUPPORTED
);

10481 ià(
lock_ty³
 =ğ
F_WRLCK
) {

10482 ià(
tx
->
	`is_tx_»ad_Úly
()) {

10483 
	`my_”rÜ
(
ER_UPDATES_WITH_CONSISTENT_SNAPSHOT
, 
	`MYF
(0));

10484 
	`DBUG_RETURN
(
HA_ERR_UNSUPPORTED
);

10487 ià(
thd
->
	`g‘_ex¶ic™_¢­shÙ
()) {

10488 
	`my_”rÜ
(
ER_UPDATES_WITH_EXPLICIT_SNAPSHOT
, 
	`MYF
(0));

10489 
	`DBUG_RETURN
(
HA_ERR_UNSUPPORTED
);

10499 
m_lock_rows
 = 
RDB_LOCK_WRITE
;

10501 ià(
thd
->
Ëx
->
sql_commªd
 =ğ
SQLCOM_CREATE_INDEX
 ||

10502 
thd
->
Ëx
->
sql_commªd
 =ğ
SQLCOM_DROP_INDEX
 ||

10503 
thd
->
Ëx
->
sql_commªd
 =ğ
SQLCOM_ALTER_TABLE
) {

10504 
tx
->
m_ddl_Œª§ùiÚ
 = 
Œue
;

10507 
tx
->
m_n_mysql_bËs_š_u£
++;

10508 
	`rocksdb_»gi¡”_tx
(
rocksdb_htÚ
, 
thd
, 
tx
);

10509 
tx
->
	`io_³rf_¡¬t
(&
m_io_³rf
);

10512 
	`DBUG_RETURN
(
»s
);

10513 
	}
}

10528 
ha_rocksdb
::
	$¡¬t_¡mt
(
THD
 *cÚ¡ 
thd
, 
thr_lock_ty³
 
lock_ty³
) {

10529 
	`DBUG_ENTER_FUNC
();

10531 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

10533 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
thd
);

10534 
	`»ad_thd_v¬s
(
thd
);

10535 
	`rocksdb_»gi¡”_tx
(
ht
, 
thd
, 
tx
);

10536 
tx
->
	`io_³rf_¡¬t
(&
m_io_³rf
);

10538 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

10539 
	}
}

10541 
rocksdb
::
Rªge
 
	$g‘_¿nge
(
ušt32_t
 
i
,

10542 
uch¬
 
buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2],

10543 
off£t1
, 
off£t2
) {

10544 
uch¬
 *
buf_begš
 = 
buf
;

10545 
uch¬
 *
buf_’d
 = 
buf
 + 
Rdb_key_def
::
INDEX_NUMBER_SIZE
;

10546 
	`rdb_Ãtbuf_¡Üe_šdex
(
buf_begš
, 
i
 + 
off£t1
);

10547 
	`rdb_Ãtbuf_¡Üe_šdex
(
buf_’d
, 
i
 + 
off£t2
);

10549  
rocksdb
::
	`Rªge
(

10550 
rocksdb
::
	`Sliû
((cÚ¡ *)
buf_begš
, 
Rdb_key_def
::
INDEX_NUMBER_SIZE
),

10551 
rocksdb
::
	`Sliû
((cÚ¡ *)
buf_’d
, 
Rdb_key_def
::
INDEX_NUMBER_SIZE
));

10552 
	}
}

10554 
rocksdb
::
Rªge
 
	$g‘_¿nge
(cÚ¡ 
Rdb_key_def
 &
kd
,

10555 
uch¬
 
buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2],

10556 
off£t1
, 
off£t2
) {

10557  
	`g‘_¿nge
(
kd
.
	`g‘_šdex_numb”
(), 
buf
, 
off£t1
, 
off£t2
);

10558 
	}
}

10560 
rocksdb
::
Rªge
 
	$g‘_¿nge
(cÚ¡ 
Rdb_key_def
 &
kd
,

10561 
uch¬
 
buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2]) {

10562 ià(
kd
.
m_is_»v”£_cf
) {

10563  
myrocks
::
	`g‘_¿nge
(
kd
, 
buf
, 1, 0);

10565  
myrocks
::
	`g‘_¿nge
(
kd
, 
buf
, 0, 1);

10567 
	}
}

10569 
rocksdb
::
Rªge


10570 
ha_rocksdb
::
	$g‘_¿nge
(cÚ¡ &
i
,

10571 
uch¬
 
buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2]) const {

10572  
myrocks
::
	`g‘_¿nge
(*
m_key_desü_¬r
[
i
], 
buf
);

10573 
	}
}

10582 
boŞ
 
	$is_myrocks_šdex_em±y
(

10583 
rocksdb
::
CŞumnFamyHªdË
 *
cfh
, cÚ¡ 
boŞ
 
is_»v”£_cf
,

10584 cÚ¡ 
rocksdb
::
R—dO±iÚs
 &
»ad_İts
,

10585 cÚ¡ 
ušt
 
šdex_id
)

10587 
boŞ
 
šdex_»moved
 = 
çl£
;

10588 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
] = {0};

10589 
	`rdb_Ãtbuf_¡Üe_ušt32
(
key_buf
, 
šdex_id
);

10590 cÚ¡ 
rocksdb
::
Sliû
 
key
 =

10591 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
key_buf
), (key_buf));

10592 
¡d
::
unique_±r
<
rocksdb
::
I‹¿tÜ
> 
	`™
(
rdb
->
	`NewI‹¿tÜ
(
»ad_İts
, 
cfh
));

10593 
	`rocksdb_sm¬t_£ek
(
is_»v”£_cf
, 
™
.
	`g‘
(), 
key
);

10594 ià(!
™
->
	`V®id
()) {

10595 
šdex_»moved
 = 
Œue
;

10597 ià(
	`memcmp
(
™
->
	`key
().
	`d©a
(), 
key_buf
,

10598 
Rdb_key_def
::
INDEX_NUMBER_SIZE
)) {

10600 
šdex_»moved
 = 
Œue
;

10603  
šdex_»moved
;

10604 
	}
}

10610 
Rdb_drİ_šdex_th»ad
::
	$run
() {

10611 
	`RDB_MUTEX_LOCK_CHECK
(
m_sigÇl_mu‹x
);

10619 ià(
m_¡İ
) {

10623 
time¥ec
 
ts
;

10624 
	`şock_g‘time
(
CLOCK_REALTIME
, &
ts
);

10625 
ts
.
tv_£c
 +ğ
diù_mªag”
.
	`is_drİ_šdex_em±y
()

10629 cÚ¡‡utØ
»t
 
	`MY_ATTRIBUTE
((
__unu£d__
)) =

10630 
	`mysql_cÚd_timedwa™
(&
m_sigÇl_cÚd
, &
m_sigÇl_mu‹x
, &
ts
);

10631 ià(
m_¡İ
) {

10635 
	`DBUG_ASSERT
(
»t
 =ğ0 ||„‘ =ğ
ETIMEDOUT
);

10636 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_sigÇl_mu‹x
);

10638 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
šdiûs
;

10639 
diù_mªag”
.
	`g‘_Úgošg_drİ_šdexes
(&
šdiûs
);

10640 ià(!
šdiûs
.
	`em±y
()) {

10641 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
fšished
;

10642 
rocksdb
::
R—dO±iÚs
 
»ad_İts
;

10643 
»ad_İts
.
tÙ®_Üd”_£ek
 = 
Œue
;

10645 cÚ¡‡utØ
d
 : 
šdiûs
) {

10646 
ušt32
 
cf_æags
 = 0;

10647 ià(!
diù_mªag”
.
	`g‘_cf_æags
(
d
.
cf_id
, &
cf_æags
)) {

10648 
	`sql_´št_”rÜ
("RocksDB: Failedo get column family flags "

10651 
d
.
cf_id
);

10652 
	`abÜt
();

10654 
rocksdb
::
CŞumnFamyHªdË
 *
cfh
 = 
cf_mªag”
.
	`g‘_cf
(
d
.
cf_id
);

10655 
	`DBUG_ASSERT
(
cfh
);

10656 cÚ¡ 
boŞ
 
is_»v”£_cf
 = 
cf_æags
 & 
Rdb_key_def
::
REVERSE_CF_FLAG
;

10658 ià(
	`is_myrocks_šdex_em±y
(
cfh
, 
is_»v”£_cf
, 
»ad_İts
, 
d
.
šdex_id
))

10660 
fšished
.
	`š£¹
(
d
);

10663 
uch¬
 
buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2];

10664 
rocksdb
::
Rªge
 
¿nge
 = 
	`g‘_¿nge
(
d
.
šdex_id
, 
buf
, 
is_»v”£_cf
 ? 1 : 0,

10665 
is_»v”£_cf
 ? 0 : 1);

10666 
rocksdb
::
Stus
 
¡©us
 = 
	`D–‘eFesInRªge
(
rdb
->
	`G‘Ba£DB
(), 
cfh
,

10667 &
¿nge
.
¡¬t
, &¿nge.
lim™
);

10668 ià(!
¡©us
.
	`ok
()) {

10669 ià(
¡©us
.
	`IsShutdownInProg»ss
()) {

10672 
	`rdb_hªdË_io_”rÜ
(
¡©us
, 
RDB_IO_ERROR_BG_THREAD
);

10674 
¡©us
 = 
rdb
->
	`Com·ùRªge
(
	`g‘Com·ùRªgeO±iÚs
(), 
cfh
, &
¿nge
.
¡¬t
,

10675 &
¿nge
.
lim™
);

10676 ià(!
¡©us
.
	`ok
()) {

10677 ià(
¡©us
.
	`IsShutdownInProg»ss
()) {

10680 
	`rdb_hªdË_io_”rÜ
(
¡©us
, 
RDB_IO_ERROR_BG_THREAD
);

10682 ià(
	`is_myrocks_šdex_em±y
(
cfh
, 
is_»v”£_cf
, 
»ad_İts
, 
d
.
šdex_id
))

10684 
fšished
.
	`š£¹
(
d
);

10688 ià(!
fšished
.
	`em±y
()) {

10689 
diù_mªag”
.
	`fšish_drİ_šdexes
(
fšished
);

10692 
	`RDB_MUTEX_LOCK_CHECK
(
m_sigÇl_mu‹x
);

10695 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_sigÇl_mu‹x
);

10696 
	}
}

10698 
Rdb_tbl_def
 *
ha_rocksdb
::
	$g‘_bË_if_exi¡s
(cÚ¡ *cÚ¡ 
bËÇme
) {

10699 
	`DBUG_ASSERT
(
bËÇme
 !ğ
nuÎ±r
);

10701 
¡d
::
¡ršg
 
¡r
;

10702 ià(
	`rdb_nÜm®ize_bËÇme
(
bËÇme
, &
¡r
è!ğ
HA_EXIT_SUCCESS
) {

10704 
	`DBUG_ASSERT
(0);

10705  
nuÎ±r
;

10708  
ddl_mªag”
.
	`fšd
(
¡r
);

10709 
	}
}

10722 
ha_rocksdb
::
	$d–‘e_bË
(cÚ¡ *cÚ¡ 
bËÇme
) {

10723 
	`DBUG_ENTER_FUNC
();

10725 
	`DBUG_ASSERT
(
bËÇme
 !ğ
nuÎ±r
);

10727 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
diù_mªag”
.
	`begš
();

10728 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
	`g‘
();

10731 
Rdb_tbl_def
 *cÚ¡ 
tbl
 = 
	`g‘_bË_if_exi¡s
(
bËÇme
);

10732 ià(!
tbl
)

10733 
	`DBUG_RETURN
(
HA_ERR_NO_SUCH_TABLE
);

10734 
diù_mªag”
.
	`add_drİ_bË
(
tbl
->
m_key_desü_¬r
,bl->
m_key_couÁ
, 
b©ch
);

10740 
ddl_mªag”
.
	`»move
(
tbl
, 
b©ch
, 
Œue
);

10742 
”r
 = 
diù_mªag”
.
	`comm™
(
b©ch
);

10743 ià(
”r
) {

10744 
	`DBUG_RETURN
(
”r
);

10747 
rdb_drİ_idx_th»ad
.
	`sigÇl
();

10749 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

10750 
	}
}

10752 
ha_rocksdb
::
	$»move_rows
(
Rdb_tbl_def
 *cÚ¡ 
tbl
) {

10753 cÚ¡ 
rocksdb
::
Wr™eO±iÚs
 
wo
 =

10754 
	`rdb_g‘_rocksdb_wr™e_İtiÚs
(
hªdËr
::
	`ha_thd
());

10756 
rocksdb
::
R—dO±iÚs
 
İts
;

10757 
İts
.
tÙ®_Üd”_£ek
 = 
Œue
;

10758 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
 = 
	`g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

10760 
key_buf
[
MAX_KEY_LENGTH
];

10761 
ušt
 
key_Ën
;

10762 
ulÚglÚg
 
by‹s_wr™‹n
 = 0;

10764 
uch¬
 
low”_bound_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

10765 
uch¬
 
uµ”_bound_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

10766 
rocksdb
::
Sliû
 
low”_bound_¦iû
;

10767 
rocksdb
::
Sliû
 
uµ”_bound_¦iû
;

10774 
ušt
 
i
 = 0; i < 
tbl
->
m_key_couÁ
; i++) {

10775 cÚ¡ 
Rdb_key_def
 &
kd
 = *
tbl
->
m_key_desü_¬r
[
i
];

10776 
kd
.
	`g‘_šfimum_key
(
»š‹½»t_ÿ¡
<
uch¬
 *>(
key_buf
), &
key_Ën
);

10777 
rocksdb
::
CŞumnFamyHªdË
 *
cf
 = 
kd
.
	`g‘_cf
();

10778 cÚ¡ 
rocksdb
::
Sliû
 
	`bË_key
(
key_buf
, 
key_Ën
);

10779 
	`£tup_™”©Ü_bounds
(
kd
, 
bË_key
, 
Rdb_key_def
::
INDEX_NUMBER_SIZE
,

10780 
low”_bound_buf
, 
uµ”_bound_buf
, &
low”_bound_¦iû
,

10781 &
uµ”_bound_¦iû
);

10782 
	`DBUG_ASSERT
(
key_Ën
 =ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

10783 
İts
.
™”©e_low”_bound
 = &
low”_bound_¦iû
;

10784 
İts
.
™”©e_uµ”_bound
 = &
uµ”_bound_¦iû
;

10785 
¡d
::
unique_±r
<
rocksdb
::
I‹¿tÜ
> 
	`™
(
rdb
->
	`NewI‹¿tÜ
(
İts
, 
cf
));

10787 
™
->
	`S“k
(
bË_key
);

10788 
™
->
	`V®id
()) {

10789 cÚ¡ 
rocksdb
::
Sliû
 
key
 = 
™
->
	`key
();

10790 ià(!
kd
.
	`cov”s_key
(
key
)) {

10794 
rocksdb
::
Stus
 
s
;

10795 ià(
	`ÿn_u£_sšgË_d–‘e
(
i
)) {

10796 
s
 = 
rdb
->
	`SšgËD–‘e
(
wo
, 
cf
, 
key
);

10798 
s
 = 
rdb
->
	`D–‘e
(
wo
, 
cf
, 
key
);

10801 ià(!
s
.
	`ok
()) {

10802  
tx
->
	`£t_¡©us_”rÜ
(
bË
->
š_u£
, 
s
, *
m_pk_desü
, 
m_tbl_def
,

10803 
m_bË_hªdËr
);

10805 
by‹s_wr™‹n
 +ğ
key
.
	`size
();

10806 
™
->
	`Next
();

10810 
tx
->
	`upd©e_by‹s_wr™‹n
(
by‹s_wr™‹n
);

10812  
HA_EXIT_SUCCESS
;

10813 
	}
}

10820 
ha_rocksdb
::
	$»Çme_bË
(cÚ¡ *cÚ¡ 
äom
, cÚ¡ *cÚ¡ 
to
) {

10821 
	`DBUG_ENTER_FUNC
();

10823 
	`DBUG_ASSERT
(
äom
 !ğ
nuÎ±r
);

10824 
	`DBUG_ASSERT
(
to
 !ğ
nuÎ±r
);

10826 
¡d
::
¡ršg
 
äom_¡r
;

10827 
¡d
::
¡ršg
 
to_¡r
;

10828 
¡d
::
¡ršg
 
äom_db
;

10829 
¡d
::
¡ršg
 
to_db
;

10831 
rc
 = 
	`rdb_nÜm®ize_bËÇme
(
äom
, &
äom_¡r
);

10832 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

10833 
	`DBUG_RETURN
(
rc
);

10836 
rc
 = 
	`rdb_¥l™_nÜm®ized_bËÇme
(
äom_¡r
, &
äom_db
);

10837 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

10838 
	`DBUG_RETURN
(
rc
);

10841 
rc
 = 
	`rdb_nÜm®ize_bËÇme
(
to
, &
to_¡r
);

10842 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

10843 
	`DBUG_RETURN
(
rc
);

10846 
rc
 = 
	`rdb_¥l™_nÜm®ized_bËÇme
(
to_¡r
, &
to_db
);

10847 ià(
rc
 !ğ
HA_EXIT_SUCCESS
) {

10848 
	`DBUG_RETURN
(
rc
);

10853 ià(
äom_db
 !ğ
to_db
 && !
	`rdb_d©aba£_exi¡s
(to_db)) {

10857 
	`DBUG_RETURN
(-1);

10860 
	`DBUG_EXECUTE_IF
("g’_sql_bË_Çme", 
to_¡r
 =o_str + "#sql-test";);

10862 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
diù_mªag”
.
	`begš
();

10863 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
	`g‘
();

10864 
diù_mªag”
.
	`lock
();

10866 ià(
ddl_mªag”
.
	`»Çme
(
äom_¡r
, 
to_¡r
, 
b©ch
)) {

10867 
rc
 = 
HA_ERR_NO_SUCH_TABLE
;

10869 
rc
 = 
diù_mªag”
.
	`comm™
(
b©ch
);

10871 
diù_mªag”
.
	`uÆock
();

10873 
	`DBUG_RETURN
(
rc
);

10874 
	}
}

10887 
boŞ
 
ha_rocksdb
::
	$check_if_šcom·tibË_d©a
(
HA_CREATE_INFO
 *cÚ¡ 
šfo
,

10888 
ušt
 
bË_chªges
) {

10889 
	`DBUG_ENTER_FUNC
();

10891 
	`DBUG_ASSERT
(
šfo
 !ğ
nuÎ±r
);

10894 
	`DBUG_RETURN
(
COMPATIBLE_DATA_NO
);

10895 
	}
}

10901 
ha_rocksdb
::
	$exŒa
(
ha_exŒa_funùiÚ
 
İ”©iÚ
) {

10902 
	`DBUG_ENTER_FUNC
();

10904 
İ”©iÚ
) {

10905 
HA_EXTRA_KEYREAD
:

10906 
m_key»ad_Úly
 = 
Œue
;

10908 
HA_EXTRA_NO_KEYREAD
:

10909 
m_key»ad_Úly
 = 
çl£
;

10911 
HA_EXTRA_FLUSH
:

10916 
m_»Œ›ved_»cÜd
.
	`Re£t
();

10922 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

10923 
	}
}

10929 
ha_rows
 
ha_rocksdb
::
	$»cÜds_š_¿nge
(
ušt
 
šx
, 
key_¿nge
 *cÚ¡ 
mš_key
,

10930 
key_¿nge
 *cÚ¡ 
max_key
) {

10931 
	`DBUG_ENTER_FUNC
();

10933 
ha_rows
 
»t
 = 
	`THDVAR
(
	`ha_thd
(), 
»cÜds_š_¿nge
);

10934 ià(
»t
) {

10935 
	`DBUG_RETURN
(
»t
);

10937 ià(
bË
->
fÜû_šdex
) {

10938 cÚ¡ 
ha_rows
 
fÜû_rows
 = 
	`THDVAR
(
	`ha_thd
(), 
fÜû_šdex_»cÜds_š_¿nge
);

10939 ià(
fÜû_rows
) {

10940 
	`DBUG_RETURN
(
fÜû_rows
);

10944 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
šx
];

10946 
ušt
 
size1
 = 0;

10947 ià(
mš_key
) {

10948 
size1
 = 
kd
.
	`·ck_šdex_tu¶e
(
bË
, 
m_·ck_bufãr
, 
m_sk_·cked_tu¶e
,

10949 
mš_key
->
key
, mš_key->
key·¹_m­
);

10950 ià(
mš_key
->
æag
 =ğ
HA_READ_PREFIX_LAST_OR_PREV
 ||

10951 
mš_key
->
æag
 =ğ
HA_READ_PREFIX_LAST
 ||

10952 
mš_key
->
æag
 =ğ
HA_READ_AFTER_KEY
) {

10953 
kd
.
	`sucûssÜ
(
m_sk_·cked_tu¶e
, 
size1
);

10956 
kd
.
	`g‘_šfimum_key
(
m_sk_·cked_tu¶e
, &
size1
);

10959 
ušt
 
size2
 = 0;

10960 ià(
max_key
) {

10961 
size2
 = 
kd
.
	`·ck_šdex_tu¶e
(
bË
, 
m_·ck_bufãr
, 
m_sk_·cked_tu¶e_Şd
,

10962 
max_key
->
key
, max_key->
key·¹_m­
);

10963 ià(
max_key
->
æag
 =ğ
HA_READ_PREFIX_LAST_OR_PREV
 ||

10964 
max_key
->
æag
 =ğ
HA_READ_PREFIX_LAST
 ||

10965 
max_key
->
æag
 =ğ
HA_READ_AFTER_KEY
) {

10966 
kd
.
	`sucûssÜ
(
m_sk_·cked_tu¶e_Şd
, 
size2
);

10969 ià(
size1
 > 
size2
) {

10970 
	`mem£t
(
m_sk_·cked_tu¶e_Şd
 + 
size2
, 0xff, 
size1
 - size2);

10971 
size2
 = 
size1
;

10974 
kd
.
	`g‘_su´emum_key
(
m_sk_·cked_tu¶e_Şd
, &
size2
);

10977 cÚ¡ 
rocksdb
::
Sliû
 
	`¦iû1
((cÚ¡ *)
m_sk_·cked_tu¶e
, 
size1
);

10978 cÚ¡ 
rocksdb
::
Sliû
 
	`¦iû2
((cÚ¡ *)
m_sk_·cked_tu¶e_Şd
, 
size2
);

10981 ià(
¦iû1
.
	`com·»
(
¦iû2
) >= 0) {

10982 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

10985 
rocksdb
::
Rªge
 
	`r
(
kd
.
m_is_»v”£_cf
 ? 
¦iû2
 : 
¦iû1
,

10986 
kd
.
m_is_»v”£_cf
 ? 
¦iû1
 : 
¦iû2
);

10988 
ušt64_t
 
sz
 = 0;

10989 autØ
disk_size
 = 
kd
.
m_¡©s
.
m_aùu®_disk_size
;

10990 ià(
disk_size
 == 0)

10991 
disk_size
 = 
kd
.
m_¡©s
.
m_d©a_size
;

10992 autØ
rows
 = 
kd
.
m_¡©s
.
m_rows
;

10993 ià(
rows
 =ğ0 || 
disk_size
 == 0) {

10994 
rows
 = 1;

10995 
disk_size
 = 
ROCKSDB_ASSUMED_KEY_VALUE_DISK_SIZE
;

10998 #´agm¨
GCC
 
dŸgno¡ic
 
push


10999 #´agm¨
GCC
 
dŸgno¡ic
 
ignÜed
 "-Wdeprecated-declarations"

11001 
ušt8_t
 
šşude_æags
 = 
rocksdb
::
DB
::
INCLUDE_FILES
;

11002 
rdb
->
	`G‘Aµroxim©eSizes
(
kd
.
	`g‘_cf
(), &
r
, 1, &
sz
, 
šşude_æags
);

11003 
»t
 = 
rows
 * 
sz
 / 
disk_size
;

11004 
ušt64_t
 
memTabËCouÁ
;

11005 
rdb
->
	`G‘Aµroxim©eMemTabËSts
(
kd
.
	`g‘_cf
(), 
r
, &
memTabËCouÁ
, &
sz
);

11006 
»t
 +ğ
memTabËCouÁ
;

11015 ià(
»t
 >ğ
¡©s
.
»cÜds
) {

11016 
»t
 = 
¡©s
.
»cÜds
 * 0.99;

11019 ià(
rocksdb_debug_İtimiz”_n_rows
 > 0) {

11020 
»t
 = 
rocksdb_debug_İtimiz”_n_rows
;

11021 } ià(
»t
 == 0) {

11022 
»t
 = 1;

11025 
	`DBUG_RETURN
(
»t
);

11026 
	}
}

11028 
ha_rocksdb
::
	$upd©e_ü—‹_šfo
(
HA_CREATE_INFO
 *cÚ¡ 
ü—‹_šfo
) {

11029 
	`DBUG_ENTER_FUNC
();

11031 
	`DBUG_ASSERT
(
ü—‹_šfo
 !ğ
nuÎ±r
);

11033 ià(!(
ü—‹_šfo
->
u£d_f›lds
 & 
HA_CREATE_USED_AUTO
)) {

11034 
ü—‹_šfo
->
auto_šüem’t_v®ue
 = 
m_tbl_def
->
m_auto_šü_v®
;

11037 
DBUG_VOID_RETURN
;

11038 
	}
}

11058 
ha_rocksdb
::
	$İtimize
(
THD
 *cÚ¡ 
thd
, 
HA_CHECK_OPT
 *cÚ¡ 
check_İt
) {

11059 
	`DBUG_ENTER_FUNC
();

11061 
	`DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

11062 
	`DBUG_ASSERT
(
check_İt
 !ğ
nuÎ±r
);

11064 
ušt
 
i
 = 0; i < 
bË
->
s
->
keys
; i++) {

11065 
uch¬
 
buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2];

11066 autØ
¿nge
 = 
	`g‘_¿nge
(
i
, 
buf
);

11067 cÚ¡ 
rocksdb
::
Stus
 
s
 = 
rdb
->
	`Com·ùRªge
(
	`g‘Com·ùRªgeO±iÚs
(),

11068 
m_key_desü_¬r
[
i
]->
	`g‘_cf
(),

11069 &
¿nge
.
¡¬t
, &¿nge.
lim™
);

11070 ià(!
s
.
	`ok
()) {

11071 
	`DBUG_RETURN
(
	`rdb_”rÜ_to_mysql
(
s
));

11075 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

11076 
	}
}

11078 
ÿlcuÏ‹_¡©s
(

11079 cÚ¡ 
¡d
::
unÜd”ed_m­
<
GL_INDEX_ID
, std::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
>>

11080 &
to_»ÿlc
,

11081 
boŞ
 
šşude_membËs
) {

11082 
DBUG_ENTER_FUNC
();

11085 
¡d
::
unÜd”ed_m­
<
rocksdb
::
CŞumnFamyHªdË
 *, std::
veùÜ
<rocksdb::
Rªge
>>

11086 
¿nges
;

11087 
¡d
::
unÜd”ed_m­
<
GL_INDEX_ID
, 
Rdb_šdex_¡©s
> 
¡©s
;

11088 
¡d
::
veùÜ
<
uch¬
> 
buf
(
to_»ÿlc
.
size
(è* 2 * 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

11090 
uch¬
 *
buå
 = 
buf
.
d©a
();

11091 cÚ¡‡utØ&
™
 : 
to_»ÿlc
) {

11092 cÚ¡ 
GL_INDEX_ID
 
šdex_id
 = 
™
.
fœ¡
;

11093 autØ&
kd
 = 
™
.
£cÚd
;

11094 
¿nges
[
kd
->
g‘_cf
()].
push_back
(
myrocks
::
g‘_¿nge
(*kd, 
buå
));

11095 
buå
 +ğ2 * 
Rdb_key_def
::
INDEX_NUMBER_SIZE
;

11097 
¡©s
[
šdex_id
] = 
Rdb_šdex_¡©s
(index_id);

11098 
DBUG_ASSERT
(
kd
->
g‘_key_·¹s
() > 0);

11099 
¡©s
[
šdex_id
].
m_di¡šù_keys_³r_´efix
.
»size
(
kd
->
g‘_key_·¹s
());

11103 
rocksdb
::
TabËPrİ”t›sCŞËùiÚ
 
´İs
;

11104 autØ
™
 : 
¿nges
) {

11105 cÚ¡‡utØ
Şd_size
 
MY_ATTRIBUTE
((
__unu£d__
)èğ
´İs
.
size
();

11106 cÚ¡‡utØ
¡©us
 = 
rdb
->
G‘Prİ”t›sOfTabËsInRªge
(

11107 
™
.
fœ¡
, &™.
£cÚd
[0], it.£cÚd.
size
(), &
´İs
);

11108 
DBUG_ASSERT
(
´İs
.
size
(è>ğ
Şd_size
);

11109 ià(!
¡©us
.
ok
()) {

11110 
DBUG_RETURN
(
ha_rocksdb
::
rdb_”rÜ_to_mysql
(

11111 
¡©us
, "Could‚ot‡ccess RocksDB…roperties"));

11115 
num_s¡
 = 0;

11116 cÚ¡‡utØ&
™
 : 
´İs
) {

11117 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> 
s¡_¡©s
;

11118 
Rdb_tbl_´İ_cŞl
::
»ad_¡©s_äom_tbl_´İs
(
™
.
£cÚd
, &
s¡_¡©s
);

11123 cÚ¡‡utØ&
™1
 : 
s¡_¡©s
) {

11132 ià(
¡©s
.
fšd
(
™1
.
m_gl_šdex_id
è=ğ¡©s.
’d
()) {

11136 autØ
™_šdex
 = 
to_»ÿlc
.
fšd
(
™1
.
m_gl_šdex_id
);

11137 
DBUG_ASSERT
(
™_šdex
 !ğ
to_»ÿlc
.
’d
());

11138 ià(
™_šdex
 =ğ
to_»ÿlc
.
’d
()) {

11141 
¡©s
[
™1
.
m_gl_šdex_id
].
m”ge
(

11142 
™1
, 
Œue
, 
™_šdex
->
£cÚd
->
max_¡Üage_fmt_Ëngth
());

11144 
num_s¡
++;

11147 ià(
šşude_membËs
) {

11149 
Rdb_tbl_ÿrd_cŞl
 
ÿrdš®™y_cŞËùÜ
(
rocksdb_bË_¡©s_§m¶šg_pù
);

11150 autØ
»ad_İts
 = 
rocksdb
::
R—dO±iÚs
();

11151 
»ad_İts
.
»ad_t›r
 = 
rocksdb
::
R—dT›r
::
kMembËT›r
;

11152 cÚ¡‡utØ&
™_kd
 : 
to_»ÿlc
) {

11153 cÚ¡ 
¡d
::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
> &
kd
 = 
™_kd
.
£cÚd
;

11154 
Rdb_šdex_¡©s
 &
¡©
 = 
¡©s
[
kd
->
g‘_gl_šdex_id
()];

11156 
uch¬
 
r_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2];

11157 autØ
r
 = 
myrocks
::
g‘_¿nge
(*
kd
, 
r_buf
);

11158 
ušt64_t
 
membËCouÁ
;

11159 
ušt64_t
 
membËSize
;

11160 
rdb
->
G‘Aµroxim©eMemTabËSts
(
kd
->
g‘_cf
(), 
r
, &
membËCouÁ
,

11161 &
membËSize
);

11162 ià(
membËCouÁ
 < (
ušt64_t
)
¡©
.
m_rows
 / 10) {

11169 
¡d
::
unique_±r
<
rocksdb
::
I‹¿tÜ
> 
™
 =

11170 
¡d
::
unique_±r
<
rocksdb
::
I‹¿tÜ
>(

11171 
rdb
->
NewI‹¿tÜ
(
»ad_İts
, 
kd
->
g‘_cf
()));

11173 
rocksdb
::
Sliû
 
fœ¡_šdex_key
((cÚ¡ *)
r_buf
,

11174 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

11176 
ÿrdš®™y_cŞËùÜ
.
Re£t
();

11177 
™
->
S“k
(
fœ¡_šdex_key
); 
is_v®id
(™.
g‘
()); it->
Next
()) {

11178 cÚ¡ 
rocksdb
::
Sliû
 
key
 = 
™
->key();

11179 ià(!
kd
->
cov”s_key
(
key
)) {

11182 
¡©
.
m_rows
++;

11184 
ÿrdš®™y_cŞËùÜ
.
ProûssKey
(
key
, 
kd
.
g‘
(), &
¡©
);

11186 
ÿrdš®™y_cŞËùÜ
.
Adju¡Sts
(&
¡©
);

11191 
ddl_mªag”
.
£t_¡©s
(
¡©s
);

11192 
ddl_mªag”
.
³rsi¡_¡©s
(
Œue
);

11194 
DBUG_RETURN
(
HA_EXIT_SUCCESS
);

11202 
ha_rocksdb
::
	$ª®yze
(
THD
 *cÚ¡ 
thd
, 
HA_CHECK_OPT
 *cÚ¡ 
check_İt
) {

11203 
	`DBUG_ENTER_FUNC
();

11205 ià(
bË
) {

11206 
¡d
::
unÜd”ed_m­
<
GL_INDEX_ID
, std::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
>>

11207 
ids_to_check
;

11208 
ušt
 
i
 = 0; i < 
bË
->
s
->
keys
; i++) {

11209 
ids_to_check
.
	`š£¹
(
¡d
::
	`make_·œ
(
m_key_desü_¬r
[
i
]->
	`g‘_gl_šdex_id
(),

11210 
m_key_desü_¬r
[
i
]));

11213 
»s
 = 
	`ÿlcuÏ‹_¡©s
(
ids_to_check
, 
Œue
);

11214 ià(
»s
 !ğ
HA_EXIT_SUCCESS
) {

11215 
	`DBUG_RETURN
(
HA_ADMIN_FAILED
);

11219 
	`DBUG_RETURN
(
HA_ADMIN_OK
);

11220 
	}
}

11222 
ha_rocksdb
::
	$g‘_auto_šüem’t
(
ulÚglÚg
 
off
, ulÚglÚg 
šc
,

11223 
ulÚglÚg
 
nb_desœed_v®ues
,

11224 
ulÚglÚg
 *cÚ¡ 
fœ¡_v®ue
,

11225 
ulÚglÚg
 *cÚ¡ 
nb_»£rved_v®ues
) {

11241 
	`DEBUG_SYNC
(
	`ha_thd
(), "rocksdb.autoinc_vars");

11243 ià(
off
 > 
šc
) {

11244 
off
 = 1;

11247 
F›ld
 *
f›ld
;

11248 
ulÚglÚg
 
Ãw_v®
, 
max_v®
;

11249 
f›ld
 = 
bË
->
key_šfo
[bË->
s
->
Ãxt_numb”_šdex
].
key_·¹
[0].field;

11250 
max_v®
 = 
	`rdb_g‘_št_cŞ_max_v®ue
(
f›ld
);

11253 autØ&
auto_šü
 = 
m_tbl_def
->
m_auto_šü_v®
;

11255 ià(
šc
 == 1) {

11256 
	`DBUG_ASSERT
(
off
 == 1);

11271 
Ãw_v®
 = 
auto_šü
;

11272 
Ãw_v®
 !ğ
¡d
::
num”ic_lim™s
<
ulÚglÚg
>::
	`max
()) {

11273 ià(
auto_šü
.
	`com·»_exchªge_w—k
(
Ãw_v®
,

11274 
¡d
::
	`mš
(
Ãw_v®
 + 1, 
max_v®
))) {

11280 
ulÚglÚg
 
Ï¡_v®
 = 
auto_šü
;

11284 
	`DBUG_ASSERT
(
Ï¡_v®
 > 0);

11307 
ulÚglÚg
 
n
 =

11308 (
Ï¡_v®
 - 1è/ 
šc
 + (Öa¡_v® - 1è% inø+ inø- 
off
) / inc;

11312 ià(
n
 > (
¡d
::
num”ic_lim™s
<
ulÚglÚg
>::
	`max
(è- 
off
è/ 
šc
) {

11313 
	`DBUG_ASSERT
(
max_v®
 =ğ
¡d
::
num”ic_lim™s
<
ulÚglÚg
>::
	`max
());

11333 
Ãw_v®
 = 
¡d
::
num”ic_lim™s
<
ulÚglÚg
>::
	`max
();

11334 
auto_šü
 = 
Ãw_v®
;

11338 
Ãw_v®
 = 
n
 * 
šc
 + 
off
;

11347 } !
auto_šü
.
	`com·»_exchªge_w—k
(
Ï¡_v®
,

11348 
¡d
::
	`mš
(
Ãw_v®
 + 1, 
max_v®
)));

11351 *
fœ¡_v®ue
 = 
Ãw_v®
;

11352 *
nb_»£rved_v®ues
 = 1;

11353 
	}
}

11355 #iâdeà
DBUG_OFF


11358 
dbug_™em_´št_buf
[512];

11360 cÚ¡ *
	$dbug_´št_™em
(
I‹m
 *cÚ¡ 
™em
) {

11361 *cÚ¡ 
buf
 = 
dbug_™em_´št_buf
;

11362 
SŒšg
 
	`¡r
(
buf
, (
dbug_™em_´št_buf
), &
my_ch¬£t_bš
);

11363 
¡r
.
	`Ëngth
(0);

11364 ià(!
™em
)

11366 
™em
->
	`´št
(&
¡r
, 
QT_ORDINARY
);

11367 ià(
¡r
.
	`c_±r
(è=ğ
buf
)

11368  
buf
;

11371 
	}
}

11396 
şass
 
I‹m
 *
ha_rocksdb
::
	$idx_cÚd_push
(
ušt
 
keyno
, 
şass
 
I‹m
 *cÚ¡ 
idx_cÚd
) {

11397 
	`DBUG_ENTER_FUNC
();

11399 
	`DBUG_ASSERT
(
keyno
 !ğ
MAX_KEY
);

11400 
	`DBUG_ASSERT
(
idx_cÚd
 !ğ
nuÎ±r
);

11402 
pushed_idx_cÚd
 = 
idx_cÚd
;

11403 
pushed_idx_cÚd_keyno
 = 
keyno
;

11404 
š_¿nge_check_pushed_down
 = 
TRUE
;

11407 
	`DBUG_RETURN
(
nuÎ±r
);

11408 
	}
}

11428 
iı_»suÉ
 
ha_rocksdb
::
	$check_šdex_cÚd
() const {

11429 
	`DBUG_ASSERT
(
pushed_idx_cÚd
);

11430 
	`DBUG_ASSERT
(
pushed_idx_cÚd_keyno
 !ğ
MAX_KEY
);

11432 ià(
’d_¿nge
 && 
	`com·»_key_iı
(end_range) > 0) {

11434  
ICP_OUT_OF_RANGE
;

11437  
pushed_idx_cÚd
->
	`v®_št
(è? 
ICP_MATCH
 : 
ICP_NO_MATCH
;

11438 
	}
}

11444 
my_cÜe
::
’um_®‹r_š¶aû_»suÉ
 
ha_rocksdb
::
	$check_if_suµÜ‹d_š¶aû_®‹r
(

11445 
TABLE
 *
®‹»d_bË
, 
my_cÜe
::
AÉ”_š¶aû_šfo
 *cÚ¡ 
ha_®‹r_šfo
) {

11446 
	`DBUG_ENTER_FUNC
();

11448 
	`DBUG_ASSERT
(
ha_®‹r_šfo
 !ğ
nuÎ±r
);

11450 ià(
ha_®‹r_šfo
->
hªdËr_æags
 &

11451 ~(
my_cÜe
::
AÉ”_š¶aû_šfo
::
DROP_INDEX
 |

11452 
my_cÜe
::
AÉ”_š¶aû_šfo
::
DROP_UNIQUE_INDEX
 |

11453 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_INDEX
 |

11454 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_UNIQUE_INDEX
 |

11455 
my_cÜe
::
AÉ”_š¶aû_šfo
::
CHANGE_CREATE_OPTION
)) {

11456 
	`DBUG_RETURN
(
my_cÜe
::
HA_ALTER_INPLACE_NOT_SUPPORTED
);

11460 ià((
ha_®‹r_šfo
->
hªdËr_æags
 &

11461 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_UNIQUE_INDEX
) &&

11462 
	`has_hidd’_pk
(
®‹»d_bË
)) {

11463 
	`DBUG_RETURN
(
my_cÜe
::
HA_ALTER_INPLACE_NOT_SUPPORTED
);

11467 ià((
ha_®‹r_šfo
->
hªdËr_æags
 &

11468 
my_cÜe
::
AÉ”_š¶aû_šfo
::
CHANGE_CREATE_OPTION
) &&

11469 !(
ha_®‹r_šfo
->
ü—‹_šfo
->
u£d_f›lds
 & 
HA_CREATE_USED_AUTO
)) {

11470 
	`DBUG_RETURN
(
my_cÜe
::
HA_ALTER_INPLACE_NOT_SUPPORTED
);

11473 
	`DBUG_RETURN
(
my_cÜe
::
HA_ALTER_INPLACE_SHARED_LOCK_AFTER_PREPARE
);

11474 
	}
}

11504 
boŞ
 
ha_rocksdb
::
	$´•¬e_š¶aû_®‹r_bË
(

11505 
TABLE
 *cÚ¡ 
®‹»d_bË
,

11506 
my_cÜe
::
AÉ”_š¶aû_šfo
 *cÚ¡ 
ha_®‹r_šfo
) {

11507 
	`DBUG_ENTER_FUNC
();

11509 
	`DBUG_ASSERT
(
®‹»d_bË
 !ğ
nuÎ±r
);

11510 
	`DBUG_ASSERT
(
ha_®‹r_šfo
 !ğ
nuÎ±r
);

11512 
Rdb_tbl_def
 *
Ãw_tdef
 = 
nuÎ±r
;

11513 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *
Şd_key_desü
 = 
nuÎ±r
;

11514 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *
Ãw_key_desü
 = 
nuÎ±r
;

11515 
ušt
 
Şd_n_keys
 = 
m_tbl_def
->
m_key_couÁ
;

11516 
ušt
 
Ãw_n_keys
 = 
®‹»d_bË
->
s
->
keys
;

11517 
¡d
::
unÜd”ed_£t
<¡d::
sh¬ed_±r
<
Rdb_key_def
>> 
added_šdexes
;

11518 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
drİ³d_šdex_ids
;

11519 
ušt
 
n_drİ³d_keys
 = 0;

11520 
ušt
 
n_added_keys
 = 0;

11521 
ulÚglÚg
 
max_auto_šü
 = 0;

11523 ià(
ha_®‹r_šfo
->
hªdËr_æags
 &

11524 (
my_cÜe
::
AÉ”_š¶aû_šfo
::
DROP_INDEX
 |

11525 
my_cÜe
::
AÉ”_š¶aû_šfo
::
DROP_UNIQUE_INDEX
 |

11526 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_INDEX
 |

11527 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_UNIQUE_INDEX
)) {

11529 ià(
	`has_hidd’_pk
(
®‹»d_bË
)) {

11530 
Ãw_n_keys
 += 1;

11533 cÚ¡ 
TABLE
 *cÚ¡ 
Şd_bË
 = 
bË
;

11534 
Şd_key_desü
 = 
m_tbl_def
->
m_key_desü_¬r
;

11535 
Ãw_key_desü
 = 
Ãw
 
¡d
::
sh¬ed_±r
<
Rdb_key_def
>[
Ãw_n_keys
];

11537 
Ãw_tdef
 = 
Ãw
 
	`Rdb_tbl_def
(
m_tbl_def
->
	`fuÎ_bËÇme
());

11538 
Ãw_tdef
->
m_key_desü_¬r
 = 
Ãw_key_desü
;

11539 
Ãw_tdef
->
m_key_couÁ
 = 
Ãw_n_keys
;

11540 
Ãw_tdef
->
m_auto_šü_v®
 =

11541 
m_tbl_def
->
m_auto_šü_v®
.
	`lßd
(
¡d
::
memÜy_Üd”_»Ïxed
);

11542 
Ãw_tdef
->
m_hidd’_pk_v®
 =

11543 
m_tbl_def
->
m_hidd’_pk_v®
.
	`lßd
(
¡d
::
memÜy_Üd”_»Ïxed
);

11545 ià(
	`ü—‹_key_defs
(
®‹»d_bË
, 
Ãw_tdef
, 
bË
, 
m_tbl_def
)) {

11547 
d–‘e
[] 
Ãw_key_desü
;

11553 
Ãw_tdef
->
m_key_desü_¬r
 = 
nuÎ±r
;

11554 
d–‘e
 
Ãw_tdef
;

11556 
	`my_”rÜ
(
ER_KEY_CREATE_DURING_ALTER
, 
	`MYF
(0));

11557 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

11560 
ušt
 
i
;

11561 
ušt
 
j
;

11564 
i
 = 0; i < 
ha_®‹r_šfo
->
šdex_drİ_couÁ
; i++) {

11565 cÚ¡ 
KEY
 *cÚ¡ 
drİ³d_key
 = 
ha_®‹r_šfo
->
šdex_drİ_bufãr
[
i
];

11566 
j
 = 0; j < 
Şd_n_keys
; j++) {

11567 cÚ¡ 
KEY
 *cÚ¡ 
Şd_key
 =

11568 &
Şd_bË
->
key_šfo
[
Şd_key_desü
[
j
]->
	`g‘_keyno
()];

11570 ià(!
	`com·»_keys
(
Şd_key
, 
drİ³d_key
)) {

11571 
drİ³d_šdex_ids
.
	`š£¹
(
Şd_key_desü
[
j
]->
	`g‘_gl_šdex_id
());

11578 
id’tiÿl_šdexes_found
 = 0;

11579 
i
 = 0; i < 
ha_®‹r_šfo
->
šdex_add_couÁ
; i++) {

11580 cÚ¡ 
KEY
 *cÚ¡ 
added_key
 =

11581 &
ha_®‹r_šfo
->
key_šfo_bufãr
[ha_®‹r_šfo->
šdex_add_bufãr
[
i
]];

11582 
j
 = 0; j < 
Ãw_n_keys
; j++) {

11583 cÚ¡ 
KEY
 *cÚ¡ 
Ãw_key
 =

11584 &
®‹»d_bË
->
key_šfo
[
Ãw_key_desü
[
j
]->
	`g‘_keyno
()];

11585 ià(!
	`com·»_keys
(
Ãw_key
, 
added_key
)) {

11597 ià(
drİ³d_šdex_ids
.
	`couÁ
(
Ãw_key_desü
[
j
]->
	`g‘_gl_šdex_id
())) {

11598 
drİ³d_šdex_ids
.
	`”a£
(
Ãw_key_desü
[
j
]->
	`g‘_gl_šdex_id
());

11599 
id’tiÿl_šdexes_found
++;

11601 
added_šdexes
.
	`š£¹
(
Ãw_key_desü
[
j
]);

11609 
n_drİ³d_keys
 = 
ha_®‹r_šfo
->
šdex_drİ_couÁ
 - 
id’tiÿl_šdexes_found
;

11610 
n_added_keys
 = 
ha_®‹r_šfo
->
šdex_add_couÁ
 - 
id’tiÿl_šdexes_found
;

11611 
	`DBUG_ASSERT
(
drİ³d_šdex_ids
.
	`size
(è=ğ
n_drİ³d_keys
);

11612 
	`DBUG_ASSERT
(
added_šdexes
.
	`size
(è=ğ
n_added_keys
);

11613 
	`DBUG_ASSERT
(
Ãw_n_keys
 =ğ(
Şd_n_keys
 - 
n_drİ³d_keys
 + 
n_added_keys
));

11615 ià(
ha_®‹r_šfo
->
hªdËr_æags
 &

11616 
my_cÜe
::
AÉ”_š¶aû_šfo
::
CHANGE_CREATE_OPTION
) {

11617 ià(!
Ãw_tdef
) {

11618 
Ãw_tdef
 = 
m_tbl_def
;

11620 ià(
bË
->
found_Ãxt_numb”_f›ld
) {

11621 
max_auto_šü
 = 
	`lßd_auto_šü_v®ue_äom_šdex
();

11625 
ha_®‹r_šfo
->
hªdËr_ùx
 = 
Ãw
 
	`Rdb_š¶aû_®‹r_ùx
(

11626 
Ãw_tdef
, 
Şd_key_desü
, 
Ãw_key_desü
, 
Şd_n_keys
, 
Ãw_n_keys
,

11627 
added_šdexes
, 
drİ³d_šdex_ids
, 
n_added_keys
, 
n_drİ³d_keys
,

11628 
max_auto_šü
);

11629 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

11630 
	}
}

11652 
boŞ
 
ha_rocksdb
::
	$š¶aû_®‹r_bË
(

11653 
TABLE
 *cÚ¡ 
®‹»d_bË
,

11654 
my_cÜe
::
AÉ”_š¶aû_šfo
 *cÚ¡ 
ha_®‹r_šfo
) {

11655 
	`DBUG_ENTER_FUNC
();

11657 
	`DBUG_ASSERT
(
®‹»d_bË
 !ğ
nuÎ±r
);

11658 
	`DBUG_ASSERT
(
ha_®‹r_šfo
 !ğ
nuÎ±r
);

11659 
	`DBUG_ASSERT
(
ha_®‹r_šfo
->
hªdËr_ùx
 !ğ
nuÎ±r
);

11661 
Rdb_š¶aû_®‹r_ùx
 *cÚ¡ 
ùx
 =

11662 
¡©ic_ÿ¡
<
Rdb_š¶aû_®‹r_ùx
 *>(
ha_®‹r_šfo
->
hªdËr_ùx
);

11664 ià(
ha_®‹r_šfo
->
hªdËr_æags
 &

11665 (
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_INDEX
 |

11666 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_UNIQUE_INDEX
)) {

11671 
	`ä“_key_bufãrs
();

11673 
	`DBUG_ASSERT
(
ùx
 !ğ
nuÎ±r
);

11678 
”r
;

11679 ià((
”r
 = 
	`®loc_key_bufãrs
(

11680 
®‹»d_bË
, 
ùx
->
m_Ãw_tdef
,

11681 
ha_®‹r_šfo
->
hªdËr_æags
 &

11682 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_UNIQUE_INDEX
))) {

11683 
	`my_”rÜ
(
ER_OUT_OF_RESOURCES
, 
	`MYF
(0));

11684 
	`DBUG_RETURN
(
”r
);

11688 ià((
”r
 = 
	`š¶aû_pİuÏ‹_sk
(
®‹»d_bË
, 
ùx
->
m_added_šdexes
))) {

11689 
	`my_”rÜ
(
ER_SK_POPULATE_DURING_ALTER
, 
	`MYF
(0));

11690 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

11694 
	`DBUG_EXECUTE_IF
("myrocks_simulate_index_create_rollback", {

11695 
	`dbug_ü—‹_”r_š¶aû_®‹r
();

11696 
	`DBUG_RETURN
(
HA_EXIT_FAILURE
);

11699 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

11700 
	}
}

11705 
ha_rocksdb
::
š¶aû_pİuÏ‹_sk
(

11706 
TABLE
 *cÚ¡ 
Ãw_bË_¬g
,

11707 cÚ¡ 
¡d
::
unÜd”ed_£t
<¡d::
sh¬ed_±r
<
Rdb_key_def
>> &
šdexes
) {

11708 
DBUG_ENTER_FUNC
();

11709 
»s
 = 
HA_EXIT_SUCCESS
;

11710 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
diù_mªag”
.
begš
();

11711 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
g‘
();

11714 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
ü—‹_šdex_ids
;

11715 cÚ¡‡utØ&
šdex
 : 
šdexes
) {

11716 
ü—‹_šdex_ids
.
š£¹
(
šdex
->
g‘_gl_šdex_id
());

11718 
diù_mªag”
.
add_ü—‹_šdex
(
ü—‹_šdex_ids
, 
b©ch
);

11719 
»s
 = 
diù_mªag”
.
comm™
(
b©ch
);

11720 ià(
»s
 !ğ
HA_EXIT_SUCCESS
) {

11721  
»s
;

11731 
ddl_mªag”
.
add_uncomm™‹d_keydefs
(
šdexes
);

11733 cÚ¡ 
boŞ
 
hidd’_pk_exi¡s
 = 
has_hidd’_pk
(
bË
);

11735 
Rdb_Œª§ùiÚ
 *
tx
 = 
g‘_Ü_ü—‹_tx
(
bË
->
š_u£
);

11765 ià(
m_s¡_šfo
) {

11766 ià((
»s
 = 
fš®ize_bulk_lßd
())) {

11767 
DBUG_RETURN
(
»s
);

11769 
tx
->
comm™
();

11772 cÚ¡ 
ulÚglÚg
 
rdb_m”ge_buf_size
 = 
THDVAR
(
ha_thd
(), 
m”ge_buf_size
);

11773 cÚ¡ 
ulÚglÚg
 
rdb_m”ge_combše_»ad_size
 =

11774 
THDVAR
(
ha_thd
(), 
m”ge_combše_»ad_size
);

11775 cÚ¡ 
ulÚglÚg
 
rdb_m”ge_tmp_fe_»mov®_d–ay
 =

11776 
THDVAR
(
ha_thd
(), 
m”ge_tmp_fe_»mov®_d–ay_ms
);

11778 cÚ¡‡utØ&
šdex
 : 
šdexes
) {

11779 
boŞ
 
is_unique_šdex
 =

11780 
Ãw_bË_¬g
->
key_šfo
[
šdex
->
g‘_keyno
()].
æags
 & 
HA_NOSAME
;

11782 
Rdb_šdex_m”ge
 
rdb_m”ge
(
tx
->
g‘_rocksdb_tmpdœ
(), 
rdb_m”ge_buf_size
,

11783 
rdb_m”ge_combše_»ad_size
,

11784 
rdb_m”ge_tmp_fe_»mov®_d–ay
,

11785 
šdex
->
g‘_cf
());

11787 ià((
»s
 = 
rdb_m”ge
.
š™
())) {

11788 
DBUG_RETURN
(
»s
);

11796 cÚ¡ 
ušt
 
pk
 = 
pk_šdex
(
bË
, 
m_tbl_def
);

11797 
ha_šdex_š™
(
pk
, 
Œue
);

11800 
»s
 = 
šdex_fœ¡
(
bË
->
»cÜd
[0]);„es == 0;

11801 
»s
 = 
šdex_Ãxt
(
bË
->
»cÜd
[0])) {

11802 
lÚglÚg
 
hidd’_pk_id
 = 0;

11803 ià(
hidd’_pk_exi¡s
 &&

11804 (
»s
 = 
»ad_hidd’_pk_id_äom_rowkey
(&
hidd’_pk_id
))) {

11806 
sql_´št_”rÜ
("Error„etrieving hidden…k id.");

11807 
ha_šdex_’d
();

11808 
DBUG_RETURN
(
»s
);

11812 cÚ¡ 
Ãw_·cked_size
 = 
šdex
->
·ck_»cÜd
(

11813 
Ãw_bË_¬g
, 
m_·ck_bufãr
, 
bË
->
»cÜd
[0], 
m_sk_·cked_tu¶e
,

11814 &
m_sk_s
, 
should_¡Üe_row_debug_checksums
(), 
hidd’_pk_id
, 0,

11815 
nuÎ±r
,‚uÎ±r, 
m_‰l_by‹s
);

11817 cÚ¡ 
rocksdb
::
Sliû
 
key
 =„ocksdb::Slice(

11818 
»š‹½»t_ÿ¡
<cÚ¡ *>(
m_sk_·cked_tu¶e
), 
Ãw_·cked_size
);

11819 cÚ¡ 
rocksdb
::
Sliû
 
v®
 =

11820 
rocksdb
::
Sliû
(
»š‹½»t_ÿ¡
<cÚ¡ *>(
m_sk_s
.
±r
()),

11821 
m_sk_s
.
g‘_cu¼’t_pos
());

11827 ià((
»s
 = 
rdb_m”ge
.
add
(
key
, 
v®
))) {

11828 
ha_šdex_’d
();

11829 
DBUG_RETURN
(
»s
);

11833 ià(
»s
 !ğ
HA_ERR_END_OF_FILE
) {

11835 
sql_´št_”rÜ
("Error„etrieving indexƒntry from…rimary key.");

11836 
ha_šdex_’d
();

11837 
DBUG_RETURN
(
»s
);

11840 
ha_šdex_’d
();

11846 
rocksdb
::
Sliû
 
m”ge_key
;

11847 
rocksdb
::
Sliû
 
m”ge_v®
;

11849 
unique_sk_buf_šfo
 
sk_šfo
;

11850 
sk_šfo
.
dup_sk_buf
 = 
m_dup_sk_·cked_tu¶e
;

11851 
sk_šfo
.
dup_sk_buf_Şd
 = 
m_dup_sk_·cked_tu¶e_Şd
;

11853 (
»s
 = 
rdb_m”ge
.
Ãxt
(&
m”ge_key
, &
m”ge_v®
)) == 0) {

11855 ià(
is_unique_šdex
) {

11856 ià(
check_du¶iÿ‹_sk
(
Ãw_bË_¬g
, *
šdex
, &
m”ge_key
, &
sk_šfo
)) {

11863 ià(
šdex
->
uÅack_»cÜd
(
Ãw_bË_¬g
,‚ew_bË_¬g->
»cÜd
[0],

11864 &
m”ge_key
, 
nuÎ±r
,

11865 
m_v”ify_row_debug_checksums
)) {

11867 
DBUG_ASSERT
(0);

11870 
´št_keydup_”rÜ
(
Ãw_bË_¬g
,

11871 &
Ãw_bË_¬g
->
key_šfo
[
šdex
->
g‘_keyno
()],

11872 
MYF
(0), 
ha_thd
());

11873 
DBUG_RETURN
(
ER_DUP_ENTRY
);

11880 ià((
»s
 = 
bulk_lßd_key
(
tx
, *
šdex
, 
m”ge_key
, 
m”ge_v®
, 
çl£
))) {

11889 ià(
»s
 > 0) {

11891 
sql_´št_”rÜ
("Error while bulk†oading keys inƒxternal merge sort.");

11892 
DBUG_RETURN
(
»s
);

11895 ià((
»s
 = 
tx
->
fšish_bulk_lßd
())) {

11897 
sql_´št_”rÜ
("Error finishing bulk†oad.");

11898 
DBUG_RETURN
(
»s
);

11906 
purge_®l_jem®loc_¬’as
();

11908 
DBUG_EXECUTE_IF
("üash_duršg_Úlše_šdex_ü—tiÚ", 
DBUG_SUICIDE
(););

11909 
DBUG_RETURN
(
»s
);

11944 
boŞ
 
ha_rocksdb
::
	$comm™_š¶aû_®‹r_bË
(

11945 
my_cÜe
::
TABLE
 *cÚ¡ 
®‹»d_bË
,

11946 
my_cÜe
::
AÉ”_š¶aû_šfo
 *cÚ¡ 
ha_®‹r_šfo
, 
boŞ
 
comm™
) {

11947 
	`DBUG_ENTER_FUNC
();

11949 
	`DBUG_ASSERT
(
®‹»d_bË
 !ğ
nuÎ±r
);

11950 
	`DBUG_ASSERT
(
ha_®‹r_šfo
 !ğ
nuÎ±r
);

11952 
Rdb_š¶aû_®‹r_ùx
 *cÚ¡ 
ùx0
 =

11953 
¡©ic_ÿ¡
<
Rdb_š¶aû_®‹r_ùx
 *>(
ha_®‹r_šfo
->
hªdËr_ùx
);

11955 
	`DEBUG_SYNC
(
	`ha_thd
(), "rocksdb.commit_in_place_alter_table");

11967 ià(!
comm™
) {

11969 ià(!
ùx0
) {

11970 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

11978 ià(
ùx0
->
m_Ãw_key_desü
) {

11980 
ušt
 
i
 = 0; i < 
ùx0
->
m_Ãw_tdef
->
m_key_couÁ
; i++) {

11981 
ùx0
->
m_Ãw_key_desü
[
i
] = 
nuÎ±r
;

11984 
d–‘e
[] 
ùx0
->
m_Ãw_key_desü
;

11985 
ùx0
->
m_Ãw_key_desü
 = 
nuÎ±r
;

11986 
ùx0
->
m_Ãw_tdef
->
m_key_desü_¬r
 = 
nuÎ±r
;

11988 
d–‘e
 
ùx0
->
m_Ãw_tdef
;

11992 
ddl_mªag”
.
	`»move_uncomm™‹d_keydefs
(
ùx0
->
m_added_šdexes
);

11995 
diù_mªag”
.
	`rŞlback_Úgošg_šdex_ü—tiÚ
();

11997 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

12000 
	`DBUG_ASSERT
(
ùx0
);

12006 
š¶aû_®‹r_hªdËr_ùx
 **
ùx_¬¿y
;

12007 
š¶aû_®‹r_hªdËr_ùx
 *
ùx_sšgË
[2];

12009 ià(
ha_®‹r_šfo
->
group_comm™_ùx
) {

12010 
	`DBUG_EXECUTE_IF
("üash_duršg_šdex_ü—tiÚ_·¹™iÚ", 
	`DBUG_SUICIDE
(););

12011 
ùx_¬¿y
 = 
ha_®‹r_šfo
->
group_comm™_ùx
;

12013 
ùx_sšgË
[0] = 
ùx0
;

12014 
ùx_sšgË
[1] = 
nuÎ±r
;

12015 
ùx_¬¿y
 = 
ùx_sšgË
;

12018 
	`DBUG_ASSERT
(
ùx0
 =ğ
ùx_¬¿y
[0]);

12019 
ha_®‹r_šfo
->
group_comm™_ùx
 = 
nuÎ±r
;

12021 ià(
ha_®‹r_šfo
->
hªdËr_æags
 &

12022 (
my_cÜe
::
AÉ”_š¶aû_šfo
::
DROP_INDEX
 |

12023 
my_cÜe
::
AÉ”_š¶aû_šfo
::
DROP_UNIQUE_INDEX
 |

12024 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_INDEX
 |

12025 
my_cÜe
::
AÉ”_š¶aû_šfo
::
ADD_UNIQUE_INDEX
)) {

12026 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
diù_mªag”
.
	`begš
();

12027 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
	`g‘
();

12028 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
ü—‹_šdex_ids
;

12030 
m_tbl_def
 = 
ùx0
->
m_Ãw_tdef
;

12031 
m_key_desü_¬r
 = 
m_tbl_def
->m_key_descr_arr;

12032 
m_pk_desü
 = 
m_key_desü_¬r
[
	`pk_šdex
(
®‹»d_bË
, 
m_tbl_def
)];

12034 
diù_mªag”
.
	`lock
();

12035 
š¶aû_®‹r_hªdËr_ùx
 **
pùx
 = 
ùx_¬¿y
; *pctx;…ctx++) {

12036 
Rdb_š¶aû_®‹r_ùx
 *cÚ¡ 
ùx
 =

12037 
¡©ic_ÿ¡
<
Rdb_š¶aû_®‹r_ùx
 *>(*
pùx
);

12040 
diù_mªag”
.
	`add_drİ_šdex
(
ùx
->
m_drİ³d_šdex_ids
, 
b©ch
);

12042 cÚ¡‡utØ&
šdex
 : 
ùx
->
m_added_šdexes
) {

12043 
ü—‹_šdex_ids
.
	`š£¹
(
šdex
->
	`g‘_gl_šdex_id
());

12046 ià(
ddl_mªag”
.
	`put_ªd_wr™e
(
ùx
->
m_Ãw_tdef
, 
b©ch
)) {

12051 
	`DBUG_ASSERT
(0);

12058 
ddl_mªag”
.
	`»move_uncomm™‹d_keydefs
(
ùx
->
m_added_šdexes
);

12061 ià(
diù_mªag”
.
	`comm™
(
b©ch
)) {

12065 
	`DBUG_ASSERT
(0);

12068 
diù_mªag”
.
	`uÆock
();

12071 
diù_mªag”
.
	`fšish_šdexes_İ”©iÚ
(

12072 
ü—‹_šdex_ids
, 
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

12074 
rdb_drİ_idx_th»ad
.
	`sigÇl
();

12077 ià(
ha_®‹r_šfo
->
hªdËr_æags
 &

12078 (
my_cÜe
::
AÉ”_š¶aû_šfo
::
CHANGE_CREATE_OPTION
)) {

12079 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
diù_mªag”
.
	`begš
();

12080 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
	`g‘
();

12081 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
ü—‹_šdex_ids
;

12083 
ulÚglÚg
 
auto_šü_v®
 = 
ha_®‹r_šfo
->
ü—‹_šfo
->
auto_šüem’t_v®ue
;

12085 
š¶aû_®‹r_hªdËr_ùx
 **
pùx
 = 
ùx_¬¿y
; *pctx;…ctx++) {

12086 
Rdb_š¶aû_®‹r_ùx
 *cÚ¡ 
ùx
 =

12087 
¡©ic_ÿ¡
<
Rdb_š¶aû_®‹r_ùx
 *>(*
pùx
);

12088 
auto_šü_v®
 = 
¡d
::
	`max
×uto_šü_v®, 
ùx
->
m_max_auto_šü
);

12089 
diù_mªag”
.
	`put_auto_šü_v®
(

12090 
b©ch
, 
ùx
->
m_Ãw_tdef
->
	`g‘_autošü_gl_šdex_id
(), 
auto_šü_v®
,

12091 
Œue
 );

12092 
ùx
->
m_Ãw_tdef
->
m_auto_šü_v®
 = 
auto_šü_v®
;

12095 ià(
diù_mªag”
.
	`comm™
(
b©ch
)) {

12096 
	`DBUG_ASSERT
(0);

12100 
	`DBUG_RETURN
(
HA_EXIT_SUCCESS
);

12101 
	}
}

12103 
	#SHOW_FNAME
(
Çme
è
rocksdb_show_
##
	)
name

12105 
	#DEF_SHOW_FUNC
(
Çme
, 
key
) \

12106 
	$SHOW_FNAME
(
Çme
)(
MYSQL_THD
 
thd
, 
SHOW_VAR
 * 
v¬
, *
buff
) { \

12107 
rocksdb_¡©us_couÁ”s
.
Çme
 = \

12108 
rocksdb_¡©s
->
	`g‘Tick”CouÁ
(
rocksdb
::
key
); \

12109 
v¬
->
ty³
 = 
SHOW_LONGLONG
; \

12110 
v¬
->
v®ue
 = (*)&
rocksdb_¡©us_couÁ”s
.
Çme
; \

12111  
HA_EXIT_SUCCESS
; \

12112 
	}

	)
}

12114 
	#DEF_STATUS_VAR
(
Çme
) \

12115 { "rocksdb_" #Çme, (*)&
	`SHOW_FNAME
(
Çme
), 
SHOW_FUNC
 }

	)

12117 
	#DEF_STATUS_VAR_PTR
(
Çme
, 
±r
, 
İtiÚ
) \

12118 { "rocksdb_" 
Çme
, (*)
±r
, 
İtiÚ
 }

	)

12120 
	#DEF_STATUS_VAR_FUNC
(
Çme
, 
±r
, 
İtiÚ
) \

12121 { 
Çme
, 
»š‹½»t_ÿ¡
<*>(
±r
), 
İtiÚ
 }

	)

12123 
	srocksdb_¡©us_couÁ”s_t
 {

12124 
ušt64_t
 
block_ÿche_miss
;

12125 
ušt64_t
 
block_ÿche_h™
;

12126 
ušt64_t
 
block_ÿche_add
;

12127 
ušt64_t
 
block_ÿche_add_çu»s
;

12128 
ušt64_t
 
block_ÿche_šdex_miss
;

12129 
ušt64_t
 
block_ÿche_šdex_h™
;

12130 
ušt64_t
 
block_ÿche_šdex_add
;

12131 
ušt64_t
 
block_ÿche_šdex_by‹s_š£¹
;

12132 
ušt64_t
 
block_ÿche_šdex_by‹s_eviù
;

12133 
ušt64_t
 
block_ÿche_f‹r_miss
;

12134 
ušt64_t
 
block_ÿche_f‹r_h™
;

12135 
ušt64_t
 
block_ÿche_f‹r_add
;

12136 
ušt64_t
 
block_ÿche_f‹r_by‹s_š£¹
;

12137 
ušt64_t
 
block_ÿche_f‹r_by‹s_eviù
;

12138 
ušt64_t
 
block_ÿche_by‹s_»ad
;

12139 
ušt64_t
 
block_ÿche_by‹s_wr™e
;

12140 
ušt64_t
 
block_ÿche_d©a_by‹s_š£¹
;

12141 
ušt64_t
 
block_ÿche_d©a_miss
;

12142 
ušt64_t
 
block_ÿche_d©a_h™
;

12143 
ušt64_t
 
block_ÿche_d©a_add
;

12144 
ušt64_t
 
bloom_f‹r_u£ful
;

12145 
ušt64_t
 
bloom_f‹r_fuÎ_pos™ive
;

12146 
ušt64_t
 
bloom_f‹r_fuÎ_Œue_pos™ive
;

12147 
ušt64_t
 
membË_h™
;

12148 
ušt64_t
 
membË_miss
;

12149 
ušt64_t
 
g‘_h™_l0
;

12150 
ušt64_t
 
g‘_h™_l1
;

12151 
ušt64_t
 
g‘_h™_l2_ªd_up
;

12152 
ušt64_t
 
com·ùiÚ_key_drİ_Ãw
;

12153 
ušt64_t
 
com·ùiÚ_key_drİ_obsŞ‘e
;

12154 
ušt64_t
 
com·ùiÚ_key_drİ_u£r
;

12155 
ušt64_t
 
numb”_keys_wr™‹n
;

12156 
ušt64_t
 
numb”_keys_»ad
;

12157 
ušt64_t
 
numb”_keys_upd©ed
;

12158 
ušt64_t
 
by‹s_wr™‹n
;

12159 
ušt64_t
 
by‹s_»ad
;

12160 
ušt64_t
 
numb”_db_£ek
;

12161 
ušt64_t
 
numb”_db_£ek_found
;

12162 
ušt64_t
 
numb”_db_Ãxt
;

12163 
ušt64_t
 
numb”_db_Ãxt_found
;

12164 
ušt64_t
 
numb”_db_´ev
;

12165 
ušt64_t
 
numb”_db_´ev_found
;

12166 
ušt64_t
 
™”_by‹s_»ad
;

12167 
ušt64_t
 
no_fe_şo£s
;

12168 
ušt64_t
 
no_fe_İ’s
;

12169 
ušt64_t
 
no_fe_”rÜs
;

12170 
ušt64_t
 
¡®l_miüos
;

12171 
ušt64_t
 
num_™”©Üs
;

12172 
ušt64_t
 
numb”_muÉig‘_g‘
;

12173 
ušt64_t
 
numb”_muÉig‘_keys_»ad
;

12174 
ušt64_t
 
numb”_muÉig‘_by‹s_»ad
;

12175 
ušt64_t
 
numb”_d–‘es_f‹»d
;

12176 
ušt64_t
 
numb”_m”ge_çu»s
;

12177 
ušt64_t
 
bloom_f‹r_´efix_checked
;

12178 
ušt64_t
 
bloom_f‹r_´efix_u£ful
;

12179 
ušt64_t
 
numb”_»£eks_™”©iÚ
;

12180 
ušt64_t
 
g‘upd©essšû_ÿÎs
;

12181 
ušt64_t
 
block_ÿchecom´es£d_miss
;

12182 
ušt64_t
 
block_ÿchecom´es£d_h™
;

12183 
ušt64_t
 
w®_synûd
;

12184 
ušt64_t
 
w®_by‹s
;

12185 
ušt64_t
 
wr™e_£lf
;

12186 
ušt64_t
 
wr™e_Ùh”
;

12187 
ušt64_t
 
wr™e_timedout
;

12188 
ušt64_t
 
wr™e_w®
;

12189 
ušt64_t
 
æush_wr™e_by‹s
;

12190 
ušt64_t
 
com·ù_»ad_by‹s
;

12191 
ušt64_t
 
com·ù_wr™e_by‹s
;

12192 
ušt64_t
 
numb”_su³rv”siÚ_acquœes
;

12193 
ušt64_t
 
numb”_su³rv”siÚ_»Ëa£s
;

12194 
ušt64_t
 
numb”_su³rv”siÚ_ş—nups
;

12195 
ušt64_t
 
numb”_block_nÙ_com´es£d
;

12198 
rocksdb_¡©us_couÁ”s_t
 
rocksdb_¡©us_couÁ”s
;

12200 
	$DEF_SHOW_FUNC
(
block_ÿche_miss
, 
BLOCK_CACHE_MISS
)

12201 
	$DEF_SHOW_FUNC
(
block_ÿche_h™
, 
BLOCK_CACHE_HIT
)

12202 
	$DEF_SHOW_FUNC
(
block_ÿche_add
, 
BLOCK_CACHE_ADD
)

12203 
	$DEF_SHOW_FUNC
(
block_ÿche_add_çu»s
, 
BLOCK_CACHE_ADD_FAILURES
)

12204 
	$DEF_SHOW_FUNC
(
block_ÿche_šdex_miss
, 
BLOCK_CACHE_INDEX_MISS
)

12205 
	$DEF_SHOW_FUNC
(
block_ÿche_šdex_h™
, 
BLOCK_CACHE_INDEX_HIT
)

12206 
	$DEF_SHOW_FUNC
(
block_ÿche_šdex_add
, 
BLOCK_CACHE_INDEX_ADD
)

12207 
	$DEF_SHOW_FUNC
(
block_ÿche_šdex_by‹s_š£¹
, 
BLOCK_CACHE_INDEX_BYTES_INSERT
)

12208 
	$DEF_SHOW_FUNC
(
block_ÿche_šdex_by‹s_eviù
, 
BLOCK_CACHE_INDEX_BYTES_EVICT
)

12209 
	$DEF_SHOW_FUNC
(
block_ÿche_f‹r_miss
, 
BLOCK_CACHE_FILTER_MISS
)

12210 
	$DEF_SHOW_FUNC
(
block_ÿche_f‹r_h™
, 
BLOCK_CACHE_FILTER_HIT
)

12211 
	$DEF_SHOW_FUNC
(
block_ÿche_f‹r_add
, 
BLOCK_CACHE_FILTER_ADD
)

12212 
	$DEF_SHOW_FUNC
(
block_ÿche_f‹r_by‹s_š£¹
, 
BLOCK_CACHE_FILTER_BYTES_INSERT
)

12213 
	$DEF_SHOW_FUNC
(
block_ÿche_f‹r_by‹s_eviù
, 
BLOCK_CACHE_FILTER_BYTES_EVICT
)

12214 
	$DEF_SHOW_FUNC
(
block_ÿche_by‹s_»ad
, 
BLOCK_CACHE_BYTES_READ
)

12215 
	$DEF_SHOW_FUNC
(
block_ÿche_by‹s_wr™e
, 
BLOCK_CACHE_BYTES_WRITE
)

12216 
	$DEF_SHOW_FUNC
(
block_ÿche_d©a_by‹s_š£¹
, 
BLOCK_CACHE_DATA_BYTES_INSERT
)

12217 
	$DEF_SHOW_FUNC
(
block_ÿche_d©a_miss
, 
BLOCK_CACHE_DATA_MISS
)

12218 
	$DEF_SHOW_FUNC
(
block_ÿche_d©a_h™
, 
BLOCK_CACHE_DATA_HIT
)

12219 
	$DEF_SHOW_FUNC
(
block_ÿche_d©a_add
, 
BLOCK_CACHE_DATA_ADD
)

12220 
	$DEF_SHOW_FUNC
(
bloom_f‹r_u£ful
, 
BLOOM_FILTER_USEFUL
)

12221 
	$DEF_SHOW_FUNC
(
bloom_f‹r_fuÎ_pos™ive
, 
BLOOM_FILTER_FULL_POSITIVE
)

12222 
	$DEF_SHOW_FUNC
(
bloom_f‹r_fuÎ_Œue_pos™ive
, 
BLOOM_FILTER_FULL_TRUE_POSITIVE
)

12223 
	$DEF_SHOW_FUNC
(
membË_h™
, 
MEMTABLE_HIT
)

12224 
	$DEF_SHOW_FUNC
(
membË_miss
, 
MEMTABLE_MISS
)

12225 
	$DEF_SHOW_FUNC
(
g‘_h™_l0
, 
GET_HIT_L0
)

12226 
	$DEF_SHOW_FUNC
(
g‘_h™_l1
, 
GET_HIT_L1
)

12227 
	$DEF_SHOW_FUNC
(
g‘_h™_l2_ªd_up
, 
GET_HIT_L2_AND_UP
)

12228 
	$DEF_SHOW_FUNC
(
com·ùiÚ_key_drİ_Ãw
, 
COMPACTION_KEY_DROP_NEWER_ENTRY
)

12229 
	$DEF_SHOW_FUNC
(
com·ùiÚ_key_drİ_obsŞ‘e
, 
COMPACTION_KEY_DROP_OBSOLETE
)

12230 
	$DEF_SHOW_FUNC
(
com·ùiÚ_key_drİ_u£r
, 
COMPACTION_KEY_DROP_USER
)

12231 
	$DEF_SHOW_FUNC
(
numb”_keys_wr™‹n
, 
NUMBER_KEYS_WRITTEN
)

12232 
	$DEF_SHOW_FUNC
(
numb”_keys_»ad
, 
NUMBER_KEYS_READ
)

12233 
	$DEF_SHOW_FUNC
(
numb”_keys_upd©ed
, 
NUMBER_KEYS_UPDATED
)

12234 
	$DEF_SHOW_FUNC
(
by‹s_wr™‹n
, 
BYTES_WRITTEN
)

12235 
	$DEF_SHOW_FUNC
(
by‹s_»ad
, 
BYTES_READ
)

12236 
	$DEF_SHOW_FUNC
(
numb”_db_£ek
, 
NUMBER_DB_SEEK
)

12237 
	$DEF_SHOW_FUNC
(
numb”_db_£ek_found
, 
NUMBER_DB_SEEK_FOUND
)

12238 
	$DEF_SHOW_FUNC
(
numb”_db_Ãxt
, 
NUMBER_DB_NEXT
)

12239 
	$DEF_SHOW_FUNC
(
numb”_db_Ãxt_found
, 
NUMBER_DB_NEXT_FOUND
)

12240 
	$DEF_SHOW_FUNC
(
numb”_db_´ev
, 
NUMBER_DB_PREV
)

12241 
	$DEF_SHOW_FUNC
(
numb”_db_´ev_found
, 
NUMBER_DB_PREV_FOUND
)

12242 
	$DEF_SHOW_FUNC
(
™”_by‹s_»ad
, 
ITER_BYTES_READ
)

12243 
	$DEF_SHOW_FUNC
(
no_fe_şo£s
, 
NO_FILE_CLOSES
)

12244 
	$DEF_SHOW_FUNC
(
no_fe_İ’s
, 
NO_FILE_OPENS
)

12245 
	$DEF_SHOW_FUNC
(
no_fe_”rÜs
, 
NO_FILE_ERRORS
)

12246 
	$DEF_SHOW_FUNC
(
¡®l_miüos
, 
STALL_MICROS
)

12247 
	$DEF_SHOW_FUNC
(
num_™”©Üs
, 
NO_ITERATORS
)

12248 
	$DEF_SHOW_FUNC
(
numb”_muÉig‘_g‘
, 
NUMBER_MULTIGET_CALLS
)

12249 
	$DEF_SHOW_FUNC
(
numb”_muÉig‘_keys_»ad
, 
NUMBER_MULTIGET_KEYS_READ
)

12250 
	$DEF_SHOW_FUNC
(
numb”_muÉig‘_by‹s_»ad
, 
NUMBER_MULTIGET_BYTES_READ
)

12251 
	$DEF_SHOW_FUNC
(
numb”_d–‘es_f‹»d
, 
NUMBER_FILTERED_DELETES
)

12252 
	$DEF_SHOW_FUNC
(
numb”_m”ge_çu»s
, 
NUMBER_MERGE_FAILURES
)

12253 
	$DEF_SHOW_FUNC
(
bloom_f‹r_´efix_checked
, 
BLOOM_FILTER_PREFIX_CHECKED
)

12254 
	$DEF_SHOW_FUNC
(
bloom_f‹r_´efix_u£ful
, 
BLOOM_FILTER_PREFIX_USEFUL
)

12255 
	$DEF_SHOW_FUNC
(
numb”_»£eks_™”©iÚ
, 
NUMBER_OF_RESEEKS_IN_ITERATION
)

12256 
	$DEF_SHOW_FUNC
(
g‘upd©essšû_ÿÎs
, 
GET_UPDATES_SINCE_CALLS
)

12257 
	$DEF_SHOW_FUNC
(
block_ÿchecom´es£d_miss
, 
BLOCK_CACHE_COMPRESSED_MISS
)

12258 
	$DEF_SHOW_FUNC
(
block_ÿchecom´es£d_h™
, 
BLOCK_CACHE_COMPRESSED_HIT
)

12259 
	$DEF_SHOW_FUNC
(
w®_synûd
, 
WAL_FILE_SYNCED
)

12260 
	$DEF_SHOW_FUNC
(
w®_by‹s
, 
WAL_FILE_BYTES
)

12261 
	$DEF_SHOW_FUNC
(
wr™e_£lf
, 
WRITE_DONE_BY_SELF
)

12262 
	$DEF_SHOW_FUNC
(
wr™e_Ùh”
, 
WRITE_DONE_BY_OTHER
)

12263 
	$DEF_SHOW_FUNC
(
wr™e_timedout
, 
WRITE_TIMEDOUT
)

12264 
	$DEF_SHOW_FUNC
(
wr™e_w®
, 
WRITE_WITH_WAL
)

12265 
	$DEF_SHOW_FUNC
(
æush_wr™e_by‹s
, 
FLUSH_WRITE_BYTES
)

12266 
	$DEF_SHOW_FUNC
(
com·ù_»ad_by‹s
, 
COMPACT_READ_BYTES
)

12267 
	$DEF_SHOW_FUNC
(
com·ù_wr™e_by‹s
, 
COMPACT_WRITE_BYTES
)

12268 
	$DEF_SHOW_FUNC
(
numb”_su³rv”siÚ_acquœes
, 
NUMBER_SUPERVERSION_ACQUIRES
)

12269 
	$DEF_SHOW_FUNC
(
numb”_su³rv”siÚ_»Ëa£s
, 
NUMBER_SUPERVERSION_RELEASES
)

12270 
	$DEF_SHOW_FUNC
(
numb”_su³rv”siÚ_ş—nups
, 
NUMBER_SUPERVERSION_CLEANUPS
)

12271 
	$DEF_SHOW_FUNC
(
numb”_block_nÙ_com´es£d
, 
NUMBER_BLOCK_NOT_COMPRESSED
)

12273 
	$myrocks_upd©e_¡©us
() {

12274 
expÜt_¡©s
.
rows_d–‘ed
 = 
glob®_¡©s
.
rows
[
ROWS_DELETED
];

12275 
expÜt_¡©s
.
rows_š£¹ed
 = 
glob®_¡©s
.
rows
[
ROWS_INSERTED
];

12276 
expÜt_¡©s
.
rows_»ad
 = 
glob®_¡©s
.
rows
[
ROWS_READ
];

12277 
expÜt_¡©s
.
rows_upd©ed
 = 
glob®_¡©s
.
rows
[
ROWS_UPDATED
];

12278 
expÜt_¡©s
.
rows_d–‘ed_blšd
 = 
glob®_¡©s
.
rows
[
ROWS_DELETED_BLIND
];

12279 
expÜt_¡©s
.
rows_expœed
 = 
glob®_¡©s
.
rows
[
ROWS_EXPIRED
];

12280 
expÜt_¡©s
.
rows_f‹»d
 = 
glob®_¡©s
.
rows
[
ROWS_FILTERED
];

12282 
expÜt_¡©s
.
sy¡em_rows_d–‘ed
 = 
glob®_¡©s
.
sy¡em_rows
[
ROWS_DELETED
];

12283 
expÜt_¡©s
.
sy¡em_rows_š£¹ed
 = 
glob®_¡©s
.
sy¡em_rows
[
ROWS_INSERTED
];

12284 
expÜt_¡©s
.
sy¡em_rows_»ad
 = 
glob®_¡©s
.
sy¡em_rows
[
ROWS_READ
];

12285 
expÜt_¡©s
.
sy¡em_rows_upd©ed
 = 
glob®_¡©s
.
sy¡em_rows
[
ROWS_UPDATED
];

12287 
expÜt_¡©s
.
qu”›s_pošt
 = 
glob®_¡©s
.
qu”›s
[
QUERIES_POINT
];

12288 
expÜt_¡©s
.
qu”›s_¿nge
 = 
glob®_¡©s
.
qu”›s
[
QUERIES_RANGE
];

12290 
expÜt_¡©s
.
cov”ed_£cÚd¬y_key_lookups
 =

12291 
glob®_¡©s
.
cov”ed_£cÚd¬y_key_lookups
;

12292 
	}
}

12294 
	$myrocks_upd©e_memÜy_¡©us
() {

12295 
¡d
::
veùÜ
<
rocksdb
::
DB
 *> 
dbs
;

12296 
¡d
::
unÜd”ed_£t
<cÚ¡ 
rocksdb
::
Cache
 *> 
ÿche_£t
;

12297 
dbs
.
	`push_back
(
rdb
);

12298 
¡d
::
m­
<
rocksdb
::
MemÜyUt
::
U§geTy³
, 
ušt64_t
> 
‹mp_u§ge_by_ty³
;

12299 
rocksdb
::
MemÜyUt
::
	`G‘Aµroxim©eMemÜyU§geByTy³
(
dbs
, 
ÿche_£t
,

12300 &
‹mp_u§ge_by_ty³
);

12301 
memÜy_¡©s
.
membË_tÙ®
 =

12302 
‹mp_u§ge_by_ty³
[
rocksdb
::
MemÜyUt
::
kMemTabËTÙ®
];

12303 
memÜy_¡©s
.
membË_unæushed
 =

12304 
‹mp_u§ge_by_ty³
[
rocksdb
::
MemÜyUt
::
kMemTabËUnFlushed
];

12305 
	}
}

12307 
SHOW_VAR
 
myrocks_¡©us_v¬ŸbËs
[] = {

12308 
DEF_STATUS_VAR_FUNC
("rows_d–‘ed", &
expÜt_¡©s
.
rows_d–‘ed
,

12309 
SHOW_LONGLONG
),

12310 
DEF_STATUS_VAR_FUNC
("rows_š£¹ed", &
expÜt_¡©s
.
rows_š£¹ed
,

12311 
SHOW_LONGLONG
),

12312 
DEF_STATUS_VAR_FUNC
("rows_»ad", &
expÜt_¡©s
.
rows_»ad
, 
SHOW_LONGLONG
),

12313 
DEF_STATUS_VAR_FUNC
("rows_upd©ed", &
expÜt_¡©s
.
rows_upd©ed
,

12314 
SHOW_LONGLONG
),

12315 
DEF_STATUS_VAR_FUNC
("rows_d–‘ed_blšd", &
expÜt_¡©s
.
rows_d–‘ed_blšd
,

12316 
SHOW_LONGLONG
),

12317 
DEF_STATUS_VAR_FUNC
("rows_expœed", &
expÜt_¡©s
.
rows_expœed
,

12318 
SHOW_LONGLONG
),

12319 
DEF_STATUS_VAR_FUNC
("rows_f‹»d", &
expÜt_¡©s
.
rows_f‹»d
,

12320 
SHOW_LONGLONG
),

12321 
DEF_STATUS_VAR_FUNC
("system_rows_deleted",

12322 &
expÜt_¡©s
.
sy¡em_rows_d–‘ed
, 
SHOW_LONGLONG
),

12323 
DEF_STATUS_VAR_FUNC
("system_rows_inserted",

12324 &
expÜt_¡©s
.
sy¡em_rows_š£¹ed
, 
SHOW_LONGLONG
),

12325 
DEF_STATUS_VAR_FUNC
("sy¡em_rows_»ad", &
expÜt_¡©s
.
sy¡em_rows_»ad
,

12326 
SHOW_LONGLONG
),

12327 
DEF_STATUS_VAR_FUNC
("system_rows_updated",

12328 &
expÜt_¡©s
.
sy¡em_rows_upd©ed
, 
SHOW_LONGLONG
),

12329 
DEF_STATUS_VAR_FUNC
("membË_tÙ®", &
memÜy_¡©s
.
membË_tÙ®
,

12330 
SHOW_LONGLONG
),

12331 
DEF_STATUS_VAR_FUNC
("membË_unæushed", &
memÜy_¡©s
.
membË_unæushed
,

12332 
SHOW_LONGLONG
),

12333 
DEF_STATUS_VAR_FUNC
("qu”›s_pošt", &
expÜt_¡©s
.
qu”›s_pošt
,

12334 
SHOW_LONGLONG
),

12335 
DEF_STATUS_VAR_FUNC
("qu”›s_¿nge", &
expÜt_¡©s
.
qu”›s_¿nge
,

12336 
SHOW_LONGLONG
),

12337 
DEF_STATUS_VAR_FUNC
("covered_secondary_key_lookups",

12338 &
expÜt_¡©s
.
cov”ed_£cÚd¬y_key_lookups
,

12339 
SHOW_LONGLONG
),

12341 {
NuÎS
, NuÎS, 
SHOW_LONG
}};

12343 
	$show_myrocks_v¬s
(
THD
 *
thd
, 
SHOW_VAR
 *
v¬
, *
buff
) {

12344 
	`myrocks_upd©e_¡©us
();

12345 
	`myrocks_upd©e_memÜy_¡©us
();

12346 
v¬
->
ty³
 = 
SHOW_ARRAY
;

12347 
v¬
->
v®ue
 = 
»š‹½»t_ÿ¡
<*>(&
myrocks_¡©us_v¬ŸbËs
);

12348 
	}
}

12350 
ulÚglÚg


12351 
io_¡®l_´İ_v®ue
(cÚ¡ 
¡d
::
m­
<¡d::
¡ršg
, std::¡ršg> &
´İs
,

12352 cÚ¡ 
¡d
::
¡ršg
 &
key
) {

12353 
¡d
::
m­
<¡d::
¡ršg
, std::¡ršg>::
cÚ¡_™”©Ü
 
™”
 =

12354 
´İs
.
fšd
("io_¡®ls." + 
key
);

12355 ià(
™”
 !ğ
´İs
.
’d
()) {

12356  
¡d
::
¡ouÎ
(
™”
->
£cÚd
);

12358 
DBUG_PRINT
("warning",

12359 ("RocksDB G‘M­Prİ”y ha¢'ˆ»tuºed key=%s", 
key
.
c_¡r
()));

12360 
DBUG_ASSERT
(0);

12365 
	$upd©e_rocksdb_¡®l_¡©us
() {

12366 
¡_io_¡®l_¡©s
 
loÿl_io_¡®l_¡©s
;

12367 cÚ¡‡utØ&
cf_Çme
 : 
cf_mªag”
.
	`g‘_cf_Çmes
()) {

12368 
rocksdb
::
CŞumnFamyHªdË
 *
cfh
 = 
cf_mªag”
.
	`g‘_cf
(
cf_Çme
);

12369 ià(
cfh
 =ğ
nuÎ±r
) {

12373 
¡d
::
m­
<¡d::
¡ršg
, std::¡ršg> 
´İs
;

12374 ià(!
rdb
->
	`G‘M­Prİ”ty
(
cfh
, "rocksdb.cf¡©s", &
´İs
)) {

12378 
loÿl_io_¡®l_¡©s
.
Ëv–0_¦owdown
 +=

12379 
	`io_¡®l_´İ_v®ue
(
´İs
, "level0_slowdown");

12380 
loÿl_io_¡®l_¡©s
.
Ëv–0_¦owdown_w™h_com·ùiÚ
 +=

12381 
	`io_¡®l_´İ_v®ue
(
´İs
, "level0_slowdown_with_compaction");

12382 
loÿl_io_¡®l_¡©s
.
Ëv–0_numfes
 +=

12383 
	`io_¡®l_´İ_v®ue
(
´İs
, "level0_numfiles");

12384 
loÿl_io_¡®l_¡©s
.
Ëv–0_numfes_w™h_com·ùiÚ
 +=

12385 
	`io_¡®l_´İ_v®ue
(
´İs
, "level0_numfiles_with_compaction");

12386 
loÿl_io_¡®l_¡©s
.
¡İ_fÜ_³ndšg_com·ùiÚ_by‹s
 +=

12387 
	`io_¡®l_´İ_v®ue
(
´İs
, "stop_for_pending_compaction_bytes");

12388 
loÿl_io_¡®l_¡©s
.
¦owdown_fÜ_³ndšg_com·ùiÚ_by‹s
 +=

12389 
	`io_¡®l_´İ_v®ue
(
´İs
, "slowdown_for_pending_compaction_bytes");

12390 
loÿl_io_¡®l_¡©s
.
membË_com·ùiÚ
 +=

12391 
	`io_¡®l_´İ_v®ue
(
´İs
, "memtable_compaction");

12392 
loÿl_io_¡®l_¡©s
.
membË_¦owdown
 +=

12393 
	`io_¡®l_´İ_v®ue
(
´İs
, "memtable_slowdown");

12394 
loÿl_io_¡®l_¡©s
.
tÙ®_¡İ
 +ğ
	`io_¡®l_´İ_v®ue
(
´İs
, "total_stop");

12395 
loÿl_io_¡®l_¡©s
.
tÙ®_¦owdown
 +=

12396 
	`io_¡®l_´İ_v®ue
(
´İs
, "total_slowdown");

12398 
io_¡®l_¡©s
 = 
loÿl_io_¡®l_¡©s
;

12399 
	}
}

12401 
SHOW_VAR
 
rocksdb_¡®l_¡©us_v¬ŸbËs
[] = {

12402 
DEF_STATUS_VAR_FUNC
("l0_file_count_limit_slowdowns",

12403 &
io_¡®l_¡©s
.
Ëv–0_¦owdown
, 
SHOW_LONGLONG
),

12404 
DEF_STATUS_VAR_FUNC
("locked_l0_file_count_limit_slowdowns",

12405 &
io_¡®l_¡©s
.
Ëv–0_¦owdown_w™h_com·ùiÚ
,

12406 
SHOW_LONGLONG
),

12407 
DEF_STATUS_VAR_FUNC
("l0_file_count_limit_stops",

12408 &
io_¡®l_¡©s
.
Ëv–0_numfes
, 
SHOW_LONGLONG
),

12409 
DEF_STATUS_VAR_FUNC
("locked_l0_file_count_limit_stops",

12410 &
io_¡®l_¡©s
.
Ëv–0_numfes_w™h_com·ùiÚ
,

12411 
SHOW_LONGLONG
),

12412 
DEF_STATUS_VAR_FUNC
("pending_compaction_limit_stops",

12413 &
io_¡®l_¡©s
.
¡İ_fÜ_³ndšg_com·ùiÚ_by‹s
,

12414 
SHOW_LONGLONG
),

12415 
DEF_STATUS_VAR_FUNC
("pending_compaction_limit_slowdowns",

12416 &
io_¡®l_¡©s
.
¦owdown_fÜ_³ndšg_com·ùiÚ_by‹s
,

12417 
SHOW_LONGLONG
),

12418 
DEF_STATUS_VAR_FUNC
("memtable_limit_stops",

12419 &
io_¡®l_¡©s
.
membË_com·ùiÚ
, 
SHOW_LONGLONG
),

12420 
DEF_STATUS_VAR_FUNC
("memtable_limit_slowdowns",

12421 &
io_¡®l_¡©s
.
membË_¦owdown
, 
SHOW_LONGLONG
),

12422 
DEF_STATUS_VAR_FUNC
("tÙ®_¡İs", &
io_¡®l_¡©s
.
tÙ®_¡İ
,

12423 
SHOW_LONGLONG
),

12424 
DEF_STATUS_VAR_FUNC
("tÙ®_¦owdowns", &
io_¡®l_¡©s
.
tÙ®_¦owdown
,

12425 
SHOW_LONGLONG
),

12427 {
NuÎS
, NuÎS, 
SHOW_LONG
}};

12429 
	$show_rocksdb_¡®l_v¬s
(
THD
 *
thd
, 
SHOW_VAR
 *
v¬
, *
buff
) {

12430 
	`upd©e_rocksdb_¡®l_¡©us
();

12431 
v¬
->
ty³
 = 
SHOW_ARRAY
;

12432 
v¬
->
v®ue
 = 
»š‹½»t_ÿ¡
<*>(&
rocksdb_¡®l_¡©us_v¬ŸbËs
);

12433 
	}
}

12435 
SHOW_VAR
 
rocksdb_¡©us_v¬s
[] = {

12436 
DEF_STATUS_VAR
(
block_ÿche_miss
),

12437 
DEF_STATUS_VAR
(
block_ÿche_h™
),

12438 
DEF_STATUS_VAR
(
block_ÿche_add
),

12439 
DEF_STATUS_VAR
(
block_ÿche_add_çu»s
),

12440 
DEF_STATUS_VAR
(
block_ÿche_šdex_miss
),

12441 
DEF_STATUS_VAR
(
block_ÿche_šdex_h™
),

12442 
DEF_STATUS_VAR
(
block_ÿche_šdex_add
),

12443 
DEF_STATUS_VAR
(
block_ÿche_šdex_by‹s_š£¹
),

12444 
DEF_STATUS_VAR
(
block_ÿche_šdex_by‹s_eviù
),

12445 
DEF_STATUS_VAR
(
block_ÿche_f‹r_miss
),

12446 
DEF_STATUS_VAR
(
block_ÿche_f‹r_h™
),

12447 
DEF_STATUS_VAR
(
block_ÿche_f‹r_add
),

12448 
DEF_STATUS_VAR
(
block_ÿche_f‹r_by‹s_š£¹
),

12449 
DEF_STATUS_VAR
(
block_ÿche_f‹r_by‹s_eviù
),

12450 
DEF_STATUS_VAR
(
block_ÿche_by‹s_»ad
),

12451 
DEF_STATUS_VAR
(
block_ÿche_by‹s_wr™e
),

12452 
DEF_STATUS_VAR
(
block_ÿche_d©a_by‹s_š£¹
),

12453 
DEF_STATUS_VAR
(
block_ÿche_d©a_miss
),

12454 
DEF_STATUS_VAR
(
block_ÿche_d©a_h™
),

12455 
DEF_STATUS_VAR
(
block_ÿche_d©a_add
),

12456 
DEF_STATUS_VAR
(
bloom_f‹r_u£ful
),

12457 
DEF_STATUS_VAR
(
bloom_f‹r_fuÎ_pos™ive
),

12458 
DEF_STATUS_VAR
(
bloom_f‹r_fuÎ_Œue_pos™ive
),

12459 
DEF_STATUS_VAR
(
membË_h™
),

12460 
DEF_STATUS_VAR
(
membË_miss
),

12461 
DEF_STATUS_VAR
(
g‘_h™_l0
),

12462 
DEF_STATUS_VAR
(
g‘_h™_l1
),

12463 
DEF_STATUS_VAR
(
g‘_h™_l2_ªd_up
),

12464 
DEF_STATUS_VAR
(
com·ùiÚ_key_drİ_Ãw
),

12465 
DEF_STATUS_VAR
(
com·ùiÚ_key_drİ_obsŞ‘e
),

12466 
DEF_STATUS_VAR
(
com·ùiÚ_key_drİ_u£r
),

12467 
DEF_STATUS_VAR
(
numb”_keys_wr™‹n
),

12468 
DEF_STATUS_VAR
(
numb”_keys_»ad
),

12469 
DEF_STATUS_VAR
(
numb”_keys_upd©ed
),

12470 
DEF_STATUS_VAR
(
by‹s_wr™‹n
),

12471 
DEF_STATUS_VAR
(
by‹s_»ad
),

12472 
DEF_STATUS_VAR
(
numb”_db_£ek
),

12473 
DEF_STATUS_VAR
(
numb”_db_£ek_found
),

12474 
DEF_STATUS_VAR
(
numb”_db_Ãxt
),

12475 
DEF_STATUS_VAR
(
numb”_db_Ãxt_found
),

12476 
DEF_STATUS_VAR
(
numb”_db_´ev
),

12477 
DEF_STATUS_VAR
(
numb”_db_´ev_found
),

12478 
DEF_STATUS_VAR
(
™”_by‹s_»ad
),

12479 
DEF_STATUS_VAR
(
no_fe_şo£s
),

12480 
DEF_STATUS_VAR
(
no_fe_İ’s
),

12481 
DEF_STATUS_VAR
(
no_fe_”rÜs
),

12482 
DEF_STATUS_VAR
(
¡®l_miüos
),

12483 
DEF_STATUS_VAR
(
num_™”©Üs
),

12484 
DEF_STATUS_VAR
(
numb”_muÉig‘_g‘
),

12485 
DEF_STATUS_VAR
(
numb”_muÉig‘_keys_»ad
),

12486 
DEF_STATUS_VAR
(
numb”_muÉig‘_by‹s_»ad
),

12487 
DEF_STATUS_VAR
(
numb”_d–‘es_f‹»d
),

12488 
DEF_STATUS_VAR
(
numb”_m”ge_çu»s
),

12489 
DEF_STATUS_VAR
(
bloom_f‹r_´efix_checked
),

12490 
DEF_STATUS_VAR
(
bloom_f‹r_´efix_u£ful
),

12491 
DEF_STATUS_VAR
(
numb”_»£eks_™”©iÚ
),

12492 
DEF_STATUS_VAR
(
g‘upd©essšû_ÿÎs
),

12493 
DEF_STATUS_VAR
(
block_ÿchecom´es£d_miss
),

12494 
DEF_STATUS_VAR
(
block_ÿchecom´es£d_h™
),

12495 
DEF_STATUS_VAR
(
w®_synûd
),

12496 
DEF_STATUS_VAR
(
w®_by‹s
),

12497 
DEF_STATUS_VAR
(
wr™e_£lf
),

12498 
DEF_STATUS_VAR
(
wr™e_Ùh”
),

12499 
DEF_STATUS_VAR
(
wr™e_timedout
),

12500 
DEF_STATUS_VAR
(
wr™e_w®
),

12501 
DEF_STATUS_VAR
(
æush_wr™e_by‹s
),

12502 
DEF_STATUS_VAR
(
com·ù_»ad_by‹s
),

12503 
DEF_STATUS_VAR
(
com·ù_wr™e_by‹s
),

12504 
DEF_STATUS_VAR
(
numb”_su³rv”siÚ_acquœes
),

12505 
DEF_STATUS_VAR
(
numb”_su³rv”siÚ_»Ëa£s
),

12506 
DEF_STATUS_VAR
(
numb”_su³rv”siÚ_ş—nups
),

12507 
DEF_STATUS_VAR
(
numb”_block_nÙ_com´es£d
),

12508 
DEF_STATUS_VAR_PTR
("row_lock_d—dlocks", &
rocksdb_row_lock_d—dlocks
,

12509 
SHOW_LONGLONG
),

12510 
DEF_STATUS_VAR_PTR
("row_lock_wait_timeouts",

12511 &
rocksdb_row_lock_wa™_timeouts
, 
SHOW_LONGLONG
),

12512 
DEF_STATUS_VAR_PTR
("snapshot_conflict_errors",

12513 &
rocksdb_¢­shÙ_cÚæiù_”rÜs
, 
SHOW_LONGLONG
),

12514 
DEF_STATUS_VAR_PTR
("w®_group_syncs", &
rocksdb_w®_group_syncs
,

12515 
SHOW_LONGLONG
),

12516 
DEF_STATUS_VAR_PTR
("numb”_s¡_’Œy_put", &
rocksdb_num_s¡_’Œy_put
,

12517 
SHOW_LONGLONG
),

12518 
DEF_STATUS_VAR_PTR
("numb”_s¡_’Œy_d–‘e", &
rocksdb_num_s¡_’Œy_d–‘e
,

12519 
SHOW_LONGLONG
),

12520 
DEF_STATUS_VAR_PTR
("number_sst_entry_singledelete",

12521 &
rocksdb_num_s¡_’Œy_sšgËd–‘e
, 
SHOW_LONGLONG
),

12522 
DEF_STATUS_VAR_PTR
("numb”_s¡_’Œy_m”ge", &
rocksdb_num_s¡_’Œy_m”ge
,

12523 
SHOW_LONGLONG
),

12524 
DEF_STATUS_VAR_PTR
("numb”_s¡_’Œy_Ùh”", &
rocksdb_num_s¡_’Œy_Ùh”
,

12525 
SHOW_LONGLONG
),

12529 {"rocksdb", 
»š‹½»t_ÿ¡
<*>(&
show_myrocks_v¬s
), 
SHOW_FUNC
},

12530 {"rocksdb_¡®l", 
»š‹½»t_ÿ¡
<*>(&
show_rocksdb_¡®l_v¬s
),

12531 
SHOW_FUNC
},

12532 {
NuÎS
, NuÎS, 
SHOW_LONG
}};

12538 
Rdb_background_th»ad
::
	$run
() {

12540 cÚ¡ 
WAKE_UP_INTERVAL
 = 1;

12542 
time¥ec
 
ts_Ãxt_sync
;

12543 
	`şock_g‘time
(
CLOCK_REALTIME
, &
ts_Ãxt_sync
);

12544 
ts_Ãxt_sync
.
tv_£c
 +ğ
WAKE_UP_INTERVAL
;

12550 
	`RDB_MUTEX_LOCK_CHECK
(
m_sigÇl_mu‹x
);

12551 cÚ¡‡utØ
»t
 
	`MY_ATTRIBUTE
((
__unu£d__
)) =

12552 
	`mysql_cÚd_timedwa™
(&
m_sigÇl_cÚd
, &
m_sigÇl_mu‹x
, &
ts_Ãxt_sync
);

12555 
	`DBUG_ASSERT
(
»t
 =ğ0 ||„‘ =ğ
ETIMEDOUT
);

12556 cÚ¡ 
boŞ
 
loÿl_¡İ
 = 
m_¡İ
;

12557 cÚ¡ 
boŞ
 
loÿl_§ve_¡©s
 = 
m_§ve_¡©s
;

12558 
	`»£t
();

12559 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_sigÇl_mu‹x
);

12561 ià(
loÿl_¡İ
) {

12569 
	`DBUG_ASSERT
(
»t
 =ğ
ETIMEDOUT
);

12571 ià(
loÿl_§ve_¡©s
) {

12572 
ddl_mªag”
.
	`³rsi¡_¡©s
();

12575 
time¥ec
 
ts
;

12576 
	`şock_g‘time
(
CLOCK_REALTIME
, &
ts
);

12582 ià(
rdb
 && (
rocksdb_æush_log_©_Œx_comm™
 !ğ
FLUSH_LOG_SYNC
) &&

12583 !
rocksdb_db_İtiÚs
->
®low_mm­_wr™es
) {

12584 cÚ¡ 
rocksdb
::
Stus
 
s
 = 
rdb
->
	`FlushWAL
(
Œue
);

12585 ià(!
s
.
	`ok
()) {

12586 
	`rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_BG_THREAD
);

12591 ià(
rocksdb_¡©s_»ÿlc_¿‹
) {

12592 
¡d
::
unÜd”ed_m­
<
GL_INDEX_ID
, std::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
>>

12593 
to_»ÿlc
;

12595 ià(
rdb_šdexes_to_»ÿlc
.
	`em±y
()) {

12596 
Rdb_šdex_cŞËùÜ
 : 
public
 
Rdb_bËs_sÿÂ”
 {

12597 
	`add_bË
(
Rdb_tbl_def
 *
tdef
è
ov”ride
 {

12598 
ušt
 
i
 = 0; i < 
tdef
->
m_key_couÁ
; i++) {

12599 
rdb_šdexes_to_»ÿlc
.
	`push_back
(

12600 
tdef
->
m_key_desü_¬r
[
i
]->
	`g‘_gl_šdex_id
());

12602  
HA_EXIT_SUCCESS
;

12604 } 
cŞËùÜ
;

12605 
ddl_mªag”
.
	`sÿn_fÜ_bËs
(&
cŞËùÜ
);

12608 
to_»ÿlc
.
	`size
(è< 
rocksdb_¡©s_»ÿlc_¿‹
 &&

12609 !
rdb_šdexes_to_»ÿlc
.
	`em±y
()) {

12610 cÚ¡‡utØ
šdex_id
 = 
rdb_šdexes_to_»ÿlc
.
	`back
();

12611 
rdb_šdexes_to_»ÿlc
.
	`pİ_back
();

12613 
¡d
::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
> 
keydef
 =

12614 
ddl_mªag”
.
	`§ã_fšd
(
šdex_id
);

12616 ià(
keydef
) {

12617 
to_»ÿlc
.
	`š£¹
(
¡d
::
	`make_·œ
(
keydef
->
	`g‘_gl_šdex_id
(), keydef));

12621 ià(!
to_»ÿlc
.
	`em±y
()) {

12622 
	`ÿlcuÏ‹_¡©s
(
to_»ÿlc
, 
çl£
);

12628 
ts_Ãxt_sync
.
tv_£c
 = 
ts
.tv_£ø+ 
WAKE_UP_INTERVAL
;

12632 
ddl_mªag”
.
	`³rsi¡_¡©s
();

12633 
	}
}

12635 
boŞ
 
ha_rocksdb
::
	$check_bloom_ªd_£t_bounds
(

12636 
THD
 *
thd
, cÚ¡ 
Rdb_key_def
 &
kd
, cÚ¡ 
rocksdb
::
Sliû
 &
eq_cÚd
,

12637 cÚ¡ 
boŞ
 
u£_®l_keys
, 
size_t
 
bound_Ën
, 
uch¬
 *cÚ¡ 
low”_bound
,

12638 
uch¬
 *cÚ¡ 
uµ”_bound
, 
rocksdb
::
Sliû
 *
low”_bound_¦iû
,

12639 
rocksdb
::
Sliû
 *
uµ”_bound_¦iû
) {

12640 
boŞ
 
ÿn_u£_bloom
 = 
	`ÿn_u£_bloom_f‹r
(
thd
, 
kd
, 
eq_cÚd
, 
u£_®l_keys
);

12641 ià(!
ÿn_u£_bloom
) {

12642 
	`£tup_™”©Ü_bounds
(
kd
, 
eq_cÚd
, 
bound_Ën
, 
low”_bound
, 
uµ”_bound
,

12643 
low”_bound_¦iû
, 
uµ”_bound_¦iû
);

12645  
ÿn_u£_bloom
;

12646 
	}
}

12666 
boŞ
 
ha_rocksdb
::
	$ÿn_u£_bloom_f‹r
(
THD
 *
thd
, cÚ¡ 
Rdb_key_def
 &
kd
,

12667 cÚ¡ 
rocksdb
::
Sliû
 &
eq_cÚd
,

12668 cÚ¡ 
boŞ
 
u£_®l_keys
) {

12669 
boŞ
 
ÿn_u£
 = 
çl£
;

12671 ià(
	`THDVAR
(
thd
, 
sk_bloom_f‹r_Ú_»ad
)) {

12672  
ÿn_u£
;

12675 cÚ¡ 
rocksdb
::
SliûT¿nsfÜm
 *
´efix_exŒaùÜ
 = 
kd
.
	`g‘_exŒaùÜ
();

12676 ià(
´efix_exŒaùÜ
) {

12695 ià((
u£_®l_keys
 && 
´efix_exŒaùÜ
->
	`InRªge
(
eq_cÚd
))

12696 || 
´efix_exŒaùÜ
->
	`SameResuÉWh’Aµ’ded
(
eq_cÚd
))

12697 
ÿn_u£
 = 
Œue
;

12699 
ÿn_u£
 = 
çl£
;

12705 ià(
u£_®l_keys
)

12706 
ÿn_u£
 = 
Œue
;

12708 
ÿn_u£
 = 
çl£
;

12711  
ÿn_u£
;

12712 
	}
}

12715 
rocksdb
::
T¿n§ùiÚDB
 *
	$rdb_g‘_rocksdb_db
(è{  
rdb
; 
	}
}

12717 
Rdb_cf_mªag”
 &
	$rdb_g‘_cf_mªag”
(è{  
cf_mªag”
; 
	}
}

12719 cÚ¡ 
rocksdb
::
BlockBa£dTabËO±iÚs
 &
	$rdb_g‘_bË_İtiÚs
() {

12720  *
rocksdb_tbl_İtiÚs
;

12721 
	}
}

12723 
boŞ
 
	$rdb_is_‰l_’abËd
(è{  
rocksdb_’abË_‰l
; 
	}
}

12724 
boŞ
 
	$rdb_is_‰l_»ad_f‹ršg_’abËd
() {

12725  
rocksdb_’abË_‰l_»ad_f‹ršg
;

12726 
	}
}

12727 #iâdeà
NDEBUG


12728 
	$rdb_dbug_£t_‰l_»c_ts
(è{  
rocksdb_debug_‰l_»c_ts
; 
	}
}

12729 
	$rdb_dbug_£t_‰l_¢­shÙ_ts
(è{  
rocksdb_debug_‰l_¢­shÙ_ts
; 
	}
}

12730 
	$rdb_dbug_£t_‰l_»ad_f‹r_ts
() {

12731  
rocksdb_debug_‰l_»ad_f‹r_ts
;

12732 
	}
}

12733 
boŞ
 
	$rdb_dbug_£t_‰l_ignÜe_pk
(è{  
rocksdb_debug_‰l_ignÜe_pk
; 
	}
}

12736 
	$rdb_upd©e_glob®_¡©s
(cÚ¡ 
İ”©iÚ_ty³
 &
ty³
, 
ušt
 
couÁ
,

12737 
boŞ
 
is_sy¡em_bË
) {

12738 
	`DBUG_ASSERT
(
ty³
 < 
ROWS_MAX
);

12740 ià(
couÁ
 == 0) {

12744 ià(
is_sy¡em_bË
) {

12745 
glob®_¡©s
.
sy¡em_rows
[
ty³
].
	`add
(
couÁ
);

12747 
glob®_¡©s
.
rows
[
ty³
].
	`add
(
couÁ
);

12749 
	}
}

12751 
	$rdb_g‘_bË_³rf_couÁ”s
(cÚ¡ *cÚ¡ 
bËÇme
,

12752 
Rdb_³rf_couÁ”s
 *cÚ¡ 
couÁ”s
) {

12753 
	`DBUG_ASSERT
(
couÁ”s
 !ğ
nuÎ±r
);

12754 
	`DBUG_ASSERT
(
bËÇme
 !ğ
nuÎ±r
);

12756 
Rdb_bË_hªdËr
 *
bË_hªdËr
;

12757 
bË_hªdËr
 = 
rdb_İ’_bËs
.
	`g‘_bË_hªdËr
(
bËÇme
);

12758 ià(
bË_hªdËr
 =ğ
nuÎ±r
) {

12759  
HA_ERR_ROCKSDB_INVALID_TABLE
;

12762 
couÁ”s
->
	`lßd
(
bË_hªdËr
->
m_bË_³rf_cÚ‹xt
);

12764 
rdb_İ’_bËs
.
	`»Ëa£_bË_hªdËr
(
bË_hªdËr
);

12765  
HA_EXIT_SUCCESS
;

12766 
	}
}

12768 cÚ¡ *
	$g‘_rdb_io_”rÜ_¡ršg
(cÚ¡ 
RDB_IO_ERROR_TYPE
 
”r_ty³
) {

12772 
	`¡©ic_as£¹
(
RDB_IO_ERROR_LAST
 == 4, "Please handle‡llheƒrrorypes.");

12774 
”r_ty³
) {

12775 
RDB_IO_ERROR_TYPE
::
RDB_IO_ERROR_TX_COMMIT
:

12777 
RDB_IO_ERROR_TYPE
::
RDB_IO_ERROR_DICT_COMMIT
:

12779 
RDB_IO_ERROR_TYPE
::
RDB_IO_ERROR_BG_THREAD
:

12781 
RDB_IO_ERROR_TYPE
::
RDB_IO_ERROR_GENERAL
:

12784 
	`DBUG_ASSERT
(
çl£
);

12787 
	}
}

12792 #´agm¨
GCC
 
push_İtiÚs


12793 #´agm¨
GCC
 
İtimize
("O0")

12795 
	$rdb_hªdË_io_”rÜ
(cÚ¡ 
rocksdb
::
Stus
 
¡©us
,

12796 cÚ¡ 
RDB_IO_ERROR_TYPE
 
”r_ty³
) {

12797 ià(
¡©us
.
	`IsIOE¼Ü
()) {

12798 
”r_ty³
) {

12799 
RDB_IO_ERROR_TX_COMMIT
:

12800 
RDB_IO_ERROR_DICT_COMMIT
: {

12801 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "failedo writeo WAL");

12803 
	`sql_´št_”rÜ
("MyRocks:‡borting on WAL writeƒrror.");

12804 
	`abÜt
();

12807 
RDB_IO_ERROR_BG_THREAD
: {

12808 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "BGhread failedo writeo RocksDB");

12810 
	`sql_´št_”rÜ
("MyRocks:‡borting on BG writeƒrror.");

12811 
	`abÜt
();

12814 
RDB_IO_ERROR_GENERAL
: {

12815 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "failed on I/O");

12817 
	`sql_´št_”rÜ
("MyRocks:‡borting on I/Oƒrror.");

12818 
	`abÜt
();

12822 
	`DBUG_ASSERT
(0);

12825 } ià(
¡©us
.
	`IsCÜru±iÚ
()) {

12826 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "data corruption detected!");

12827 
	`rdb_³rsi¡_cÜru±iÚ_m¬k”
();

12829 
	`sql_´št_”rÜ
("MyRocks:‡borting because of data corruption.");

12830 
	`abÜt
();

12831 } ià(!
¡©us
.
	`ok
()) {

12832 
”r_ty³
) {

12833 
RDB_IO_ERROR_DICT_COMMIT
: {

12834 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "Failedo writeo WAL (dictionary)");

12836 
	`sql_´št_”rÜ
("MyRocks:‡borting on WAL writeƒrror.");

12837 
	`abÜt
();

12841 
	`rdb_log_¡©us_”rÜ
(
¡©us
, "Failedo„ead/write in RocksDB");

12845 
	}
}

12847 #´agm¨
GCC
 
pİ_İtiÚs


12849 
Rdb_diù_mªag”
 *
	$rdb_g‘_diù_mªag”
(è{  &
diù_mªag”
; 
	}
}

12851 
Rdb_ddl_mªag”
 *
	$rdb_g‘_ddl_mªag”
(è{  &
ddl_mªag”
; 
	}
}

12853 
Rdb_bšlog_mªag”
 *
	$rdb_g‘_bšlog_mªag”
(è{  &
bšlog_mªag”
; 
	}
}

12855 
rocksdb_£t_com·ùiÚ_İtiÚs
(

12856 
my_cÜe
::
THD
 *cÚ¡ 
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

12857 
my_cÜe
::
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

12858 *cÚ¡ 
v¬_±r
, cÚ¡ *cÚ¡ 
§ve
) {

12859 ià(
v¬_±r
 && 
§ve
) {

12860 *(
ušt64_t
 *)
v¬_±r
 = *(cÚ¡ ušt64_ˆ*)
§ve
;

12862 cÚ¡ 
Rdb_com·ù_·¿ms
 
·¿ms
 = {

12863 (
ušt64_t
)
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es
,

12864 (
ušt64_t
)
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_wšdow
,

12865 (
ušt64_t
)
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_fe_size
};

12866 ià(
´İ”t›s_cŞËùÜ_çùÜy
) {

12867 
´İ”t›s_cŞËùÜ_çùÜy
->
S‘Com·ùiÚP¬ams
(
·¿ms
);

12871 
rocksdb_£t_bË_¡©s_§m¶šg_pù
(

12872 
my_cÜe
::
THD
 *cÚ¡ 
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

12873 
my_cÜe
::
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

12874 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
) {

12875 
RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

12877 cÚ¡ 
ušt32_t
 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ ušt32_ˆ*>(
§ve
);

12879 ià(
Ãw_v®
 !ğ
rocksdb_bË_¡©s_§m¶šg_pù
) {

12880 
rocksdb_bË_¡©s_§m¶šg_pù
 = 
Ãw_v®
;

12882 ià(
´İ”t›s_cŞËùÜ_çùÜy
) {

12883 
´İ”t›s_cŞËùÜ_çùÜy
->
S‘TabËStsSam¶šgPù
(

12884 
rocksdb_bË_¡©s_§m¶šg_pù
);

12888 
RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

12900 
rocksdb_£t_¿‹_lim™”_by‹s_³r_£c
(

12901 
my_cÜe
::
THD
 *cÚ¡ 
thd
,

12902 
my_cÜe
::
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

12903 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
) {

12904 cÚ¡ 
ušt64_t
 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ ušt64_ˆ*>(
§ve
);

12905 ià(
Ãw_v®
 =ğ0 || 
rocksdb_¿‹_lim™”_by‹s_³r_£c
 == 0) {

12910 
push_w¬nšg_´štf
(
thd
, 
Sql_cÚd™iÚ
::
WARN_LEVEL_WARN
, 
ER_WRONG_ARGUMENTS
,

12914 } ià(
Ãw_v®
 !ğ
rocksdb_¿‹_lim™”_by‹s_³r_£c
) {

12916 
DBUG_ASSERT
(
rocksdb_¿‹_lim™”
 !ğ
nuÎ±r
);

12917 
rocksdb_¿‹_lim™”_by‹s_³r_£c
 = 
Ãw_v®
;

12918 
rocksdb_¿‹_lim™”
->
S‘By‹sP”SecÚd
(
Ãw_v®
);

12922 
rocksdb_£t_s¡_mgr_¿‹_by‹s_³r_£c
(

12923 
my_cÜe
::
THD
 *cÚ¡ 
thd
,

12924 
my_cÜe
::
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

12925 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
) {

12926 
RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

12928 cÚ¡ 
ušt64_t
 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ ušt64_ˆ*>(
§ve
);

12930 ià(
Ãw_v®
 !ğ
rocksdb_s¡_mgr_¿‹_by‹s_³r_£c
) {

12931 
rocksdb_s¡_mgr_¿‹_by‹s_³r_£c
 = 
Ãw_v®
;

12933 
rocksdb_db_İtiÚs
->
s¡_fe_mªag”
->
S‘D–‘eR©eBy‹sP”SecÚd
(

12934 
rocksdb_s¡_mgr_¿‹_by‹s_³r_£c
);

12937 
RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

12940 
	$rocksdb_£t_d–ayed_wr™e_¿‹
(
THD
 *
thd
, 
¡_mysql_sys_v¬
 *
v¬
,

12941 *
v¬_±r
, cÚ¡ *
§ve
) {

12942 
	`RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

12943 cÚ¡ 
ušt64_t
 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ ušt64_ˆ*>(
§ve
);

12944 ià(
rocksdb_d–ayed_wr™e_¿‹
 !ğ
Ãw_v®
) {

12945 
rocksdb_d–ayed_wr™e_¿‹
 = 
Ãw_v®
;

12946 
rocksdb
::
Stus
 
s
 =

12947 
rdb
->
	`S‘DBO±iÚs
({{"d–ayed_wr™e_¿‹", 
¡d
::
	`to_¡ršg
(
Ãw_v®
)}});

12949 ià(!
s
.
	`ok
()) {

12951 
	`sql_´št_w¬nšg
("MyRocks: failedo update delayed_write_rate. "

12953 
s
.
	`code
(), s.
	`ToSŒšg
().
	`c_¡r
());

12956 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

12957 
	}
}

12959 
	$rocksdb_£t_max_Ï‹¡_d—dlocks
(
THD
 *
thd
, 
¡_mysql_sys_v¬
 *
v¬
,

12960 *
v¬_±r
, cÚ¡ *
§ve
) {

12961 
	`RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

12962 cÚ¡ 
ušt32_t
 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ ušt32_ˆ*>(
§ve
);

12963 ià(
rocksdb_max_Ï‹¡_d—dlocks
 !ğ
Ãw_v®
) {

12964 
rocksdb_max_Ï‹¡_d—dlocks
 = 
Ãw_v®
;

12965 
rdb
->
	`S‘D—dlockInfoBufãrSize
(
rocksdb_max_Ï‹¡_d—dlocks
);

12967 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

12968 
	}
}

12970 
	$rdb_£t_cŞÏtiÚ_exû±iÚ_li¡
(cÚ¡ *cÚ¡ 
exû±iÚ_li¡
) {

12971 
	`DBUG_ASSERT
(
rdb_cŞÏtiÚ_exû±iÚs
 !ğ
nuÎ±r
);

12973 ià(!
rdb_cŞÏtiÚ_exû±iÚs
->
	`£t_·‰”ns
(
exû±iÚ_li¡
)) {

12974 
my_cÜe
::
	`w¬n_about_bad_·‰”ns
(
rdb_cŞÏtiÚ_exû±iÚs
,

12977 
	}
}

12979 
	$rocksdb_£t_cŞÏtiÚ_exû±iÚ_li¡
(
THD
 *cÚ¡ 
thd
,

12980 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
,

12981 *cÚ¡ 
v¬_±r
,

12982 cÚ¡ *cÚ¡ 
§ve
) {

12983 cÚ¡ *cÚ¡ 
v®
 = *
¡©ic_ÿ¡
<cÚ¡ *cÚ¡ *>(
§ve
);

12985 
	`rdb_£t_cŞÏtiÚ_exû±iÚ_li¡
(
v®
 =ğ
nuÎ±r
 ? "" : val);

12987 *
¡©ic_ÿ¡
<cÚ¡ **>(
v¬_±r
èğ
v®
;

12988 
	}
}

12990 
	$mysql_v®ue_to_boŞ
(
¡_mysql_v®ue
 *
v®ue
, 
my_boŞ
 *
»tuº_v®ue
) {

12991 
Ãw_v®ue_ty³
 = 
v®ue
->
	`v®ue_ty³
(value);

12992 ià(
Ãw_v®ue_ty³
 =ğ
MYSQL_VALUE_TYPE_STRING
) {

12993 
buf
[16];

12994 
Ën
 = (
buf
);

12995 cÚ¡ *
¡r
 = 
v®ue
->
	`v®_¡r
(v®ue, 
buf
, &
Ën
);

12996 ià(
¡r
 && (
	`my_¡rÿ£cmp
(
sy¡em_ch¬£t_šfo
, "true", str) == 0 ||

12997 
	`my_¡rÿ£cmp
(
sy¡em_ch¬£t_šfo
, "Ú", 
¡r
) == 0)) {

12998 *
»tuº_v®ue
 = 
TRUE
;

12999 } ià(
¡r
 && (
	`my_¡rÿ£cmp
(
sy¡em_ch¬£t_šfo
, "false", str) == 0 ||

13000 
	`my_¡rÿ£cmp
(
sy¡em_ch¬£t_šfo
, "off", 
¡r
) == 0)) {

13001 *
»tuº_v®ue
 = 
FALSE
;

13005 } ià(
Ãw_v®ue_ty³
 =ğ
MYSQL_VALUE_TYPE_INT
) {

13006 
štbuf
;

13007 
v®ue
->
	`v®_št
(v®ue, &
štbuf
);

13008 ià(
štbuf
 > 1)

13010 *
»tuº_v®ue
 = 
štbuf
 > 0 ? 
TRUE
 : 
FALSE
;

13016 
	}
}

13018 
rocksdb_check_bulk_lßd
(

13019 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

13020 *
§ve
, 
¡_mysql_v®ue
 *
v®ue
) {

13021 
my_boŞ
 
Ãw_v®ue
;

13022 ià(
mysql_v®ue_to_boŞ
(
v®ue
, &
Ãw_v®ue
) != 0) {

13026 
Rdb_Œª§ùiÚ
 *&
tx
 = 
g‘_tx_äom_thd
(
thd
);

13027 ià(
tx
 !ğ
nuÎ±r
) {

13028 cÚ¡ 
rc
 = 
tx
->
fšish_bulk_lßd
();

13029 ià(
rc
 != 0) {

13031 
sql_´št_”rÜ
("RocksDB: Error %d finalizing†ast SST file while "

13033 
rc
);

13034 
THDVAR
(
thd
, 
bulk_lßd
) = 0;

13039 *
¡©ic_ÿ¡
<
boŞ
 *>(
§ve
èğ
Ãw_v®ue
;

13043 
rocksdb_check_bulk_lßd_®low_unsÜ‹d
(

13044 
THD
 *cÚ¡ 
thd
, 
¡_mysql_sys_v¬
 *
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

13045 *
§ve
, 
¡_mysql_v®ue
 *
v®ue
) {

13046 
my_boŞ
 
Ãw_v®ue
;

13047 ià(
mysql_v®ue_to_boŞ
(
v®ue
, &
Ãw_v®ue
) != 0) {

13051 ià(
THDVAR
(
thd
, 
bulk_lßd
)) {

13052 
my_”rÜ
(
ER_ERROR_WHEN_EXECUTING_COMMAND
, 
MYF
(0), "SET",

13058 *
¡©ic_ÿ¡
<
boŞ
 *>(
§ve
èğ
Ãw_v®ue
;

13062 
	$rocksdb_£t_max_background_jobs
(
THD
 *
thd
,

13063 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
,

13064 *cÚ¡ 
v¬_±r
,

13065 cÚ¡ *cÚ¡ 
§ve
) {

13066 
	`DBUG_ASSERT
(
§ve
 !ğ
nuÎ±r
);

13067 
	`DBUG_ASSERT
(
rocksdb_db_İtiÚs
 !ğ
nuÎ±r
);

13068 
	`DBUG_ASSERT
(
rocksdb_db_İtiÚs
->
’v
 !ğ
nuÎ±r
);

13070 
	`RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13072 cÚ¡ 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ *>(
§ve
);

13074 ià(
rocksdb_db_İtiÚs
->
max_background_jobs
 !ğ
Ãw_v®
) {

13075 
rocksdb_db_İtiÚs
->
max_background_jobs
 = 
Ãw_v®
;

13076 
rocksdb
::
Stus
 
s
 =

13077 
rdb
->
	`S‘DBO±iÚs
({{"max_background_jobs", 
¡d
::
	`to_¡ršg
(
Ãw_v®
)}});

13079 ià(!
s
.
	`ok
()) {

13081 
	`sql_´št_w¬nšg
("MyRocks: failedo update max_background_jobs. "

13083 
s
.
	`code
(), s.
	`ToSŒšg
().
	`c_¡r
());

13087 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13088 
	}
}

13090 
rocksdb_£t_by‹s_³r_sync
(

13091 
THD
 *
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

13092 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

13093 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
) {

13094 
DBUG_ASSERT
(
§ve
 !ğ
nuÎ±r
);

13095 
DBUG_ASSERT
(
rocksdb_db_İtiÚs
 !ğ
nuÎ±r
);

13096 
DBUG_ASSERT
(
rocksdb_db_İtiÚs
->
’v
 !ğ
nuÎ±r
);

13098 
RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13100 cÚ¡ 
ulÚglÚg
 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ ulÚglÚg *>(
§ve
);

13102 ià(
rocksdb_db_İtiÚs
->
by‹s_³r_sync
 !ğ
Ãw_v®
) {

13103 
rocksdb_db_İtiÚs
->
by‹s_³r_sync
 = 
Ãw_v®
;

13104 
rocksdb
::
Stus
 
s
 =

13105 
rdb
->
S‘DBO±iÚs
({{"by‹s_³r_sync", 
¡d
::
to_¡ršg
(
Ãw_v®
)}});

13107 ià(!
s
.
ok
()) {

13109 
sql_´št_w¬nšg
("MyRocks: failedo update max_background_jobs. "

13111 
s
.
code
(), s.
ToSŒšg
().
c_¡r
());

13115 
RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13118 
rocksdb_£t_w®_by‹s_³r_sync
(

13119 
THD
 *
thd
 
MY_ATTRIBUTE
((
__unu£d__
)),

13120 
¡_mysql_sys_v¬
 *cÚ¡ 
v¬
 
MY_ATTRIBUTE
((
__unu£d__
)),

13121 *cÚ¡ 
v¬_±r
 
MY_ATTRIBUTE
((
__unu£d__
)), cÚ¡ *cÚ¡ 
§ve
) {

13122 
DBUG_ASSERT
(
§ve
 !ğ
nuÎ±r
);

13123 
DBUG_ASSERT
(
rocksdb_db_İtiÚs
 !ğ
nuÎ±r
);

13124 
DBUG_ASSERT
(
rocksdb_db_İtiÚs
->
’v
 !ğ
nuÎ±r
);

13126 
RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13128 cÚ¡ 
ulÚglÚg
 
Ãw_v®
 = *
¡©ic_ÿ¡
<cÚ¡ ulÚglÚg *>(
§ve
);

13130 ià(
rocksdb_db_İtiÚs
->
w®_by‹s_³r_sync
 !ğ
Ãw_v®
) {

13131 
rocksdb_db_İtiÚs
->
w®_by‹s_³r_sync
 = 
Ãw_v®
;

13132 
rocksdb
::
Stus
 
s
 =

13133 
rdb
->
S‘DBO±iÚs
({{"w®_by‹s_³r_sync", 
¡d
::
to_¡ršg
(
Ãw_v®
)}});

13135 ià(!
s
.
ok
()) {

13137 
sql_´št_w¬nšg
("MyRocks: failedo update max_background_jobs. "

13139 
s
.
code
(), s.
ToSŒšg
().
c_¡r
());

13143 
RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13147 
	$rocksdb_v®id©e_upd©e_cf_İtiÚs
(
THD
 * ,

13148 
¡_mysql_sys_v¬
 * ,

13149 *
§ve
, 
¡_mysql_v®ue
 *
v®ue
) {

13151 
buff
[
STRING_BUFFER_USUAL_SIZE
];

13152 cÚ¡ *
¡r
;

13153 
Ëngth
;

13154 
Ëngth
 = (
buff
);

13155 
¡r
 = 
v®ue
->
	`v®_¡r
(v®ue, 
buff
, &
Ëngth
);

13156 *(cÚ¡ **)
§ve
 = 
¡r
;

13158 ià(
¡r
 =ğ
nuÎ±r
) {

13159  
HA_EXIT_SUCCESS
;

13162 
Rdb_cf_İtiÚs
::
Name_to_cÚfig_t
 
İtiÚ_m­
;

13166 ià(!
Rdb_cf_İtiÚs
::
	`·r£_cf_İtiÚs
(
¡r
, &
İtiÚ_m­
)) {

13167 
	`my_”rÜ
(
ER_WRONG_VALUE_FOR_VAR
, 
	`MYF
(0), "rocksdb_upd©e_cf_İtiÚs", 
¡r
);

13168  
HA_EXIT_FAILURE
;

13170  
HA_EXIT_SUCCESS
;

13171 
	}
}

13174 
	$rocksdb_£t_upd©e_cf_İtiÚs
(
THD
 *const ,

13175 
¡_mysql_sys_v¬
 *const ,

13176 *cÚ¡ 
v¬_±r
, cÚ¡ *cÚ¡ 
§ve
) {

13177 cÚ¡ *cÚ¡ 
v®
 = *
¡©ic_ÿ¡
<cÚ¡ *cÚ¡ *>(
§ve
);

13179 
	`RDB_MUTEX_LOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13181 ià(!
v®
) {

13182 *
»š‹½»t_ÿ¡
<**>(
v¬_±r
èğ
nuÎ±r
;

13183 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13187 
	`DBUG_ASSERT
(
v®
 !ğ
nuÎ±r
);

13192 *
»š‹½»t_ÿ¡
<**>(
v¬_±r
èğ
	`my_¡rdup
(
v®
, 
	`MYF
(0));

13195 
Rdb_cf_İtiÚs
::
Name_to_cÚfig_t
 
İtiÚ_m­
;

13198 ià(!
Rdb_cf_İtiÚs
::
	`·r£_cf_İtiÚs
(
v®
, &
İtiÚ_m­
)) {

13199 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13204 cÚ¡‡utØ&
cf_Çme
 : 
cf_mªag”
.
	`g‘_cf_Çmes
()) {

13205 
	`DBUG_ASSERT
(!
cf_Çme
.
	`em±y
());

13207 
rocksdb
::
CŞumnFamyHªdË
 *
cfh
 = 
cf_mªag”
.
	`g‘_cf
(
cf_Çme
);

13208 
	`DBUG_ASSERT
(
cfh
 !ğ
nuÎ±r
);

13210 cÚ¡‡utØ
™
 = 
İtiÚ_m­
.
	`fšd
(
cf_Çme
);

13211 
¡d
::
¡ršg
 
³r_cf_İtiÚs
 = (
™
 !ğ
İtiÚ_m­
.
	`’d
()è? it->
£cÚd
 : "";

13213 ià(!
³r_cf_İtiÚs
.
	`em±y
()) {

13214 
Rdb_cf_İtiÚs
::
Name_to_cÚfig_t
 
İt_m­
;

13215 
rocksdb
::
Stus
 
s
 =„ocksdb::
	`SŒšgToM­
(
³r_cf_İtiÚs
, &
İt_m­
);

13217 ià(
s
 !ğ
rocksdb
::
Stus
::
	`OK
()) {

13219 
	`sql_´št_w¬nšg
("MyRocks: failedo converthe options for column "

13220 "çmy '%s'Ø¨m­. %s", 
cf_Çme
.
	`c_¡r
(),

13221 
s
.
	`ToSŒšg
().
	`c_¡r
());

13223 
	`DBUG_ASSERT
(
rdb
 !ğ
nuÎ±r
);

13226 
s
 = 
rdb
->
	`S‘O±iÚs
(
cfh
, 
İt_m­
);

13228 ià(
s
 !ğ
rocksdb
::
Stus
::
	`OK
()) {

13230 
	`sql_´št_w¬nšg
("MyRocks: failedo‡pplyhe options for column "

13231 "çmy '%s'. %s", 
cf_Çme
.
	`c_¡r
(),

13232 
s
.
	`ToSŒšg
().
	`c_¡r
());

13235 
	`sql_´št_šfÜm©iÚ
("MyRocks: options for column family '%s' "

13237 
cf_Çme
.
	`c_¡r
());

13243 
rocksdb
::
CŞumnFamyO±iÚs
 
cf_İtiÚs
 = 
rdb
->
	`G‘O±iÚs
(
cfh
);

13244 
¡d
::
¡ršg
 
upd©ed_İtiÚs
;

13246 
s
 = 
rocksdb
::
	`G‘SŒšgFromCŞumnFamyO±iÚs
(&
upd©ed_İtiÚs
,

13247 
cf_İtiÚs
);

13249 
	`DBUG_ASSERT
(
s
 =ğ
rocksdb
::
Stus
::
	`OK
());

13250 
	`DBUG_ASSERT
(!
upd©ed_İtiÚs
.
	`em±y
());

13252 
cf_mªag”
.
	`upd©e_İtiÚs_m­
(
cf_Çme
, 
upd©ed_İtiÚs
);

13261 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_sysv¬s_mu‹x
);

13262 
	}
}

13264 
	$rdb_queue_§ve_¡©s_»que¡
(è{ 
rdb_bg_th»ad
.
	`»que¡_§ve_¡©s
(); 
	}
}

13266 
ha_rocksdb
::
	$½l_befÜe_d–‘e_rows
() {

13267 
	`DBUG_ENTER_FUNC
();

13269 
m_š_½l_d–‘e_rows
 = 
Œue
;

13271 
DBUG_VOID_RETURN
;

13272 
	}
}

13274 
ha_rocksdb
::
	$½l_aá”_d–‘e_rows
() {

13275 
	`DBUG_ENTER_FUNC
();

13277 
m_š_½l_d–‘e_rows
 = 
çl£
;

13279 
DBUG_VOID_RETURN
;

13280 
	}
}

13282 
ha_rocksdb
::
	$½l_befÜe_upd©e_rows
() {

13283 
	`DBUG_ENTER_FUNC
();

13285 
m_š_½l_upd©e_rows
 = 
Œue
;

13287 
DBUG_VOID_RETURN
;

13288 
	}
}

13290 
ha_rocksdb
::
	$½l_aá”_upd©e_rows
() {

13291 
	`DBUG_ENTER_FUNC
();

13293 
m_š_½l_upd©e_rows
 = 
çl£
;

13295 
DBUG_VOID_RETURN
;

13296 
	}
}

13305 
boŞ
 
ha_rocksdb
::
	$u£_»ad_ä“_½l
() {

13306 
	`DBUG_ENTER_FUNC
();

13308 
	`DBUG_RETURN
((
m_š_½l_d–‘e_rows
 || 
m_š_½l_upd©e_rows
) &&

13309 !
	`has_hidd’_pk
(
bË
è&& 
m_u£_»ad_ä“_½l
);

13310 
	}
}

13312 
ha_rocksdb
::
	$»ad_time
(
ušt
 
šdex
, ušˆ
¿nges
, 
ha_rows
 
rows
) {

13313 
	`DBUG_ENTER_FUNC
();

13315 ià(
šdex
 !ğ
bË
->
s
->
´im¬y_key
) {

13317 
	`DBUG_RETURN
(
hªdËr
::
	`»ad_time
(
šdex
, 
¿nges
, 
rows
));

13320 
	`DBUG_RETURN
((
rows
 / 20.0) + 1);

13321 
	}
}

13323 
¡d
::
¡ršg
 
	$rdb_cÜru±iÚ_m¬k”_fe_Çme
() {

13324 
¡d
::
¡ršg
 
	`»t
(
rocksdb_d©adœ
);

13325 
»t
.
	`­³nd
("/ROCKSDB_CORRUPTED");

13326  
»t
;

13327 
	}
}

13337 
¡_mysql_¡Üage_’gše
 
rocksdb_¡Üage_’gše
 = {

13338 
MYSQL_HANDLERTON_INTERFACE_VERSION
};

13340 
	$mysql_deş¬e_¶ugš
(
rocksdb_£
){

13341 
MYSQL_STORAGE_ENGINE_PLUGIN
,

13342 &
rocksdb_¡Üage_’gše
,

13346 
PLUGIN_LICENSE_GPL
,

13347 
myrocks
::
rocksdb_š™_func
,

13348 
myrocks
::
rocksdb_dÚe_func
,

13350 
myrocks
::
rocksdb_¡©us_v¬s
,

13351 
myrocks
::
rocksdb_sy¡em_v¬ŸbËs
,

13352 
nuÎ±r
,

13354 
	}
},

13355 
	gmyrocks
::
rdb_i_s_cf¡©s
, myrocks::
rdb_i_s_db¡©s
,

13356 
	gmyrocks
::
rdb_i_s_³rf_cÚ‹xt
, myrocks::
rdb_i_s_³rf_cÚ‹xt_glob®
,

13357 
	gmyrocks
::
rdb_i_s_cfİtiÚs
, myrocks::
rdb_i_s_com·ù_¡©s
,

13358 
	gmyrocks
::
rdb_i_s_glob®_šfo
, myrocks::
rdb_i_s_ddl
,

13359 
	gmyrocks
::
rdb_i_s_šdex_fe_m­
, myrocks::
rdb_i_s_lock_šfo
,

13360 
	gmyrocks
::
rdb_i_s_Œx_šfo
, myrocks::
rdb_i_s_d—dlock_šfo
 
mysql_deş¬e_¶ugš_’d
;

	@ha_rocksdb.h

16 #´agm¨
Úû


18 #ifdeà
USE_PRAGMA_INTERFACE


19 #´agm¨
š‹rçû


23 
	~<£t
>

24 
	~<¡ršg
>

25 
	~<unÜd”ed_m­
>

26 
	~<unÜd”ed_£t
>

27 
	~<veùÜ
>

30 
	~"hªdËr.h
"

31 
	~"my_glob®.h
"

32 
	~"sql_¡ršg.h
"

33 
	~"ut0couÁ”.h
"

36 
	~"rocksdb/ÿche.h
"

37 
	~"rocksdb/m”ge_İ”©Ü.h
"

38 
	~"rocksdb/³rf_cÚ‹xt.h
"

39 
	~"rocksdb/s¡_fe_mªag”.h
"

40 
	~"rocksdb/¡©i¡ics.h
"

41 
	~"rocksdb/ut™›s/İtiÚs_ut.h
"

42 
	~"rocksdb/ut™›s/Œª§ùiÚ_db.h
"

43 
	~"rocksdb/ut™›s/wr™e_b©ch_w™h_šdex.h
"

46 
	~"rdb_com·¿tÜ.h
"

47 
	~"rdb_šdex_m”ge.h
"

48 
	~"rdb_io_w©chdog.h
"

49 
	~"rdb_³rf_cÚ‹xt.h
"

50 
	~"rdb_s¡_šfo.h
"

51 
	~"rdb_uts.h
"

67 
Çme¥aû
 
	gmyrocks
 {

73 
	sRdb_Œx_šfo
 {

74 
	g¡d
::
¡ršg
 
Çme
;

75 
ulÚglÚg
 
	gŒx_id
;

76 
ulÚglÚg
 
	gwr™e_couÁ
;

77 
ulÚglÚg
 
	glock_couÁ
;

78 
	gtimeout_£c
;

79 
	g¡d
::
¡ršg
 
¡©e
;

80 
	g¡d
::
¡ršg
 
wa™šg_key
;

81 
ulÚglÚg
 
	gwa™šg_cf_id
;

82 
	gis_»¶iÿtiÚ
;

83 
	gsk_Œx_­i
;

84 
	g»ad_Úly
;

85 
	gd—dlock_d‘eù
;

86 
	gnum_Úgošg_bulk_lßd
;

87 
ulÚg
 
	gth»ad_id
;

88 
	g¡d
::
¡ršg
 
qu”y_¡r
;

91 
	g¡d
::
veùÜ
<
Rdb_Œx_šfo
> 
rdb_g‘_®l_Œx_šfo
();

97 
	sRdb_d—dlock_šfo
 {

98 
	sRdb_dl_Œx_šfo
 {

99 
ulÚglÚg
 
	gŒx_id
;

100 
	g¡d
::
¡ršg
 
cf_Çme
;

101 
	g¡d
::
¡ršg
 
wa™šg_key
;

102 
boŞ
 
	gexşusive_lock
;

103 
	g¡d
::
¡ršg
 
šdex_Çme
;

104 
	g¡d
::
¡ršg
 
bË_Çme
;

106 
	g¡d
::
veùÜ
 <
Rdb_dl_Œx_šfo
> 
·th
;

107 
ulÚglÚg
 
	gviùim_Œx_id
;

110 
	g¡d
::
veùÜ
<
Rdb_d—dlock_šfo
> 
rdb_g‘_d—dlock_šfo
();

119 cÚ¡ 
¡d
::
¡ršg
 
DEFAULT_CF_NAME
;

124 cÚ¡ 
¡d
::
¡ršg
 
DEFAULT_SYSTEM_CF_NAME
;

129 cÚ¡ *cÚ¡ 
	gHIDDEN_PK_NAME
 = "HIDDEN_PK_ID";

135 cÚ¡ 
¡d
::
¡ršg
 
PER_INDEX_CF_NAME
;

140 cÚ¡ *cÚ¡ 
	gBG_THREAD_NAME
 = "myrocks-bg";

145 cÚ¡ *cÚ¡ 
	gINDEX_THREAD_NAME
 = "myrocks-index";

153 cÚ¡ 
	gRDB_PER_PARTITION_QUALIFIER_NAME_SEP
 = '_';

161 cÚ¡ 
	gRDB_QUALIFIER_VALUE_SEP
 = '=';

168 cÚ¡ 
	gRDB_QUALIFIER_SEP
 = ';';

173 cÚ¡ *cÚ¡ 
	gRDB_CF_NAME_QUALIFIER
 = "cfname";

178 cÚ¡ *cÚ¡ 
	gRDB_TTL_DURATION_QUALIFIER
 = "ttl_duration";

183 cÚ¡ *cÚ¡ 
	gRDB_TTL_COL_QUALIFIER
 = "ttl_col";

189 
	#RDB_DEFAULT_TBL_STATS_SAMPLE_PCT
 10

	)

190 
	#RDB_TBL_STATS_SAMPLE_PCT_MIN
 1

	)

191 
	#RDB_TBL_STATS_SAMPLE_PCT_MAX
 100

	)

197 
	#DEFAULT_COMPACTION_SEQUENTIAL_DELETES
 0

	)

198 
	#MAX_COMPACTION_SEQUENTIAL_DELETES
 2000000

	)

200 
	#DEFAULT_COMPACTION_SEQUENTIAL_DELETES_WINDOW
 0

	)

201 
	#MAX_COMPACTION_SEQUENTIAL_DELETES_WINDOW
 2000000

	)

213 
	#MAX_BACKGROUND_JOBS
 64

	)

215 
	#DEFAULT_SUBCOMPACTIONS
 1

	)

216 
	#MAX_SUBCOMPACTIONS
 64

	)

221 
	#DEFAULT_SST_MGR_RATE_BYTES_PER_SEC
 0

	)

233 
	#RDB_FORMATID_SZ
 8

	)

234 
	#RDB_GTRID_SZ
 1

	)

235 
	#RDB_BQUAL_SZ
 1

	)

236 
	#RDB_XIDHDR_LEN
 (
RDB_FORMATID_SZ
 + 
RDB_GTRID_SZ
 + 
RDB_BQUAL_SZ
)

	)

245 
	#MAX_RATE_LIMITER_BYTES_PER_SEC
 
¡©ic_ÿ¡
<
ušt64_t
>(
LONGLONG_MAX
)

	)

251 
	#ROCKSDB_SIZEOF_HIDDEN_PK_COLUMN
 (
lÚglÚg
)

	)

257 
	#ROCKSDB_SIZEOF_TTL_RECORD
 (
lÚglÚg
)

	)

259 
	#ROCKSDB_SIZEOF_AUTOINC_VALUE
 (
lÚglÚg
)

	)

264 
	#MAX_INDEX_COL_LEN_LARGE
 3072

	)

265 
	#MAX_INDEX_COL_LEN_SMALL
 767

	)

272 
	#HA_ERR_ROCKSDB_FIRST
 (
HA_ERR_LAST
 + 1)

	)

273 
	#HA_ERR_ROCKSDB_PK_REQUIRED
 (
HA_ERR_ROCKSDB_FIRST
 + 0)

	)

274 
	#HA_ERR_ROCKSDB_TABLE_DATA_DIRECTORY_NOT_SUPPORTED
 \

275 (
HA_ERR_ROCKSDB_FIRST
 + 1)

	)

276 
	#HA_ERR_ROCKSDB_TABLE_INDEX_DIRECTORY_NOT_SUPPORTED
 \

277 (
HA_ERR_ROCKSDB_FIRST
 + 2)

	)

278 
	#HA_ERR_ROCKSDB_COMMIT_FAILED
 (
HA_ERR_ROCKSDB_FIRST
 + 3)

	)

279 
	#HA_ERR_ROCKSDB_BULK_LOAD
 (
HA_ERR_ROCKSDB_FIRST
 + 4)

	)

280 
	#HA_ERR_ROCKSDB_CORRUPT_DATA
 (
HA_ERR_ROCKSDB_FIRST
 + 5)

	)

281 
	#HA_ERR_ROCKSDB_CHECKSUM_MISMATCH
 (
HA_ERR_ROCKSDB_FIRST
 + 6)

	)

282 
	#HA_ERR_ROCKSDB_INVALID_TABLE
 (
HA_ERR_ROCKSDB_FIRST
 + 7)

	)

283 
	#HA_ERR_ROCKSDB_PROPERTIES
 (
HA_ERR_ROCKSDB_FIRST
 + 8)

	)

284 
	#HA_ERR_ROCKSDB_MERGE_FILE_ERR
 (
HA_ERR_ROCKSDB_FIRST
 + 9)

	)

289 
	#HA_ERR_ROCKSDB_STATUS_NOT_FOUND
 (
HA_ERR_LAST
 + 10)

	)

290 
	#HA_ERR_ROCKSDB_STATUS_CORRUPTION
 (
HA_ERR_LAST
 + 11)

	)

291 
	#HA_ERR_ROCKSDB_STATUS_NOT_SUPPORTED
 (
HA_ERR_LAST
 + 12)

	)

292 
	#HA_ERR_ROCKSDB_STATUS_INVALID_ARGUMENT
 (
HA_ERR_LAST
 + 13)

	)

293 
	#HA_ERR_ROCKSDB_STATUS_IO_ERROR
 (
HA_ERR_LAST
 + 14)

	)

294 
	#HA_ERR_ROCKSDB_STATUS_NO_SPACE
 (
HA_ERR_LAST
 + 15)

	)

295 
	#HA_ERR_ROCKSDB_STATUS_MERGE_IN_PROGRESS
 (
HA_ERR_LAST
 + 16)

	)

296 
	#HA_ERR_ROCKSDB_STATUS_INCOMPLETE
 (
HA_ERR_LAST
 + 17)

	)

297 
	#HA_ERR_ROCKSDB_STATUS_SHUTDOWN_IN_PROGRESS
 (
HA_ERR_LAST
 + 18)

	)

298 
	#HA_ERR_ROCKSDB_STATUS_TIMED_OUT
 (
HA_ERR_LAST
 + 19)

	)

299 
	#HA_ERR_ROCKSDB_STATUS_ABORTED
 (
HA_ERR_LAST
 + 20)

	)

300 
	#HA_ERR_ROCKSDB_STATUS_LOCK_LIMIT
 (
HA_ERR_LAST
 + 21)

	)

301 
	#HA_ERR_ROCKSDB_STATUS_BUSY
 (
HA_ERR_LAST
 + 22)

	)

302 
	#HA_ERR_ROCKSDB_STATUS_DEADLOCK
 (
HA_ERR_LAST
 + 23)

	)

303 
	#HA_ERR_ROCKSDB_STATUS_EXPIRED
 (
HA_ERR_LAST
 + 24)

	)

304 
	#HA_ERR_ROCKSDB_STATUS_TRY_AGAIN
 (
HA_ERR_LAST
 + 25)

	)

305 
	#HA_ERR_ROCKSDB_LAST
 
HA_ERR_ROCKSDB_STATUS_TRY_AGAIN


	)

314 
	sRdb_bË_hªdËr
 {

315 *
	gm_bË_Çme
;

316 
ušt
 
	gm_bË_Çme_Ëngth
;

317 
	gm_»f_couÁ
;

318 
	g©omic_¡©
<> 
	gm_lock_wa™_timeout_couÁ”
;

319 
	g©omic_¡©
<> 
	gm_d—dlock_couÁ”
;

321 
	gmy_cÜe
::
THR_LOCK
 
m_thr_lock
;

324 
my_io_³rf_©omic_t
 
	gm_io_³rf_»ad
;

325 
my_io_³rf_©omic_t
 
	gm_io_³rf_wr™e
;

326 
Rdb_©omic_³rf_couÁ”s
 
	gm_bË_³rf_cÚ‹xt
;

329 
	g¡d
::
©omic_ušt
 
m_mtÿche_lock
;

330 
ušt64_t
 
	gm_mtÿche_couÁ
;

331 
ušt64_t
 
	gm_mtÿche_size
;

332 
ušt64_t
 
	gm_mtÿche_Ï¡_upd©e
;

335 
şass
 
	gRdb_key_def
;

336 
şass
 
	gRdb_tbl_def
;

337 
şass
 
	gRdb_Œª§ùiÚ
;

338 
şass
 
	gRdb_Œª§ùiÚ_im¶
;

339 
şass
 
	gRdb_wr™eb©ch_im¶
;

340 
şass
 
	gRdb_f›ld_’cod”
;

342 cÚ¡ *cÚ¡ 
	grocksdb_htÚ_Çme
 = "ROCKSDB";

344 
	s_gl_šdex_id_s
 {

345 
ušt32_t
 
	gcf_id
;

346 
ušt32_t
 
	gšdex_id
;

347 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
_gl_šdex_id_s
 &
Ùh”
) const {

348  
cf_id
 =ğ
Ùh”
.cf_id && 
šdex_id
 == other.index_id;

350 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
_gl_šdex_id_s
 &
Ùh”
) const {

351  
cf_id
 !ğ
Ùh”
.cf_id || 
šdex_id
 != other.index_id;

353 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	g_gl_šdex_id_s
 &
	gÙh”
) const {

354  
	gcf_id
 < 
	gÙh”
.cf_id ||

355 (
	gcf_id
 =ğ
Ùh”
.
cf_id
 && 
šdex_id
 < other.index_id);

357 
boŞ
 
	gİ”©Ü
<=(cÚ¡ 
_gl_šdex_id_s
 &
Ùh”
) const {

358  
cf_id
 < 
Ùh”
.cf_id ||

359 (
cf_id
 =ğ
Ùh”
.cf_id && 
šdex_id
 <= other.index_id);

361 
boŞ
 
	gİ”©Ü
>(cÚ¡ 
	g_gl_šdex_id_s
 &
	gÙh”
) const {

362  
	gcf_id
 > 
	gÙh”
.cf_id ||

363 (
	gcf_id
 =ğ
Ùh”
.
cf_id
 && 
šdex_id
 > other.index_id);

365 
boŞ
 
	gİ”©Ü
>=(cÚ¡ 
_gl_šdex_id_s
 &
Ùh”
) const {

366  
cf_id
 > 
Ùh”
.cf_id ||

367 (
cf_id
 =ğ
Ùh”
.cf_id && 
šdex_id
 >= other.index_id);

369 } 
	tGL_INDEX_ID
;

371 
	gİ”©iÚ_ty³
 : {

372 
ROWS_DELETED
 = 0,

373 
	gROWS_INSERTED
,

374 
	gROWS_READ
,

375 
	gROWS_UPDATED
,

376 
	gROWS_DELETED_BLIND
,

377 
	gROWS_EXPIRED
,

378 
	gROWS_FILTERED
,

379 
	gROWS_HIDDEN_NO_SNAPSHOT
,

380 
	gROWS_MAX


383 
	gqu”y_ty³
 : { 
QUERIES_POINT
 = 0, 
	gQUERIES_RANGE
, 
	gQUERIES_MAX
 };

385 #ià
defšed
(
HAVE_SCHED_GETCPU
)

386 
	#RDB_INDEXER
 
g‘_sched_šdex”_t


	)

388 
	#RDB_INDEXER
 
th»ad_id_šdex”_t


	)

392 
	s¡_glob®_¡©s
 {

393 
	gib_couÁ”_t
<
	gulÚglÚg
, 64, 
	gRDB_INDEXER
> 
	grows
[
ROWS_MAX
];

397 
	gib_couÁ”_t
<
	gulÚglÚg
, 64, 
	gRDB_INDEXER
> 
	gsy¡em_rows
[
ROWS_MAX
];

399 
	gib_couÁ”_t
<
	gulÚglÚg
, 64, 
	gRDB_INDEXER
> 
	gqu”›s
[
QUERIES_MAX
];

401 
	gib_couÁ”_t
<
	gulÚglÚg
, 64, 
	gRDB_INDEXER
> 
	gcov”ed_£cÚd¬y_key_lookups
;

405 
	s¡_expÜt_¡©s
 {

406 
ulÚglÚg
 
	grows_d–‘ed
;

407 
ulÚglÚg
 
	grows_š£¹ed
;

408 
ulÚglÚg
 
	grows_»ad
;

409 
ulÚglÚg
 
	grows_upd©ed
;

410 
ulÚglÚg
 
	grows_d–‘ed_blšd
;

411 
ulÚglÚg
 
	grows_expœed
;

412 
ulÚglÚg
 
	grows_f‹»d
;

413 
ulÚglÚg
 
	grows_hidd’_no_¢­shÙ
;

415 
ulÚglÚg
 
	gsy¡em_rows_d–‘ed
;

416 
ulÚglÚg
 
	gsy¡em_rows_š£¹ed
;

417 
ulÚglÚg
 
	gsy¡em_rows_»ad
;

418 
ulÚglÚg
 
	gsy¡em_rows_upd©ed
;

420 
ulÚglÚg
 
	gqu”›s_pošt
;

421 
ulÚglÚg
 
	gqu”›s_¿nge
;

423 
ulÚglÚg
 
	gcov”ed_£cÚd¬y_key_lookups
;

427 
	s¡_memÜy_¡©s
 {

428 
ulÚglÚg
 
	gmembË_tÙ®
;

429 
ulÚglÚg
 
	gmembË_unæushed
;

433 
	s¡_io_¡®l_¡©s
 {

434 
ulÚglÚg
 
	gËv–0_¦owdown
;

435 
ulÚglÚg
 
	gËv–0_¦owdown_w™h_com·ùiÚ
;

436 
ulÚglÚg
 
	gËv–0_numfes
;

437 
ulÚglÚg
 
	gËv–0_numfes_w™h_com·ùiÚ
;

438 
ulÚglÚg
 
	g¡İ_fÜ_³ndšg_com·ùiÚ_by‹s
;

439 
ulÚglÚg
 
	g¦owdown_fÜ_³ndšg_com·ùiÚ_by‹s
;

440 
ulÚglÚg
 
	gmembË_com·ùiÚ
;

441 
ulÚglÚg
 
	gmembË_¦owdown
;

442 
ulÚglÚg
 
	gtÙ®_¡İ
;

443 
ulÚglÚg
 
	gtÙ®_¦owdown
;

445 
¡_io_¡®l_¡©s
()

446 : 
Ëv–0_¦owdown
(0), 
Ëv–0_¦owdown_w™h_com·ùiÚ
(0),

447 
Ëv–0_numfes
(0), 
Ëv–0_numfes_w™h_com·ùiÚ
(0),

448 
¡İ_fÜ_³ndšg_com·ùiÚ_by‹s
(0),

449 
¦owdown_fÜ_³ndšg_com·ùiÚ_by‹s
(0), 
membË_com·ùiÚ
(0),

450 
membË_¦owdown
(0), 
tÙ®_¡İ
(0), 
tÙ®_¦owdown
(0) {}

455 
	~"rdb_buff.h
"

458 
Çme¥aû
 
	g¡d
 {

459 
	g‹m¶©e
 <> 
	ghash
<
	gmyrocks
::
GL_INDEX_ID
> {

460 
¡d
::
size_t
 
İ”©Ü
()(cÚ¡ 
myrocks
::
GL_INDEX_ID
 &
gl_šdex_id
) const {

461 cÚ¡ 
ušt64_t
 
v®
 =

462 ((
ušt64_t
)
gl_šdex_id
.
cf_id
 << 32 | (ušt64_t)gl_šdex_id.
šdex_id
);

463  
	g¡d
::
hash
<
ušt64_t
>()(
v®
);

468 
Çme¥aû
 
	gmyrocks
 {

475 şas 
	cha_rocksdb
 : 
public
 
my_cÜe
::
hªdËr
 {

476 
my_cÜe
::
THR_LOCK_DATA
 
m_db_lock
;

478 
Rdb_bË_hªdËr
 *
	gm_bË_hªdËr
;

481 
	grocksdb
::
I‹¿tÜ
 *
m_sÿn_™
;

484 
boŞ
 
	gm_sÿn_™_sks_bloom
;

486 cÚ¡ 
	grocksdb
::
SÇpshÙ
 *
m_sÿn_™_¢­shÙ
;

489 
uch¬
 *
	gm_sÿn_™_low”_bound
;

490 
uch¬
 *
	gm_sÿn_™_uµ”_bound
;

491 
	grocksdb
::
Sliû
 
m_sÿn_™_low”_bound_¦iû
;

492 
	grocksdb
::
Sliû
 
m_sÿn_™_uµ”_bound_¦iû
;

494 
Rdb_tbl_def
 *
	gm_tbl_def
;

497 
	g¡d
::
sh¬ed_±r
<
Rdb_key_def
> 
m_pk_desü
;

500 
	g¡d
::
sh¬ed_±r
<
Rdb_key_def
> *
m_key_desü_¬r
;

502 
boŞ
 
check_key»ad_®lowed
(
ušt
 
šx
, ušˆ
·¹
, boŞ 
®l_·¹s
) const;

508 
ušt
 
	gm_pk_key_·¹s
;

513 
mubË
 
boŞ
 
	gm_pk_ÿn_be_decoded
;

518 
boŞ
 
	gm_maybe_uÅack_šfo
;

520 
uch¬
 *
	gm_pk_tu¶e
;

521 
uch¬
 *
	gm_pk_·cked_tu¶e
;

528 
uch¬
 *
	gm_sk_·cked_tu¶e
;

534 
uch¬
 *
	gm_’d_key_·cked_tu¶e
;

536 
Rdb_¡ršg_wr™”
 
	gm_sk_s
;

537 
Rdb_¡ršg_wr™”
 
	gm_pk_uÅack_šfo
;

543 
uch¬
 *
	gm_sk_m©ch_´efix
;

544 
ušt
 
	gm_sk_m©ch_Ëngth
;

547 
uch¬
 *
	gm_sk_m©ch_´efix_buf
;

550 
uch¬
 *
	gm_sk_·cked_tu¶e_Şd
;

551 
Rdb_¡ršg_wr™”
 
	gm_sk_s_Şd
;

554 
uch¬
 *
	gm_dup_sk_·cked_tu¶e
;

555 
uch¬
 *
	gm_dup_sk_·cked_tu¶e_Şd
;

561 
uch¬
 *
	gm_·ck_bufãr
;

566 
	gm_‰l_by‹s
[
ROCKSDB_SIZEOF_TTL_RECORD
];

572 
boŞ
 
	gm_‰l_by‹s_upd©ed
;

575 
SŒšg
 
	gm_Ï¡_rowkey
;

578 
SŒšg
 
	gm_¡Üage_»cÜd
;

586 
	grocksdb
::
PšÇbËSliû
 
m_»Œ›ved_»cÜd
;

589 ’um { 
	gRDB_LOCK_NONE
, 
	gRDB_LOCK_READ
, 
	gRDB_LOCK_WRITE
 } 
	gm_lock_rows
;

592 
boŞ
 
	gm_key»ad_Úly
;

594 
boŞ
 
	gm_sk_sÿn_™_Ãxt_ÿÎ
;

597 
boŞ
 
	gm_ºd_sÿn_is_Ãw_¢­shÙ
;

600 
boŞ
 
	gm_u£_»ad_ä“_½l
;

606 
boŞ
 
	gm_sk_unique_check
;

615 
	gmy_cÜe
::
key_m­
 
m_upd©e_scİe
;

616 
boŞ
 
	gm_upd©e_scİe_is_v®id
;

619 
	g¡d
::
sh¬ed_±r
<
Rdb_s¡_šfo
> 
m_s¡_šfo
;

624 
	gm_duµ_”rkey
;

626 
ü—‹_key_defs
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

627 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

628 cÚ¡ 
TABLE
 *cÚ¡ 
Şd_bË_¬g
 = 
nuÎ±r
,

629 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
Şd_tbl_def_¬g
 = 
nuÎ±r
) const

630 
MY_ATTRIBUTE
((
__nÚnuÎ__
(2, 3), 
__w¬n_unu£d_»suÉ__
));

631 
£cÚd¬y_šdex_»ad
(cÚ¡ 
keyno
, 
uch¬
 *cÚ¡ 
buf
)

632 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

633 
£tup_™”©Ü_fÜ_ºd_sÿn
();

634 
boŞ
 
is_asûndšg
(cÚ¡ 
Rdb_key_def
 &
keydef
,

635 
ha_rkey_funùiÚ
 
fšd_æag
) const

636 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

637 
£tup_™”©Ü_bounds
(cÚ¡ 
Rdb_key_def
 &
kd
,

638 cÚ¡ 
rocksdb
::
Sliû
 &
eq_cÚd
, 
size_t
 
bound_Ën
,

639 
uch¬
 *cÚ¡ 
low”_bound
, uch¬ *cÚ¡ 
uµ”_bound
,

640 
rocksdb
::
Sliû
 *
low”_bound_¦iû
,

641 
rocksdb
::
Sliû
 *
uµ”_bound_¦iû
);

642 
boŞ
 
ÿn_u£_bloom_f‹r
(
THD
 *
thd
, cÚ¡ 
Rdb_key_def
 &
kd
,

643 cÚ¡ 
rocksdb
::
Sliû
 &
eq_cÚd
,

644 cÚ¡ 
boŞ
 
u£_®l_keys
);

645 
boŞ
 
check_bloom_ªd_£t_bounds
(
THD
 *
thd
, cÚ¡ 
Rdb_key_def
 &
kd
,

646 cÚ¡ 
rocksdb
::
Sliû
 &
eq_cÚd
,

647 cÚ¡ 
boŞ
 
u£_®l_keys
, 
size_t
 
bound_Ën
,

648 
uch¬
 *cÚ¡ 
low”_bound
,

649 
uch¬
 *cÚ¡ 
uµ”_bound
,

650 
rocksdb
::
Sliû
 *
low”_bound_¦iû
,

651 
rocksdb
::
Sliû
 *
uµ”_bound_¦iû
);

652 
£tup_sÿn_™”©Ü
(cÚ¡ 
Rdb_key_def
 &
kd
, 
rocksdb
::
Sliû
 *
¦iû
,

653 cÚ¡ 
boŞ
 
u£_®l_keys
, cÚ¡ 
ušt
 
eq_cÚd_Ën
)

654 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

655 
»Ëa£_sÿn_™”©Ü
();

657 
	grocksdb
::
Stus


658 
g‘_fÜ_upd©e
(
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
,

659 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cŞumn_çmy
,

660 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

661 
rocksdb
::
PšÇbËSliû
 *
v®ue
) const;

663 
g‘_row_by_rowid
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ *cÚ¡ 
rowid
,

664 cÚ¡ 
ušt
 
rowid_size
, cÚ¡ 
boŞ
 
sk_lookup
 = 
çl£
,

665 cÚ¡ 
boŞ
 
sk_‰l_check
 = 
Œue
)

666 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

667 
g‘_row_by_rowid
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ uch¬ *cÚ¡ 
rowid
,

668 cÚ¡ 
ušt
 
rowid_size
, cÚ¡ 
boŞ
 
sk_lookup
 = 
çl£
,

669 cÚ¡ 
boŞ
 
sk_‰l_check
 = 
Œue
)

670 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
)) {

671  
g‘_row_by_rowid
(
buf
, 
»š‹½»t_ÿ¡
<cÚ¡ *>(
rowid
),

672 
rowid_size
, 
sk_lookup
, 
sk_‰l_check
);

675 
lßd_auto_šü_v®ue
();

676 
ulÚglÚg
 
lßd_auto_šü_v®ue_äom_šdex
();

677 
upd©e_auto_šü_v®
(
ulÚglÚg
 
v®
);

678 
upd©e_auto_šü_v®_äom_f›ld
();

679 
	grocksdb
::
Stus
 
g‘_d©adic_auto_šü
(
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
,

680 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

681 
ulÚglÚg
 *
Ãw_v®
) const;

682 
lÚglÚg
 
upd©e_hidd’_pk_v®
();

683 
lßd_hidd’_pk_v®ue
(è
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

684 
»ad_hidd’_pk_id_äom_rowkey
(
lÚglÚg
 *cÚ¡ 
hidd’_pk_id
)

685 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

686 
boŞ
 
ÿn_u£_sšgË_d–‘e
(cÚ¡ 
ušt
 &
šdex
) const

687 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

688 
boŞ
 
is_blšd_d–‘e_’abËd
();

689 
boŞ
 
sk_unique_check
(ècÚ¡ 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

690 
£t_fÜû_sk_unique_check
(
boŞ
 
sk
è
	gov”ride
;

691 
boŞ
 
comm™_š_the_middË
(è
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

692 
boŞ
 
do_bulk_comm™
(
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
)

693 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

694 
boŞ
 
has_hidd’_pk
(cÚ¡ 
TABLE
 *cÚ¡ 
bË
) const

695 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

697 
upd©e_row_¡©s
(cÚ¡ 
İ”©iÚ_ty³
 &
ty³
);

699 
£t_Ï¡_rowkey
(cÚ¡ 
uch¬
 *cÚ¡ 
Şd_d©a
);

705 
Rdb_f›ld_’cod”
 *
	gm_’cod”_¬r
;

708 şas 
	cREAD_FIELD
 {

709 
	gpublic
:

711 
Rdb_f›ld_’cod”
 *
m_f›ld_’c
;

713 
boŞ
 
	gm_decode
;

715 
	gm_sk
;

723 
	g¡d
::
veùÜ
<
READ_FIELD
> 
m_decod”s_veù
;

729 
boŞ
 
	gm_key_»que¡ed
 = 
çl£
;

732 
£tup_»ad_decod”s
();

739 
MY_BITMAP
 
	gm_lookup_b™m­
 = {
nuÎ±r
, 0, 0,‚ullptr,‚ullptr};

745 
ušt
 
	gm_nuÎ_by‹s_š_»c
;

747 
g‘_¡Üage_ty³
(
Rdb_f›ld_’cod”
 *cÚ¡ 
’cod”
, cÚ¡ 
ušt
 &
kp
);

748 
£tup_f›ld_cÚv”‹rs
();

749 
®loc_key_bufãrs
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

750 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

751 
boŞ
 
®loc_®‹r_bufãrs
 = 
çl£
)

752 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

753 
ä“_key_bufãrs
();

756 
	grocksdb
::
Rªge
 
g‘_¿nge
(cÚ¡ &
i
, 
uch¬
 
buf
[]) const;

761 
Rdb_io_³rf
 
	gm_io_³rf
;

767 
	gmy_cÜe
::
ha_rows
 
m_row_checksums_checked
;

772 
upd©e_¡©s
();

774 
	gpublic
:

780 
boŞ
 
m_¡Üe_row_debug_checksums
;

783 
boŞ
 
	gm_v”ify_row_debug_checksums
;

784 
	gm_checksums_pù
;

786 
ha_rocksdb
(
my_cÜe
::
hªdË¹Ú
 *cÚ¡ 
htÚ
,

787 
my_cÜe
::
TABLE_SHARE
 *cÚ¡ 
bË_¬g
);

788 ~
ha_rocksdb
() {

789 
”r
 
MY_ATTRIBUTE
((
__unu£d__
));

790 
	g”r
 = 
fš®ize_bulk_lßd
(
çl£
);

791 ià(
	g”r
 != 0) {

792 
sql_´št_”rÜ
("RocksDB: Error %d finalizing bulk†oad while closing "

794 
”r
);

801 cÚ¡ *
bË_ty³
(ècÚ¡ 
	gov”ride
 {

802 
DBUG_ENTER_FUNC
();

804 
DBUG_RETURN
(
rocksdb_htÚ_Çme
);

808 cÚ¡ *
šdex_ty³
(
ušt
 
šx
è
	gov”ride
 {

809 
DBUG_ENTER_FUNC
();

811 
DBUG_RETURN
("LSMTREE");

817 cÚ¡ **
bas_ext
(ècÚ¡ 
	gov”ride
;

822 cÚ¡ 
	g¡d
::
¡ršg
 &
g‘_bË_ba£Çme
() const;

828 
ulÚglÚg
 
bË_æags
(ècÚ¡ 
	gov”ride
 {

829 
DBUG_ENTER_FUNC
();

840 
DBUG_RETURN
(
HA_BINLOG_ROW_CAPABLE
 | 
HA_BINLOG_STMT_CAPABLE
 |

841 
HA_REC_NOT_IN_SEQ
 | 
HA_CAN_INDEX_BLOBS
 |

842 (
m_pk_ÿn_be_decoded
 ? 
HA_PRIMARY_KEY_IN_READ_INDEX
 : 0) |

843 
HA_PRIMARY_KEY_REQUIRED_FOR_POSITION
 | 
HA_NULL_IN_KEY
 |

844 
HA_PARTIAL_COLUMN_READ
);

847 
boŞ
 
š™_w™h_f›lds
(è
	gov”ride
;

859 
ulÚg
 
šdex_æags
(
ušt
 
šx
, ušˆ
·¹
, 
boŞ
 
®l_·¹s
ècÚ¡ 
	gov”ride
;

861 cÚ¡ 
key_m­
 *
keys_to_u£_fÜ_sÿÂšg
(è
	gov”ride
 {

862 
DBUG_ENTER_FUNC
();

864 
DBUG_RETURN
(&
key_m­_fuÎ
);

867 
boŞ
 
´im¬y_key_is_şu¡”ed
(è
	gov”ride
 {

868 
DBUG_ENTER_FUNC
();

870 
DBUG_RETURN
(
Œue
);

873 
boŞ
 
should_¡Üe_row_debug_checksums
() const {

874  
	gm_¡Üe_row_debug_checksums
 && (
¿nd
(è% 100 < 
	gm_checksums_pù
);

877 
»Çme_bË
(cÚ¡ *cÚ¡ 
äom
, cÚ¡ *cÚ¡ 
to
è
ov”ride


878 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

880 
cÚv”t_blob_äom_¡Üage_fÜm©
(
my_cÜe
::
F›ld_blob
 *cÚ¡ 
blob
,

881 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

882 
boŞ
 
decode
)

883 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

885 
cÚv”t_v¬ch¬_äom_¡Üage_fÜm©
(

886 
my_cÜe
::
F›ld_v¬¡ršg
 *cÚ¡ 
f›ld_v¬
,

887 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
, 
boŞ
 
decode
)

888 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

890 
cÚv”t_f›ld_äom_¡Üage_fÜm©
(
my_cÜe
::
F›ld
 *cÚ¡ 
f›ld
,

891 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

892 
boŞ
 
decode
, 
ušt
 
Ën
)

893 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

895 
cÚv”t_»cÜd_äom_¡Üage_fÜm©
(cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
key
,

896 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
v®ue
,

897 
uch¬
 *cÚ¡ 
buf
)

898 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

900 
cÚv”t_»cÜd_äom_¡Üage_fÜm©
(cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
key
,

901 
uch¬
 *cÚ¡ 
buf
)

902 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

904 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
·r£_što_tok’s
(cÚ¡ std::¡ršg &
s
,

905 cÚ¡ 
d–im
);

907 cÚ¡ 
	g¡d
::
¡ršg
 
g’”©e_cf_Çme
(cÚ¡ 
ušt
 
šdex
,

908 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

909 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

910 
boŞ
 *
³r_·¹_m©ch_found
);

912 cÚ¡ *
g‘_key_Çme
(cÚ¡ 
ušt
 
šdex
,

913 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

914 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
)

915 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

917 cÚ¡ *
g‘_key_comm’t
(cÚ¡ 
ušt
 
šdex
,

918 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

919 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
)

920 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

922 cÚ¡ 
	g¡d
::
¡ršg
 
g‘_bË_comm’t
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
)

923 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

925 
boŞ
 
is_hidd’_pk
(cÚ¡ 
ušt
 
šdex
, cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

926 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
)

927 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

929 
ušt
 
pk_šdex
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

930 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
)

931 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

933 
boŞ
 
is_pk
(cÚ¡ 
ušt
 
šdex
, cÚ¡ 
TABLE
 *
bË_¬g
,

934 cÚ¡ 
Rdb_tbl_def
 *
tbl_def_¬g
)

935 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

943 
ušt
 
max_suµÜ‹d_»cÜd_Ëngth
(ècÚ¡ 
	gov”ride
 {

944 
DBUG_ENTER_FUNC
();

946 
DBUG_RETURN
(
HA_MAX_REC_LENGTH
);

949 
ušt
 
max_suµÜ‹d_keys
(ècÚ¡ 
	gov”ride
 {

950 
DBUG_ENTER_FUNC
();

952 
DBUG_RETURN
(
MAX_INDEXES
);

955 
ušt
 
max_suµÜ‹d_key_·¹s
(ècÚ¡ 
	gov”ride
 {

956 
DBUG_ENTER_FUNC
();

958 
DBUG_RETURN
(
MAX_REF_PARTS
);

961 
ušt
 
max_suµÜ‹d_key_·¹_Ëngth
(ècÚ¡ 
	gov”ride
;

972 
ušt
 
max_suµÜ‹d_key_Ëngth
(ècÚ¡ 
	gov”ride
 {

973 
DBUG_ENTER_FUNC
();

975 
DBUG_RETURN
(16 * 1024);

983 
ha_rows
 
e¡im©e_rows_uµ”_bound
(è
	gov”ride
 {

984 
DBUG_ENTER_FUNC
();

986 
DBUG_RETURN
(
HA_POS_ERROR
);

991 
šdex_»ad_m­
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ uch¬ *cÚ¡ 
key
,

992 
key_·¹_m­
 
key·¹_m­
,

993 
ha_rkey_funùiÚ
 
fšd_æag
è
ov”ride


994 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

996 
šdex_»ad_m­_im¶
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ uch¬ *cÚ¡ 
key
,

997 
key_·¹_m­
 
key·¹_m­
,

998 
ha_rkey_funùiÚ
 
fšd_æag
,

999 cÚ¡ 
key_¿nge
 *
’d_key
)

1000 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1002 
šdex_»ad_Ï¡_m­
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ uch¬ *cÚ¡ 
key
,

1003 
key_·¹_m­
 
key·¹_m­
è
ov”ride


1004 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1006 
»ad_¿nge_fœ¡
(cÚ¡ 
key_¿nge
 *cÚ¡ 
¡¬t_key
,

1007 cÚ¡ 
key_¿nge
 *cÚ¡ 
’d_key
, 
boŞ
 
eq_¿nge
,

1008 
boŞ
 
sÜ‹d
è
ov”ride


1009 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1011 
vœtu®
 
sÿn_time
(è
	gov”ride
 {

1012 
DBUG_ENTER_FUNC
();

1014 
DBUG_RETURN
(

1015 
¡©ic_ÿ¡
<>((
¡©s
.
»cÜds
 + sts.
d–‘ed
) / 20.0 + 10));

1018 
vœtu®
 
»ad_time
(
ušt
, ušt, 
ha_rows
 
rows
è
	gov”ride
;

1020 
İ’
(cÚ¡ *cÚ¡ 
Çme
, 
mode
, 
ušt
 
‹¡_if_locked
è
ov”ride


1021 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1022 
şo£
(è
ov”ride
 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1024 
wr™e_row
(
uch¬
 *cÚ¡ 
buf
è
ov”ride


1025 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1026 
upd©e_row
(cÚ¡ 
uch¬
 *cÚ¡ 
Şd_d©a
, uch¬ *cÚ¡ 
Ãw_d©a
è
ov”ride


1027 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1028 
d–‘e_row
(cÚ¡ 
uch¬
 *cÚ¡ 
buf
è
ov”ride


1029 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1030 
	grocksdb
::
Stus
 
d–‘e_Ü_sšgËd–‘e
(
ušt
 
šdex
, 
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
,

1031 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cf
,

1032 cÚ¡ 
rocksdb
::
Sliû
 &
key
)

1033 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1035 
šdex_Ãxt
(
uch¬
 *cÚ¡ 
buf
è
ov”ride


1036 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1037 
šdex_Ãxt_w™h_dœeùiÚ
(
uch¬
 *cÚ¡ 
buf
, 
boŞ
 
move_fÜw¬d
)

1038 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1039 
šdex_´ev
(
uch¬
 *cÚ¡ 
buf
è
ov”ride


1040 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1042 
šdex_fœ¡
(
uch¬
 *cÚ¡ 
buf
è
ov”ride


1043 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1044 
šdex_Ï¡
(
uch¬
 *cÚ¡ 
buf
è
ov”ride


1045 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1047 
şass
 
I‹m
 *
idx_cÚd_push
(
ušt
 
keyno
, cÏs I‹m *cÚ¡ 
idx_cÚd
è
	gov”ride
;

1051 
	g´iv©e
:

1052 
	skey_def_cf_šfo
 {

1053 
rocksdb
::
CŞumnFamyHªdË
 *
cf_hªdË
;

1054 
boŞ
 
	gis_»v”£_cf
;

1055 
boŞ
 
	gis_³r_·¹™iÚ_cf
;

1058 
	supd©e_row_šfo
 {

1059 
Rdb_Œª§ùiÚ
 *
	gtx
;

1060 cÚ¡ 
uch¬
 *
	gÃw_d©a
;

1061 cÚ¡ 
uch¬
 *
	gŞd_d©a
;

1062 
	grocksdb
::
Sliû
 
Ãw_pk_¦iû
;

1063 
	grocksdb
::
Sliû
 
Şd_pk_¦iû
;

1064 
	grocksdb
::
Sliû
 
Şd_pk_»c
;

1067 
Rdb_¡ršg_wr™”
 *
	gÃw_pk_uÅack_šfo
;

1069 
lÚglÚg
 
	ghidd’_pk_id
;

1070 
boŞ
 
	gsk_unique_check
;

1080 
ušt
 
	g‰l_pk_off£t
 = 
UINT_MAX
;

1087 
	sunique_sk_buf_šfo
 {

1088 
boŞ
 
	gsk_buf_sw™ch
 = 
çl£
;

1089 
	grocksdb
::
Sliû
 
sk_memcmp_key
;

1090 
	grocksdb
::
Sliû
 
sk_memcmp_key_Şd
;

1091 
uch¬
 *
	gdup_sk_buf
;

1092 
uch¬
 *
	gdup_sk_buf_Şd
;

1103 
šlše
 
uch¬
 *
sw­_ªd_g‘_sk_buf
() {

1104 
	gsk_buf_sw™ch
 = !
sk_buf_sw™ch
;

1105  
	gsk_buf_sw™ch
 ? 
	gdup_sk_buf
 : 
dup_sk_buf_Şd
;

1109 
ü—‹_cfs
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

1110 
¡d
::
¬¿y
<
key_def_cf_šfo
, 
MAX_INDEXES
 + 1> *cÚ¡ 
cfs
)

1111 cÚ¡ 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1113 
ü—‹_key_def
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, cÚ¡ 
ušt
 &
i
,

1114 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

1115 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
Ãw_key_def
,

1116 cÚ¡ 
key_def_cf_šfo
 &
cf_šfo
) const

1117 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1119 
ü—‹_š¶aû_key_defs
(

1120 cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, 
Rdb_tbl_def
 *
vtbl_def_¬g
,

1121 cÚ¡ 
TABLE
 *cÚ¡ 
Şd_bË_¬g
,

1122 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
Şd_tbl_def_¬g
,

1123 cÚ¡ 
¡d
::
¬¿y
<
key_def_cf_šfo
, 
MAX_INDEXES
 + 1> &
cfs
) const

1124 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1126 
	g¡d
::
unÜd”ed_m­
<
¡d
::
¡ršg
, 
	gušt
>

1127 
g‘_Şd_key_pos™iÚs
(cÚ¡ 
TABLE
 *
bË_¬g
, cÚ¡ 
Rdb_tbl_def
 *
tbl_def_¬g
,

1128 cÚ¡ 
TABLE
 *
Şd_bË_¬g
,

1129 cÚ¡ 
Rdb_tbl_def
 *
Şd_tbl_def_¬g
) const

1130 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

1132 
com·»_key_·¹s
(cÚ¡ 
KEY
 *cÚ¡ 
Şd_key
,

1133 cÚ¡ 
KEY
 *cÚ¡ 
Ãw_key
) const;

1134 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1136 
com·»_keys
(cÚ¡ 
KEY
 *cÚ¡ 
Şd_key
, cÚ¡ KEY *cÚ¡ 
Ãw_key
) const

1137 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1139 
cÚv”t_»cÜd_to_¡Üage_fÜm©
(cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

1140 
rocksdb
::
Sliû
 *cÚ¡ 
·cked_»c
)

1141 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

1143 
boŞ
 
should_hide_‰l_»c
(cÚ¡ 
Rdb_key_def
 &
kd
,

1144 cÚ¡ 
rocksdb
::
Sliû
 &
‰l_»c_v®
,

1145 cÚ¡ 
št64_t
 
cu¼_ts
)

1146 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1147 
rocksdb_sk_expœed_»cÜds
(cÚ¡ 
Rdb_key_def
 &
kd
,

1148 
rocksdb
::
I‹¿tÜ
 *cÚ¡ 
™”
,

1149 
boŞ
 
£ek_backw¬d
);

1151 
šdex_fœ¡_š‹º
(
uch¬
 *
buf
)

1152 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1153 
šdex_Ï¡_š‹º
(
uch¬
 *
buf
)

1154 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1156 
iı_»suÉ
 
check_šdex_cÚd
() const;

1157 
fšd_iı_m©chšg_šdex_»c
(cÚ¡ 
boŞ
 &
move_fÜw¬d
, 
uch¬
 *cÚ¡ 
buf
)

1158 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1160 
ÿlc_upd©ed_šdexes
();

1161 
upd©e_wr™e_row
(cÚ¡ 
uch¬
 *cÚ¡ 
Şd_d©a
, cÚ¡ uch¬ *cÚ¡ 
Ãw_d©a
,

1162 cÚ¡ 
boŞ
 
sk_unique_check
)

1163 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1164 
g‘_pk_fÜ_upd©e
(
upd©e_row_šfo
 *cÚ¡ 
row_šfo
);

1165 
check_ªd_lock_unique_pk
(cÚ¡ 
ušt
 &
key_id
,

1166 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

1167 
boŞ
 *cÚ¡ 
found
, boŞ *cÚ¡ 
pk_chªged
)

1168 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1169 
check_ªd_lock_sk
(cÚ¡ 
ušt
 &
key_id
,

1170 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

1171 
boŞ
 *cÚ¡ 
found
)

1172 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1173 
check_uniqu’ess_ªd_lock
(cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

1174 
boŞ
 *cÚ¡ 
pk_chªged
)

1175 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1176 
boŞ
 
ov”_bulk_lßd_th»shŞd
(*
”r
)

1177 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1178 
check_du¶iÿ‹_sk
(cÚ¡ 
TABLE
 *
bË_¬g
, cÚ¡ 
Rdb_key_def
 &
šdex
,

1179 cÚ¡ 
rocksdb
::
Sliû
 *
key
,

1180 
unique_sk_buf_šfo
 *
sk_šfo
)

1181 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1182 
bulk_lßd_key
(
Rdb_Œª§ùiÚ
 *cÚ¡ 
tx
, cÚ¡ 
Rdb_key_def
 &
kd
,

1183 cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®ue
,

1184 
boŞ
 
sÜt
)

1185 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1186 
upd©e_by‹s_wr™‹n
(
ulÚglÚg
 
by‹s_wr™‹n
);

1187 
upd©e_pk
(cÚ¡ 
Rdb_key_def
 &
kd
, cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

1188 cÚ¡ 
boŞ
 &
pk_chªged
è
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1189 
upd©e_sk
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
, cÚ¡ 
Rdb_key_def
 &
kd
,

1190 cÚ¡ 
upd©e_row_šfo
 &
row_šfo
, cÚ¡ 
boŞ
 
bulk_lßd_sk
)

1191 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1192 
upd©e_šdexes
(cÚ¡ 
upd©e_row_šfo
 &
row_šfo
,

1193 cÚ¡ 
boŞ
 &
pk_chªged
)

1194 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1196 
»ad_key_exaù
(cÚ¡ 
Rdb_key_def
 &
kd
, 
rocksdb
::
I‹¿tÜ
 *cÚ¡ 
™”
,

1197 cÚ¡ 
boŞ
 &
usšg_fuÎ_key
,

1198 cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
,

1199 cÚ¡ 
št64_t
 
‰l_f‹r_ts
)

1200 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1201 
»ad_befÜe_key
(cÚ¡ 
Rdb_key_def
 &
kd
, cÚ¡ 
boŞ
 &
usšg_fuÎ_key
,

1202 cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
,

1203 cÚ¡ 
št64_t
 
‰l_f‹r_ts
)

1204 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1205 
»ad_aá”_key
(cÚ¡ 
Rdb_key_def
 &
kd
, cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
,

1206 cÚ¡ 
št64_t
 
‰l_f‹r_ts
)

1207 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1208 
pos™iÚ_to_cÜ»ù_key
(

1209 cÚ¡ 
Rdb_key_def
 &
kd
, cÚ¡ 
ha_rkey_funùiÚ
 &
fšd_æag
,

1210 cÚ¡ 
boŞ
 &
fuÎ_key_m©ch
, cÚ¡ 
uch¬
 *cÚ¡ 
key
,

1211 cÚ¡ 
key_·¹_m­
 &
key·¹_m­
, cÚ¡ 
rocksdb
::
Sliû
 &
key_¦iû
,

1212 
boŞ
 *cÚ¡ 
move_fÜw¬d
, cÚ¡ 
št64_t
 
‰l_f‹r_ts
)

1213 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1215 
»ad_row_äom_´im¬y_key
(
uch¬
 *cÚ¡ 
buf
)

1216 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1217 
»ad_row_äom_£cÚd¬y_key
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ 
Rdb_key_def
 &
kd
,

1218 
boŞ
 
move_fÜw¬d
)

1219 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1221 
ÿlc_eq_cÚd_Ën
(cÚ¡ 
Rdb_key_def
 &
kd
,

1222 cÚ¡ 
ha_rkey_funùiÚ
 &
fšd_æag
,

1223 cÚ¡ 
rocksdb
::
Sliû
 &
¦iû
,

1224 cÚ¡ &
by‹s_chªged_by_succ
,

1225 cÚ¡ 
key_¿nge
 *cÚ¡ 
’d_key
,

1226 
ušt
 *cÚ¡ 
’d_key_·cked_size
)

1227 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1229 
Rdb_tbl_def
 *
g‘_bË_if_exi¡s
(cÚ¡ *cÚ¡ 
bËÇme
)

1230 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1231 
»ad_thd_v¬s
(
THD
 *cÚ¡ 
thd
è
MY_ATTRIBUTE
((
__nÚnuÎ__
));

1233 
boŞ
 
cÚšs_fÜeign_key
(
THD
 *cÚ¡ 
thd
)

1234 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1236 
š¶aû_pİuÏ‹_sk
(

1237 
TABLE
 *cÚ¡ 
bË_¬g
,

1238 cÚ¡ 
¡d
::
unÜd”ed_£t
<¡d::
sh¬ed_±r
<
Rdb_key_def
>> &
šdexes
)

1239 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

1241 
fš®ize_bulk_lßd
(
boŞ
 
´št_ş›Á_”rÜ
 = 
Œue
)

1242 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1244 
	gpublic
:

1245 
šdex_š™
(
ušt
 
idx
, 
boŞ
 
sÜ‹d
è
ov”ride


1246 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1247 
šdex_’d
(è
ov”ride
 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1249 
uÆock_row
(è
	gov”ride
;

1259 
ºd_š™
(
boŞ
 
sÿn
è
ov”ride
 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1260 
ºd_’d
(è
ov”ride
 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1262 
ºd_Ãxt
(
uch¬
 *cÚ¡ 
buf
è
ov”ride


1263 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1264 
ºd_Ãxt_w™h_dœeùiÚ
(
uch¬
 *cÚ¡ 
buf
, 
boŞ
 
move_fÜw¬d
)

1265 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1267 
ºd_pos
(
uch¬
 *cÚ¡ 
buf
, uch¬ *cÚ¡ 
pos
è
ov”ride


1268 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1269 
pos™iÚ
(cÚ¡ 
uch¬
 *cÚ¡ 
»cÜd
è
	gov”ride
;

1270 
šfo
(
ušt
è
	gov”ride
;

1275 
exŒa
(
ha_exŒa_funùiÚ
 
İ”©iÚ
è
	gov”ride
;

1277 
¡¬t_¡mt
(
THD
 *cÚ¡ 
thd
, 
thr_lock_ty³
 
lock_ty³
è
ov”ride


1278 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1279 
ex‹º®_lock
(
THD
 *cÚ¡ 
thd
, 
lock_ty³
è
ov”ride


1280 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1281 
Œunÿ‹
(è
ov”ride
 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1283 
»£t
(è
	gov”ride
 {

1284 
DBUG_ENTER_FUNC
();

1287 
	gm_»Œ›ved_»cÜd
.
Re£t
();

1289 
DBUG_RETURN
(
HA_EXIT_SUCCESS
);

1292 
check
(
THD
 *cÚ¡ 
thd
, 
HA_CHECK_OPT
 *cÚ¡ 
check_İt
è
ov”ride


1293 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1294 
»move_rows
(
Rdb_tbl_def
 *cÚ¡ 
tbl
);

1295 
ha_rows
 
»cÜds_š_¿nge
(
ušt
 
šx
, 
key_¿nge
 *cÚ¡ 
mš_key
,

1296 
key_¿nge
 *cÚ¡ 
max_key
è
ov”ride


1297 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1298 
d–‘e_bË
(cÚ¡ *cÚ¡ 
äom
è
ov”ride


1299 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1300 
ü—‹
(cÚ¡ *cÚ¡ 
Çme
, 
TABLE
 *cÚ¡ 
fÜm
,

1301 
HA_CREATE_INFO
 *cÚ¡ 
ü—‹_šfo
è
ov”ride


1302 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1303 
boŞ
 
check_if_šcom·tibË_d©a
(
HA_CREATE_INFO
 *cÚ¡ 
šfo
,

1304 
ušt
 
bË_chªges
è
ov”ride


1305 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1307 
THR_LOCK_DATA
 **
¡Üe_lock
(
THD
 *cÚ¡ 
thd
, THR_LOCK_DATA **
to
,

1308 
thr_lock_ty³
 
lock_ty³
è
ov”ride


1309 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1311 
my_boŞ
 
»gi¡”_qu”y_ÿche_bË
(
THD
 *cÚ¡ 
thd
, *cÚ¡ 
bË_key
,

1312 
ušt
 
key_Ëngth
,

1313 
qc_’gše_ÿÎback
 *cÚ¡ 
’gše_ÿÎback
,

1314 
ulÚglÚg
 *cÚ¡ 
’gše_d©a
è
	gov”ride
 {

1315 
DBUG_ENTER_FUNC
();

1318 
DBUG_RETURN
(
FALSE
);

1321 
boŞ
 
g‘_”rÜ_mes§ge
(cÚ¡ 
”rÜ
, 
SŒšg
 *cÚ¡ 
buf
è
ov”ride


1322 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

1324 
rdb_”rÜ_to_mysql
(cÚ¡ 
rocksdb
::
Stus
 &
s
,

1325 cÚ¡ *
msg
 = 
nuÎ±r
)

1326 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1328 
g‘_auto_šüem’t
(
ulÚglÚg
 
off£t
, ulÚglÚg 
šüem’t
,

1329 
ulÚglÚg
 
nb_desœed_v®ues
,

1330 
ulÚglÚg
 *cÚ¡ 
fœ¡_v®ue
,

1331 
ulÚglÚg
 *cÚ¡ 
nb_»£rved_v®ues
è
	gov”ride
;

1332 
upd©e_ü—‹_šfo
(
HA_CREATE_INFO
 *cÚ¡ 
ü—‹_šfo
è
	gov”ride
;

1333 
İtimize
(
THD
 *cÚ¡ 
thd
, 
HA_CHECK_OPT
 *cÚ¡ 
check_İt
è
ov”ride


1334 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1335 
ª®yze
(
THD
 *cÚ¡ 
thd
, 
HA_CHECK_OPT
 *cÚ¡ 
check_İt
è
ov”ride


1336 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

1338 
’um_®‹r_š¶aû_»suÉ
 
check_if_suµÜ‹d_š¶aû_®‹r
(

1339 
TABLE
 *
®‹»d_bË
,

1340 
my_cÜe
::
AÉ”_š¶aû_šfo
 *cÚ¡ 
ha_®‹r_šfo
è
ov”ride
;

1342 
boŞ
 
´•¬e_š¶aû_®‹r_bË
(

1343 
TABLE
 *cÚ¡ 
®‹»d_bË
,

1344 
my_cÜe
::
AÉ”_š¶aû_šfo
 *cÚ¡ 
ha_®‹r_šfo
è
ov”ride
;

1346 
boŞ
 
š¶aû_®‹r_bË
(

1347 
TABLE
 *cÚ¡ 
®‹»d_bË
,

1348 
my_cÜe
::
AÉ”_š¶aû_šfo
 *cÚ¡ 
ha_®‹r_šfo
è
ov”ride
;

1350 
boŞ


1351 
comm™_š¶aû_®‹r_bË
(
TABLE
 *cÚ¡ 
®‹»d_bË
,

1352 
my_cÜe
::
AÉ”_š¶aû_šfo
 *cÚ¡ 
ha_®‹r_šfo
,

1353 
boŞ
 
comm™
è
	gov”ride
;

1355 
£t_u£_»ad_ä“_½l
(cÚ¡ *cÚ¡ 
wh™–i¡
);

1356 
£t_sk_unique_check_bËs
(cÚ¡ *cÚ¡ 
wh™–i¡
);

1358 
	gpublic
:

1359 
vœtu®
 
½l_befÜe_d–‘e_rows
(è
ov”ride
;

1360 
vœtu®
 
½l_aá”_d–‘e_rows
(è
	gov”ride
;

1361 
vœtu®
 
½l_befÜe_upd©e_rows
(è
	gov”ride
;

1362 
vœtu®
 
½l_aá”_upd©e_rows
(è
	gov”ride
;

1363 
vœtu®
 
boŞ
 
u£_»ad_ä“_½l
();

1365 
	g´iv©e
:

1367 
boŞ
 
m_š_½l_d–‘e_rows
;

1368 
boŞ
 
	gm_š_½l_upd©e_rows
;

1370 
boŞ
 
	gm_fÜû_sk_unique_check
;

1377 
	gRdb_š¶aû_®‹r_ùx
 : 
public
 
my_cÜe
::
š¶aû_®‹r_hªdËr_ùx
 {

1379 
Rdb_tbl_def
 *cÚ¡ 
m_Ãw_tdef
;

1382 
	g¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
m_Şd_key_desü
;

1385 
	g¡d
::
sh¬ed_±r
<
Rdb_key_def
> *
m_Ãw_key_desü
;

1388 cÚ¡ 
ušt
 
	gm_Şd_n_keys
;

1391 cÚ¡ 
ušt
 
	gm_Ãw_n_keys
;

1394 cÚ¡ 
	g¡d
::
unÜd”ed_£t
<
¡d
::
sh¬ed_±r
<
Rdb_key_def
>> 
m_added_šdexes
;

1397 cÚ¡ 
	g¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
m_drİ³d_šdex_ids
;

1400 cÚ¡ 
ušt
 
	gm_n_added_keys
;

1403 cÚ¡ 
ušt
 
	gm_n_drİ³d_keys
;

1406 cÚ¡ 
ulÚglÚg
 
	gm_max_auto_šü
;

1408 
Rdb_š¶aû_®‹r_ùx
(

1409 
Rdb_tbl_def
 *
Ãw_tdef
, 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *
Şd_key_desü
,

1410 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *
Ãw_key_desü
, 
ušt
 
Şd_n_keys
,

1411 
ušt
 
Ãw_n_keys
,

1412 
¡d
::
unÜd”ed_£t
<¡d::
sh¬ed_±r
<
Rdb_key_def
>> 
added_šdexes
,

1413 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
drİ³d_šdex_ids
, 
ušt
 
n_added_keys
,

1414 
ušt
 
n_drİ³d_keys
, 
ulÚglÚg
 
max_auto_šü
)

1415 : 
my_cÜe
::
š¶aû_®‹r_hªdËr_ùx
(), 
m_Ãw_tdef
(
Ãw_tdef
),

1416 
m_Şd_key_desü
(
Şd_key_desü
), 
m_Ãw_key_desü
(
Ãw_key_desü
),

1417 
m_Şd_n_keys
(
Şd_n_keys
), 
m_Ãw_n_keys
(
Ãw_n_keys
),

1418 
m_added_šdexes
(
added_šdexes
), 
m_drİ³d_šdex_ids
(
drİ³d_šdex_ids
),

1419 
m_n_added_keys
(
n_added_keys
), 
m_n_drİ³d_keys
(
n_drİ³d_keys
),

1420 
m_max_auto_šü
(
max_auto_šü
) {}

1422 ~
Rdb_š¶aû_®‹r_ùx
() {}

1424 
	g´iv©e
:

1426 
Rdb_š¶aû_®‹r_ùx
(const Rdb_inplace_alter_ctx &);

1427 
	gRdb_š¶aû_®‹r_ùx
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_š¶aû_®‹r_ùx
 &);

1431 
	g¡d
::
¡ršg
 
rdb_cÜru±iÚ_m¬k”_fe_Çme
();

	@ha_rocksdb_proto.h

16 #´agm¨
Úû


19 
	~<¡ršg
>

20 
	~<veùÜ
>

23 
	~"sql_¡ršg.h
"

26 
	~"rocksdb/bË.h
"

27 
	~"rocksdb/ut™›s/Œª§ùiÚ_db.h
"

29 
Çme¥aû
 
	gmyrocks
 {

31 
	eRDB_IO_ERROR_TYPE
 {

32 
	gRDB_IO_ERROR_TX_COMMIT
,

33 
	gRDB_IO_ERROR_DICT_COMMIT
,

34 
	gRDB_IO_ERROR_BG_THREAD
,

35 
	gRDB_IO_ERROR_GENERAL
,

36 
	gRDB_IO_ERROR_LAST


39 cÚ¡ *
g‘_rdb_io_”rÜ_¡ršg
(cÚ¡ 
RDB_IO_ERROR_TYPE
 
”r_ty³
);

41 
rdb_hªdË_io_”rÜ
(cÚ¡ 
rocksdb
::
Stus
 
¡©us
,

42 cÚ¡ 
RDB_IO_ERROR_TYPE
 
”r_ty³
);

44 
rdb_nÜm®ize_bËÇme
(cÚ¡ 
¡d
::
¡ršg
 &
bËÇme
, std::¡ršg *
¡r
)

45 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

47 
rdb_¥l™_nÜm®ized_bËÇme
(cÚ¡ 
¡d
::
¡ršg
 &
fuÎÇme
, std::¡ršg *
db
,

48 
¡d
::
¡ršg
 *
bË
 = 
nuÎ±r
,

49 
¡d
::
¡ršg
 *
·¹™iÚ
 = 
nuÎ±r
)

50 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

52 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
rdb_g‘_İ’_bË_Çmes
();

54 
rdb_g‘_bË_³rf_couÁ”s
(cÚ¡ *
bËÇme
,

55 
Rdb_³rf_couÁ”s
 *
couÁ”s
)

56 
MY_ATTRIBUTE
((
__nÚnuÎ__
(2)));

58 
rdb_g‘_glob®_³rf_couÁ”s
(
Rdb_³rf_couÁ”s
 *
couÁ”s
)

59 
MY_ATTRIBUTE
((
__nÚnuÎ__
(1)));

61 
rdb_queue_§ve_¡©s_»que¡
();

67 
	grocksdb
::
T¿n§ùiÚDB
 *
rdb_g‘_rocksdb_db
();

69 
şass
 
	gRdb_cf_mªag”
;

70 
	gRdb_cf_mªag”
 &
rdb_g‘_cf_mªag”
();

72 cÚ¡ 
	grocksdb
::
BlockBa£dTabËO±iÚs
 &
rdb_g‘_bË_İtiÚs
();

73 
boŞ
 
rdb_is_‰l_’abËd
();

74 
boŞ
 
rdb_is_‰l_»ad_f‹ršg_’abËd
();

75 #iâdeà
NDEBUG


76 
rdb_dbug_£t_‰l_»c_ts
();

77 
rdb_dbug_£t_‰l_¢­shÙ_ts
();

78 
rdb_dbug_£t_‰l_»ad_f‹r_ts
();

79 
boŞ
 
rdb_dbug_£t_‰l_ignÜe_pk
();

82 
	gİ”©iÚ_ty³
 : ;

83 
rdb_upd©e_glob®_¡©s
(cÚ¡ 
İ”©iÚ_ty³
 &
ty³
, 
ušt
 
couÁ
,

84 
boŞ
 
is_sy¡em_bË
 = 
çl£
);

86 
şass
 
	gRdb_diù_mªag”
;

87 
Rdb_diù_mªag”
 *
rdb_g‘_diù_mªag”
()

88 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

90 
şass
 
	gRdb_ddl_mªag”
;

91 
Rdb_ddl_mªag”
 *
rdb_g‘_ddl_mªag”
()

92 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

94 
şass
 
	gRdb_bšlog_mªag”
;

95 
Rdb_bšlog_mªag”
 *
rdb_g‘_bšlog_mªag”
()

96 
MY_ATTRIBUTE
((
__w¬n_unu£d_»suÉ__
));

	@logger.h

16 #´agm¨
Úû


18 
	~<log.h
>

19 
	~<s¡»am
>

20 
	~<¡ršg
>

22 
Çme¥aû
 
	gmyrocks
 {

24 şas 
	cRdb_logg”
 : 
public
 
rocksdb
::
Logg”
 {

25 
public
:

26 
ex¶ic™
 
Rdb_logg”
(cÚ¡ 
rocksdb
::
InfoLogLev–
 
log_Ëv–
 =

27 
rocksdb
::
InfoLogLev–
::
ERROR_LEVEL
)

28 : 
m_mysql_log_Ëv–
(
log_Ëv–
) {}

30 
Logv
(cÚ¡ 
rocksdb
::
InfoLogLev–
 
log_Ëv–
, cÚ¡ *
fÜm©
,

31 
va_li¡
 
­
è
	gov”ride
 {

32 
DBUG_ASSERT
(
fÜm©
 !ğ
nuÎ±r
);

34 
logËv–
 
	gmysql_log_Ëv–
;

36 ià(
	gm_logg”
) {

37 
	gm_logg”
->
Logv
(
log_Ëv–
, 
fÜm©
, 
­
);

40 ià(
	glog_Ëv–
 < 
	gm_mysql_log_Ëv–
) {

44 ià(
	glog_Ëv–
 >ğ
rocksdb
::
InfoLogLev–
::
ERROR_LEVEL
) {

45 
mysql_log_Ëv–
 = 
ERROR_LEVEL
;

46 } ià(
	glog_Ëv–
 >ğ
rocksdb
::
InfoLogLev–
::
WARN_LEVEL
) {

47 
mysql_log_Ëv–
 = 
WARNING_LEVEL
;

49 
	gmysql_log_Ëv–
 = 
INFORMATION_LEVEL
;

53 
	g¡d
::
¡ršg
 
f
("LibRocksDB:");

54 
	gf
.
­³nd
(
fÜm©
);

55 
”rÜ_log_´št
(
mysql_log_Ëv–
, 
f
.
c_¡r
(), 
­
);

58 
Logv
(cÚ¡ *
fÜm©
, 
va_li¡
 
­
è
	gov”ride
 {

59 
DBUG_ASSERT
(
fÜm©
 !ğ
nuÎ±r
);

61 
Logv
(
rocksdb
::
InfoLogLev–
::
INFO_LEVEL
, 
fÜm©
, 
­
);

64 
S‘RocksDBLogg”
(cÚ¡ 
¡d
::
sh¬ed_±r
<
rocksdb
::
Logg”
> 
logg”
) {

65 
m_logg”
 = 
logg”
;

68 
S‘InfoLogLev–
(cÚ¡ 
rocksdb
::
InfoLogLev–
 
log_Ëv–
è
ov”ride
 {

71 
rocksdb
::
InfoLogLev–
 
ba£_Ëv–
 = 
log_Ëv–
;

73 ià(
	gm_logg”
 && m_logg”->
G‘InfoLogLev–
(è< 
	gba£_Ëv–
) {

74 
	gba£_Ëv–
 = 
m_logg”
->
G‘InfoLogLev–
();

76 
	grocksdb
::
Logg”
::
S‘InfoLogLev–
(
ba£_Ëv–
);

77 
	gm_mysql_log_Ëv–
 = 
log_Ëv–
;

80 
	g´iv©e
:

81 
¡d
::
sh¬ed_±r
<
rocksdb
::
Logg”
> 
m_logg”
;

82 
	grocksdb
::
InfoLogLev–
 
m_mysql_log_Ëv–
;

	@properties_collector.cc

18 
	~"´İ”t›s_cŞËùÜ.h
"

21 
	~<®gÜ™hm
>

22 
	~<m­
>

23 
	~<¡ršg
>

24 
	~<veùÜ
>

27 
	~"log.h
"

28 
	~"my_¡ackŒaû.h
"

29 
	~"sql_¬¿y.h
"

32 
	~"rdb_d©adic.h
"

33 
	~"rdb_uts.h
"

35 
Çme¥aû
 
	gmyrocks
 {

37 
	g¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_put
(0);

38 
	g¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_d–‘e
(0);

39 
	g¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_sšgËd–‘e
(0);

40 
	g¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_m”ge
(0);

41 
	g¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_Ùh”
(0);

42 
my_boŞ
 
	grocksdb_com·ùiÚ_£qu’tŸl_d–‘es_couÁ_sd
 = 
çl£
;

44 
	gRdb_tbl_´İ_cŞl
::
Rdb_tbl_´İ_cŞl
(
Rdb_ddl_mªag”
 *cÚ¡ 
ddl_mªag”
,

45 cÚ¡ 
Rdb_com·ù_·¿ms
 &
·¿ms
,

46 cÚ¡ 
ušt32_t
 &
cf_id
,

47 cÚ¡ 
ušt8_t
 &
bË_¡©s_§m¶šg_pù
)

48 : 
m_cf_id
(
cf_id
), 
m_ddl_mªag”
(
ddl_mªag”
), 
m_Ï¡_¡©s
(
nuÎ±r
),

49 
m_rows
(0l), 
m_wšdow_pos
(0l), 
m_d–‘ed_rows
(0l), 
m_max_d–‘ed_rows
(0l),

50 
m_fe_size
(0), 
m_·¿ms
(
·¿ms
),

51 
m_ÿrdš®™y_cŞËùÜ
(
bË_¡©s_§m¶šg_pù
) {

52 
DBUG_ASSERT
(
ddl_mªag”
 !ğ
nuÎ±r
);

54 
	gm_d–‘ed_rows_wšdow
.
»size
(
m_·¿ms
.
m_wšdow
, 
çl£
);

60 
	grocksdb
::
Stus
 
Rdb_tbl_´İ_cŞl
::
AddU£rKey
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

61 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
,

62 
rocksdb
::
EÁryTy³
 
ty³
,

63 
rocksdb
::
Sequ’ûNumb”
 
£q
,

64 
ušt64_t
 
fe_size
) {

65 ià(
	gkey
.
size
() >= 4) {

66 
Adju¡D–‘edRows
(
ty³
);

68 
	gm_rows
++;

70 
CŞËùStsFÜRow
(
key
, 
v®ue
, 
ty³
, 
fe_size
);

73  
	grocksdb
::
Stus
::
OK
();

76 
	gRdb_tbl_´İ_cŞl
::
Adju¡D–‘edRows
(
rocksdb
::
EÁryTy³
 
ty³
) {

77 ià(
m_·¿ms
.
m_wšdow
 > 0) {

85 cÚ¡ 
boŞ
 
is_d–‘e
 = (
ty³
 =ğ
rocksdb
::
kEÁryD–‘e
 ||

86 (
ty³
 =ğ
rocksdb
::
kEÁrySšgËD–‘e
 &&

87 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_couÁ_sd
));

90 ià(
	gis_d–‘e
 !ğ
m_d–‘ed_rows_wšdow
[
m_wšdow_pos
]) {

92 
m_d–‘ed_rows_wšdow
[
m_wšdow_pos
] = 
is_d–‘e
;

93 ià(!
	gis_d–‘e
) {

94 
	gm_d–‘ed_rows
--;

95 } ià(++
	gm_d–‘ed_rows
 > 
	gm_max_d–‘ed_rows
) {

96 
	gm_max_d–‘ed_rows
 = 
m_d–‘ed_rows
;

100 ià(++
	gm_wšdow_pos
 =ğ
m_·¿ms
.
m_wšdow
) {

101 
m_wšdow_pos
 = 0;

106 
Rdb_šdex_¡©s
 *
	gRdb_tbl_´İ_cŞl
::
AcûssSts
(cÚ¡ 
rocksdb
::
Sliû
 &
key
) {

107 
GL_INDEX_ID
 
gl_šdex_id
 = {.
cf_id
 = 
m_cf_id
,

108 .
	gšdex_id
 = 
rdb_Ãtbuf_to_ušt32
(

109 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
key
.
d©a
()))};

111 ià(
	gm_Ï¡_¡©s
 =ğ
nuÎ±r
 || 
m_Ï¡_¡©s
->
m_gl_šdex_id
 !ğ
gl_šdex_id
) {

112 
m_keydef
 = 
nuÎ±r
;

116 
	gm_¡©s
.
em¶aû_back
(
gl_šdex_id
);

117 
	gm_Ï¡_¡©s
 = &
m_¡©s
.
back
();

119 ià(
	gm_ddl_mªag”
) {

127 
	gm_keydef
 = 
m_ddl_mªag”
->
§ã_fšd
(
gl_šdex_id
);

128 ià(
	gm_keydef
 !ğ
nuÎ±r
) {

131 
m_Ï¡_¡©s
->
m_di¡šù_keys_³r_´efix
.
»size
(

132 
m_keydef
->
g‘_key_·¹s
());

133 
	gm_Ï¡_¡©s
->
	gm_Çme
 = 
m_keydef
->
g‘_Çme
();

136 
	gm_ÿrdš®™y_cŞËùÜ
.
Re£t
();

139  
	gm_Ï¡_¡©s
;

142 
	gRdb_tbl_´İ_cŞl
::
CŞËùStsFÜRow
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

143 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
,

144 cÚ¡ 
rocksdb
::
EÁryTy³
 &
ty³
,

145 cÚ¡ 
ušt64_t
 &
fe_size
) {

146 autØ
	g¡©s
 = 
AcûssSts
(
key
);

148 
	g¡©s
->
	gm_d©a_size
 +ğ
key
.
size
(è+ 
v®ue
.size();

151 
	gty³
) {

152 
	grocksdb
::
kEÁryPut
:

153 
¡©s
->
m_rows
++;

155 
	grocksdb
::
kEÁryD–‘e
:

156 
¡©s
->
m_’Œy_d–‘es
++;

158 
	grocksdb
::
kEÁrySšgËD–‘e
:

159 
¡©s
->
m_’Œy_sšgË_d–‘es
++;

161 
	grocksdb
::
kEÁryM”ge
:

162 
¡©s
->
m_’Œy_m”ges
++;

164 
	grocksdb
::
kEÁryOth”
:

165 
¡©s
->
m_’Œy_Ùh”s
++;

169 
sql_´št_”rÜ
("RocksDB: Unexpectedƒntryype found: %u. "

171 
ty³
);

172 
abÜt
();

176 
	g¡©s
->
	gm_aùu®_disk_size
 +ğ
fe_size
 - 
m_fe_size
;

177 
	gm_fe_size
 = 
fe_size
;

179 ià(
	gm_keydef
 !ğ
nuÎ±r
) {

180 
m_ÿrdš®™y_cŞËùÜ
.
ProûssKey
(
key
, 
m_keydef
.
g‘
(), 
¡©s
);

184 cÚ¡ *
	gRdb_tbl_´İ_cŞl
::
INDEXSTATS_KEY
 = "__indexstats__";

189 
	grocksdb
::
Stus


190 
Rdb_tbl_´İ_cŞl
::
Fšish
(
rocksdb
::
U£rCŞËùedPrİ”t›s
 *cÚ¡ 
´İ”t›s
) {

191 
ušt64_t
 
num_s¡_’Œy_put
 = 0;

192 
ušt64_t
 
	gnum_s¡_’Œy_d–‘e
 = 0;

193 
ušt64_t
 
	gnum_s¡_’Œy_sšgËd–‘e
 = 0;

194 
ušt64_t
 
	gnum_s¡_’Œy_m”ge
 = 0;

195 
ušt64_t
 
	gnum_s¡_’Œy_Ùh”
 = 0;

197 
DBUG_ASSERT
(
´İ”t›s
 !ğ
nuÎ±r
);

199 autØ
	g™
 = 
m_¡©s
.
begš
(); iˆ!ğm_¡©s.
’d
(); it++) {

200 
	gnum_s¡_’Œy_put
 +ğ
™
->
m_rows
;

201 
	gnum_s¡_’Œy_d–‘e
 +ğ
™
->
m_’Œy_d–‘es
;

202 
	gnum_s¡_’Œy_sšgËd–‘e
 +ğ
™
->
m_’Œy_sšgË_d–‘es
;

203 
	gnum_s¡_’Œy_m”ge
 +ğ
™
->
m_’Œy_m”ges
;

204 
	gnum_s¡_’Œy_Ùh”
 +ğ
™
->
m_’Œy_Ùh”s
;

207 ià(
	gnum_s¡_’Œy_put
 > 0) {

208 
	grocksdb_num_s¡_’Œy_put
 +ğ
num_s¡_’Œy_put
;

211 ià(
	gnum_s¡_’Œy_d–‘e
 > 0) {

212 
	grocksdb_num_s¡_’Œy_d–‘e
 +ğ
num_s¡_’Œy_d–‘e
;

215 ià(
	gnum_s¡_’Œy_sšgËd–‘e
 > 0) {

216 
	grocksdb_num_s¡_’Œy_sšgËd–‘e
 +ğ
num_s¡_’Œy_sšgËd–‘e
;

219 ià(
	gnum_s¡_’Œy_m”ge
 > 0) {

220 
	grocksdb_num_s¡_’Œy_m”ge
 +ğ
num_s¡_’Œy_m”ge
;

223 ià(
	gnum_s¡_’Œy_Ùh”
 > 0) {

224 
	grocksdb_num_s¡_’Œy_Ùh”
 +ğ
num_s¡_’Œy_Ùh”
;

227 
	gRdb_šdex_¡©s
 &
	g¡©
 : 
m_¡©s
) {

228 
m_ÿrdš®™y_cŞËùÜ
.
Adju¡Sts
(&
¡©
);

230 
	g´İ”t›s
->
š£¹
({
INDEXSTATS_KEY
, 
Rdb_šdex_¡©s
::
m©”Ÿlize
(
m_¡©s
)});

231  
	grocksdb
::
Stus
::
OK
();

234 
boŞ
 
	gRdb_tbl_´İ_cŞl
::
N“dCom·ù
() const {

235  
m_·¿ms
.
m_d–‘es
 && (m_·¿ms.
m_wšdow
 > 0) &&

236 (
m_fe_size
 > 
m_·¿ms
.m_file_size) &&

237 (
m_max_d–‘ed_rows
 > 
m_·¿ms
.
m_d–‘es
);

243 
	grocksdb
::
U£rCŞËùedPrİ”t›s


244 
Rdb_tbl_´İ_cŞl
::
G‘R—dabËPrİ”t›s
() const {

245 
¡d
::
¡ršg
 
s
;

246 #ifdeà
DBUG_OFF


247 
	gs
.
­³nd
("[...");

248 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
m_¡©s
.
size
()));

249 
	gs
.
­³nd
("„ecords...]");

251 
boŞ
 
	gfœ¡
 = 
Œue
;

252 autØ
	g™
 : 
m_¡©s
) {

253 ià(
fœ¡
) {

254 
fœ¡
 = 
çl£
;

256 
	gs
.
­³nd
(",");

258 
	gs
.
­³nd
(
G‘R—dabËSts
(
™
));

261  
	grocksdb
::
U£rCŞËùedPrİ”t›s
{{
INDEXSTATS_KEY
, 
	gs
}};

264 
	g¡d
::
¡ršg
 
Rdb_tbl_´İ_cŞl
::
G‘R—dabËSts
(cÚ¡ 
Rdb_šdex_¡©s
 &
™
) {

265 
¡d
::
¡ršg
 
s
;

266 
	gs
.
­³nd
("(");

267 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_gl_šdex_id
.
cf_id
));

268 
	gs
.
­³nd
(", ");

269 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_gl_šdex_id
.
šdex_id
));

270 
	gs
.
­³nd
("):{name:");

271 
	gs
.
­³nd
(
™
.
m_Çme
);

272 
	gs
.
­³nd
(", size:");

273 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_d©a_size
));

274 
	gs
.
­³nd
(", m_rows:");

275 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_rows
));

276 
	gs
.
­³nd
(", m_actual_disk_size:");

277 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_aùu®_disk_size
));

278 
	gs
.
­³nd
(", deletes:");

279 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_’Œy_d–‘es
));

280 
	gs
.
­³nd
(", single_deletes:");

281 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_’Œy_sšgË_d–‘es
));

282 
	gs
.
­³nd
(", merges:");

283 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_’Œy_m”ges
));

284 
	gs
.
­³nd
(", others:");

285 
	gs
.
­³nd
(
¡d
::
to_¡ršg
(
™
.
m_’Œy_Ùh”s
));

286 
	gs
.
­³nd
(", distincts…er…refix: [");

287 autØ
	gnum
 : 
™
.
m_di¡šù_keys_³r_´efix
) {

288 
s
.
­³nd
(
¡d
::
to_¡ršg
(
num
));

289 
	gs
.
­³nd
(" ");

291 
	gs
.
­³nd
("]}");

292  
	gs
;

299 
	gRdb_tbl_´İ_cŞl
::
»ad_¡©s_äom_tbl_´İs
(

300 cÚ¡ 
¡d
::
sh¬ed_±r
<cÚ¡ 
rocksdb
::
TabËPrİ”t›s
> &
bË_´İs
,

301 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> *cÚ¡ 
out_¡©s_veùÜ
) {

302 
DBUG_ASSERT
(
out_¡©s_veùÜ
 !ğ
nuÎ±r
);

303 cÚ¡‡utØ&
	gu£r_´İ”t›s
 = 
bË_´İs
->
u£r_cŞËùed_´İ”t›s
;

304 cÚ¡‡utØ
	g™2
 = 
u£r_´İ”t›s
.
fšd
(
¡d
::
¡ršg
(
INDEXSTATS_KEY
));

305 ià(
	g™2
 !ğ
u£r_´İ”t›s
.
’d
()) {

306 autØ
»suÉ
 
MY_ATTRIBUTE
((
__unu£d__
)) =

307 
Rdb_šdex_¡©s
::
unm©”Ÿlize
(
™2
->
£cÚd
, 
out_¡©s_veùÜ
);

308 
DBUG_ASSERT
(
»suÉ
 == 0);

315 
	g¡d
::
¡ršg


316 
Rdb_šdex_¡©s
::
m©”Ÿlize
(cÚ¡ 
¡d
::
veùÜ
<Rdb_šdex_¡©s> &
¡©s
) {

317 
SŒšg
 
»t
;

318 
rdb_Ãt¡r_­³nd_ušt16
(&
»t
, 
INDEX_STATS_VERSION_ENTRY_TYPES
);

319 cÚ¡‡utØ&
	gi
 : 
¡©s
) {

320 
rdb_Ãt¡r_­³nd_ušt32
(&
»t
, 
i
.
m_gl_šdex_id
.
cf_id
);

321 
rdb_Ãt¡r_­³nd_ušt32
(&
»t
, 
i
.
m_gl_šdex_id
.
šdex_id
);

322 
DBUG_ASSERT
( 
i
.
m_d©a_size
 <= 8);

323 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
i
.
m_d©a_size
);

324 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
i
.
m_rows
);

325 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
i
.
m_aùu®_disk_size
);

326 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
i
.
m_di¡šù_keys_³r_´efix
.
size
());

327 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
i
.
m_’Œy_d–‘es
);

328 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
i
.
m_’Œy_sšgË_d–‘es
);

329 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
i
.
m_’Œy_m”ges
);

330 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
i
.
m_’Œy_Ùh”s
);

331 cÚ¡‡utØ&
	gnum_keys
 : 
i
.
m_di¡šù_keys_³r_´efix
) {

332 
rdb_Ãt¡r_­³nd_ušt64
(&
»t
, 
num_keys
);

336  
	g¡d
::
¡ršg
((*)
»t
.
±r
(),„‘.
Ëngth
());

345 
	gRdb_šdex_¡©s
::
unm©”Ÿlize
(cÚ¡ 
¡d
::
¡ršg
 &
s
,

346 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> *cÚ¡ 
»t
) {

347 cÚ¡ 
uch¬
 *
p
 = 
rdb_¡d_¡r_to_uch¬_±r
(
s
);

348 cÚ¡ 
uch¬
 *cÚ¡ 
	gp2
 = 
p
 + 
s
.
size
();

350 
DBUG_ASSERT
(
»t
 !ğ
nuÎ±r
);

352 ià(
	gp
 + 2 > 
	gp2
) {

353  
	gHA_EXIT_FAILURE
;

356 cÚ¡ 
	gv”siÚ
 = 
rdb_Ãtbuf_»ad_ušt16
(&
p
);

357 
Rdb_šdex_¡©s
 
	g¡©s
;

359 ià(
	gv”siÚ
 < 
	gINDEX_STATS_VERSION_INITIAL
 ||

360 
	gv”siÚ
 > 
	gINDEX_STATS_VERSION_ENTRY_TYPES
) {

362 
sql_´št_”rÜ
("Index stats version %d was outside of supported„ange. "

364 
v”siÚ
);

365 
abÜt
();

368 
size_t
 
	gÃeded
 = (
¡©s
.
m_gl_šdex_id
.
cf_id
) +

369 (
¡©s
.
m_gl_šdex_id
.
šdex_id
) +

370 (
¡©s
.
m_d©a_size
è+ (¡©s.
m_rows
) +

371 (
¡©s
.
m_aùu®_disk_size
è+ (
ušt64
);

372 ià(
	gv”siÚ
 >ğ
INDEX_STATS_VERSION_ENTRY_TYPES
) {

373 
Ãeded
 +ğ(
¡©s
.
m_’Œy_d–‘es
) +

374 (
¡©s
.
m_’Œy_sšgË_d–‘es
) +

375 (
¡©s
.
m_’Œy_m”ges
è+ (¡©s.
m_’Œy_Ùh”s
);

378 
	gp
 < 
	gp2
) {

379 ià(
	gp
 + 
	gÃeded
 > 
	gp2
) {

380  
	gHA_EXIT_FAILURE
;

382 
rdb_Ãtbuf_»ad_gl_šdex
(&
p
, &
¡©s
.
m_gl_šdex_id
);

383 
	g¡©s
.
	gm_d©a_size
 = 
rdb_Ãtbuf_»ad_ušt64
(&
p
);

384 
	g¡©s
.
	gm_rows
 = 
rdb_Ãtbuf_»ad_ušt64
(&
p
);

385 
	g¡©s
.
	gm_aùu®_disk_size
 = 
rdb_Ãtbuf_»ad_ušt64
(&
p
);

386 
	g¡©s
.
	gm_di¡šù_keys_³r_´efix
.
»size
(
rdb_Ãtbuf_»ad_ušt64
(&
p
));

387 ià(
	gv”siÚ
 >ğ
INDEX_STATS_VERSION_ENTRY_TYPES
) {

388 
¡©s
.
m_’Œy_d–‘es
 = 
rdb_Ãtbuf_»ad_ušt64
(&
p
);

389 
	g¡©s
.
	gm_’Œy_sšgË_d–‘es
 = 
rdb_Ãtbuf_»ad_ušt64
(&
p
);

390 
	g¡©s
.
	gm_’Œy_m”ges
 = 
rdb_Ãtbuf_»ad_ušt64
(&
p
);

391 
	g¡©s
.
	gm_’Œy_Ùh”s
 = 
rdb_Ãtbuf_»ad_ušt64
(&
p
);

393 ià(
	gp
 +

394 
	g¡©s
.
	gm_di¡šù_keys_³r_´efix
.
size
() *

395 (
	g¡©s
.
	gm_di¡šù_keys_³r_´efix
[0]) >

396 
	gp2
) {

397  
	gHA_EXIT_FAILURE
;

399 
	g¡d
::
size_t
 
i
 = 0; 
	gi
 < 
	g¡©s
.
	gm_di¡šù_keys_³r_´efix
.
size
(); i++) {

400 
	g¡©s
.
	gm_di¡šù_keys_³r_´efix
[
i
] = 
rdb_Ãtbuf_»ad_ušt64
(&
p
);

402 
	g»t
->
push_back
(
¡©s
);

404  
	gHA_EXIT_SUCCESS
;

411 
	gRdb_šdex_¡©s
::
m”ge
(cÚ¡ 
Rdb_šdex_¡©s
 &
s
, cÚ¡ 
boŞ
 &
šüem’t
,

412 cÚ¡ 
št64_t
 &
e¡im©ed_d©a_Ën
) {

413 
	g¡d
::
size_t
 
i
;

415 
DBUG_ASSERT
(
e¡im©ed_d©a_Ën
 >= 0);

417 
	gm_gl_šdex_id
 = 
s
.
m_gl_šdex_id
;

418 ià(
	gm_di¡šù_keys_³r_´efix
.
size
(è< 
	gs
.m_distinct_keys_per_prefix.size()) {

419 
	gm_di¡šù_keys_³r_´efix
.
»size
(
s
.
m_di¡šù_keys_³r_´efix
.
size
());

421 ià(
	gšüem’t
) {

422 
	gm_rows
 +ğ
s
.
m_rows
;

423 
	gm_d©a_size
 +ğ
s
.
m_d©a_size
;

432 
	gm_aùu®_disk_size
 +ğ
s
.
m_aùu®_disk_size
 ? s.m_actual_disk_size

433 : 
e¡im©ed_d©a_Ën
 * 
s
.
m_rows
;

434 
	gm_’Œy_d–‘es
 +ğ
s
.
m_’Œy_d–‘es
;

435 
	gm_’Œy_sšgË_d–‘es
 +ğ
s
.
m_’Œy_sšgË_d–‘es
;

436 
	gm_’Œy_m”ges
 +ğ
s
.
m_’Œy_m”ges
;

437 
	gm_’Œy_Ùh”s
 +ğ
s
.
m_’Œy_Ùh”s
;

438 
	gi
 = 0; i < 
	gs
.
	gm_di¡šù_keys_³r_´efix
.
size
(); i++) {

439 
	gm_di¡šù_keys_³r_´efix
[
i
] +ğ
s
.
m_di¡šù_keys_³r_´efix
[i];

442 
	gm_rows
 -ğ
s
.
m_rows
;

443 
	gm_d©a_size
 -ğ
s
.
m_d©a_size
;

444 
	gm_aùu®_disk_size
 -ğ
s
.
m_aùu®_disk_size
 ? s.m_actual_disk_size

445 : 
e¡im©ed_d©a_Ën
 * 
s
.
m_rows
;

446 
	gm_’Œy_d–‘es
 -ğ
s
.
m_’Œy_d–‘es
;

447 
	gm_’Œy_sšgË_d–‘es
 -ğ
s
.
m_’Œy_sšgË_d–‘es
;

448 
	gm_’Œy_m”ges
 -ğ
s
.
m_’Œy_m”ges
;

449 
	gm_’Œy_Ùh”s
 -ğ
s
.
m_’Œy_Ùh”s
;

450 
	gi
 = 0; i < 
	gs
.
	gm_di¡šù_keys_³r_´efix
.
size
(); i++) {

451 
	gm_di¡šù_keys_³r_´efix
[
i
] -ğ
s
.
m_di¡šù_keys_³r_´efix
[i];

456 
	gRdb_tbl_ÿrd_cŞl
::
Rdb_tbl_ÿrd_cŞl
(cÚ¡ 
ušt8_t
 &
bË_¡©s_§m¶šg_pù
)

457 : 
m_bË_¡©s_§m¶šg_pù
(
bË_¡©s_§m¶šg_pù
),

458 
m_£ed
(
time
(
nuÎ±r
)) {}

460 
boŞ
 
	gRdb_tbl_ÿrd_cŞl
::
IsSampšgDi§bËd
() {

462  
m_bË_¡©s_§m¶šg_pù
 == 0 ||

463 
RDB_TBL_STATS_SAMPLE_PCT_MAX
 =ğ
m_bË_¡©s_§m¶šg_pù
;

466 
boŞ
 
	gRdb_tbl_ÿrd_cŞl
::
ShouldCŞËùSts
() {

467 ià(
IsSampšgDi§bËd
()) {

468  
Œue
;

471 cÚ¡ 
	gv®
 = 
¿nd_r
(&
m_£ed
è% (
RDB_TBL_STATS_SAMPLE_PCT_MAX
 -

472 
RDB_TBL_STATS_SAMPLE_PCT_MIN
 + 1) +

473 
RDB_TBL_STATS_SAMPLE_PCT_MIN
;

475 
DBUG_ASSERT
(
v®
 >ğ
RDB_TBL_STATS_SAMPLE_PCT_MIN
);

476 
DBUG_ASSERT
(
v®
 <ğ
RDB_TBL_STATS_SAMPLE_PCT_MAX
);

478  
	gv®
 <ğ
m_bË_¡©s_§m¶šg_pù
;

481 
	gRdb_tbl_ÿrd_cŞl
::
ProûssKey
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

482 cÚ¡ 
Rdb_key_def
 *
keydef
,

483 
Rdb_šdex_¡©s
 *
¡©s
) {

484 ià(
ShouldCŞËùSts
()) {

485 
	g¡d
::
size_t
 
cŞumn
 = 0;

486 
boŞ
 
	gÃw_key
 = 
Œue
;

488 ià(!
	gm_Ï¡_key
.
em±y
()) {

489 
	grocksdb
::
Sliû
 
Ï¡
(
m_Ï¡_key
.
d©a
(), m_Ï¡_key.
size
());

490 
	gÃw_key
 = (
keydef
->
com·»_keys
(&
Ï¡
, &
key
, &
cŞumn
) == 0);

493 ià(
	gÃw_key
) {

494 
DBUG_ASSERT
(
cŞumn
 <ğ
¡©s
->
m_di¡šù_keys_³r_´efix
.
size
());

496 autØ
	gi
 = 
cŞumn
; i < 
	g¡©s
->
	gm_di¡šù_keys_³r_´efix
.
size
(); i++) {

497 
	g¡©s
->
	gm_di¡šù_keys_³r_´efix
[
i
]++;

505 ià(
	gcŞumn
 < 
	g¡©s
->
	gm_di¡šù_keys_³r_´efix
.
size
()) {

506 
	gm_Ï¡_key
.
assign
(
key
.
d©a
(), key.
size
());

512 
	gRdb_tbl_ÿrd_cŞl
::
Re£t
(è{ 
m_Ï¡_key
.
ş—r
(); }

517 
	gRdb_tbl_ÿrd_cŞl
::
Adju¡Sts
(
Rdb_šdex_¡©s
 *
¡©s
) {

518 ià(
IsSampšgDi§bËd
()) {

522 
	gšt64_t
 &
	gnum_keys
 : 
¡©s
->
m_di¡šù_keys_³r_´efix
) {

523 
num_keys
 =‚um_key * 100 / 
m_bË_¡©s_§m¶šg_pù
;

	@properties_collector.h

16 #´agm¨
Úû


19 
	~<m­
>

20 
	~<memÜy
>

21 
	~<¡ršg
>

22 
	~<unÜd”ed_£t
>

23 
	~<veùÜ
>

26 
	~"rocksdb/db.h
"

29 
	~"ha_rocksdb.h
"

31 
Çme¥aû
 
	gmyrocks
 {

33 
şass
 
	gRdb_ddl_mªag”
;

34 
şass
 
	gRdb_key_def
;

36 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_put
;

37 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_d–‘e
;

38 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_sšgËd–‘e
;

39 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_m”ge
;

40 
¡d
::
©omic
<
ušt64_t
> 
rocksdb_num_s¡_’Œy_Ùh”
;

41 
my_boŞ
 
rocksdb_com·ùiÚ_£qu’tŸl_d–‘es_couÁ_sd
;

43 
	sRdb_com·ù_·¿ms
 {

44 
ušt64_t
 
	gm_d–‘es
, 
	gm_wšdow
, 
	gm_fe_size
;

47 
	sRdb_šdex_¡©s
 {

49 
	gINDEX_STATS_VERSION_INITIAL
 = 1,

50 
	gINDEX_STATS_VERSION_ENTRY_TYPES
 = 2,

52 
GL_INDEX_ID
 
	gm_gl_šdex_id
;

53 
št64_t
 
	gm_d©a_size
, 
	gm_rows
, 
	gm_aùu®_disk_size
;

54 
št64_t
 
	gm_’Œy_d–‘es
, 
	gm_’Œy_sšgË_d–‘es
;

55 
št64_t
 
	gm_’Œy_m”ges
, 
	gm_’Œy_Ùh”s
;

56 
	g¡d
::
veùÜ
<
št64_t
> 
m_di¡šù_keys_³r_´efix
;

57 
	g¡d
::
¡ršg
 
m_Çme
;

59 
	g¡d
::
¡ršg
 
m©”Ÿlize
(cÚ¡ 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> &
¡©s
);

60 
unm©”Ÿlize
(cÚ¡ 
¡d
::
¡ršg
 &
s
,

61 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> *cÚ¡ 
»t
);

63 
Rdb_šdex_¡©s
() : Rdb_index_stats({0, 0}) {}

64 
ex¶ic™
 
Rdb_šdex_¡©s
(
GL_INDEX_ID
 
gl_šdex_id
)

65 : 
m_gl_šdex_id
(
gl_šdex_id
), 
m_d©a_size
(0), 
m_rows
(0),

66 
m_aùu®_disk_size
(0), 
m_’Œy_d–‘es
(0), 
m_’Œy_sšgË_d–‘es
(0),

67 
m_’Œy_m”ges
(0), 
m_’Œy_Ùh”s
(0) {}

69 
m”ge
(cÚ¡ 
Rdb_šdex_¡©s
 &
s
, cÚ¡ 
boŞ
 &
šüem’t
 = 
Œue
,

70 cÚ¡ 
št64_t
 &
e¡im©ed_d©a_Ën
 = 0);

74 şas 
	cRdb_tbl_ÿrd_cŞl
 {

75 
	gpublic
:

76 
ex¶ic™
 
Rdb_tbl_ÿrd_cŞl
(cÚ¡ 
ušt8_t
 &
bË_¡©s_§m¶šg_pù
);

78 
	gpublic
:

79 
ProûssKey
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡ 
Rdb_key_def
 *
keydef
,

80 
Rdb_šdex_¡©s
 *
¡©s
);

85 
Re£t
();

95 
Adju¡Sts
(
Rdb_šdex_¡©s
 *
¡©s
);

97 
	g´iv©e
:

98 
boŞ
 
ShouldCŞËùSts
();

99 
boŞ
 
IsSampšgDi§bËd
();

101 
	g´iv©e
:

102 
¡d
::
¡ršg
 
m_Ï¡_key
;

103 
ušt8_t
 
	gm_bË_¡©s_§m¶šg_pù
;

104 
	gm_£ed
;

107 şas 
	cRdb_tbl_´İ_cŞl
 : 
public
 
rocksdb
::
TabËPrİ”t›sCŞËùÜ
 {

108 
public
:

109 
Rdb_tbl_´İ_cŞl
(
Rdb_ddl_mªag”
 *cÚ¡ 
ddl_mªag”
,

110 cÚ¡ 
Rdb_com·ù_·¿ms
 &
·¿ms
, cÚ¡ 
ušt32_t
 &
cf_id
,

111 cÚ¡ 
ušt8_t
 &
bË_¡©s_§m¶šg_pù
);

117 
vœtu®
 
	grocksdb
::
Stus
 
AddU£rKey
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

118 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
,

119 
rocksdb
::
EÁryTy³
 
ty³
,

120 
rocksdb
::
Sequ’ûNumb”
 
£q
,

121 
ušt64_t
 
fe_size
);

123 
vœtu®
 
	grocksdb
::
Stus


124 
Fšish
(
rocksdb
::
U£rCŞËùedPrİ”t›s
 *
´İ”t›s
è
ov”ride
;

126 
vœtu®
 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {  "Rdb_tbl_prop_coll"; }

128 
	grocksdb
::
U£rCŞËùedPrİ”t›s
 
G‘R—dabËPrİ”t›s
(ècÚ¡ 
ov”ride
;

130 
boŞ
 
N“dCom·ù
(ècÚ¡ 
	gov”ride
;

132 
	gpublic
:

133 
ušt64_t
 
G‘MaxD–‘edRows
(ècÚ¡ {  
m_max_d–‘ed_rows
; }

135 
»ad_¡©s_äom_tbl_´İs
(

136 cÚ¡ 
¡d
::
sh¬ed_±r
<cÚ¡ 
rocksdb
::
TabËPrİ”t›s
> &
bË_´İs
,

137 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> *
out_¡©s_veùÜ
);

139 
	g´iv©e
:

140 
¡d
::
¡ršg
 
G‘R—dabËSts
(cÚ¡ 
Rdb_šdex_¡©s
 &
™
);

142 
boŞ
 
ShouldCŞËùSts
();

143 
CŞËùStsFÜRow
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

144 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
,

145 cÚ¡ 
rocksdb
::
EÁryTy³
 &
ty³
,

146 cÚ¡ 
ušt64_t
 &
fe_size
);

147 
Rdb_šdex_¡©s
 *
AcûssSts
(cÚ¡ 
rocksdb
::
Sliû
 &
key
);

148 
Adju¡D–‘edRows
(
rocksdb
::
EÁryTy³
 
ty³
);

150 
	g´iv©e
:

151 
ušt32_t
 
m_cf_id
;

152 
	g¡d
::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
> 
m_keydef
;

153 
Rdb_ddl_mªag”
 *
	gm_ddl_mªag”
;

154 
	g¡d
::
veùÜ
<
Rdb_šdex_¡©s
> 
m_¡©s
;

155 
Rdb_šdex_¡©s
 *
	gm_Ï¡_¡©s
;

156 cÚ¡ *
	gINDEXSTATS_KEY
;

159 
	g¡d
::
¡ršg
 
m_Ï¡_key
;

162 
	g¡d
::
veùÜ
<
boŞ
> 
m_d–‘ed_rows_wšdow
;

163 
ušt64_t
 
	gm_rows
, 
	gm_wšdow_pos
, 
	gm_d–‘ed_rows
, 
	gm_max_d–‘ed_rows
;

164 
ušt64_t
 
	gm_fe_size
;

165 
Rdb_com·ù_·¿ms
 
	gm_·¿ms
;

166 
Rdb_tbl_ÿrd_cŞl
 
	gm_ÿrdš®™y_cŞËùÜ
;

169 şas 
	cRdb_tbl_´İ_cŞl_çùÜy


170 : 
public
 
rocksdb
::
TabËPrİ”t›sCŞËùÜFaùÜy
 {

171 
public
:

172 
Rdb_tbl_´İ_cŞl_çùÜy
(cÚ¡ Rdb_tbl_´İ_cŞl_çùÜy &èğ
d–‘e
;

173 
	gRdb_tbl_´İ_cŞl_çùÜy
 &

174 
	gİ”©Ü
=(cÚ¡ 
Rdb_tbl_´İ_cŞl_çùÜy
 &èğ
d–‘e
;

176 
ex¶ic™
 
Rdb_tbl_´İ_cŞl_çùÜy
(
Rdb_ddl_mªag”
 *
ddl_mªag”
)

177 : 
m_ddl_mªag”
(
ddl_mªag”
) {}

183 
vœtu®
 
rocksdb
::
TabËPrİ”t›sCŞËùÜ
 *
C»©eTabËPrİ”t›sCŞËùÜ
(

184 
rocksdb
::
TabËPrİ”t›sCŞËùÜFaùÜy
::
CÚ‹xt
 
cÚ‹xt
è
ov”ride
 {

185  
Ãw
 
Rdb_tbl_´İ_cŞl
(
m_ddl_mªag”
, 
m_·¿ms
,

186 
cÚ‹xt
.
cŞumn_çmy_id
,

187 
m_bË_¡©s_§m¶šg_pù
);

190 
vœtu®
 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {

194 
	gpublic
:

195 
S‘Com·ùiÚP¬ams
(cÚ¡ 
Rdb_com·ù_·¿ms
 &
·¿ms
) {

196 
m_·¿ms
 = 
·¿ms
;

199 
S‘TabËStsSam¶šgPù
(cÚ¡ 
ušt8_t
 &
bË_¡©s_§m¶šg_pù
) {

200 
	gm_bË_¡©s_§m¶šg_pù
 = 
bË_¡©s_§m¶šg_pù
;

203 
	g´iv©e
:

204 
Rdb_ddl_mªag”
 *cÚ¡ 
m_ddl_mªag”
;

205 
Rdb_com·ù_·¿ms
 
	gm_·¿ms
;

206 
ušt8_t
 
	gm_bË_¡©s_§m¶šg_pù
;

	@rdb_buff.h

17 #´agm¨
Úû


19 
	~<®gÜ™hm
>

20 
	~<¡ršg
>

21 
	~<veùÜ
>

23 
Çme¥aû
 
	gmyrocks
 {

30 
šlše
 
rdb_Ãt¡r_­³nd_ušt64
(
my_cÜe
::
SŒšg
 *cÚ¡ 
out_Ãt¡r
,

31 cÚ¡ 
ušt64
 &
v®
) {

32 
DBUG_ASSERT
(
out_Ãt¡r
 !ğ
nuÎ±r
);

36 
ušt64
 
	gÃt_v®
 = 
htobe64
(
v®
);

37 
	gout_Ãt¡r
->
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ãt_v®
), (net_val));

40 
šlše
 
rdb_Ãt¡r_­³nd_ušt32
(
my_cÜe
::
SŒšg
 *cÚ¡ 
out_Ãt¡r
,

41 cÚ¡ 
ušt32
 &
v®
) {

42 
DBUG_ASSERT
(
out_Ãt¡r
 !ğ
nuÎ±r
);

46 
ušt32
 
	gÃt_v®
 = 
htobe32
(
v®
);

47 
	gout_Ãt¡r
->
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ãt_v®
), (net_val));

50 
šlše
 
rdb_Ãt¡r_­³nd_ušt16
(
my_cÜe
::
SŒšg
 *cÚ¡ 
out_Ãt¡r
,

51 cÚ¡ 
ušt16
 &
v®
) {

52 
DBUG_ASSERT
(
out_Ãt¡r
 !ğ
nuÎ±r
);

56 
ušt16
 
	gÃt_v®
 = 
htobe16
(
v®
);

57 
	gout_Ãt¡r
->
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ãt_v®
), (net_val));

64 
šlše
 
rdb_Ãtbuf_¡Üe_ušt64
(
uch¬
 *cÚ¡ 
d¡_Ãtbuf
, cÚ¡ 
ušt64
 &
n
) {

65 
DBUG_ASSERT
(
d¡_Ãtbuf
 !ğ
nuÎ±r
);

69 
ušt64
 
	gÃt_v®
 = 
htobe64
(
n
);

70 
memıy
(
d¡_Ãtbuf
, &
Ãt_v®
, (net_val));

73 
šlše
 
rdb_Ãtbuf_¡Üe_ušt32
(
uch¬
 *cÚ¡ 
d¡_Ãtbuf
, cÚ¡ 
ušt32
 &
n
) {

74 
DBUG_ASSERT
(
d¡_Ãtbuf
 !ğ
nuÎ±r
);

78 
ušt32
 
	gÃt_v®
 = 
htobe32
(
n
);

79 
memıy
(
d¡_Ãtbuf
, &
Ãt_v®
, (net_val));

82 
šlše
 
rdb_Ãtbuf_¡Üe_ušt16
(
uch¬
 *cÚ¡ 
d¡_Ãtbuf
, cÚ¡ 
ušt16
 &
n
) {

83 
DBUG_ASSERT
(
d¡_Ãtbuf
 !ğ
nuÎ±r
);

87 
ušt16
 
	gÃt_v®
 = 
htobe16
(
n
);

88 
memıy
(
d¡_Ãtbuf
, &
Ãt_v®
, (net_val));

91 
šlše
 
rdb_Ãtbuf_¡Üe_by‹
(
uch¬
 *cÚ¡ 
d¡_Ãtbuf
, cÚ¡ uch¬ &
c
) {

92 
DBUG_ASSERT
(
d¡_Ãtbuf
 !ğ
nuÎ±r
);

94 *
	gd¡_Ãtbuf
 = 
c
;

97 
šlše
 
rdb_Ãtbuf_¡Üe_šdex
(
uch¬
 *cÚ¡ 
d¡_Ãtbuf
,

98 cÚ¡ 
ušt32
 &
numb”
) {

99 
DBUG_ASSERT
(
d¡_Ãtbuf
 !ğ
nuÎ±r
);

101 
rdb_Ãtbuf_¡Üe_ušt32
(
d¡_Ãtbuf
, 
numb”
);

109 
šlše
 
ušt64
 
rdb_Ãtbuf_to_ušt64
(cÚ¡ 
uch¬
 *cÚ¡ 
Ãtbuf
) {

110 
DBUG_ASSERT
(
Ãtbuf
 !ğ
nuÎ±r
);

112 
ušt64
 
	gÃt_v®
;

113 
memıy
(&
Ãt_v®
, 
Ãtbuf
, (net_val));

117  
be64toh
(
Ãt_v®
);

120 
šlše
 
ušt32
 
rdb_Ãtbuf_to_ušt32
(cÚ¡ 
uch¬
 *cÚ¡ 
Ãtbuf
) {

121 
DBUG_ASSERT
(
Ãtbuf
 !ğ
nuÎ±r
);

123 
ušt32
 
	gÃt_v®
;

124 
memıy
(&
Ãt_v®
, 
Ãtbuf
, (net_val));

128  
be32toh
(
Ãt_v®
);

131 
šlše
 
ušt16
 
rdb_Ãtbuf_to_ušt16
(cÚ¡ 
uch¬
 *cÚ¡ 
Ãtbuf
) {

132 
DBUG_ASSERT
(
Ãtbuf
 !ğ
nuÎ±r
);

134 
ušt16
 
	gÃt_v®
;

135 
memıy
(&
Ãt_v®
, 
Ãtbuf
, (net_val));

139  
be16toh
(
Ãt_v®
);

142 
šlše
 
uch¬
 
rdb_Ãtbuf_to_by‹
(cÚ¡ uch¬ *cÚ¡ 
Ãtbuf
) {

143 
DBUG_ASSERT
(
Ãtbuf
 !ğ
nuÎ±r
);

145  (
	guch¬
)
	gÃtbuf
[0];

155 
šlše
 
ušt64
 
rdb_Ãtbuf_»ad_ušt64
(cÚ¡ 
uch¬
 **
Ãtbuf_±r
) {

156 
DBUG_ASSERT
(
Ãtbuf_±r
 !ğ
nuÎ±r
);

160 cÚ¡ 
ušt64
 
	gho¡_v®
 = 
rdb_Ãtbuf_to_ušt64
(*
Ãtbuf_±r
);

163 *
	gÃtbuf_±r
 +ğ(
ho¡_v®
);

165  
	gho¡_v®
;

168 
šlše
 
ušt32
 
rdb_Ãtbuf_»ad_ušt32
(cÚ¡ 
uch¬
 **
Ãtbuf_±r
) {

169 
DBUG_ASSERT
(
Ãtbuf_±r
 !ğ
nuÎ±r
);

173 cÚ¡ 
ušt32
 
	gho¡_v®
 = 
rdb_Ãtbuf_to_ušt32
(*
Ãtbuf_±r
);

176 *
	gÃtbuf_±r
 +ğ(
ho¡_v®
);

178  
	gho¡_v®
;

181 
šlše
 
ušt16
 
rdb_Ãtbuf_»ad_ušt16
(cÚ¡ 
uch¬
 **
Ãtbuf_±r
) {

182 
DBUG_ASSERT
(
Ãtbuf_±r
 !ğ
nuÎ±r
);

186 cÚ¡ 
ušt16
 
	gho¡_v®
 = 
rdb_Ãtbuf_to_ušt16
(*
Ãtbuf_±r
);

189 *
	gÃtbuf_±r
 +ğ(
ho¡_v®
);

191  
	gho¡_v®
;

194 
šlše
 
rdb_Ãtbuf_»ad_gl_šdex
(cÚ¡ 
uch¬
 **
Ãtbuf_±r
,

195 
GL_INDEX_ID
 *cÚ¡ 
gl_šdex_id
) {

196 
DBUG_ASSERT
(
gl_šdex_id
 !ğ
nuÎ±r
);

197 
DBUG_ASSERT
(
Ãtbuf_±r
 !ğ
nuÎ±r
);

199 
	ggl_šdex_id
->
	gcf_id
 = 
rdb_Ãtbuf_»ad_ušt32
(
Ãtbuf_±r
);

200 
	ggl_šdex_id
->
	gšdex_id
 = 
rdb_Ãtbuf_»ad_ušt32
(
Ãtbuf_±r
);

209 şas 
	cRdb_¡ršg_»ad”
 {

210 cÚ¡ *
	gm_±r
;

211 
ušt
 
	gm_Ën
;

213 
	g´iv©e
:

214 
Rdb_¡ršg_»ad”
 &
İ”©Ü
=(const Rdb_string_reader &) = ;

216 
	gpublic
:

217 
Rdb_¡ršg_»ad”
(const Rdb_string_reader &) = ;

219 
Rdb_¡ršg_»ad”
 
»ad_Ü_em±y
(cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
¦iû
) {

220 ià(!
¦iû
) {

221  
Rdb_¡ršg_»ad”
("");

223  
Rdb_¡ršg_»ad”
(
¦iû
);

227 
ex¶ic™
 
Rdb_¡ršg_»ad”
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
) {

228 
m_Ën
 = 
¡r
.
Ëngth
();

229 ià(
	gm_Ën
) {

230 
	gm_±r
 = &
¡r
.
©
(0);

238 
	gm_±r
 = 
nuÎ±r
;

242 
ex¶ic™
 
Rdb_¡ršg_»ad”
(cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
¦iû
) {

243 
m_±r
 = 
¦iû
->
d©a
();

244 
	gm_Ën
 = 
¦iû
->
size
();

251 cÚ¡ *
»ad
(cÚ¡ 
ušt
 &
size
) {

252 cÚ¡ *
	g»s
;

253 ià(
	gm_Ën
 < 
	gsize
) {

254 
	g»s
 = 
nuÎ±r
;

256 
	g»s
 = 
m_±r
;

257 
	gm_±r
 +ğ
size
;

258 
	gm_Ën
 -ğ
size
;

260  
	g»s
;

263 
boŞ
 
»ad_ušt8
(
ušt
 *cÚ¡ 
»s
) {

264 cÚ¡ 
uch¬
 *
	gp
;

265 ià(!(
	gp
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
»ad
(1))))

266  
Œue
;

268 *
	g»s
 = *
p
;

269  
	gçl£
;

273 
boŞ
 
»ad_ušt16
(
ušt
 *cÚ¡ 
»s
) {

274 cÚ¡ 
uch¬
 *
	gp
;

275 ià(!(
	gp
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
»ad
(2))))

276  
Œue
;

278 *
	g»s
 = 
rdb_Ãtbuf_to_ušt16
(
p
);

279  
	gçl£
;

283 
boŞ
 
»ad_ušt64
(
ušt64
 *cÚ¡ 
»s
) {

284 cÚ¡ 
uch¬
 *
	gp
;

285 ià(!(
	gp
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
»ad
((
ušt64
))))) {

286  
Œue
;

288 *
	g»s
 = 
rdb_Ãtbuf_to_ušt64
(
p
);

289  
	gçl£
;

293 
ušt
 
»maššg_by‹s
(ècÚ¡ {  
	gm_Ën
; }

300 cÚ¡ *
g‘_cu¼’t_±r
(ècÚ¡ {  
	gm_±r
; }

318 şas 
	cRdb_¡ršg_wr™”
 {

319 
	g¡d
::
veùÜ
<
uch¬
> 
m_d©a
;

321 
	gpublic
:

322 
Rdb_¡ršg_wr™”
(cÚ¡ Rdb_¡ršg_wr™” &èğ
d–‘e
;

323 
	gRdb_¡ršg_wr™”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_¡ršg_wr™”
 &èğ
d–‘e
;

324 
Rdb_¡ršg_wr™”
() = ;

326 
ş—r
(è{ 
	gm_d©a
.clear(); }

327 
wr™e_ušt8
(cÚ¡ 
ušt
 &
v®
) {

328 
	gm_d©a
.
push_back
(
¡©ic_ÿ¡
<
uch¬
>(
v®
));

331 
wr™e_ušt16
(cÚ¡ 
ušt
 &
v®
) {

332 cÚ¡‡utØ
	gsize
 = 
m_d©a
.
size
();

333 
	gm_d©a
.
»size
(
size
 + 2);

334 
rdb_Ãtbuf_¡Üe_ušt16
(
m_d©a
.
d©a
(è+ 
size
, 
v®
);

337 
wr™e_ušt32
(cÚ¡ 
ušt
 &
v®
) {

338 cÚ¡‡utØ
	gsize
 = 
m_d©a
.
size
();

339 
	gm_d©a
.
»size
(
size
 + 4);

340 
rdb_Ãtbuf_¡Üe_ušt32
(
m_d©a
.
d©a
(è+ 
size
, 
v®
);

343 
wr™e
(cÚ¡ 
uch¬
 *cÚ¡ 
Ãw_d©a
, cÚ¡ 
size_t
 &
Ën
) {

344 
DBUG_ASSERT
(
Ãw_d©a
 !ğ
nuÎ±r
);

345 
	gm_d©a
.
š£¹
(
m_d©a
.
’d
(), 
Ãw_d©a
,‚ew_d©¨+ 
Ën
);

348 
uch¬
 *
±r
(è{  
	gm_d©a
.
d©a
(); }

349 
size_t
 
g‘_cu¼’t_pos
(ècÚ¡ {  
	gm_d©a
.
size
(); }

351 
wr™e_ušt8_©
(cÚ¡ 
size_t
 &
pos
, cÚ¡ 
ušt
 &
Ãw_v®
) {

353 
DBUG_ASSERT
(
pos
 < 
g‘_cu¼’t_pos
());

354 
	gm_d©a
.
d©a
()[
pos
] = 
Ãw_v®
;

357 
wr™e_ušt16_©
(cÚ¡ 
size_t
 &
pos
, cÚ¡ 
ušt
 &
Ãw_v®
) {

359 
DBUG_ASSERT
(
pos
 < 
g‘_cu¼’t_pos
() && (pos + 1) < get_current_pos());

360 
rdb_Ãtbuf_¡Üe_ušt16
(
m_d©a
.
d©a
(è+ 
pos
, 
Ãw_v®
);

363 
Œunÿ‹
(cÚ¡ 
size_t
 &
pos
) {

364 
DBUG_ASSERT
(
pos
 < 
m_d©a
.
size
());

365 
	gm_d©a
.
»size
(
pos
);

368 
®loÿ‹
(cÚ¡ 
size_t
 &
Ën
, cÚ¡ 
uch¬
 &
v®
 = 0) {

369 
DBUG_ASSERT
(
Ën
 > 0);

370 
	gm_d©a
.
»size
(
m_d©a
.
size
(è+ 
Ën
, 
v®
);

377 
ä“
(è{ 
	g¡d
::
veùÜ
<
uch¬
>().
sw­
(
m_d©a
); }

386 şas 
	cRdb_b™_wr™”
 {

387 
Rdb_¡ršg_wr™”
 *
	gm_wr™”
;

388 
uch¬
 
	gm_off£t
;

390 
	gpublic
:

391 
Rdb_b™_wr™”
(cÚ¡ Rdb_b™_wr™” &èğ
d–‘e
;

392 
	gRdb_b™_wr™”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_b™_wr™”
 &èğ
d–‘e
;

394 
ex¶ic™
 
Rdb_b™_wr™”
(
Rdb_¡ršg_wr™”
 *
wr™”_¬g
)

395 : 
m_wr™”
(
wr™”_¬g
), 
m_off£t
(0) {}

397 
wr™e
(
ušt
 
size
, cÚ¡ ušˆ&
v®ue
) {

398 
DBUG_ASSERT
((
v®ue
 & ((1 << 
size
) - 1)) == value);

400 
	gsize
 > 0) {

401 ià(
	gm_off£t
 == 0) {

402 
m_wr™”
->
wr™e_ušt8
(0);

405 cÚ¡ 
ušt
 
	gb™s
 = 
¡d
::
mš
(
size
, (ušt)(8 - 
m_off£t
));

406 
uch¬
 *cÚ¡ 
	gÏ¡_by‹
 =

407 
m_wr™”
->
±r
(è+ m_wr™”->
g‘_cu¼’t_pos
() - 1;

408 *
	gÏ¡_by‹
 |ğ(
uch¬
)((
v®ue
 >> (
size
 - 
b™s
)) & ((1 << bits) - 1))

409 << 
m_off£t
;

410 
	gsize
 -ğ
b™s
;

411 
	gm_off£t
 = (
m_off£t
 + 
b™s
) & 0x7;

416 şas 
	cRdb_b™_»ad”
 {

417 cÚ¡ 
uch¬
 *
	gm_cur
;

418 
uch¬
 
	gm_off£t
;

419 
ušt
 
	gm_»t
;

420 
Rdb_¡ršg_»ad”
 *cÚ¡ 
	gm_»ad”
;

422 
	gpublic
:

423 
Rdb_b™_»ad”
(cÚ¡ Rdb_b™_»ad” &èğ
d–‘e
;

424 
	gRdb_b™_»ad”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_b™_»ad”
 &èğ
d–‘e
;

426 
ex¶ic™
 
Rdb_b™_»ad”
(
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
)

427 : 
m_cur
(
nuÎ±r
), 
m_off£t
(0), 
m_»ad”
(
»ad”
) {}

432 
ušt
 *
»ad
(ušˆ
size
) {

433 
	gm_»t
 = 0;

434 
DBUG_ASSERT
(
size
 <= 32);

436 
	gsize
 > 0) {

437 ià(
	gm_off£t
 == 0) {

438 
m_cur
 = (cÚ¡ 
uch¬
 *)
m_»ad”
->
»ad
(1);

439 ià(
	gm_cur
 =ğ
nuÎ±r
) {

440  
nuÎ±r
;

444 cÚ¡ 
ušt
 
	gb™s
 = 
¡d
::
mš
((ušt)(8 - 
m_off£t
), 
size
);

445 
	gm_»t
 <<ğ
b™s
;

446 
	gm_»t
 |ğ(*
m_cur
 >> 
m_off£t
è& ((1 << 
b™s
) - 1);

447 
	gsize
 -ğ
b™s
;

448 
	gm_off£t
 = (
m_off£t
 + 
b™s
) & 0x7;

451  &
	gm_»t
;

	@rdb_cf_manager.cc

17 #ifdeà
USE_PRAGMA_IMPLEMENTATION


18 #´agm¨
im¶em’tiÚ


22 
	~"rdb_cf_mªag”.h
"

25 
	~"ha_rocksdb.h
"

26 
	~"ha_rocksdb_´Ùo.h
"

27 
	~"rdb_psi.h
"

29 
Çme¥aû
 
	gmyrocks
 {

32 
boŞ
 
	gRdb_cf_mªag”
::
is_cf_Çme_»v”£
(cÚ¡ *cÚ¡ 
Çme
) {

35  (
Çme
 && !
¡ºcmp
(name, "rev:", 4));

38 
	gRdb_cf_mªag”
::
š™
(

39 
¡d
::
unique_±r
<
Rdb_cf_İtiÚs
> 
cf_İtiÚs
,

40 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *> *cÚ¡ 
hªdËs
) {

41 
mysql_mu‹x_š™
(
rdb_cfm_mu‹x_key
, &
m_mu‹x
, 
MY_MUTEX_INIT_FAST
);

43 
DBUG_ASSERT
(
cf_İtiÚs
 !ğ
nuÎ±r
);

44 
DBUG_ASSERT
(
hªdËs
 !ğ
nuÎ±r
);

45 
DBUG_ASSERT
(
hªdËs
->
size
() > 0);

47 
	gm_cf_İtiÚs
 = 
¡d
::
move
(
cf_İtiÚs
);

49 autØ
	gcfh
 : *
hªdËs
) {

50 
DBUG_ASSERT
(
cfh
 !ğ
nuÎ±r
);

51 
	gm_cf_Çme_m­
[
cfh
->
G‘Name
()] = cfh;

52 
	gm_cf_id_m­
[
cfh
->
G‘ID
()] = cfh;

56 
	gRdb_cf_mªag”
::
ş—nup
() {

57 autØ
™
 : 
m_cf_Çme_m­
) {

58 
d–‘e
 
™
.
£cÚd
;

60 
mysql_mu‹x_de¡roy
(&
m_mu‹x
);

61 
	gm_cf_İtiÚs
 = 
nuÎ±r
;

71 
	grocksdb
::
CŞumnFamyHªdË
 *

72 
Rdb_cf_mªag”
::
g‘_Ü_ü—‹_cf
(
rocksdb
::
DB
 *cÚ¡ 
rdb
,

73 cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme_¬g
) {

74 
DBUG_ASSERT
(
rdb
 !ğ
nuÎ±r
);

76 
	grocksdb
::
CŞumnFamyHªdË
 *
cf_hªdË
 = 
nuÎ±r
;

78 ià(
	gcf_Çme_¬g
 =ğ
PER_INDEX_CF_NAME
) {

80 
my_”rÜ
(
ER_PER_INDEX_CF_DEPRECATED
, 
MYF
(0));

81  
	gnuÎ±r
;

84 cÚ¡ 
	g¡d
::
¡ršg
 &
cf_Çme
 =

85 
cf_Çme_¬g
.
em±y
(è? 
DEFAULT_CF_NAME
 : cf_name_arg;

87 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

89 cÚ¡‡utØ
	g™
 = 
m_cf_Çme_m­
.
fšd
(
cf_Çme
);

91 ià(
	g™
 !ğ
m_cf_Çme_m­
.
’d
()) {

92 
cf_hªdË
 = 
™
->
£cÚd
;

95 
	grocksdb
::
CŞumnFamyO±iÚs
 
İts
;

96 
	gm_cf_İtiÚs
->
g‘_cf_İtiÚs
(
cf_Çme
, &
İts
);

99 
sql_´št_šfÜm©iÚ
("RocksDB: creating‡ column family %s",

100 
cf_Çme
.
c_¡r
());

101 
sql_´št_šfÜm©iÚ
(" wr™e_bufãr_size=%ld", 
İts
.
wr™e_bufãr_size
);

102 
sql_´št_šfÜm©iÚ
("¬g‘_fe_size_ba£=%" 
PRIu64
,

103 
İts
.
rg‘_fe_size_ba£
);

105 cÚ¡ 
	grocksdb
::
Stus
 
s
 =

106 
rdb
->
C»©eCŞumnFamy
(
İts
, 
cf_Çme
, &
cf_hªdË
);

108 ià(
	gs
.
ok
()) {

109 
	gm_cf_Çme_m­
[
cf_hªdË
->
G‘Name
()] = cf_handle;

110 
	gm_cf_id_m­
[
cf_hªdË
->
G‘ID
()] = cf_handle;

112 
	gcf_hªdË
 = 
nuÎ±r
;

116 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

118  
	gcf_hªdË
;

125 
	grocksdb
::
CŞumnFamyHªdË
 *

126 
Rdb_cf_mªag”
::
g‘_cf
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme_¬g
) const {

127 
rocksdb
::
CŞumnFamyHªdË
 *
cf_hªdË
;

129 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

131 
	g¡d
::
¡ršg
 
cf_Çme
 = 
cf_Çme_¬g
.
em±y
(è? 
DEFAULT_CF_NAME
 : cf_name_arg;

133 cÚ¡‡utØ
	g™
 = 
m_cf_Çme_m­
.
fšd
(
cf_Çme
);

134 
	gcf_hªdË
 = (
™
 !ğ
m_cf_Çme_m­
.
’d
()è? it->
£cÚd
 : 
nuÎ±r
;

136 ià(!
	gcf_hªdË
) {

138 
sql_´št_w¬nšg
("CŞumÀçmy '%s'‚Ù found.", 
cf_Çme
.
c_¡r
());

141 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

143  
	gcf_hªdË
;

146 
	grocksdb
::
CŞumnFamyHªdË
 *
Rdb_cf_mªag”
::
g‘_cf
(cÚ¡ 
ušt32_t
 &
id
) const {

147 
rocksdb
::
CŞumnFamyHªdË
 *
cf_hªdË
 = 
nuÎ±r
;

149 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

150 cÚ¡‡utØ
	g™
 = 
m_cf_id_m­
.
fšd
(
id
);

151 ià(
	g™
 !ğ
m_cf_id_m­
.
’d
())

152 
cf_hªdË
 = 
™
->
£cÚd
;

153 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

155  
	gcf_hªdË
;

158 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
Rdb_cf_mªag”
::
g‘_cf_Çmes
() const {

159 
¡d
::
veùÜ
<¡d::
¡ršg
> 
Çmes
;

161 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

162 autØ
	g™
 : 
m_cf_Çme_m­
) {

163 
Çmes
.
push_back
(
™
.
fœ¡
);

165 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

167  
	gÇmes
;

170 
	g¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *>

171 
Rdb_cf_mªag”
::
g‘_®l_cf
() const {

172 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *> 
li¡
;

174 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

176 autØ
	g™
 : 
m_cf_id_m­
) {

177 
DBUG_ASSERT
(
™
.
£cÚd
 !ğ
nuÎ±r
);

178 
	gli¡
.
push_back
(
™
.
£cÚd
);

181 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

183  
	gli¡
;

	@rdb_cf_manager.h

17 #´agm¨
Úû


20 
	~<m­
>

21 
	~<¡ršg
>

22 
	~<veùÜ
>

25 
	~"sql_şass.h
"

28 
	~"rocksdb/db.h
"

31 
	~"rdb_cf_İtiÚs.h
"

33 
Çme¥aû
 
	gmyrocks
 {

49 şas 
	cRdb_cf_mªag”
 {

50 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	grocksdb
::
CŞumnFamyHªdË
 *> 
m_cf_Çme_m­
;

51 
	g¡d
::
m­
<
ušt32_t
, 
	grocksdb
::
CŞumnFamyHªdË
 *> 
m_cf_id_m­
;

53 
mubË
 
mysql_mu‹x_t
 
	gm_mu‹x
;

55 
	g¡d
::
unique_±r
<
Rdb_cf_İtiÚs
> 
m_cf_İtiÚs
 = 
nuÎ±r
;

57 
	gpublic
:

58 
Rdb_cf_mªag”
(cÚ¡ Rdb_cf_mªag” &èğ
d–‘e
;

59 
	gRdb_cf_mªag”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_cf_mªag”
 &èğ
d–‘e
;

60 
Rdb_cf_mªag”
() = ;

62 
boŞ
 
is_cf_Çme_»v”£
(cÚ¡ *cÚ¡ 
Çme
);

69 
š™
(
¡d
::
unique_±r
<
Rdb_cf_İtiÚs
> 
cf_İtiÚs
,

70 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *> *cÚ¡ 
hªdËs
);

71 
ş—nup
();

77 
	grocksdb
::
CŞumnFamyHªdË
 *
g‘_Ü_ü—‹_cf
(
rocksdb
::
DB
 *cÚ¡ 
rdb
,

78 cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
);

81 
	grocksdb
::
CŞumnFamyHªdË
 *
g‘_cf
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
) const;

84 
	grocksdb
::
CŞumnFamyHªdË
 *
g‘_cf
(cÚ¡ 
ušt32_t
 &
id
) const;

87 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
g‘_cf_Çmes
() const;

90 
	g¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *> 
g‘_®l_cf
() const;

94 
g‘_cf_İtiÚs
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
,

95 
rocksdb
::
CŞumnFamyO±iÚs
 *cÚ¡ 
İts
)

96 
MY_ATTRIBUTE
((
__nÚnuÎ__
)) {

97 
m_cf_İtiÚs
->
g‘_cf_İtiÚs
(
cf_Çme
, 
İts
);

100 
upd©e_İtiÚs_m­
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
,

101 cÚ¡ 
¡d
::
¡ršg
 &
upd©ed_İtiÚs
) {

102 
m_cf_İtiÚs
->
upd©e
(
cf_Çme
, 
upd©ed_İtiÚs
);

	@rdb_cf_options.cc

17 #ifdeà
USE_PRAGMA_IMPLEMENTATION


18 #´agm¨
im¶em’tiÚ


22 
	~"rdb_cf_İtiÚs.h
"

25 
	~<¡ršg
>

28 
	~"log.h
"

31 
	~"rocksdb/ut™›s/cÚv’›nû.h
"

34 
	~"ha_rocksdb.h
"

35 
	~"rdb_cf_mªag”.h
"

36 
	~"rdb_com·ù_f‹r.h
"

38 
Çme¥aû
 
	gmyrocks
 {

40 
Rdb_pk_com·¿tÜ
 
	gRdb_cf_İtiÚs
::
s_pk_com·¿tÜ
;

41 
Rdb_»v_com·¿tÜ
 
	gRdb_cf_İtiÚs
::
s_»v_pk_com·¿tÜ
;

43 
boŞ
 
	gRdb_cf_İtiÚs
::
š™
(

44 cÚ¡ 
rocksdb
::
BlockBa£dTabËO±iÚs
 &
bË_İtiÚs
,

45 
¡d
::
sh¬ed_±r
<
rocksdb
::
TabËPrİ”t›sCŞËùÜFaùÜy
> 
´İ_cŞl_çùÜy
,

46 cÚ¡ *cÚ¡ 
deçuÉ_cf_İtiÚs
,

47 cÚ¡ *cÚ¡ 
ov”ride_cf_İtiÚs
) {

48 
DBUG_ASSERT
(
deçuÉ_cf_İtiÚs
 !ğ
nuÎ±r
);

49 
DBUG_ASSERT
(
ov”ride_cf_İtiÚs
 !ğ
nuÎ±r
);

51 
	gm_deçuÉ_cf_İts
.
	gcom·¿tÜ
 = &
s_pk_com·¿tÜ
;

52 
	gm_deçuÉ_cf_İts
.
	gcom·ùiÚ_f‹r_çùÜy
.
»£t
(

53 
Ãw
 
Rdb_com·ù_f‹r_çùÜy
);

55 
	gm_deçuÉ_cf_İts
.
	gbË_çùÜy
.
»£t
(

56 
rocksdb
::
NewBlockBa£dTabËFaùÜy
(
bË_İtiÚs
));

58 ià(
	g´İ_cŞl_çùÜy
) {

59 
	gm_deçuÉ_cf_İts
.
	gbË_´İ”t›s_cŞËùÜ_çùÜ›s
.
push_back
(

60 
´İ_cŞl_çùÜy
);

63 ià(!
£t_deçuÉ
(
¡d
::
¡ršg
(
deçuÉ_cf_İtiÚs
)) ||

64 !
£t_ov”ride
(
¡d
::
¡ršg
(
ov”ride_cf_İtiÚs
))) {

65  
çl£
;

68  
	gŒue
;

71 
	gRdb_cf_İtiÚs
::
g‘
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
,

72 
rocksdb
::
CŞumnFamyO±iÚs
 *cÚ¡ 
İts
) {

73 
DBUG_ASSERT
(
İts
 !ğ
nuÎ±r
);

76 
	grocksdb
::
G‘CŞumnFamyO±iÚsFromSŒšg
(*
İts
, 
m_deçuÉ_cÚfig
, opts);

79 
	gName_to_cÚfig_t
::
™”©Ü
 
™
 = 
m_Çme_m­
.
fšd
(
cf_Çme
);

81 ià(
	g™
 !ğ
m_Çme_m­
.
’d
()) {

82 
rocksdb
::
G‘CŞumnFamyO±iÚsFromSŒšg
(*
İts
, 
™
->
£cÚd
, opts);

86 
	gRdb_cf_İtiÚs
::
upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
,

87 cÚ¡ 
¡d
::
¡ršg
 &
cf_İtiÚs
) {

88 
DBUG_ASSERT
(!
cf_Çme
.
em±y
());

89 
DBUG_ASSERT
(!
cf_İtiÚs
.
em±y
());

92 
	gm_Çme_m­
[
cf_Çme
] = 
cf_İtiÚs
;

94 
DBUG_ASSERT
(!
m_Çme_m­
.
em±y
());

97 
boŞ
 
	gRdb_cf_İtiÚs
::
£t_deçuÉ
(cÚ¡ 
¡d
::
¡ršg
 &
deçuÉ_cÚfig
) {

98 
rocksdb
::
CŞumnFamyO±iÚs
 
İtiÚs
;

100 ià(!
	gdeçuÉ_cÚfig
.
em±y
() &&

101 !
	grocksdb
::
G‘CŞumnFamyO±iÚsFromSŒšg
(
İtiÚs
, 
deçuÉ_cÚfig
,

102 &
İtiÚs
)

103 .
ok
()) {

104 
årštf
(
¡d”r
, "Invalid default column family config: %s\n",

105 
deçuÉ_cÚfig
.
c_¡r
());

106  
	gçl£
;

109 
	gm_deçuÉ_cÚfig
 = 
deçuÉ_cÚfig
;

110  
	gŒue
;

114 
	gRdb_cf_İtiÚs
::
sk_¥aûs
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, 
size_t
 *cÚ¡ 
pos
) {

115 
DBUG_ASSERT
(
pos
 !ğ
nuÎ±r
);

117 *
	gpos
 < 
	gšput
.
size
(è&& 
is¥aû
(
šput
[*
pos
]))

118 ++(*
	gpos
);

124 
boŞ
 
	gRdb_cf_İtiÚs
::
fšd_cŞumn_çmy
(cÚ¡ 
¡d
::
¡ršg
 &
šput
,

125 
size_t
 *cÚ¡ 
pos
,

126 
¡d
::
¡ršg
 *cÚ¡ 
key
) {

127 
DBUG_ASSERT
(
pos
 !ğ
nuÎ±r
);

128 
DBUG_ASSERT
(
key
 !ğ
nuÎ±r
);

130 cÚ¡ 
size_t
 
	gbeg_pos
 = *
pos
;

131 
size_t
 
	g’d_pos
 = *
pos
 - 1;

134 ; *
	gpos
 < 
	gšput
.
size
(è&& iÅut[*
pos
] != '='; ++(*pos)) {

136 ià(
	gšput
[*
pos
] != ' ')

137 
’d_pos
 = *
pos
;

140 ià(
	g’d_pos
 =ğ
beg_pos
 - 1) {

142 
sql_´št_w¬nšg
("NØcŞumÀçmy found (İtiÚs: %s)", 
šput
.
c_¡r
());

143  
	gçl£
;

146 *
	gkey
 = 
šput
.
sub¡r
(
beg_pos
, 
’d_pos
 - beg_pos + 1);

147  
	gŒue
;

153 
boŞ
 
	gRdb_cf_İtiÚs
::
fšd_İtiÚs
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, 
size_t
 *cÚ¡ 
pos
,

154 
¡d
::
¡ršg
 *cÚ¡ 
İtiÚs
) {

155 
DBUG_ASSERT
(
pos
 !ğ
nuÎ±r
);

156 
DBUG_ASSERT
(
İtiÚs
 !ğ
nuÎ±r
);

159 ià(*
	gpos
 < 
	gšput
.
size
(è&& iÅut[*
pos
] != '{') {

161 
sql_´št_w¬nšg
("Invalid cf options, '{'ƒxpected (options: %s)",

162 
šput
.
c_¡r
());

163  
	gçl£
;

167 ++(*
	gpos
);

168 
sk_¥aûs
(
šput
, 
pos
);

171 
size_t
 
	gb¿û_couÁ
 = 1;

172 cÚ¡ 
size_t
 
	gbeg_pos
 = *
pos
;

176 *
	gpos
 < 
	gšput
.
size
()) {

177 
	gšput
[*
pos
]) {

181 ià(--
b¿û_couÁ
 == 0) {

182 *
İtiÚs
 = 
šput
.
sub¡r
(
beg_pos
, *
pos
 - beg_pos);

183 ++(*
	gpos
);

184  
	gŒue
;

191 ++
b¿û_couÁ
;

199 ++(*
	gpos
);

205 
sql_´št_w¬nšg
("Mismatched cf options, '}'ƒxpected (options: %s)",

206 
šput
.
c_¡r
());

207  
	gçl£
;

210 
boŞ
 
	gRdb_cf_İtiÚs
::
fšd_cf_İtiÚs_·œ
(cÚ¡ 
¡d
::
¡ršg
 &
šput
,

211 
size_t
 *cÚ¡ 
pos
,

212 
¡d
::
¡ršg
 *cÚ¡ 
cf
,

213 
¡d
::
¡ršg
 *cÚ¡ 
İt_¡r
) {

214 
DBUG_ASSERT
(
pos
 !ğ
nuÎ±r
);

215 
DBUG_ASSERT
(
cf
 !ğ
nuÎ±r
);

216 
DBUG_ASSERT
(
İt_¡r
 !ğ
nuÎ±r
);

219 
sk_¥aûs
(
šput
, 
pos
);

222 ià(!
fšd_cŞumn_çmy
(
šput
, 
pos
, 
cf
))

223  
	gçl£
;

226 ià(*
	gpos
 =ğ
šput
.
size
()) {

228 
sql_´št_w¬nšg
("Invalid cf options, '='ƒxpected (options: %s)",

229 
šput
.
c_¡r
());

230  
	gçl£
;

234 ++(*
	gpos
);

235 
sk_¥aûs
(
šput
, 
pos
);

239 ià(!
fšd_İtiÚs
(
šput
, 
pos
, 
İt_¡r
))

240  
	gçl£
;

243 
sk_¥aûs
(
šput
, 
pos
);

246 ià(*
	gpos
 < 
	gšput
.
size
()) {

247 ià(
	gšput
[*
pos
] != ';') {

249 
sql_´št_w¬nšg
("Invalid cf options, ';'ƒxpected (options: %s)",

250 
šput
.
c_¡r
());

251  
	gçl£
;

254 ++(*
	gpos
);

257  
	gŒue
;

260 
boŞ
 
	gRdb_cf_İtiÚs
::
·r£_cf_İtiÚs
(cÚ¡ 
¡d
::
¡ršg
 &
cf_İtiÚs
,

261 
Name_to_cÚfig_t
 *
İtiÚ_m­
) {

262 
	g¡d
::
¡ršg
 
cf
;

263 
	g¡d
::
¡ršg
 
İt_¡r
;

264 
	grocksdb
::
CŞumnFamyO±iÚs
 
İtiÚs
;

266 
DBUG_ASSERT
(
İtiÚ_m­
 !ğ
nuÎ±r
);

267 
DBUG_ASSERT
(
İtiÚ_m­
->
em±y
());

270 
size_t
 
	gpos
 = 0;

272 
	gpos
 < 
	gcf_İtiÚs
.
size
()) {

274 ià(!
fšd_cf_İtiÚs_·œ
(
cf_İtiÚs
, &
pos
, &
cf
, &
İt_¡r
)) {

275  
	gçl£
;

279 ià(
	gİtiÚ_m­
->
fšd
(
cf
è!ğ
İtiÚ_m­
->
’d
()) {

281 
sql_´št_w¬nšg
(

283 
cf
.
c_¡r
(), 
cf_İtiÚs
.c_str());

284  
	gçl£
;

288 ià(!
	grocksdb
::
G‘CŞumnFamyO±iÚsFromSŒšg
(
İtiÚs
, 
İt_¡r
, &options)

289 .
ok
()) {

291 
sql_´št_w¬nšg
(

293 
cf
.
c_¡r
(), 
cf_İtiÚs
.c_str());

294  
	gçl£
;

298 (*
	gİtiÚ_m­
)[
cf
] = 
İt_¡r
;

301  
	gŒue
;

304 
boŞ
 
	gRdb_cf_İtiÚs
::
£t_ov”ride
(cÚ¡ 
¡d
::
¡ršg
 &
ov”ride_cÚfig
) {

305 
Name_to_cÚfig_t
 
cÚfigs
;

307 ià(!
·r£_cf_İtiÚs
(
ov”ride_cÚfig
, &
cÚfigs
)) {

308  
	gçl£
;

312 
	gm_Çme_m­
 = 
cÚfigs
;

314  
	gŒue
;

317 cÚ¡ 
	grocksdb
::
Com·¿tÜ
 *

318 
Rdb_cf_İtiÚs
::
g‘_cf_com·¿tÜ
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
) {

319 ià(
Rdb_cf_mªag”
::
is_cf_Çme_»v”£
(
cf_Çme
.
c_¡r
())) {

320  &
s_»v_pk_com·¿tÜ
;

322  &
	gs_pk_com·¿tÜ
;

326 
	g¡d
::
sh¬ed_±r
<
rocksdb
::
M”geO³¿tÜ
>

327 
Rdb_cf_İtiÚs
::
g‘_cf_m”ge_İ”©Ü
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
) {

328  (
cf_Çme
 =ğ
DEFAULT_SYSTEM_CF_NAME
)

329 ? 
¡d
::
make_sh¬ed
<
Rdb_sy¡em_m”ge_İ
>()

330 : 
nuÎ±r
;

333 
	gRdb_cf_İtiÚs
::
g‘_cf_İtiÚs
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
,

334 
rocksdb
::
CŞumnFamyO±iÚs
 *cÚ¡ 
İts
) {

335 
DBUG_ASSERT
(
İts
 !ğ
nuÎ±r
);

337 *
	gİts
 = 
m_deçuÉ_cf_İts
;

338 
g‘
(
cf_Çme
, 
İts
);

341 
	gİts
->
	gcom·¿tÜ
 = 
g‘_cf_com·¿tÜ
(
cf_Çme
);

342 
	gİts
->
	gm”ge_İ”©Ü
 = 
g‘_cf_m”ge_İ”©Ü
(
cf_Çme
);

	@rdb_cf_options.h

17 #´agm¨
Úû


20 
	~<¡ršg
>

21 
	~<unÜd”ed_m­
>

24 
	~"rocksdb/bË.h
"

25 
	~"rocksdb/ut™›s/İtiÚs_ut.h
"

28 
	~"rdb_com·¿tÜ.h
"

30 
Çme¥aû
 
	gmyrocks
 {

41 şas 
	cRdb_cf_İtiÚs
 {

42 
	gpublic
:

43 
usšg
 
Name_to_cÚfig_t
 = 
¡d
::
unÜd”ed_m­
<¡d::
¡ršg
, 
	g¡d
::string>;

45 
Rdb_cf_İtiÚs
(cÚ¡ Rdb_cf_İtiÚ &èğ
d–‘e
;

46 
	gRdb_cf_İtiÚs
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_cf_İtiÚs
 &èğ
d–‘e
;

47 
Rdb_cf_İtiÚs
() = ;

49 
g‘
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
,

50 
rocksdb
::
CŞumnFamyO±iÚs
 *cÚ¡ 
İts
);

52 
upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
, cÚ¡ std::¡ršg &
cf_İtiÚs
);

54 
boŞ
 
š™
(cÚ¡ 
rocksdb
::
BlockBa£dTabËO±iÚs
 &
bË_İtiÚs
,

55 
¡d
::
sh¬ed_±r
<
rocksdb
::
TabËPrİ”t›sCŞËùÜFaùÜy
>

56 
´İ_cŞl_çùÜy
,

57 cÚ¡ *cÚ¡ 
deçuÉ_cf_İtiÚs
,

58 cÚ¡ *cÚ¡ 
ov”ride_cf_İtiÚs
);

60 cÚ¡ 
	grocksdb
::
CŞumnFamyO±iÚs
 &
g‘_deçuÉs
() const {

61  
m_deçuÉ_cf_İts
;

64 cÚ¡ 
	grocksdb
::
Com·¿tÜ
 *

65 
g‘_cf_com·¿tÜ
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
);

67 
	g¡d
::
sh¬ed_±r
<
rocksdb
::
M”geO³¿tÜ
>

68 
g‘_cf_m”ge_İ”©Ü
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
);

70 
g‘_cf_İtiÚs
(cÚ¡ 
¡d
::
¡ršg
 &
cf_Çme
,

71 
rocksdb
::
CŞumnFamyO±iÚs
 *cÚ¡ 
İts
)

72 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

74 
boŞ
 
·r£_cf_İtiÚs
(cÚ¡ 
¡d
::
¡ršg
 &
cf_İtiÚs
,

75 
Name_to_cÚfig_t
 *
İtiÚ_m­
);

77 
	g´iv©e
:

78 
boŞ
 
£t_deçuÉ
(cÚ¡ 
¡d
::
¡ršg
 &
deçuÉ_cÚfig
);

79 
boŞ
 
£t_ov”ride
(cÚ¡ 
¡d
::
¡ršg
 &
ov”ide_cÚfig
);

82 
sk_¥aûs
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, 
size_t
 *cÚ¡ 
pos
);

83 
boŞ
 
fšd_cŞumn_çmy
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, 
size_t
 *cÚ¡ 
pos
,

84 
¡d
::
¡ršg
 *cÚ¡ 
key
);

85 
boŞ
 
fšd_İtiÚs
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, 
size_t
 *cÚ¡ 
pos
,

86 
¡d
::
¡ršg
 *cÚ¡ 
İtiÚs
);

87 
boŞ
 
fšd_cf_İtiÚs_·œ
(cÚ¡ 
¡d
::
¡ršg
 &
šput
, 
size_t
 *cÚ¡ 
pos
,

88 
¡d
::
¡ršg
 *cÚ¡ 
cf
,

89 
¡d
::
¡ršg
 *cÚ¡ 
İt_¡r
);

91 
	g´iv©e
:

92 
Rdb_pk_com·¿tÜ
 
s_pk_com·¿tÜ
;

93 
Rdb_»v_com·¿tÜ
 
	gs_»v_pk_com·¿tÜ
;

96 
Name_to_cÚfig_t
 
	gm_Çme_m­
;

99 
	g¡d
::
¡ršg
 
m_deçuÉ_cÚfig
;

101 
	grocksdb
::
CŞumnFamyO±iÚs
 
m_deçuÉ_cf_İts
;

	@rdb_compact_filter.h

17 #´agm¨
Úû


19 #ifdeà
USE_PRAGMA_IMPLEMENTATION


20 #´agm¨
im¶em’tiÚ


24 
	~<¡ršg
>

25 
	~<time.h
>

28 
	~"rocksdb/com·ùiÚ_f‹r.h
"

31 
	~"ha_rocksdb_´Ùo.h
"

32 
	~"rdb_d©adic.h
"

34 
Çme¥aû
 
	gmyrocks
 {

36 şas 
	cRdb_com·ù_f‹r
 : 
public
 
rocksdb
::
Com·ùiÚF‹r
 {

37 
public
:

38 
Rdb_com·ù_f‹r
(cÚ¡ Rdb_com·ù_f‹¸&èğ
d–‘e
;

39 
	gRdb_com·ù_f‹r
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_com·ù_f‹r
 &èğ
d–‘e
;

41 
ex¶ic™
 
Rdb_com·ù_f‹r
(
ušt32_t
 
_cf_id
è: 
m_cf_id
(_cf_id) {}

42 ~
Rdb_com·ù_f‹r
() {

44 
rdb_upd©e_glob®_¡©s
(
ROWS_EXPIRED
, 
m_num_expœed
);

51 
vœtu®
 
boŞ
 
F‹r
(
Ëv–
, cÚ¡ 
rocksdb
::
Sliû
 &
key
,

52 cÚ¡ 
rocksdb
::
Sliû
 &
exi¡šg_v®ue
,

53 
¡d
::
¡ršg
 *
Ãw_v®ue
,

54 
boŞ
 *
v®ue_chªged
ècÚ¡ 
	gov”ride
 {

55 
DBUG_ASSERT
(
key
.
size
(è>ğ(
ušt32
));

57 
GL_INDEX_ID
 
	ggl_šdex_id
;

58 
	ggl_šdex_id
.
	gcf_id
 = 
m_cf_id
;

59 
	ggl_šdex_id
.
	gšdex_id
 = 
rdb_Ãtbuf_to_ušt32
((cÚ¡ 
uch¬
 *)
key
.
d©a
());

60 
DBUG_ASSERT
(
gl_šdex_id
.
šdex_id
 >= 1);

62 ià(
	ggl_šdex_id
 !ğ
m_´ev_šdex
) {

63 
m_should_d–‘e
 =

64 
rdb_g‘_diù_mªag”
()->
is_drİ_šdex_Úgošg
(
gl_šdex_id
);

66 ià(!
	gm_should_d–‘e
) {

67 
g‘_‰l_du¿tiÚ_ªd_off£t
(
gl_šdex_id
, &
m_‰l_du¿tiÚ
,

68 &
m_‰l_off£t
);

70 ià(
	gm_‰l_du¿tiÚ
 !ğ0 && 
m_¢­shÙ_time¡amp
 == 0) {

75 
rocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

76 ià(!
	grdb
->
G‘IÁPrİ”ty
(
rocksdb
::
DB
::
Prİ”t›s
::
kOlde¡SÇpshÙTime
,

77 &
m_¢­shÙ_time¡amp
) ||

78 
	gm_¢­shÙ_time¡amp
 == 0) {

79 
m_¢­shÙ_time¡amp
 = 
¡©ic_ÿ¡
<
ušt64_t
>(
¡d
::
time
(
nuÎ±r
));

82 #iâdeà
NDEBUG


83 
	g¢­shÙ_ts
 = 
rdb_dbug_£t_‰l_¢­shÙ_ts
();

84 ià(
	g¢­shÙ_ts
) {

85 
	gm_¢­shÙ_time¡amp
 =

86 
¡©ic_ÿ¡
<
ušt64_t
>(
¡d
::
time
(
nuÎ±r
)è+ 
¢­shÙ_ts
;

92 
	gm_´ev_šdex
 = 
gl_šdex_id
;

95 ià(
	gm_should_d–‘e
) {

96 
	gm_num_d–‘ed
++;

97  
	gŒue
;

98 } ià(
	gm_‰l_du¿tiÚ
 > 0 &&

99 
should_f‹r_‰l_»c
(
key
, 
exi¡šg_v®ue
)) {

100 
	gm_num_expœed
++;

101  
	gŒue
;

104  
	gçl£
;

107 
vœtu®
 
boŞ
 
IgnÜeSÇpshÙs
(ècÚ¡ 
	gov”ride
 {  
	gŒue
; }

109 
vœtu®
 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {  "Rdb_compact_filter"; }

111 
g‘_‰l_du¿tiÚ_ªd_off£t
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

112 
ušt64
 *
‰l_du¿tiÚ
,

113 
ušt32
 *
‰l_off£t
) const {

114 
DBUG_ASSERT
(
‰l_du¿tiÚ
 !ğ
nuÎ±r
);

119 ià(!
rdb_is_‰l_’abËd
()) {

120 *
	g‰l_du¿tiÚ
 = 0;

127 
	grocksdb
::
CŞumnFamyHªdË
 *
s_cf
 = 
rdb_g‘_diù_mªag”
()->
g‘_sy¡em_cf
();

128 ià(
	gs_cf
 =ğ
nuÎ±r
 || 
gl_šdex_id
.
cf_id
 =ğ
s_cf
->
G‘ID
()) {

129 *
‰l_du¿tiÚ
 = 0;

133 
Rdb_šdex_šfo
 
	gšdex_šfo
;

134 ià(!
rdb_g‘_diù_mªag”
()->
g‘_šdex_šfo
(
gl_šdex_id
, &
šdex_šfo
)) {

136 
sql_´št_”rÜ
("RocksDB: Could‚ot get index information "

138 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
);

141 #iâdeà
NDEBUG


142 ià(
rdb_dbug_£t_‰l_ignÜe_pk
() &&

143 
	gšdex_šfo
.
	gm_šdex_ty³
 =ğ
Rdb_key_def
::
INDEX_TYPE_PRIMARY
) {

144 *
‰l_du¿tiÚ
 = 0;

149 *
	g‰l_du¿tiÚ
 = 
šdex_šfo
.
m_‰l_du¿tiÚ
;

150 ià(
	gRdb_key_def
::
has_šdex_æag
(
šdex_šfo
.
m_šdex_æags
,

151 
Rdb_key_def
::
TTL_FLAG
)) {

152 *
‰l_off£t
 = 
Rdb_key_def
::
ÿlcuÏ‹_šdex_æag_off£t
(

153 
šdex_šfo
.
m_šdex_æags
, 
Rdb_key_def
::
TTL_FLAG
);

157 
boŞ
 
should_f‹r_‰l_»c
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

158 cÚ¡ 
rocksdb
::
Sliû
 &
exi¡šg_v®ue
) const {

159 
ušt64
 
‰l_time¡amp
;

160 
Rdb_¡ršg_»ad”
 
»ad”
(&
exi¡šg_v®ue
);

161 ià(!
	g»ad”
.
»ad
(
m_‰l_off£t
è||„—d”.
»ad_ušt64
(&
‰l_time¡amp
)) {

162 
	g¡d
::
¡ršg
 
buf
;

163 
	gbuf
 = 
rdb_hexdump
(
exi¡šg_v®ue
.
d©a
(),ƒxi¡šg_v®ue.
size
(),

164 
RDB_MAX_HEXDUMP_LEN
);

166 
sql_´št_”rÜ
("Decodingtl from PK value failed in compaction filter, "

168 
m_´ev_šdex
.
cf_id
, m_´ev_šdex.
šdex_id
, 
buf
.
c_¡r
());

169 
abÜt
();

177  
	g‰l_time¡amp
 + 
	gm_‰l_du¿tiÚ
 <ğ
m_¢­shÙ_time¡amp
;

180 
	g´iv©e
:

182 cÚ¡ 
ušt32_t
 
m_cf_id
;

184 
mubË
 
GL_INDEX_ID
 
	gm_´ev_šdex
 = {0, 0};

186 
mubË
 
ušt64
 
	gm_num_d–‘ed
 = 0;

188 
mubË
 
ušt64
 
	gm_num_expœed
 = 0;

190 
mubË
 
boŞ
 
	gm_should_d–‘e
 = 
çl£
;

192 
mubË
 
ušt64
 
	gm_‰l_du¿tiÚ
 = 0;

194 
mubË
 
ušt32
 
	gm_‰l_off£t
 = 0;

196 
mubË
 
ušt64_t
 
	gm_¢­shÙ_time¡amp
 = 0;

199 şas 
	cRdb_com·ù_f‹r_çùÜy
 : 
public
 
rocksdb
::
Com·ùiÚF‹rFaùÜy
 {

200 
public
:

201 
Rdb_com·ù_f‹r_çùÜy
(cÚ¡ Rdb_com·ù_f‹r_çùÜy &èğ
d–‘e
;

202 
	gRdb_com·ù_f‹r_çùÜy
 &

203 
	gİ”©Ü
=(cÚ¡ 
Rdb_com·ù_f‹r_çùÜy
 &èğ
d–‘e
;

204 
Rdb_com·ù_f‹r_çùÜy
() {}

206 ~
Rdb_com·ù_f‹r_çùÜy
() {}

208 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {  "Rdb_compact_filter_factory"; }

210 
	g¡d
::
unique_±r
<
rocksdb
::
Com·ùiÚF‹r
> 
C»©eCom·ùiÚF‹r
(

211 cÚ¡ 
rocksdb
::
Com·ùiÚF‹r
::
CÚ‹xt
 &
cÚ‹xt
è
ov”ride
 {

212  
¡d
::
unique_±r
<
rocksdb
::
Com·ùiÚF‹r
>(

213 
Ãw
 
Rdb_com·ù_f‹r
(
cÚ‹xt
.
cŞumn_çmy_id
));

	@rdb_comparator.h

16 #´agm¨
Úû


19 
	~<¡ršg
>

22 
	~"m_ùy³.h
"

25 
	~"rocksdb/com·¿tÜ.h
"

28 
	~"rdb_uts.h
"

30 
Çme¥aû
 
	gmyrocks
 {

38 şas 
	cRdb_pk_com·¿tÜ
 : 
public
 
rocksdb
::
Com·¿tÜ
 {

39 
public
:

40 
Rdb_pk_com·¿tÜ
(cÚ¡ Rdb_pk_com·¿tÜ &èğ
d–‘e
;

41 
	gRdb_pk_com·¿tÜ
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_pk_com·¿tÜ
 &èğ
d–‘e
;

42 
Rdb_pk_com·¿tÜ
() = ;

44 
by‹wi£_com·»
(cÚ¡ 
rocksdb
::
Sliû
 &
a
,

45 cÚ¡ 
rocksdb
::
Sliû
 &
b
) {

46 cÚ¡ 
size_t
 
a_size
 = 
a
.
size
();

47 cÚ¡ 
size_t
 
	gb_size
 = 
b
.
size
();

48 cÚ¡ 
size_t
 
	gËn
 = (
a_size
 < 
b_size
) ?‡_size : b_size;

49 
	g»s
;

51 ià((
	g»s
 = 
memcmp
(
a
.
d©a
(), 
b
.d©a(), 
Ën
)))

52  
	g»s
;

55 ià(
	ga_size
 !ğ
b_size
) {

56  
a_size
 < 
b_size
 ? -1 : 1;

58  
	gHA_EXIT_SUCCESS
;

63 
Com·»
(cÚ¡ 
rocksdb
::
Sliû
 &
a
, cÚ¡„ocksdb::Sliû &
b
ècÚ¡ 
ov”ride
 {

64  
by‹wi£_com·»
(
a
, 
b
);

67 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {  "RocksDB_SE_v3.10"; }

74 
FšdShÜ‹¡S•¬©Ü
(
¡d
::
¡ršg
 *
¡¬t
,

75 cÚ¡ 
rocksdb
::
Sliû
 &
lim™
ècÚ¡ 
ov”ride
 {}

76 
FšdShÜtSucûssÜ
(
¡d
::
¡ršg
 *
key
ècÚ¡ 
ov”ride
 {}

79 şas 
	cRdb_»v_com·¿tÜ
 : 
public
 
rocksdb
::
Com·¿tÜ
 {

80 
public
:

81 
Rdb_»v_com·¿tÜ
(cÚ¡ Rdb_»v_com·¿tÜ &èğ
d–‘e
;

82 
	gRdb_»v_com·¿tÜ
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_»v_com·¿tÜ
 &èğ
d–‘e
;

83 
Rdb_»v_com·¿tÜ
() = ;

85 
by‹wi£_com·»
(cÚ¡ 
rocksdb
::
Sliû
 &
a
,

86 cÚ¡ 
rocksdb
::
Sliû
 &
b
) {

87  -
Rdb_pk_com·¿tÜ
::
by‹wi£_com·»
(
a
, 
b
);

90 
Com·»
(cÚ¡ 
rocksdb
::
Sliû
 &
a
, cÚ¡„ocksdb::Sliû &
b
ècÚ¡ 
ov”ride
 {

91  -
Rdb_pk_com·¿tÜ
::
by‹wi£_com·»
(
a
, 
b
);

93 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {  "rev:RocksDB_SE_v3.10"; }

94 
FšdShÜ‹¡S•¬©Ü
(
¡d
::
¡ršg
 *
¡¬t
,

95 cÚ¡ 
rocksdb
::
Sliû
 &
lim™
ècÚ¡ 
ov”ride
 {}

96 
FšdShÜtSucûssÜ
(
¡d
::
¡ršg
 *
key
ècÚ¡ 
ov”ride
 {}

	@rdb_datadic.cc

17 #ifdeà
USE_PRAGMA_IMPLEMENTATION


18 #´agm¨
im¶em’tiÚ


22 
	~"rdb_d©adic.h
"

25 
	~<®gÜ™hm
>

26 
	~<¬¿y
>

27 
	~<lim™s
>

28 
	~<m­
>

29 
	~<£t
>

30 
	~<¡ršg
>

31 
	~<ut™y
>

32 
	~<veùÜ
>

35 
	~"f›ld.h
"

36 
	~"key.h
"

37 
	~"m_ùy³.h
"

38 
	~"my_b™.h
"

39 
	~"my_b™m­.h
"

40 
	~"sql_bË.h
"

43 
	~"ha_rocksdb_´Ùo.h
"

44 
	~"my_¡ackŒaû.h
"

45 
	~"rdb_cf_mªag”.h
"

46 
	~"rdb_uts.h
"

48 
Çme¥aû
 
	gmyrocks
 {

50 
g‘_mem_com·¿bË_¥aû
(cÚ¡ 
CHARSET_INFO
 *
cs
,

51 cÚ¡ 
¡d
::
veùÜ
<
uch¬
> **
xäm
, 
size_t
 *
xäm_Ën
,

52 
size_t
 *
mb_Ën
);

58 
	gRdb_key_def
::
Rdb_key_def
(
ušt
 
šdexÄ_¬g
, ušˆ
keyno_¬g
,

59 
rocksdb
::
CŞumnFamyHªdË
 *
cf_hªdË_¬g
,

60 
ušt16_t
 
šdex_diù_v”siÚ_¬g
, 
uch¬
 
šdex_ty³_¬g
,

61 
ušt16_t
 
kv_fÜm©_v”siÚ_¬g
, 
boŞ
 
is_»v”£_cf_¬g
,

62 
boŞ
 
is_³r_·¹™iÚ_cf_¬g
, cÚ¡ *
_Çme
,

63 
Rdb_šdex_¡©s
 
_¡©s
, 
ušt32
 
šdex_æags_b™m­
,

64 
ušt32
 
‰l_»c_off£t
, 
ušt64
 
‰l_du¿tiÚ
)

65 : 
m_šdex_numb”
(
šdexÄ_¬g
), 
m_cf_hªdË
(
cf_hªdË_¬g
),

66 
m_šdex_diù_v”siÚ
(
šdex_diù_v”siÚ_¬g
),

67 
m_šdex_ty³
(
šdex_ty³_¬g
), 
m_kv_fÜm©_v”siÚ
(
kv_fÜm©_v”siÚ_¬g
),

68 
m_is_»v”£_cf
(
is_»v”£_cf_¬g
),

69 
m_is_³r_·¹™iÚ_cf
(
is_³r_·¹™iÚ_cf_¬g
), 
m_Çme
(
_Çme
),

70 
m_¡©s
(
_¡©s
), 
m_šdex_æags_b™m­
(
šdex_æags_b™m­
),

71 
m_‰l_»c_off£t
(
‰l_»c_off£t
), 
m_‰l_du¿tiÚ
(
‰l_du¿tiÚ
),

72 
m_‰l_cŞumn
(""), 
m_pk_·¹_no
(
nuÎ±r
), 
m_·ck_šfo
(nullptr),

73 
m_keyno
(
keyno_¬g
), 
m_key_·¹s
(0), 
m_‰l_pk_key_·¹_off£t
(
UINT_MAX
),

74 
m_‰l_f›ld_off£t
(
UINT_MAX
), 
m_´efix_exŒaùÜ
(
nuÎ±r
),

75 
m_maxËngth
(0)

77 
mysql_mu‹x_š™
(0, &
m_mu‹x
, 
MY_MUTEX_INIT_FAST
);

78 
rdb_Ãtbuf_¡Üe_šdex
(
m_šdex_numb”_¡Üage_fÜm
, 
m_šdex_numb”
);

79 
	gm_tÙ®_šdex_æags_Ëngth
 =

80 
ÿlcuÏ‹_šdex_æag_off£t
(
m_šdex_æags_b™m­
, 
MAX_FLAG
);

81 
DBUG_ASSERT_IMP
(
m_šdex_ty³
 =ğ
INDEX_TYPE_SECONDARY
 &&

82 
m_kv_fÜm©_v”siÚ
 <ğ
SECONDARY_FORMAT_VERSION_UPDATE2
,

83 
m_tÙ®_šdex_æags_Ëngth
 == 0);

84 
DBUG_ASSERT_IMP
(
m_šdex_ty³
 =ğ
INDEX_TYPE_PRIMARY
 &&

85 
m_kv_fÜm©_v”siÚ
 <ğ
PRIMARY_FORMAT_VERSION_UPDATE2
,

86 
m_tÙ®_šdex_æags_Ëngth
 == 0);

87 
DBUG_ASSERT
(
m_cf_hªdË
 !ğ
nuÎ±r
);

90 
	gRdb_key_def
::
Rdb_key_def
(cÚ¡ Rdb_key_deà&
k
)

91 : 
m_šdex_numb”
(
k
.m_šdex_numb”), 
m_cf_hªdË
(k.m_cf_handle),

92 
m_is_»v”£_cf
(
k
.m_is_reverse_cf),

93 
m_is_³r_·¹™iÚ_cf
(
k
.m_is_³r_·¹™iÚ_cf), 
m_Çme
(k.m_name),

94 
m_¡©s
(
k
.m_¡©s), 
m_šdex_æags_b™m­
(k.m_index_flags_bitmap),

95 
m_‰l_»c_off£t
(
k
.m_‰l_»c_off£t), 
m_‰l_du¿tiÚ
(k.m_ttl_duration),

96 
m_‰l_cŞumn
(
k
.m_‰l_cŞumn), 
m_pk_·¹_no
(k.m_pk_part_no),

97 
m_·ck_šfo
(
k
.m_·ck_šfo), 
m_keyno
(k.m_keyno),

98 
m_key_·¹s
(
k
.m_key_parts),

99 
m_‰l_pk_key_·¹_off£t
(
k
.m_ttl_pk_key_part_offset),

100 
m_‰l_f›ld_off£t
(
UINT_MAX
), 
m_´efix_exŒaùÜ
(
k
.m_prefix_extractor),

101 
m_maxËngth
(
k
.m_maxlength) {

102 
mysql_mu‹x_š™
(0, &
m_mu‹x
, 
MY_MUTEX_INIT_FAST
);

103 
rdb_Ãtbuf_¡Üe_šdex
(
m_šdex_numb”_¡Üage_fÜm
, 
m_šdex_numb”
);

104 
	gm_tÙ®_šdex_æags_Ëngth
 =

105 
ÿlcuÏ‹_šdex_æag_off£t
(
m_šdex_æags_b™m­
, 
MAX_FLAG
);

106 
DBUG_ASSERT_IMP
(
m_šdex_ty³
 =ğ
INDEX_TYPE_SECONDARY
 &&

107 
m_kv_fÜm©_v”siÚ
 <ğ
SECONDARY_FORMAT_VERSION_UPDATE2
,

108 
m_tÙ®_šdex_æags_Ëngth
 == 0);

109 
DBUG_ASSERT_IMP
(
m_šdex_ty³
 =ğ
INDEX_TYPE_PRIMARY
 &&

110 
m_kv_fÜm©_v”siÚ
 <ğ
PRIMARY_FORMAT_VERSION_UPDATE2
,

111 
m_tÙ®_šdex_æags_Ëngth
 == 0);

112 ià(
	gk
.
	gm_·ck_šfo
) {

113 cÚ¡ 
size_t
 
	gsize
 = (
Rdb_f›ld_·ckšg
è* 
k
.
m_key_·¹s
;

114 
	gm_·ck_šfo
 =

115 
»š‹½»t_ÿ¡
<
Rdb_f›ld_·ckšg
 *>(
my_m®loc
(
size
, 
MYF
(0)));

116 
memıy
(
m_·ck_šfo
, 
k
.m_·ck_šfo, 
size
);

119 ià(
	gk
.
	gm_pk_·¹_no
) {

120 cÚ¡ 
size_t
 
	gsize
 = (
ušt
è* 
m_key_·¹s
;

121 
	gm_pk_·¹_no
 = 
»š‹½»t_ÿ¡
<
ušt
 *>(
my_m®loc
(
size
, 
MYF
(0)));

122 
memıy
(
m_pk_·¹_no
, 
k
.m_pk_·¹_no, 
size
);

126 
	gRdb_key_def
::~
Rdb_key_def
() {

127 
mysql_mu‹x_de¡roy
(&
m_mu‹x
);

129 
my_ä“
(
m_pk_·¹_no
);

130 
	gm_pk_·¹_no
 = 
nuÎ±r
;

132 
my_ä“
(
m_·ck_šfo
);

133 
	gm_·ck_šfo
 = 
nuÎ±r
;

136 
	gRdb_key_def
::
£tup
(cÚ¡ 
TABLE
 *cÚ¡ 
tbl
,

137 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def
) {

138 
DBUG_ASSERT
(
tbl
 !ğ
nuÎ±r
);

139 
DBUG_ASSERT
(
tbl_def
 !ğ
nuÎ±r
);

145 cÚ¡ 
boŞ
 
	gis_hidd’_pk
 = (
m_šdex_ty³
 =ğ
INDEX_TYPE_HIDDEN_PRIMARY
);

146 cÚ¡ 
boŞ
 
	ghidd’_pk_exi¡s
 = 
bË_has_hidd’_pk
(
tbl
);

147 cÚ¡ 
boŞ
 
	g£cÚd¬y_key
 = (
m_šdex_ty³
 =ğ
INDEX_TYPE_SECONDARY
);

148 ià(!
	gm_maxËngth
) {

149 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

150 ià(
	gm_maxËngth
 != 0) {

151 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

155 
KEY
 *
	gkey_šfo
 = 
nuÎ±r
;

156 
KEY
 *
	gpk_šfo
 = 
nuÎ±r
;

157 ià(!
	gis_hidd’_pk
) {

158 
	gkey_šfo
 = &
tbl
->
key_šfo
[
m_keyno
];

159 ià(!
	ghidd’_pk_exi¡s
)

160 
	gpk_šfo
 = &
tbl
->
key_šfo
[tbl->
s
->
´im¬y_key
];

161 
	gm_Çme
 = 
¡d
::
¡ršg
(
key_šfo
->
Çme
);

163 
	gm_Çme
 = 
HIDDEN_PK_NAME
;

166 ià(
	g£cÚd¬y_key
)

167 
	gm_pk_key_·¹s
 = 
hidd’_pk_exi¡s
 ? 1 : 
pk_šfo
->
aùu®_key_·¹s
;

169 
	gpk_šfo
 = 
nuÎ±r
;

170 
	gm_pk_key_·¹s
 = 0;

174 
	gm_key_·¹s
 = 
is_hidd’_pk
 ? 1 : 
key_šfo
->
aùu®_key_·¹s
;

176 ià(
	g£cÚd¬y_key
) {

191 
	gm_key_·¹s
 +ğ
m_pk_key_·¹s
;

194 ià(
	g£cÚd¬y_key
)

195 
	gm_pk_·¹_no
 = 
»š‹½»t_ÿ¡
<
ušt
 *>(

196 
my_m®loc
((
ušt
è* 
m_key_·¹s
, 
MYF
(0)));

198 
	gm_pk_·¹_no
 = 
nuÎ±r
;

200 cÚ¡ 
size_t
 
	gsize
 = (
Rdb_f›ld_·ckšg
è* 
m_key_·¹s
;

201 
	gm_·ck_šfo
 =

202 
»š‹½»t_ÿ¡
<
Rdb_f›ld_·ckšg
 *>(
my_m®loc
(
size
, 
MYF
(0)));

208 
	gRdb_key_def
::
exŒaù_‰l_cŞ
(
tbl
, 
tbl_def
, &
m_‰l_cŞumn
,

209 &
m_‰l_f›ld_off£t
, 
Œue
);

211 
size_t
 
	gmax_Ën
 = 
INDEX_NUMBER_SIZE
;

212 
	guÅack_Ën
 = 0;

213 
	gmax_·¹_Ën
 = 0;

214 
boŞ
 
	gsimuÏtšg_extkey
 = 
çl£
;

215 
ušt
 
	gd¡_i
 = 0;

217 
ušt
 
	gkeyno_to_£t
 = 
m_keyno
;

218 
ušt
 
	gkey·¹_to_£t
 = 0;

220 ià(
	gis_hidd’_pk
) {

221 
F›ld
 *
	gf›ld
 = 
nuÎ±r
;

222 
	gm_·ck_šfo
[
d¡_i
].
£tup
(
this
, 
f›ld
, 
keyno_to_£t
, 0, 0);

223 
	gm_·ck_šfo
[
d¡_i
].
	gm_uÅack_d©a_off£t
 = 
uÅack_Ën
;

224 
	gmax_Ën
 +ğ
m_·ck_šfo
[
d¡_i
].
m_max_image_Ën
;

225 
	gmax_·¹_Ën
 = 
¡d
::
max
(
max_·¹_Ën
, 
m_·ck_šfo
[
d¡_i
].
m_max_image_Ën
);

226 
	gd¡_i
++;

228 
KEY_PART_INFO
 *
	gkey_·¹
 = 
key_šfo
->
key_·¹
;

231 
ušt
 
	g¤c_i
 = 0; src_˜< 
	gm_key_·¹s
; src_i++, 
	gkey·¹_to_£t
++) {

232 
F›ld
 *cÚ¡ 
	gf›ld
 = 
key_·¹
 ? key_·¹->
f›ld
 : 
nuÎ±r
;

234 ià(
	gsimuÏtšg_extkey
 && !
	ghidd’_pk_exi¡s
) {

235 
DBUG_ASSERT
(
£cÚd¬y_key
);

237 
boŞ
 
	gfound
 = 
çl£
;

238 
ušt
 
	gj
 = 0; j < 
	gkey_šfo
->
	gaùu®_key_·¹s
; j++) {

239 ià(
	gf›ld
->
	gf›ld_šdex
 ==

240 
key_šfo
->
key_·¹
[
j
].
f›ld
->
f›ld_šdex
 &&

241 
key_·¹
->
Ëngth
 =ğ
key_šfo
->key_·¹[
j
].length) {

242 
found
 = 
Œue
;

247 ià(
	gfound
) {

248 
	gkey_·¹
++;

253 ià(
	gf›ld
 && f›ld->
»®_maybe_nuÎ
())

254 
	gmax_Ën
 += 1;

256 
	gm_·ck_šfo
[
d¡_i
].
£tup
(
this
, 
f›ld
, 
keyno_to_£t
, 
key·¹_to_£t
,

257 
key_·¹
 ? key_·¹->
Ëngth
 : 0);

258 
	gm_·ck_šfo
[
d¡_i
].
	gm_uÅack_d©a_off£t
 = 
uÅack_Ën
;

260 ià(
	gpk_šfo
) {

261 
	gm_pk_·¹_no
[
d¡_i
] = -1;

262 
ušt
 
	gj
 = 0; j < 
	gm_pk_key_·¹s
; j++) {

263 ià(
	gf›ld
->
	gf›ld_šdex
 =ğ
pk_šfo
->
key_·¹
[
j
].
f›ld
->
f›ld_šdex
) {

264 
m_pk_·¹_no
[
d¡_i
] = 
j
;

268 } ià(
	g£cÚd¬y_key
 && 
	ghidd’_pk_exi¡s
) {

273 
	gm_pk_·¹_no
[
d¡_i
] = -1;

274 ià(
	gsimuÏtšg_extkey
)

275 
	gm_pk_·¹_no
[
d¡_i
] = 0;

278 
	gmax_Ën
 +ğ
m_·ck_šfo
[
d¡_i
].
m_max_image_Ën
;

280 
	gmax_·¹_Ën
 =

281 
¡d
::
max
(
max_·¹_Ën
, 
m_·ck_šfo
[
d¡_i
].
m_max_image_Ën
);

287 ià(!
	gm_‰l_cŞumn
.
em±y
() &&

288 
	gf›ld
->
check_f›ld_Çme_m©ch
(
m_‰l_cŞumn
.
c_¡r
())) {

289 
DBUG_ASSERT
(
f›ld
->
»®_ty³
(è=ğ
MYSQL_TYPE_LONGLONG
);

290 
DBUG_ASSERT
(
f›ld
->
key_ty³
(è=ğ
HA_KEYTYPE_ULONGLONG
);

291 
DBUG_ASSERT
(!
f›ld
->
»®_maybe_nuÎ
());

292 
	gm_‰l_pk_key_·¹_off£t
 = 
d¡_i
;

295 
	gkey_·¹
++;

300 ià(
	g£cÚd¬y_key
 && 
	g¤c_i
 + 1 =ğ
key_šfo
->
aùu®_key_·¹s
) {

301 
simuÏtšg_extkey
 = 
Œue
;

302 ià(!
	ghidd’_pk_exi¡s
) {

303 
	gkeyno_to_£t
 = 
tbl
->
s
->
´im¬y_key
;

304 
	gkey_·¹
 = 
pk_šfo
->
key_·¹
;

305 
	gkey·¹_to_£t
 = (
ušt
)-1;

307 
	gkeyno_to_£t
 = 
tbl_def
->
m_key_couÁ
 - 1;

308 
	gkey_·¹
 = 
nuÎ±r
;

309 
	gkey·¹_to_£t
 = 0;

313 
	gd¡_i
++;

317 
	gm_key_·¹s
 = 
d¡_i
;

320 
	gm_¡©s
.
	gm_di¡šù_keys_³r_´efix
.
»size
(
g‘_key_·¹s
());

323 
	grocksdb
::
O±iÚs
 
İt
 = 
rdb_g‘_rocksdb_db
()->
G‘O±iÚs
(
g‘_cf
());

324 
	gm_´efix_exŒaùÜ
 = 
İt
.
´efix_exŒaùÜ
;

330 
	gm_maxËngth
 = 
max_Ën
;

332 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

343 
ušt
 
	gRdb_key_def
::
exŒaù_‰l_du¿tiÚ
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

344 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

345 
ušt64
 *
‰l_du¿tiÚ
) {

346 
DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

347 
DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

348 
DBUG_ASSERT
(
‰l_du¿tiÚ
 !ğ
nuÎ±r
);

349 
	g¡d
::
¡ršg
 
bË_comm’t
(
bË_¬g
->
s
->
comm’t
.
¡r
,

350 
bË_¬g
->
s
->
comm’t
.
Ëngth
);

352 
boŞ
 
	g‰l_du¿tiÚ_³r_·¹_m©ch_found
 = 
çl£
;

353 
	g¡d
::
¡ršg
 
‰l_du¿tiÚ_¡r
 = 
Rdb_key_def
::
·r£_comm’t_fÜ_qu®if›r
(

354 
bË_comm’t
, 
bË_¬g
, 
tbl_def_¬g
, &
‰l_du¿tiÚ_³r_·¹_m©ch_found
,

355 
RDB_TTL_DURATION_QUALIFIER
);

358 ià(
	g‰l_du¿tiÚ_¡r
.
em±y
()) {

359  
	gHA_EXIT_SUCCESS
;

366 *
	g‰l_du¿tiÚ
 = 
¡d
::
¡¹ouÎ
(
‰l_du¿tiÚ_¡r
.
c_¡r
(), 
nuÎ±r
, 0);

367 ià(!*
	g‰l_du¿tiÚ
) {

368 
my_”rÜ
(
ER_RDB_TTL_DURATION_FORMAT
, 
MYF
(0), 
‰l_du¿tiÚ_¡r
.
c_¡r
());

369  
	gHA_EXIT_FAILURE
;

372  
	gHA_EXIT_SUCCESS
;

384 
ušt
 
	gRdb_key_def
::
exŒaù_‰l_cŞ
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

385 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

386 
¡d
::
¡ršg
 *
‰l_cŞumn
,

387 
ušt
 *
‰l_f›ld_off£t
, 
boŞ
 
sk_checks
) {

388 
	g¡d
::
¡ršg
 
bË_comm’t
(
bË_¬g
->
s
->
comm’t
.
¡r
,

389 
bË_¬g
->
s
->
comm’t
.
Ëngth
);

395 
boŞ
 
	g‰l_cŞ_³r_·¹_m©ch_found
 = 
çl£
;

396 
	g¡d
::
¡ršg
 
‰l_cŞ_¡r
 = 
Rdb_key_def
::
·r£_comm’t_fÜ_qu®if›r
(

397 
bË_comm’t
, 
bË_¬g
, 
tbl_def_¬g
, &
‰l_cŞ_³r_·¹_m©ch_found
,

398 
RDB_TTL_COL_QUALIFIER
);

400 ià(
	gsk_checks
) {

401 
ušt
 
	gi
 = 0; i < 
	gbË_¬g
->
	gs
->
	gf›lds
; i++) {

402 
F›ld
 *cÚ¡ 
	gf›ld
 = 
bË_¬g
->
f›ld
[
i
];

403 ià(
	gf›ld
->
check_f›ld_Çme_m©ch
(
‰l_cŞ_¡r
.
c_¡r
())) {

404 *
	g‰l_cŞumn
 = 
‰l_cŞ_¡r
;

405 *
	g‰l_f›ld_off£t
 = 
i
;

408  
	gHA_EXIT_SUCCESS
;

412 ià(!
	g‰l_cŞ_¡r
.
em±y
()) {

413 
boŞ
 
	gfound
 = 
çl£
;

414 
ušt
 
	gi
 = 0; i < 
	gbË_¬g
->
	gs
->
	gf›lds
; i++) {

415 
F›ld
 *cÚ¡ 
	gf›ld
 = 
bË_¬g
->
f›ld
[
i
];

416 ià(
	gf›ld
->
check_f›ld_Çme_m©ch
(
‰l_cŞ_¡r
.
c_¡r
()) &&

417 
	gf›ld
->
»®_ty³
(è=ğ
MYSQL_TYPE_LONGLONG
 &&

418 
f›ld
->
key_ty³
(è=ğ
HA_KEYTYPE_ULONGLONG
 &&

419 !
f›ld
->
»®_maybe_nuÎ
()) {

420 *
‰l_cŞumn
 = 
‰l_cŞ_¡r
;

421 *
	g‰l_f›ld_off£t
 = 
i
;

422 
	gfound
 = 
Œue
;

427 ià(!
	gfound
) {

428 
my_”rÜ
(
ER_RDB_TTL_COL_FORMAT
, 
MYF
(0), 
‰l_cŞ_¡r
.
c_¡r
());

429  
	gHA_EXIT_FAILURE
;

433  
	gHA_EXIT_SUCCESS
;

436 cÚ¡ 
	g¡d
::
¡ršg


437 
Rdb_key_def
::
g’_qu®if›r_fÜ_bË
(cÚ¡ *cÚ¡ 
qu®if›r
,

438 cÚ¡ 
¡d
::
¡ršg
 &
·¹™iÚ_Çme
) {

439 
boŞ
 
has_·¹™iÚ
 = !
·¹™iÚ_Çme
.
em±y
();

440 
	g¡d
::
¡ršg
 
qu®if›r_¡r
 = "";

442 ià(!
¡rcmp
(
qu®if›r
, 
RDB_CF_NAME_QUALIFIER
)) {

443  
	ghas_·¹™iÚ
 ? 
g’_cf_Çme_qu®if›r_fÜ_·¹™iÚ
(
·¹™iÚ_Çme
)

444 : 
qu®if›r_¡r
 + 
RDB_CF_NAME_QUALIFIER
 +

445 
RDB_QUALIFIER_VALUE_SEP
;

446 } ià(!
¡rcmp
(
qu®if›r
, 
RDB_TTL_DURATION_QUALIFIER
)) {

447  
	ghas_·¹™iÚ


448 ? 
g’_‰l_du¿tiÚ_qu®if›r_fÜ_·¹™iÚ
(
·¹™iÚ_Çme
)

449 : 
qu®if›r_¡r
 + 
RDB_TTL_DURATION_QUALIFIER
 +

450 
RDB_QUALIFIER_VALUE_SEP
;

451 } ià(!
¡rcmp
(
qu®if›r
, 
RDB_TTL_COL_QUALIFIER
)) {

452  
	ghas_·¹™iÚ
 ? 
g’_‰l_cŞ_qu®if›r_fÜ_·¹™iÚ
(
·¹™iÚ_Çme
)

453 : 
qu®if›r_¡r
 + 
RDB_TTL_COL_QUALIFIER
 +

454 
RDB_QUALIFIER_VALUE_SEP
;

456 
DBUG_ASSERT
(0);

459  
	gqu®if›r_¡r
;

466 cÚ¡ 
	g¡d
::
¡ršg


467 
Rdb_key_def
::
g’_cf_Çme_qu®if›r_fÜ_·¹™iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
´efix
) {

468 
DBUG_ASSERT
(!
´efix
.
em±y
());

470  
	g´efix
 + 
	gRDB_PER_PARTITION_QUALIFIER_NAME_SEP
 + 
	gRDB_CF_NAME_QUALIFIER
 +

471 
	gRDB_QUALIFIER_VALUE_SEP
;

474 cÚ¡ 
	g¡d
::
¡ršg
 
Rdb_key_def
::
g’_‰l_du¿tiÚ_qu®if›r_fÜ_·¹™iÚ
(

475 cÚ¡ 
¡d
::
¡ršg
 &
´efix
) {

476 
DBUG_ASSERT
(!
´efix
.
em±y
());

478  
	g´efix
 + 
	gRDB_PER_PARTITION_QUALIFIER_NAME_SEP
 +

479 
	gRDB_TTL_DURATION_QUALIFIER
 + 
	gRDB_QUALIFIER_VALUE_SEP
;

482 cÚ¡ 
	g¡d
::
¡ršg


483 
Rdb_key_def
::
g’_‰l_cŞ_qu®if›r_fÜ_·¹™iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
´efix
) {

484 
DBUG_ASSERT
(!
´efix
.
em±y
());

486  
	g´efix
 + 
	gRDB_PER_PARTITION_QUALIFIER_NAME_SEP
 + 
	gRDB_TTL_COL_QUALIFIER
 +

487 
	gRDB_QUALIFIER_VALUE_SEP
;

490 cÚ¡ 
	g¡d
::
¡ršg
 
Rdb_key_def
::
·r£_comm’t_fÜ_qu®if›r
(

491 cÚ¡ 
¡d
::
¡ršg
 &
comm’t
, cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

492 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
, 
boŞ
 *
³r_·¹_m©ch_found
,

493 cÚ¡ *cÚ¡ 
qu®if›r
) {

494 
DBUG_ASSERT
(
bË_¬g
 !ğ
nuÎ±r
);

495 
DBUG_ASSERT
(
tbl_def_¬g
 !ğ
nuÎ±r
);

496 
DBUG_ASSERT
(
³r_·¹_m©ch_found
 !ğ
nuÎ±r
);

497 
DBUG_ASSERT
(
qu®if›r
 !ğ
nuÎ±r
);

499 
	g¡d
::
¡ršg
 
em±y_»suÉ
;

502 *
	g³r_·¹_m©ch_found
 = 
çl£
;

504 ià(
	gcomm’t
.
em±y
()) {

505  
	gem±y_»suÉ
;

510 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
v
 =

511 
myrocks
::
·r£_što_tok’s
(
comm’t
, 
RDB_QUALIFIER_SEP
);

513 
	g¡d
::
¡ršg
 
£¬ch_¡r
 = 
g’_qu®if›r_fÜ_bË
(
qu®if›r
);

520 
	g¡d
::
¡ršg
 
£¬ch_¡r_·¹
;

521 ià(
	gbË_¬g
->
	g·¹_šfo
 !ğ
nuÎ±r
) {

522 
¡d
::
¡ršg
 
·¹™iÚ_Çme
 = 
tbl_def_¬g
->
ba£_·¹™iÚ
();

523 
DBUG_ASSERT
(!
·¹™iÚ_Çme
.
em±y
());

524 
	g£¬ch_¡r_·¹
 = 
g’_qu®if›r_fÜ_bË
(
qu®if›r
, 
·¹™iÚ_Çme
);

527 
DBUG_ASSERT
(!
£¬ch_¡r
.
em±y
());

531 ià(!
	g£¬ch_¡r_·¹
.
em±y
()) {

532 cÚ¡‡utØ&
	g™
 : 
v
) {

533 ià(
™
.
sub¡r
(0, 
£¬ch_¡r_·¹
.
Ëngth
()) == search_str_part) {

535 
¡d
::
veùÜ
<¡d::
¡ršg
> 
tok’s
 =

536 
myrocks
::
·r£_što_tok’s
(
™
, 
RDB_QUALIFIER_VALUE_SEP
);

546 ià(
	gtok’s
.
size
() == 2) {

547 *
³r_·¹_m©ch_found
 = 
Œue
;

548  
	gtok’s
[1];

550  
	gem±y_»suÉ
;

558 cÚ¡‡utØ&
	g™
 : 
v
) {

559 ià(
™
.
sub¡r
(0, 
£¬ch_¡r
.
Ëngth
()) == search_str) {

560 
¡d
::
veùÜ
<¡d::
¡ršg
> 
tok’s
 =

561 
myrocks
::
·r£_što_tok’s
(
™
, 
RDB_QUALIFIER_VALUE_SEP
);

562 ià(
	gtok’s
.
size
() == 2) {

563  
tok’s
[1];

565  
	gem±y_»suÉ
;

572  
	gem±y_»suÉ
;

580 
	gRdb_key_def
::
»ad_memcmp_key_·¹
(cÚ¡ 
TABLE
 *
bË_¬g
,

581 
Rdb_¡ršg_»ad”
 *
»ad”
,

582 cÚ¡ 
ušt
 
·¹_num
) const {

584 ià(
	gm_·ck_šfo
[
·¹_num
].
	gm_maybe_nuÎ
) {

585 cÚ¡ *
	gnuÎp
;

586 ià(!(
	gnuÎp
 = 
»ad”
->
»ad
(1)))

588 ià(*
	gnuÎp
 == 0) {

593 ià(*
	gnuÎp
 != 1)

598 
Rdb_f›ld_·ckšg
 *
	gåi
 = &
m_·ck_šfo
[
·¹_num
];

599 
DBUG_ASSERT
(
bË_¬g
->
s
 !ğ
nuÎ±r
);

601 
boŞ
 
	gis_hidd’_pk_·¹
 = (
·¹_num
 + 1 =ğ
m_key_·¹s
) &&

602 (
bË_¬g
->
s
->
´im¬y_key
 =ğ
MAX_INDEXES
);

603 
F›ld
 *
	gf›ld
 = 
nuÎ±r
;

604 ià(!
	gis_hidd’_pk_·¹
)

605 
	gf›ld
 = 
åi
->
g‘_f›ld_š_bË
(
bË_¬g
);

606 ià((
	gthis
->*
	gåi
->
	gm_sk_func
)(åi, 
	gf›ld
, 
	g»ad”
))

637 
ušt
 
	gRdb_key_def
::
g‘_´im¬y_key_tu¶e
(cÚ¡ 
TABLE
 *cÚ¡ 
bË
,

638 cÚ¡ 
Rdb_key_def
 &
pk_desü
,

639 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
key
,

640 
uch¬
 *cÚ¡ 
pk_bufãr
) const {

641 
DBUG_ASSERT
(
bË
 !ğ
nuÎ±r
);

642 
DBUG_ASSERT
(
key
 !ğ
nuÎ±r
);

643 
DBUG_ASSERT
(
pk_bufãr
);

645 
ušt
 
	gsize
 = 0;

646 
uch¬
 *
	gbuf
 = 
pk_bufãr
;

647 
DBUG_ASSERT
(
m_pk_key_·¹s
);

650 
rdb_Ãtbuf_¡Üe_šdex
(
buf
, 
pk_desü
.
m_šdex_numb”
);

651 
	gbuf
 +ğ
INDEX_NUMBER_SIZE
;

652 
	gsize
 +ğ
INDEX_NUMBER_SIZE
;

654 cÚ¡ *
	g¡¬t_offs
[
MAX_REF_PARTS
];

655 cÚ¡ *
	g’d_offs
[
MAX_REF_PARTS
];

656 
	gpk_key_·¹
;

657 
ušt
 
	gi
;

658 
Rdb_¡ršg_»ad”
 
»ad”
(
key
);

661 ià((!
	g»ad”
.
»ad
(
INDEX_NUMBER_SIZE
)))

662  
	gRDB_INVALID_KEY_LEN
;

664 
	gi
 = 0; i < 
	gm_key_·¹s
; i++) {

665 ià((
	gpk_key_·¹
 = 
m_pk_·¹_no
[
i
]) != -1) {

666 
¡¬t_offs
[
pk_key_·¹
] = 
»ad”
.
g‘_cu¼’t_±r
();

669 ià(
»ad_memcmp_key_·¹
(
bË
, &
»ad”
, 
i
) > 0) {

670  
	gRDB_INVALID_KEY_LEN
;

673 ià(
	gpk_key_·¹
 != -1) {

674 
’d_offs
[
pk_key_·¹
] = 
»ad”
.
g‘_cu¼’t_±r
();

678 
	gi
 = 0; i < 
	gm_pk_key_·¹s
; i++) {

679 cÚ¡ 
ušt
 
	g·¹_size
 = 
’d_offs
[
i
] - 
¡¬t_offs
[i];

680 
memıy
(
buf
, 
¡¬t_offs
[
i
], 
’d_offs
[i] - start_offs[i]);

681 
	gbuf
 +ğ
·¹_size
;

682 
	gsize
 +ğ
·¹_size
;

685  
	gsize
;

697 
ušt
 
	gRdb_key_def
::
g‘_memcmp_sk_·¹s
(cÚ¡ 
TABLE
 *
bË
,

698 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

699 
uch¬
 *
sk_bufãr
,

700 
ušt
 *
n_nuÎ_f›lds
) const {

701 
DBUG_ASSERT
(
bË
 !ğ
nuÎ±r
);

702 
DBUG_ASSERT
(
sk_bufãr
 !ğ
nuÎ±r
);

703 
DBUG_ASSERT
(
n_nuÎ_f›lds
 !ğ
nuÎ±r
);

704 
DBUG_ASSERT
(
m_keyno
 !ğ
bË
->
s
->
´im¬y_key
 && !
bË_has_hidd’_pk
(table));

706 
uch¬
 *
	gbuf
 = 
sk_bufãr
;

708 
	g»s
;

709 
Rdb_¡ršg_»ad”
 
»ad”
(&
key
);

710 cÚ¡ *
	g¡¬t
 = 
»ad”
.
g‘_cu¼’t_±r
();

713 ià((!
	g»ad”
.
»ad
(
INDEX_NUMBER_SIZE
)))

714  
	gRDB_INVALID_KEY_LEN
;

716 
ušt
 
	gi
 = 0; i < 
	gbË
->
	gkey_šfo
[
m_keyno
].
	gu£r_defšed_key_·¹s
; i++) {

717 ià((
	g»s
 = 
»ad_memcmp_key_·¹
(
bË
, &
»ad”
, 
i
)) > 0) {

718  
	gRDB_INVALID_KEY_LEN
;

719 } ià(
	g»s
 == -1) {

720 (*
n_nuÎ_f›lds
)++;

724 
ušt
 
	gsk_memcmp_Ën
 = 
»ad”
.
g‘_cu¼’t_±r
(è- 
¡¬t
;

725 
memıy
(
buf
, 
¡¬t
, 
sk_memcmp_Ën
);

726  
	gsk_memcmp_Ën
;

740 
ušt
 
	gRdb_key_def
::
·ck_šdex_tu¶e
(
TABLE
 *cÚ¡ 
tbl
, 
uch¬
 *cÚ¡ 
·ck_bufãr
,

741 
uch¬
 *cÚ¡ 
·cked_tu¶e
,

742 cÚ¡ 
uch¬
 *cÚ¡ 
key_tu¶e
,

743 cÚ¡ 
key_·¹_m­
 &
key·¹_m­
) const {

744 
DBUG_ASSERT
(
tbl
 !ğ
nuÎ±r
);

745 
DBUG_ASSERT
(
·ck_bufãr
 !ğ
nuÎ±r
);

746 
DBUG_ASSERT
(
·cked_tu¶e
 !ğ
nuÎ±r
);

747 
DBUG_ASSERT
(
key_tu¶e
 !ğ
nuÎ±r
);

750 cÚ¡ 
ušt
 
	gkey_Ën
 = 
ÿlcuÏ‹_key_Ën
(
tbl
, 
m_keyno
, 
key_tu¶e
, 
key·¹_m­
);

751 
key_»¡Üe
(
tbl
->
»cÜd
[0], 
key_tu¶e
, &tbl->
key_šfo
[
m_keyno
], 
key_Ën
);

753 
ušt
 
	gn_u£d_·¹s
 = 
my_couÁ_b™s
(
key·¹_m­
);

754 ià(
	gkey·¹_m­
 =ğ
HA_WHOLE_KEY
)

755 
n_u£d_·¹s
 = 0;

758  
·ck_»cÜd
(
tbl
, 
·ck_bufãr
,bl->
»cÜd
[0], 
·cked_tu¶e
, 
nuÎ±r
,

759 
çl£
, 0, 
n_u£d_·¹s
);

771 
boŞ
 
	gRdb_key_def
::
uÅack_šfo_has_checksum
(cÚ¡ 
rocksdb
::
Sliû
 &
uÅack_šfo
) {

772 
size_t
 
size
 = 
uÅack_šfo
.size();

773 ià(
	gsize
 == 0) {

774  
çl£
;

776 cÚ¡ 
uch¬
 *
	g±r
 = (cÚ¡ uch¬ *)
uÅack_šfo
.
d©a
();

779 ià(
is_uÅack_d©a_g
(
±r
[0]è&& 
	gsize
 >ğ
g‘_uÅack_h—d”_size
(ptr[0])) {

780 cÚ¡ 
ušt16
 
sk_Ën
 = 
rdb_Ãtbuf_to_ušt16
(
±r
 + 1);

781 
SHIP_ASSERT
(
size
 >ğ
sk_Ën
);

783 
	gsize
 -ğ
sk_Ën
;

784 
	g±r
 +ğ
sk_Ën
;

787  (
	gsize
 =ğ
RDB_CHECKSUM_CHUNK_SIZE
 && 
±r
[0] =ğ
RDB_CHECKSUM_DATA_TAG
);

793 
	gRdb_key_def
::
sucûssÜ
(
uch¬
 *cÚ¡ 
·cked_tu¶e
, cÚ¡ 
ušt
 &
Ën
) {

794 
DBUG_ASSERT
(
·cked_tu¶e
 !ğ
nuÎ±r
);

796 
	gchªged
 = 0;

797 
uch¬
 *
	gp
 = 
·cked_tu¶e
 + 
Ën
 - 1;

798 ; 
	gp
 > 
	g·cked_tu¶e
;…--) {

799 
	gchªged
++;

800 ià(*
	gp
 !ğ
uch¬
(0xFF)) {

801 *
p
 = *p + 1;

804 *
	gp
 = '\0';

806  
	gchªged
;

812 
	gRdb_key_def
::
´edeûssÜ
(
uch¬
 *cÚ¡ 
·cked_tu¶e
, cÚ¡ 
ušt
 &
Ën
) {

813 
DBUG_ASSERT
(
·cked_tu¶e
 !ğ
nuÎ±r
);

815 
	gchªged
 = 0;

816 
uch¬
 *
	gp
 = 
·cked_tu¶e
 + 
Ën
 - 1;

817 ; 
	gp
 > 
	g·cked_tu¶e
;…--) {

818 
	gchªged
++;

819 ià(*
	gp
 !ğ
uch¬
(0x00)) {

820 *
p
 = *p - 1;

823 *
	gp
 = 0xFF;

825  
	gchªged
;

828 cÚ¡ 
	g¡d
::
m­
<, 
	gsize_t
> 
	gUNPACK_HEADER_SIZES
 = {

829 {
RDB_UNPACK_DATA_TAG
, 
RDB_UNPACK_HEADER_SIZE
},

830 {
RDB_UNPACK_COVERED_DATA_TAG
, 
RDB_UNPACK_COVERED_HEADER_SIZE
}};

835 
size_t
 
	gRdb_key_def
::
g‘_uÅack_h—d”_size
(
g
) {

836 
DBUG_ASSERT
(
is_uÅack_d©a_g
(
g
));

837  
	gUNPACK_HEADER_SIZES
.
©
(
g
);

846 
	gRdb_key_def
::
g‘_lookup_b™m­
(cÚ¡ 
TABLE
 *
bË
, 
MY_BITMAP
 *
m­
) const {

847 
DBUG_ASSERT
(
m­
->
b™m­
 =ğ
nuÎ±r
);

848 
b™m­_š™
(
m­
, 
nuÎ±r
, 
MAX_REF_PARTS
, 
çl£
);

849 
ušt
 
	gcu¼_b™m­_pos
 = 0;

852 
MY_BITMAP
 
	gmaybe_cov”ed_b™m­
;

853 
b™m­_š™
(&
maybe_cov”ed_b™m­
, 
nuÎ±r
, 
bË
->
»ad_£t
->
n_b™s
, 
çl£
);

855 
ušt
 
	gi
 = 0; i < 
	gm_key_·¹s
; i++) {

856 ià(
bË_has_hidd’_pk
(
bË
è&& 
	gi
 + 1 =ğ
m_key_·¹s
) {

860 
F›ld
 *cÚ¡ 
	gf›ld
 = 
m_·ck_šfo
[
i
].
g‘_f›ld_š_bË
(
bË
);

864 ià(
	gm_·ck_šfo
[
i
].
	gm_cov”ed
 &&

865 
b™m­_is_£t
(
bË
->
»ad_£t
, 
f›ld
->
f›ld_šdex
)) {

866 
b™m­_£t_b™
(&
maybe_cov”ed_b™m­
, 
f›ld
->
f›ld_šdex
);

870 
	gf›ld
->
»®_ty³
()) {

873 
	gMYSQL_TYPE_VARCHAR
:

874 ià(
cu¼_b™m­_pos
 < 
MAX_REF_PARTS
) {

875 ià(
b™m­_is_£t
(
bË
->
»ad_£t
, 
f›ld
->
f›ld_šdex
)) {

876 
b™m­_£t_b™
(
m­
, 
cu¼_b™m­_pos
);

877 
b™m­_£t_b™
(&
maybe_cov”ed_b™m­
, 
f›ld
->
f›ld_šdex
);

879 
	gcu¼_b™m­_pos
++;

881 
b™m­_ä“
(&
maybe_cov”ed_b™m­
);

882 
b™m­_ä“
(
m­
);

889 ià(
b™m­_is_£t
(
bË
->
»ad_£t
, 
f›ld
->
f›ld_šdex
)) {

890 
b™m­_ä“
(&
maybe_cov”ed_b™m­
);

891 
b™m­_ä“
(
m­
);

900 ià(!
b™m­_cmp
(
bË
->
»ad_£t
, &
maybe_cov”ed_b™m­
)) {

901 
b™m­_ä“
(
m­
);

903 
b™m­_ä“
(&
maybe_cov”ed_b™m­
);

912 
boŞ
 
	gRdb_key_def
::
cov”s_lookup
(
TABLE
 *cÚ¡ 
bË
,

913 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
uÅack_šfo
,

914 cÚ¡ 
MY_BITMAP
 *cÚ¡ 
lookup_b™m­
) const {

915 
DBUG_ASSERT
(
lookup_b™m­
 !ğ
nuÎ±r
);

916 ià(!
u£_cov”ed_b™m­_fÜm©
(è|| 
	glookup_b™m­
->
	gb™m­
 =ğ
nuÎ±r
) {

917  
çl£
;

920 
Rdb_¡ršg_»ad”
 
	guÅ_»ad”
 = Rdb_¡ršg_»ad”::
»ad_Ü_em±y
(
uÅack_šfo
);

923 cÚ¡ *
	guÅack_h—d”
 = 
uÅ_»ad”
.
g‘_cu¼’t_±r
();

924 cÚ¡ 
boŞ
 
	ghas_cov”ed_uÅack_šfo
 =

925 
uÅ_»ad”
.
»maššg_by‹s
() &&

926 
uÅack_h—d”
[0] =ğ
RDB_UNPACK_COVERED_DATA_TAG
;

927 ià(!
	ghas_cov”ed_uÅack_šfo
 ||

928 !
	guÅ_»ad”
.
»ad
(
RDB_UNPACK_COVERED_HEADER_SIZE
)) {

929  
	gçl£
;

932 
MY_BITMAP
 
	gcov”ed_b™m­
;

933 
my_b™m­_m­
 
	gcov”ed_b™s
;

934 
b™m­_š™
(&
cov”ed_b™m­
, &
cov”ed_b™s
, 
MAX_REF_PARTS
, 
çl£
);

935 
	gcov”ed_b™s
 = 
rdb_Ãtbuf_to_ušt16
((cÚ¡ 
uch¬
 *)
uÅack_h—d”
 +

936 (
RDB_UNPACK_COVERED_DATA_TAG
) +

937 
RDB_UNPACK_COVERED_DATA_LEN_SIZE
);

939  
b™m­_is_sub£t
(
lookup_b™m­
, &
cov”ed_b™m­
);

942 
uch¬
 *
	gRdb_key_def
::
·ck_f›ld
(
F›ld
 *cÚ¡ 
f›ld
, 
Rdb_f›ld_·ckšg
 *
·ck_šfo
,

943 
uch¬
 *
tu¶e
, uch¬ *cÚ¡ 
·cked_tu¶e
,

944 
uch¬
 *cÚ¡ 
·ck_bufãr
,

945 
Rdb_¡ršg_wr™”
 *cÚ¡ 
uÅack_šfo
,

946 
ušt
 *cÚ¡ 
n_nuÎ_f›lds
) const {

947 ià(
	gf›ld
->
»®_maybe_nuÎ
()) {

948 
DBUG_ASSERT
(
is_¡Üage_avaabË
(
tu¶e
 - 
·cked_tu¶e
, 1));

949 ià(
	gf›ld
->
is_»®_nuÎ
()) {

951 *
	gtu¶e
++ = 0;

953 ià(
	gn_nuÎ_f›lds
)

954 (*
	gn_nuÎ_f›lds
)++;

955  
	gtu¶e
;

958 *
	gtu¶e
++ = 1;

962 cÚ¡ 
boŞ
 
	gü—‹_uÅack_šfo
 =

963 (
uÅack_šfo
 &&

964 
·ck_šfo
->
u£s_uÅack_šfo
());

965 
Rdb_·ck_f›ld_cÚ‹xt
 
·ck_ùx
(
uÅack_šfo
);

968 
DBUG_ASSERT
(
is_¡Üage_avaabË
(
tu¶e
 - 
·cked_tu¶e
,

969 
·ck_šfo
->
m_max_image_Ën
));

971 (
	gthis
->*
	g·ck_šfo
->
	gm_·ck_func
)Õack_šfo, 
	gf›ld
, 
	g·ck_bufãr
, &
	gtu¶e
,

972 &
	g·ck_ùx
);

975 ià(
	gü—‹_uÅack_šfo
) {

976 (
	gthis
->*
	g·ck_šfo
->
	gm_make_uÅack_šfo_func
)Õack_šfo->
	gm_ch¬£t_codec
,

977 
	gf›ld
, &
	g·ck_ùx
);

980  
	gtu¶e
;

1006 
ušt
 
	gRdb_key_def
::
·ck_»cÜd
(

1007 cÚ¡ 
TABLE
 *cÚ¡ 
tbl
, 
uch¬
 *cÚ¡ 
·ck_bufãr
, cÚ¡ uch¬ *cÚ¡ 
»cÜd
,

1008 
uch¬
 *cÚ¡ 
·cked_tu¶e
, 
Rdb_¡ršg_wr™”
 *cÚ¡ 
uÅack_šfo
,

1009 cÚ¡ 
boŞ
 &
should_¡Üe_row_debug_checksums
, cÚ¡ 
lÚglÚg
 &
hidd’_pk_id
,

1010 
ušt
 
n_key_·¹s
, ušˆ*cÚ¡ 
n_nuÎ_f›lds
, ušˆ*cÚ¡ 
‰l_pk_off£t
,

1011 cÚ¡ *cÚ¡ 
‰l_by‹s
) const {

1012 
DBUG_ASSERT
(
tbl
 !ğ
nuÎ±r
);

1013 
DBUG_ASSERT
(
·ck_bufãr
 !ğ
nuÎ±r
);

1014 
DBUG_ASSERT
(
»cÜd
 !ğ
nuÎ±r
);

1015 
DBUG_ASSERT
(
·cked_tu¶e
 !ğ
nuÎ±r
);

1018 
DBUG_ASSERT_IMP
(
should_¡Üe_row_debug_checksums
,

1019 (
m_šdex_ty³
 =ğ
INDEX_TYPE_SECONDARY
));

1021 
uch¬
 *
	gtu¶e
 = 
·cked_tu¶e
;

1022 
size_t
 
	guÅack_¡¬t_pos
 = size_t(-1);

1023 
size_t
 
	guÅack_Ën_pos
 = size_t(-1);

1024 
size_t
 
	gcov”ed_b™m­_pos
 = size_t(-1);

1025 cÚ¡ 
boŞ
 
	ghidd’_pk_exi¡s
 = 
bË_has_hidd’_pk
(
tbl
);

1027 
rdb_Ãtbuf_¡Üe_šdex
(
tu¶e
, 
m_šdex_numb”
);

1028 
	gtu¶e
 +ğ
INDEX_NUMBER_SIZE
;

1034 cÚ¡ 
boŞ
 
	gu£_®l_cŞumns
 = 
n_key_·¹s
 =ğ0 ||‚_key_·¹ =ğ
MAX_REF_PARTS
;

1038 ià(
	ghidd’_pk_exi¡s
 && !
	ghidd’_pk_id
 && 
	gu£_®l_cŞumns
)

1039 
	gn_key_·¹s
 = 
m_key_·¹s
 - 1;

1040 ià(
	gu£_®l_cŞumns
)

1041 
	gn_key_·¹s
 = 
m_key_·¹s
;

1043 ià(
	gn_nuÎ_f›lds
)

1044 *
	gn_nuÎ_f›lds
 = 0;

1048 
boŞ
 
	g¡Üe_cov”ed_b™m­
 = 
çl£
;

1049 ià(
	guÅack_šfo
 && 
u£_cov”ed_b™m­_fÜm©
()) {

1050 
ušt
 
	gi
 = 0; i < 
	gn_key_·¹s
; i++) {

1051 ià(!
	gm_·ck_šfo
[
i
].
	gm_cov”ed
) {

1052 
	g¡Üe_cov”ed_b™m­
 = 
Œue
;

1058 cÚ¡ 
	gg
 =

1059 
¡Üe_cov”ed_b™m­
 ? 
RDB_UNPACK_COVERED_DATA_TAG
 : 
RDB_UNPACK_DATA_TAG
;

1061 ià(
	guÅack_šfo
) {

1062 
	guÅack_šfo
->
ş—r
();

1064 ià(
	gm_šdex_ty³
 =ğ
INDEX_TYPE_SECONDARY
 &&

1065 
m_tÙ®_šdex_æags_Ëngth
 > 0) {

1067 
uÅack_šfo
->
®loÿ‹
(
m_tÙ®_šdex_æags_Ëngth
);

1070 ià(
has_‰l
(è&& 
	g‰l_by‹s
) {

1071 
wr™e_šdex_æag_f›ld
(
uÅack_šfo
,

1072 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *cÚ¡>(
‰l_by‹s
),

1073 
Rdb_key_def
::
TTL_FLAG
);

1077 
	guÅack_¡¬t_pos
 = 
uÅack_šfo
->
g‘_cu¼’t_pos
();

1078 
	guÅack_šfo
->
wr™e_ušt8
(
g
);

1079 
	guÅack_Ën_pos
 = 
uÅack_šfo
->
g‘_cu¼’t_pos
();

1081 
	guÅack_šfo
->
wr™e_ušt16
(0);

1083 ià(
	g¡Üe_cov”ed_b™m­
) {

1087 
	gcov”ed_b™m­_pos
 = 
uÅack_šfo
->
g‘_cu¼’t_pos
();

1088 
	guÅack_šfo
->
wr™e_ušt16
(0);

1092 
MY_BITMAP
 
	gcov”ed_b™m­
;

1093 
my_b™m­_m­
 
	gcov”ed_b™s
;

1094 
ušt
 
	gcu¼_b™m­_pos
 = 0;

1095 
b™m­_š™
(&
cov”ed_b™m­
, &
cov”ed_b™s
, 
MAX_REF_PARTS
, 
çl£
);

1097 
ušt
 
	gi
 = 0; i < 
	gn_key_·¹s
; i++) {

1100 ià(
	ghidd’_pk_exi¡s
 && 
	ghidd’_pk_id
 && 
	gi
 + 1 =ğ
n_key_·¹s
) {

1101 
m_·ck_šfo
[
i
].
fl_hidd’_pk_v®
(&
tu¶e
, 
hidd’_pk_id
);

1105 
F›ld
 *cÚ¡ 
	gf›ld
 = 
m_·ck_šfo
[
i
].
g‘_f›ld_š_bË
(
tbl
);

1106 
DBUG_ASSERT
(
f›ld
 !ğ
nuÎ±r
);

1108 
ušt
 
	gf›ld_off£t
 = 
f›ld
->
±r
 - 
tbl
->
»cÜd
[0];

1109 
ušt
 
	gnuÎ_off£t
 = 
f›ld
->
nuÎ_off£t
(
tbl
->
»cÜd
[0]);

1110 
boŞ
 
	gmaybe_nuÎ
 = 
f›ld
->
»®_maybe_nuÎ
();

1114 ià(
	g‰l_pk_off£t
 && 
	gm_‰l_du¿tiÚ
 > 0 && 
	gi
 =ğ
m_‰l_pk_key_·¹_off£t
) {

1115 
DBUG_ASSERT
(
f›ld
->
check_f›ld_Çme_m©ch
(
m_‰l_cŞumn
.
c_¡r
()));

1116 
DBUG_ASSERT
(
f›ld
->
»®_ty³
(è=ğ
MYSQL_TYPE_LONGLONG
);

1117 
DBUG_ASSERT
(
f›ld
->
key_ty³
(è=ğ
HA_KEYTYPE_ULONGLONG
);

1118 
DBUG_ASSERT
(!
f›ld
->
»®_maybe_nuÎ
());

1119 *
	g‰l_pk_off£t
 = 
tu¶e
 - 
·cked_tu¶e
;

1122 
	gf›ld
->
move_f›ld
(
cÚ¡_ÿ¡
<
uch¬
*>(
»cÜd
è+ 
f›ld_off£t
,

1123 
maybe_nuÎ
 ? 
cÚ¡_ÿ¡
<
uch¬
*>(
»cÜd
è+ 
nuÎ_off£t
 : 
nuÎ±r
,

1124 
f›ld
->
nuÎ_b™
);

1127 
	gtu¶e
 = 
·ck_f›ld
(
f›ld
, &
m_·ck_šfo
[
i
], 
tu¶e
, 
·cked_tu¶e
, 
·ck_bufãr
,

1128 
uÅack_šfo
, 
n_nuÎ_f›lds
);

1131 ià(
	g¡Üe_cov”ed_b™m­
 && 
	gf›ld
->
»®_ty³
(è=ğ
MYSQL_TYPE_VARCHAR
 &&

1132 !
m_·ck_šfo
[
i
].
m_cov”ed
 && 
cu¼_b™m­_pos
 < 
MAX_REF_PARTS
) {

1133 
size_t
 
d©a_Ëngth
 = 
f›ld
->data_length();

1134 
ušt16
 
	gkey_Ëngth
;

1135 ià(
	gm_pk_·¹_no
[
i
] =ğ(
ušt
)-1) {

1136 
key_Ëngth
 = 
tbl
->
key_šfo
[
g‘_keyno
()].
key_·¹
[
i
].
Ëngth
;

1138 
	gkey_Ëngth
 =

1139 
tbl
->
key_šfo
[tbl->
s
->
´im¬y_key
].
key_·¹
[
m_pk_·¹_no
[
i
]].
Ëngth
;

1142 ià(
	gm_·ck_šfo
[
i
].
	gm_uÅack_func
 !ğ
nuÎ±r
 &&

1143 
d©a_Ëngth
 <ğ
key_Ëngth
) {

1144 
b™m­_£t_b™
(&
cov”ed_b™m­
, 
cu¼_b™m­_pos
);

1146 
	gcu¼_b™m­_pos
++;

1150 
	gf›ld
->
move_f›ld
(
tbl
->
»cÜd
[0] + 
f›ld_off£t
,

1151 
maybe_nuÎ
 ? 
tbl
->
»cÜd
[0] + 
nuÎ_off£t
 : 
nuÎ±r
,

1152 
f›ld
->
nuÎ_b™
);

1155 ià(
	guÅack_šfo
) {

1156 cÚ¡ 
size_t
 
	gËn
 = 
uÅack_šfo
->
g‘_cu¼’t_pos
(è- 
uÅack_¡¬t_pos
;

1157 
DBUG_ASSERT
(
Ën
 <ğ
¡d
::
num”ic_lim™s
<
ušt16_t
>::
max
());

1164 ià(
	gm_šdex_ty³
 =ğ
Rdb_key_def
::
INDEX_TYPE_SECONDARY
) {

1165 ià(
Ën
 =ğ
g‘_uÅack_h—d”_size
(
g
è&& !
cov”ed_b™s
) {

1166 
uÅack_šfo
->
Œunÿ‹
(
uÅack_¡¬t_pos
);

1167 } ià(
	g¡Üe_cov”ed_b™m­
) {

1168 
	guÅack_šfo
->
wr™e_ušt16_©
(
cov”ed_b™m­_pos
, 
cov”ed_b™s
);

1171 
	guÅack_šfo
->
wr™e_ušt16_©
(
uÅack_Ën_pos
, 
Ën
);

1180 ià(
	gshould_¡Üe_row_debug_checksums
) {

1181 cÚ¡ 
ušt32_t
 
	gkey_üc32
 = 
üc32
(0, 
·cked_tu¶e
, 
tu¶e
 -…acked_tuple);

1182 cÚ¡ 
ušt32_t
 
	gv®_üc32
 =

1183 
üc32
(0, 
uÅack_šfo
->
±r
(), uÅack_šfo->
g‘_cu¼’t_pos
());

1185 
	guÅack_šfo
->
wr™e_ušt8
(
RDB_CHECKSUM_DATA_TAG
);

1186 
	guÅack_šfo
->
wr™e_ušt32
(
key_üc32
);

1187 
	guÅack_šfo
->
wr™e_ušt32
(
v®_üc32
);

1191 
DBUG_ASSERT
(
is_¡Üage_avaabË
(
tu¶e
 - 
·cked_tu¶e
, 0));

1193  
	gtu¶e
 - 
	g·cked_tu¶e
;

1208 
ušt
 
	gRdb_key_def
::
·ck_hidd’_pk
(cÚ¡ 
lÚglÚg
 &
hidd’_pk_id
,

1209 
uch¬
 *cÚ¡ 
·cked_tu¶e
) const {

1210 
DBUG_ASSERT
(
·cked_tu¶e
 !ğ
nuÎ±r
);

1212 
uch¬
 *
	gtu¶e
 = 
·cked_tu¶e
;

1213 
rdb_Ãtbuf_¡Üe_šdex
(
tu¶e
, 
m_šdex_numb”
);

1214 
	gtu¶e
 +ğ
INDEX_NUMBER_SIZE
;

1215 
DBUG_ASSERT
(
m_key_·¹s
 == 1);

1216 
DBUG_ASSERT
(
is_¡Üage_avaabË
(
tu¶e
 - 
·cked_tu¶e
,

1217 
m_·ck_šfo
[0].
m_max_image_Ën
));

1219 
	gm_·ck_šfo
[0].
fl_hidd’_pk_v®
(&
tu¶e
, 
hidd’_pk_id
);

1221 
DBUG_ASSERT
(
is_¡Üage_avaabË
(
tu¶e
 - 
·cked_tu¶e
, 0));

1222  
	gtu¶e
 - 
	g·cked_tu¶e
;

1229 
	gRdb_key_def
::
·ck_w™h_make_sÜt_key
(

1230 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
,

1231 
uch¬
 *cÚ¡ 
buf
 
MY_ATTRIBUTE
((
__unu£d__
)), uch¬ **
d¡
,

1232 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

1233 
DBUG_ASSERT
(
åi
 !ğ
nuÎ±r
);

1234 
DBUG_ASSERT
(
f›ld
 !ğ
nuÎ±r
);

1235 
DBUG_ASSERT
(
d¡
 !ğ
nuÎ±r
);

1236 
DBUG_ASSERT
(*
d¡
 !ğ
nuÎ±r
);

1238 cÚ¡ 
	gmax_Ën
 = 
åi
->
m_max_image_Ën
;

1239 
	gf›ld
->
make_sÜt_key
(*
d¡
, 
max_Ën
);

1240 *
	gd¡
 +ğ
max_Ën
;

1252 
	gRdb_key_def
::
com·»_keys
(cÚ¡ 
rocksdb
::
Sliû
 *
key1
,

1253 cÚ¡ 
rocksdb
::
Sliû
 *
key2
,

1254 
¡d
::
size_t
 *cÚ¡ 
cŞumn_šdex
) const {

1255 
DBUG_ASSERT
(
key1
 !ğ
nuÎ±r
);

1256 
DBUG_ASSERT
(
key2
 !ğ
nuÎ±r
);

1257 
DBUG_ASSERT
(
cŞumn_šdex
 !ğ
nuÎ±r
);

1261 *
	gcŞumn_šdex
 = 0xbadf00d;

1263 
Rdb_¡ršg_»ad”
 
»ad”1
(
key1
);

1264 
Rdb_¡ršg_»ad”
 
»ad”2
(
key2
);

1267 ià((!
	g»ad”1
.
»ad
(
INDEX_NUMBER_SIZE
)))

1268  
	gHA_EXIT_FAILURE
;

1270 ià((!
	g»ad”2
.
»ad
(
INDEX_NUMBER_SIZE
)))

1271  
	gHA_EXIT_FAILURE
;

1273 
ušt
 
	gi
 = 0; i < 
	gm_key_·¹s
; i++) {

1274 cÚ¡ 
Rdb_f›ld_·ckšg
 *cÚ¡ 
	gåi
 = &
m_·ck_šfo
[
i
];

1275 ià(
	gåi
->
	gm_maybe_nuÎ
) {

1276 cÚ¡‡utØ
	gnuÎp1
 = 
»ad”1
.
»ad
(1);

1277 cÚ¡‡utØ
	gnuÎp2
 = 
»ad”2
.
»ad
(1);

1279 ià(
	gnuÎp1
 =ğ
nuÎ±r
 || 
nuÎp2
 ==‚ullptr) {

1280  
HA_EXIT_FAILURE
;

1283 ià(*
	gnuÎp1
 !ğ*
nuÎp2
) {

1284 *
cŞumn_šdex
 = 
i
;

1285  
	gHA_EXIT_SUCCESS
;

1288 ià(*
	gnuÎp1
 == 0) {

1294 cÚ¡‡utØ
	gbefÜe_sk1
 = 
»ad”1
.
g‘_cu¼’t_±r
();

1295 cÚ¡‡utØ
	gbefÜe_sk2
 = 
»ad”2
.
g‘_cu¼’t_±r
();

1296 
DBUG_ASSERT
(
åi
->
m_sk_func
);

1297 ià((
	gthis
->*
	gåi
->
	gm_sk_func
)(åi, 
	gnuÎ±r
, &
	g»ad”1
))

1298  
	gHA_EXIT_FAILURE
;

1299 ià((
	gthis
->*
	gåi
->
	gm_sk_func
)(åi, 
	gnuÎ±r
, &
	g»ad”2
))

1300  
	gHA_EXIT_FAILURE
;

1301 cÚ¡‡utØ
	gsize1
 = 
»ad”1
.
g‘_cu¼’t_±r
(è- 
befÜe_sk1
;

1302 cÚ¡‡utØ
	gsize2
 = 
»ad”2
.
g‘_cu¼’t_±r
(è- 
befÜe_sk2
;

1303 ià(
	gsize1
 !ğ
size2
) {

1304 *
cŞumn_šdex
 = 
i
;

1305  
	gHA_EXIT_SUCCESS
;

1308 ià(
memcmp
(
befÜe_sk1
, 
befÜe_sk2
, 
size1
) != 0) {

1309 *
cŞumn_šdex
 = 
i
;

1310  
	gHA_EXIT_SUCCESS
;

1314 *
	gcŞumn_šdex
 = 
m_key_·¹s
;

1315  
	gHA_EXIT_SUCCESS
;

1326 
size_t
 
	gRdb_key_def
::
key_Ëngth
(cÚ¡ 
TABLE
 *cÚ¡ 
bË
,

1327 cÚ¡ 
rocksdb
::
Sliû
 &
key
) const {

1328 
DBUG_ASSERT
(
bË
 !ğ
nuÎ±r
);

1330 
Rdb_¡ršg_»ad”
 
»ad”
(&
key
);

1332 ià((!
	g»ad”
.
»ad
(
INDEX_NUMBER_SIZE
)))

1333  
size_t
(-1);

1335 
ušt
 
	gi
 = 0; i < 
	gm_key_·¹s
; i++) {

1336 cÚ¡ 
Rdb_f›ld_·ckšg
 *
	gåi
 = &
m_·ck_šfo
[
i
];

1337 cÚ¡ 
F›ld
 *
	gf›ld
 = 
nuÎ±r
;

1338 ià(
	gm_šdex_ty³
 !ğ
INDEX_TYPE_HIDDEN_PRIMARY
)

1339 
f›ld
 = 
åi
->
g‘_f›ld_š_bË
(
bË
);

1340 ià((
	gthis
->*
	gåi
->
	gm_sk_func
)(åi, 
	gf›ld
, &
	g»ad”
))

1341  
size_t
(-1);

1343  
	gkey
.
size
(è- 
	g»ad”
.
»maššg_by‹s
();

1346 
	gRdb_key_def
::
uÅack_f›ld
(

1347 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

1348 
F›ld
 *cÚ¡ 
f›ld
,

1349 
Rdb_¡ršg_»ad”
* 
»ad”
,

1350 cÚ¡ 
uch¬
 *cÚ¡ 
deçuÉ_v®ue
,

1351 
Rdb_¡ršg_»ad”
* 
uÅ_»ad”
) const

1353 ià(
	gåi
->
	gm_maybe_nuÎ
) {

1354 cÚ¡ *
	gnuÎp
;

1355 ià(!(
	gnuÎp
 = 
»ad”
->
»ad
(1))) {

1356  
HA_EXIT_FAILURE
;

1359 ià(*
	gnuÎp
 == 0) {

1361 
f›ld
->
£t_nuÎ
();

1363 
memıy
(
f›ld
->
±r
, 
deçuÉ_v®ue
, f›ld->
·ck_Ëngth
());

1364  
	gHA_EXIT_SUCCESS
;

1365 } ià(*
	gnuÎp
 == 1) {

1366 
f›ld
->
£t_nÙnuÎ
();

1368  
	gHA_EXIT_FAILURE
;

1372  (
	gthis
->*
	gåi
->
	gm_uÅack_func
)(åi, 
	gf›ld
, f›ld->
	g±r
, 
	g»ad”
,

1373 
	guÅ_»ad”
);

1387 
	gRdb_key_def
::
uÅack_»cÜd
(
TABLE
 *cÚ¡ 
bË
, 
uch¬
 *cÚ¡ 
buf
,

1388 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
·cked_key
,

1389 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
uÅack_šfo
,

1390 cÚ¡ 
boŞ
 &
v”ify_row_debug_checksums
) const {

1391 
Rdb_¡ršg_»ad”
 
»ad”
(
·cked_key
);

1392 
Rdb_¡ršg_»ad”
 
	guÅ_»ad”
 = Rdb_¡ršg_»ad”::
»ad_Ü_em±y
(
uÅack_šfo
);

1394 cÚ¡ 
boŞ
 
	gis_hidd’_pk
 = (
m_šdex_ty³
 =ğ
INDEX_TYPE_HIDDEN_PRIMARY
);

1395 cÚ¡ 
boŞ
 
	ghidd’_pk_exi¡s
 = 
bË_has_hidd’_pk
(
bË
);

1396 cÚ¡ 
boŞ
 
	g£cÚd¬y_key
 = (
m_šdex_ty³
 =ğ
INDEX_TYPE_SECONDARY
);

1400 
DBUG_ASSERT_IMP
(!
£cÚd¬y_key
, !
v”ify_row_debug_checksums
);

1403 ià((!
	g»ad”
.
»ad
(
INDEX_NUMBER_SIZE
))) {

1404  
	gHA_ERR_ROCKSDB_CORRUPT_DATA
;

1410 cÚ¡ *
	guÅack_h—d”
 = 
uÅ_»ad”
.
g‘_cu¼’t_±r
();

1411 cÚ¡ 
boŞ
 
	ghas_uÅack_šfo
 =

1412 
uÅ_»ad”
.
»maššg_by‹s
(è&& 
is_uÅack_d©a_g
(
uÅack_h—d”
[0]);

1413 ià(
	ghas_uÅack_šfo
) {

1414 ià((
	gm_šdex_ty³
 =ğ
INDEX_TYPE_SECONDARY
 &&

1415 
m_tÙ®_šdex_æags_Ëngth
 > 0 &&

1416 !
uÅ_»ad”
.
»ad
(
m_tÙ®_šdex_æags_Ëngth
)) ||

1417 !
uÅ_»ad”
.
»ad
(
g‘_uÅack_h—d”_size
(
uÅack_h—d”
[0]))) {

1418  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

1423 
MY_BITMAP
 
	gcov”ed_b™m­
;

1424 
my_b™m­_m­
 
	gcov”ed_b™s
;

1425 
ušt
 
	gcu¼_b™m­_pos
 = 0;

1427 cÚ¡ 
boŞ
 
	ghas_cov”ed_b™m­
 =

1428 
has_uÅack_šfo
 && (
uÅack_h—d”
[0] =ğ
RDB_UNPACK_COVERED_DATA_TAG
);

1429 ià(
	ghas_cov”ed_b™m­
) {

1430 
b™m­_š™
(&
cov”ed_b™m­
, &
cov”ed_b™s
, 
MAX_REF_PARTS
, 
çl£
);

1431 
	gcov”ed_b™s
 = 
rdb_Ãtbuf_to_ušt16
((cÚ¡ 
uch¬
 *)
uÅack_h—d”
 +

1432 (
RDB_UNPACK_COVERED_DATA_TAG
) +

1433 
RDB_UNPACK_COVERED_DATA_LEN_SIZE
);

1436 
ušt
 
	gi
 = 0; i < 
	gm_key_·¹s
; i++) {

1437 
Rdb_f›ld_·ckšg
 *cÚ¡ 
	gåi
 = &
m_·ck_šfo
[
i
];

1443 ià((
	g£cÚd¬y_key
 && 
	ghidd’_pk_exi¡s
 && 
	gi
 + 1 =ğ
m_key_·¹s
) ||

1444 
is_hidd’_pk
) {

1445 
DBUG_ASSERT
(
åi
->
m_uÅack_func
);

1446 ià((
	gthis
->*
	gåi
->
	gm_sk_func
)(åi, 
	gnuÎ±r
, &
	g»ad”
)) {

1447  
	gHA_ERR_ROCKSDB_CORRUPT_DATA
;

1452 
F›ld
 *cÚ¡ 
	gf›ld
 = 
åi
->
g‘_f›ld_š_bË
(
bË
);

1454 
boŞ
 
	gcov”ed_cŞumn
 = 
Œue
;

1455 ià(
	ghas_cov”ed_b™m­
 && 
	gf›ld
->
»®_ty³
(è=ğ
MYSQL_TYPE_VARCHAR
 &&

1456 !
m_·ck_šfo
[
i
].
m_cov”ed
) {

1457 
cov”ed_cŞumn
 = 
cu¼_b™m­_pos
 < 
MAX_REF_PARTS
 &&

1458 
b™m­_is_£t
(&
cov”ed_b™m­
, 
cu¼_b™m­_pos
++);

1460 ià(
	gåi
->
	gm_uÅack_func
 && 
	gcov”ed_cŞumn
) {

1463 
ušt
 
	gf›ld_off£t
 = 
f›ld
->
±r
 - 
bË
->
»cÜd
[0];

1464 
ušt
 
	gnuÎ_off£t
 = 
f›ld
->
nuÎ_off£t
();

1465 
boŞ
 
	gmaybe_nuÎ
 = 
f›ld
->
»®_maybe_nuÎ
();

1466 
	gf›ld
->
move_f›ld
(
buf
 + 
f›ld_off£t
,

1467 
maybe_nuÎ
 ? 
buf
 + 
nuÎ_off£t
 : 
nuÎ±r
,

1468 
f›ld
->
nuÎ_b™
);

1474 cÚ¡ 
boŞ
 
	gmaybe_missšg_uÅack
 =

1475 !
has_uÅack_šfo
 && 
åi
->
u£s_uÅack_šfo
();

1476 
	g»s
 = 
uÅack_f›ld
(
åi
, 
f›ld
, &
»ad”
,

1477 
bË
->
s
->
deçuÉ_v®ues
 + 
f›ld_off£t
,

1478 
maybe_missšg_uÅack
 ? 
nuÎ±r
 : &
uÅ_»ad”
);

1481 
	gf›ld
->
move_f›ld
(
bË
->
»cÜd
[0] + 
f›ld_off£t
,

1482 
maybe_nuÎ
 ? 
bË
->
»cÜd
[0] + 
nuÎ_off£t
 : 
nuÎ±r
,

1483 
f›ld
->
nuÎ_b™
);

1485 ià(
	g»s
 !ğ
UNPACK_SUCCESS
) {

1486  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

1490 ià(
	gåi
->
	gm_maybe_nuÎ
) {

1491 cÚ¡ *
	gnuÎp
;

1492 ià(!(
	gnuÎp
 = 
»ad”
.
»ad
(1)))

1493  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

1494 ià(*
	gnuÎp
 == 0) {

1499 ià(*
	gnuÎp
 != 1)

1500  
HA_ERR_ROCKSDB_CORRUPT_DATA
;

1502 ià((
	gthis
->*
	gåi
->
	gm_sk_func
)(åi, 
	gf›ld
, &
	g»ad”
))

1503  
	gHA_ERR_ROCKSDB_CORRUPT_DATA
;

1512 ià(
	gåi
->
	gm_sk_func
 =ğ&
Rdb_key_def
::
sk_v¬ŸbË_¥aû_·d
 &&

1513 !
åi
->
m_uÅack_šfo_¡Ües_v®ue
) {

1514 
uÅ_»ad”
.
»ad
(
åi
->
m_uÅack_šfo_u£s_two_by‹s
 ? 2 : 1);

1522 cÚ¡ *
	g±r
;

1523 ià((
	g±r
 = 
uÅ_»ad”
.
»ad
(1)è&& *
±r
 =ğ
RDB_CHECKSUM_DATA_TAG
) {

1524 ià(
v”ify_row_debug_checksums
) {

1525 
ušt32_t
 
¡Üed_key_chksum
 = 
rdb_Ãtbuf_to_ušt32
(

1526 (cÚ¡ 
uch¬
 *)
uÅ_»ad”
.
»ad
(
RDB_CHECKSUM_SIZE
));

1527 cÚ¡ 
ušt32_t
 
	g¡Üed_v®_chksum
 = 
rdb_Ãtbuf_to_ušt32
(

1528 (cÚ¡ 
uch¬
 *)
uÅ_»ad”
.
»ad
(
RDB_CHECKSUM_SIZE
));

1530 cÚ¡ 
ušt32_t
 
	gcompu‹d_key_chksum
 =

1531 
üc32
(0, (cÚ¡ 
uch¬
 *)
·cked_key
->
d©a
(),…acked_key->
size
());

1532 cÚ¡ 
ušt32_t
 
	gcompu‹d_v®_chksum
 =

1533 
üc32
(0, (cÚ¡ 
uch¬
 *)
uÅack_šfo
->
d©a
(),

1534 
uÅack_šfo
->
size
(è- 
RDB_CHECKSUM_CHUNK_SIZE
);

1536 
DBUG_EXECUTE_IF
("myrocks_simulate_bad_key_checksum1",

1537 
¡Üed_key_chksum
++;);

1539 ià(
	g¡Üed_key_chksum
 !ğ
compu‹d_key_chksum
) {

1540 
»pÜt_checksum_mism©ch
(
Œue
, 
·cked_key
->
d©a
(),…acked_key->
size
());

1541  
	gHA_ERR_ROCKSDB_CHECKSUM_MISMATCH
;

1544 ià(
	g¡Üed_v®_chksum
 !ğ
compu‹d_v®_chksum
) {

1545 
»pÜt_checksum_mism©ch
(
çl£
, 
uÅack_šfo
->
d©a
(),

1546 
uÅack_šfo
->
size
(è- 
RDB_CHECKSUM_CHUNK_SIZE
);

1547  
	gHA_ERR_ROCKSDB_CHECKSUM_MISMATCH
;

1554 ià(
	g»ad”
.
»maššg_by‹s
())

1555  
	gHA_ERR_ROCKSDB_CORRUPT_DATA
;

1557  
	gHA_EXIT_SUCCESS
;

1560 
boŞ
 
	gRdb_key_def
::
bË_has_hidd’_pk
(cÚ¡ 
TABLE
 *cÚ¡ 
bË
) {

1561  
bË
->
s
->
´im¬y_key
 =ğ
MAX_INDEXES
;

1564 
	gRdb_key_def
::
»pÜt_checksum_mism©ch
(cÚ¡ 
boŞ
 &
is_key
,

1565 cÚ¡ *cÚ¡ 
d©a
,

1566 cÚ¡ 
size_t
 
d©a_size
) const {

1568 
sql_´št_”rÜ
("Checksum mismatch in %s of key-value…air for index 0x%x",

1569 
is_key
 ? "key" : "v®ue", 
g‘_šdex_numb”
());

1571 cÚ¡ 
	g¡d
::
¡ršg
 
buf
 = 
rdb_hexdump
(
d©a
, 
d©a_size
, 
RDB_MAX_HEXDUMP_LEN
);

1573 
sql_´št_”rÜ
("D©¨w™h incÜ»ù checksum (%" 
PRIu64
 " bytes): %s",

1574 (
ušt64_t
)
d©a_size
, 
buf
.
c_¡r
());

1576 
my_”rÜ
(
ER_INTERNAL_ERROR
, 
MYF
(0), "Record checksum mismatch");

1579 
boŞ
 
	gRdb_key_def
::
šdex_fÜm©_mš_check
(cÚ¡ &
pk_mš
,

1580 cÚ¡ &
sk_mš
) const {

1581 
	gm_šdex_ty³
) {

1582 
	gINDEX_TYPE_PRIMARY
:

1583 
INDEX_TYPE_HIDDEN_PRIMARY
:

1584  (
m_kv_fÜm©_v”siÚ
 >ğ
pk_mš
);

1585 
	gINDEX_TYPE_SECONDARY
:

1586  (
m_kv_fÜm©_v”siÚ
 >ğ
sk_mš
);

1588 
DBUG_ASSERT
(0);

1589  
	gçl£
;

1601 
	gRdb_key_def
::
sk_max_Ëngth
(cÚ¡ 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

1602 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld


1603 
MY_ATTRIBUTE
((
__unu£d__
)),

1604 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
) const {

1605 ià(!
	g»ad”
->
»ad
(
åi
->
m_max_image_Ën
))

1606  
	gHA_EXIT_FAILURE
;

1607  
	gHA_EXIT_SUCCESS
;

1616 
	#RDB_ESCAPE_LENGTH
 9

	)

1617 
	#RDB_LEGACY_ESCAPE_LENGTH
 
RDB_ESCAPE_LENGTH


	)

1618 
¡©ic_as£¹
((
RDB_ESCAPE_LENGTH
 - 1) % 2 == 0,

1621 
	#RDB_ENCODED_SIZE
(
Ën
) \

1622 ((
Ën
 + (
RDB_ESCAPE_LENGTH
 - 2)) / (RDB_ESCAPE_LENGTH - 1)) * \

1623 
RDB_ESCAPE_LENGTH


	)

1625 
	#RDB_LEGACY_ENCODED_SIZE
(
Ën
) \

1626 ((
Ën
 + (
RDB_LEGACY_ESCAPE_LENGTH
 - 1)) / (RDB_LEGACY_ESCAPE_LENGTH - 1)) * \

1627 
RDB_LEGACY_ESCAPE_LENGTH


	)

1633 
	gRdb_key_def
::
sk_v¬ŸbË_Ëngth
(

1634 cÚ¡ 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
 
MY_ATTRIBUTE
((
__unu£d__
)),

1635 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
) const {

1636 cÚ¡ 
uch¬
 *
	g±r
;

1637 
boŞ
 
	gfšished
 = 
çl£
;

1639 
size_t
 
	gd¡_Ën
;

1640 ià(
	gf›ld
) {

1641 cÚ¡ 
F›ld_v¬¡ršg
 *cÚ¡ 
	gf›ld_v¬
 =

1642 
¡©ic_ÿ¡
<cÚ¡ 
F›ld_v¬¡ršg
 *>(
f›ld
);

1643 
	gd¡_Ën
 = 
f›ld_v¬
->
·ck_Ëngth
(è- f›ld_v¬->
Ëngth_by‹s
;

1645 
	gd¡_Ën
 = 
UINT_MAX
;

1648 
boŞ
 
	gu£_Ëgacy_fÜm©
 = 
u£_Ëgacy_v¬bš¬y_fÜm©
();

1651 (
	g±r
 = (cÚ¡ 
uch¬
 *)
»ad”
->
»ad
(
RDB_ESCAPE_LENGTH
))) {

1652 
ušt
 
u£d_by‹s
;

1655 ià(
	gu£_Ëgacy_fÜm©
) {

1656 
	gu£d_by‹s
 = 
ÿlc_uÅack_Ëgacy_v¬ŸbË_fÜm©
(

1657 
±r
[
RDB_ESCAPE_LENGTH
 - 1], &
fšished
);

1659 
	gu£d_by‹s
 =

1660 
ÿlc_uÅack_v¬ŸbË_fÜm©
(
±r
[
RDB_ESCAPE_LENGTH
 - 1], &
fšished
);

1663 ià(
	gu£d_by‹s
 =ğ(
ušt
)-1 || 
d¡_Ën
 < 
u£d_by‹s
) {

1664  
HA_EXIT_FAILURE
;

1667 ià(
	gfšished
) {

1671 
	gd¡_Ën
 -ğ
u£d_by‹s
;

1674 ià(!
	gfšished
) {

1675  
	gHA_EXIT_FAILURE
;

1678  
	gHA_EXIT_SUCCESS
;

1681 cÚ¡ 
	gVARCHAR_CMP_LESS_THAN_SPACES
 = 1;

1682 cÚ¡ 
	gVARCHAR_CMP_EQUAL_TO_SPACES
 = 2;

1683 cÚ¡ 
	gVARCHAR_CMP_GREATER_THAN_SPACES
 = 3;

1689 
	gRdb_key_def
::
sk_v¬ŸbË_¥aû_·d
(

1690 cÚ¡ 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
,

1691 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
) const {

1692 cÚ¡ 
uch¬
 *
	g±r
;

1693 
boŞ
 
	gfšished
 = 
çl£
;

1695 
size_t
 
	gd¡_Ën
 = 
UINT_MAX
;

1697 ià(
	gf›ld
) {

1698 cÚ¡ 
F›ld_v¬¡ršg
 *cÚ¡ 
	gf›ld_v¬
 =

1699 
¡©ic_ÿ¡
<cÚ¡ 
F›ld_v¬¡ršg
 *>(
f›ld
);

1700 
	gd¡_Ën
 = 
f›ld_v¬
->
·ck_Ëngth
(è- f›ld_v¬->
Ëngth_by‹s
;

1704 (
	g±r
 = (cÚ¡ 
uch¬
 *)
»ad”
->
»ad
(
åi
->
m_£gm’t_size
))) {

1706 cÚ¡ 
uch¬
 
c
 = 
±r
[
åi
->
m_£gm’t_size
 - 1];

1707 ià(
	gc
 =ğ
VARCHAR_CMP_EQUAL_TO_SPACES
) {

1709 
fšished
 = 
Œue
;

1711 } ià(
	gc
 =ğ
VARCHAR_CMP_LESS_THAN_SPACES
 ||

1712 
c
 =ğ
VARCHAR_CMP_GREATER_THAN_SPACES
) {

1714 ià((
åi
->
m_£gm’t_size
 - 1è> 
d¡_Ën
) {

1717  
HA_EXIT_FAILURE
;

1719 
	gd¡_Ën
 -ğ(
åi
->
m_£gm’t_size
 - 1);

1723  
	gHA_EXIT_FAILURE
;

1726  
	gfšished
 ? 
	gHA_EXIT_SUCCESS
 : 
HA_EXIT_FAILURE
;

1733 
	gRdb_key_def
::
uÅack_š‹g”
(

1734 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *cÚ¡ 
to
,

1735 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

1736 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

1737 cÚ¡ 
	gËngth
 = 
åi
->
m_max_image_Ën
;

1739 cÚ¡ 
uch¬
 *
	gäom
;

1740 ià(!(
	gäom
 = (cÚ¡ 
uch¬
 *)
»ad”
->
»ad
(
Ëngth
)))

1741  
UNPACK_FAILURE
;

1743 #ifdeà
WORDS_BIGENDIAN


1745 ià(((
	gF›ld_num
 *)
	gf›ld
)->
	gunsigÃd_æag
)

1746 
	gto
[0] = 
äom
[0];

1748 
	gto
[0] = ()(
äom
[0] ^ 128);

1749 
memıy
(
to
 + 1, 
äom
 + 1, 
Ëngth
 - 1);

1753 cÚ¡ 
	gsign_by‹
 = 
äom
[0];

1754 ià(((
	gF›ld_num
 *)
	gf›ld
)->
	gunsigÃd_æag
)

1755 
	gto
[
Ëngth
 - 1] = 
sign_by‹
;

1757 
	gto
[
Ëngth
 - 1] =

1758 
¡©ic_ÿ¡
<>(
sign_by‹
 ^ 128);

1759 
	gi
 = 0, 
	gj
 = 
Ëngth
 - 1; i < 
	gËngth
 - 1; ++i, --j)

1760 
	gto
[
i
] = 
äom
[
j
];

1763  
	gUNPACK_SUCCESS
;

1766 #ià!
defšed
(
WORDS_BIGENDIAN
)

1767 
rdb_sw­_doubË_by‹s
(
uch¬
 *cÚ¡ 
d¡
, cÚ¡ uch¬ *cÚ¡ 
¤c
) {

1768 #ià
defšed
(
__FLOAT_WORD_ORDER
è&& (__FLOAT_WORD_ORDER =ğ
__BIG_ENDIAN
)

1770 
	gd¡
[0] = 
¤c
[3];

1771 
	gd¡
[1] = 
¤c
[2];

1772 
	gd¡
[2] = 
¤c
[1];

1773 
	gd¡
[3] = 
¤c
[0];

1774 
	gd¡
[4] = 
¤c
[7];

1775 
	gd¡
[5] = 
¤c
[6];

1776 
	gd¡
[6] = 
¤c
[5];

1777 
	gd¡
[7] = 
¤c
[4];

1779 
	gd¡
[0] = 
¤c
[7];

1780 
	gd¡
[1] = 
¤c
[6];

1781 
	gd¡
[2] = 
¤c
[5];

1782 
	gd¡
[3] = 
¤c
[4];

1783 
	gd¡
[4] = 
¤c
[3];

1784 
	gd¡
[5] = 
¤c
[2];

1785 
	gd¡
[6] = 
¤c
[1];

1786 
	gd¡
[7] = 
¤c
[0];

1790 
rdb_sw­_æßt_by‹s
(
uch¬
 *cÚ¡ 
d¡
, cÚ¡ uch¬ *cÚ¡ 
¤c
) {

1791 
	gd¡
[0] = 
¤c
[3];

1792 
	gd¡
[1] = 
¤c
[2];

1793 
	gd¡
[2] = 
¤c
[1];

1794 
	gd¡
[3] = 
¤c
[0];

1797 
	#rdb_sw­_doubË_by‹s
 
nuÎ±r


	)

1798 
	#rdb_sw­_æßt_by‹s
 
nuÎ±r


	)

1801 
	gRdb_key_def
::
uÅack_æßtšg_pošt
(

1802 
uch¬
 *cÚ¡ 
d¡
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
, cÚ¡ 
size_t
 &
size
,

1803 cÚ¡ &
exp_dig™
, cÚ¡ 
uch¬
 *cÚ¡ 
z”o_·‰”n
,

1804 cÚ¡ 
uch¬
 *cÚ¡ 
z”o_v®
,

1805 (*
sw­_func
)(
uch¬
 *, const uchar *)) const {

1806 cÚ¡ 
uch¬
 *cÚ¡ 
	gäom
 = (cÚ¡ uch¬ *)
»ad”
->
»ad
(
size
);

1807 ià(
	gäom
 =ğ
nuÎ±r
)

1808  
UNPACK_FAILURE
;

1811 ià(
memcmp
(
äom
, 
z”o_·‰”n
, 
size
) == 0) {

1812 
memıy
(
d¡
, 
z”o_v®
, 
size
);

1813  
	gUNPACK_SUCCESS
;

1816 #ià
defšed
(
WORDS_BIGENDIAN
)

1818 
uch¬
 *cÚ¡ 
	gtmp
 = 
d¡
;

1821 
uch¬
 
	gtmp
[8];

1824 
memıy
(
tmp
, 
äom
, 
size
);

1826 ià(
	gtmp
[0] & 0x80) {

1829 
ushÜt
 
	gexp_·¹
 = ((ushÜt)
tmp
[0] << 8) | (ushort)tmp[1];

1830 
	gexp_·¹
 &= 0x7FFF;

1831 
	gexp_·¹
 -ğ(
ushÜt
)1 << (16 - 1 - 
exp_dig™
);

1832 
	gtmp
[0] = (
uch¬
)(
exp_·¹
 >> 8);

1833 
	gtmp
[1] = (
uch¬
)
exp_·¹
;

1837 
size_t
 
	gii
 = 0; i˜< 
	gsize
; ii++)

1838 
	gtmp
[
ii
] ^= 0xFF;

1841 #ià!
defšed
(
WORDS_BIGENDIAN
)

1843 
sw­_func
(
d¡
, 
tmp
);

1845 
DBUG_ASSERT
(
sw­_func
 =ğ
nuÎ±r
);

1848  
	gUNPACK_SUCCESS
;

1851 #ià!
defšed
(
DBL_EXP_DIG
)

1852 
	#DBL_EXP_DIG
 ((è* 8 - 
DBL_MANT_DIG
)

	)

1863 
	gRdb_key_def
::
uÅack_doubË
(

1864 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
 
MY_ATTRIBUTE
((
__unu£d__
)),

1865 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)), 
uch¬
 *cÚ¡ 
f›ld_±r
,

1866 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

1867 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

1868 
	gz”o_v®
 = 0.0;

1869 cÚ¡ 
uch¬
 
	gz”o_·‰”n
[8] = {128, 0, 0, 0, 0, 0, 0, 0};

1871  
uÅack_æßtšg_pošt
(
f›ld_±r
, 
»ad”
, (), 
DBL_EXP_DIG
,

1872 
z”o_·‰”n
, (cÚ¡ 
uch¬
 *)&
z”o_v®
,

1873 
rdb_sw­_doubË_by‹s
);

1876 #ià!
defšed
(
FLT_EXP_DIG
)

1877 
	#FLT_EXP_DIG
 ((è* 8 - 
FLT_MANT_DIG
)

	)

1888 
	gRdb_key_def
::
uÅack_æßt
(

1889 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

1890 
uch¬
 *cÚ¡ 
f›ld_±r
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

1891 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

1892 
	gz”o_v®
 = 0.0;

1893 cÚ¡ 
uch¬
 
	gz”o_·‰”n
[4] = {128, 0, 0, 0};

1895  
uÅack_æßtšg_pošt
(
f›ld_±r
, 
»ad”
, (), 
FLT_EXP_DIG
,

1896 
z”o_·‰”n
, (cÚ¡ 
uch¬
 *)&
z”o_v®
,

1897 
rdb_sw­_æßt_by‹s
);

1905 
	gRdb_key_def
::
uÅack_Ãwd©e
(

1906 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

1907 
uch¬
 *cÚ¡ 
f›ld_±r
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

1908 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

1909 cÚ¡ *
	gäom
;

1910 
DBUG_ASSERT
(
åi
->
m_max_image_Ën
 == 3);

1912 ià(!(
	gäom
 = 
»ad”
->
»ad
(3)))

1913  
UNPACK_FAILURE
;

1915 
	gf›ld_±r
[0] = 
äom
[2];

1916 
	gf›ld_±r
[1] = 
äom
[1];

1917 
	gf›ld_±r
[2] = 
äom
[0];

1918  
	gUNPACK_SUCCESS
;

1927 
	gRdb_key_def
::
uÅack_bš¬y_¡r
(

1928 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *cÚ¡ 
to
,

1929 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

1930 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

1931 cÚ¡ *
	gäom
;

1932 ià(!(
	gäom
 = 
»ad”
->
»ad
(
åi
->
m_max_image_Ën
)))

1933  
UNPACK_FAILURE
;

1935 
memıy
(
to
, 
äom
, 
åi
->
m_max_image_Ën
);

1936  
	gUNPACK_SUCCESS
;

1945 
	gRdb_key_def
::
uÅack_utf8_¡r
(

1946 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
d¡
,

1947 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

1948 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

1949 
	gmy_cÜe
::
CHARSET_INFO
 *cÚ¡ 
c£t
 = (
my_cÜe
::CHARSET_INFO *)
f›ld
->
ch¬£t
();

1950 cÚ¡ 
uch¬
 *
	g¤c
;

1951 ià(!(
	g¤c
 = (cÚ¡ 
uch¬
 *)
»ad”
->
»ad
(
åi
->
m_max_image_Ën
)))

1952  
UNPACK_FAILURE
;

1954 cÚ¡ 
uch¬
 *cÚ¡ 
	g¤c_’d
 = 
¤c
 + 
åi
->
m_max_image_Ën
;

1955 
uch¬
 *cÚ¡ 
	gd¡_’d
 = 
d¡
 + 
f›ld
->
·ck_Ëngth
();

1957 
	g¤c
 < 
	g¤c_’d
) {

1958 
my_wc_t
 
	gwc
 = (
¤c
[0] << 8) | src[1];

1959 
	g¤c
 += 2;

1960 
	g»s
 = 
c£t
->c£t->
wc_mb
(c£t, 
wc
, 
d¡
, 
d¡_’d
);

1961 
DBUG_ASSERT
(
»s
 > 0 &&„es <= 3);

1962 ià(
	g»s
 < 0)

1963  
	gUNPACK_FAILURE
;

1964 
	gd¡
 +ğ
»s
;

1967 
	gc£t
->c£t->
fl
(
c£t
, 
»š‹½»t_ÿ¡
<*>(
d¡
), 
d¡_’d
 - dst,

1968 
c£t
->
·d_ch¬
);

1969  
	gUNPACK_SUCCESS
;

1990 
	gRdb_key_def
::
·ck_Ëgacy_v¬ŸbË_fÜm©
(

1991 cÚ¡ 
uch¬
 *
¤c
,

1992 
size_t
 
¤c_Ën
,

1993 
uch¬
 **
d¡
) const

1995 
size_t
 
	gcİy_Ën
;

1996 
size_t
 
	g·ddšg_by‹s
;

1997 
uch¬
 *
	g±r
 = *
d¡
;

2000 
	gcİy_Ën
 = 
¡d
::
mš
((
size_t
)
RDB_LEGACY_ESCAPE_LENGTH
 - 1, 
¤c_Ën
);

2001 
	g·ddšg_by‹s
 = 
RDB_LEGACY_ESCAPE_LENGTH
 - 1 - 
cİy_Ën
;

2002 
memıy
(
±r
, 
¤c
, 
cİy_Ën
);

2003 
	g±r
 +ğ
cİy_Ën
;

2004 
	g¤c
 +ğ
cİy_Ën
;

2006 ià(
	g·ddšg_by‹s
 > 0) {

2007 
mem£t
(
±r
, 0, 
·ddšg_by‹s
);

2008 
	g±r
 +ğ
·ddšg_by‹s
;

2011 *(
	g±r
++èğ255 - 
·ddšg_by‹s
;

2013 
	g¤c_Ën
 -ğ
cİy_Ën
;

2014 } 
	g·ddšg_by‹s
 == 0);

2016 *
	gd¡
 = 
±r
;

2042 
	gRdb_key_def
::
·ck_v¬ŸbË_fÜm©
(

2043 cÚ¡ 
uch¬
 *
¤c
,

2044 
size_t
 
¤c_Ën
,

2045 
uch¬
 **
d¡
) const

2047 
uch¬
 *
	g±r
 = *
d¡
;

2051 cÚ¡ 
size_t
 
	gcİy_Ën
 = 
¡d
::
mš
((size_t)
RDB_ESCAPE_LENGTH
 - 1, 
¤c_Ën
);

2052 
memıy
(
±r
, 
¤c
, 
cİy_Ën
);

2053 
	g±r
 +ğ
cİy_Ën
;

2054 
	g¤c
 +ğ
cİy_Ën
;

2055 
	g¤c_Ën
 -ğ
cİy_Ën
;

2058 ià(
	g¤c_Ën
 == 0) {

2060 cÚ¡ 
size_t
 
·ddšg_by‹s
 = 
RDB_ESCAPE_LENGTH
 - 1 - 
cİy_Ën
;

2061 ià(
	g·ddšg_by‹s
 > 0) {

2062 
mem£t
(
±r
, 0, 
·ddšg_by‹s
);

2063 
	g±r
 +ğ
·ddšg_by‹s
;

2067 *(
	g±r
++èğ(
uch¬
)
cİy_Ën
;

2072 *(
	g±r
++èğ
RDB_ESCAPE_LENGTH
;

2075 *
	gd¡
 = 
±r
;

2082 
	gRdb_key_def
::
·ck_w™h_v¬ch¬_’codšg
(

2083 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
buf
, uch¬ **
d¡
,

2084 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

2085 cÚ¡ 
CHARSET_INFO
 *cÚ¡ 
	gch¬£t
 = 
f›ld
->
ch¬£t
();

2086 
F›ld_v¬¡ršg
 *cÚ¡ 
	gf›ld_v¬
 = (F›ld_v¬¡ršg *)
f›ld
;

2088 cÚ¡ 
size_t
 
	gv®ue_Ëngth
 = (
f›ld_v¬
->
Ëngth_by‹s
 == 1)

2089 ? (
ušt
)*
f›ld
->
±r


2090 : 
ušt2kÜr
(
f›ld
->
±r
);

2091 
size_t
 
	gxäm_Ën
 = 
ch¬£t
->
cŞl
->
¡ºxäm
(

2092 
ch¬£t
, 
buf
, 
åi
->
m_max_image_Ën
, 
f›ld_v¬
->
ch¬_Ëngth
(),

2093 
f›ld_v¬
->
±r
 + f›ld_v¬->
Ëngth_by‹s
, 
v®ue_Ëngth
, 0);

2096 ià(
u£_Ëgacy_v¬bš¬y_fÜm©
()) {

2097 
·ck_Ëgacy_v¬ŸbË_fÜm©
(
buf
, 
xäm_Ën
, 
d¡
);

2099 
·ck_v¬ŸbË_fÜm©
(
buf
, 
xäm_Ën
, 
d¡
);

2109 
rdb_com·»_¡ršg_w™h_¥aûs
(cÚ¡ 
uch¬
 *
buf
, cÚ¡ uch¬ *cÚ¡ 
buf_’d
,

2110 cÚ¡ 
¡d
::
veùÜ
<
uch¬
> *cÚ¡ 
¥aû_xäm
) {

2111 
cmp
 = 0;

2112 
	gbuf
 < 
	gbuf_’d
) {

2113 
size_t
 
	gby‹s
 = 
¡d
::
mš
((size_t)(
buf_’d
 - 
buf
), 
¥aû_xäm
->
size
());

2114 ià((
	gcmp
 = 
memcmp
(
buf
, 
¥aû_xäm
->
d©a
(), 
by‹s
)) != 0)

2116 
	gbuf
 +ğ
by‹s
;

2118  
	gcmp
;

2121 cÚ¡ 
	gRDB_TRIMMED_CHARS_OFFSET
 = 8;

2193 
	gRdb_key_def
::
·ck_w™h_v¬ch¬_¥aû_·d
(

2194 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
buf
, uch¬ **
d¡
,

2195 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const {

2196 
Rdb_¡ršg_wr™”
 *cÚ¡ 
	guÅack_šfo
 = 
·ck_ùx
->
wr™”
;

2197 cÚ¡ 
CHARSET_INFO
 *cÚ¡ 
	gch¬£t
 = 
f›ld
->
ch¬£t
();

2198 cÚ¡‡utØ
	gf›ld_v¬
 = 
¡©ic_ÿ¡
<
F›ld_v¬¡ršg
 *>(
f›ld
);

2200 cÚ¡ 
size_t
 
	gv®ue_Ëngth
 = (
f›ld_v¬
->
Ëngth_by‹s
 == 1)

2201 ? (
ušt
)*
f›ld
->
±r


2202 : 
ušt2kÜr
(
f›ld
->
±r
);

2204 cÚ¡ 
size_t
 
	gŒimmed_Ën
 = 
ch¬£t
->
c£t
->
Ëngth¥
(

2205 
ch¬£t
, (cÚ¡ *)
f›ld_v¬
->
±r
 + f›ld_v¬->
Ëngth_by‹s
,

2206 
v®ue_Ëngth
);

2207 cÚ¡ 
size_t
 
	gxäm_Ën
 = 
ch¬£t
->
cŞl
->
¡ºxäm
(

2208 
ch¬£t
, 
buf
, 
åi
->
m_max_image_Ën
, 
f›ld_v¬
->
ch¬_Ëngth
(),

2209 
f›ld_v¬
->
±r
 + f›ld_v¬->
Ëngth_by‹s
, 
Œimmed_Ën
, 0);

2212 
uch¬
 *cÚ¡ 
	gbuf_’d
 = 
buf
 + 
xäm_Ën
;

2214 
size_t
 
	g’coded_size
 = 0;

2215 
uch¬
 *
	g±r
 = *
d¡
;

2216 
size_t
 
	g·ddšg_by‹s
;

2217 
	gŒue
) {

2218 cÚ¡ 
size_t
 
	gcİy_Ën
 =

2219 
¡d
::
mš
<
size_t
>(
åi
->
m_£gm’t_size
 - 1, 
	gbuf_’d
 - 
	gbuf
);

2220 
	g·ddšg_by‹s
 = 
åi
->
m_£gm’t_size
 - 1 - 
cİy_Ën
;

2221 
memıy
(
±r
, 
buf
, 
cİy_Ën
);

2222 
	g±r
 +ğ
cİy_Ën
;

2223 
	gbuf
 +ğ
cİy_Ën
;

2225 ià(
	g·ddšg_by‹s
) {

2226 
memıy
(
±r
, 
åi
->
¥aû_xäm
->
d©a
(), 
·ddšg_by‹s
);

2227 
	g±r
 +ğ
·ddšg_by‹s
;

2228 *
	g±r
 = 
VARCHAR_CMP_EQUAL_TO_SPACES
;

2233 cÚ¡ 
	gcmp
 =

2234 
rdb_com·»_¡ršg_w™h_¥aûs
(
buf
, 
buf_’d
, 
åi
->
¥aû_xäm
);

2236 ià(
	gcmp
 < 0)

2237 *
	g±r
 = 
VARCHAR_CMP_LESS_THAN_SPACES
;

2238 ià(
	gcmp
 > 0)

2239 *
	g±r
 = 
VARCHAR_CMP_GREATER_THAN_SPACES
;

2242 *
	g±r
 = 
VARCHAR_CMP_EQUAL_TO_SPACES
;

2245 
	g’coded_size
 +ğ
åi
->
m_£gm’t_size
;

2247 ià(*(
	g±r
++è=ğ
VARCHAR_CMP_EQUAL_TO_SPACES
)

2254 ià(
	guÅack_šfo
 && !
	gåi
->
	gm_uÅack_šfo_¡Ües_v®ue
) {

2258 
DBUG_ASSERT
(
·ddšg_by‹s
 % 
åi
->
¥aû_xäm_Ën
 == 0);

2259 
DBUG_ASSERT
((
v®ue_Ëngth
 - 
Œimmed_Ën
è% 
åi
->
¥aû_mb_Ën
 == 0);

2260 cÚ¡ 
size_t
 
	g»moved_ch¬s
 =

2261 
RDB_TRIMMED_CHARS_OFFSET
 +

2262 (
v®ue_Ëngth
 - 
Œimmed_Ën
è/ 
åi
->
¥aû_mb_Ën
 -

2263 
·ddšg_by‹s
 / 
åi
->
¥aû_xäm_Ën
;

2265 ià(
	gåi
->
	gm_uÅack_šfo_u£s_two_by‹s
) {

2266 
	guÅack_šfo
->
wr™e_ušt16
(
»moved_ch¬s
);

2268 
DBUG_ASSERT
(
»moved_ch¬s
 < 0x100);

2269 
	guÅack_šfo
->
wr™e_ušt8
(
»moved_ch¬s
);

2273 *
	gd¡
 +ğ
’coded_size
;

2281 
ušt
 
	gRdb_key_def
::
ÿlc_uÅack_Ëgacy_v¬ŸbË_fÜm©
(
uch¬
 
æag
,

2282 
boŞ
 *
dÚe
) const {

2283 
ušt
 
	g·d
 = 255 - 
æag
;

2284 
ušt
 
	gu£d_by‹s
 = 
RDB_LEGACY_ESCAPE_LENGTH
 - 1 - 
·d
;

2285 ià(
	gu£d_by‹s
 > 
	gRDB_LEGACY_ESCAPE_LENGTH
 - 1) {

2286  (
	gušt
)-1;

2289 *
	gdÚe
 = 
u£d_by‹s
 < 
RDB_LEGACY_ESCAPE_LENGTH
 - 1;

2290  
	gu£d_by‹s
;

2298 
ušt
 
	gRdb_key_def
::
ÿlc_uÅack_v¬ŸbË_fÜm©
(
uch¬
 
æag
, 
boŞ
 *
dÚe
) const {

2300 ià(
	gæag
 > 
	gRDB_ESCAPE_LENGTH
) {

2301  (
	gušt
)-1;

2306 ià(
	gæag
 < 
	gRDB_ESCAPE_LENGTH
) {

2307 *
	gdÚe
 = 
Œue
;

2308  
	gæag
;

2312 *
	gdÚe
 = 
çl£
;

2313  
	gRDB_ESCAPE_LENGTH
 - 1;

2322 
uÅack_ch¬£t
(cÚ¡ 
CHARSET_INFO
 *
c£t
,

2323 cÚ¡ 
uch¬
 *
¤c
,

2324 
ušt
 
¤c_Ën
,

2325 
uch¬
 *
d¡
,

2326 
ušt
 
d¡_Ën
,

2327 
ušt
 *
u£d_by‹s
)

2329 ià(
	g¤c_Ën
 & 1) {

2334  
	gUNPACK_FAILURE
;

2337 
uch¬
 *
	gd¡_’d
 = 
d¡
 + 
d¡_Ën
;

2338 
ušt
 
	gu£d
 = 0;

2340 
ušt
 
	gii
 = 0; i˜< 
	g¤c_Ën
; ii += 2) {

2341 
my_wc_t
 
wc
 = (
¤c
[
ii
] << 8) | src[ii + 1];

2342 
	g»s
 = 
c£t
->c£t->
wc_mb
(c£t, 
wc
, 
d¡
 + 
u£d
, 
d¡_’d
);

2343 
DBUG_ASSERT
(
»s
 > 0 &&„es <= 3);

2344 ià(
	g»s
 < 0) {

2345  
	gUNPACK_FAILURE
;

2348 
	gu£d
 +ğ
»s
;

2351 *
	gu£d_by‹s
 = 
u£d
;

2352  
	gUNPACK_SUCCESS
;

2359 
	gRdb_key_def
::
uÅack_bš¬y_Ü_utf8_v¬ch¬
(

2360 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
d¡
,

2361 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

2362 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

2363 cÚ¡ 
uch¬
 *
	g±r
;

2364 
size_t
 
	gËn
 = 0;

2365 
boŞ
 
	gfšished
 = 
çl£
;

2366 
uch¬
 *
	gd0
 = 
d¡
;

2367 
F›ld_v¬¡ršg
 *cÚ¡ 
	gf›ld_v¬
 = (F›ld_v¬¡ršg *)
f›ld
;

2368 
	gd¡
 +ğ
f›ld_v¬
->
Ëngth_by‹s
;

2370 
size_t
 
	gd¡_Ën
 = 
f›ld_v¬
->
·ck_Ëngth
(è- f›ld_v¬->
Ëngth_by‹s
;

2372 
boŞ
 
	gu£_Ëgacy_fÜm©
 = 
u£_Ëgacy_v¬bš¬y_fÜm©
();

2375 (
	g±r
 = (cÚ¡ 
uch¬
 *)
»ad”
->
»ad
(
RDB_ESCAPE_LENGTH
))) {

2376 
ušt
 
u£d_by‹s
;

2379 ià(
	gu£_Ëgacy_fÜm©
) {

2380 
	gu£d_by‹s
 = 
ÿlc_uÅack_Ëgacy_v¬ŸbË_fÜm©
(

2381 
±r
[
RDB_ESCAPE_LENGTH
 - 1], &
fšished
);

2383 
	gu£d_by‹s
 =

2384 
ÿlc_uÅack_v¬ŸbË_fÜm©
(
±r
[
RDB_ESCAPE_LENGTH
 - 1], &
fšished
);

2387 ià(
	gu£d_by‹s
 =ğ(
ušt
)-1 || 
d¡_Ën
 < 
u£d_by‹s
) {

2388  
UNPACK_FAILURE
;

2394 ià(
	gåi
->
	gm_v¬ch¬_ch¬£t
 =ğ&
my_ch¬£t_utf8_bš
) {

2395 
”r
 = 
uÅack_ch¬£t
(
åi
->
m_v¬ch¬_ch¬£t
, 
±r
, 
u£d_by‹s
, 
d¡
,

2396 
d¡_Ën
, &
u£d_by‹s
);

2397 ià(
	g”r
 !ğ
UNPACK_SUCCESS
) {

2398  
”r
;

2401 
memıy
(
d¡
, 
±r
, 
u£d_by‹s
);

2404 
	gd¡
 +ğ
u£d_by‹s
;

2405 
	gd¡_Ën
 -ğ
u£d_by‹s
;

2406 
	gËn
 +ğ
u£d_by‹s
;

2408 ià(
	gfšished
) {

2413 ià(!
	gfšished
) {

2414  
	gUNPACK_FAILURE
;

2418 ià(
	gf›ld_v¬
->
	gËngth_by‹s
 == 1) {

2419 
d0
[0] = 
Ën
;

2421 
DBUG_ASSERT
(
f›ld_v¬
->
Ëngth_by‹s
 == 2);

2422 
št2¡Üe
(
d0
, 
Ën
);

2424  
	gUNPACK_SUCCESS
;

2434 
	gRdb_key_def
::
uÅack_bš¬y_Ü_utf8_v¬ch¬_¥aû_·d
(

2435 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
d¡
,

2436 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

2437 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const {

2438 cÚ¡ 
uch¬
 *
	g±r
;

2439 
size_t
 
	gËn
 = 0;

2440 
boŞ
 
	gfšished
 = 
çl£
;

2441 
F›ld_v¬¡ršg
 *cÚ¡ 
	gf›ld_v¬
 = 
¡©ic_ÿ¡
<F›ld_v¬¡ršg *>(
f›ld
);

2442 
uch¬
 *
	gd0
 = 
d¡
;

2443 
uch¬
 *
	gd¡_’d
 = 
d¡
 + 
f›ld_v¬
->
·ck_Ëngth
();

2444 
	gd¡
 +ğ
f›ld_v¬
->
Ëngth_by‹s
;

2446 
ušt
 
	g¥aû_·ddšg_by‹s
 = 0;

2447 
ušt
 
	gexŒa_¥aûs
;

2448 ià((
	gåi
->
	gm_uÅack_šfo_u£s_two_by‹s


2449 ? 
	guÅ_»ad”
->
»ad_ušt16
(&
exŒa_¥aûs
)

2450 : 
uÅ_»ad”
->
»ad_ušt8
(&
exŒa_¥aûs
))) {

2451  
UNPACK_FAILURE
;

2454 ià(
	gexŒa_¥aûs
 <ğ
RDB_TRIMMED_CHARS_OFFSET
) {

2455 
¥aû_·ddšg_by‹s
 =

2456 -(
¡©ic_ÿ¡
<>(
exŒa_¥aûs
è- 
RDB_TRIMMED_CHARS_OFFSET
);

2457 
	gexŒa_¥aûs
 = 0;

2459 
	gexŒa_¥aûs
 -ğ
RDB_TRIMMED_CHARS_OFFSET
;

2461 
	g¥aû_·ddšg_by‹s
 *ğ
åi
->
¥aû_xäm_Ën
;

2464 (
	g±r
 = (cÚ¡ 
uch¬
 *)
»ad”
->
»ad
(
åi
->
m_£gm’t_size
))) {

2465 cÚ¡ 
Ï¡_by‹
 = 
±r
[
åi
->
m_£gm’t_size
 - 1];

2466 
size_t
 
	gu£d_by‹s
;

2467 ià(
	gÏ¡_by‹
 =ğ
VARCHAR_CMP_EQUAL_TO_SPACES
)

2469 ià(
¥aû_·ddšg_by‹s
 > (
åi
->
m_£gm’t_size
 - 1))

2470  
UNPACK_FAILURE
;

2471 
	gu£d_by‹s
 = (
åi
->
m_£gm’t_size
 - 1è- 
¥aû_·ddšg_by‹s
;

2472 
	gfšished
 = 
Œue
;

2474 ià(
	gÏ¡_by‹
 !ğ
VARCHAR_CMP_LESS_THAN_SPACES
 &&

2475 
Ï¡_by‹
 !ğ
VARCHAR_CMP_GREATER_THAN_SPACES
) {

2476  
UNPACK_FAILURE
;

2478 
	gu£d_by‹s
 = 
åi
->
m_£gm’t_size
 - 1;

2482 ià(
	gåi
->
	gm_v¬ch¬_ch¬£t
 =ğ&
my_ch¬£t_utf8_bš
) {

2483 ià(
u£d_by‹s
 & 1) {

2488  
UNPACK_FAILURE
;

2491 cÚ¡ 
uch¬
 *
	g¤c
 = 
±r
;

2492 cÚ¡ 
uch¬
 *cÚ¡ 
	g¤c_’d
 = 
±r
 + 
u£d_by‹s
;

2493 
	g¤c
 < 
	g¤c_’d
) {

2494 
my_wc_t
 
	gwc
 = (
¤c
[0] << 8) | src[1];

2495 
	g¤c
 += 2;

2496 cÚ¡ 
CHARSET_INFO
 *
	gc£t
 = 
åi
->
m_v¬ch¬_ch¬£t
;

2497 
	g»s
 = 
c£t
->c£t->
wc_mb
(c£t, 
wc
, 
d¡
, 
d¡_’d
);

2498 
DBUG_ASSERT
(
»s
 <= 3);

2499 ià(
	g»s
 <= 0)

2500  
UNPACK_FAILURE
;

2501 
	gd¡
 +ğ
»s
;

2502 
	gËn
 +ğ
»s
;

2505 ià(
	gd¡
 + 
	gu£d_by‹s
 > 
	gd¡_’d
)

2506  
	gUNPACK_FAILURE
;

2507 
memıy
(
d¡
, 
±r
, 
u£d_by‹s
);

2508 
	gd¡
 +ğ
u£d_by‹s
;

2509 
	gËn
 +ğ
u£d_by‹s
;

2512 ià(
	gfšished
) {

2513 ià(
	gexŒa_¥aûs
) {

2516 ià(
	gd¡
 + 
	gexŒa_¥aûs
 > 
	gd¡_’d
)

2517  
	gUNPACK_FAILURE
;

2518 
mem£t
(
d¡
, 
åi
->
m_v¬ch¬_ch¬£t
->
·d_ch¬
, 
exŒa_¥aûs
);

2519 
	gËn
 +ğ
exŒa_¥aûs
;

2525 ià(!
	gfšished
)

2526  
	gUNPACK_FAILURE
;

2529 ià(
	gf›ld_v¬
->
	gËngth_by‹s
 == 1) {

2530 
d0
[0] = 
Ën
;

2532 
DBUG_ASSERT
(
f›ld_v¬
->
Ëngth_by‹s
 == 2);

2533 
št2¡Üe
(
d0
, 
Ën
);

2535  
	gUNPACK_SUCCESS
;

2544 
	gRdb_key_def
::
make_uÅack_unknown
(

2545 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *
codec
 
MY_ATTRIBUTE
((
__unu£d__
)),

2546 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
, 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const {

2547 
	g·ck_ùx
->
	gwr™”
->
wr™e
(
f›ld
->
±r
, f›ld->
·ck_Ëngth
());

2558 
	gRdb_key_def
::
dummy_make_uÅack_šfo
(

2559 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *
codec
 
MY_ATTRIBUTE
((
__unu£d__
)),

2560 cÚ¡ 
F›ld
 *
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

2561 
Rdb_·ck_f›ld_cÚ‹xt
 *
·ck_ùx
 
MY_ATTRIBUTE
((
__unu£d__
))) const {

2569 
	gRdb_key_def
::
uÅack_unknown
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

2570 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *cÚ¡ 
d¡
,

2571 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

2572 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const {

2573 cÚ¡ 
uch¬
 *
	g±r
;

2574 cÚ¡ 
ušt
 
	gËn
 = 
åi
->
m_uÅack_d©a_Ën
;

2576 ià(
sk_max_Ëngth
(
åi
, 
f›ld
, 
»ad”
)) {

2577  
	gUNPACK_FAILURE
;

2580 
DBUG_ASSERT_IMP
(
Ën
 > 0, 
uÅ_»ad”
 !ğ
nuÎ±r
);

2582 ià((
	g±r
 = (cÚ¡ 
uch¬
 *)
uÅ_»ad”
->
»ad
(
Ën
))) {

2583 
memıy
(
d¡
, 
±r
, 
Ën
);

2584  
	gUNPACK_SUCCESS
;

2586  
	gUNPACK_FAILURE
;

2593 
	gRdb_key_def
::
make_uÅack_unknown_v¬ch¬
(

2594 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *cÚ¡ 
codec
 
MY_ATTRIBUTE
((
__unu£d__
)),

2595 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
, 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const {

2596 cÚ¡‡utØ
	gf
 = 
¡©ic_ÿ¡
<cÚ¡ 
F›ld_v¬¡ršg
 *>(
f›ld
);

2597 
ušt
 
	gËn
 = 
f
->
Ëngth_by‹s
 =ğ1 ? (ušt)*f->
±r
 : 
ušt2kÜr
(f->ptr);

2598 
	gËn
 +ğ
f
->
Ëngth_by‹s
;

2599 
	g·ck_ùx
->
	gwr™”
->
wr™e
(
f›ld
->
±r
, 
Ën
);

2616 
	gRdb_key_def
::
uÅack_unknown_v¬ch¬
(

2617 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
d¡
,

2618 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

2619 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const {

2620 cÚ¡ 
uch¬
 *
	g±r
;

2621 
uch¬
 *cÚ¡ 
	gd0
 = 
d¡
;

2622 cÚ¡‡utØ
	gf
 = 
¡©ic_ÿ¡
<
F›ld_v¬¡ršg
 *>(
f›ld
);

2623 
	gd¡
 +ğ
f
->
Ëngth_by‹s
;

2624 cÚ¡ 
ušt
 
	gËn_by‹s
 = 
f
->
Ëngth_by‹s
;

2626 ià((
	gthis
->*
	gåi
->
	gm_sk_func
)(åi, 
	gf›ld
, 
	g»ad”
)) {

2627  
	gUNPACK_FAILURE
;

2630 
DBUG_ASSERT
(
Ën_by‹s
 > 0);

2631 
DBUG_ASSERT
(
uÅ_»ad”
 !ğ
nuÎ±r
);

2633 ià((
	g±r
 = (cÚ¡ 
uch¬
 *)
uÅ_»ad”
->
»ad
(
Ën_by‹s
))) {

2634 
memıy
(
d0
, 
±r
, 
Ën_by‹s
);

2635 cÚ¡ 
ušt
 
	gËn
 = 
Ën_by‹s
 =ğ1 ? (ušt)*
±r
 : 
ušt2kÜr
(ptr);

2636 ià((
	g±r
 = (cÚ¡ 
uch¬
 *)
uÅ_»ad”
->
»ad
(
Ën
))) {

2637 
memıy
(
d¡
, 
±r
, 
Ën
);

2638  
	gUNPACK_SUCCESS
;

2641  
	gUNPACK_FAILURE
;

2647 
rdb_wr™e_uÅack_sim¶e
(
Rdb_b™_wr™”
 *cÚ¡ 
wr™”
,

2648 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *cÚ¡ 
codec
,

2649 cÚ¡ 
uch¬
 *cÚ¡ 
¤c
,

2650 cÚ¡ 
size_t
 
¤c_Ën
) {

2651 
ušt
 
	gi
 = 0; i < 
	g¤c_Ën
; i++) {

2652 
	gwr™”
->
wr™e
(
codec
->
m_’c_size
[
¤c
[
i
]], codec->
m_’c_idx
[src[i]]);

2656 
ušt
 
rdb_»ad_uÅack_sim¶e
(
Rdb_b™_»ad”
 *cÚ¡ 
»ad”
,

2657 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *cÚ¡ 
codec
,

2658 cÚ¡ 
uch¬
 *cÚ¡ 
¤c
,

2659 cÚ¡ 
size_t
 &
¤c_Ën
, 
uch¬
 *cÚ¡ 
d¡
) {

2660 
ušt
 
	gi
 = 0; i < 
	g¤c_Ën
; i++) {

2661 ià(
	gcodec
->
	gm_dec_size
[
¤c
[
i
]] > 0) {

2662 
ušt
 *
	g»t
;

2663 
DBUG_ASSERT
(
»ad”
 !ğ
nuÎ±r
);

2665 ià((
	g»t
 = 
»ad”
->
»ad
(
codec
->
m_dec_size
[
¤c
[
i
]])è=ğ
nuÎ±r
) {

2666  
UNPACK_FAILURE
;

2668 
	gd¡
[
i
] = 
codec
->
m_dec_idx
[*
»t
][
¤c
[i]];

2670 
	gd¡
[
i
] = 
codec
->
m_dec_idx
[0][
¤c
[i]];

2674  
	gUNPACK_SUCCESS
;

2684 
	gRdb_key_def
::
make_uÅack_sim¶e_v¬ch¬
(

2685 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *cÚ¡ 
codec
, cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
,

2686 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const {

2687 cÚ¡‡utØ
	gf
 = 
¡©ic_ÿ¡
<cÚ¡ 
F›ld_v¬¡ršg
 *>(
f›ld
);

2688 
uch¬
 *cÚ¡ 
	g¤c
 = 
f
->
±r
 + f->
Ëngth_by‹s
;

2689 cÚ¡ 
size_t
 
	g¤c_Ën
 =

2690 
f
->
Ëngth_by‹s
 =ğ1 ? (
ušt
)*f->
±r
 : 
ušt2kÜr
(f->ptr);

2691 
Rdb_b™_wr™”
 
b™_wr™”
(
·ck_ùx
->
wr™”
);

2694 
rdb_wr™e_uÅack_sim¶e
(&
b™_wr™”
, 
codec
, 
¤c
,

2695 
¡d
::
mš
((
size_t
)
f
->
ch¬_Ëngth
(), 
¤c_Ën
));

2706 
	gRdb_key_def
::
uÅack_sim¶e_v¬ch¬_¥aû_·d
(

2707 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
d¡
,

2708 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

2709 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const {

2710 cÚ¡ 
uch¬
 *
	g±r
;

2711 
size_t
 
	gËn
 = 0;

2712 
boŞ
 
	gfšished
 = 
çl£
;

2713 
uch¬
 *
	gd0
 = 
d¡
;

2714 cÚ¡ 
F›ld_v¬¡ršg
 *cÚ¡ 
	gf›ld_v¬
 =

2715 
¡©ic_ÿ¡
<
F›ld_v¬¡ršg
 *>(
f›ld
);

2717 
DBUG_ASSERT
((
size_t
)
åi
->
m_max_image_Ën
 >ğ
f›ld_v¬
->
ch¬_Ëngth
());

2718 
uch¬
 *
	gd¡_’d
 = 
d¡
 + 
f›ld_v¬
->
·ck_Ëngth
();

2719 
	gd¡
 +ğ
f›ld_v¬
->
Ëngth_by‹s
;

2720 
Rdb_b™_»ad”
 
b™_»ad”
(
uÅ_»ad”
);

2722 
ušt
 
	g¥aû_·ddšg_by‹s
 = 0;

2723 
ušt
 
	gexŒa_¥aûs
;

2724 
DBUG_ASSERT
(
uÅ_»ad”
 !ğ
nuÎ±r
);

2726 ià((
	gåi
->
	gm_uÅack_šfo_u£s_two_by‹s


2727 ? 
	guÅ_»ad”
->
»ad_ušt16
(&
exŒa_¥aûs
)

2728 : 
uÅ_»ad”
->
»ad_ušt8
(&
exŒa_¥aûs
))) {

2729  
UNPACK_FAILURE
;

2732 ià(
	gexŒa_¥aûs
 <= 8) {

2733 
¥aû_·ddšg_by‹s
 = -(
¡©ic_ÿ¡
<>(
exŒa_¥aûs
) - 8);

2734 
	gexŒa_¥aûs
 = 0;

2736 
	gexŒa_¥aûs
 -= 8;

2738 
	g¥aû_·ddšg_by‹s
 *ğ
åi
->
¥aû_xäm_Ën
;

2741 (
	g±r
 = (cÚ¡ 
uch¬
 *)
»ad”
->
»ad
(
åi
->
m_£gm’t_size
))) {

2742 cÚ¡ 
Ï¡_by‹
 =

2743 
±r
[
åi
->
m_£gm’t_size
 - 1];

2744 
size_t
 
	gu£d_by‹s
;

2745 ià(
	gÏ¡_by‹
 =ğ
VARCHAR_CMP_EQUAL_TO_SPACES
) {

2747 ià(
¥aû_·ddšg_by‹s
 > (
åi
->
m_£gm’t_size
 - 1))

2748  
UNPACK_FAILURE
;

2749 
	gu£d_by‹s
 = (
åi
->
m_£gm’t_size
 - 1è- 
¥aû_·ddšg_by‹s
;

2750 
	gfšished
 = 
Œue
;

2752 ià(
	gÏ¡_by‹
 !ğ
VARCHAR_CMP_LESS_THAN_SPACES
 &&

2753 
Ï¡_by‹
 !ğ
VARCHAR_CMP_GREATER_THAN_SPACES
) {

2754  
UNPACK_FAILURE
;

2756 
	gu£d_by‹s
 = 
åi
->
m_£gm’t_size
 - 1;

2759 ià(
	gd¡
 + 
	gu£d_by‹s
 > 
	gd¡_’d
) {

2761  
	gUNPACK_FAILURE
;

2764 
ušt
 
	g»t
;

2765 ià((
	g»t
 = 
rdb_»ad_uÅack_sim¶e
(&
b™_»ad”
, 
åi
->
m_ch¬£t_codec
, 
±r
,

2766 
u£d_by‹s
, 
d¡
)è!ğ
UNPACK_SUCCESS
) {

2767  
»t
;

2770 
	gd¡
 +ğ
u£d_by‹s
;

2771 
	gËn
 +ğ
u£d_by‹s
;

2773 ià(
	gfšished
) {

2774 ià(
	gexŒa_¥aûs
) {

2775 ià(
	gd¡
 + 
	gexŒa_¥aûs
 > 
	gd¡_’d
)

2776  
	gUNPACK_FAILURE
;

2779 
mem£t
(
d¡
, 
f›ld_v¬
->
ch¬£t
()->
·d_ch¬
, 
exŒa_¥aûs
);

2780 
	gËn
 +ğ
exŒa_¥aûs
;

2786 ià(!
	gfšished
)

2787  
	gUNPACK_FAILURE
;

2790 ià(
	gf›ld_v¬
->
	gËngth_by‹s
 == 1) {

2791 
d0
[0] = 
Ën
;

2793 
DBUG_ASSERT
(
f›ld_v¬
->
Ëngth_by‹s
 == 2);

2794 
št2¡Üe
(
d0
, 
Ën
);

2796  
	gUNPACK_SUCCESS
;

2810 
	gRdb_key_def
::
make_uÅack_sim¶e
(

2811 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *cÚ¡ 
codec
, cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
,

2812 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const {

2813 cÚ¡ 
uch¬
 *cÚ¡ 
	g¤c
 = 
f›ld
->
±r
;

2814 
Rdb_b™_wr™”
 
b™_wr™”
(
·ck_ùx
->
wr™”
);

2815 
rdb_wr™e_uÅack_sim¶e
(&
b™_wr™”
, 
codec
, 
¤c
, 
f›ld
->
·ck_Ëngth
());

2822 
	gRdb_key_def
::
uÅack_sim¶e
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

2823 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

2824 
uch¬
 *cÚ¡ 
d¡
,

2825 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

2826 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const {

2827 cÚ¡ 
uch¬
 *
	g±r
;

2828 cÚ¡ 
ušt
 
	gËn
 = 
åi
->
m_max_image_Ën
;

2829 
Rdb_b™_»ad”
 
b™_»ad”
(
uÅ_»ad”
);

2831 ià(!(
	g±r
 = (cÚ¡ 
uch¬
 *)
»ad”
->
»ad
(
Ën
))) {

2832  
UNPACK_FAILURE
;

2835  
rdb_»ad_uÅack_sim¶e
(
uÅ_»ad”
 ? &
b™_»ad”
 : 
nuÎ±r
,

2836 
åi
->
m_ch¬£t_codec
, 
±r
, 
Ën
, 
d¡
);

2840 cÚ¡ 
	gRDB_SPACE_XFRM_SIZE
 = 32;

2844 şas 
	cRdb_ch¬£t_¥aû_šfo
 {

2845 
	gpublic
:

2846 
Rdb_ch¬£t_¥aû_šfo
(cÚ¡ Rdb_ch¬£t_¥aû_šfØ&èğ
d–‘e
;

2847 
	gRdb_ch¬£t_¥aû_šfo
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_ch¬£t_¥aû_šfo
 &èğ
d–‘e
;

2848 
Rdb_ch¬£t_¥aû_šfo
() = ;

2851 
	g¡d
::
veùÜ
<
uch¬
> 
¥aûs_xäm
;

2854 
size_t
 
	g¥aû_xäm_Ën
;

2859 
size_t
 
	g¥aû_mb_Ën
;

2862 
	g¡d
::
¬¿y
<
¡d
::
unique_±r
<
Rdb_ch¬£t_¥aû_šfo
>, 
	gMY_ALL_CHARSETS_SIZE
>

2863 
	grdb_mem_com·¿bË_¥aû
;

2884 
rdb_g‘_mem_com·¿bË_¥aû
(cÚ¡ 
CHARSET_INFO
 *cÚ¡ 
cs
,

2885 cÚ¡ 
¡d
::
veùÜ
<
uch¬
> **
xäm
,

2886 
size_t
 *cÚ¡ 
xäm_Ën
,

2887 
size_t
 *cÚ¡ 
mb_Ën
) {

2888 
DBUG_ASSERT
(
cs
->
numb”
 < 
MY_ALL_CHARSETS_SIZE
);

2889 ià(!
	grdb_mem_com·¿bË_¥aû
[
cs
->
numb”
].
g‘
()) {

2890 
RDB_MUTEX_LOCK_CHECK
(
rdb_mem_cmp_¥aû_mu‹x
);

2891 ià(!
	grdb_mem_com·¿bË_¥aû
[
cs
->
numb”
].
g‘
()) {

2894 cÚ¡ 
	gMAX_MULTI_BYTE_CHAR_SIZE
 = 4;

2895 
DBUG_ASSERT
(
cs
->
mbmaxËn
 <ğ
MAX_MULTI_BYTE_CHAR_SIZE
);

2898 
uch¬
 
	g¥aû_mb
[
MAX_MULTI_BYTE_CHAR_SIZE
];

2900 cÚ¡ 
size_t
 
	g¥aû_mb_Ën
 = 
cs
->
c£t
->
wc_mb
(

2901 
cs
, (
my_wc_t
)cs->
·d_ch¬
, 
¥aû_mb
, space_mb + (space_mb));

2903 
uch¬
 
	g¥aû
[20];

2905 cÚ¡ 
size_t
 
	g¥aû_Ën
 = 
cs
->
cŞl
->
¡ºxäm
(cs, 
¥aû
, (space), 1,

2906 
¥aû_mb
, 
¥aû_mb_Ën
, 0);

2907 
Rdb_ch¬£t_¥aû_šfo
 *cÚ¡ 
	gšfo
 = 
Ãw
 Rdb_charset_space_info;

2908 
	gšfo
->
	g¥aû_xäm_Ën
 = 
¥aû_Ën
;

2909 
	gšfo
->
	g¥aû_mb_Ën
 = 
¥aû_mb_Ën
;

2910 
	gšfo
->
	g¥aûs_xäm
.
size
(è< 
	gRDB_SPACE_XFRM_SIZE
) {

2911 
	gšfo
->
	g¥aûs_xäm
.
š£¹
(
šfo
->
¥aûs_xäm
.
’d
(), 
¥aû
,

2912 
¥aû
 + 
¥aû_Ën
);

2914 
	grdb_mem_com·¿bË_¥aû
[
cs
->
numb”
].
»£t
(
šfo
);

2916 
RDB_MUTEX_UNLOCK_CHECK
(
rdb_mem_cmp_¥aû_mu‹x
);

2919 *
	gxäm
 = &
rdb_mem_com·¿bË_¥aû
[
cs
->
numb”
]->
¥aûs_xäm
;

2920 *
	gxäm_Ën
 = 
rdb_mem_com·¿bË_¥aû
[
cs
->
numb”
]->
¥aû_xäm_Ën
;

2921 *
	gmb_Ën
 = 
rdb_mem_com·¿bË_¥aû
[
cs
->
numb”
]->
¥aû_mb_Ën
;

2924 
mysql_mu‹x_t
 
	grdb_mem_cmp_¥aû_mu‹x
;

2926 
	g¡d
::
¬¿y
<cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *, 
	gMY_ALL_CHARSETS_SIZE
>

2927 
	grdb_cŞÏtiÚ_d©a
;

2928 
mysql_mu‹x_t
 
	grdb_cŞÏtiÚ_d©a_mu‹x
;

2930 
boŞ
 
	$rdb_is_cŞÏtiÚ_suµÜ‹d
(cÚ¡ 
my_cÜe
::
CHARSET_INFO
 *cÚ¡ 
cs
) {

2931  (
cs
->
cŞl
 =ğ&
my_cŞÏtiÚ_8b™_sim¶e_ci_hªdËr
);

2932 
	}
}

2934 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *

2935 
	$rdb_š™_cŞÏtiÚ_m­pšg
(cÚ¡ 
my_cÜe
::
CHARSET_INFO
 *cÚ¡ 
cs
) {

2936 
	`DBUG_ASSERT
(
cs
 && cs->
¡©e
 & 
MY_CS_AVAILABLE
);

2937 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *
codec
 = 
rdb_cŞÏtiÚ_d©a
[
cs
->
numb”
];

2939 ià(
codec
 =ğ
nuÎ±r
 && 
	`rdb_is_cŞÏtiÚ_suµÜ‹d
(
cs
)) {

2940 
	`RDB_MUTEX_LOCK_CHECK
(
rdb_cŞÏtiÚ_d©a_mu‹x
);

2942 
codec
 = 
rdb_cŞÏtiÚ_d©a
[
cs
->
numb”
];

2943 ià(
codec
 =ğ
nuÎ±r
) {

2944 
Rdb_cŞÏtiÚ_codec
 *
cur
 = 
nuÎ±r
;

2947 ià(
cs
->
cŞl
 =ğ&
my_cŞÏtiÚ_8b™_sim¶e_ci_hªdËr
) {

2948 
cur
 = 
Ãw
 
Rdb_cŞÏtiÚ_codec
;

2949 
¡d
::
m­
<
uch¬
, std::
veùÜ
<uch¬>> 
»v_m­
;

2950 
size_t
 
max_cÚæiù_size
 = 0;

2951 
¤c
 = 0; src < 256; src++) {

2952 
uch¬
 
d¡
 = 
cs
->
sÜt_Üd”
[
¤c
];

2953 
»v_m­
[
d¡
].
	`push_back
(
¤c
);

2954 
max_cÚæiù_size
 = 
¡d
::
	`max
(max_cÚæiù_size, 
»v_m­
[
d¡
].
	`size
());

2956 
cur
->
m_dec_idx
.
	`»size
(
max_cÚæiù_size
);

2958 autØcÚ¡ &
p
 : 
»v_m­
) {

2959 
uch¬
 
d¡
 = 
p
.
fœ¡
;

2960 
ušt
 
idx
 = 0; idx < 
p
.
£cÚd
.
	`size
(); idx++) {

2961 
uch¬
 
¤c
 = 
p
.
£cÚd
[
idx
];

2962 
uch¬
 
b™s
 =

2963 
	`my_b™_log2
(
	`my_round_up_to_Ãxt_pow”
(
p
.
£cÚd
.
	`size
()));

2964 
cur
->
m_’c_idx
[
¤c
] = 
idx
;

2965 
cur
->
m_’c_size
[
¤c
] = 
b™s
;

2966 
cur
->
m_dec_size
[
d¡
] = 
b™s
;

2967 
cur
->
m_dec_idx
[
idx
][
d¡
] = 
¤c
;

2971 
cur
->
m_make_uÅack_šfo_func
 = {

2972 &
Rdb_key_def
::
make_uÅack_sim¶e_v¬ch¬
,

2973 &
Rdb_key_def
::
make_uÅack_sim¶e
};

2974 
cur
->
m_uÅack_func
 = {&
Rdb_key_def
::
uÅack_sim¶e_v¬ch¬_¥aû_·d
,

2975 &
Rdb_key_def
::
uÅack_sim¶e
};

2980 ià(
cur
 !ğ
nuÎ±r
) {

2981 
codec
 = 
cur
;

2982 
cur
->
m_cs
 = 
cs
;

2983 
rdb_cŞÏtiÚ_d©a
[
cs
->
numb”
] = 
cur
;

2987 
	`RDB_MUTEX_UNLOCK_CHECK
(
rdb_cŞÏtiÚ_d©a_mu‹x
);

2990  
codec
;

2991 
	}
}

2993 
	$g‘_£gm’t_size_äom_cŞÏtiÚ
(cÚ¡ 
CHARSET_INFO
 *cÚ¡ 
cs
) {

2994 
»t
;

2995 ià(
cs
 =ğ&
my_ch¬£t_utf8mb4_bš
 || c =ğ&
my_ch¬£t_utf16_bš
 ||

2996 
cs
 =ğ&
my_ch¬£t_utf16Ë_bš
 || c =ğ&
my_ch¬£t_utf32_bš
) {

3002 
»t
 = 10;

3017 
»t
 = 9;

3019 
	`DBUG_ASSERT
(
»t
 < 
RDB_SPACE_XFRM_SIZE
);

3020  
»t
;

3021 
	}
}

3043 
boŞ
 
	gRdb_f›ld_·ckšg
::
	$£tup
(cÚ¡ 
Rdb_key_def
 *cÚ¡ 
key_desü
,

3044 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
, cÚ¡ 
ušt
 &
keyÄ_¬g
,

3045 cÚ¡ 
ušt
 &
key_·¹_¬g
,

3046 cÚ¡ 
ušt16
 &
key_Ëngth
) {

3047 
»s
 = 
çl£
;

3048 
’um_f›ld_ty³s
 
ty³
 = 
f›ld
 ? f›ld->
	`»®_ty³
(è: 
MYSQL_TYPE_LONGLONG
;

3050 
m_keyÄ
 = 
keyÄ_¬g
;

3051 
m_key_·¹
 = 
key_·¹_¬g
;

3053 
m_maybe_nuÎ
 = 
f›ld
 ? f›ld->
	`»®_maybe_nuÎ
(è: 
çl£
;

3054 
m_uÅack_func
 = 
nuÎ±r
;

3055 
m_make_uÅack_šfo_func
 = 
nuÎ±r
;

3056 
m_uÅack_d©a_Ën
 = 0;

3057 
¥aû_xäm
 = 
nuÎ±r
;

3060 
m_max_image_Ën
 =

3061 
f›ld
 ? f›ld->
	`·ck_Ëngth
(è: 
ROCKSDB_SIZEOF_HIDDEN_PK_COLUMN
;

3062 
m_sk_func
 = &
Rdb_key_def
::
sk_max_Ëngth
;

3063 
m_·ck_func
 = &
Rdb_key_def
::
·ck_w™h_make_sÜt_key
;

3065 
m_cov”ed
 = 
çl£
;

3067 
ty³
) {

3068 
MYSQL_TYPE_LONGLONG
:

3069 
MYSQL_TYPE_LONG
:

3070 
MYSQL_TYPE_INT24
:

3071 
MYSQL_TYPE_SHORT
:

3072 
MYSQL_TYPE_TINY
:

3073 
m_uÅack_func
 = &
Rdb_key_def
::
uÅack_š‹g”
;

3074 
m_cov”ed
 = 
Œue
;

3075  
Œue
;

3077 
MYSQL_TYPE_DOUBLE
:

3078 
m_uÅack_func
 = &
Rdb_key_def
::
uÅack_doubË
;

3079 
m_cov”ed
 = 
Œue
;

3080  
Œue
;

3082 
MYSQL_TYPE_FLOAT
:

3083 
m_uÅack_func
 = &
Rdb_key_def
::
uÅack_æßt
;

3084 
m_cov”ed
 = 
Œue
;

3085  
Œue
;

3087 
MYSQL_TYPE_NEWDECIMAL
:

3095 
MYSQL_TYPE_DATETIME2
:

3096 
MYSQL_TYPE_TIMESTAMP2
:

3098 
MYSQL_TYPE_TIME2
:

3099 
MYSQL_TYPE_YEAR
:

3101 
m_uÅack_func
 = &
Rdb_key_def
::
uÅack_bš¬y_¡r
;

3102 
m_cov”ed
 = 
Œue
;

3103  
Œue
;

3105 
MYSQL_TYPE_NEWDATE
:

3111 
m_uÅack_func
 = &
Rdb_key_def
::
uÅack_Ãwd©e
;

3112 
m_cov”ed
 = 
Œue
;

3113  
Œue
;

3114 
MYSQL_TYPE_TINY_BLOB
:

3115 
MYSQL_TYPE_MEDIUM_BLOB
:

3116 
MYSQL_TYPE_LONG_BLOB
:

3117 
MYSQL_TYPE_BLOB
: {

3118 ià(
key_desü
) {

3123 
m_max_image_Ën
 =

3124 
key_Ëngth
 + (
f›ld
->
	`ch¬£t
(è=ğ&
my_ch¬£t_bš


3125 ? 
»š‹½»t_ÿ¡
<cÚ¡ 
F›ld_blob
 *>(
f›ld
)

3126 ->
	`·ck_Ëngth_no_±r
()

3132  
çl£
;

3139 
m_uÅack_šfo_¡Ües_v®ue
 = 
çl£
;

3142 ià(
ty³
 =ğ
MYSQL_TYPE_VARCHAR
 ||y³ =ğ
MYSQL_TYPE_STRING
) {

3147 cÚ¡ 
CHARSET_INFO
 *
cs
 = 
f›ld
->
	`ch¬£t
();

3148 
m_max_image_Ën
 = 
cs
->
cŞl
->
	`¡ºxämËn
(cs, 
f›ld
->
f›ld_Ëngth
);

3150 cÚ¡ 
boŞ
 
is_v¬ch¬
 = (
ty³
 =ğ
MYSQL_TYPE_VARCHAR
);

3151 cÚ¡ 
CHARSET_INFO
 *
cs
 = 
f›ld
->
	`ch¬£t
();

3153 cÚ¡ 
max_image_Ën_befÜe_chunks
 = 
m_max_image_Ën
;

3155 ià(
is_v¬ch¬
) {

3158 
m_v¬ch¬_ch¬£t
 = 
cs
;

3159 
m_sk_func
 = &
Rdb_key_def
::
sk_v¬ŸbË_Ëngth
;

3160 
m_·ck_func
 = &
Rdb_key_def
::
·ck_w™h_v¬ch¬_’codšg
;

3161 ià(!
key_desü
 || key_desü->
	`u£_Ëgacy_v¬bš¬y_fÜm©
()) {

3162 
m_max_image_Ën
 = 
	`RDB_LEGACY_ENCODED_SIZE
(m_max_image_len);

3166 
m_max_image_Ën
 = 
	`RDB_ENCODED_SIZE
(m_max_image_len);

3169 cÚ¡‡utØ
f›ld_v¬
 = 
¡©ic_ÿ¡
<cÚ¡ 
F›ld_v¬¡ršg
 *>(
f›ld
);

3170 
m_uÅack_šfo_u£s_two_by‹s
 = (
f›ld_v¬
->
f›ld_Ëngth
 + 8 >= 0x100);

3173 ià(
ty³
 =ğ
MYSQL_TYPE_VARCHAR
 ||y³ =ğ
MYSQL_TYPE_STRING
) {

3176 
boŞ
 
u£_unknown_cŞÏtiÚ
 = 
çl£
;

3177 
	`DBUG_EXECUTE_IF
("myrocks_enable_unknown_collation_index_only_scans",

3178 
u£_unknown_cŞÏtiÚ
 = 
Œue
;);

3180 ià(
cs
 =ğ&
my_ch¬£t_bš
) {

3185 
m_uÅack_func
 = 
is_v¬ch¬
 ? &
Rdb_key_def
::
uÅack_bš¬y_Ü_utf8_v¬ch¬


3186 : &
Rdb_key_def
::
uÅack_bš¬y_¡r
;

3187 
»s
 = 
Œue
;

3188 } ià(
cs
 =ğ&
my_ch¬£t_Ïtš1_bš
 || c =ğ&
my_ch¬£t_utf8_bš
) {

3192 ià(
is_v¬ch¬
) {

3196 
m_uÅack_func
 = &
Rdb_key_def
::
uÅack_bš¬y_Ü_utf8_v¬ch¬_¥aû_·d
;

3197 
m_sk_func
 = &
Rdb_key_def
::
sk_v¬ŸbË_¥aû_·d
;

3198 
m_·ck_func
 = &
Rdb_key_def
::
·ck_w™h_v¬ch¬_¥aû_·d
;

3199 
m_make_uÅack_šfo_func
 = &
Rdb_key_def
::
dummy_make_uÅack_šfo
;

3200 
m_£gm’t_size
 = 
	`g‘_£gm’t_size_äom_cŞÏtiÚ
(
cs
);

3201 
m_max_image_Ën
 =

3202 (
max_image_Ën_befÜe_chunks
 / (
m_£gm’t_size
 - 1) + 1) *

3203 
m_£gm’t_size
;

3204 
	`rdb_g‘_mem_com·¿bË_¥aû
(
cs
, &
¥aû_xäm
, &
¥aû_xäm_Ën
,

3205 &
¥aû_mb_Ën
);

3209 
m_uÅack_func
 = (
cs
 =ğ&
my_ch¬£t_Ïtš1_bš
)

3210 ? &
Rdb_key_def
::
uÅack_bš¬y_¡r


3211 : &
Rdb_key_def
::
uÅack_utf8_¡r
;

3213 
»s
 = 
Œue
;

3217 
»s
 = 
Œue
;

3218 
m_uÅack_d©a_Ën
 = 
is_v¬ch¬
 ? 0 : 
f›ld
->
f›ld_Ëngth
;

3219 cÚ¡ 
ušt
 
idx
 = 
is_v¬ch¬
 ? 0 : 1;

3220 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *
codec
 = 
nuÎ±r
;

3222 ià(
is_v¬ch¬
) {

3232 ià(
cs
->
Ëv–s_fÜ_Üd”
 == 1) {

3233 
m_·ck_func
 = &
Rdb_key_def
::
·ck_w™h_v¬ch¬_¥aû_·d
;

3234 
m_sk_func
 = &
Rdb_key_def
::
sk_v¬ŸbË_¥aû_·d
;

3235 
m_£gm’t_size
 = 
	`g‘_£gm’t_size_äom_cŞÏtiÚ
(
cs
);

3236 
m_max_image_Ën
 =

3237 (
max_image_Ën_befÜe_chunks
 / (
m_£gm’t_size
 - 1) + 1) *

3238 
m_£gm’t_size
;

3239 
	`rdb_g‘_mem_com·¿bË_¥aû
(
cs
, &
¥aû_xäm
, &
¥aû_xäm_Ën
,

3240 &
¥aû_mb_Ën
);

3243 
	`sql_´št_w¬nšg
("RocksDB: you'reryingo create‡n index "

3245 
cs
->
Çme
);

3247 
	`sql_´št_w¬nšg
("MyRocks will handlehis collation internally "

3249 
m_·ck_func
 = &
Rdb_key_def
::
·ck_w™h_v¬ch¬_’codšg
;

3250 
m_sk_func
 = &
Rdb_key_def
::
sk_v¬ŸbË_Ëngth
;

3254 ià((
codec
 = 
	`rdb_š™_cŞÏtiÚ_m­pšg
(
cs
)è!ğ
nuÎ±r
) {

3258 
m_make_uÅack_šfo_func
 = 
codec
->m_make_uÅack_šfo_func[
idx
];

3259 
m_uÅack_func
 = 
codec
->m_uÅack_func[
idx
];

3260 
m_ch¬£t_codec
 = 
codec
;

3261 } ià(
u£_unknown_cŞÏtiÚ
) {

3265 
m_uÅack_šfo_¡Ües_v®ue
 = 
Œue
;

3266 
m_make_uÅack_šfo_func
 =

3267 
is_v¬ch¬
 ? &
Rdb_key_def
::
make_uÅack_unknown_v¬ch¬


3268 : &
Rdb_key_def
::
make_uÅack_unknown
;

3269 
m_uÅack_func
 = 
is_v¬ch¬
 ? &
Rdb_key_def
::
uÅack_unknown_v¬ch¬


3270 : &
Rdb_key_def
::
uÅack_unknown
;

3275 
	`DBUG_ASSERT
(
m_uÅack_func
 =ğ
nuÎ±r
);

3276 
m_uÅack_šfo_¡Ües_v®ue
 = 
çl£
;

3277 
»s
 = 
çl£
;

3285 
ušt
 
f›ld_Ëngth
;

3286 ià(
f›ld
->
bË
) {

3287 
f›ld_Ëngth
 = 
f›ld
->
bË
->f›ld[f›ld->
f›ld_šdex
]->field_length;

3289 
f›ld_Ëngth
 = 
f›ld
->field_length;

3292 ià(
f›ld_Ëngth
 !ğ
key_Ëngth
) {

3293 
»s
 = 
çl£
;

3302 ià(!
key_desü
 || !key_desü->
	`u£_cov”ed_b™m­_fÜm©
()) {

3303 
m_uÅack_func
 = 
nuÎ±r
;

3304 
m_make_uÅack_šfo_func
 = 
nuÎ±r
;

3305 
m_uÅack_šfo_¡Ües_v®ue
 = 
Œue
;

3310 
m_cov”ed
 = 
»s
;

3311  
»s
;

3312 
	}
}

3314 
F›ld
 *
	gRdb_f›ld_·ckšg
::
	$g‘_f›ld_š_bË
(cÚ¡ 
TABLE
 *cÚ¡ 
tbl
) const {

3315  
tbl
->
key_šfo
[
m_keyÄ
].
key_·¹
[
m_key_·¹
].
f›ld
;

3316 
	}
}

3318 
	gRdb_f›ld_·ckšg
::
	$fl_hidd’_pk_v®
(
uch¬
 **
d¡
,

3319 cÚ¡ 
lÚglÚg
 &
hidd’_pk_id
) const {

3320 
	`DBUG_ASSERT
(
m_max_image_Ën
 == 8);

3322 
SŒšg
 
to
;

3323 
	`rdb_Ãt¡r_­³nd_ušt64
(&
to
, 
hidd’_pk_id
);

3324 
	`memıy
(*
d¡
, 
to
.
	`±r
(), 
m_max_image_Ën
);

3326 *
d¡
 +ğ
m_max_image_Ën
;

3327 
	}
}

3333 
	gRdb_tbl_def
::~
	$Rdb_tbl_def
() {

3334 autØ
ddl_mªag”
 = 
	`rdb_g‘_ddl_mªag”
();

3336 ià(
m_key_desü_¬r
) {

3337 
ušt
 
i
 = 0; i < 
m_key_couÁ
; i++) {

3338 ià(
ddl_mªag”
 && 
m_key_desü_¬r
[
i
]) {

3339 
ddl_mªag”
->
	`”a£_šdex_num
(
m_key_desü_¬r
[
i
]->
	`g‘_gl_šdex_id
());

3342 
m_key_desü_¬r
[
i
] = 
nuÎ±r
;

3345 
d–‘e
[] 
m_key_desü_¬r
;

3346 
m_key_desü_¬r
 = 
nuÎ±r
;

3348 
	}
}

3361 
boŞ
 
	gRdb_tbl_def
::
	$put_diù
(
Rdb_diù_mªag”
 *cÚ¡ 
diù
,

3362 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
, 
uch¬
 *cÚ¡ 
key
,

3363 cÚ¡ 
size_t
 &
keyËn
) {

3364 
SŒšgBufãr
<8 * 
Rdb_key_def
::
PACKED_SIZE
> 
šdexes
;

3365 
šdexes
.
	`®loc
(
Rdb_key_def
::
VERSION_SIZE
 +

3366 
m_key_couÁ
 * 
Rdb_key_def
::
PACKED_SIZE
 * 2);

3367 
	`rdb_Ãt¡r_­³nd_ušt16
(&
šdexes
, 
Rdb_key_def
::
DDL_ENTRY_INDEX_VERSION
);

3369 
ušt
 
i
 = 0; i < 
m_key_couÁ
; i++) {

3370 cÚ¡ 
Rdb_key_def
 &
kd
 = *
m_key_desü_¬r
[
i
];

3372 
uch¬
 
æags
 =

3373 (
kd
.
m_is_»v”£_cf
 ? 
Rdb_key_def
::
REVERSE_CF_FLAG
 : 0) |

3374 (
kd
.
m_is_³r_·¹™iÚ_cf
 ? 
Rdb_key_def
::
PER_PARTITION_CF_FLAG
 : 0);

3376 cÚ¡ 
ušt
 
cf_id
 = 
kd
.
	`g‘_cf
()->
	`G‘ID
();

3384 
ušt
 
exi¡šg_cf_æags
;

3385 cÚ¡ 
¡d
::
¡ršg
 
cf_Çme
 = 
kd
.
	`g‘_cf
()->
	`G‘Name
();

3387 ià(
diù
->
	`g‘_cf_æags
(
cf_id
, &
exi¡šg_cf_æags
)) {

3391 
exi¡šg_cf_æags
 &ğ~
Rdb_key_def
::
CF_FLAGS_TO_IGNORE
;

3392 
æags
 &ğ~
Rdb_key_def
::
CF_FLAGS_TO_IGNORE
;

3394 ià(
exi¡šg_cf_æags
 !ğ
æags
) {

3395 
	`my_”rÜ
(
ER_CF_DIFFERENT
, 
	`MYF
(0), 
cf_Çme
.
	`c_¡r
(), 
æags
,

3396 
exi¡šg_cf_æags
);

3397  
Œue
;

3400 
diù
->
	`add_cf_æags
(
b©ch
, 
cf_id
, 
æags
);

3403 
	`rdb_Ãt¡r_­³nd_ušt32
(&
šdexes
, 
cf_id
);

3404 
	`rdb_Ãt¡r_­³nd_ušt32
(&
šdexes
, 
kd
.
m_šdex_numb”
);

3406 
Rdb_šdex_šfo
 
šdex_šfo
;

3407 
šdex_šfo
.
m_gl_šdex_id
 = {
cf_id
, 
kd
.
m_šdex_numb”
};

3408 
šdex_šfo
.
m_šdex_diù_v”siÚ
 = 
Rdb_key_def
::
INDEX_INFO_VERSION_LATEST
;

3409 
šdex_šfo
.
m_šdex_ty³
 = 
kd
.m_index_type;

3410 
šdex_šfo
.
m_kv_v”siÚ
 = 
kd
.
m_kv_fÜm©_v”siÚ
;

3411 
šdex_šfo
.
m_šdex_æags
 = 
kd
.
m_šdex_æags_b™m­
;

3412 
šdex_šfo
.
m_‰l_du¿tiÚ
 = 
kd
.m_ttl_duration;

3414 
diù
->
	`add_Ü_upd©e_šdex_cf_m­pšg
(
b©ch
, &
šdex_šfo
);

3417 cÚ¡ 
rocksdb
::
Sliû
 
	`skey
((*)
key
, 
keyËn
);

3418 cÚ¡ 
rocksdb
::
Sliû
 
	`sv®ue
(
šdexes
.
	`c_±r
(), indexes.
	`Ëngth
());

3420 
diù
->
	`put_key
(
b©ch
, 
skey
, 
sv®ue
);

3421  
çl£
;

3422 
	}
}

3426 cÚ¡ 
	g¡d
::
¬¿y
<
ušt
, 1> 
	gšdex_æag_Ëngths
 = {

3427 {
ROCKSDB_SIZEOF_TTL_RECORD
}};

3429 
boŞ
 
	gRdb_key_def
::
	$has_šdex_æag
(
ušt32
 
šdex_æags
, 
INDEX_FLAG
 
æag
) {

3430  
æag
 & 
šdex_æags
;

3431 
	}
}

3433 
ušt32
 
	gRdb_key_def
::
	$ÿlcuÏ‹_šdex_æag_off£t
(
ušt32
 
šdex_æags
,

3434 
INDEX_FLAG
 
æag
,

3435 
ušt
 *cÚ¡ 
Ëngth
) {

3437 
	`DBUG_ASSERT_IMP
(
æag
 !ğ
MAX_FLAG
,

3438 
Rdb_key_def
::
	`has_šdex_æag
(
šdex_æags
, 
æag
));

3440 
ušt
 
off£t
 = 0;

3441 
size_t
 
b™
 = 0; b™ < (
šdex_æags
è* 
CHAR_BIT
; ++bit) {

3442 
mask
 = 1 << 
b™
;

3445 ià(
æag
 & 
mask
) {

3446 ià(
Ëngth
 !ğ
nuÎ±r
) {

3447 *
Ëngth
 = 
šdex_æag_Ëngths
[
b™
];

3452 ià(
šdex_æags
 & 
mask
) {

3453 
off£t
 +ğ
šdex_æag_Ëngths
[
b™
];

3457  
off£t
;

3458 
	}
}

3460 
	gRdb_key_def
::
	$wr™e_šdex_æag_f›ld
(
Rdb_¡ršg_wr™”
 *cÚ¡ 
buf
,

3461 cÚ¡ 
uch¬
 *cÚ¡ 
v®
,

3462 
INDEX_FLAG
 
æag
) const {

3463 
ušt
 
Ën
;

3464 
ušt
 
off£t
 = 
	`ÿlcuÏ‹_šdex_æag_off£t
(
m_šdex_æags_b™m­
, 
æag
, &
Ën
);

3465 
	`DBUG_ASSERT
(
off£t
 + 
Ën
 <ğ
buf
->
	`g‘_cu¼’t_pos
());

3466 
	`memıy
(
buf
->
	`±r
(è+ 
off£t
, 
v®
, 
Ën
);

3467 
	}
}

3469 
	gRdb_tbl_def
::
	$check_if_is_mysql_sy¡em_bË
() {

3470 cÚ¡ *cÚ¡ 
sy¡em_dbs
[] = {

3474 
m_is_mysql_sy¡em_bË
 = 
çl£
;

3475 
ušt
 
ii
 = 0; i˜< 
	`¬¿y_–em’ts
(
sy¡em_dbs
); ii++) {

3476 ià(
	`¡rcmp
(
m_dbÇme
.
	`c_¡r
(), 
sy¡em_dbs
[
ii
]) == 0) {

3477 
m_is_mysql_sy¡em_bË
 = 
Œue
;

3481 
	}
}

3483 
	gRdb_tbl_def
::
	$£t_Çme
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
) {

3484 
”r
 
	`MY_ATTRIBUTE
((
__unu£d__
));

3486 
m_dbÇme_bËÇme
 = 
Çme
;

3487 
”r
 = 
	`rdb_¥l™_nÜm®ized_bËÇme
(
Çme
, &
m_dbÇme
, &
m_bËÇme
,

3488 &
m_·¹™iÚ
);

3489 
	`DBUG_ASSERT
(
”r
 == 0);

3491 
	`check_if_is_mysql_sy¡em_bË
();

3492 
	}
}

3494 
GL_INDEX_ID
 
	gRdb_tbl_def
::
	$g‘_autošü_gl_šdex_id
() {

3495 
ušt
 
i
 = 0; i < 
m_key_couÁ
; i++) {

3496 autØ&
k
 = 
m_key_desü_¬r
[
i
];

3497 ià(
k
->
m_šdex_ty³
 =ğ
Rdb_key_def
::
INDEX_TYPE_PRIMARY
 ||

3498 
k
->
m_šdex_ty³
 =ğ
Rdb_key_def
::
INDEX_TYPE_HIDDEN_PRIMARY
) {

3499  
k
->
	`g‘_gl_šdex_id
();

3504 
	`abÜt
();

3505  
	`GL_INDEX_ID
();

3506 
	}
}

3514 cÚ¡ 
uch¬
 *

3515 
	gRdb_ddl_mªag”
::
g‘_hash_key
(
Rdb_tbl_def
 *cÚ¡ 
»c
, 
size_t
 *cÚ¡ 
Ëngth
,

3516 
my_boŞ
 
nÙ_u£d
 
MY_ATTRIBUTE
((
__unu£d__
))) {

3517 cÚ¡ 
	g¡d
::
¡ršg
 &
dbÇme_bËÇme
 = 
»c
->
fuÎ_bËÇme
();

3518 *
	gËngth
 = 
dbÇme_bËÇme
.
size
();

3519  
	g»š‹½»t_ÿ¡
<cÚ¡ 
	guch¬
 *>(
	gdbÇme_bËÇme
.
c_¡r
());

3527 
	gRdb_ddl_mªag”
::
	$ä“_hash_–em
(*cÚ¡ 
d©a
) {

3528 
Rdb_tbl_def
 *
–em
 = 
»š‹½»t_ÿ¡
<Rdb_tbl_deà*>(
d©a
);

3529 
d–‘e
 
–em
;

3530 
	}
}

3532 
	gRdb_ddl_mªag”
::
	$”a£_šdex_num
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) {

3533 
m_šdex_num_to_keydef
.
	`”a£
(
gl_šdex_id
);

3534 
	}
}

3536 
	gRdb_ddl_mªag”
::
add_uncomm™‹d_keydefs
(

3537 cÚ¡ 
¡d
::
unÜd”ed_£t
<¡d::
sh¬ed_±r
<
Rdb_key_def
>> &
šdexes
) {

3538 
mysql_rwlock_w¾ock
(&
m_rwlock
);

3539 cÚ¡‡utØ&
	gšdex
 : 
šdexes
) {

3540 
m_šdex_num_to_uncomm™‹d_keydef
[
šdex
->
g‘_gl_šdex_id
()] = index;

3542 
mysql_rwlock_uÆock
(&
m_rwlock
);

3545 
	gRdb_ddl_mªag”
::
»move_uncomm™‹d_keydefs
(

3546 cÚ¡ 
¡d
::
unÜd”ed_£t
<¡d::
sh¬ed_±r
<
Rdb_key_def
>> &
šdexes
) {

3547 
mysql_rwlock_w¾ock
(&
m_rwlock
);

3548 cÚ¡‡utØ&
	gšdex
 : 
šdexes
) {

3549 
m_šdex_num_to_uncomm™‹d_keydef
.
”a£
(
šdex
->
g‘_gl_šdex_id
());

3551 
mysql_rwlock_uÆock
(&
m_rwlock
);

3554 
	gÇme¥aû


3556 
	gRdb_v®id©e_tbls
 : 
public
 
Rdb_bËs_sÿÂ”
 {

3557 
usšg
 
tbl_šfo_t
 = 
¡d
::
·œ
<¡d::
¡ršg
, 
	gboŞ
>;

3558 
usšg
 
	gtbl_li¡_t
 = 
¡d
::
m­
<¡d::
¡ršg
, 
	g¡d
::
£t
<
tbl_šfo_t
>>;

3560 
tbl_li¡_t
 
	gm_li¡
;

3562 
add_bË
(
Rdb_tbl_def
 *
tdef
è
	gov”ride
;

3564 
boŞ
 
com·»_to_aùu®_bËs
(cÚ¡ 
¡d
::
¡ršg
 &
d©adœ
, boŞ *
has_”rÜs
);

3566 
boŞ
 
sÿn_fÜ_äms
(cÚ¡ 
¡d
::
¡ršg
 &
d©adœ
, cÚ¡ std::¡ršg &
dbÇme
,

3567 
boŞ
 *
has_”rÜs
);

3569 
boŞ
 
check_äm_fe
(cÚ¡ 
¡d
::
¡ršg
 &
fuÎ·th
, cÚ¡ std::¡ršg &
dbÇme
,

3570 cÚ¡ 
¡d
::
¡ršg
 &
bËÇme
, 
boŞ
 *
has_”rÜs
);

3578 
	gRdb_v®id©e_tbls
::
	$add_bË
(
Rdb_tbl_def
 *
tdef
) {

3579 
	`DBUG_ASSERT
(
tdef
 !ğ
nuÎ±r
);

3582 ià(
tdef
->
	`ba£_bËÇme
().
	`fšd
(
tmp_fe_´efix
è=ğ
¡d
::
¡ršg
::
Åos
) {

3583 
boŞ
 
is_·¹™iÚ
 = 
tdef
->
	`ba£_·¹™iÚ
().
	`size
() != 0;

3584 
m_li¡
[
tdef
->
	`ba£_dbÇme
()].
	`š£¹
(

3585 
	`tbl_šfo_t
(
tdef
->
	`ba£_bËÇme
(), 
is_·¹™iÚ
));

3588  
HA_EXIT_SUCCESS
;

3589 
	}
}

3595 
boŞ
 
	gRdb_v®id©e_tbls
::
	$check_äm_fe
(cÚ¡ 
¡d
::
¡ršg
 &
fuÎ·th
,

3596 cÚ¡ 
¡d
::
¡ršg
 &
dbÇme
,

3597 cÚ¡ 
¡d
::
¡ršg
 &
bËÇme
,

3598 
boŞ
 *
has_”rÜs
) {

3600 
SŒšg
 
	`fuÎf’ame
(
fuÎ·th
.
	`c_¡r
(), &
my_ch¬£t_bš
);

3601 
fuÎf’ame
.
	`­³nd
(
FN_DIRSEP
);

3602 
fuÎf’ame
.
	`­³nd
(
bËÇme
.
	`c_¡r
());

3603 
fuÎf’ame
.
	`­³nd
(".frm");

3611 
Ëgacy_db_ty³
 
’g_ty³
;

3612 
äm_ty³_’um
 
ty³
 = 
	`dd_äm_ty³
(
nuÎ±r
, 
fuÎf’ame
.
	`c_±r
(), &
’g_ty³
);

3613 ià(
ty³
 =ğ
FRMTYPE_ERROR
) {

3614 
	`sql_´št_w¬nšg
("RocksDB: Failedo open/read .from file: %s",

3615 
fuÎf’ame
.
	`±r
());

3616  
çl£
;

3619 ià(
ty³
 =ğ
FRMTYPE_TABLE
) {

3621 ià(
’g_ty³
 =ğ
DB_TYPE_ROCKSDB
) {

3626 
tbl_šfo_t
 
	`–em’t
(
bËÇme
, 
çl£
);

3627 ià(
m_li¡
.
	`couÁ
(
dbÇme
è=ğ0 || m_li¡[dbÇme].
	`”a£
(
–em’t
) == 0) {

3628 
	`sql_´št_w¬nšg
("RocksDB: Schema mismatch - "

3631 
dbÇme
.
	`c_¡r
(), 
bËÇme
.c_str());

3632 *
has_”rÜs
 = 
Œue
;

3634 } ià(
’g_ty³
 =ğ
DB_TYPE_PARTITION_DB
) {

3640 ià(
m_li¡
.
	`couÁ
(
dbÇme
) > 0) {

3641 
m_li¡
[
dbÇme
].
	`”a£
(
	`tbl_šfo_t
(
bËÇme
, 
Œue
));

3646  
Œue
;

3647 
	}
}

3650 
boŞ
 
	gRdb_v®id©e_tbls
::
	$sÿn_fÜ_äms
(cÚ¡ 
¡d
::
¡ršg
 &
d©adœ
,

3651 cÚ¡ 
¡d
::
¡ršg
 &
dbÇme
,

3652 
boŞ
 *
has_”rÜs
) {

3653 
boŞ
 
»suÉ
 = 
Œue
;

3654 
¡d
::
¡ršg
 
fuÎ·th
 = 
d©adœ
 + 
dbÇme
;

3655 
¡_my_dœ
 *
dœ_šfo
 = 
	`my_dœ
(
fuÎ·th
.
	`c_¡r
(), 
	`MYF
(
MY_DONT_SORT
));

3658 ià(
dœ_šfo
 =ğ
nuÎ±r
) {

3659 
	`sql_´št_w¬nšg
("RocksDB: Could‚ot open database directory: %s",

3660 
fuÎ·th
.
	`c_¡r
());

3661  
çl£
;

3665 
fešfo
 *
fe_šfo
 = 
dœ_šfo
->
dœ_’Œy
;

3666 
ušt
 
ii
 = 0; i˜< 
dœ_šfo
->
numb”_off_fes
; ii++, 
fe_šfo
++) {

3668 cÚ¡ *
ext
 = 
	`¡¼chr
(
fe_šfo
->
Çme
, '.');

3669 ià(
ext
 !ğ
nuÎ±r
 && 
	`¡r¡r
(
fe_šfo
->
Çme
, 
tmp_fe_´efix
) ==‚ullptr &&

3670 
	`¡rcmp
(
ext
, ".frm") == 0) {

3671 
¡d
::
¡ršg
 
bËÇme
 =

3672 
¡d
::
	`¡ršg
(
fe_šfo
->
Çme
, 
ext
 - file_info->name);

3675 ià(!
	`check_äm_fe
(
fuÎ·th
, 
dbÇme
, 
bËÇme
, 
has_”rÜs
)) {

3676 
»suÉ
 = 
çl£
;

3683 ià(
m_li¡
.
	`couÁ
(
dbÇme
è=ğ1 && m_li¡[dbÇme].
	`size
() == 0) {

3684 
m_li¡
.
	`”a£
(
dbÇme
);

3688 
	`my_dœ’d
(
dœ_šfo
);

3690  
»suÉ
;

3691 
	}
}

3697 
boŞ
 
	gRdb_v®id©e_tbls
::
	$com·»_to_aùu®_bËs
(cÚ¡ 
¡d
::
¡ršg
 &
d©adœ
,

3698 
boŞ
 *
has_”rÜs
) {

3699 
boŞ
 
»suÉ
 = 
Œue
;

3700 
¡_my_dœ
 *
dœ_šfo
;

3701 
fešfo
 *
fe_šfo
;

3703 
dœ_šfo
 = 
	`my_dœ
(
d©adœ
.
	`c_¡r
(), 
	`MYF
(
MY_DONT_SORT
 | 
MY_WANT_STAT
));

3704 ià(
dœ_šfo
 =ğ
nuÎ±r
) {

3705 
	`sql_´št_w¬nšg
("RocksDB: could‚Ù o³Àd©adœ: %s", 
d©adœ
.
	`c_¡r
());

3706  
çl£
;

3709 
fe_šfo
 = 
dœ_šfo
->
dœ_’Œy
;

3710 
ušt
 
ii
 = 0; i˜< 
dœ_šfo
->
numb”_off_fes
; ii++, 
fe_šfo
++) {

3712 ià(
fe_šfo
->
Çme
[0] == '.')

3716 ià(!
	`MY_S_ISDIR
(
fe_šfo
->
my¡©
->
¡_mode
))

3720 ià(!
	`sÿn_fÜ_äms
(
d©adœ
, 
fe_šfo
->
Çme
, 
has_”rÜs
)) {

3721 
»suÉ
 = 
çl£
;

3727 
	`my_dœ’d
(
dœ_šfo
);

3729  
»suÉ
;

3730 
	}
}

3736 
boŞ
 
	gRdb_ddl_mªag”
::
	$v®id©e_auto_šü
() {

3737 
¡d
::
unique_±r
<
rocksdb
::
I‹¿tÜ
> 
	`™
(
m_diù
->
	`Ãw_™”©Ü
());

3739 
uch¬
 
auto_šü_’Œy
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

3740 
	`rdb_Ãtbuf_¡Üe_šdex
(
auto_šü_’Œy
, 
Rdb_key_def
::
AUTO_INC
);

3741 cÚ¡ 
rocksdb
::
Sliû
 
	`auto_šü_’Œy_¦iû
(

3742 
»š‹½»t_ÿ¡
<*>(
auto_šü_’Œy
),

3743 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

3744 
™
->
	`S“k
(
auto_šü_’Œy_¦iû
); it->
	`V®id
(); it->
	`Next
()) {

3745 cÚ¡ 
rocksdb
::
Sliû
 
key
 = 
™
->
	`key
();

3746 cÚ¡ 
rocksdb
::
Sliû
 
v®
 = 
™
->
	`v®ue
();

3747 
GL_INDEX_ID
 
gl_šdex_id
;

3749 ià(
key
.
	`size
(è>ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
 &&

3750 
	`memcmp
(
key
.
	`d©a
(), 
auto_šü_’Œy
, 
Rdb_key_def
::
INDEX_NUMBER_SIZE
))

3753 ià(
key
.
	`size
(è!ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3) {

3754  
çl£
;

3757 ià(
v®
.
	`size
(è<ğ
Rdb_key_def
::
VERSION_SIZE
) {

3758  
çl£
;

3763 autØ
±r
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
key
.
	`d©a
());

3764 
±r
 +ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
;

3765 
	`rdb_Ãtbuf_»ad_gl_šdex
(&
±r
, &
gl_šdex_id
);

3766 ià(!
m_diù
->
	`g‘_šdex_šfo
(
gl_šdex_id
, 
nuÎ±r
)) {

3768 
	`sql_´št_w¬nšg
("RocksDB: AUTOINC mismatch - "

3771 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
);

3772  
çl£
;

3775 
±r
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
v®
.
	`d©a
());

3776 cÚ¡ 
v”siÚ
 = 
	`rdb_Ãtbuf_»ad_ušt16
(&
±r
);

3777 ià(
v”siÚ
 > 
Rdb_key_def
::
AUTO_INCREMENT_VERSION
) {

3779 
	`sql_´št_w¬nšg
("RocksDB: AUTOINC mismatch - "

3782 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
, 
v”siÚ
);

3783  
çl£
;

3787 ià(!
™
->
	`¡©us
().
	`ok
()) {

3788  
çl£
;

3791  
Œue
;

3792 
	}
}

3798 
boŞ
 
	gRdb_ddl_mªag”
::
	$v®id©e_schemas
() {

3799 
boŞ
 
has_”rÜs
 = 
çl£
;

3800 cÚ¡ 
¡d
::
¡ršg
 
d©adœ
 = std::
	`¡ršg
(
mysql_»®_d©a_home
);

3801 
Rdb_v®id©e_tbls
 
bË_li¡
;

3804 ià(
	`sÿn_fÜ_bËs
(&
bË_li¡
) != 0) {

3805  
çl£
;

3809 ià(!
bË_li¡
.
	`com·»_to_aùu®_bËs
(
d©adœ
, &
has_”rÜs
)) {

3810  
çl£
;

3817 cÚ¡‡utØ&
db
 : 
bË_li¡
.
m_li¡
) {

3818 cÚ¡‡utØ&
bË
 : 
db
.
£cÚd
) {

3819 
	`sql_´št_w¬nšg
("RocksDB: Schema mismatch - "

3822 
db
.
fœ¡
.
	`c_¡r
(), 
bË
.first.c_str());

3823 
has_”rÜs
 = 
Œue
;

3827  !
has_”rÜs
;

3828 
	}
}

3830 
boŞ
 
	gRdb_ddl_mªag”
::
	$š™
(
Rdb_diù_mªag”
 *cÚ¡ 
diù_¬g
,

3831 
Rdb_cf_mªag”
 *cÚ¡ 
cf_mªag”
,

3832 cÚ¡ 
ušt32_t
 &
v®id©e_bËs
) {

3833 cÚ¡ 
ulÚg
 
TABLE_HASH_SIZE
 = 32;

3834 
m_diù
 = 
diù_¬g
;

3835 
	`mysql_rwlock_š™
(0, &
m_rwlock
);

3836 ()
	`my_hash_š™
(&
m_ddl_hash
,

3837  &
my_ch¬£t_bš
, 
TABLE_HASH_SIZE
,

3838 0, 0, (
my_hash_g‘_key
)
Rdb_ddl_mªag”
::
g‘_hash_key
,

3839 
Rdb_ddl_mªag”
::
ä“_hash_–em
, 0);

3842 
uch¬
 
ddl_’Œy
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

3843 
	`rdb_Ãtbuf_¡Üe_šdex
(
ddl_’Œy
, 
Rdb_key_def
::
DDL_ENTRY_INDEX_START_NUMBER
);

3844 cÚ¡ 
rocksdb
::
Sliû
 
	`ddl_’Œy_¦iû
((*)
ddl_’Œy
,

3845 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

3848 
rocksdb
::
I‹¿tÜ
 *
™
 = 
m_diù
->
	`Ãw_™”©Ü
();

3849 
i
 = 0;

3851 
ušt
 
max_šdex_id_š_diù
 = 0;

3852 
m_diù
->
	`g‘_max_šdex_id
(&
max_šdex_id_š_diù
);

3854 
™
->
	`S“k
(
ddl_’Œy_¦iû
); it->
	`V®id
(); it->
	`Next
()) {

3855 cÚ¡ 
uch¬
 *
±r
;

3856 cÚ¡ 
uch¬
 *
±r_’d
;

3857 cÚ¡ 
rocksdb
::
Sliû
 
key
 = 
™
->
	`key
();

3858 cÚ¡ 
rocksdb
::
Sliû
 
v®
 = 
™
->
	`v®ue
();

3860 ià(
key
.
	`size
(è>ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
 &&

3861 
	`memcmp
(
key
.
	`d©a
(), 
ddl_’Œy
, 
Rdb_key_def
::
INDEX_NUMBER_SIZE
))

3864 ià(
key
.
	`size
(è<ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
) {

3865 
	`sql_´št_”rÜ
("RocksDB: Table_store: key has†ength %d (corruption?)",

3866 ()
key
.
	`size
());

3867  
Œue
;

3870 
Rdb_tbl_def
 *cÚ¡ 
tdef
 =

3871 
Ãw
 
	`Rdb_tbl_def
(
key
, 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

3874 cÚ¡ 
»®_v®_size
 = 
v®
.
	`size
(è- 
Rdb_key_def
::
VERSION_SIZE
;

3875 ià(
»®_v®_size
 % 
Rdb_key_def
::
PACKED_SIZE
 * 2 > 0) {

3876 
	`sql_´št_”rÜ
("RocksDB: Table_store: invalid keylist forable %s",

3877 
tdef
->
	`fuÎ_bËÇme
().
	`c_¡r
());

3878  
Œue
;

3880 
tdef
->
m_key_couÁ
 = 
»®_v®_size
 / (
Rdb_key_def
::
PACKED_SIZE
 * 2);

3881 
tdef
->
m_key_desü_¬r
 = 
Ãw
 
¡d
::
sh¬ed_±r
<
Rdb_key_def
>[tdef->
m_key_couÁ
];

3883 
±r
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
v®
.
	`d©a
());

3884 cÚ¡ 
v”siÚ
 = 
	`rdb_Ãtbuf_»ad_ušt16
(&
±r
);

3885 ià(
v”siÚ
 !ğ
Rdb_key_def
::
DDL_ENTRY_INDEX_VERSION
) {

3886 
	`sql_´št_”rÜ
("RocksDB: DDL ENTRY Version was‚otƒxpected."

3888 
Rdb_key_def
::
DDL_ENTRY_INDEX_VERSION
, 
v”siÚ
);

3889  
Œue
;

3891 
±r_’d
 = 
±r
 + 
»®_v®_size
;

3892 
ušt
 
keyno
 = 0; 
±r
 < 
±r_’d
; keyno++) {

3893 
GL_INDEX_ID
 
gl_šdex_id
;

3894 
	`rdb_Ãtbuf_»ad_gl_šdex
(&
±r
, &
gl_šdex_id
);

3895 
ušt
 
æags
 = 0;

3896 
Rdb_šdex_šfo
 
šdex_šfo
;

3897 ià(!
m_diù
->
	`g‘_šdex_šfo
(
gl_šdex_id
, &
šdex_šfo
)) {

3898 
	`sql_´št_”rÜ
("RocksDB: Could‚ot get index information "

3900 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
,

3901 
tdef
->
	`fuÎ_bËÇme
().
	`c_¡r
());

3902  
Œue
;

3904 ià(
max_šdex_id_š_diù
 < 
gl_šdex_id
.
šdex_id
) {

3905 
	`sql_´št_”rÜ
("RocksDB: Found max index id %u from data dictionary "

3908 
max_šdex_id_š_diù
, 
gl_šdex_id
.
šdex_id
);

3909  
Œue
;

3911 ià(!
m_diù
->
	`g‘_cf_æags
(
gl_šdex_id
.
cf_id
, &
æags
)) {

3912 
	`sql_´št_”rÜ
("RocksDB: Could‚ot get Column Family Flags "

3914 
gl_šdex_id
.
cf_id
, 
tdef
->
	`fuÎ_bËÇme
().
	`c_¡r
());

3915  
Œue
;

3918 ià((
æags
 & 
Rdb_key_def
::
AUTO_CF_FLAG
) != 0) {

3921 
	`sql_´št_”rÜ
("RocksDB: The defunct AUTO_CF_FLAG isƒnabled for CF "

3923 
gl_šdex_id
.
cf_id
, 
tdef
->
	`fuÎ_bËÇme
().
	`c_¡r
());

3926 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cfh
 =

3927 
cf_mªag”
->
	`g‘_cf
(
gl_šdex_id
.
cf_id
);

3928 
	`DBUG_ASSERT
(
cfh
 !ğ
nuÎ±r
);

3930 
ušt32
 
‰l_»c_off£t
 =

3931 
Rdb_key_def
::
	`has_šdex_æag
(
šdex_šfo
.
m_šdex_æags
,

3932 
Rdb_key_def
::
TTL_FLAG
)

3933 ? 
Rdb_key_def
::
	`ÿlcuÏ‹_šdex_æag_off£t
(

3934 
šdex_šfo
.
m_šdex_æags
, 
Rdb_key_def
::
TTL_FLAG
)

3935 : 
UINT_MAX
;

3942 
tdef
->
m_key_desü_¬r
[
keyno
] = 
¡d
::
make_sh¬ed
<
Rdb_key_def
>(

3943 
gl_šdex_id
.
šdex_id
, 
keyno
, 
cfh
, 
šdex_šfo
.
m_šdex_diù_v”siÚ
,

3944 
šdex_šfo
.
m_šdex_ty³
, index_šfo.
m_kv_v”siÚ
,

3945 
æags
 & 
Rdb_key_def
::
REVERSE_CF_FLAG
,

3946 
æags
 & 
Rdb_key_def
::
PER_PARTITION_CF_FLAG
, "",

3947 
m_diù
->
	`g‘_¡©s
(
gl_šdex_id
), 
šdex_šfo
.
m_šdex_æags
,

3948 
‰l_»c_off£t
, 
šdex_šfo
.
m_‰l_du¿tiÚ
);

3950 
	`put
(
tdef
);

3951 
i
++;

3958 ià(
v®id©e_bËs
 > 0) {

3959 
¡d
::
¡ršg
 
msg
;

3960 ià(!
	`v®id©e_schemas
()) {

3961 
msg
 = "RocksDB: Problems validating data dictionary "

3963 } ià(!
	`v®id©e_auto_šü
()) {

3964 
msg
 = "RocksDB: Problems validating‡uto increment values in "

3967 ià(
v®id©e_bËs
 =ğ1 && !
msg
.
	`em±y
()) {

3969 
	`sql_´št_”rÜ
("%s", 
msg
.
	`c_¡r
());

3970  
Œue
;

3976 ià(
max_šdex_id_š_diù
 < 
Rdb_key_def
::
END_DICT_INDEX_ID
) {

3977 
max_šdex_id_š_diù
 = 
Rdb_key_def
::
END_DICT_INDEX_ID
;

3980 
m_£qu’û
.
	`š™
(
max_šdex_id_š_diù
 + 1);

3982 ià(!
™
->
	`¡©us
().
	`ok
()) {

3983 
	`rdb_log_¡©us_”rÜ
(
™
->
	`¡©us
(), "Table_store†oadƒrror");

3984  
Œue
;

3986 
d–‘e
 
™
;

3987 
	`sql_´št_šfÜm©iÚ
("RocksDB: Table_store:†oaded DDL data for %dables",

3988 
i
);

3989  
çl£
;

3990 
	}
}

3992 
Rdb_tbl_def
 *
	gRdb_ddl_mªag”
::
	$fšd
(cÚ¡ 
¡d
::
¡ršg
 &
bË_Çme
,

3993 cÚ¡ 
boŞ
 &
lock
) {

3994 ià(
lock
) {

3995 
	`mysql_rwlock_rdlock
(&
m_rwlock
);

3998 
Rdb_tbl_def
 *cÚ¡ 
»c
 = 
»š‹½»t_ÿ¡
<Rdb_tbl_deà*>(
	`my_hash_£¬ch
(

3999 &
m_ddl_hash
, 
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
bË_Çme
.
	`c_¡r
()),

4000 
bË_Çme
.
	`size
()));

4002 ià(
lock
) {

4003 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4006  
»c
;

4007 
	}
}

4013 
	g¡d
::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
>

4014 
Rdb_ddl_mªag”
::
	$§ã_fšd
(
GL_INDEX_ID
 
gl_šdex_id
) {

4015 
¡d
::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
> 
	`»t
(
nuÎ±r
);

4017 
	`mysql_rwlock_rdlock
(&
m_rwlock
);

4019 autØ
™
 = 
m_šdex_num_to_keydef
.
	`fšd
(
gl_šdex_id
);

4020 ià(
™
 !ğ
m_šdex_num_to_keydef
.
	`’d
()) {

4021 cÚ¡‡utØ
bË_def
 = 
	`fšd
(
™
->
£cÚd
.
fœ¡
, 
çl£
);

4022 ià(
bË_def
 && 
™
->
£cÚd
.£cÚd <abË_def->
m_key_couÁ
) {

4023 cÚ¡‡utØ&
kd
 = 
bË_def
->
m_key_desü_¬r
[
™
->
£cÚd
.second];

4024 ià(
kd
->
	`max_¡Üage_fmt_Ëngth
() != 0) {

4025 
»t
 = 
kd
;

4029 autØ
™
 = 
m_šdex_num_to_uncomm™‹d_keydef
.
	`fšd
(
gl_šdex_id
);

4030 ià(
™
 !ğ
m_šdex_num_to_uncomm™‹d_keydef
.
	`’d
()) {

4031 cÚ¡‡utØ&
kd
 = 
™
->
£cÚd
;

4032 ià(
kd
->
	`max_¡Üage_fmt_Ëngth
() != 0) {

4033 
»t
 = 
kd
;

4038 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4040  
»t
;

4041 
	}
}

4044 cÚ¡ 
	g¡d
::
sh¬ed_±r
<
Rdb_key_def
> &

4045 
Rdb_ddl_mªag”
::
	$fšd
(
GL_INDEX_ID
 
gl_šdex_id
) {

4046 autØ
™
 = 
m_šdex_num_to_keydef
.
	`fšd
(
gl_šdex_id
);

4047 ià(
™
 !ğ
m_šdex_num_to_keydef
.
	`’d
()) {

4048 autØ
bË_def
 = 
	`fšd
(
™
->
£cÚd
.
fœ¡
, 
çl£
);

4049 ià(
bË_def
) {

4050 ià(
™
->
£cÚd
.£cÚd < 
bË_def
->
m_key_couÁ
) {

4051  
bË_def
->
m_key_desü_¬r
[
™
->
£cÚd
.second];

4055 autØ
™
 = 
m_šdex_num_to_uncomm™‹d_keydef
.
	`fšd
(
gl_šdex_id
);

4056 ià(
™
 !ğ
m_šdex_num_to_uncomm™‹d_keydef
.
	`’d
()) {

4057  
™
->
£cÚd
;

4061 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> 
em±y
 = 
nuÎ±r
;

4063  
em±y
;

4064 
	}
}

4068 cÚ¡ 
	g¡d
::
¡ršg


4069 
Rdb_ddl_mªag”
::
	$§ã_g‘_bË_Çme
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) {

4070 
¡d
::
¡ršg
 
»t
;

4071 
	`mysql_rwlock_rdlock
(&
m_rwlock
);

4072 autØ
™
 = 
m_šdex_num_to_keydef
.
	`fšd
(
gl_šdex_id
);

4073 ià(
™
 !ğ
m_šdex_num_to_keydef
.
	`’d
()) {

4074 
»t
 = 
™
->
£cÚd
.
fœ¡
;

4076 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4077  
»t
;

4078 
	}
}

4080 
	gRdb_ddl_mªag”
::
£t_¡©s
(

4081 cÚ¡ 
¡d
::
unÜd”ed_m­
<
GL_INDEX_ID
, 
Rdb_šdex_¡©s
> &
¡©s
) {

4082 
mysql_rwlock_w¾ock
(&
m_rwlock
);

4083 autØ
	g¤c
 : 
¡©s
) {

4084 cÚ¡‡utØ&
keydef
 = 
fšd
(
¤c
.
£cÚd
.
m_gl_šdex_id
);

4085 ià(
	gkeydef
) {

4086 
	gkeydef
->
	gm_¡©s
 = 
¤c
.
£cÚd
;

4087 
	gm_¡©s2¡Üe
[
keydef
->
m_¡©s
.
m_gl_šdex_id
] = keydef->m_stats;

4090 
mysql_rwlock_uÆock
(&
m_rwlock
);

4093 
	gRdb_ddl_mªag”
::
adju¡_¡©s
(

4094 cÚ¡ 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> &
Ãw_d©a
,

4095 cÚ¡ 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> &
d–‘ed_d©a
) {

4096 
mysql_rwlock_w¾ock
(&
m_rwlock
);

4097 
	gi
 = 0;

4098 cÚ¡‡utØ&
	gd©a
 : {
Ãw_d©a
, 
	gd–‘ed_d©a
}) {

4099 cÚ¡‡utØ&
	g¤c
 : 
d©a
) {

4100 cÚ¡‡utØ&
keydef
 = 
fšd
(
¤c
.
m_gl_šdex_id
);

4101 ià(
	gkeydef
) {

4102 
	gkeydef
->
	gm_¡©s
.
	gm_di¡šù_keys_³r_´efix
.
»size
(

4103 
keydef
->
g‘_key_·¹s
());

4104 
	gkeydef
->
	gm_¡©s
.
m”ge
(
¤c
, 
i
 =ğ0, 
keydef
->
max_¡Üage_fmt_Ëngth
());

4105 
	gm_¡©s2¡Üe
[
keydef
->
m_¡©s
.
m_gl_šdex_id
] = keydef->m_stats;

4108 
	gi
++;

4110 cÚ¡ 
boŞ
 
	gshould_§ve_¡©s
 = !
m_¡©s2¡Üe
.
em±y
();

4111 
mysql_rwlock_uÆock
(&
m_rwlock
);

4112 ià(
	gshould_§ve_¡©s
) {

4114 
rdb_queue_§ve_¡©s_»que¡
();

4118 
	gRdb_ddl_mªag”
::
	$³rsi¡_¡©s
(cÚ¡ 
boŞ
 &
sync
) {

4119 
	`mysql_rwlock_w¾ock
(&
m_rwlock
);

4120 cÚ¡‡utØ
loÿl_¡©s2¡Üe
 = 
¡d
::
	`move
(
m_¡©s2¡Üe
);

4121 
m_¡©s2¡Üe
.
	`ş—r
();

4122 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4125 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
m_diù
->
	`begš
();

4126 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> 
¡©s
;

4127 
¡d
::
	`ŒªsfÜm
(
loÿl_¡©s2¡Üe
.
	`begš
(),†oÿl_¡©s2¡Üe.
	`’d
(),

4128 
¡d
::
	`back_š£¹”
(
¡©s
),

4129 [](cÚ¡ 
¡d
::
·œ
<
GL_INDEX_ID
, 
Rdb_šdex_¡©s
> &
s
) {

4130  
s
.
£cÚd
;

4132 
m_diù
->
	`add_¡©s
(
wb
.
	`g‘
(), 
¡©s
);

4133 
m_diù
->
	`comm™
(
wb
.
	`g‘
(), 
sync
);

4134 
	}
}

4141 
	gRdb_ddl_mªag”
::
	$put_ªd_wr™e
(
Rdb_tbl_def
 *cÚ¡ 
tbl
,

4142 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
) {

4143 
uch¬
 
buf
[
FN_LEN
 * 2 + 
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

4144 
ušt
 
pos
 = 0;

4146 
	`rdb_Ãtbuf_¡Üe_šdex
(
buf
, 
Rdb_key_def
::
DDL_ENTRY_INDEX_START_NUMBER
);

4147 
pos
 +ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
;

4149 cÚ¡ 
¡d
::
¡ršg
 &
dbÇme_bËÇme
 = 
tbl
->
	`fuÎ_bËÇme
();

4150 
	`memıy
(
buf
 + 
pos
, 
dbÇme_bËÇme
.
	`c_¡r
(), dbÇme_bËÇme.
	`size
());

4151 
pos
 +ğ
dbÇme_bËÇme
.
	`size
();

4153 
»s
;

4154 ià((
»s
 = 
tbl
->
	`put_diù
(
m_diù
, 
b©ch
, 
buf
, 
pos
))) {

4155  
»s
;

4157 ià((
»s
 = 
	`put
(
tbl
))) {

4158  
»s
;

4160  
HA_EXIT_SUCCESS
;

4161 
	}
}

4170 
	gRdb_ddl_mªag”
::
	$put
(
Rdb_tbl_def
 *cÚ¡ 
tbl
, cÚ¡ 
boŞ
 &
lock
) {

4171 
Rdb_tbl_def
 *
»c
;

4172 
my_boŞ
 
»suÉ
;

4173 cÚ¡ 
¡d
::
¡ršg
 &
dbÇme_bËÇme
 = 
tbl
->
	`fuÎ_bËÇme
();

4175 ià(
lock
)

4176 
	`mysql_rwlock_w¾ock
(&
m_rwlock
);

4180 
»c
 = 
	`fšd
(
dbÇme_bËÇme
, 
çl£
);

4181 ià(
»c
) {

4183 
	`my_hash_d–‘e
(&
m_ddl_hash
, 
»š‹½»t_ÿ¡
<
uch¬
 *>(
»c
));

4185 
»suÉ
 = 
	`my_hash_š£¹
(&
m_ddl_hash
, 
»š‹½»t_ÿ¡
<
uch¬
 *>(
tbl
));

4187 
ušt
 
keyno
 = 0; keynØ< 
tbl
->
m_key_couÁ
; keyno++) {

4188 
m_šdex_num_to_keydef
[
tbl
->
m_key_desü_¬r
[
keyno
]->
	`g‘_gl_šdex_id
()] =

4189 
¡d
::
	`make_·œ
(
dbÇme_bËÇme
, 
keyno
);

4192 ià(
lock
)

4193 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4194  
»suÉ
;

4195 
	}
}

4197 
	gRdb_ddl_mªag”
::
	$»move
(
Rdb_tbl_def
 *cÚ¡ 
tbl
,

4198 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

4199 cÚ¡ 
boŞ
 &
lock
) {

4200 ià(
lock
)

4201 
	`mysql_rwlock_w¾ock
(&
m_rwlock
);

4203 
uch¬
 
buf
[
FN_LEN
 * 2 + 
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

4204 
ušt
 
pos
 = 0;

4206 
	`rdb_Ãtbuf_¡Üe_šdex
(
buf
, 
Rdb_key_def
::
DDL_ENTRY_INDEX_START_NUMBER
);

4207 
pos
 +ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
;

4209 cÚ¡ 
¡d
::
¡ršg
 &
dbÇme_bËÇme
 = 
tbl
->
	`fuÎ_bËÇme
();

4210 
	`memıy
(
buf
 + 
pos
, 
dbÇme_bËÇme
.
	`c_¡r
(), dbÇme_bËÇme.
	`size
());

4211 
pos
 +ğ
dbÇme_bËÇme
.
	`size
();

4213 cÚ¡ 
rocksdb
::
Sliû
 
	`tkey
((*)
buf
, 
pos
);

4214 
m_diù
->
	`d–‘e_key
(
b©ch
, 
tkey
);

4217 
	`my_hash_d–‘e
(&
m_ddl_hash
, 
»š‹½»t_ÿ¡
<
uch¬
 *>(
tbl
));

4219 ià(
lock
)

4220 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4221 
	}
}

4223 
boŞ
 
	gRdb_ddl_mªag”
::
	$»Çme
(cÚ¡ 
¡d
::
¡ršg
 &
äom
, cÚ¡ std::¡ršg &
to
,

4224 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
) {

4225 
Rdb_tbl_def
 *
»c
;

4226 
Rdb_tbl_def
 *
Ãw_»c
;

4227 
boŞ
 
»s
 = 
Œue
;

4228 
uch¬
 
Ãw_buf
[
FN_LEN
 * 2 + 
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

4229 
ušt
 
Ãw_pos
 = 0;

4231 
	`mysql_rwlock_w¾ock
(&
m_rwlock
);

4232 ià(!(
»c
 = 
	`fšd
(
äom
, 
çl£
))) {

4233 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4234  
Œue
;

4237 
Ãw_»c
 = 
Ãw
 
	`Rdb_tbl_def
(
to
);

4239 
Ãw_»c
->
m_key_couÁ
 = 
»c
->m_key_count;

4240 
Ãw_»c
->
m_auto_šü_v®
 =

4241 
»c
->
m_auto_šü_v®
.
	`lßd
(
¡d
::
memÜy_Üd”_»Ïxed
);

4242 
Ãw_»c
->
m_key_desü_¬r
 = 
»c
->m_key_descr_arr;

4245 
»c
->
m_key_desü_¬r
 = 
nuÎ±r
;

4248 
	`rdb_Ãtbuf_¡Üe_šdex
(
Ãw_buf
, 
Rdb_key_def
::
DDL_ENTRY_INDEX_START_NUMBER
);

4249 
Ãw_pos
 +ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
;

4251 cÚ¡ 
¡d
::
¡ršg
 &
dbÇme_bËÇme
 = 
Ãw_»c
->
	`fuÎ_bËÇme
();

4252 
	`memıy
(
Ãw_buf
 + 
Ãw_pos
, 
dbÇme_bËÇme
.
	`c_¡r
(), dbÇme_bËÇme.
	`size
());

4253 
Ãw_pos
 +ğ
dbÇme_bËÇme
.
	`size
();

4256 ià(!
Ãw_»c
->
	`put_diù
(
m_diù
, 
b©ch
, 
Ãw_buf
, 
Ãw_pos
)) {

4257 
	`»move
(
»c
, 
b©ch
, 
çl£
);

4258 
	`put
(
Ãw_»c
, 
çl£
);

4259 
»s
 = 
çl£
;

4262 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4263  
»s
;

4264 
	}
}

4266 
	gRdb_ddl_mªag”
::
	$ş—nup
() {

4267 
	`my_hash_ä“
(&
m_ddl_hash
);

4268 
	`mysql_rwlock_de¡roy
(&
m_rwlock
);

4269 
m_£qu’û
.
	`ş—nup
();

4270 
	}
}

4272 
	gRdb_ddl_mªag”
::
	$sÿn_fÜ_bËs
(
Rdb_bËs_sÿÂ”
 *cÚ¡ 
bËs_sÿÂ”
) {

4273 
i
, 
»t
;

4274 
Rdb_tbl_def
 *
»c
;

4276 
	`DBUG_ASSERT
(
bËs_sÿÂ”
 !ğ
nuÎ±r
);

4278 
	`mysql_rwlock_rdlock
(&
m_rwlock
);

4280 
»t
 = 0;

4281 
i
 = 0;

4284 
»c
 = 
»š‹½»t_ÿ¡
<
Rdb_tbl_def
 *>(
	`my_hash_–em’t
(&
m_ddl_hash
, 
i
)))) {

4285 
»t
 = 
bËs_sÿÂ”
->
	`add_bË
(
»c
);

4286 ià(
»t
)

4288 
i
++;

4291 
	`mysql_rwlock_uÆock
(&
m_rwlock
);

4292  
»t
;

4293 
	}
}

4299 
boŞ
 
	gRdb_bšlog_mªag”
::
	$š™
(
Rdb_diù_mªag”
 *cÚ¡ 
diù_¬g
) {

4300 
	`DBUG_ASSERT
(
diù_¬g
 !ğ
nuÎ±r
);

4301 
m_diù
 = 
diù_¬g
;

4303 
	`rdb_Ãtbuf_¡Üe_šdex
(
m_key_buf
, 
Rdb_key_def
::
BINLOG_INFO_INDEX_NUMBER
);

4304 
m_key_¦iû
 = 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
m_key_buf
),

4305 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

4306  
çl£
;

4307 
	}
}

4309 
	gRdb_bšlog_mªag”
::
	$ş—nup
(è{
	}
}

4322 
Rdb_bšlog_mªag”
::
	$upd©e
(cÚ¡ *cÚ¡ 
bšlog_Çme
,

4323 cÚ¡ 
my_off_t
 
bšlog_pos
,

4324 cÚ¡ *cÚ¡ 
bšlog_max_gtid
,

4325 
rocksdb
::
Wr™eB©chBa£
 *cÚ¡ 
b©ch
) {

4326 ià(
bšlog_Çme
 && 
bšlog_pos
) {

4328 cÚ¡ 
size_t
 
RDB_MAX_BINLOG_INFO_LEN
 = 1024;

4329 
uch¬
 
v®ue_buf
[
RDB_MAX_BINLOG_INFO_LEN
];

4330 
m_diù
->
	`put_key
(

4331 
b©ch
, 
m_key_¦iû
,

4332 
	`·ck_v®ue
(
v®ue_buf
, 
bšlog_Çme
, 
bšlog_pos
, 
bšlog_max_gtid
));

4334 
	}
}

4345 
boŞ
 
	gRdb_bšlog_mªag”
::
	$»ad
(*cÚ¡ 
bšlog_Çme
,

4346 
my_off_t
 *cÚ¡ 
bšlog_pos
,

4347 *cÚ¡ 
bšlog_gtid
) const {

4348 
boŞ
 
»t
 = 
çl£
;

4349 ià(
bšlog_Çme
) {

4350 
¡d
::
¡ršg
 
v®ue
;

4351 
rocksdb
::
Stus
 
¡©us
 = 
m_diù
->
	`g‘_v®ue
(
m_key_¦iû
, &
v®ue
);

4352 ià(
¡©us
.
	`ok
()) {

4353 ià(!
	`uÅack_v®ue
((cÚ¡ 
uch¬
 *)
v®ue
.
	`c_¡r
(), 
bšlog_Çme
, 
bšlog_pos
,

4354 
bšlog_gtid
))

4355 
»t
 = 
Œue
;

4358  
»t
;

4359 
	}
}

4370 
	grocksdb
::
Sliû


4371 
Rdb_bšlog_mªag”
::
	$·ck_v®ue
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ *cÚ¡ 
bšlog_Çme
,

4372 cÚ¡ 
my_off_t
 &
bšlog_pos
,

4373 cÚ¡ *cÚ¡ 
bšlog_gtid
) const {

4374 
ušt
 
·ck_Ën
 = 0;

4377 
	`rdb_Ãtbuf_¡Üe_ušt16
(
buf
, 
Rdb_key_def
::
BINLOG_INFO_INDEX_NUMBER_VERSION
);

4378 
·ck_Ën
 +ğ
Rdb_key_def
::
VERSION_SIZE
;

4381 
	`DBUG_ASSERT
(
	`¡¾’
(
bšlog_Çme
è<ğ
FN_REFLEN
);

4382 cÚ¡ 
ušt16_t
 
bšlog_Çme_Ën
 = 
	`¡¾’
(
bšlog_Çme
);

4383 
	`rdb_Ãtbuf_¡Üe_ušt16
(
buf
 + 
·ck_Ën
, 
bšlog_Çme_Ën
);

4384 
·ck_Ën
 +ğ(
ušt16
);

4387 
	`memıy
(
buf
 + 
·ck_Ën
, 
bšlog_Çme
, 
bšlog_Çme_Ën
);

4388 
·ck_Ën
 +ğ
bšlog_Çme_Ën
;

4391 
	`rdb_Ãtbuf_¡Üe_ušt32
(
buf
 + 
·ck_Ën
, 
bšlog_pos
);

4392 
·ck_Ën
 +ğ(
ušt32
);

4396 cÚ¡ 
ušt16_t
 
bšlog_gtid_Ën
 = 
bšlog_gtid
 ? 
	`¡¾’
(binlog_gtid) : 0;

4397 
	`rdb_Ãtbuf_¡Üe_ušt16
(
buf
 + 
·ck_Ën
, 
bšlog_gtid_Ën
);

4398 
·ck_Ën
 +ğ(
ušt16
);

4400 ià(
bšlog_gtid_Ën
 > 0) {

4402 
	`memıy
(
buf
 + 
·ck_Ën
, 
bšlog_gtid
, 
bšlog_gtid_Ën
);

4403 
·ck_Ën
 +ğ
bšlog_gtid_Ën
;

4406  
rocksdb
::
	`Sliû
((*)
buf
, 
·ck_Ën
);

4407 
	}
}

4417 
boŞ
 
	gRdb_bšlog_mªag”
::
	$uÅack_v®ue
(cÚ¡ 
uch¬
 *cÚ¡ 
v®ue
,

4418 *cÚ¡ 
bšlog_Çme
,

4419 
my_off_t
 *cÚ¡ 
bšlog_pos
,

4420 *cÚ¡ 
bšlog_gtid
) const {

4421 
ušt
 
·ck_Ën
 = 0;

4423 
	`DBUG_ASSERT
(
bšlog_pos
 !ğ
nuÎ±r
);

4426 cÚ¡ 
ušt16_t
 
v”siÚ
 = 
	`rdb_Ãtbuf_to_ušt16
(
v®ue
);

4427 
·ck_Ën
 +ğ
Rdb_key_def
::
VERSION_SIZE
;

4428 ià(
v”siÚ
 !ğ
Rdb_key_def
::
BINLOG_INFO_INDEX_NUMBER_VERSION
)

4429  
Œue
;

4432 cÚ¡ 
ušt16_t
 
bšlog_Çme_Ën
 = 
	`rdb_Ãtbuf_to_ušt16
(
v®ue
 + 
·ck_Ën
);

4433 
·ck_Ën
 +ğ(
ušt16
);

4434 ià(
bšlog_Çme_Ën
) {

4436 
	`memıy
(
bšlog_Çme
, 
v®ue
 + 
·ck_Ën
, 
bšlog_Çme_Ën
);

4437 
bšlog_Çme
[
bšlog_Çme_Ën
] = '\0';

4438 
·ck_Ën
 +ğ
bšlog_Çme_Ën
;

4441 *
bšlog_pos
 = 
	`rdb_Ãtbuf_to_ušt32
(
v®ue
 + 
·ck_Ën
);

4442 
·ck_Ën
 +ğ(
ušt32
);

4445 cÚ¡ 
ušt16_t
 
bšlog_gtid_Ën
 = 
	`rdb_Ãtbuf_to_ušt16
(
v®ue
 + 
·ck_Ën
);

4446 
·ck_Ën
 +ğ(
ušt16
);

4447 ià(
bšlog_gtid
 && 
bšlog_gtid_Ën
 > 0) {

4449 
	`memıy
(
bšlog_gtid
, 
v®ue
 + 
·ck_Ën
, 
bšlog_gtid_Ën
);

4450 
bšlog_gtid
[
bšlog_gtid_Ën
] = '\0';

4451 
·ck_Ën
 +ğ
bšlog_gtid_Ën
;

4454  
çl£
;

4455 
	}
}

4466 
	gRdb_bšlog_mªag”
::
	$upd©e_¦ave_gtid_šfo
(

4467 cÚ¡ 
ušt
 &
id
, cÚ¡ *cÚ¡ 
db
, cÚ¡ *cÚ¡ 
gtid
,

4468 
rocksdb
::
Wr™eB©chBa£
 *cÚ¡ 
wr™e_b©ch
) {

4469 ià(
id
 && 
db
 && 
gtid
) {

4472 ià(!
m_¦ave_gtid_šfo_tbl
.
	`lßd
()) {

4473 
m_¦ave_gtid_šfo_tbl
.
	`¡Üe
(

4474 
	`rdb_g‘_ddl_mªag”
()->
	`fšd
("mysql.slave_gtid_info"));

4476 ià(!
m_¦ave_gtid_šfo_tbl
.
	`lßd
()) {

4480 
	`DBUG_ASSERT
(
m_¦ave_gtid_šfo_tbl
.
	`lßd
()->
m_key_couÁ
 == 1);

4482 cÚ¡ 
¡d
::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
> &
kd
 =

4483 
m_¦ave_gtid_šfo_tbl
.
	`lßd
()->
m_key_desü_¬r
[0];

4484 
SŒšg
 
v®ue
;

4487 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 + 4] = {0};

4488 
uch¬
 *
buf
 = 
key_buf
;

4489 
	`rdb_Ãtbuf_¡Üe_šdex
(
buf
, 
kd
->
	`g‘_šdex_numb”
());

4490 
buf
 +ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
;

4491 
	`rdb_Ãtbuf_¡Üe_ušt32
(
buf
, 
id
);

4492 
buf
 += 4;

4493 cÚ¡ 
rocksdb
::
Sliû
 
key_¦iû
 =

4494 
rocksdb
::
	`Sliû
((cÚ¡ *)
key_buf
, 
buf
 - key_buf);

4497 
uch¬
 
v®ue_buf
[128] = {0};

4498 
	`DBUG_ASSERT
(
gtid
);

4499 cÚ¡ 
ušt
 
db_Ën
 = 
	`¡¾’
(
db
);

4500 cÚ¡ 
ušt
 
gtid_Ën
 = 
	`¡¾’
(
gtid
);

4501 
buf
 = 
v®ue_buf
;

4503 
buf
++;

4506 
	`DBUG_ASSERT
(
	`¡¾’
(
db
) <= 64);

4507 
	`rdb_Ãtbuf_¡Üe_by‹
(
buf
, 
db_Ën
);

4508 
buf
++;

4509 
	`memıy
(
buf
, 
db
, 
db_Ën
);

4510 
buf
 +ğ
db_Ën
;

4513 
	`DBUG_ASSERT
(
gtid_Ën
 <= 56);

4514 
	`rdb_Ãtbuf_¡Üe_by‹
(
buf
, 
gtid_Ën
);

4515 
buf
++;

4516 
	`memıy
(
buf
, 
gtid
, 
gtid_Ën
);

4517 
buf
 +ğ
gtid_Ën
;

4518 cÚ¡ 
rocksdb
::
Sliû
 
v®ue_¦iû
 =

4519 
rocksdb
::
	`Sliû
((cÚ¡ *)
v®ue_buf
, 
buf
 - value_buf);

4521 
wr™e_b©ch
->
	`Put
(
kd
->
	`g‘_cf
(), 
key_¦iû
, 
v®ue_¦iû
);

4523 
	}
}

4525 
boŞ
 
	gRdb_diù_mªag”
::
	$š™
(
rocksdb
::
T¿n§ùiÚDB
 *cÚ¡ 
rdb_diù
,

4526 
Rdb_cf_mªag”
 *cÚ¡ 
cf_mªag”
) {

4527 
	`DBUG_ASSERT
(
rdb_diù
 !ğ
nuÎ±r
);

4528 
	`DBUG_ASSERT
(
cf_mªag”
 !ğ
nuÎ±r
);

4530 
	`mysql_mu‹x_š™
(0, &
m_mu‹x
, 
MY_MUTEX_INIT_FAST
);

4532 
m_db
 = 
rdb_diù
;

4534 
m_sy¡em_cfh
 = 
cf_mªag”
->
	`g‘_Ü_ü—‹_cf
(
m_db
, 
DEFAULT_SYSTEM_CF_NAME
);

4535 
rocksdb
::
CŞumnFamyHªdË
 *
deçuÉ_cfh
 =

4536 
cf_mªag”
->
	`g‘_cf
(
DEFAULT_CF_NAME
);

4539 ià(
m_sy¡em_cfh
 =ğ
nuÎ±r
 || 
deçuÉ_cfh
 ==‚ullptr) {

4540  
HA_EXIT_FAILURE
;

4543 
	`rdb_Ãtbuf_¡Üe_šdex
(
m_key_buf_max_šdex_id
, 
Rdb_key_def
::
MAX_INDEX_ID
);

4545 
m_key_¦iû_max_šdex_id
 =

4546 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
m_key_buf_max_šdex_id
),

4547 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

4549 
	`»sume_drİ_šdexes
();

4550 
	`rŞlback_Úgošg_šdex_ü—tiÚ
();

4553 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
	`begš
();

4554 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
	`g‘
();

4556 
	`add_cf_æags
(
b©ch
, 
m_sy¡em_cfh
->
	`G‘ID
(), 0);

4557 
	`add_cf_æags
(
b©ch
, 
deçuÉ_cfh
->
	`G‘ID
(), 0);

4558 
	`comm™
(
b©ch
);

4560  
HA_EXIT_SUCCESS
;

4561 
	}
}

4563 
	g¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
Rdb_diù_mªag”
::
	$begš
() const {

4564  
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
>(
Ãw
„ocksdb::WriteBatch);

4565 
	}
}

4567 
	gRdb_diù_mªag”
::
	$put_key
(
rocksdb
::
Wr™eB©chBa£
 *cÚ¡ 
b©ch
,

4568 cÚ¡ 
rocksdb
::
Sliû
 &
key
,

4569 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
) const {

4570 
b©ch
->
	`Put
(
m_sy¡em_cfh
, 
key
, 
v®ue
);

4571 
	}
}

4573 
	grocksdb
::
Stus
 
Rdb_diù_mªag”
::
	$g‘_v®ue
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

4574 
¡d
::
¡ršg
 *cÚ¡ 
v®ue
) const {

4575 
rocksdb
::
R—dO±iÚs
 
İtiÚs
;

4576 
İtiÚs
.
tÙ®_Üd”_£ek
 = 
Œue
;

4577  
m_db
->
	`G‘
(
İtiÚs
, 
m_sy¡em_cfh
, 
key
, 
v®ue
);

4578 
	}
}

4580 
	gRdb_diù_mªag”
::
	$d–‘e_key
(
rocksdb
::
Wr™eB©chBa£
 *
b©ch
,

4581 cÚ¡ 
rocksdb
::
Sliû
 &
key
) const {

4582 
b©ch
->
	`D–‘e
(
m_sy¡em_cfh
, 
key
);

4583 
	}
}

4585 
	grocksdb
::
I‹¿tÜ
 *
Rdb_diù_mªag”
::
	$Ãw_™”©Ü
() const {

4587 
rocksdb
::
R—dO±iÚs
 
»ad_İtiÚs
;

4588 
»ad_İtiÚs
.
tÙ®_Üd”_£ek
 = 
Œue
;

4589  
m_db
->
	`NewI‹¿tÜ
(
»ad_İtiÚs
, 
m_sy¡em_cfh
);

4590 
	}
}

4592 
	gRdb_diù_mªag”
::
	$comm™
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

4593 cÚ¡ 
boŞ
 &
sync
) const {

4594 ià(!
b©ch
)

4595  
HA_ERR_ROCKSDB_COMMIT_FAILED
;

4596 
»s
 = 
HA_EXIT_SUCCESS
;

4597 
rocksdb
::
Wr™eO±iÚs
 
İtiÚs
;

4598 
İtiÚs
.
sync
 = sync;

4599 
rocksdb
::
T¿n§ùiÚDBWr™eO±imiz©iÚs
 
İtimize
;

4600 
İtimize
.
sk_cÚcu¼’cy_cÚŒŞ
 = 
Œue
;

4601 
rocksdb
::
Stus
 
s
 = 
m_db
->
	`Wr™e
(
İtiÚs
, 
İtimize
, 
b©ch
);

4602 
»s
 = !
s
.
	`ok
();

4603 ià(
»s
) {

4604 
	`rdb_hªdË_io_”rÜ
(
s
, 
RDB_IO_ERROR_DICT_COMMIT
);

4606 
b©ch
->
	`CË¬
();

4607  
»s
;

4608 
	}
}

4610 
	gRdb_diù_mªag”
::
	$dump_šdex_id
(
uch¬
 *cÚ¡ 
Ãtbuf
,

4611 
Rdb_key_def
::
DATA_DICT_TYPE
 
diù_ty³
,

4612 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) {

4613 
	`rdb_Ãtbuf_¡Üe_ušt32
(
Ãtbuf
, 
diù_ty³
);

4614 
	`rdb_Ãtbuf_¡Üe_ušt32
(
Ãtbuf
 + 
Rdb_key_def
::
INDEX_NUMBER_SIZE
,

4615 
gl_šdex_id
.
cf_id
);

4616 
	`rdb_Ãtbuf_¡Üe_ušt32
(
Ãtbuf
 + 2 * 
Rdb_key_def
::
INDEX_NUMBER_SIZE
,

4617 
gl_šdex_id
.
šdex_id
);

4618 
	}
}

4620 
	gRdb_diù_mªag”
::
	$d–‘e_w™h_´efix
(

4621 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
, 
Rdb_key_def
::
DATA_DICT_TYPE
 
diù_ty³
,

4622 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) const {

4623 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

4624 
	`dump_šdex_id
(
key_buf
, 
diù_ty³
, 
gl_šdex_id
);

4625 
rocksdb
::
Sliû
 
key
 =„ocksdb::
	`Sliû
((*)
key_buf
, (key_buf));

4627 
	`d–‘e_key
(
b©ch
, 
key
);

4628 
	}
}

4630 
	gRdb_diù_mªag”
::
	$add_Ü_upd©e_šdex_cf_m­pšg
(

4631 
rocksdb
::
Wr™eB©ch
 *
b©ch
, 
Rdb_šdex_šfo
 *cÚ¡ 
šdex_šfo
) const {

4632 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

4633 
uch¬
 
v®ue_buf
[256] = {0};

4634 
	`dump_šdex_id
(
key_buf
, 
Rdb_key_def
::
INDEX_INFO
, 
šdex_šfo
->
m_gl_šdex_id
);

4635 cÚ¡ 
rocksdb
::
Sliû
 
key
 =„ocksdb::
	`Sliû
((*)
key_buf
, (key_buf));

4637 
uch¬
 *
±r
 = 
v®ue_buf
;

4638 
	`rdb_Ãtbuf_¡Üe_ušt16
(
±r
, 
Rdb_key_def
::
INDEX_INFO_VERSION_LATEST
);

4639 
±r
 +ğ
RDB_SIZEOF_INDEX_INFO_VERSION
;

4640 
	`rdb_Ãtbuf_¡Üe_by‹
(
±r
, 
šdex_šfo
->
m_šdex_ty³
);

4641 
±r
 +ğ
RDB_SIZEOF_INDEX_TYPE
;

4642 
	`rdb_Ãtbuf_¡Üe_ušt16
(
±r
, 
šdex_šfo
->
m_kv_v”siÚ
);

4643 
±r
 +ğ
RDB_SIZEOF_KV_VERSION
;

4644 
	`rdb_Ãtbuf_¡Üe_ušt32
(
±r
, 
šdex_šfo
->
m_šdex_æags
);

4645 
±r
 +ğ
RDB_SIZEOF_INDEX_FLAGS
;

4646 
	`rdb_Ãtbuf_¡Üe_ušt64
(
±r
, 
šdex_šfo
->
m_‰l_du¿tiÚ
);

4647 
±r
 +ğ
ROCKSDB_SIZEOF_TTL_RECORD
;

4649 cÚ¡ 
rocksdb
::
Sliû
 
v®ue
 =

4650 
rocksdb
::
	`Sliû
((*)
v®ue_buf
, 
±r
 - value_buf);

4651 
b©ch
->
	`Put
(
m_sy¡em_cfh
, 
key
, 
v®ue
);

4652 
	}
}

4654 
	gRdb_diù_mªag”
::
	$add_cf_æags
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

4655 cÚ¡ 
ušt32_t
 &
cf_id
,

4656 cÚ¡ 
ušt32_t
 &
cf_æags
) const {

4657 
	`DBUG_ASSERT
(
b©ch
 !ğ
nuÎ±r
);

4659 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2] = {0};

4660 
uch¬
 
v®ue_buf
[
Rdb_key_def
::
VERSION_SIZE
 + Rdb_key_def::
INDEX_NUMBER_SIZE
] =

4662 
	`rdb_Ãtbuf_¡Üe_ušt32
(
key_buf
, 
Rdb_key_def
::
CF_DEFINITION
);

4663 
	`rdb_Ãtbuf_¡Üe_ušt32
(
key_buf
 + 
Rdb_key_def
::
INDEX_NUMBER_SIZE
, 
cf_id
);

4664 cÚ¡ 
rocksdb
::
Sliû
 
key
 =„ocksdb::
	`Sliû
((*)
key_buf
, (key_buf));

4666 
	`rdb_Ãtbuf_¡Üe_ušt16
(
v®ue_buf
, 
Rdb_key_def
::
CF_DEFINITION_VERSION
);

4667 
	`rdb_Ãtbuf_¡Üe_ušt32
(
v®ue_buf
 + 
Rdb_key_def
::
VERSION_SIZE
, 
cf_æags
);

4668 cÚ¡ 
rocksdb
::
Sliû
 
v®ue
 =

4669 
rocksdb
::
	`Sliû
((*)
v®ue_buf
, (value_buf));

4670 
b©ch
->
	`Put
(
m_sy¡em_cfh
, 
key
, 
v®ue
);

4671 
	}
}

4673 
	gRdb_diù_mªag”
::
	$d–‘e_šdex_šfo
(
rocksdb
::
Wr™eB©ch
 *
b©ch
,

4674 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) const {

4675 
	`d–‘e_w™h_´efix
(
b©ch
, 
Rdb_key_def
::
INDEX_INFO
, 
gl_šdex_id
);

4676 
	`d–‘e_w™h_´efix
(
b©ch
, 
Rdb_key_def
::
INDEX_STATISTICS
, 
gl_šdex_id
);

4677 
	`d–‘e_w™h_´efix
(
b©ch
, 
Rdb_key_def
::
AUTO_INC
, 
gl_šdex_id
);

4678 
	}
}

4680 
boŞ
 
	gRdb_diù_mªag”
::
	$g‘_šdex_šfo
(

4681 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

4682 
Rdb_šdex_šfo
 *cÚ¡ 
šdex_šfo
) const {

4684 ià(
šdex_šfo
) {

4685 
šdex_šfo
->
m_gl_šdex_id
 = 
gl_šdex_id
;

4688 
boŞ
 
found
 = 
çl£
;

4689 
boŞ
 
”rÜ
 = 
çl£
;

4690 
¡d
::
¡ršg
 
v®ue
;

4691 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

4692 
	`dump_šdex_id
(
key_buf
, 
Rdb_key_def
::
INDEX_INFO
, 
gl_šdex_id
);

4693 cÚ¡ 
rocksdb
::
Sliû
 &
key
 =„ocksdb::
	`Sliû
((*)
key_buf
, (key_buf));

4695 cÚ¡ 
rocksdb
::
Stus
 &
¡©us
 = 
	`g‘_v®ue
(
key
, &
v®ue
);

4696 ià(
¡©us
.
	`ok
()) {

4697 ià(!
šdex_šfo
) {

4698  
Œue
;

4701 cÚ¡ 
uch¬
 *cÚ¡ 
v®
 = (cÚ¡ uch¬ *)
v®ue
.
	`c_¡r
();

4702 cÚ¡ 
uch¬
 *
±r
 = 
v®
;

4703 
šdex_šfo
->
m_šdex_diù_v”siÚ
 = 
	`rdb_Ãtbuf_to_ušt16
(
v®
);

4704 
±r
 +ğ
RDB_SIZEOF_INDEX_INFO_VERSION
;

4706 
šdex_šfo
->
m_šdex_diù_v”siÚ
) {

4707 
Rdb_key_def
::
INDEX_INFO_VERSION_FIELD_FLAGS
:

4709 ià(
v®ue
.
	`size
(è!ğ
RDB_SIZEOF_INDEX_INFO_VERSION
 +

4710 
RDB_SIZEOF_INDEX_TYPE
 + 
RDB_SIZEOF_KV_VERSION
 +

4711 
RDB_SIZEOF_INDEX_FLAGS
 +

4712 
ROCKSDB_SIZEOF_TTL_RECORD
) {

4713 
”rÜ
 = 
Œue
;

4716 
šdex_šfo
->
m_šdex_ty³
 = 
	`rdb_Ãtbuf_to_by‹
(
±r
);

4717 
±r
 +ğ
RDB_SIZEOF_INDEX_TYPE
;

4718 
šdex_šfo
->
m_kv_v”siÚ
 = 
	`rdb_Ãtbuf_to_ušt16
(
±r
);

4719 
±r
 +ğ
RDB_SIZEOF_KV_VERSION
;

4720 
šdex_šfo
->
m_šdex_æags
 = 
	`rdb_Ãtbuf_to_ušt32
(
±r
);

4721 
±r
 +ğ
RDB_SIZEOF_INDEX_FLAGS
;

4722 
šdex_šfo
->
m_‰l_du¿tiÚ
 = 
	`rdb_Ãtbuf_to_ušt64
(
±r
);

4723 
found
 = 
Œue
;

4726 
Rdb_key_def
::
INDEX_INFO_VERSION_TTL
:

4728 ià(
v®ue
.
	`size
(è!ğ
RDB_SIZEOF_INDEX_INFO_VERSION
 +

4729 
RDB_SIZEOF_INDEX_TYPE
 + 
RDB_SIZEOF_KV_VERSION
 +

4730 
ROCKSDB_SIZEOF_TTL_RECORD
) {

4731 
”rÜ
 = 
Œue
;

4734 
šdex_šfo
->
m_šdex_ty³
 = 
	`rdb_Ãtbuf_to_by‹
(
±r
);

4735 
±r
 +ğ
RDB_SIZEOF_INDEX_TYPE
;

4736 
šdex_šfo
->
m_kv_v”siÚ
 = 
	`rdb_Ãtbuf_to_ušt16
(
±r
);

4737 
±r
 +ğ
RDB_SIZEOF_KV_VERSION
;

4738 
šdex_šfo
->
m_‰l_du¿tiÚ
 = 
	`rdb_Ãtbuf_to_ušt64
(
±r
);

4739 ià((
šdex_šfo
->
m_kv_v”siÚ
 ==

4740 
Rdb_key_def
::
PRIMARY_FORMAT_VERSION_TTL
) &&

4741 
šdex_šfo
->
m_‰l_du¿tiÚ
 > 0) {

4742 
šdex_šfo
->
m_šdex_æags
 = 
Rdb_key_def
::
TTL_FLAG
;

4744 
found
 = 
Œue
;

4747 
Rdb_key_def
::
INDEX_INFO_VERSION_VERIFY_KV_FORMAT
:

4748 
Rdb_key_def
::
INDEX_INFO_VERSION_GLOBAL_ID
:

4749 
šdex_šfo
->
m_šdex_ty³
 = 
	`rdb_Ãtbuf_to_by‹
(
±r
);

4750 
±r
 +ğ
RDB_SIZEOF_INDEX_TYPE
;

4751 
šdex_šfo
->
m_kv_v”siÚ
 = 
	`rdb_Ãtbuf_to_ušt16
(
±r
);

4752 
found
 = 
Œue
;

4756 
”rÜ
 = 
Œue
;

4760 
šdex_šfo
->
m_šdex_ty³
) {

4761 
Rdb_key_def
::
INDEX_TYPE_PRIMARY
:

4762 
Rdb_key_def
::
INDEX_TYPE_HIDDEN_PRIMARY
: {

4763 
”rÜ
 =

4764 
šdex_šfo
->
m_kv_v”siÚ
 > 
Rdb_key_def
::
PRIMARY_FORMAT_VERSION_LATEST
;

4767 
Rdb_key_def
::
INDEX_TYPE_SECONDARY
:

4768 
”rÜ
 = 
šdex_šfo
->
m_kv_v”siÚ
 >

4769 
Rdb_key_def
::
SECONDARY_FORMAT_VERSION_LATEST
;

4772 
”rÜ
 = 
Œue
;

4777 ià(
”rÜ
) {

4779 
	`sql_´št_”rÜ
(

4783 
šdex_šfo
->
m_šdex_diù_v”siÚ
, index_šfo->
m_šdex_ty³
,

4784 
šdex_šfo
->
m_kv_v”siÚ
, index_šfo->
m_‰l_du¿tiÚ
);

4785 
	`abÜt
();

4788  
found
;

4789 
	}
}

4791 
boŞ
 
	gRdb_diù_mªag”
::
	$g‘_cf_æags
(cÚ¡ 
ušt32_t
 &
cf_id
,

4792 
ušt32_t
 *cÚ¡ 
cf_æags
) const {

4793 
	`DBUG_ASSERT
(
cf_æags
 !ğ
nuÎ±r
);

4795 
boŞ
 
found
 = 
çl£
;

4796 
¡d
::
¡ršg
 
v®ue
;

4797 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 2] = {0};

4799 
	`rdb_Ãtbuf_¡Üe_ušt32
(
key_buf
, 
Rdb_key_def
::
CF_DEFINITION
);

4800 
	`rdb_Ãtbuf_¡Üe_ušt32
(
key_buf
 + 
Rdb_key_def
::
INDEX_NUMBER_SIZE
, 
cf_id
);

4802 cÚ¡ 
rocksdb
::
Sliû
 
key
 =

4803 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
key_buf
), (key_buf));

4804 cÚ¡ 
rocksdb
::
Stus
 
¡©us
 = 
	`g‘_v®ue
(
key
, &
v®ue
);

4806 ià(
¡©us
.
	`ok
()) {

4807 cÚ¡ 
uch¬
 *
v®
 = (cÚ¡ uch¬ *)
v®ue
.
	`c_¡r
();

4808 
	`DBUG_ASSERT
(
v®
);

4810 cÚ¡ 
ušt16_t
 
v”siÚ
 = 
	`rdb_Ãtbuf_to_ušt16
(
v®
);

4812 ià(
v”siÚ
 =ğ
Rdb_key_def
::
CF_DEFINITION_VERSION
) {

4813 *
cf_æags
 = 
	`rdb_Ãtbuf_to_ušt32
(
v®
 + 
Rdb_key_def
::
VERSION_SIZE
);

4814 
found
 = 
Œue
;

4818  
found
;

4819 
	}
}

4826 
	gRdb_diù_mªag”
::
g‘_Úgošg_šdex_İ”©iÚ
(

4827 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> *
gl_šdex_ids
,

4828 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const {

4829 
DBUG_ASSERT
(
dd_ty³
 =ğ
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
 ||

4830 
dd_ty³
 =ğ
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

4832 
uch¬
 
	gšdex_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
];

4833 
rdb_Ãtbuf_¡Üe_ušt32
(
šdex_buf
, 
dd_ty³
);

4834 cÚ¡ 
	grocksdb
::
Sliû
 
šdex_¦iû
(
»š‹½»t_ÿ¡
<*>(
šdex_buf
),

4835 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

4837 
	grocksdb
::
I‹¿tÜ
 *
™
 = 
Ãw_™”©Ü
();

4838 
	g™
->
S“k
(
šdex_¦iû
); it->
V®id
(); it->
Next
()) {

4839 
	grocksdb
::
Sliû
 
key
 = 
™
->key();

4840 cÚ¡ 
uch¬
 *cÚ¡ 
	g±r
 = (cÚ¡ uch¬ *)
key
.
d©a
();

4849 ià(
	gkey
.
size
(è!ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3 ||

4850 
rdb_Ãtbuf_to_ušt32
(
±r
è!ğ
dd_ty³
) {

4857 
GL_INDEX_ID
 
	ggl_šdex_id
;

4858 
	ggl_šdex_id
.
	gcf_id
 =

4859 
rdb_Ãtbuf_to_ušt32
(
±r
 + 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

4860 
	ggl_šdex_id
.
	gšdex_id
 =

4861 
rdb_Ãtbuf_to_ušt32
(
±r
 + 2 * 
Rdb_key_def
::
INDEX_NUMBER_SIZE
);

4862 
	ggl_šdex_ids
->
š£¹
(
gl_šdex_id
);

4864 
d–‘e
 
	g™
;

4872 
boŞ
 
	gRdb_diù_mªag”
::
	$is_šdex_İ”©iÚ_Úgošg
(

4873 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
, 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const {

4874 
	`DBUG_ASSERT
(
dd_ty³
 =ğ
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
 ||

4875 
dd_ty³
 =ğ
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

4877 
boŞ
 
found
 = 
çl£
;

4878 
¡d
::
¡ršg
 
v®ue
;

4879 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

4880 
	`dump_šdex_id
(
key_buf
, 
dd_ty³
, 
gl_šdex_id
);

4881 cÚ¡ 
rocksdb
::
Sliû
 
key
 =„ocksdb::
	`Sliû
((*)
key_buf
, (key_buf));

4883 cÚ¡ 
rocksdb
::
Stus
 
¡©us
 = 
	`g‘_v®ue
(
key
, &
v®ue
);

4884 ià(
¡©us
.
	`ok
()) {

4885 
found
 = 
Œue
;

4887  
found
;

4888 
	}
}

4894 
	gRdb_diù_mªag”
::
	$¡¬t_Úgošg_šdex_İ”©iÚ
(

4895 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
, cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

4896 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const {

4897 
	`DBUG_ASSERT
(
dd_ty³
 =ğ
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
 ||

4898 
dd_ty³
 =ğ
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

4900 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

4901 
uch¬
 
v®ue_buf
[
Rdb_key_def
::
VERSION_SIZE
] = {0};

4902 
	`dump_šdex_id
(
key_buf
, 
dd_ty³
, 
gl_šdex_id
);

4905 ià(
dd_ty³
 =ğ
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
) {

4906 
	`rdb_Ãtbuf_¡Üe_ušt16
(
v®ue_buf
,

4907 
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING_VERSION
);

4909 
	`rdb_Ãtbuf_¡Üe_ušt16
(
v®ue_buf
,

4910 
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING_VERSION
);

4913 cÚ¡ 
rocksdb
::
Sliû
 
key
 =„ocksdb::
	`Sliû
((*)
key_buf
, (key_buf));

4914 cÚ¡ 
rocksdb
::
Sliû
 
v®ue
 =

4915 
rocksdb
::
	`Sliû
((*)
v®ue_buf
, (value_buf));

4916 
b©ch
->
	`Put
(
m_sy¡em_cfh
, 
key
, 
v®ue
);

4917 
	}
}

4923 
	gRdb_diù_mªag”
::
	$’d_Úgošg_šdex_İ”©iÚ
(

4924 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
, cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

4925 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const {

4926 
	`DBUG_ASSERT
(
dd_ty³
 =ğ
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
 ||

4927 
dd_ty³
 =ğ
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

4929 
	`d–‘e_w™h_´efix
(
b©ch
, 
dd_ty³
, 
gl_šdex_id
);

4930 
	}
}

4936 
boŞ
 
	gRdb_diù_mªag”
::
	$is_drİ_šdex_em±y
() const {

4937 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
gl_šdex_ids
;

4938 
	`g‘_Úgošg_drİ_šdexes
(&
gl_šdex_ids
);

4939  
gl_šdex_ids
.
	`em±y
();

4940 
	}
}

4947 
	gRdb_diù_mªag”
::
add_drİ_bË
(

4948 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
key_desü
, cÚ¡ 
ušt32
 &
n_keys
,

4949 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
) const {

4950 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
drİ³d_šdex_ids
;

4951 
ušt32
 
	gi
 = 0; i < 
	gn_keys
; i++) {

4952 
	gdrİ³d_šdex_ids
.
š£¹
(
key_desü
[
i
]->
g‘_gl_šdex_id
());

4955 
add_drİ_šdex
(
drİ³d_šdex_ids
, 
b©ch
);

4963 
	gRdb_diù_mªag”
::
add_drİ_šdex
(

4964 cÚ¡ 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> &
gl_šdex_ids
,

4965 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
) const {

4966 cÚ¡‡utØ&
gl_šdex_id
 : 
gl_šdex_ids
) {

4967 
log_¡¬t_drİ_šdex
(
gl_šdex_id
, "Begin");

4968 
¡¬t_drİ_šdex
(
b©ch
, 
gl_šdex_id
);

4977 
	gRdb_diù_mªag”
::
add_ü—‹_šdex
(

4978 cÚ¡ 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> &
gl_šdex_ids
,

4979 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
) const {

4980 cÚ¡‡utØ&
gl_šdex_id
 : 
gl_šdex_ids
) {

4982 
sql_´št_šfÜm©iÚ
("RocksDB: Begin index creation (%u,%u)",

4983 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
);

4984 
¡¬t_ü—‹_šdex
(
b©ch
, 
gl_šdex_id
);

4992 
	gRdb_diù_mªag”
::
fšish_šdexes_İ”©iÚ
(

4993 cÚ¡ 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> &
gl_šdex_ids
,

4994 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const {

4995 
DBUG_ASSERT
(
dd_ty³
 =ğ
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
 ||

4996 
dd_ty³
 =ğ
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

4998 cÚ¡ 
	g¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
begš
();

4999 
	grocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
g‘
();

5001 
	g¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
šcom¶‘e_ü—‹_šdexes
;

5002 
g‘_Úgošg_ü—‹_šdexes
(&
šcom¶‘e_ü—‹_šdexes
);

5004 cÚ¡‡utØ&
	ggl_šdex_id
 : 
gl_šdex_ids
) {

5005 ià(
is_šdex_İ”©iÚ_Úgošg
(
gl_šdex_id
, 
dd_ty³
)) {

5006 
’d_Úgošg_šdex_İ”©iÚ
(
b©ch
, 
gl_šdex_id
, 
dd_ty³
);

5012 ià(
	gdd_ty³
 =ğ
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
) {

5013 ià(
šcom¶‘e_ü—‹_šdexes
.
couÁ
(
gl_šdex_id
)) {

5014 
’d_Úgošg_šdex_İ”©iÚ
(
b©ch
, 
gl_šdex_id
,

5015 
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

5020 ià(
	gdd_ty³
 =ğ
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
) {

5021 
d–‘e_šdex_šfo
(
b©ch
, 
gl_šdex_id
);

5024 
comm™
(
b©ch
);

5032 
	gRdb_diù_mªag”
::
	$»sume_drİ_šdexes
() const {

5033 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
gl_šdex_ids
;

5034 
	`g‘_Úgošg_drİ_šdexes
(&
gl_šdex_ids
);

5036 
ušt
 
max_šdex_id_š_diù
 = 0;

5037 
	`g‘_max_šdex_id
(&
max_šdex_id_š_diù
);

5039 cÚ¡‡utØ&
gl_šdex_id
 : 
gl_šdex_ids
) {

5040 
	`log_¡¬t_drİ_šdex
(
gl_šdex_id
, "Resume");

5041 ià(
max_šdex_id_š_diù
 < 
gl_šdex_id
.
šdex_id
) {

5042 
	`sql_´št_”rÜ
("RocksDB: Found max index id %u from data dictionary "

5046 
max_šdex_id_š_diù
, 
gl_šdex_id
.
cf_id
,

5047 
gl_šdex_id
.
šdex_id
);

5048 
	`abÜt
();

5051 
	}
}

5053 
	gRdb_diù_mªag”
::
	$rŞlback_Úgošg_šdex_ü—tiÚ
() const {

5054 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
	`begš
();

5055 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
	`g‘
();

5057 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
gl_šdex_ids
;

5058 
	`g‘_Úgošg_ü—‹_šdexes
(&
gl_šdex_ids
);

5060 cÚ¡‡utØ&
gl_šdex_id
 : 
gl_šdex_ids
) {

5062 
	`sql_´št_šfÜm©iÚ
("RocksDB: Removing incomplete create index (%u,%u)",

5063 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
);

5065 
	`¡¬t_drİ_šdex
(
b©ch
, 
gl_šdex_id
);

5068 
	`comm™
(
b©ch
);

5069 
	}
}

5071 
	gRdb_diù_mªag”
::
log_¡¬t_drİ_bË
(

5072 cÚ¡ 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
key_desü
, cÚ¡ 
ušt32
 &
n_keys
,

5073 cÚ¡ *cÚ¡ 
log_aùiÚ
) const {

5074 
ušt32
 
	gi
 = 0; i < 
	gn_keys
; i++) {

5075 
log_¡¬t_drİ_šdex
(
key_desü
[
i
]->
g‘_gl_šdex_id
(), 
log_aùiÚ
);

5079 
	gRdb_diù_mªag”
::
	$log_¡¬t_drİ_šdex
(
GL_INDEX_ID
 
gl_šdex_id
,

5080 cÚ¡ *
log_aùiÚ
) const {

5081 
Rdb_šdex_šfo
 
šdex_šfo
;

5082 ià(!
	`g‘_šdex_šfo
(
gl_šdex_id
, &
šdex_šfo
)) {

5088 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
šcom¶‘e_ü—‹_šdexes
;

5089 
	`g‘_Úgošg_ü—‹_šdexes
(&
šcom¶‘e_ü—‹_šdexes
);

5091 ià(!
šcom¶‘e_ü—‹_šdexes
.
	`couÁ
(
gl_šdex_id
)) {

5093 
	`sql_´št_”rÜ
("RocksDB: Failedo get column family info "

5096 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
);

5097 
	`abÜt
();

5100 
	}
}

5102 
boŞ
 
	gRdb_diù_mªag”
::
	$g‘_max_šdex_id
(
ušt32_t
 *cÚ¡ 
šdex_id
) const {

5103 
boŞ
 
found
 = 
çl£
;

5104 
¡d
::
¡ršg
 
v®ue
;

5106 cÚ¡ 
rocksdb
::
Stus
 
¡©us
 = 
	`g‘_v®ue
(
m_key_¦iû_max_šdex_id
, &
v®ue
);

5107 ià(
¡©us
.
	`ok
()) {

5108 cÚ¡ 
uch¬
 *cÚ¡ 
v®
 = (cÚ¡ uch¬ *)
v®ue
.
	`c_¡r
();

5109 cÚ¡ 
ušt16_t
 &
v”siÚ
 = 
	`rdb_Ãtbuf_to_ušt16
(
v®
);

5110 ià(
v”siÚ
 =ğ
Rdb_key_def
::
MAX_INDEX_ID_VERSION
) {

5111 *
šdex_id
 = 
	`rdb_Ãtbuf_to_ušt32
(
v®
 + 
Rdb_key_def
::
VERSION_SIZE
);

5112 
found
 = 
Œue
;

5115  
found
;

5116 
	}
}

5118 
boŞ
 
	gRdb_diù_mªag”
::
	$upd©e_max_šdex_id
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

5119 cÚ¡ 
ušt32_t
 &
šdex_id
) const {

5120 
	`DBUG_ASSERT
(
b©ch
 !ğ
nuÎ±r
);

5122 
ušt32_t
 
Şd_šdex_id
 = -1;

5123 ià(
	`g‘_max_šdex_id
(&
Şd_šdex_id
)) {

5124 ià(
Şd_šdex_id
 > 
šdex_id
) {

5125 
	`sql_´št_”rÜ
("RocksDB: Found max index id %u from data dictionary "

5128 
Şd_šdex_id
, 
šdex_id
);

5129  
Œue
;

5133 
uch¬
 
v®ue_buf
[
Rdb_key_def
::
VERSION_SIZE
 + Rdb_key_def::
INDEX_NUMBER_SIZE
] =

5135 
	`rdb_Ãtbuf_¡Üe_ušt16
(
v®ue_buf
, 
Rdb_key_def
::
MAX_INDEX_ID_VERSION
);

5136 
	`rdb_Ãtbuf_¡Üe_ušt32
(
v®ue_buf
 + 
Rdb_key_def
::
VERSION_SIZE
, 
šdex_id
);

5137 cÚ¡ 
rocksdb
::
Sliû
 
v®ue
 =

5138 
rocksdb
::
	`Sliû
((*)
v®ue_buf
, (value_buf));

5139 
b©ch
->
	`Put
(
m_sy¡em_cfh
, 
m_key_¦iû_max_šdex_id
, 
v®ue
);

5140  
çl£
;

5141 
	}
}

5143 
	gRdb_diù_mªag”
::
add_¡©s
(

5144 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

5145 cÚ¡ 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> &
¡©s
) const {

5146 
DBUG_ASSERT
(
b©ch
 !ğ
nuÎ±r
);

5148 cÚ¡‡utØ&
	g™
 : 
¡©s
) {

5149 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

5150 
dump_šdex_id
(
key_buf
, 
Rdb_key_def
::
INDEX_STATISTICS
, 
™
.
m_gl_šdex_id
);

5154 cÚ¡‡utØ
	gv®ue
 =

5155 
Rdb_šdex_¡©s
::
m©”Ÿlize
(
¡d
::
veùÜ
<Rdb_šdex_¡©s>{
™
});

5157 
	gb©ch
->
Put
(
m_sy¡em_cfh
, 
rocksdb
::
Sliû
((*)
key_buf
, (key_buf)),

5158 
v®ue
);

5162 
Rdb_šdex_¡©s
 
	gRdb_diù_mªag”
::
	$g‘_¡©s
(
GL_INDEX_ID
 
gl_šdex_id
) const {

5163 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

5164 
	`dump_šdex_id
(
key_buf
, 
Rdb_key_def
::
INDEX_STATISTICS
, 
gl_šdex_id
);

5166 
¡d
::
¡ršg
 
v®ue
;

5167 cÚ¡ 
rocksdb
::
Stus
 
¡©us
 = 
	`g‘_v®ue
(

5168 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
key_buf
), (key_buf)),

5169 &
v®ue
);

5170 ià(
¡©us
.
	`ok
()) {

5171 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> 
v
;

5173 ià(
Rdb_šdex_¡©s
::
	`unm©”Ÿlize
(
v®ue
, &
v
è=ğ0 && v.
	`size
() == 1) {

5174  
v
[0];

5178  
	`Rdb_šdex_¡©s
();

5179 
	}
}

5181 
	grocksdb
::
Stus


5182 
Rdb_diù_mªag”
::
	$put_auto_šü_v®
(
rocksdb
::
Wr™eB©chBa£
 *
b©ch
,

5183 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

5184 
ulÚglÚg
 
v®
, 
boŞ
 
ov”wr™e
) const {

5185 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

5186 
	`dump_šdex_id
(
key_buf
, 
Rdb_key_def
::
AUTO_INC
, 
gl_šdex_id
);

5187 cÚ¡ 
rocksdb
::
Sliû
 
key
 =

5188 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
key_buf
), (key_buf));

5191 
uch¬
 
v®ue_buf
[
RDB_SIZEOF_AUTO_INCREMENT_VERSION
 +

5192 
ROCKSDB_SIZEOF_AUTOINC_VALUE
] = {0};

5193 
uch¬
 *
±r
 = 
v®ue_buf
;

5194 
	`rdb_Ãtbuf_¡Üe_ušt16
(
±r
, 
Rdb_key_def
::
AUTO_INCREMENT_VERSION
);

5195 
±r
 +ğ
RDB_SIZEOF_AUTO_INCREMENT_VERSION
;

5196 
	`rdb_Ãtbuf_¡Üe_ušt64
(
±r
, 
v®
);

5197 
±r
 +ğ
ROCKSDB_SIZEOF_AUTOINC_VALUE
;

5198 cÚ¡ 
rocksdb
::
Sliû
 
v®ue
 =

5199 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
v®ue_buf
), 
±r
 - value_buf);

5201 ià(
ov”wr™e
) {

5202  
b©ch
->
	`Put
(
m_sy¡em_cfh
, 
key
, 
v®ue
);

5204  
b©ch
->
	`M”ge
(
m_sy¡em_cfh
, 
key
, 
v®ue
);

5205 
	}
}

5207 
boŞ
 
	gRdb_diù_mªag”
::
	$g‘_auto_šü_v®
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

5208 
ulÚglÚg
 *
Ãw_v®
) const {

5209 
uch¬
 
key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3] = {0};

5210 
	`dump_šdex_id
(
key_buf
, 
Rdb_key_def
::
AUTO_INC
, 
gl_šdex_id
);

5212 
¡d
::
¡ršg
 
v®ue
;

5213 cÚ¡ 
rocksdb
::
Stus
 
¡©us
 = 
	`g‘_v®ue
(

5214 
rocksdb
::
	`Sliû
(
»š‹½»t_ÿ¡
<*>(
key_buf
), (key_buf)),

5215 &
v®ue
);

5217 ià(
¡©us
.
	`ok
()) {

5218 cÚ¡ 
uch¬
 *cÚ¡ 
v®
 = 
»š‹½»t_ÿ¡
<cÚ¡ uch¬ *>(
v®ue
.
	`d©a
());

5220 ià(
	`rdb_Ãtbuf_to_ušt16
(
v®
è<ğ
Rdb_key_def
::
AUTO_INCREMENT_VERSION
) {

5221 *
Ãw_v®
 = 
	`rdb_Ãtbuf_to_ušt64
(
v®
 + 
RDB_SIZEOF_AUTO_INCREMENT_VERSION
);

5222  
Œue
;

5225  
çl£
;

5226 
	}
}

5228 
ušt
 
	gRdb_£q_g’”©Ü
::
	$g‘_ªd_upd©e_Ãxt_numb”
(

5229 
Rdb_diù_mªag”
 *cÚ¡ 
diù
) {

5230 
	`DBUG_ASSERT
(
diù
 !ğ
nuÎ±r
);

5232 
ušt
 
»s
;

5233 
	`RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

5235 
»s
 = 
m_Ãxt_numb”
++;

5237 cÚ¡ 
¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
wb
 = 
diù
->
	`begš
();

5238 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
 = 
wb
.
	`g‘
();

5240 
	`DBUG_ASSERT
(
b©ch
 !ğ
nuÎ±r
);

5241 
diù
->
	`upd©e_max_šdex_id
(
b©ch
, 
»s
);

5242 
diù
->
	`comm™
(
b©ch
);

5244 
	`RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

5246  
»s
;

5247 
	}
}

	@rdb_datadic.h

16 #´agm¨
Úû


19 
	~<®gÜ™hm
>

20 
	~<©omic
>

21 
	~<m­
>

22 
	~<mu‹x
>

23 
	~<¡ršg
>

24 
	~<unÜd”ed_£t
>

25 
	~<ut™y
>

26 
	~<veùÜ
>

29 
	~<¬·/š‘.h
>

32 
	~"ha_rocksdb.h
"

33 
	~"´İ”t›s_cŞËùÜ.h
"

34 
	~"rdb_buff.h
"

35 
	~"rdb_uts.h
"

37 
Çme¥aû
 
	gmyrocks
 {

39 
şass
 
	gRdb_diù_mªag”
;

40 
şass
 
	gRdb_key_def
;

41 
şass
 
	gRdb_f›ld_·ckšg
;

42 
şass
 
	gRdb_cf_mªag”
;

43 
şass
 
	gRdb_ddl_mªag”
;

59 şas 
	cRdb_·ck_f›ld_cÚ‹xt
 {

60 
	gpublic
:

61 
Rdb_·ck_f›ld_cÚ‹xt
(cÚ¡ Rdb_·ck_f›ld_cÚ‹xˆ&èğ
d–‘e
;

62 
	gRdb_·ck_f›ld_cÚ‹xt
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_·ck_f›ld_cÚ‹xt
 &èğ
d–‘e
;

64 
ex¶ic™
 
Rdb_·ck_f›ld_cÚ‹xt
(
Rdb_¡ršg_wr™”
 *cÚ¡ 
wr™”_¬g
)

65 : 
wr™”
(
wr™”_¬g
) {}

68 
Rdb_¡ršg_wr™”
 *
wr™”
;

71 
	gRdb_cŞÏtiÚ_codec
;

72 
	gRdb_šdex_šfo
;

78 
usšg
 
	grdb_make_uÅack_šfo_t
 =

79 (
Rdb_key_def
::*)(cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *
codec
, cÚ¡ 
F›ld
 *
f›ld
,

80 
Rdb_·ck_f›ld_cÚ‹xt
 *
·ck_ùx
) const;

81 
usšg
 
rdb_šdex_f›ld_uÅack_t
 = (
Rdb_key_def
::*)(

82 
Rdb_f›ld_·ckšg
 *
åi
, 
F›ld
 *
f›ld
, 
uch¬
 *
f›ld_±r
,

83 
Rdb_¡ršg_»ad”
 *
»ad”
, Rdb_¡ršg_»ad” *
uÅack_»ad”
) const;

84 
usšg
 
rdb_šdex_f›ld_sk_t
 =

85 (
Rdb_key_def
::*)(cÚ¡ 
Rdb_f›ld_·ckšg
 *
åi
, cÚ¡ 
F›ld
 *
f›ld
,

86 
Rdb_¡ršg_»ad”
 *
»ad”
) const;

87 
usšg
 
rdb_šdex_f›ld_·ck_t
 =

88 (
Rdb_key_def
::*)(
Rdb_f›ld_·ckšg
 *
åi
, 
F›ld
 *
f›ld
, 
uch¬
 *
buf
,

89 
uch¬
 **
d¡
, 
Rdb_·ck_f›ld_cÚ‹xt
 *
·ck_ùx
) const;

91 cÚ¡ 
ušt
 
RDB_INVALID_KEY_LEN
 = 
	`ušt
(-1);

94 cÚ¡ 
size_t
 
RDB_CHECKSUM_SIZE
 = (
ušt32_t
);

100 cÚ¡ 
size_t
 
RDB_CHECKSUM_CHUNK_SIZE
 = 2 * 
RDB_CHECKSUM_SIZE
 + 1;

106 cÚ¡ 
RDB_CHECKSUM_DATA_TAG
 = 0x01;

112 cÚ¡ 
RDB_UNPACK_DATA_TAG
 = 0x02;

113 cÚ¡ 
size_t
 
RDB_UNPACK_DATA_LEN_SIZE
 = (
ušt16_t
);

114 cÚ¡ 
size_t
 
RDB_UNPACK_HEADER_SIZE
 =

115 (
RDB_UNPACK_DATA_TAG
è+ 
RDB_UNPACK_DATA_LEN_SIZE
;

121 cÚ¡ 
RDB_UNPACK_COVERED_DATA_TAG
 = 0x03;

122 cÚ¡ 
size_t
 
RDB_UNPACK_COVERED_DATA_LEN_SIZE
 = (
ušt16_t
);

123 cÚ¡ 
size_t
 
RDB_COVERED_BITMAP_SIZE
 = (
ušt16_t
);

124 cÚ¡ 
size_t
 
RDB_UNPACK_COVERED_HEADER_SIZE
 =

125 (
RDB_UNPACK_COVERED_DATA_TAG
è+ 
RDB_UNPACK_COVERED_DATA_LEN_SIZE
 +

126 
RDB_COVERED_BITMAP_SIZE
;

131 cÚ¡ 
size_t
 
RDB_SIZEOF_INDEX_INFO_VERSION
 = (
ušt16
);

132 cÚ¡ 
size_t
 
RDB_SIZEOF_INDEX_TYPE
 = (
uch¬
);

133 cÚ¡ 
size_t
 
RDB_SIZEOF_KV_VERSION
 = (
ušt16
);

134 cÚ¡ 
size_t
 
RDB_SIZEOF_INDEX_FLAGS
 = (
ušt32
);

135 cÚ¡ 
size_t
 
RDB_SIZEOF_AUTO_INCREMENT_VERSION
 = (
ušt16
);

139 
UNPACK_SUCCESS
 = 0,

140 
UNPACK_FAILURE
 = 1,

141 
	}
};

183 şas 
	cRdb_key_def
 {

184 
	gpublic
:

186 
ušt
 
·ck_šdex_tu¶e
(
TABLE
 *cÚ¡ 
tbl
, 
uch¬
 *cÚ¡ 
·ck_bufãr
,

187 
uch¬
 *cÚ¡ 
·cked_tu¶e
, cÚ¡ uch¬ *cÚ¡ 
key_tu¶e
,

188 cÚ¡ 
key_·¹_m­
 &
key·¹_m­
) const;

190 
uch¬
 *
·ck_f›ld
(
F›ld
 *cÚ¡ 
f›ld
, 
Rdb_f›ld_·ckšg
 *
·ck_šfo
,

191 
uch¬
 *
tu¶e
, uch¬ *cÚ¡ 
·cked_tu¶e
,

192 
uch¬
 *cÚ¡ 
·ck_bufãr
,

193 
Rdb_¡ršg_wr™”
 *cÚ¡ 
uÅack_šfo
,

194 
ušt
 *cÚ¡ 
n_nuÎ_f›lds
) const;

196 
ušt
 
·ck_»cÜd
(cÚ¡ 
TABLE
 *cÚ¡ 
tbl
, 
uch¬
 *cÚ¡ 
·ck_bufãr
,

197 cÚ¡ 
uch¬
 *cÚ¡ 
»cÜd
, uch¬ *cÚ¡ 
·cked_tu¶e
,

198 
Rdb_¡ršg_wr™”
 *cÚ¡ 
uÅack_šfo
,

199 cÚ¡ 
boŞ
 &
should_¡Üe_row_debug_checksums
,

200 cÚ¡ 
lÚglÚg
 &
hidd’_pk_id
 = 0, 
ušt
 
n_key_·¹s
 = 0,

201 
ušt
 *cÚ¡ 
n_nuÎ_f›lds
 = 
nuÎ±r
,

202 
ušt
 *cÚ¡ 
‰l_pk_off£t
 = 
nuÎ±r
,

203 cÚ¡ *cÚ¡ 
‰l_by‹s
 = 
nuÎ±r
) const;

205 
ušt
 
·ck_hidd’_pk
(cÚ¡ 
lÚglÚg
 &
hidd’_pk_id
,

206 
uch¬
 *cÚ¡ 
·cked_tu¶e
) const;

207 
uÅack_f›ld
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

208 
F›ld
 *cÚ¡ 
f›ld
,

209 
Rdb_¡ršg_»ad”
* 
»ad”
,

210 cÚ¡ 
uch¬
 *cÚ¡ 
deçuÉ_v®ue
,

211 
Rdb_¡ršg_»ad”
* 
uÅ_»ad”
) const;

212 
uÅack_»cÜd
(
TABLE
 *cÚ¡ 
bË
, 
uch¬
 *cÚ¡ 
buf
,

213 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
·cked_key
,

214 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
uÅack_šfo
,

215 cÚ¡ 
boŞ
 &
v”ify_row_debug_checksums
) const;

217 
boŞ
 
uÅack_šfo_has_checksum
(cÚ¡ 
rocksdb
::
Sliû
 &
uÅack_šfo
);

218 
com·»_keys
(cÚ¡ 
rocksdb
::
Sliû
 *
key1
, cÚ¡„ocksdb::Sliû *
key2
,

219 
¡d
::
size_t
 *cÚ¡ 
cŞumn_šdex
) const;

221 
size_t
 
key_Ëngth
(cÚ¡ 
TABLE
 *cÚ¡ 
bË
, cÚ¡ 
rocksdb
::
Sliû
 &
key
) const;

224 
šlše
 
g‘_šfimum_key
(
uch¬
 *cÚ¡ 
key
, 
ušt
 *cÚ¡ 
size
) const {

225 
rdb_Ãtbuf_¡Üe_šdex
(
key
, 
m_šdex_numb”
);

226 *
	gsize
 = 
INDEX_NUMBER_SIZE
;

230 
šlše
 
g‘_su´emum_key
(
uch¬
 *cÚ¡ 
key
, 
ušt
 *cÚ¡ 
size
) const {

231 
rdb_Ãtbuf_¡Üe_šdex
(
key
, 
m_šdex_numb”
 + 1);

232 *
	gsize
 = 
INDEX_NUMBER_SIZE
;

242 
šlše
 
g‘_fœ¡_key
(
uch¬
 *cÚ¡ 
key
, 
ušt
 *cÚ¡ 
size
) const {

243 ià(
	gm_is_»v”£_cf
)

244 
g‘_su´emum_key
(
key
, 
size
);

246 
g‘_šfimum_key
(
key
, 
size
);

249 
uch¬
 
	gunmodif›d_key
[
INDEX_NUMBER_SIZE
];

250 
rdb_Ãtbuf_¡Üe_šdex
(
unmodif›d_key
, 
m_šdex_numb”
);

251 
	gi
;

252 
	gi
 = 0; i < 
	gINDEX_NUMBER_SIZE
; i++) {

253 ià(
	gkey
[
i
] !ğ
unmodif›d_key
[i])

256  
	gi
;

260 
sucûssÜ
(
uch¬
 *cÚ¡ 
·cked_tu¶e
, cÚ¡ 
ušt
 &
Ën
);

263 
´edeûssÜ
(
uch¬
 *cÚ¡ 
·cked_tu¶e
, cÚ¡ 
ušt
 &
Ën
);

271 
cmp_fuÎ_keys
(cÚ¡ 
rocksdb
::
Sliû
 &
a
, cÚ¡„ocksdb::Sliû &
b
) const {

272 
DBUG_ASSERT
(
cov”s_key
(
a
));

274  
memcmp
(
a
.
d©a
(), 
b
.d©a(), 
¡d
::
mš
×.
size
(), b.size()));

278 
boŞ
 
cov”s_key
(cÚ¡ 
rocksdb
::
Sliû
 &
¦iû
) const {

279 ià(
¦iû
.
size
(è< 
INDEX_NUMBER_SIZE
)

280  
çl£
;

282 ià(
memcmp
(
¦iû
.
d©a
(), 
m_šdex_numb”_¡Üage_fÜm
, 
INDEX_NUMBER_SIZE
))

283  
	gçl£
;

285  
	gŒue
;

288 
g‘_lookup_b™m­
(cÚ¡ 
TABLE
 *
bË
, 
MY_BITMAP
 *
m­
) const;

290 
boŞ
 
cov”s_lookup
(
TABLE
 *cÚ¡ 
bË
,

291 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
uÅack_šfo
,

292 cÚ¡ 
MY_BITMAP
 *cÚ¡ 
m­
) const;

294 
šlše
 
boŞ
 
u£_cov”ed_b™m­_fÜm©
() const {

295  
	gm_šdex_ty³
 =ğ
INDEX_TYPE_SECONDARY
 &&

296 
m_kv_fÜm©_v”siÚ
 >ğ
SECONDARY_FORMAT_VERSION_UPDATE3
;

305 
boŞ
 
v®ue_m©ches_´efix
(cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
,

306 cÚ¡ 
rocksdb
::
Sliû
 &
´efix
) const {

307  
cov”s_key
(
v®ue
è&& !
cmp_fuÎ_keys
(v®ue, 
´efix
);

310 
ušt32
 
g‘_keyno
(ècÚ¡ {  
	gm_keyno
; }

312 
ušt32
 
g‘_šdex_numb”
(ècÚ¡ {  
	gm_šdex_numb”
; }

314 
GL_INDEX_ID
 
g‘_gl_šdex_id
() const {

315 cÚ¡ 
GL_INDEX_ID
 
	ggl_šdex_id
 = {
m_cf_hªdË
->
G‘ID
(), 
m_šdex_numb”
};

316  
	ggl_šdex_id
;

319 
»ad_memcmp_key_·¹
(cÚ¡ 
TABLE
 *
bË_¬g
, 
Rdb_¡ršg_»ad”
 *
»ad”
,

320 cÚ¡ 
ušt
 
·¹_num
) const;

323 
ušt
 
g‘_´im¬y_key_tu¶e
(cÚ¡ 
TABLE
 *cÚ¡ 
tbl
,

324 cÚ¡ 
Rdb_key_def
 &
pk_desü
,

325 cÚ¡ 
rocksdb
::
Sliû
 *cÚ¡ 
key
,

326 
uch¬
 *cÚ¡ 
pk_bufãr
) const;

328 
ušt
 
g‘_memcmp_sk_·¹s
(cÚ¡ 
TABLE
 *
bË
, cÚ¡ 
rocksdb
::
Sliû
 &
key
,

329 
uch¬
 *
sk_bufãr
, 
ušt
 *
n_nuÎ_f›lds
) const;

332 
ušt
 
max_¡Üage_fmt_Ëngth
(ècÚ¡ {  
	gm_maxËngth
; }

334 
ušt
 
g‘_key_·¹s
(ècÚ¡ {  
	gm_key_·¹s
; }

336 
ušt
 
g‘_‰l_f›ld_off£t
(ècÚ¡ {  
	gm_‰l_f›ld_off£t
; }

348 
šlše
 
F›ld
 *
g‘_bË_f›ld_fÜ_·¹_no
(
TABLE
 *
bË
, 
ušt
 
·¹_no
) const;

350 cÚ¡ 
	g¡d
::
¡ršg
 &
g‘_Çme
(ècÚ¡ {  
m_Çme
; }

352 cÚ¡ 
	grocksdb
::
SliûT¿nsfÜm
 *
g‘_exŒaùÜ
() const {

353  
m_´efix_exŒaùÜ
.
g‘
();

356 
size_t
 
g‘_uÅack_h—d”_size
(
g
);

358 
	gRdb_key_def
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_key_def
 &èğ
d–‘e
;

359 
Rdb_key_def
(cÚ¡ Rdb_key_deà&
k
);

360 
Rdb_key_def
(
ušt
 
šdexÄ_¬g
, ušˆ
keyno_¬g
,

361 
rocksdb
::
CŞumnFamyHªdË
 *
cf_hªdË_¬g
,

362 
ušt16_t
 
šdex_diù_v”siÚ_¬g
, 
uch¬
 
šdex_ty³_¬g
,

363 
ušt16_t
 
kv_fÜm©_v”siÚ_¬g
, 
boŞ
 
is_»v”£_cf_¬g
,

364 
boŞ
 
is_³r_·¹™iÚ_cf
, cÚ¡ *
Çme
,

365 
Rdb_šdex_¡©s
 
¡©s
 = Rdb_šdex_¡©s(), 
ušt32
 
šdex_æags
 = 0,

366 
ušt32
 
‰l_»c_off£t
 = 
UINT_MAX
, 
ušt64
 
‰l_du¿tiÚ
 = 0);

367 ~
Rdb_key_def
();

370 
	gINDEX_NUMBER_SIZE
 = 4,

371 
	gVERSION_SIZE
 = 2,

372 
	gCF_NUMBER_SIZE
 = 4,

373 
	gCF_FLAG_SIZE
 = 4,

374 
	gPACKED_SIZE
 = 4,

379 
	gREVERSE_CF_FLAG
 = 1,

380 
	gAUTO_CF_FLAG
 = 2,

381 
	gPER_PARTITION_CF_FLAG
 = 4,

386 
	eINDEX_FLAG
 {

387 
	gTTL_FLAG
 = 1 << 0,

391 
	gMAX_FLAG
 = 
TTL_FLAG
 << 1,

396 cÚ¡ 
ušt
 
	gCF_FLAGS_TO_IGNORE
 = 
PER_PARTITION_CF_FLAG
;

399 
	eDATA_DICT_TYPE
 {

400 
	gDDL_ENTRY_INDEX_START_NUMBER
 = 1,

401 
	gINDEX_INFO
 = 2,

402 
	gCF_DEFINITION
 = 3,

403 
	gBINLOG_INFO_INDEX_NUMBER
 = 4,

404 
	gDDL_DROP_INDEX_ONGOING
 = 5,

405 
	gINDEX_STATISTICS
 = 6,

406 
	gMAX_INDEX_ID
 = 7,

407 
	gDDL_CREATE_INDEX_ONGOING
 = 8,

408 
	gAUTO_INC
 = 9,

409 
	gEND_DICT_INDEX_ID
 = 255

415 
	gDDL_ENTRY_INDEX_VERSION
 = 1,

416 
	gCF_DEFINITION_VERSION
 = 1,

417 
	gBINLOG_INFO_INDEX_NUMBER_VERSION
 = 1,

418 
	gDDL_DROP_INDEX_ONGOING_VERSION
 = 1,

419 
	gMAX_INDEX_ID_VERSION
 = 1,

420 
	gDDL_CREATE_INDEX_ONGOING_VERSION
 = 1,

421 
	gAUTO_INCREMENT_VERSION
 = 1,

429 
	gINDEX_INFO_VERSION_INITIAL
 = 1,

430 
	gINDEX_INFO_VERSION_KV_FORMAT
,

431 
	gINDEX_INFO_VERSION_GLOBAL_ID
,

436 
	gINDEX_INFO_VERSION_VERIFY_KV_FORMAT
,

438 
	gINDEX_INFO_VERSION_TTL
,

442 
	gINDEX_INFO_VERSION_FIELD_FLAGS
,

444 
	gINDEX_INFO_VERSION_LATEST
 = 
INDEX_INFO_VERSION_FIELD_FLAGS
,

449 
	gINDEX_TYPE_PRIMARY
 = 1,

450 
	gINDEX_TYPE_SECONDARY
 = 2,

451 
	gINDEX_TYPE_HIDDEN_PRIMARY
 = 3,

456 
	gPRIMARY_FORMAT_VERSION_INITIAL
 = 10,

463 
	gPRIMARY_FORMAT_VERSION_UPDATE1
 = 11,

468 
	gPRIMARY_FORMAT_VERSION_UPDATE2
 = 12,

472 
	gPRIMARY_FORMAT_VERSION_TTL
 = 13,

473 
	gPRIMARY_FORMAT_VERSION_LATEST
 = 
PRIMARY_FORMAT_VERSION_TTL
,

475 
	gSECONDARY_FORMAT_VERSION_INITIAL
 = 10,

477 
	gSECONDARY_FORMAT_VERSION_UPDATE1
 = 11,

482 
	gSECONDARY_FORMAT_VERSION_UPDATE2
 = 12,

486 
	gSECONDARY_FORMAT_VERSION_TTL
 = 13,

487 
	gSECONDARY_FORMAT_VERSION_LATEST
 = 
SECONDARY_FORMAT_VERSION_TTL
,

492 
	gSECONDARY_FORMAT_VERSION_UPDATE3
 = 65535,

495 
£tup
(cÚ¡ 
TABLE
 *cÚ¡ 
bË
, cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def
);

497 
ušt
 
exŒaù_‰l_du¿tiÚ
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

498 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

499 
ušt64
 *
‰l_du¿tiÚ
);

500 
ušt
 
exŒaù_‰l_cŞ
(cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

501 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
,

502 
¡d
::
¡ršg
 *
‰l_cŞumn
, 
ušt
 *
‰l_f›ld_off£t
,

503 
boŞ
 
sk_checks
 = 
çl£
);

504 
šlše
 
boŞ
 
has_‰l
(ècÚ¡ {  
	gm_‰l_du¿tiÚ
 > 0; }

506 
boŞ
 
has_šdex_æag
(
ušt32
 
šdex_æags
, 
INDEX_FLAG
 
æag
);

507 
ušt32
 
ÿlcuÏ‹_šdex_æag_off£t
(ušt32 
šdex_æags
,

508 
INDEX_FLAG
 
æag
,

509 
ušt
 *cÚ¡ 
f›ld_Ëngth
 = 
nuÎ±r
);

510 
wr™e_šdex_æag_f›ld
(
Rdb_¡ršg_wr™”
 *cÚ¡ 
buf
,

511 cÚ¡ 
uch¬
 *cÚ¡ 
v®
,

512 
INDEX_FLAG
 
æag
) const;

514 cÚ¡ 
	g¡d
::
¡ršg


515 
g’_qu®if›r_fÜ_bË
(cÚ¡ *cÚ¡ 
qu®if›r
,

516 cÚ¡ 
¡d
::
¡ršg
 &
·¹™iÚ_Çme
 = "");

517 cÚ¡ 
	g¡d
::
¡ršg


518 
g’_cf_Çme_qu®if›r_fÜ_·¹™iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
s
);

519 cÚ¡ 
	g¡d
::
¡ršg


520 
g’_‰l_du¿tiÚ_qu®if›r_fÜ_·¹™iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
s
);

521 cÚ¡ 
	g¡d
::
¡ršg


522 
g’_‰l_cŞ_qu®if›r_fÜ_·¹™iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
s
);

524 cÚ¡ 
	g¡d
::
¡ršg
 
·r£_comm’t_fÜ_qu®if›r
(

525 cÚ¡ 
¡d
::
¡ršg
 &
comm’t
, cÚ¡ 
TABLE
 *cÚ¡ 
bË_¬g
,

526 cÚ¡ 
Rdb_tbl_def
 *cÚ¡ 
tbl_def_¬g
, 
boŞ
 *
³r_·¹_m©ch_found
,

527 cÚ¡ *cÚ¡ 
qu®if›r
);

529 
	grocksdb
::
CŞumnFamyHªdË
 *
g‘_cf
(ècÚ¡ {  
m_cf_hªdË
; }

532 
šlše
 
boŞ
 
ÿn_uÅack
(cÚ¡ 
ušt
 &
kp
) const;

534 
šlše
 
boŞ
 
has_uÅack_šfo
(cÚ¡ 
ušt
 &
kp
) const;

537 
boŞ
 
bË_has_hidd’_pk
(cÚ¡ 
TABLE
 *cÚ¡ 
bË
);

539 
»pÜt_checksum_mism©ch
(cÚ¡ 
boŞ
 &
is_key
, cÚ¡ *cÚ¡ 
d©a
,

540 cÚ¡ 
size_t
 
d©a_size
) const;

544 
boŞ
 
šdex_fÜm©_mš_check
(cÚ¡ &
pk_mš
, cÚ¡ &
sk_mš
) const;

546 
·ck_w™h_make_sÜt_key
(

547 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
,

548 
uch¬
 *
buf
 
MY_ATTRIBUTE
((
__unu£d__
)), uch¬ **
d¡
,

549 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
 
MY_ATTRIBUTE
((
__unu£d__
))) const;

551 
·ck_w™h_v¬ch¬_’codšg
(

552 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
buf
, uch¬ **
d¡
,

553 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
 
MY_ATTRIBUTE
((
__unu£d__
))) const;

556 
·ck_w™h_v¬ch¬_¥aû_·d
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
,

557 
uch¬
 *
buf
, uch¬ **
d¡
,

558 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const;

560 
uÅack_š‹g”
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
,

561 
uch¬
 *cÚ¡ 
to
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

562 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”


563 
MY_ATTRIBUTE
((
__unu£d__
))) const;

565 
uÅack_doubË
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
 
MY_ATTRIBUTE
((
__unu£d__
)),

566 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

567 
uch¬
 *cÚ¡ 
f›ld_±r
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

568 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”


569 
MY_ATTRIBUTE
((
__unu£d__
))) const;

571 
uÅack_æßt
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

572 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

573 
uch¬
 *cÚ¡ 
f›ld_±r
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

574 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”


575 
MY_ATTRIBUTE
((
__unu£d__
))) const;

577 
uÅack_bš¬y_¡r
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
,

578 
uch¬
 *cÚ¡ 
to
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

579 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”


580 
MY_ATTRIBUTE
((
__unu£d__
))) const;

582 
uÅack_bš¬y_Ü_utf8_v¬ch¬
(

583 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
d¡
,

584 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

585 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
 
MY_ATTRIBUTE
((
__unu£d__
))) const;

587 
uÅack_bš¬y_Ü_utf8_v¬ch¬_¥aû_·d
(

588 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
d¡
,

589 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

590 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const;

592 
uÅack_Ãwd©e
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

593 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

594 
uch¬
 *cÚ¡ 
f›ld_±r
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

595 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”


596 
MY_ATTRIBUTE
((
__unu£d__
))) const;

598 
uÅack_utf8_¡r
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
,

599 
uch¬
 *
d¡
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

600 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”


601 
MY_ATTRIBUTE
((
__unu£d__
))) const;

603 
uÅack_unknown_v¬ch¬
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
,

604 
uch¬
 *
d¡
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

605 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const;

607 
uÅack_sim¶e_v¬ch¬_¥aû_·d
(

608 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
, 
uch¬
 *
d¡
,

609 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

610 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const;

612 
uÅack_sim¶e
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

613 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

614 
uch¬
 *cÚ¡ 
d¡
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

615 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const;

617 
uÅack_unknown
(
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
, 
F›ld
 *cÚ¡ 
f›ld
,

618 
uch¬
 *cÚ¡ 
d¡
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

619 
Rdb_¡ršg_»ad”
 *cÚ¡ 
uÅ_»ad”
) const;

621 
uÅack_æßtšg_pošt
(
uch¬
 *cÚ¡ 
d¡
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
,

622 cÚ¡ 
size_t
 &
size
, cÚ¡ &
exp_dig™
,

623 cÚ¡ 
uch¬
 *cÚ¡ 
z”o_·‰”n
,

624 cÚ¡ 
uch¬
 *cÚ¡ 
z”o_v®
,

625 (*
sw­_func
)(
uch¬
 *, const uchar *)) const;

627 
make_uÅack_sim¶e_v¬ch¬
(cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *cÚ¡ 
codec
,

628 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
,

629 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const;

631 
make_uÅack_sim¶e
(cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *cÚ¡ 
codec
,

632 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
,

633 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const;

635 
make_uÅack_unknown
(

636 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *
codec
 
MY_ATTRIBUTE
((
__unu£d__
)),

637 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
, 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const;

639 
make_uÅack_unknown_v¬ch¬
(

640 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *cÚ¡ 
codec
 
MY_ATTRIBUTE
((
__unu£d__
)),

641 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
, 
Rdb_·ck_f›ld_cÚ‹xt
 *cÚ¡ 
·ck_ùx
) const;

643 
dummy_make_uÅack_šfo
(

644 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *
codec
 
MY_ATTRIBUTE
((
__unu£d__
)),

645 cÚ¡ 
F›ld
 *
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

646 
Rdb_·ck_f›ld_cÚ‹xt
 *
·ck_ùx
 
MY_ATTRIBUTE
((
__unu£d__
))) const;

648 
sk_max_Ëngth
(cÚ¡ 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

649 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
 
MY_ATTRIBUTE
((
__unu£d__
)),

650 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
) const;

652 
sk_v¬ŸbË_Ëngth
(

653 cÚ¡ 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
 
MY_ATTRIBUTE
((
__unu£d__
)),

654 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
, 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
) const;

656 
sk_v¬ŸbË_¥aû_·d
(cÚ¡ 
Rdb_f›ld_·ckšg
 *cÚ¡ 
åi
,

657 cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
,

658 
Rdb_¡ršg_»ad”
 *cÚ¡ 
»ad”
) const;

660 
šlše
 
boŞ
 
u£_Ëgacy_v¬bš¬y_fÜm©
() const {

661  !
šdex_fÜm©_mš_check
(
PRIMARY_FORMAT_VERSION_UPDATE2
,

662 
SECONDARY_FORMAT_VERSION_UPDATE2
);

665 
šlše
 
boŞ
 
is_uÅack_d©a_g
(
c
) {

666  
	gc
 =ğ
RDB_UNPACK_DATA_TAG
 || 
c
 =ğ
RDB_UNPACK_COVERED_DATA_TAG
;

669 
	g´iv©e
:

670 #iâdeà
DBUG_OFF


671 
šlše
 
boŞ
 
is_¡Üage_avaabË
(cÚ¡ &
off£t
, cÚ¡ &
Ãeded
) const {

672 cÚ¡ 
	g¡Üage_Ëngth
 = 
¡©ic_ÿ¡
<>(
max_¡Üage_fmt_Ëngth
());

673  (
	g¡Üage_Ëngth
 - 
	goff£t
è>ğ
Ãeded
;

678 cÚ¡ 
ušt32
 
	gm_šdex_numb”
;

680 
uch¬
 
	gm_šdex_numb”_¡Üage_fÜm
[
INDEX_NUMBER_SIZE
];

682 
	grocksdb
::
CŞumnFamyHªdË
 *
m_cf_hªdË
;

684 
·ck_Ëgacy_v¬ŸbË_fÜm©
(cÚ¡ 
uch¬
 *
¤c
, 
size_t
 
¤c_Ën
,

685 
uch¬
 **
d¡
) const;

687 
·ck_v¬ŸbË_fÜm©
(cÚ¡ 
uch¬
 *
¤c
, 
size_t
 
¤c_Ën
,

688 
uch¬
 **
d¡
) const;

690 
ušt
 
ÿlc_uÅack_Ëgacy_v¬ŸbË_fÜm©
(
uch¬
 
æag
, 
boŞ
 *
dÚe
) const;

692 
ušt
 
ÿlc_uÅack_v¬ŸbË_fÜm©
(
uch¬
 
æag
, 
boŞ
 *
dÚe
) const;

694 
	gpublic
:

695 
ušt16_t
 
m_šdex_diù_v”siÚ
;

696 
uch¬
 
	gm_šdex_ty³
;

698 
ušt16_t
 
	gm_kv_fÜm©_v”siÚ
;

700 
boŞ
 
	gm_is_»v”£_cf
;

703 
boŞ
 
	gm_is_³r_·¹™iÚ_cf
;

705 
	g¡d
::
¡ršg
 
m_Çme
;

706 
mubË
 
Rdb_šdex_¡©s
 
	gm_¡©s
;

712 
ušt32
 
	gm_šdex_æags_b™m­
;

717 
ušt32
 
	gm_tÙ®_šdex_æags_Ëngth
;

722 
ušt32
 
	gm_‰l_»c_off£t
;

725 
ušt64
 
	gm_‰l_du¿tiÚ
;

728 
	g¡d
::
¡ršg
 
m_‰l_cŞumn
;

730 
	g´iv©e
:

731 
ä›nd
 
şass
 
Rdb_tbl_def
;

734 
ušt
 
	gm_pk_key_·¹s
;

740 
ušt
 *
	gm_pk_·¹_no
;

743 
Rdb_f›ld_·ckšg
 *
	gm_·ck_šfo
;

745 
ušt
 
	gm_keyno
;

751 
ušt
 
	gm_key_·¹s
;

757 
ušt
 
	gm_‰l_pk_key_·¹_off£t
;

763 
ušt
 
	gm_‰l_f›ld_off£t
;

766 
	g¡d
::
sh¬ed_±r
<cÚ¡ 
rocksdb
::
SliûT¿nsfÜm
> 
m_´efix_exŒaùÜ
;

769 
ušt
 
	gm_maxËngth
;

772 
mysql_mu‹x_t
 
	gm_mu‹x
;

792 
	sRdb_cŞÏtiÚ_codec
 {

793 cÚ¡ 
	gmy_cÜe
::
CHARSET_INFO
 *
m_cs
;

795 
	g¡d
::
¬¿y
<
rdb_make_uÅack_šfo_t
, 2> 
	gm_make_uÅack_šfo_func
;

796 
	g¡d
::
¬¿y
<
rdb_šdex_f›ld_uÅack_t
, 2> 
	gm_uÅack_func
;

798 
	g¡d
::
¬¿y
<
uch¬
, 256> 
	gm_’c_idx
;

799 
	g¡d
::
¬¿y
<
uch¬
, 256> 
	gm_’c_size
;

801 
	g¡d
::
¬¿y
<
uch¬
, 256> 
	gm_dec_size
;

802 
	g¡d
::
veùÜ
<
¡d
::
¬¿y
<
uch¬
, 256>> 
	gm_dec_idx
;

805 
mysql_mu‹x_t
 
rdb_cŞÏtiÚ_d©a_mu‹x
;

806 
mysql_mu‹x_t
 
rdb_mem_cmp_¥aû_mu‹x
;

807 
¡d
::
¬¿y
<cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *, 
MY_ALL_CHARSETS_SIZE
>

808 
rdb_cŞÏtiÚ_d©a
;

810 şas 
	cRdb_f›ld_·ckšg
 {

811 
	gpublic
:

812 
Rdb_f›ld_·ckšg
(cÚ¡ Rdb_f›ld_·ckšg &èğ
d–‘e
;

813 
	gRdb_f›ld_·ckšg
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_f›ld_·ckšg
 &èğ
d–‘e
;

814 
Rdb_f›ld_·ckšg
() = ;

817 
	gm_max_image_Ën
;

820 
	gm_uÅack_d©a_Ën
;

821 
	gm_uÅack_d©a_off£t
;

823 
boŞ
 
	gm_maybe_nuÎ
;

828 cÚ¡ 
CHARSET_INFO
 *
	gm_v¬ch¬_ch¬£t
;

831 
ušt
 
	gm_£gm’t_size
;

835 
boŞ
 
	gm_uÅack_šfo_u£s_two_by‹s
;

842 
boŞ
 
	gm_cov”ed
;

844 cÚ¡ 
	g¡d
::
veùÜ
<
uch¬
> *
¥aû_xäm
;

845 
size_t
 
	g¥aû_xäm_Ën
;

846 
size_t
 
	g¥aû_mb_Ën
;

848 cÚ¡ 
Rdb_cŞÏtiÚ_codec
 *
	gm_ch¬£t_codec
;

853 
boŞ
 
u£s_uÅack_šfo
(ècÚ¡ {  (
	gm_make_uÅack_šfo_func
 !ğ
nuÎ±r
); }

856 
boŞ
 
	gm_uÅack_šfo_¡Ües_v®ue
;

858 
rdb_šdex_f›ld_·ck_t
 
	gm_·ck_func
;

859 
rdb_make_uÅack_šfo_t
 
	gm_make_uÅack_šfo_func
;

867 
rdb_šdex_f›ld_uÅack_t
 
	gm_uÅack_func
;

872 
rdb_šdex_f›ld_sk_t
 
	gm_sk_func
;

874 
	g´iv©e
:

897 
ušt
 
m_keyÄ
;

898 
ušt
 
	gm_key_·¹
;

900 
	gpublic
:

901 
boŞ
 
£tup
(cÚ¡ 
Rdb_key_def
 *cÚ¡ 
key_desü
, cÚ¡ 
F›ld
 *cÚ¡ 
f›ld
,

902 cÚ¡ 
ušt
 &
keyÄ_¬g
, cÚ¡ ušˆ&
key_·¹_¬g
,

903 cÚ¡ 
ušt16
 &
key_Ëngth
);

904 
F›ld
 *
g‘_f›ld_š_bË
(cÚ¡ 
TABLE
 *cÚ¡ 
tbl
) const;

905 
fl_hidd’_pk_v®
(
uch¬
 **
d¡
, cÚ¡ 
lÚglÚg
 &
hidd’_pk_id
) const;

915 şas 
	cRdb_f›ld_’cod”
 {

916 
	gpublic
:

917 
Rdb_f›ld_’cod”
(cÚ¡ Rdb_f›ld_’cod” &èğ
d–‘e
;

918 
	gRdb_f›ld_’cod”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_f›ld_’cod”
 &èğ
d–‘e
;

927 
	eSTORAGE_TYPE
 {

928 
	gSTORE_NONE
,

929 
	gSTORE_SOME
,

930 
	gSTORE_ALL
,

932 
STORAGE_TYPE
 
	gm_¡Üage_ty³
;

934 
ušt
 
	gm_nuÎ_off£t
;

935 
ušt16
 
	gm_f›ld_šdex
;

937 
uch¬
 
	gm_nuÎ_mask
;

939 
	gmy_cÜe
::
’um_f›ld_ty³s
 
m_f›ld_ty³
;

941 
ušt
 
	gm_·ck_Ëngth_š_»c
;

943 
boŞ
 
maybe_nuÎ
(ècÚ¡ {  
	gm_nuÎ_mask
 != 0; }

945 
boŞ
 
u£s_v¬ŸbË_Ën_’codšg
() const {

946  (
	gm_f›ld_ty³
 =ğ
MYSQL_TYPE_BLOB
 ||

947 
m_f›ld_ty³
 =ğ
MYSQL_TYPE_VARCHAR
);

951 
šlše
 
F›ld
 *
	gRdb_key_def
::
	$g‘_bË_f›ld_fÜ_·¹_no
(
TABLE
 *
bË
,

952 
ušt
 
·¹_no
) const {

953 
	`DBUG_ASSERT
(
·¹_no
 < 
	`g‘_key_·¹s
());

954  
m_·ck_šfo
[
·¹_no
].
	`g‘_f›ld_š_bË
(
bË
);

955 
	}
}

957 
šlše
 
boŞ
 
	gRdb_key_def
::
	$ÿn_uÅack
(cÚ¡ 
ušt
 &
kp
) const {

958 
	`DBUG_ASSERT
(
kp
 < 
m_key_·¹s
);

959  (
m_·ck_šfo
[
kp
].
m_uÅack_func
 !ğ
nuÎ±r
);

960 
	}
}

962 
šlše
 
boŞ
 
	gRdb_key_def
::
	$has_uÅack_šfo
(cÚ¡ 
ušt
 &
kp
) const {

963 
	`DBUG_ASSERT
(
kp
 < 
m_key_·¹s
);

964  
m_·ck_šfo
[
kp
].
	`u£s_uÅack_šfo
();

965 
	}
}

976 şas 
	cRdb_tbl_def
 {

977 
	g´iv©e
:

978 
check_if_is_mysql_sy¡em_bË
();

981 
	g¡d
::
¡ršg
 
m_dbÇme_bËÇme
;

984 
	g¡d
::
¡ršg
 
m_dbÇme
;

985 
	g¡d
::
¡ršg
 
m_bËÇme
;

986 
	g¡d
::
¡ršg
 
m_·¹™iÚ
;

988 
£t_Çme
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
);

990 
	gpublic
:

991 
Rdb_tbl_def
(cÚ¡ Rdb_tbl_deà&èğ
d–‘e
;

992 
	gRdb_tbl_def
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_tbl_def
 &èğ
d–‘e
;

994 
ex¶ic™
 
Rdb_tbl_def
(cÚ¡ 
¡d
::
¡ršg
 &
Çme
)

995 : 
m_key_desü_¬r
(
nuÎ±r
), 
m_hidd’_pk_v®
(0), 
m_auto_šü_v®
(0) {

996 
£t_Çme
(
Çme
);

999 
Rdb_tbl_def
(cÚ¡ *cÚ¡ 
Çme
, cÚ¡ 
size_t
 &
Ën
)

1000 : 
m_key_desü_¬r
(
nuÎ±r
), 
m_hidd’_pk_v®
(0), 
m_auto_šü_v®
(0) {

1001 
£t_Çme
(
¡d
::
¡ršg
(
Çme
, 
Ën
));

1004 
ex¶ic™
 
Rdb_tbl_def
(cÚ¡ 
rocksdb
::
Sliû
 &
¦iû
, cÚ¡ 
size_t
 &
pos
 = 0)

1005 : 
m_key_desü_¬r
(
nuÎ±r
), 
m_hidd’_pk_v®
(0), 
m_auto_šü_v®
(0) {

1006 
£t_Çme
(
¡d
::
¡ršg
(
¦iû
.
d©a
(è+ 
pos
, sliû.
size
() -…os));

1009 ~
Rdb_tbl_def
();

1012 
ušt
 
	gm_key_couÁ
;

1015 
	g¡d
::
sh¬ed_±r
<
Rdb_key_def
> *
m_key_desü_¬r
;

1017 
	g¡d
::
©omic
<
lÚglÚg
> 
m_hidd’_pk_v®
;

1018 
	g¡d
::
©omic
<
ulÚglÚg
> 
m_auto_šü_v®
;

1021 
boŞ
 
	gm_is_mysql_sy¡em_bË
;

1023 
boŞ
 
put_diù
(
Rdb_diù_mªag”
 *cÚ¡ 
diù
, 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

1024 
uch¬
 *cÚ¡ 
key
, cÚ¡ 
size_t
 &
keyËn
);

1026 cÚ¡ 
	g¡d
::
¡ršg
 &
fuÎ_bËÇme
(ècÚ¡ {  
m_dbÇme_bËÇme
; }

1027 cÚ¡ 
	g¡d
::
¡ršg
 &
ba£_dbÇme
(ècÚ¡ {  
m_dbÇme
; }

1028 cÚ¡ 
	g¡d
::
¡ršg
 &
ba£_bËÇme
(ècÚ¡ {  
m_bËÇme
; }

1029 cÚ¡ 
	g¡d
::
¡ršg
 &
ba£_·¹™iÚ
(ècÚ¡ {  
m_·¹™iÚ
; }

1030 
GL_INDEX_ID
 
g‘_autošü_gl_šdex_id
();

1038 şas 
	cRdb_£q_g’”©Ü
 {

1039 
ušt
 
	gm_Ãxt_numb”
 = 0;

1041 
mysql_mu‹x_t
 
	gm_mu‹x
;

1043 
	gpublic
:

1044 
Rdb_£q_g’”©Ü
(cÚ¡ Rdb_£q_g’”©Ü &èğ
d–‘e
;

1045 
	gRdb_£q_g’”©Ü
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_£q_g’”©Ü
 &èğ
d–‘e
;

1046 
Rdb_£q_g’”©Ü
() = ;

1048 
š™
(cÚ¡ 
ušt
 &
š™Ÿl_numb”
) {

1049 
mysql_mu‹x_š™
(0, &
m_mu‹x
, 
MY_MUTEX_INIT_FAST
);

1050 
	gm_Ãxt_numb”
 = 
š™Ÿl_numb”
;

1053 
ušt
 
g‘_ªd_upd©e_Ãxt_numb”
(
Rdb_diù_mªag”
 *cÚ¡ 
diù
);

1055 
ş—nup
(è{ 
mysql_mu‹x_de¡roy
(&
m_mu‹x
); }

1058 
š‹rçû
 
	gRdb_bËs_sÿÂ”
 {

1059 
vœtu®
 
add_bË
(
Rdb_tbl_def
 * 
tdef
) = 0;

1070 şas 
	cRdb_ddl_mªag”
 {

1071 
Rdb_diù_mªag”
 *
	gm_diù
 = 
nuÎ±r
;

1072 
	gmy_cÜe
::
HASH
 
m_ddl_hash
;

1074 
	g¡d
::
m­
<
GL_INDEX_ID
, std::
·œ
<
¡d
::
¡ršg
, 
	gušt
>> 
	gm_šdex_num_to_keydef
;

1078 
	g¡d
::
m­
<
GL_INDEX_ID
, std::
sh¬ed_±r
<
Rdb_key_def
>>

1079 
m_šdex_num_to_uncomm™‹d_keydef
;

1080 
mysql_rwlock_t
 
	gm_rwlock
;

1082 
Rdb_£q_g’”©Ü
 
	gm_£qu’û
;

1086 
	g¡d
::
m­
<
GL_INDEX_ID
, 
	gRdb_šdex_¡©s
> 
	gm_¡©s2¡Üe
;

1088 cÚ¡ 
	g¡d
::
sh¬ed_±r
<
Rdb_key_def
> &
fšd
(
GL_INDEX_ID
 
gl_šdex_id
);

1090 
	gpublic
:

1091 
Rdb_ddl_mªag”
(cÚ¡ Rdb_ddl_mªag” &èğ
d–‘e
;

1092 
	gRdb_ddl_mªag”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_ddl_mªag”
 &èğ
d–‘e
;

1093 
Rdb_ddl_mªag”
() {}

1096 
boŞ
 
š™
(
Rdb_diù_mªag”
 *cÚ¡ 
diù_¬g
, 
Rdb_cf_mªag”
 *cÚ¡ 
cf_mªag”
,

1097 cÚ¡ 
ušt32_t
 &
v®id©e_bËs
);

1099 
ş—nup
();

1101 
Rdb_tbl_def
 *
fšd
(cÚ¡ 
¡d
::
¡ršg
 &
bË_Çme
, cÚ¡ 
boŞ
 &
lock
 = 
Œue
);

1102 
	g¡d
::
sh¬ed_±r
<cÚ¡ 
Rdb_key_def
> 
§ã_fšd
(
GL_INDEX_ID
 
gl_šdex_id
);

1103 
£t_¡©s
(cÚ¡ 
¡d
::
unÜd”ed_m­
<
GL_INDEX_ID
, 
Rdb_šdex_¡©s
> &
¡©s
);

1104 
adju¡_¡©s
(cÚ¡ 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> &
Ãw_d©a
,

1105 cÚ¡ 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> &
d–‘ed_d©a
 =

1106 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
>());

1107 
³rsi¡_¡©s
(cÚ¡ 
boŞ
 &
sync
 = 
çl£
);

1110 
put_ªd_wr™e
(
Rdb_tbl_def
 *cÚ¡ 
key_desü
,

1111 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
);

1112 
»move
(
Rdb_tbl_def
 *cÚ¡ 
»c
, 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

1113 cÚ¡ 
boŞ
 &
lock
 = 
Œue
);

1114 
boŞ
 
»Çme
(cÚ¡ 
¡d
::
¡ršg
 &
äom
, cÚ¡ std::¡ršg &
to
,

1115 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
);

1117 
ušt
 
g‘_ªd_upd©e_Ãxt_numb”
(
Rdb_diù_mªag”
 *cÚ¡ 
diù
) {

1118  
	gm_£qu’û
.
g‘_ªd_upd©e_Ãxt_numb”
(
diù
);

1121 cÚ¡ 
	g¡d
::
¡ršg
 
§ã_g‘_bË_Çme
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
);

1124 
sÿn_fÜ_bËs
(
Rdb_bËs_sÿÂ”
 *
bËs_sÿÂ”
);

1126 
”a£_šdex_num
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
);

1127 
add_uncomm™‹d_keydefs
(

1128 cÚ¡ 
¡d
::
unÜd”ed_£t
<¡d::
sh¬ed_±r
<
Rdb_key_def
>> &
šdexes
);

1129 
»move_uncomm™‹d_keydefs
(

1130 cÚ¡ 
¡d
::
unÜd”ed_£t
<¡d::
sh¬ed_±r
<
Rdb_key_def
>> &
šdexes
);

1132 
	g´iv©e
:

1134 
put
(
Rdb_tbl_def
 *cÚ¡ 
key_desü
, cÚ¡ 
boŞ
 &
lock
 = 
Œue
);

1137 cÚ¡ 
uch¬
 *
g‘_hash_key
(
Rdb_tbl_def
 *cÚ¡ 
»c
, 
size_t
 *cÚ¡ 
Ëngth
,

1138 
my_boŞ
 
nÙ_u£d
 
MY_ATTRIBUTE
((
unu£d
)));

1139 
ä“_hash_–em
(*cÚ¡ 
d©a
);

1141 
boŞ
 
v®id©e_schemas
();

1143 
boŞ
 
v®id©e_auto_šü
();

1161 şas 
	cRdb_bšlog_mªag”
 {

1162 
	gpublic
:

1163 
Rdb_bšlog_mªag”
(cÚ¡ Rdb_bšlog_mªag” &èğ
d–‘e
;

1164 
	gRdb_bšlog_mªag”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_bšlog_mªag”
 &èğ
d–‘e
;

1165 
Rdb_bšlog_mªag”
() = ;

1167 
boŞ
 
š™
(
Rdb_diù_mªag”
 *cÚ¡ 
diù
);

1168 
ş—nup
();

1169 
upd©e
(cÚ¡ *cÚ¡ 
bšlog_Çme
, cÚ¡ 
my_off_t
 
bšlog_pos
,

1170 cÚ¡ *cÚ¡ 
bšlog_max_gtid
,

1171 
rocksdb
::
Wr™eB©chBa£
 *cÚ¡ 
b©ch
);

1172 
boŞ
 
»ad
(*cÚ¡ 
bšlog_Çme
, 
my_off_t
 *cÚ¡ 
bšlog_pos
,

1173 *cÚ¡ 
bšlog_gtid
) const;

1174 
upd©e_¦ave_gtid_šfo
(cÚ¡ 
ušt
 &
id
, cÚ¡ *cÚ¡ 
db
,

1175 cÚ¡ *cÚ¡ 
gtid
,

1176 
rocksdb
::
Wr™eB©chBa£
 *cÚ¡ 
wr™e_b©ch
);

1178 
	g´iv©e
:

1179 
Rdb_diù_mªag”
 *
m_diù
 = 
nuÎ±r
;

1180 
uch¬
 
	gm_key_buf
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
] = {0};

1181 
	grocksdb
::
Sliû
 
m_key_¦iû
;

1183 
	grocksdb
::
Sliû
 
·ck_v®ue
(
uch¬
 *cÚ¡ 
buf
, cÚ¡ *cÚ¡ 
bšlog_Çme
,

1184 cÚ¡ 
my_off_t
 &
bšlog_pos
,

1185 cÚ¡ *cÚ¡ 
bšlog_gtid
) const;

1186 
boŞ
 
uÅack_v®ue
(cÚ¡ 
uch¬
 *cÚ¡ 
v®ue
, *cÚ¡ 
bšlog_Çme
,

1187 
my_off_t
 *cÚ¡ 
bšlog_pos
, *cÚ¡ 
bšlog_gtid
) const;

1189 
	g¡d
::
©omic
<
Rdb_tbl_def
 *> 
m_¦ave_gtid_šfo_tbl
;

1250 şas 
	cRdb_diù_mªag”
 {

1251 
	g´iv©e
:

1252 
mysql_mu‹x_t
 
m_mu‹x
;

1253 
	grocksdb
::
T¿n§ùiÚDB
 *
m_db
 = 
nuÎ±r
;

1254 
	grocksdb
::
CŞumnFamyHªdË
 *
m_sy¡em_cfh
 = 
nuÎ±r
;

1257 
uch¬
 
	gm_key_buf_max_šdex_id
[
Rdb_key_def
::
INDEX_NUMBER_SIZE
] = {0};

1258 
	grocksdb
::
Sliû
 
m_key_¦iû_max_šdex_id
;

1260 
dump_šdex_id
(
uch¬
 *cÚ¡ 
Ãtbuf
,

1261 
Rdb_key_def
::
DATA_DICT_TYPE
 
diù_ty³
,

1262 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
);

1263 
d–‘e_w™h_´efix
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

1264 
Rdb_key_def
::
DATA_DICT_TYPE
 
diù_ty³
,

1265 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) const;

1267 
»sume_drİ_šdexes
() const;

1268 
log_¡¬t_drİ_bË
(cÚ¡ 
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
key_desü
,

1269 cÚ¡ 
ušt32
 &
n_keys
,

1270 cÚ¡ *cÚ¡ 
log_aùiÚ
) const;

1271 
log_¡¬t_drİ_šdex
(
GL_INDEX_ID
 
gl_šdex_id
,

1272 cÚ¡ *
log_aùiÚ
) const;

1274 
	gpublic
:

1275 
Rdb_diù_mªag”
(cÚ¡ Rdb_diù_mªag” &èğ
d–‘e
;

1276 
	gRdb_diù_mªag”
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_diù_mªag”
 &èğ
d–‘e
;

1277 
Rdb_diù_mªag”
() = ;

1279 
boŞ
 
š™
(
rocksdb
::
T¿n§ùiÚDB
 *cÚ¡ 
rdb_diù
,

1280 
Rdb_cf_mªag”
 *cÚ¡ 
cf_mªag”
);

1282 
šlše
 
ş—nup
(è{ 
mysql_mu‹x_de¡roy
(&
m_mu‹x
); }

1284 
šlše
 
lock
(è{ 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
); }

1286 
šlše
 
uÆock
(è{ 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
); }

1288 
šlše
 
	grocksdb
::
CŞumnFamyHªdË
 *
g‘_sy¡em_cf
() const {

1289  
m_sy¡em_cfh
;

1293 
	g¡d
::
unique_±r
<
rocksdb
::
Wr™eB©ch
> 
begš
() const;

1294 
comm™
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
, cÚ¡ 
boŞ
 &
sync
 = 
Œue
) const;

1295 
	grocksdb
::
Stus
 
g‘_v®ue
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

1296 
¡d
::
¡ršg
 *cÚ¡ 
v®ue
) const;

1297 
put_key
(
rocksdb
::
Wr™eB©chBa£
 *cÚ¡ 
b©ch
, cÚ¡„ocksdb::
Sliû
 &
key
,

1298 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
) const;

1299 
d–‘e_key
(
rocksdb
::
Wr™eB©chBa£
 *
b©ch
,

1300 cÚ¡ 
rocksdb
::
Sliû
 &
key
) const;

1301 
	grocksdb
::
I‹¿tÜ
 *
Ãw_™”©Ü
() const;

1305 
add_Ü_upd©e_šdex_cf_m­pšg
(
rocksdb
::
Wr™eB©ch
 *
b©ch
,

1306 
Rdb_šdex_šfo
 *cÚ¡ 
šdex_šfo
) const;

1307 
d–‘e_šdex_šfo
(
rocksdb
::
Wr™eB©ch
 *
b©ch
,

1308 cÚ¡ 
GL_INDEX_ID
 &
šdex_id
) const;

1309 
boŞ
 
g‘_šdex_šfo
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

1310 
Rdb_šdex_šfo
 *cÚ¡ 
šdex_šfo
) const;

1313 
add_cf_æags
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
, cÚ¡ 
ušt
 &
cf_id
,

1314 cÚ¡ 
ušt
 &
cf_æags
) const;

1315 
boŞ
 
g‘_cf_æags
(cÚ¡ 
ušt
 &
cf_id
, ušˆ*cÚ¡ 
cf_æags
) const;

1319 
g‘_Úgošg_šdex_İ”©iÚ
(
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> *
gl_šdex_ids
,

1320 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const;

1321 
boŞ
 
is_šdex_İ”©iÚ_Úgošg
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

1322 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const;

1323 
¡¬t_Úgošg_šdex_İ”©iÚ
(
rocksdb
::
Wr™eB©ch
 *
b©ch
,

1324 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

1325 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const;

1326 
’d_Úgošg_šdex_İ”©iÚ
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

1327 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

1328 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const;

1329 
boŞ
 
is_drİ_šdex_em±y
() const;

1330 
add_drİ_bË
(
¡d
::
sh¬ed_±r
<
Rdb_key_def
> *cÚ¡ 
key_desü
,

1331 cÚ¡ 
ušt32
 &
n_keys
,

1332 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
) const;

1333 
add_drİ_šdex
(cÚ¡ 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> &
gl_šdex_ids
,

1334 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
) const;

1335 
add_ü—‹_šdex
(cÚ¡ 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> &
gl_šdex_ids
,

1336 
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
) const;

1338 
fšish_šdexes_İ”©iÚ
(cÚ¡ 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> &
gl_šdex_ids
,

1339 
Rdb_key_def
::
DATA_DICT_TYPE
 
dd_ty³
) const;

1340 
rŞlback_Úgošg_šdex_ü—tiÚ
() const;

1342 
šlše
 
g‘_Úgošg_drİ_šdexes
(

1343 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> *
gl_šdex_ids
) const {

1344 
g‘_Úgošg_šdex_İ”©iÚ
(
gl_šdex_ids
,

1345 
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
);

1347 
šlše
 
g‘_Úgošg_ü—‹_šdexes
(

1348 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> *
gl_šdex_ids
) const {

1349 
g‘_Úgošg_šdex_İ”©iÚ
(
gl_šdex_ids
,

1350 
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

1352 
šlše
 
¡¬t_drİ_šdex
(
rocksdb
::
Wr™eB©ch
 *
wb
,

1353 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) const {

1354 
¡¬t_Úgošg_šdex_İ”©iÚ
(
wb
, 
gl_šdex_id
,

1355 
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
);

1357 
šlše
 
¡¬t_ü—‹_šdex
(
rocksdb
::
Wr™eB©ch
 *
wb
,

1358 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) const {

1359 
¡¬t_Úgošg_šdex_İ”©iÚ
(
wb
, 
gl_šdex_id
,

1360 
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

1362 
šlše
 
fšish_drİ_šdexes
(

1363 cÚ¡ 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> &
gl_šdex_ids
) const {

1364 
fšish_šdexes_İ”©iÚ
(
gl_šdex_ids
, 
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
);

1366 
šlše
 
fšish_ü—‹_šdexes
(

1367 cÚ¡ 
¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> &
gl_šdex_ids
) const {

1368 
fšish_šdexes_İ”©iÚ
(
gl_šdex_ids
,

1369 
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

1371 
šlše
 
boŞ
 
is_drİ_šdex_Úgošg
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) const {

1372  
is_šdex_İ”©iÚ_Úgošg
(
gl_šdex_id
,

1373 
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
);

1375 
šlše
 
boŞ
 
is_ü—‹_šdex_Úgošg
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
) const {

1376  
is_šdex_İ”©iÚ_Úgošg
(
gl_šdex_id
,

1377 
Rdb_key_def
::
DDL_CREATE_INDEX_ONGOING
);

1380 
boŞ
 
g‘_max_šdex_id
(
ušt32_t
 *cÚ¡ 
šdex_id
) const;

1381 
boŞ
 
upd©e_max_šdex_id
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

1382 cÚ¡ 
ušt32_t
 &
šdex_id
) const;

1383 
add_¡©s
(
rocksdb
::
Wr™eB©ch
 *cÚ¡ 
b©ch
,

1384 cÚ¡ 
¡d
::
veùÜ
<
Rdb_šdex_¡©s
> &
¡©s
) const;

1385 
Rdb_šdex_¡©s
 
g‘_¡©s
(
GL_INDEX_ID
 
gl_šdex_id
) const;

1387 
	grocksdb
::
Stus
 
put_auto_šü_v®
(
rocksdb
::
Wr™eB©chBa£
 *
b©ch
,

1388 cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

1389 
ulÚglÚg
 
v®
,

1390 
boŞ
 
ov”wr™e
 = 
çl£
) const;

1391 
boŞ
 
g‘_auto_šü_v®
(cÚ¡ 
GL_INDEX_ID
 &
gl_šdex_id
,

1392 
ulÚglÚg
 *
Ãw_v®
) const;

1395 
	sRdb_šdex_šfo
 {

1396 
GL_INDEX_ID
 
	gm_gl_šdex_id
;

1397 
ušt16_t
 
	gm_šdex_diù_v”siÚ
 = 0;

1398 
uch¬
 
	gm_šdex_ty³
 = 0;

1399 
ušt16_t
 
	gm_kv_v”siÚ
 = 0;

1400 
ušt32
 
	gm_šdex_æags
 = 0;

1401 
ušt64
 
	gm_‰l_du¿tiÚ
 = 0;

1416 şas 
	cRdb_sy¡em_m”ge_İ
 : 
public
 
rocksdb
::
AssocŸtiveM”geO³¿tÜ
 {

1417 
public
:

1429 
boŞ
 
M”ge
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû *
exi¡šg_v®ue
,

1430 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
, 
¡d
::
¡ršg
 *
Ãw_v®ue
,

1431 
rocksdb
::
Logg”
 *
logg”
ècÚ¡ 
ov”ride
 {

1432 
DBUG_ASSERT
(
Ãw_v®ue
 !ğ
nuÎ±r
);

1434 ià(
	gkey
.
size
(è!ğ
Rdb_key_def
::
INDEX_NUMBER_SIZE
 * 3 ||

1435 
G‘KeyTy³
(
key
è!ğ
Rdb_key_def
::
AUTO_INC
 ||

1436 
v®ue
.
size
() !=

1437 
RDB_SIZEOF_AUTO_INCREMENT_VERSION
 + 
ROCKSDB_SIZEOF_AUTOINC_VALUE
 ||

1438 
G‘V”siÚ
(
v®ue
è> 
Rdb_key_def
::
AUTO_INCREMENT_VERSION
) {

1439 
abÜt
();

1442 
ušt64_t
 
	gm”ged_v®ue
 = 
De£rŸlize
(
v®ue
);

1444 ià(
	gexi¡šg_v®ue
 !ğ
nuÎ±r
) {

1445 ià(
exi¡šg_v®ue
->
size
(è!ğ
RDB_SIZEOF_AUTO_INCREMENT_VERSION
 +

1446 
ROCKSDB_SIZEOF_AUTOINC_VALUE
 ||

1447 
G‘V”siÚ
(*
exi¡šg_v®ue
è> 
Rdb_key_def
::
AUTO_INCREMENT_VERSION
) {

1448 
abÜt
();

1451 
	gm”ged_v®ue
 = 
¡d
::
max
(
m”ged_v®ue
, 
De£rŸlize
(*
exi¡šg_v®ue
));

1453 
S”Ÿlize
(
m”ged_v®ue
, 
Ãw_v®ue
);

1454  
	gŒue
;

1457 
vœtu®
 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {  "Rdb_system_merge_op"; }

1459 
	g´iv©e
:

1464 
S”Ÿlize
(cÚ¡ 
ušt64_t
 
d©a
, 
¡d
::
¡ršg
 *
Ãw_v®ue
) const {

1465 
uch¬
 
v®ue_buf
[
RDB_SIZEOF_AUTO_INCREMENT_VERSION
 +

1466 
ROCKSDB_SIZEOF_AUTOINC_VALUE
] = {0};

1467 
uch¬
 *
	g±r
 = 
v®ue_buf
;

1469 
rdb_Ãtbuf_¡Üe_ušt16
(
±r
, 
Rdb_key_def
::
AUTO_INCREMENT_VERSION
);

1470 
	g±r
 +ğ
RDB_SIZEOF_AUTO_INCREMENT_VERSION
;

1472 
rdb_Ãtbuf_¡Üe_ušt64
(
±r
, 
d©a
);

1473 
	g±r
 +ğ
ROCKSDB_SIZEOF_AUTOINC_VALUE
;

1474 
	gÃw_v®ue
->
assign
(
»š‹½»t_ÿ¡
<*>(
v®ue_buf
), 
±r
 - value_buf);

1483 
ušt64_t
 
De£rŸlize
(cÚ¡ 
rocksdb
::
Sliû
 &
s
) const {

1484  
rdb_Ãtbuf_to_ušt64
(
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
s
.
d©a
()) +

1485 
RDB_SIZEOF_AUTO_INCREMENT_VERSION
);

1493 
ušt16_t
 
G‘KeyTy³
(cÚ¡ 
rocksdb
::
Sliû
 &
s
) const {

1494  
rdb_Ãtbuf_to_ušt32
(
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
s
.
d©a
()));

1502 
ušt16_t
 
G‘V”siÚ
(cÚ¡ 
rocksdb
::
Sliû
 &
s
) const {

1503  
rdb_Ãtbuf_to_ušt16
(
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
s
.
d©a
()));

	@rdb_i_s.cc

18 
	~<®gÜ™hm
>

19 
	~<cùy³
>

20 
	~<m­
>

21 
	~<¡ršg
>

22 
	~<veùÜ
>

25 
	~<sql_show.h
>

28 
	~"rocksdb/com·ùiÚ_f‹r.h
"

29 
	~"rocksdb/cÚv’›nû.h
"

30 
	~"rocksdb/f‹r_pŞicy.h
"

31 
	~"rocksdb/membË»p.h
"

32 
	~"rocksdb/m”ge_İ”©Ü.h
"

33 
	~"rocksdb/¦iû_ŒªsfÜm.h
"

34 
	~"rocksdb/ut™›s/Œª§ùiÚ_db.h
"

37 
	~"ha_rocksdb.h
"

38 
	~"ha_rocksdb_´Ùo.h
"

39 
	~"rdb_cf_mªag”.h
"

40 
	~"rdb_d©adic.h
"

41 
	~"rdb_uts.h
"

43 
Çme¥aû
 
	gmyrocks
 {

50 
	#ROCKSDB_FIELD_INFO
(
_Çme_
, 
_Ën_
, 
_ty³_
, 
_æag_
) \

51 { 
_Çme_
, 
_Ën_
, 
_ty³_
, 0, 
_æag_
, 
nuÎ±r
, 0 }

	)

53 
	#ROCKSDB_FIELD_INFO_END
 \

54 
	`ROCKSDB_FIELD_INFO
(
nuÎ±r
, 0, 
MYSQL_TYPE_NULL
, 0)

	)

59 
Çme¥aû
 
	gRDB_CFSTATS_FIELD
 {

60 ’um { 
	gCF_NAME
 = 0, 
	gSTAT_TYPE
, 
	gVALUE
 };

63 
ST_FIELD_INFO
 
	grdb_i_s_cf¡©s_f›lds_šfo
[] = {

64 
ROCKSDB_FIELD_INFO
("CF_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

65 
ROCKSDB_FIELD_INFO
("STAT_TYPE", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

66 
ROCKSDB_FIELD_INFO
("VALUE", (
ušt64_t
), 
MYSQL_TYPE_LONGLONG
, 0),

67 
ROCKSDB_FIELD_INFO_END
};

69 
rdb_i_s_cf¡©s_fl_bË
(

70 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

71 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

72 
DBUG_ENTER_FUNC
();

74 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

75 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

76 
DBUG_ASSERT
(
bËs
->
bË
->
f›ld
 !ğ
nuÎ±r
);

78 
	g»t
 = 0;

79 
ušt64_t
 
	gv®
;

81 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
·œ
<cÚ¡ std::
¡ršg
, std::¡ršg>> 
cf_´İ”t›s
 = {

82 {
rocksdb
::
DB
::
Prİ”t›s
::
kNumImmubËMemTabË
,

84 {
rocksdb
::
DB
::
Prİ”t›s
::
kMemTabËFlushP’dšg
,

86 {
rocksdb
::
DB
::
Prİ”t›s
::
kCom·ùiÚP’dšg
, "COMPACTION_PENDING"},

87 {
rocksdb
::
DB
::
Prİ”t›s
::
kCurSizeAùiveMemTabË
,

89 {
rocksdb
::
DB
::
Prİ”t›s
::
kCurSizeAÎMemTabËs
,

91 {
rocksdb
::
DB
::
Prİ”t›s
::
kNumEÁr›sAùiveMemTabË
,

93 {
rocksdb
::
DB
::
Prİ”t›s
::
kNumEÁr›sImmMemTabËs
,

95 {
rocksdb
::
DB
::
Prİ”t›s
::
kE¡im©eTabËR—d”sMem
,

97 {
rocksdb
::
DB
::
Prİ”t›s
::
kNumLiveV”siÚs
, "NUM_LIVE_VERSIONS"}};

99 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

101 ià(!
	grdb
) {

102 
DBUG_RETURN
(
»t
);

105 cÚ¡ 
	gRdb_cf_mªag”
 &
	gcf_mªag”
 = 
rdb_g‘_cf_mªag”
();

107 cÚ¡‡utØ&
	gcf_Çme
 : 
cf_mªag”
.
g‘_cf_Çmes
()) {

108 
DBUG_ASSERT
(!
cf_Çme
.
em±y
());

109 
	grocksdb
::
CŞumnFamyHªdË
 *
cfh
 = 
cf_mªag”
.
g‘_cf
(
cf_Çme
);

110 ià(
	gcfh
 =ğ
nuÎ±r
) {

114 cÚ¡‡utØ&
	g´İ”ty
 : 
cf_´İ”t›s
) {

115 ià(!
rdb
->
G‘IÁPrİ”ty
(
cfh
, 
´İ”ty
.
fœ¡
, &
v®
)) {

119 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_CFSTATS_FIELD
::
CF_NAME
]->
¡Üe
(

120 
cf_Çme
.
c_¡r
(), cf_Çme.
size
(), 
sy¡em_ch¬£t_šfo
);

121 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_CFSTATS_FIELD
::
STAT_TYPE
]->
¡Üe
(

122 
´İ”ty
.
£cÚd
.
c_¡r
(),…rİ”ty.£cÚd.
size
(), 
sy¡em_ch¬£t_šfo
);

123 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_CFSTATS_FIELD
::
VALUE
]->
¡Üe
(
v®
, 
Œue
);

125 
	g»t
 = 
¡©ic_ÿ¡
<>(

126 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

128 ià(
	g»t
) {

129 
DBUG_RETURN
(
»t
);

134 
DBUG_RETURN
(0);

137 
rdb_i_s_cf¡©s_š™
(*
p
) {

138 
DBUG_ENTER_FUNC
();

140 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

142 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

144 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

146 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_cf¡©s_f›lds_šfo
;

147 
	gschema
->
	gfl_bË
 = 
rdb_i_s_cf¡©s_fl_bË
;

149 
DBUG_RETURN
(0);

155 
Çme¥aû
 
	gRDB_DBSTATS_FIELD
 {

156 ’um { 
	gSTAT_TYPE
 = 0, 
	gVALUE
 };

159 
ST_FIELD_INFO
 
	grdb_i_s_db¡©s_f›lds_šfo
[] = {

160 
ROCKSDB_FIELD_INFO
("STAT_TYPE", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

161 
ROCKSDB_FIELD_INFO
("VALUE", (
ušt64_t
), 
MYSQL_TYPE_LONGLONG
, 0),

162 
ROCKSDB_FIELD_INFO_END
};

164 
rdb_i_s_db¡©s_fl_bË
(

165 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

166 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

167 
DBUG_ENTER_FUNC
();

169 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

170 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

171 
DBUG_ASSERT
(
bËs
->
bË
->
f›ld
 !ğ
nuÎ±r
);

173 
	g»t
 = 0;

174 
ušt64_t
 
	gv®
;

176 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
·œ
<¡d::
¡ršg
, std::¡ršg>> 
db_´İ”t›s
 = {

177 {
rocksdb
::
DB
::
Prİ”t›s
::
kBackgroundE¼Üs
, "DB_BACKGROUND_ERRORS"},

178 {
rocksdb
::
DB
::
Prİ”t›s
::
kNumSÇpshÙs
, "DB_NUM_SNAPSHOTS"},

179 {
rocksdb
::
DB
::
Prİ”t›s
::
kOlde¡SÇpshÙTime
,

182 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

184 ià(!
	grdb
) {

185 
DBUG_RETURN
(
»t
);

188 cÚ¡ 
	grocksdb
::
BlockBa£dTabËO±iÚs
 &
bË_İtiÚs
 =

189 
rdb_g‘_bË_İtiÚs
();

191 cÚ¡‡utØ&
	g´İ”ty
 : 
db_´İ”t›s
) {

192 ià(!
rdb
->
G‘IÁPrİ”ty
(
´İ”ty
.
fœ¡
, &
v®
)) {

196 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DBSTATS_FIELD
::
STAT_TYPE
]->
¡Üe
(

197 
´İ”ty
.
£cÚd
.
c_¡r
(),…rİ”ty.£cÚd.
size
(), 
sy¡em_ch¬£t_šfo
);

198 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DBSTATS_FIELD
::
VALUE
]->
¡Üe
(
v®
, 
Œue
);

200 
	g»t
 = 
¡©ic_ÿ¡
<>(

201 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

203 ià(
	g»t
) {

204 
DBUG_RETURN
(
»t
);

218 
	gv®
 = (
bË_İtiÚs
.
block_ÿche
 ?abË_İtiÚs.block_ÿche->
G‘U§ge
() : 0);

220 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DBSTATS_FIELD
::
STAT_TYPE
]->
¡Üe
(

221 
STRING_WITH_LEN
("DB_BLOCK_CACHE_USAGE"), 
sy¡em_ch¬£t_šfo
);

222 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DBSTATS_FIELD
::
VALUE
]->
¡Üe
(
v®
, 
Œue
);

224 
	g»t
 =

225 
¡©ic_ÿ¡
<>(
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

227 
DBUG_RETURN
(
»t
);

230 
rdb_i_s_db¡©s_š™
(*cÚ¡ 
p
) {

231 
DBUG_ENTER_FUNC
();

233 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

235 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

237 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

239 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_db¡©s_f›lds_šfo
;

240 
	gschema
->
	gfl_bË
 = 
rdb_i_s_db¡©s_fl_bË
;

242 
DBUG_RETURN
(0);

248 
Çme¥aû
 
	gRDB_PERF_CONTEXT_FIELD
 {

249 ’um { 
	gTABLE_SCHEMA
 = 0, 
	gTABLE_NAME
, 
	gPARTITION_NAME
, 
	gSTAT_TYPE
, 
	gVALUE
 };

252 
ST_FIELD_INFO
 
	grdb_i_s_³rf_cÚ‹xt_f›lds_šfo
[] = {

253 
ROCKSDB_FIELD_INFO
("TABLE_SCHEMA", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

254 
ROCKSDB_FIELD_INFO
("TABLE_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

255 
ROCKSDB_FIELD_INFO
("PARTITION_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
,

256 
MY_I_S_MAYBE_NULL
),

257 
ROCKSDB_FIELD_INFO
("STAT_TYPE", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

258 
ROCKSDB_FIELD_INFO
("VALUE", (
ušt64_t
), 
MYSQL_TYPE_LONGLONG
, 0),

259 
ROCKSDB_FIELD_INFO_END
};

261 
rdb_i_s_³rf_cÚ‹xt_fl_bË
(

262 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

263 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

264 
DBUG_ENTER_FUNC
();

266 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

267 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

268 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

270 
	g»t
 = 0;

271 
F›ld
 **
	gf›ld
 = 
bËs
->
bË
->
f›ld
;

272 
DBUG_ASSERT
(
f›ld
 !ğ
nuÎ±r
);

274 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

276 ià(!
	grdb
) {

277 
DBUG_RETURN
(
»t
);

280 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
bËÇmes
 = 
rdb_g‘_İ’_bË_Çmes
();

282 cÚ¡‡utØ&
	g™
 : 
bËÇmes
) {

283 
¡d
::
¡ršg
 
¡r
, 
	gdbÇme
, 
	gbËÇme
, 
	g·¹Çme
;

284 
Rdb_³rf_couÁ”s
 
	gcouÁ”s
;

286 
	grc
 = 
rdb_nÜm®ize_bËÇme
(
™
, &
¡r
);

288 ià(
	grc
 !ğ
HA_EXIT_SUCCESS
) {

289 
DBUG_RETURN
(
rc
);

292 ià(
rdb_¥l™_nÜm®ized_bËÇme
(
¡r
, &
dbÇme
, &
bËÇme
, &
·¹Çme
)) {

296 ià(
rdb_g‘_bË_³rf_couÁ”s
(
™
.
c_¡r
(), &
couÁ”s
)) {

300 
	gf›ld
[
RDB_PERF_CONTEXT_FIELD
::
TABLE_SCHEMA
]->
¡Üe
(

301 
dbÇme
.
c_¡r
(), dbÇme.
size
(), 
sy¡em_ch¬£t_šfo
);

302 
	gf›ld
[
RDB_PERF_CONTEXT_FIELD
::
TABLE_NAME
]->
¡Üe
(

303 
bËÇme
.
c_¡r
(),abËÇme.
size
(), 
sy¡em_ch¬£t_šfo
);

305 ià(
	g·¹Çme
.
size
() == 0) {

306 
f›ld
[
RDB_PERF_CONTEXT_FIELD
::
PARTITION_NAME
]->
£t_nuÎ
();

308 
	gf›ld
[
RDB_PERF_CONTEXT_FIELD
::
PARTITION_NAME
]->
£t_nÙnuÎ
();

309 
	gf›ld
[
RDB_PERF_CONTEXT_FIELD
::
PARTITION_NAME
]->
¡Üe
(

310 
·¹Çme
.
c_¡r
(),…¬Šame.
size
(), 
sy¡em_ch¬£t_šfo
);

313 
	gi
 = 0; i < 
	gPC_MAX_IDX
; i++) {

314 
	gf›ld
[
RDB_PERF_CONTEXT_FIELD
::
STAT_TYPE
]->
¡Üe
(

315 
rdb_pc_¡©_ty³s
[
i
].
c_¡r
(),„db_pc_¡©_ty³s[i].
size
(),

316 
sy¡em_ch¬£t_šfo
);

317 
	gf›ld
[
RDB_PERF_CONTEXT_FIELD
::
VALUE
]->
¡Üe
(
couÁ”s
.
m_v®ue
[
i
], 
Œue
);

319 
	g»t
 = 
¡©ic_ÿ¡
<>(

320 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

322 ià(
	g»t
) {

323 
DBUG_RETURN
(
»t
);

328 
DBUG_RETURN
(0);

331 
rdb_i_s_³rf_cÚ‹xt_š™
(*cÚ¡ 
p
) {

332 
DBUG_ENTER_FUNC
();

334 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

336 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

338 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

340 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_³rf_cÚ‹xt_f›lds_šfo
;

341 
	gschema
->
	gfl_bË
 = 
rdb_i_s_³rf_cÚ‹xt_fl_bË
;

343 
DBUG_RETURN
(0);

349 
Çme¥aû
 
	gRDB_PERF_CONTEXT_GLOBAL_FIELD
 {

350 ’um { 
	gSTAT_TYPE
 = 0, 
	gVALUE
 };

353 
ST_FIELD_INFO
 
	grdb_i_s_³rf_cÚ‹xt_glob®_f›lds_šfo
[] = {

354 
ROCKSDB_FIELD_INFO
("STAT_TYPE", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

355 
ROCKSDB_FIELD_INFO
("VALUE", (
ušt64_t
), 
MYSQL_TYPE_LONGLONG
, 0),

356 
ROCKSDB_FIELD_INFO_END
};

358 
rdb_i_s_³rf_cÚ‹xt_glob®_fl_bË
(

359 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

360 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

361 
DBUG_ENTER_FUNC
();

363 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

364 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

365 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

366 
DBUG_ASSERT
(
bËs
->
bË
->
f›ld
 !ğ
nuÎ±r
);

368 
	g»t
 = 0;

370 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

372 ià(!
	grdb
) {

373 
DBUG_RETURN
(
»t
);

377 
Rdb_³rf_couÁ”s
 
	gglob®_couÁ”s
;

378 
rdb_g‘_glob®_³rf_couÁ”s
(&
glob®_couÁ”s
);

380 
	gi
 = 0; i < 
	gPC_MAX_IDX
; i++) {

381 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_PERF_CONTEXT_GLOBAL_FIELD
::
STAT_TYPE
]->
¡Üe
(

382 
rdb_pc_¡©_ty³s
[
i
].
c_¡r
(),„db_pc_¡©_ty³s[i].
size
(),

383 
sy¡em_ch¬£t_šfo
);

384 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_PERF_CONTEXT_GLOBAL_FIELD
::
VALUE
]->
¡Üe
(

385 
glob®_couÁ”s
.
m_v®ue
[
i
], 
Œue
);

387 
	g»t
 = 
¡©ic_ÿ¡
<>(

388 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

390 ià(
	g»t
) {

391 
DBUG_RETURN
(
»t
);

395 
DBUG_RETURN
(0);

398 
rdb_i_s_³rf_cÚ‹xt_glob®_š™
(*cÚ¡ 
p
) {

399 
DBUG_ENTER_FUNC
();

401 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

403 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

405 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

407 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_³rf_cÚ‹xt_glob®_f›lds_šfo
;

408 
	gschema
->
	gfl_bË
 = 
rdb_i_s_³rf_cÚ‹xt_glob®_fl_bË
;

410 
DBUG_RETURN
(0);

416 
Çme¥aû
 
	gRDB_CFOPTIONS_FIELD
 {

417 ’um { 
	gCF_NAME
 = 0, 
	gOPTION_TYPE
, 
	gVALUE
 };

420 
ST_FIELD_INFO
 
	grdb_i_s_cfİtiÚs_f›lds_šfo
[] = {

421 
ROCKSDB_FIELD_INFO
("CF_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

422 
ROCKSDB_FIELD_INFO
("OPTION_TYPE", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

423 
ROCKSDB_FIELD_INFO
("VALUE", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

424 
ROCKSDB_FIELD_INFO_END
};

426 
rdb_i_s_cfİtiÚs_fl_bË
(

427 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

428 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

429 
DBUG_ENTER_FUNC
();

431 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

432 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

434 
	g»t
 = 0;

436 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

438 ià(!
	grdb
) {

439 
DBUG_RETURN
(
»t
);

442 
	gRdb_cf_mªag”
 &
	gcf_mªag”
 = 
rdb_g‘_cf_mªag”
();

444 cÚ¡‡utØ&
	gcf_Çme
 : 
cf_mªag”
.
g‘_cf_Çmes
()) {

445 
¡d
::
¡ršg
 
v®
;

446 
	grocksdb
::
CŞumnFamyO±iÚs
 
İts
;

448 
DBUG_ASSERT
(!
cf_Çme
.
em±y
());

449 
	gcf_mªag”
.
g‘_cf_İtiÚs
(
cf_Çme
, &
İts
);

451 
	g¡d
::
veùÜ
<
¡d
::
·œ
<¡d::
¡ršg
, std::¡ršg>> 
cf_İtiÚ_ty³s
 = {

452 {"COMPARATOR", 
İts
.
com·¿tÜ
 =ğ
nuÎ±r


454 : 
¡d
::
¡ršg
(
İts
.
com·¿tÜ
->
Name
())},

455 {"MERGE_OPERATOR", 
	gİts
.
	gm”ge_İ”©Ü
 =ğ
nuÎ±r


457 : 
¡d
::
¡ršg
(
İts
.
m”ge_İ”©Ü
->
Name
())},

459 
	gİts
.
	gcom·ùiÚ_f‹r
 =ğ
nuÎ±r


461 : 
¡d
::
¡ršg
(
İts
.
com·ùiÚ_f‹r
->
Name
())},

463 
	gİts
.
	gcom·ùiÚ_f‹r_çùÜy
 =ğ
nuÎ±r


465 : 
¡d
::
¡ršg
(
İts
.
com·ùiÚ_f‹r_çùÜy
->
Name
())},

466 {"WRITE_BUFFER_SIZE", 
	g¡d
::
to_¡ršg
(
İts
.
wr™e_bufãr_size
)},

468 
	g¡d
::
to_¡ršg
(
İts
.
max_wr™e_bufãr_numb”
)},

470 
	g¡d
::
to_¡ršg
(
İts
.
mš_wr™e_bufãr_numb”_to_m”ge
)},

471 {"NUM_LEVELS", 
	g¡d
::
to_¡ršg
(
İts
.
num_Ëv–s
)},

473 
	g¡d
::
to_¡ršg
(
İts
.
Ëv–0_fe_num_com·ùiÚ_Œigg”
)},

475 
	g¡d
::
to_¡ršg
(
İts
.
Ëv–0_¦owdown_wr™es_Œigg”
)},

477 
	g¡d
::
to_¡ršg
(
İts
.
Ëv–0_¡İ_wr™es_Œigg”
)},

479 
	g¡d
::
to_¡ršg
(
İts
.
max_mem_com·ùiÚ_Ëv–
)},

480 {"TARGET_FILE_SIZE_BASE", 
	g¡d
::
to_¡ršg
(
İts
.
rg‘_fe_size_ba£
)},

482 
	g¡d
::
to_¡ršg
(
İts
.
rg‘_fe_size_muÉl›r
)},

484 
	g¡d
::
to_¡ršg
(
İts
.
max_by‹s_fÜ_Ëv–_ba£
)},

486 
	gİts
.
	gËv–_com·ùiÚ_dyÇmic_Ëv–_by‹s
 ? "ON" : "OFF"},

488 
	g¡d
::
to_¡ršg
(
İts
.
max_by‹s_fÜ_Ëv–_muÉl›r
)},

489 {"SOFT_RATE_LIMIT", 
	g¡d
::
to_¡ršg
(
İts
.
soá_¿‹_lim™
)},

490 {"HARD_RATE_LIMIT", 
	g¡d
::
to_¡ršg
(
İts
.
h¬d_¿‹_lim™
)},

492 
	g¡d
::
to_¡ršg
(
İts
.
¿‹_lim™_d–ay_max_mli£cÚds
)},

493 {"ARENA_BLOCK_SIZE", 
	g¡d
::
to_¡ršg
(
İts
.
¬’a_block_size
)},

495 
	gİts
.
	gdi§bË_auto_com·ùiÚs
 ? "ON" : "OFF"},

497 
	gİts
.
	gpurge_»dundªt_kvs_whe_æush
 ? "ON" : "OFF"},

499 
	g¡d
::
to_¡ršg
(
İts
.
max_£qu’tŸl_sk_š_™”©iÚs
)},

500 {"MEMTABLE_FACTORY", 
	gİts
.
	gmembË_çùÜy
 =ğ
nuÎ±r


502 : 
İts
.
membË_çùÜy
->
Name
()},

503 {"INPLACE_UPDATE_SUPPORT", 
	gİts
.
	gš¶aû_upd©e_suµÜt
 ? "ON" : "OFF"},

505 
	gİts
.
	gš¶aû_upd©e_num_locks
 ? "ON" : "OFF"},

507 
	g¡d
::
to_¡ršg
(
İts
.
membË_´efix_bloom_size_¿tio
)},

509 
	g¡d
::
to_¡ršg
(
İts
.
membË_huge_·ge_size
)},

510 {"BLOOM_LOCALITY", 
	g¡d
::
to_¡ršg
(
İts
.
bloom_loÿl™y
)},

511 {"MAX_SUCCESSIVE_MERGES", 
	g¡d
::
to_¡ršg
(
İts
.
max_sucûssive_m”ges
)},

513 (
	gİts
.
	gİtimize_f‹rs_fÜ_h™s
 ? "ON" : "OFF")},

517 
	gv®
 = 
İts
.
max_by‹s_fÜ_Ëv–_muÉl›r_add™iÚ®
.
em±y
() ? "NULL" : "";

519 cÚ¡‡utØ&
	gËv–
 : 
İts
.
max_by‹s_fÜ_Ëv–_muÉl›r_add™iÚ®
) {

520 
v®
.
­³nd
(
¡d
::
to_¡ršg
(
Ëv–
) + ":");

523 
	gv®
.
pİ_back
();

524 
	gcf_İtiÚ_ty³s
.
push_back
(

525 {"MAX_BYTES_FOR_LEVEL_MULTIPLIER_ADDITIONAL", 
v®
});

528 
G‘SŒšgFromCom´essiÚTy³
(&
v®
, 
İts
.
com´essiÚ
);

530 ià(
	gv®
.
em±y
()) {

531 
	gv®
 = "NULL";

534 
	gcf_İtiÚ_ty³s
.
push_back
({"COMPRESSION_TYPE", 
v®
});

537 
	gv®
 = 
İts
.
com´essiÚ_³r_Ëv–
.
em±y
() ? "NULL" : "";

539 cÚ¡‡utØ&
	gcom´essiÚ_ty³
 : 
İts
.
com´essiÚ_³r_Ëv–
) {

540 
¡d
::
¡ršg
 
»s
;

542 
G‘SŒšgFromCom´essiÚTy³
(&
»s
, 
com´essiÚ_ty³
);

544 ià(!
	g»s
.
em±y
()) {

545 
	gv®
.
­³nd
(
»s
 + ":");

549 
	gv®
.
pİ_back
();

550 
	gcf_İtiÚ_ty³s
.
push_back
({"COMPRESSION_PER_LEVEL", 
v®
});

553 
	gv®
 = 
¡d
::
to_¡ršg
(
İts
.
com´essiÚ_İts
.
wšdow_b™s
) + ":";

554 
	gv®
.
­³nd
(
¡d
::
to_¡ršg
(
İts
.
com´essiÚ_İts
.
Ëv–
) + ":");

555 
	gv®
.
­³nd
(
¡d
::
to_¡ršg
(
İts
.
com´essiÚ_İts
.
¡¿‹gy
));

557 
	gcf_İtiÚ_ty³s
.
push_back
({"COMPRESSION_OPTS", 
v®
});

560 ià(
	gİts
.
	gbÙtommo¡_com´essiÚ
) {

561 
	g¡d
::
¡ršg
 
»s
;

563 
G‘SŒšgFromCom´essiÚTy³
(&
»s
, 
İts
.
bÙtommo¡_com´essiÚ
);

565 ià(!
	g»s
.
em±y
()) {

566 
	gcf_İtiÚ_ty³s
.
push_back
({"BOTTOMMOST_COMPRESSION", 
»s
});

571 
	gcf_İtiÚ_ty³s
.
push_back
(

572 {"PREFIX_EXTRACTOR", 
İts
.
´efix_exŒaùÜ
 =ğ
nuÎ±r


574 : 
¡d
::
¡ršg
(
İts
.
´efix_exŒaùÜ
->
Name
())});

577 
	gİts
.
	gcom·ùiÚ_¡yË
) {

578 
	grocksdb
::
kCom·ùiÚStyËLev–
:

579 
v®
 = "kCompactionStyleLevel";

581 
	grocksdb
::
kCom·ùiÚStyËUniv”§l
:

582 
v®
 = "kCompactionStyleUniversal";

584 
	grocksdb
::
kCom·ùiÚStyËFIFO
:

585 
v®
 = "kCompactionStyleFIFO";

587 
	grocksdb
::
kCom·ùiÚStyËNÚe
:

588 
v®
 = "kCompactionStyleNone";

591 
v®
 = "NULL";

594 
	gcf_İtiÚ_ty³s
.
push_back
({"COMPACTION_STYLE", 
v®
});

597 cÚ¡ 
	grocksdb
::
Com·ùiÚO±iÚsUniv”§l
 
com·c_İts
 =

598 
İts
.
com·ùiÚ_İtiÚs_univ”§l
;

600 
	gv®
 = "{SIZE_RATIO=";

602 
	gv®
.
­³nd
(
¡d
::
to_¡ršg
(
com·c_İts
.
size_¿tio
));

603 
	gv®
.
­³nd
("; MIN_MERGE_WIDTH=");

604 
	gv®
.
­³nd
(
¡d
::
to_¡ršg
(
com·c_İts
.
mš_m”ge_width
));

605 
	gv®
.
­³nd
("; MAX_MERGE_WIDTH=");

606 
	gv®
.
­³nd
(
¡d
::
to_¡ršg
(
com·c_İts
.
max_m”ge_width
));

607 
	gv®
.
­³nd
("; MAX_SIZE_AMPLIFICATION_PERCENT=");

608 
	gv®
.
­³nd
(
¡d
::
to_¡ršg
(
com·c_İts
.
max_size_am¶ifiÿtiÚ_³rûÁ
));

609 
	gv®
.
­³nd
("; COMPRESSION_SIZE_PERCENT=");

610 
	gv®
.
­³nd
(
¡d
::
to_¡ršg
(
com·c_İts
.
com´essiÚ_size_³rûÁ
));

611 
	gv®
.
­³nd
("; STOP_STYLE=");

613 
	gcom·c_İts
.
	g¡İ_¡yË
) {

614 
	grocksdb
::
kCom·ùiÚStİStyËSim¬Size
:

615 
v®
.
­³nd
("kCompactionStopStyleSimilarSize}");

617 
	grocksdb
::
kCom·ùiÚStİStyËTÙ®Size
:

618 
v®
.
­³nd
("kCompactionStopStyleTotalSize}");

621 
v®
.
­³nd
("}");

624 
	gcf_İtiÚ_ty³s
.
push_back
({"COMPACTION_OPTIONS_UNIVERSAL", 
v®
});

627 
	gcf_İtiÚ_ty³s
.
push_back
(

629 
¡d
::
to_¡ršg
(
İts
.
com·ùiÚ_İtiÚs_fifo
.
max_bË_fes_size
)});

632 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
bË_İtiÚs
 =

633 
¥l™_što_veùÜ
(
İts
.
bË_çùÜy
->
G‘PršbËTabËO±iÚs
(), '\n');

635 autØ
	gİtiÚ
 : 
bË_İtiÚs
) {

636 
İtiÚ
.
”a£
(
¡d
::
»move
(İtiÚ.
begš
(), o±iÚ.
’d
(), ' '),

637 
İtiÚ
.
’d
());

639 
	gpos
 = 
İtiÚ
.
fšd
(":");

640 
	g¡d
::
¡ršg
 
İtiÚ_Çme
 = 
İtiÚ
.
sub¡r
(0, 
pos
);

641 
	g¡d
::
¡ršg
 
İtiÚ_v®ue
 = 
İtiÚ
.
sub¡r
(
pos
 + 1, o±iÚ.
Ëngth
());

642 
	g¡d
::
ŒªsfÜm
(
İtiÚ_Çme
.
begš
(), o±iÚ_Çme.
’d
(),

643 
İtiÚ_Çme
.
begš
(),

644 [](
c
è{  
¡d
::
touµ”
(c); });

646 
	gcf_İtiÚ_ty³s
.
push_back
(

647 {"TABLE_FACTORY::" + 
İtiÚ_Çme
, 
İtiÚ_v®ue
});

650 cÚ¡‡utØ&
	gcf_İtiÚ_ty³
 : 
cf_İtiÚ_ty³s
) {

651 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

652 
DBUG_ASSERT
(
bËs
->
bË
->
f›ld
 !ğ
nuÎ±r
);

654 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_CFOPTIONS_FIELD
::
CF_NAME
]->
¡Üe
(

655 
cf_Çme
.
c_¡r
(), cf_Çme.
size
(), 
sy¡em_ch¬£t_šfo
);

656 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_CFOPTIONS_FIELD
::
OPTION_TYPE
]->
¡Üe
(

657 
cf_İtiÚ_ty³
.
fœ¡
.
c_¡r
(), cf_İtiÚ_ty³.fœ¡.
size
(),

658 
sy¡em_ch¬£t_šfo
);

659 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_CFOPTIONS_FIELD
::
VALUE
]->
¡Üe
(

660 
cf_İtiÚ_ty³
.
£cÚd
.
c_¡r
(), cf_İtiÚ_ty³.£cÚd.
size
(),

661 
sy¡em_ch¬£t_šfo
);

663 
	g»t
 = 
¡©ic_ÿ¡
<>(

664 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

666 ià(
	g»t
) {

667 
DBUG_RETURN
(
»t
);

672 
DBUG_RETURN
(0);

678 
Çme¥aû
 
	gRDB_GLOBAL_INFO_FIELD
 {

679 ’um { 
	gTYPE
 = 0, 
	gNAME
, 
	gVALUE
 };

682 
ST_FIELD_INFO
 
	grdb_i_s_glob®_šfo_f›lds_šfo
[] = {

683 
ROCKSDB_FIELD_INFO
("TYPE", 
FN_REFLEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

684 
ROCKSDB_FIELD_INFO
("NAME", 
FN_REFLEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

685 
ROCKSDB_FIELD_INFO
("VALUE", 
FN_REFLEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

686 
ROCKSDB_FIELD_INFO_END
};

693 
rdb_glob®_šfo_fl_row
(
my_cÜe
::
THD
 *cÚ¡ 
thd
,

694 
my_cÜe
::
TABLE_LIST
 *cÚ¡ 
bËs
,

695 cÚ¡ *cÚ¡ 
ty³
,

696 cÚ¡ *cÚ¡ 
Çme
,

697 cÚ¡ *cÚ¡ 
v®ue
) {

698 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

699 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

700 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

701 
DBUG_ASSERT
(
ty³
 !ğ
nuÎ±r
);

702 
DBUG_ASSERT
(
Çme
 !ğ
nuÎ±r
);

703 
DBUG_ASSERT
(
v®ue
 !ğ
nuÎ±r
);

705 
F›ld
 **
	gf›ld
 = 
bËs
->
bË
->
f›ld
;

706 
DBUG_ASSERT
(
f›ld
 !ğ
nuÎ±r
);

708 
	gf›ld
[
RDB_GLOBAL_INFO_FIELD
::
TYPE
]->
¡Üe
(
ty³
, 
¡¾’
(type),

709 
sy¡em_ch¬£t_šfo
);

710 
	gf›ld
[
RDB_GLOBAL_INFO_FIELD
::
NAME
]->
¡Üe
(
Çme
, 
¡¾’
(name),

711 
sy¡em_ch¬£t_šfo
);

712 
	gf›ld
[
RDB_GLOBAL_INFO_FIELD
::
VALUE
]->
¡Üe
(
v®ue
, 
¡¾’
(value),

713 
sy¡em_ch¬£t_šfo
);

715  
	gmy_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
);

718 
rdb_i_s_glob®_šfo_fl_bË
(

719 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

720 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

721 
DBUG_ENTER_FUNC
();

723 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

724 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

726 cÚ¡ 
ušt32_t
 
	gINT_BUF_LEN
 = 21;

727 cÚ¡ 
ušt32_t
 
	gGTID_BUF_LEN
 = 60;

728 cÚ¡ 
ušt32_t
 
	gCF_ID_INDEX_BUF_LEN
 = 60;

730 
	g»t
 = 0;

732 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

734 ià(!
	grdb
) {

735 
DBUG_RETURN
(
»t
);

739 
Rdb_bšlog_mªag”
 *cÚ¡ 
	gblm
 = 
rdb_g‘_bšlog_mªag”
();

740 
DBUG_ASSERT
(
blm
 !ğ
nuÎ±r
);

742 
	gfe_buf
[
FN_REFLEN
 + 1] = {0};

743 
my_off_t
 
	gpos
 = 0;

744 
	gpos_buf
[
INT_BUF_LEN
] = {0};

745 
	ggtid_buf
[
GTID_BUF_LEN
] = {0};

747 ià(
	gblm
->
»ad
(
fe_buf
, &
pos
, 
gtid_buf
)) {

748 
¢´štf
(
pos_buf
, 
INT_BUF_LEN
, "%lu", (
ušt64_t
)
pos
);

750 
	g»t
 |ğ
rdb_glob®_šfo_fl_row
(
thd
, 
bËs
, "BINLOG", "FILE", 
fe_buf
);

751 
	g»t
 |ğ
rdb_glob®_šfo_fl_row
(
thd
, 
bËs
, "BINLOG", "POS", 
pos_buf
);

752 
	g»t
 |ğ
rdb_glob®_šfo_fl_row
(
thd
, 
bËs
, "BINLOG", "GTID", 
gtid_buf
);

756 cÚ¡ 
Rdb_diù_mªag”
 *cÚ¡ 
	gdiù_mªag”
 = 
rdb_g‘_diù_mªag”
();

757 
DBUG_ASSERT
(
diù_mªag”
 !ğ
nuÎ±r
);

759 
ušt32_t
 
	gmax_šdex_id
;

760 
	gmax_šdex_id_buf
[
INT_BUF_LEN
] = {0};

762 ià(
	gdiù_mªag”
->
g‘_max_šdex_id
(&
max_šdex_id
)) {

763 
¢´štf
(
max_šdex_id_buf
, 
INT_BUF_LEN
, "%u", 
max_šdex_id
);

765 
	g»t
 |ğ
rdb_glob®_šfo_fl_row
(
thd
, 
bËs
, "MAX_INDEX_ID", "MAX_INDEX_ID",

766 
max_šdex_id_buf
);

770 
	gcf_id_buf
[
INT_BUF_LEN
] = {0};

771 
	gcf_v®ue_buf
[
FN_REFLEN
 + 1] = {0};

772 cÚ¡ 
	gRdb_cf_mªag”
 &
	gcf_mªag”
 = 
rdb_g‘_cf_mªag”
();

774 cÚ¡‡utØ&
	gcf_hªdË
 : 
cf_mªag”
.
g‘_®l_cf
()) {

775 
DBUG_ASSERT
(
cf_hªdË
 !ğ
nuÎ±r
);

777 
ušt
 
	gæags
;

779 ià(!
	gdiù_mªag”
->
g‘_cf_æags
(
cf_hªdË
->
G‘ID
(), &
æags
)) {

781 
sql_´št_”rÜ
("RocksDB: Failedo get column family flags "

784 
cf_hªdË
->
G‘ID
());

785 
abÜt
();

788 
¢´štf
(
cf_id_buf
, 
INT_BUF_LEN
, "%u", 
cf_hªdË
->
G‘ID
());

789 
¢´štf
(
cf_v®ue_buf
, 
FN_REFLEN
, "% [%u]", 
cf_hªdË
->
G‘Name
().
c_¡r
(),

790 
æags
);

792 
	g»t
 |ğ
rdb_glob®_šfo_fl_row
(
thd
, 
bËs
, "CF_FLAGS", 
cf_id_buf
,

793 
cf_v®ue_buf
);

795 ià(
	g»t
) {

801 
	g¡d
::
unÜd”ed_£t
<
GL_INDEX_ID
> 
gl_šdex_ids
;

802 
	gdiù_mªag”
->
g‘_Úgošg_šdex_İ”©iÚ
(

803 &
gl_šdex_ids
, 
Rdb_key_def
::
DDL_DROP_INDEX_ONGOING
);

804 
	gcf_id_šdex_buf
[
CF_ID_INDEX_BUF_LEN
] = {0};

806 autØ
	ggl_šdex_id
 : 
gl_šdex_ids
) {

807 
¢´štf
(
cf_id_šdex_buf
, 
CF_ID_INDEX_BUF_LEN
, "cf_id:%u,index_id:%u",

808 
gl_šdex_id
.
cf_id
, gl_šdex_id.
šdex_id
);

810 
	g»t
 |ğ
rdb_glob®_šfo_fl_row
(
thd
, 
bËs
, "DDL_DROP_INDEX_ONGOING",

811 
cf_id_šdex_buf
, "");

813 ià(
	g»t
) {

818 
DBUG_RETURN
(
»t
);

824 
rdb_i_s_com·ù_¡©s_fl_bË
(

825 
my_cÜe
::
THD
 *
thd
, my_cÜe::
TABLE_LIST
 *
bËs
,

826 
my_cÜe
::
I‹m
 *
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

827 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

828 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

830 
DBUG_ENTER_FUNC
();

832 
	g»t
 = 0;

833 
	grocksdb
::
DB
 *
rdb
 = 
rdb_g‘_rocksdb_db
();

835 ià(!
	grdb
) {

836 
DBUG_RETURN
(
»t
);

839 
	gRdb_cf_mªag”
 &
	gcf_mªag”
 = 
rdb_g‘_cf_mªag”
();

841 autØ
	gcf_Çme
 : 
cf_mªag”
.
g‘_cf_Çmes
()) {

842 
rocksdb
::
CŞumnFamyHªdË
 *
cfh
 = 
cf_mªag”
.
g‘_cf
(
cf_Çme
);

844 ià(
	gcfh
 =ğ
nuÎ±r
) {

848 
	g¡d
::
m­
<
¡d
::
¡ršg
, std::¡ršg> 
´İs
;

849 
boŞ
 
boŞ_»t
 
MY_ATTRIBUTE
((
__unu£d__
));

850 
	gboŞ_»t
 = 
rdb
->
G‘M­Prİ”ty
(
cfh
, "rocksdb.cf¡©s", &
´İs
);

851 
DBUG_ASSERT
(
boŞ_»t
);

853 cÚ¡ 
	g¡d
::
¡ršg
 
´İ_Çme_´efix
 = "compaction.";

854 autØcÚ¡ &
	g´İ_’t
 : 
´İs
) {

855 
¡d
::
¡ršg
 
´İ_Çme
 = 
´İ_’t
.
fœ¡
;

856 ià(
	g´İ_Çme
.
fšd
(
´İ_Çme_´efix
) != 0) {

859 
	g¡d
::
¡ršg
 
v®ue
 = 
´İ_’t
.
£cÚd
;

860 
	g¡d
::
size_t
 
d–_pos
 = 
´İ_Çme
.
fšd
('.', 
´İ_Çme_´efix
.
size
());

861 
DBUG_ASSERT
(
d–_pos
 !ğ
¡d
::
¡ršg
::
Åos
);

862 
	g¡d
::
¡ršg
 
Ëv–_¡r
 = 
´İ_Çme
.
sub¡r
(

863 
´İ_Çme_´efix
.
size
(), 
d–_pos
 -…rop_name_prefix.size());

864 
	g¡d
::
¡ršg
 
ty³_¡r
 = 
´İ_Çme
.
sub¡r
(
d–_pos
 + 1);

866 
F›ld
 **
	gf›ld
 = 
bËs
->
bË
->
f›ld
;

867 
DBUG_ASSERT
(
f›ld
 !ğ
nuÎ±r
);

869 
	gf›ld
[0]->
¡Üe
(
cf_Çme
.
c_¡r
(), cf_Çme.
size
(), 
sy¡em_ch¬£t_šfo
);

870 
	gf›ld
[1]->
¡Üe
(
Ëv–_¡r
.
c_¡r
(),†ev–_¡r.
size
(), 
sy¡em_ch¬£t_šfo
);

871 
	gf›ld
[2]->
¡Üe
(
ty³_¡r
.
c_¡r
(),y³_¡r.
size
(), 
sy¡em_ch¬£t_šfo
);

872 
	gf›ld
[3]->
¡Üe
(
¡d
::
¡od
(
v®ue
));

874 
	g»t
 |ğ
¡©ic_ÿ¡
<>(

875 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

877 ià(
	g»t
 != 0) {

878 
DBUG_RETURN
(
»t
);

883 
DBUG_RETURN
(
»t
);

886 
ST_FIELD_INFO
 
	grdb_i_s_com·ù_¡©s_f›lds_šfo
[] = {

887 
ROCKSDB_FIELD_INFO
("CF_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

888 
ROCKSDB_FIELD_INFO
("LEVEL", 
FN_REFLEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

889 
ROCKSDB_FIELD_INFO
("TYPE", 
FN_REFLEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

890 
ROCKSDB_FIELD_INFO
("VALUE", (), 
MYSQL_TYPE_DOUBLE
, 0),

891 
ROCKSDB_FIELD_INFO_END
};

893 
	gÇme¥aû


895 
	gRdb_ddl_sÿÂ”
 : 
public
 
Rdb_bËs_sÿÂ”
 {

896 
my_cÜe
::
THD
 *
m_thd
;

897 
	gmy_cÜe
::
TABLE
 *
m_bË
;

899 
add_bË
(
Rdb_tbl_def
 *
tdef
è
	gov”ride
;

906 
Çme¥aû
 
	gRDB_DDL_FIELD
 {

908 
	gTABLE_SCHEMA
 = 0,

909 
	gTABLE_NAME
,

910 
	gPARTITION_NAME
,

911 
	gINDEX_NAME
,

912 
	gCOLUMN_FAMILY
,

913 
	gINDEX_NUMBER
,

914 
	gINDEX_TYPE
,

915 
	gKV_FORMAT_VERSION
,

916 
	gTTL_DURATION
,

917 
	gINDEX_FLAGS
,

918 
	gCF
,

919 
	gAUTO_INCREMENT


923 
ST_FIELD_INFO
 
	grdb_i_s_ddl_f›lds_šfo
[] = {

924 
ROCKSDB_FIELD_INFO
("TABLE_SCHEMA", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

925 
ROCKSDB_FIELD_INFO
("TABLE_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

926 
ROCKSDB_FIELD_INFO
("PARTITION_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
,

927 
MY_I_S_MAYBE_NULL
),

928 
ROCKSDB_FIELD_INFO
("INDEX_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

929 
ROCKSDB_FIELD_INFO
("COLUMN_FAMILY", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

930 
ROCKSDB_FIELD_INFO
("INDEX_NUMBER", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

931 
ROCKSDB_FIELD_INFO
("INDEX_TYPE", (
ušt16_t
), 
MYSQL_TYPE_SHORT
, 0),

932 
ROCKSDB_FIELD_INFO
("KV_FORMAT_VERSION", (
ušt16_t
), 
MYSQL_TYPE_SHORT
,

934 
ROCKSDB_FIELD_INFO
("TTL_DURATION", (
ušt64
), 
MYSQL_TYPE_LONGLONG
, 0),

935 
ROCKSDB_FIELD_INFO
("INDEX_FLAGS", (
ušt64
), 
MYSQL_TYPE_LONGLONG
, 0),

936 
ROCKSDB_FIELD_INFO
("CF", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

937 
ROCKSDB_FIELD_INFO
("AUTO_INCREMENT", (
ušt64_t
), 
MYSQL_TYPE_LONGLONG
,

938 
MY_I_S_MAYBE_NULL
 | 
MY_I_S_UNSIGNED
),

939 
ROCKSDB_FIELD_INFO_END
};

941 
	gRdb_ddl_sÿÂ”
::
add_bË
(
Rdb_tbl_def
 *
tdef
) {

942 
DBUG_ASSERT
(
tdef
 !ğ
nuÎ±r
);

944 
	g»t
 = 0;

946 
DBUG_ASSERT
(
m_bË
 !ğ
nuÎ±r
);

947 
F›ld
 **
	gf›ld
 = 
m_bË
->
f›ld
;

948 
DBUG_ASSERT
(
f›ld
 !ğ
nuÎ±r
);

949 cÚ¡ 
Rdb_diù_mªag”
 *
	gdiù_mªag”
 = 
rdb_g‘_diù_mªag”
();

951 cÚ¡ 
	g¡d
::
¡ršg
 &
dbÇme
 = 
tdef
->
ba£_dbÇme
();

952 
	gf›ld
[
RDB_DDL_FIELD
::
TABLE_SCHEMA
]->
¡Üe
(
dbÇme
.
c_¡r
(), dbÇme.
size
(),

953 
sy¡em_ch¬£t_šfo
);

955 cÚ¡ 
	g¡d
::
¡ršg
 &
bËÇme
 = 
tdef
->
ba£_bËÇme
();

956 
	gf›ld
[
RDB_DDL_FIELD
::
TABLE_NAME
]->
¡Üe
(
bËÇme
.
c_¡r
(),abËÇme.
size
(),

957 
sy¡em_ch¬£t_šfo
);

959 cÚ¡ 
	g¡d
::
¡ršg
 &
·¹Çme
 = 
tdef
->
ba£_·¹™iÚ
();

960 ià(
	g·¹Çme
.
Ëngth
() == 0) {

961 
f›ld
[
RDB_DDL_FIELD
::
PARTITION_NAME
]->
£t_nuÎ
();

963 
	gf›ld
[
RDB_DDL_FIELD
::
PARTITION_NAME
]->
£t_nÙnuÎ
();

964 
	gf›ld
[
RDB_DDL_FIELD
::
PARTITION_NAME
]->
¡Üe
(

965 
·¹Çme
.
c_¡r
(),…¬Šame.
size
(), 
sy¡em_ch¬£t_šfo
);

968 
ušt
 
	gi
 = 0; i < 
	gtdef
->
	gm_key_couÁ
; i++) {

969 cÚ¡ 
	gRdb_key_def
 &
	gkd
 = *
tdef
->
m_key_desü_¬r
[
i
];

971 
	gf›ld
[
RDB_DDL_FIELD
::
INDEX_NAME
]->
¡Üe
(
kd
.
m_Çme
.
c_¡r
(), kd.m_Çme.
size
(),

972 
sy¡em_ch¬£t_šfo
);

974 
GL_INDEX_ID
 
	ggl_šdex_id
 = 
kd
.
g‘_gl_šdex_id
();

975 
	gf›ld
[
RDB_DDL_FIELD
::
COLUMN_FAMILY
]->
¡Üe
(
gl_šdex_id
.
cf_id
, 
Œue
);

976 
	gf›ld
[
RDB_DDL_FIELD
::
INDEX_NUMBER
]->
¡Üe
(
gl_šdex_id
.
šdex_id
, 
Œue
);

977 
	gf›ld
[
RDB_DDL_FIELD
::
INDEX_TYPE
]->
¡Üe
(
kd
.
m_šdex_ty³
, 
Œue
);

978 
	gf›ld
[
RDB_DDL_FIELD
::
KV_FORMAT_VERSION
]->
¡Üe
(
kd
.
m_kv_fÜm©_v”siÚ
,

979 
Œue
);

980 
	gf›ld
[
RDB_DDL_FIELD
::
TTL_DURATION
]->
¡Üe
(
kd
.
m_‰l_du¿tiÚ
, 
Œue
);

981 
	gf›ld
[
RDB_DDL_FIELD
::
INDEX_FLAGS
]->
¡Üe
(
kd
.
m_šdex_æags_b™m­
, 
Œue
);

983 
	g¡d
::
¡ršg
 
cf_Çme
 = 
kd
.
g‘_cf
()->
G‘Name
();

984 
	gf›ld
[
RDB_DDL_FIELD
::
CF
]->
¡Üe
(
cf_Çme
.
c_¡r
(), cf_Çme.
size
(),

985 
sy¡em_ch¬£t_šfo
);

986 
ulÚglÚg
 
	gauto_šü
;

987 ià(
	gdiù_mªag”
->
g‘_auto_šü_v®
(
tdef
->
g‘_autošü_gl_šdex_id
(),

988 &
auto_šü
)) {

989 
	gf›ld
[
RDB_DDL_FIELD
::
AUTO_INCREMENT
]->
£t_nÙnuÎ
();

990 
	gf›ld
[
RDB_DDL_FIELD
::
AUTO_INCREMENT
]->
¡Üe
(
auto_šü
, 
Œue
);

992 
	gf›ld
[
RDB_DDL_FIELD
::
AUTO_INCREMENT
]->
£t_nuÎ
();

995 
	g»t
 = 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
m_thd
, 
m_bË
);

996 ià(
	g»t
)

997  
	g»t
;

999  
	gHA_EXIT_SUCCESS
;

1002 
rdb_i_s_ddl_fl_bË
(
my_cÜe
::
THD
 *cÚ¡ 
thd
,

1003 
my_cÜe
::
TABLE_LIST
 *cÚ¡ 
bËs
,

1004 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
) {

1005 
DBUG_ENTER_FUNC
();

1007 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

1008 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

1009 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

1011 
	g»t
 = 0;

1012 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

1014 ià(!
	grdb
) {

1015 
DBUG_RETURN
(
»t
);

1018 
Rdb_ddl_sÿÂ”
 
	gddl_¬g
;

1020 
	gddl_¬g
.
	gm_thd
 = 
thd
;

1021 
	gddl_¬g
.
	gm_bË
 = 
bËs
->
bË
;

1023 
Rdb_ddl_mªag”
 *
	gddl_mªag”
 = 
rdb_g‘_ddl_mªag”
();

1024 
DBUG_ASSERT
(
ddl_mªag”
 !ğ
nuÎ±r
);

1026 
	g»t
 = 
ddl_mªag”
->
sÿn_fÜ_bËs
(&
ddl_¬g
);

1028 
DBUG_RETURN
(
»t
);

1031 
rdb_i_s_ddl_š™
(*cÚ¡ 
p
) {

1032 
DBUG_ENTER_FUNC
();

1034 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

1036 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

1038 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

1040 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_ddl_f›lds_šfo
;

1041 
	gschema
->
	gfl_bË
 = 
rdb_i_s_ddl_fl_bË
;

1043 
DBUG_RETURN
(0);

1046 
rdb_i_s_cfİtiÚs_š™
(*cÚ¡ 
p
) {

1047 
DBUG_ENTER_FUNC
();

1049 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

1051 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

1053 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

1055 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_cfİtiÚs_f›lds_šfo
;

1056 
	gschema
->
	gfl_bË
 = 
rdb_i_s_cfİtiÚs_fl_bË
;

1058 
DBUG_RETURN
(0);

1061 
rdb_i_s_glob®_šfo_š™
(*cÚ¡ 
p
) {

1062 
DBUG_ENTER_FUNC
();

1064 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

1066 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

1068 
	gschema
 = 
»š‹½»t_ÿ¡
<
my_cÜe
::
ST_SCHEMA_TABLE
 *>(
p
);

1070 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_glob®_šfo_f›lds_šfo
;

1071 
	gschema
->
	gfl_bË
 = 
rdb_i_s_glob®_šfo_fl_bË
;

1073 
DBUG_RETURN
(0);

1076 
rdb_i_s_com·ù_¡©s_š™
(*
p
) {

1077 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

1079 
DBUG_ENTER_FUNC
();

1080 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

1082 
	gschema
 = 
»š‹½»t_ÿ¡
<
my_cÜe
::
ST_SCHEMA_TABLE
 *>(
p
);

1084 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_com·ù_¡©s_f›lds_šfo
;

1085 
	gschema
->
	gfl_bË
 = 
rdb_i_s_com·ù_¡©s_fl_bË
;

1087 
DBUG_RETURN
(0);

1091 
	g¡d
::
¡ršg
 
rdb_f’ame_w™hout_·th
(cÚ¡ 
¡d
::¡ršg &
·th
) {

1093 cÚ¡ 
size_t
 
pos
 = 
·th
.
rfšd
('/');

1096 ià(
	gpos
 =ğ
¡d
::
¡ršg
::
Åos
) {

1097  
¡d
::
¡ršg
(
·th
);

1101  
	g·th
.
sub¡r
(
pos
 + 1);

1107 
Çme¥aû
 
	gRDB_INDEX_FILE_MAP_FIELD
 {

1109 
	gCOLUMN_FAMILY
 = 0,

1110 
	gINDEX_NUMBER
,

1111 
	gSST_NAME
,

1112 
	gNUM_ROWS
,

1113 
	gDATA_SIZE
,

1114 
	gENTRY_DELETES
,

1115 
	gENTRY_SINGLEDELETES
,

1116 
	gENTRY_MERGES
,

1117 
	gENTRY_OTHERS
,

1118 
	gDISTINCT_KEYS_PREFIX


1122 
ST_FIELD_INFO
 
	grdb_i_s_šdex_fe_m­_f›lds_šfo
[] = {

1130 
ROCKSDB_FIELD_INFO
("COLUMN_FAMILY", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

1131 
ROCKSDB_FIELD_INFO
("INDEX_NUMBER", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

1132 
ROCKSDB_FIELD_INFO
("SST_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1133 
ROCKSDB_FIELD_INFO
("NUM_ROWS", (
št64_t
), 
MYSQL_TYPE_LONGLONG
, 0),

1134 
ROCKSDB_FIELD_INFO
("DATA_SIZE", (
št64_t
), 
MYSQL_TYPE_LONGLONG
, 0),

1135 
ROCKSDB_FIELD_INFO
("ENTRY_DELETES", (
št64_t
), 
MYSQL_TYPE_LONGLONG
,

1137 
ROCKSDB_FIELD_INFO
("ENTRY_SINGLEDELETES", (
št64_t
),

1138 
MYSQL_TYPE_LONGLONG
, 0),

1139 
ROCKSDB_FIELD_INFO
("ENTRY_MERGES", (
št64_t
), 
MYSQL_TYPE_LONGLONG
, 0),

1140 
ROCKSDB_FIELD_INFO
("ENTRY_OTHERS", (
št64_t
), 
MYSQL_TYPE_LONGLONG
, 0),

1141 
ROCKSDB_FIELD_INFO
("DISTINCT_KEYS_PREFIX", 
MAX_REF_PARTS
 * 25,

1142 
MYSQL_TYPE_STRING
, 0),

1143 
ROCKSDB_FIELD_INFO_END
};

1146 
rdb_i_s_šdex_fe_m­_fl_bË
(

1147 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

1148 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

1149 
DBUG_ENTER_FUNC
();

1151 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

1152 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

1153 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

1155 
	g»t
 = 0;

1156 
F›ld
 **
	gf›ld
 = 
bËs
->
bË
->
f›ld
;

1157 
DBUG_ASSERT
(
f›ld
 !ğ
nuÎ±r
);

1160 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

1162 ià(!
	grdb
) {

1163 
DBUG_RETURN
(
»t
);

1166 cÚ¡ 
	gRdb_cf_mªag”
 &
	gcf_mªag”
 = 
rdb_g‘_cf_mªag”
();

1168 cÚ¡‡utØ&
	gcf_hªdË
 : 
cf_mªag”
.
g‘_®l_cf
()) {

1170 
rocksdb
::
TabËPrİ”t›sCŞËùiÚ
 
bË_´İs_cŞËùiÚ
;

1171 cÚ¡ 
	grocksdb
::
Stus
 
s
 =

1172 
rdb
->
G‘Prİ”t›sOfAÎTabËs
(
cf_hªdË
, &
bË_´İs_cŞËùiÚ
);

1174 ià(!
	gs
.
ok
()) {

1180 cÚ¡‡utØ&
	g´İs
 : 
bË_´İs_cŞËùiÚ
) {

1182 cÚ¡ 
¡d
::
¡ršg
 
s¡_Çme
 = 
rdb_f’ame_w™hout_·th
(
´İs
.
fœ¡
);

1184 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
SST_NAME
]->
¡Üe
(

1185 
s¡_Çme
.
d©a
(), s¡_Çme.
size
(), 
sy¡em_ch¬£t_šfo
);

1188 
	g¡d
::
veùÜ
<
Rdb_šdex_¡©s
> 
¡©s
;

1189 
	gRdb_tbl_´İ_cŞl
::
»ad_¡©s_äom_tbl_´İs
(
´İs
.
£cÚd
, &
¡©s
);

1191 ià(
	g¡©s
.
em±y
()) {

1192 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
COLUMN_FAMILY
]->
¡Üe
(-1, 
Œue
);

1193 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
INDEX_NUMBER
]->
¡Üe
(-1, 
Œue
);

1194 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
NUM_ROWS
]->
¡Üe
(-1, 
Œue
);

1195 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
DATA_SIZE
]->
¡Üe
(-1, 
Œue
);

1196 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
ENTRY_DELETES
]->
¡Üe
(-1, 
Œue
);

1197 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
ENTRY_SINGLEDELETES
]->
¡Üe
(-1, 
Œue
);

1198 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
ENTRY_MERGES
]->
¡Üe
(-1, 
Œue
);

1199 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
ENTRY_OTHERS
]->
¡Üe
(-1, 
Œue
);

1201 cÚ¡‡utØ&
	g™
 : 
¡©s
) {

1204 
f›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
COLUMN_FAMILY
]->
¡Üe
(

1205 
™
.
m_gl_šdex_id
.
cf_id
, 
Œue
);

1206 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
INDEX_NUMBER
]->
¡Üe
(

1207 
™
.
m_gl_šdex_id
.
šdex_id
, 
Œue
);

1208 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
NUM_ROWS
]->
¡Üe
(
™
.
m_rows
, 
Œue
);

1209 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
DATA_SIZE
]->
¡Üe
(
™
.
m_d©a_size
,

1210 
Œue
);

1211 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
ENTRY_DELETES
]->
¡Üe
(

1212 
™
.
m_’Œy_d–‘es
, 
Œue
);

1213 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
ENTRY_SINGLEDELETES
]->
¡Üe
(

1214 
™
.
m_’Œy_sšgË_d–‘es
, 
Œue
);

1215 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
ENTRY_MERGES
]->
¡Üe
(

1216 
™
.
m_’Œy_m”ges
, 
Œue
);

1217 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
ENTRY_OTHERS
]->
¡Üe
(

1218 
™
.
m_’Œy_Ùh”s
, 
Œue
);

1220 
	g¡d
::
¡ršg
 
di¡šù_keys_´efix
;

1222 
size_t
 
	gi
 = 0; i < 
	g™
.
	gm_di¡šù_keys_³r_´efix
.
size
(); i++) {

1223 ià(
	gi
 > 0) {

1224 
	gdi¡šù_keys_´efix
 += ",";

1227 
	gdi¡šù_keys_´efix
 +=

1228 
¡d
::
to_¡ršg
(
™
.
m_di¡šù_keys_³r_´efix
[
i
]);

1231 
	gf›ld
[
RDB_INDEX_FILE_MAP_FIELD
::
DISTINCT_KEYS_PREFIX
]->
¡Üe
(

1232 
di¡šù_keys_´efix
.
d©a
(), di¡šù_keys_´efix.
size
(),

1233 
sy¡em_ch¬£t_šfo
);

1236 
	g»t
 = 
¡©ic_ÿ¡
<>(

1237 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

1239 ià(
	g»t
 != 0) {

1247 
DBUG_RETURN
(
»t
);

1251 
rdb_i_s_šdex_fe_m­_š™
(*cÚ¡ 
p
) {

1252 
DBUG_ENTER_FUNC
();

1254 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

1256 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

1258 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

1260 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_šdex_fe_m­_f›lds_šfo
;

1261 
	gschema
->
	gfl_bË
 = 
rdb_i_s_šdex_fe_m­_fl_bË
;

1263 
DBUG_RETURN
(0);

1269 
Çme¥aû
 
	gRDB_LOCKS_FIELD
 {

1270 ’um { 
	gCOLUMN_FAMILY_ID
 = 0, 
	gTRANSACTION_ID
, 
	gKEY
, 
	gMODE
 };

1273 
ST_FIELD_INFO
 
	grdb_i_s_lock_šfo_f›lds_šfo
[] = {

1274 
ROCKSDB_FIELD_INFO
("COLUMN_FAMILY_ID", (
ušt32_t
), 
MYSQL_TYPE_LONG
,

1276 
ROCKSDB_FIELD_INFO
("TRANSACTION_ID", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

1277 
ROCKSDB_FIELD_INFO
("KEY", 
FN_REFLEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1278 
ROCKSDB_FIELD_INFO
("MODE", 32, 
MYSQL_TYPE_STRING
, 0),

1279 
ROCKSDB_FIELD_INFO_END
};

1282 
rdb_i_s_lock_šfo_fl_bË
(

1283 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

1284 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

1285 
DBUG_ENTER_FUNC
();

1287 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

1288 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

1289 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

1290 
DBUG_ASSERT
(
bËs
->
bË
->
f›ld
 !ğ
nuÎ±r
);

1292 
	g»t
 = 0;

1294 
	grocksdb
::
T¿n§ùiÚDB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

1296 ià(!
	grdb
) {

1297 
DBUG_RETURN
(
»t
);

1301 
	g¡d
::
unÜd”ed_muÉim­
<
ušt32_t
, 
	grocksdb
::
KeyLockInfo
> 
lock_šfo
 =

1302 
rdb
->
G‘LockStusD©a
();

1304 cÚ¡‡utØ&
	glock
 : 
lock_šfo
) {

1305 cÚ¡ 
ušt32_t
 
cf_id
 = 
lock
.
fœ¡
;

1306 cÚ¡‡utØ&
	gkey_lock_šfo
 = 
lock
.
£cÚd
;

1307 cÚ¡‡utØ
	gkey_hex¡r
 = 
rdb_hexdump
(
key_lock_šfo
.
key
.
c_¡r
(),

1308 
key_lock_šfo
.
key
.
Ëngth
(), 
FN_REFLEN
);

1310 cÚ¡‡utØ&
	gid
 : 
key_lock_šfo
.
ids
) {

1311 
bËs
->
bË
->
f›ld
[
RDB_LOCKS_FIELD
::
COLUMN_FAMILY_ID
]->
¡Üe
(
cf_id
,

1312 
Œue
);

1313 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_LOCKS_FIELD
::
TRANSACTION_ID
]->
¡Üe
(
id
, 
Œue
);

1315 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_LOCKS_FIELD
::
KEY
]->
¡Üe
(

1316 
key_hex¡r
.
c_¡r
(), key_hex¡r.
size
(), 
sy¡em_ch¬£t_šfo
);

1317 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_LOCKS_FIELD
::
MODE
]->
¡Üe
(

1318 
key_lock_šfo
.
exşusive
 ? "X" : "S", 1, 
sy¡em_ch¬£t_šfo
);

1321 
	g»t
 = 
¡©ic_ÿ¡
<>(

1322 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

1324 ià(
	g»t
 != 0) {

1330 
DBUG_RETURN
(
»t
);

1334 
rdb_i_s_lock_šfo_š™
(*cÚ¡ 
p
) {

1335 
DBUG_ENTER_FUNC
();

1337 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

1339 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

1341 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

1343 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_lock_šfo_f›lds_šfo
;

1344 
	gschema
->
	gfl_bË
 = 
rdb_i_s_lock_šfo_fl_bË
;

1346 
DBUG_RETURN
(0);

1352 
Çme¥aû
 
	gRDB_TRX_FIELD
 {

1354 
	gTRANSACTION_ID
 = 0,

1355 
	gSTATE
,

1356 
	gNAME
,

1357 
	gWRITE_COUNT
,

1358 
	gLOCK_COUNT
,

1359 
	gTIMEOUT_SEC
,

1360 
	gWAITING_KEY
,

1361 
	gWAITING_COLUMN_FAMILY_ID
,

1362 
	gIS_REPLICATION
,

1363 
	gSKIP_TRX_API
,

1364 
	gREAD_ONLY
,

1365 
	gHAS_DEADLOCK_DETECTION
,

1366 
	gNUM_ONGOING_BULKLOAD
,

1367 
	gTHREAD_ID
,

1368 
	gQUERY


1372 
ST_FIELD_INFO
 
	grdb_i_s_Œx_šfo_f›lds_šfo
[] = {

1373 
ROCKSDB_FIELD_INFO
("TRANSACTION_ID", (
ulÚglÚg
), 
MYSQL_TYPE_LONGLONG
,

1375 
ROCKSDB_FIELD_INFO
("STATE", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1376 
ROCKSDB_FIELD_INFO
("NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1377 
ROCKSDB_FIELD_INFO
("WRITE_COUNT", (
ulÚglÚg
), 
MYSQL_TYPE_LONGLONG
,

1379 
ROCKSDB_FIELD_INFO
("LOCK_COUNT", (
ulÚglÚg
), 
MYSQL_TYPE_LONGLONG
, 0),

1380 
ROCKSDB_FIELD_INFO
("TIMEOUT_SEC", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

1381 
ROCKSDB_FIELD_INFO
("WAITING_KEY", 
FN_REFLEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1382 
ROCKSDB_FIELD_INFO
("WAITING_COLUMN_FAMILY_ID", (
ušt32_t
),

1383 
MYSQL_TYPE_LONG
, 0),

1384 
ROCKSDB_FIELD_INFO
("IS_REPLICATION", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

1385 
ROCKSDB_FIELD_INFO
("SKIP_TRX_API", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

1386 
ROCKSDB_FIELD_INFO
("READ_ONLY", (
ušt32_t
), 
MYSQL_TYPE_LONG
, 0),

1387 
ROCKSDB_FIELD_INFO
("HAS_DEADLOCK_DETECTION", (
ušt32_t
),

1388 
MYSQL_TYPE_LONG
, 0),

1389 
ROCKSDB_FIELD_INFO
("NUM_ONGOING_BULKLOAD", (
ušt32_t
),

1390 
MYSQL_TYPE_LONG
, 0),

1391 
ROCKSDB_FIELD_INFO
("THREAD_ID", (
ulÚg
), 
MYSQL_TYPE_LONG
, 0),

1392 
ROCKSDB_FIELD_INFO
("QUERY", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1393 
ROCKSDB_FIELD_INFO_END
};

1396 
rdb_i_s_Œx_šfo_fl_bË
(

1397 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

1398 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

1399 
DBUG_ENTER_FUNC
();

1401 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

1402 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

1403 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

1404 
DBUG_ASSERT
(
bËs
->
bË
->
f›ld
 !ğ
nuÎ±r
);

1406 
	g»t
 = 0;

1407 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

1409 ià(!
	grdb
) {

1410 
DBUG_RETURN
(
»t
);

1413 cÚ¡ 
	g¡d
::
veùÜ
<
Rdb_Œx_šfo
> &
®l_Œx_šfo
 = 
rdb_g‘_®l_Œx_šfo
();

1415 cÚ¡‡utØ&
	gšfo
 : 
®l_Œx_šfo
) {

1416 autØ
Çme_hex¡r
 =

1417 
rdb_hexdump
(
šfo
.
Çme
.
c_¡r
(), info.Çme.
Ëngth
(), 
NAME_LEN
);

1418 autØ
	gkey_hex¡r
 = 
rdb_hexdump
(
šfo
.
wa™šg_key
.
c_¡r
(),

1419 
šfo
.
wa™šg_key
.
Ëngth
(), 
FN_REFLEN
);

1421 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
TRANSACTION_ID
]->
¡Üe
(
šfo
.
Œx_id
,

1422 
Œue
);

1423 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
STATE
]->
¡Üe
(

1424 
šfo
.
¡©e
.
c_¡r
(), info.¡©e.
Ëngth
(), 
sy¡em_ch¬£t_šfo
);

1425 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
NAME
]->
¡Üe
(

1426 
Çme_hex¡r
.
c_¡r
(),‚ame_hex¡r.
Ëngth
(), 
sy¡em_ch¬£t_šfo
);

1427 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
WRITE_COUNT
]->
¡Üe
(
šfo
.
wr™e_couÁ
,

1428 
Œue
);

1429 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
LOCK_COUNT
]->
¡Üe
(
šfo
.
lock_couÁ
,

1430 
Œue
);

1431 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
TIMEOUT_SEC
]->
¡Üe
(
šfo
.
timeout_£c
,

1432 
çl£
);

1433 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
WAITING_KEY
]->
¡Üe
(

1434 
key_hex¡r
.
c_¡r
(), key_hex¡r.
Ëngth
(), 
sy¡em_ch¬£t_šfo
);

1435 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
WAITING_COLUMN_FAMILY_ID
]->
¡Üe
(

1436 
šfo
.
wa™šg_cf_id
, 
Œue
);

1437 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
IS_REPLICATION
]->
¡Üe
(

1438 
šfo
.
is_»¶iÿtiÚ
, 
çl£
);

1439 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
SKIP_TRX_API
]->
¡Üe
(
šfo
.
sk_Œx_­i
,

1440 
çl£
);

1441 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
READ_ONLY
]->
¡Üe
(
šfo
.
»ad_Úly
,

1442 
çl£
);

1443 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
HAS_DEADLOCK_DETECTION
]->
¡Üe
(

1444 
šfo
.
d—dlock_d‘eù
, 
çl£
);

1445 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
NUM_ONGOING_BULKLOAD
]->
¡Üe
(

1446 
šfo
.
num_Úgošg_bulk_lßd
, 
çl£
);

1447 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
THREAD_ID
]->
¡Üe
(
šfo
.
th»ad_id
, 
Œue
);

1448 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_TRX_FIELD
::
QUERY
]->
¡Üe
(

1449 
šfo
.
qu”y_¡r
.
c_¡r
(), info.qu”y_¡r.
Ëngth
(), 
sy¡em_ch¬£t_šfo
);

1452 
	g»t
 = 
¡©ic_ÿ¡
<>(

1453 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

1455 ià(
	g»t
 != 0) {

1460 
DBUG_RETURN
(
»t
);

1464 
rdb_i_s_Œx_šfo_š™
(*cÚ¡ 
p
) {

1465 
DBUG_ENTER_FUNC
();

1467 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

1469 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

1471 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

1473 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_Œx_šfo_f›lds_šfo
;

1474 
	gschema
->
	gfl_bË
 = 
rdb_i_s_Œx_šfo_fl_bË
;

1476 
DBUG_RETURN
(0);

1482 
Çme¥aû
 
	gRDB_DEADLOCK_FIELD
 {

1484 
	gDEADLOCK_ID
 = 0,

1485 
	gTRANSACTION_ID
,

1486 
	gCF_NAME
,

1487 
	gWAITING_KEY
,

1488 
	gLOCK_TYPE
,

1489 
	gINDEX_NAME
,

1490 
	gTABLE_NAME
,

1491 
	gROLLED_BACK


1495 
ST_FIELD_INFO
 
	grdb_i_s_d—dlock_šfo_f›lds_šfo
[] = {

1496 
ROCKSDB_FIELD_INFO
("DEADLOCK_ID", (
ulÚglÚg
), 
MYSQL_TYPE_LONGLONG
,

1498 
ROCKSDB_FIELD_INFO
("TRANSACTION_ID", (
ulÚglÚg
), 
MYSQL_TYPE_LONGLONG
,

1500 
ROCKSDB_FIELD_INFO
("CF_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1501 
ROCKSDB_FIELD_INFO
("WAITING_KEY", 
FN_REFLEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1502 
ROCKSDB_FIELD_INFO
("LOCK_TYPE", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1503 
ROCKSDB_FIELD_INFO
("INDEX_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1504 
ROCKSDB_FIELD_INFO
("TABLE_NAME", 
NAME_LEN
 + 1, 
MYSQL_TYPE_STRING
, 0),

1505 
ROCKSDB_FIELD_INFO
("ROLLED_BACK", (
ulÚglÚg
), 
MYSQL_TYPE_LONGLONG
,

1507 
ROCKSDB_FIELD_INFO_END
};

1510 
rdb_i_s_d—dlock_šfo_fl_bË
(

1511 
my_cÜe
::
THD
 *cÚ¡ 
thd
, my_cÜe::
TABLE_LIST
 *cÚ¡ 
bËs
,

1512 
my_cÜe
::
I‹m
 *cÚ¡ 
cÚd
 
MY_ATTRIBUTE
((
__unu£d__
))) {

1513 
DBUG_ENTER_FUNC
();

1515 
DBUG_ASSERT
(
thd
 !ğ
nuÎ±r
);

1516 
DBUG_ASSERT
(
bËs
 !ğ
nuÎ±r
);

1517 
DBUG_ASSERT
(
bËs
->
bË
 !ğ
nuÎ±r
);

1518 
DBUG_ASSERT
(
bËs
->
bË
->
f›ld
 !ğ
nuÎ±r
);

1520 cÚ¡ 
	g¡d
::
¡ršg
 
¡r_exşusive
("EXCLUSIVE");

1521 cÚ¡ 
	g¡d
::
¡ršg
 
¡r_sh¬ed
("SHARED");

1523 
	g»t
 = 0;

1524 
	grocksdb
::
DB
 *cÚ¡ 
rdb
 = 
rdb_g‘_rocksdb_db
();

1526 ià(!
	grdb
) {

1527 
DBUG_RETURN
(
»t
);

1530 cÚ¡ 
	g¡d
::
veùÜ
<
Rdb_d—dlock_šfo
> &
®l_dl_šfo
 = 
rdb_g‘_d—dlock_šfo
();

1532 
ulÚglÚg
 
	gid
 = 0;

1533 cÚ¡‡utØ&
	gšfo
 : 
®l_dl_šfo
) {

1534 cÚ¡‡utØ&
Œx_šfo
 : 
šfo
.
·th
) {

1535 
bËs
->
bË
->
f›ld
[
RDB_DEADLOCK_FIELD
::
DEADLOCK_ID
]->
¡Üe
(
id
, 
Œue
);

1536 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DEADLOCK_FIELD
::
TRANSACTION_ID
]->
¡Üe
(

1537 
Œx_šfo
.
Œx_id
, 
Œue
);

1538 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DEADLOCK_FIELD
::
CF_NAME
]->
¡Üe
(

1539 
Œx_šfo
.
cf_Çme
.
c_¡r
(),rx_šfo.cf_Çme.
Ëngth
(),

1540 
sy¡em_ch¬£t_šfo
);

1541 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DEADLOCK_FIELD
::
WAITING_KEY
]->
¡Üe
(

1542 
Œx_šfo
.
wa™šg_key
.
c_¡r
(),rx_šfo.wa™šg_key.
Ëngth
(),

1543 
sy¡em_ch¬£t_šfo
);

1544 ià(
	gŒx_šfo
.
	gexşusive_lock
) {

1545 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DEADLOCK_FIELD
::
LOCK_TYPE
]->
¡Üe
(

1546 
¡r_exşusive
.
c_¡r
(), sŒ_exşusive.
Ëngth
(), 
sy¡em_ch¬£t_šfo
);

1548 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DEADLOCK_FIELD
::
LOCK_TYPE
]->
¡Üe
(

1549 
¡r_sh¬ed
.
c_¡r
(), sŒ_sh¬ed.
Ëngth
(), 
sy¡em_ch¬£t_šfo
);

1551 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DEADLOCK_FIELD
::
INDEX_NAME
]->
¡Üe
(

1552 
Œx_šfo
.
šdex_Çme
.
c_¡r
(),rx_šfo.šdex_Çme.
Ëngth
(),

1553 
sy¡em_ch¬£t_šfo
);

1554 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DEADLOCK_FIELD
::
TABLE_NAME
]->
¡Üe
(

1555 
Œx_šfo
.
bË_Çme
.
c_¡r
(),rx_šfo.bË_Çme.
Ëngth
(),

1556 
sy¡em_ch¬£t_šfo
);

1557 
	gbËs
->
	gbË
->
	gf›ld
[
RDB_DEADLOCK_FIELD
::
ROLLED_BACK
]->
¡Üe
(

1558 
Œx_šfo
.
Œx_id
 =ğ
šfo
.
viùim_Œx_id
, 
Œue
);

1561 
	g»t
 = 
¡©ic_ÿ¡
<>(

1562 
my_cÜe
::
schema_bË_¡Üe_»cÜd
(
thd
, 
bËs
->
bË
));

1564 ià(
	g»t
 != 0) {

1568 
	gid
++;

1571 
DBUG_RETURN
(
»t
);

1575 
rdb_i_s_d—dlock_šfo_š™
(*cÚ¡ 
p
) {

1576 
DBUG_ENTER_FUNC
();

1578 
DBUG_ASSERT
(
p
 !ğ
nuÎ±r
);

1580 
	gmy_cÜe
::
ST_SCHEMA_TABLE
 *
schema
;

1582 
	gschema
 = (
my_cÜe
::
ST_SCHEMA_TABLE
 *)
p
;

1584 
	gschema
->
	gf›lds_šfo
 = 
rdb_i_s_d—dlock_šfo_f›lds_šfo
;

1585 
	gschema
->
	gfl_bË
 = 
rdb_i_s_d—dlock_šfo_fl_bË
;

1587 
DBUG_RETURN
(0);

1590 
rdb_i_s_deš™
(*
p
 
MY_ATTRIBUTE
((
__unu£d__
))) {

1591 
DBUG_ENTER_FUNC
();

1592 
DBUG_RETURN
(0);

1595 
¡_mysql_šfÜm©iÚ_schema
 
	grdb_i_s_šfo
 = {

1596 
MYSQL_INFORMATION_SCHEMA_INTERFACE_VERSION
};

1598 
¡_mysql_¶ugš
 
	grdb_i_s_cf¡©s
 = {

1599 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1600 &
rdb_i_s_šfo
,

1604 
PLUGIN_LICENSE_GPL
,

1605 
rdb_i_s_cf¡©s_š™
,

1606 
rdb_i_s_deš™
,

1608 
nuÎ±r
,

1609 
nuÎ±r
,

1610 
nuÎ±r
,

1614 
¡_mysql_¶ugš
 
	grdb_i_s_db¡©s
 = {

1615 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1616 &
rdb_i_s_šfo
,

1620 
PLUGIN_LICENSE_GPL
,

1621 
rdb_i_s_db¡©s_š™
,

1622 
rdb_i_s_deš™
,

1624 
nuÎ±r
,

1625 
nuÎ±r
,

1626 
nuÎ±r
,

1630 
¡_mysql_¶ugš
 
	grdb_i_s_³rf_cÚ‹xt
 = {

1631 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1632 &
rdb_i_s_šfo
,

1636 
PLUGIN_LICENSE_GPL
,

1637 
rdb_i_s_³rf_cÚ‹xt_š™
,

1638 
rdb_i_s_deš™
,

1640 
nuÎ±r
,

1641 
nuÎ±r
,

1642 
nuÎ±r
,

1646 
¡_mysql_¶ugš
 
	grdb_i_s_³rf_cÚ‹xt_glob®
 = {

1647 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1648 &
rdb_i_s_šfo
,

1652 
PLUGIN_LICENSE_GPL
,

1653 
rdb_i_s_³rf_cÚ‹xt_glob®_š™
,

1654 
rdb_i_s_deš™
,

1656 
nuÎ±r
,

1657 
nuÎ±r
,

1658 
nuÎ±r
,

1662 
¡_mysql_¶ugš
 
	grdb_i_s_cfİtiÚs
 = {

1663 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1664 &
rdb_i_s_šfo
,

1668 
PLUGIN_LICENSE_GPL
,

1669 
rdb_i_s_cfİtiÚs_š™
,

1670 
rdb_i_s_deš™
,

1672 
nuÎ±r
,

1673 
nuÎ±r
,

1674 
nuÎ±r
,

1678 
¡_mysql_¶ugš
 
	grdb_i_s_glob®_šfo
 = {

1679 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1680 &
rdb_i_s_šfo
,

1684 
PLUGIN_LICENSE_GPL
,

1685 
rdb_i_s_glob®_šfo_š™
,

1686 
rdb_i_s_deš™
,

1688 
nuÎ±r
,

1689 
nuÎ±r
,

1690 
nuÎ±r
,

1694 
¡_mysql_¶ugš
 
	grdb_i_s_com·ù_¡©s
 = {

1695 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1696 &
rdb_i_s_šfo
,

1700 
PLUGIN_LICENSE_GPL
,

1701 
rdb_i_s_com·ù_¡©s_š™
,

1702 
rdb_i_s_deš™
,

1704 
nuÎ±r
,

1705 
nuÎ±r
,

1706 
nuÎ±r
,

1710 
¡_mysql_¶ugš
 
	grdb_i_s_ddl
 = {

1711 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1712 &
rdb_i_s_šfo
,

1716 
PLUGIN_LICENSE_GPL
,

1717 
rdb_i_s_ddl_š™
,

1718 
rdb_i_s_deš™
,

1720 
nuÎ±r
,

1721 
nuÎ±r
,

1722 
nuÎ±r
,

1726 
¡_mysql_¶ugš
 
	grdb_i_s_šdex_fe_m­
 = {

1727 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1728 &
rdb_i_s_šfo
,

1732 
PLUGIN_LICENSE_GPL
,

1733 
rdb_i_s_šdex_fe_m­_š™
,

1734 
rdb_i_s_deš™
,

1736 
nuÎ±r
,

1737 
nuÎ±r
,

1738 
nuÎ±r
,

1742 
¡_mysql_¶ugš
 
	grdb_i_s_lock_šfo
 = {

1743 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1744 &
rdb_i_s_šfo
,

1748 
PLUGIN_LICENSE_GPL
,

1749 
rdb_i_s_lock_šfo_š™
,

1750 
nuÎ±r
,

1752 
nuÎ±r
,

1753 
nuÎ±r
,

1754 
nuÎ±r
,

1758 
¡_mysql_¶ugš
 
	grdb_i_s_Œx_šfo
 = {

1759 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1760 &
rdb_i_s_šfo
,

1764 
PLUGIN_LICENSE_GPL
,

1765 
rdb_i_s_Œx_šfo_š™
,

1766 
nuÎ±r
,

1768 
nuÎ±r
,

1769 
nuÎ±r
,

1770 
nuÎ±r
,

1774 
¡_mysql_¶ugš
 
	grdb_i_s_d—dlock_šfo
 = {

1775 
MYSQL_INFORMATION_SCHEMA_PLUGIN
,

1776 &
rdb_i_s_šfo
,

1780 
PLUGIN_LICENSE_GPL
,

1781 
rdb_i_s_d—dlock_šfo_š™
,

1782 
nuÎ±r
,

1784 
nuÎ±r
,

1785 
nuÎ±r
,

1786 
nuÎ±r
,

	@rdb_i_s.h

16 #´agm¨
Úû


18 
Çme¥aû
 
	gmyrocks
 {

24 
¡_mysql_¶ugš
 
rdb_i_s_cf¡©s
;

25 
¡_mysql_¶ugš
 
rdb_i_s_db¡©s
;

26 
¡_mysql_¶ugš
 
rdb_i_s_³rf_cÚ‹xt
;

27 
¡_mysql_¶ugš
 
rdb_i_s_³rf_cÚ‹xt_glob®
;

28 
¡_mysql_¶ugš
 
rdb_i_s_cfİtiÚs
;

29 
¡_mysql_¶ugš
 
rdb_i_s_com·ù_¡©s
;

30 
¡_mysql_¶ugš
 
rdb_i_s_glob®_šfo
;

31 
¡_mysql_¶ugš
 
rdb_i_s_ddl
;

32 
¡_mysql_¶ugš
 
rdb_i_s_šdex_fe_m­
;

33 
¡_mysql_¶ugš
 
rdb_i_s_lock_šfo
;

34 
¡_mysql_¶ugš
 
rdb_i_s_Œx_šfo
;

35 
¡_mysql_¶ugš
 
rdb_i_s_d—dlock_šfo
;

	@rdb_index_merge.cc

18 
	~"rdb_šdex_m”ge.h
"

21 
	~"../sql/sql_şass.h
"

24 
	~"ha_rocksdb.h
"

25 
	~"rdb_d©adic.h
"

27 
Çme¥aû
 
	gmyrocks
 {

29 
	gRdb_šdex_m”ge
::
Rdb_šdex_m”ge
(cÚ¡ *cÚ¡ 
tmpfe_·th
,

30 cÚ¡ 
ulÚglÚg
 &
m”ge_buf_size
,

31 cÚ¡ 
ulÚglÚg
 &
m”ge_combše_»ad_size
,

32 cÚ¡ 
ulÚglÚg
 &
m”ge_tmp_fe_»mov®_d–ay
,

33 
rocksdb
::
CŞumnFamyHªdË
 *
cf
)

34 : 
m_tmpfe_·th
(
tmpfe_·th
), 
m_m”ge_buf_size
(
m”ge_buf_size
),

35 
m_m”ge_combše_»ad_size
(
m”ge_combše_»ad_size
),

36 
m_m”ge_tmp_fe_»mov®_d–ay
(
m”ge_tmp_fe_»mov®_d–ay
),

37 
m_cf_hªdË
(
cf
), 
m_»c_buf_unsÜ‹d
(
nuÎ±r
), 
m_ouut_buf
(nullptr) {}

39 
	gRdb_šdex_m”ge
::~
Rdb_šdex_m”ge
() {

46 ià(
m_m”ge_tmp_fe_»mov®_d–ay
 > 0) {

47 
ušt64
 
cu¼_size
 = 
m_m”ge_buf_size
 * 
m_m”ge_fe
.
m_num_sÜt_bufãrs
;

48 
ušt
 
	gi
 = 0; i < 
	gm_m”ge_fe
.
	gm_num_sÜt_bufãrs
; i++) {

49 ià(
my_chsize
(
m_m”ge_fe
.
m_fd
, 
cu¼_size
, 0, 
MYF
(
MY_WME
))) {

51 
sql_´št_”rÜ
("Errorruncating file during fast index creation.");

54 
my_¦“p
(
m_m”ge_tmp_fe_»mov®_d–ay
 * 1000);

56 ià(
mysql_fe_sync
(
m_m”ge_fe
.
m_fd
, 
MYF
(
MY_WME
))) {

58 
sql_´št_”rÜ
("Error flushingruncated MyRocks merge buffer.");

60 
	gcu¼_size
 -ğ
m_m”ge_buf_size
;

68 
my_şo£
(
m_m”ge_fe
.
m_fd
, 
MYF
(
MY_WME
));

71 
	gRdb_šdex_m”ge
::
š™
() {

76 ià(
m”ge_fe_ü—‹
()) {

77  
HA_ERR_ROCKSDB_MERGE_FILE_ERR
;

85 
	gm_»c_buf_unsÜ‹d
 =

86 
¡d
::
sh¬ed_±r
<
m”ge_buf_šfo
>(
Ãw
 m”ge_buf_šfo(
m_m”ge_buf_size
));

92 
	gm_ouut_buf
 =

93 
¡d
::
sh¬ed_±r
<
m”ge_buf_šfo
>(
Ãw
 m”ge_buf_šfo(
m_m”ge_buf_size
));

95  
	gHA_EXIT_SUCCESS
;

101 
	gRdb_šdex_m”ge
::
m”ge_fe_ü—‹
() {

102 
DBUG_ASSERT
(
m_m”ge_fe
.
m_fd
 == -1);

104 
	gfd
;

106 ià(
	gm_tmpfe_·th
 =ğ
nuÎ±r
) {

107 
fd
 = 
mysql_tmpfe
("myrocks");

109 
	gfd
 = 
mysql_tmpfe_·th
(
m_tmpfe_·th
, "myrocks");

112 ià(
	gfd
 < 0) {

114 
sql_´št_”rÜ
("Failedo createemp file during fast index creation.");

115  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

118 
	gm_m”ge_fe
.
	gm_fd
 = 
fd
;

119 
	gm_m”ge_fe
.
	gm_num_sÜt_bufãrs
 = 0;

121  
	gHA_EXIT_SUCCESS
;

131 
	gRdb_šdex_m”ge
::
add
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®
) {

133 
DBUG_ASSERT
(
m_m”ge_mš_h—p
.
em±y
());

139 cÚ¡ 
ušt
 
	gtÙ®_off£t
 = 
RDB_MERGE_CHUNK_LEN
 +

140 
m_»c_buf_unsÜ‹d
->
m_cu¼_off£t
 +

141 
RDB_MERGE_KEY_DELIMITER
 + 
RDB_MERGE_VAL_DELIMITER
 +

142 
key
.
size
(è+ 
v®
.size();

143 ià(
	gtÙ®_off£t
 >ğ
m_»c_buf_unsÜ‹d
->
m_tÙ®_size
) {

148 ià(
m_off£t_Œ“
.
em±y
()) {

150 
sql_´št_”rÜ
("Sort buffer size isoo smallo…rocess merge. "

152  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

155 ià(
m”ge_buf_wr™e
()) {

157 
sql_´št_”rÜ
("Error writing sort buffero disk.");

158  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

162 cÚ¡ 
ulÚglÚg
 
	g»c_off£t
 = 
m_»c_buf_unsÜ‹d
->
m_cu¼_off£t
;

168 
	gm_»c_buf_unsÜ‹d
->
¡Üe_key_v®ue
(
key
, 
v®
);

171 autØ
	g»s
 =

172 
m_off£t_Œ“
.
em¶aû
(
m_»c_buf_unsÜ‹d
->
m_block
.
g‘
(è+ 
»c_off£t
,

173 
m_cf_hªdË
->
G‘Com·¿tÜ
());

174 ià(!
	g»s
.
	g£cÚd
) {

175 
my_´štf_”rÜ
(
ER_DUP_ENTRY
,

177 
MYF
(0));

178  
	gER_DUP_ENTRY
;

181  
	gHA_EXIT_SUCCESS
;

187 
	gRdb_šdex_m”ge
::
m”ge_buf_wr™e
() {

188 
DBUG_ASSERT
(
m_m”ge_fe
.
m_fd
 != -1);

189 
DBUG_ASSERT
(
m_»c_buf_unsÜ‹d
 !ğ
nuÎ±r
);

190 
DBUG_ASSERT
(
m_ouut_buf
 !ğ
nuÎ±r
);

191 
DBUG_ASSERT
(!
m_off£t_Œ“
.
em±y
());

194 
m”ge_¡Üe_ušt64
(
m_ouut_buf
->
m_block
.
g‘
(),

195 
m_»c_buf_unsÜ‹d
->
m_cu¼_off£t
 + 
RDB_MERGE_CHUNK_LEN
);

196 
	gm_ouut_buf
->
	gm_cu¼_off£t
 +ğ
RDB_MERGE_CHUNK_LEN
;

202 cÚ¡‡utØ&
	g»c
 : 
m_off£t_Œ“
) {

203 
DBUG_ASSERT
(
m_ouut_buf
->
m_cu¼_off£t
 <ğ
m_m”ge_buf_size
);

206 
	grocksdb
::
Sliû
 
key
;

207 
	grocksdb
::
Sliû
 
v®
;

208 
m”ge_»ad_»c
(
»c
.
m_block
, &
key
, &
v®
);

211 
	gm_ouut_buf
->
¡Üe_key_v®ue
(
key
, 
v®
);

214 
DBUG_ASSERT
(
m_ouut_buf
->
m_cu¼_off£t
 <ğm_ouut_buf->
m_tÙ®_size
);

222 ià(
my_£ek
(
m_m”ge_fe
.
m_fd
,

223 
m_m”ge_fe
.
m_num_sÜt_bufãrs
 * 
m_m”ge_buf_size
, 
SEEK_SET
,

224 
MYF
(0)è=ğ
MY_FILEPOS_ERROR
) {

226 
sql_´št_”rÜ
("Error seekingo†ocation in merge file on disk.");

227  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

235 ià(
my_wr™e
(
m_m”ge_fe
.
m_fd
, 
m_ouut_buf
->
m_block
.
g‘
(),

236 
m_ouut_buf
->
m_tÙ®_size
, 
MYF
(
MY_WME
 | 
MY_NABP
)) ||

237 
mysql_fe_sync
(
m_m”ge_fe
.
m_fd
, 
MYF
(
MY_WME
))) {

239 
sql_´št_”rÜ
("Error writing sorted merge buffero disk.");

240  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

244 
	gm_m”ge_fe
.
	gm_num_sÜt_bufãrs
 += 1;

247 
m”ge_»£t
();

249  
	gHA_EXIT_SUCCESS
;

256 
	gRdb_šdex_m”ge
::
m”ge_h—p_´•¬e
() {

257 
DBUG_ASSERT
(
m_m”ge_mš_h—p
.
em±y
());

263 ià(!
	gm_off£t_Œ“
.
em±y
(è&& 
m”ge_buf_wr™e
()) {

264  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

267 
DBUG_ASSERT
(
m_m”ge_fe
.
m_num_sÜt_bufãrs
 > 0);

273 
ulÚglÚg
 
	gchunk_size
 =

274 
m_m”ge_combše_»ad_size
 / 
m_m”ge_fe
.
m_num_sÜt_bufãrs
;

275 ià(
	gchunk_size
 >ğ
m_m”ge_buf_size
) {

276 
chunk_size
 = 
m_m”ge_buf_size
;

280 
ulÚglÚg
 
	gi
 = 0; i < 
	gm_m”ge_fe
.
	gm_num_sÜt_bufãrs
; i++) {

281 cÚ¡‡utØ
	g’Œy
 =

282 
¡d
::
make_sh¬ed
<
m”ge_h—p_’Œy
>(
m_cf_hªdË
->
G‘Com·¿tÜ
());

288 cÚ¡ 
size_t
 
	gtÙ®_size
 =

289 
’Œy
->
´•¬e
(
m_m”ge_fe
.
m_fd
, 
i
 * 
m_m”ge_buf_size
, 
chunk_size
);

291 ià(
	gtÙ®_size
 =ğ(
size_t
)-1) {

292  
HA_ERR_ROCKSDB_MERGE_FILE_ERR
;

296 ià(
	gtÙ®_size
 - 
	gRDB_MERGE_CHUNK_LEN
 == 0) {

301 ià(
	g’Œy
->
»ad_»c
(&
’Œy
->
m_key
, &’Œy->
m_v®
)) {

303 
sql_´št_”rÜ
("Chunk size isoo smallo…rocess merge.");

304  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

307 
	gm_m”ge_mš_h—p
.
push
(
¡d
::
move
(
’Œy
));

310  
	gHA_EXIT_SUCCESS
;

316 
	gRdb_šdex_m”ge
::
Ãxt
(
rocksdb
::
Sliû
 *cÚ¡ 
key
,

317 
rocksdb
::
Sliû
 *cÚ¡ 
v®
) {

326 ià(
m_m”ge_fe
.
m_num_sÜt_bufãrs
 == 0) {

327 ià(
m_off£t_Œ“
.
em±y
()) {

331 cÚ¡‡utØ
	g»c
 = 
m_off£t_Œ“
.
begš
();

334 
m”ge_»ad_»c
(
»c
->
m_block
, 
key
, 
v®
);

336 
	gm_off£t_Œ“
.
”a£
(
»c
);

337  
	gHA_EXIT_SUCCESS
;

340 
	g»s
;

347 ià(
	gm_m”ge_mš_h—p
.
em±y
()) {

348 ià((
	g»s
 = 
m”ge_h—p_´•¬e
())) {

350 
sql_´št_”rÜ
("Error during…reparation of heap.");

351  
	g»s
;

358 
m”ge_h—p_tİ
(
key
, 
v®
);

359  
	gHA_EXIT_SUCCESS
;

362 
DBUG_ASSERT
(!
m_m”ge_mš_h—p
.
em±y
());

363  
m”ge_h—p_pİ_ªd_g‘_Ãxt
(
key
, 
v®
);

369 
	gRdb_šdex_m”ge
::
m”ge_h—p_tİ
(
rocksdb
::
Sliû
 *cÚ¡ 
key
,

370 
rocksdb
::
Sliû
 *cÚ¡ 
v®
) {

371 
DBUG_ASSERT
(!
m_m”ge_mš_h—p
.
em±y
());

373 cÚ¡ 
	g¡d
::
sh¬ed_±r
<
m”ge_h—p_’Œy
> &
’Œy
 = 
m_m”ge_mš_h—p
.
tİ
();

374 *
	gkey
 = 
’Œy
->
m_key
;

375 *
	gv®
 = 
’Œy
->
m_v®
;

384 
	gRdb_šdex_m”ge
::
m”ge_h—p_pİ_ªd_g‘_Ãxt
(
rocksdb
::
Sliû
 *cÚ¡ 
key
,

385 
rocksdb
::
Sliû
 *cÚ¡ 
v®
) {

390 cÚ¡ 
¡d
::
sh¬ed_±r
<
m”ge_h—p_’Œy
> 
’Œy
 = 
m_m”ge_mš_h—p
.
tİ
();

391 
	gm_m”ge_mš_h—p
.
pİ
();

400 ià(
	g’Œy
->
	gm_chunk_šfo
->
is_chunk_fšished
()) {

401 ià(
	gm_m”ge_mš_h—p
.
em±y
()) {

405 
m”ge_h—p_tİ
(
key
, 
v®
);

406  
	gHA_EXIT_SUCCESS
;

412 
DBUG_ASSERT
(!
’Œy
->
m_chunk_šfo
->
is_chunk_fšished
());

418 ià(
	g’Œy
->
»ad_»c
(&
’Œy
->
m_key
, &’Œy->
m_v®
)) {

419 ià(
	g’Œy
->
»ad_Ãxt_chunk_äom_disk
(
m_m”ge_fe
.
m_fd
)) {

420  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

424 ià(
	g’Œy
->
»ad_»c
(&
’Œy
->
m_key
, &’Œy->
m_v®
)) {

425  
	gHA_ERR_ROCKSDB_MERGE_FILE_ERR
;

430 
	gm_m”ge_mš_h—p
.
push
(
¡d
::
move
(
’Œy
));

433 
m”ge_h—p_tİ
(
key
, 
v®
);

434  
	gHA_EXIT_SUCCESS
;

437 
	gRdb_šdex_m”ge
::
m”ge_h—p_’Œy
::
»ad_Ãxt_chunk_äom_disk
(
Fe
 
fd
) {

438 ià(
m_chunk_šfo
->
»ad_Ãxt_chunk_äom_disk
(
fd
)) {

439  
HA_EXIT_FAILURE
;

442 
	gm_block
 = 
m_chunk_šfo
->
m_block
.
g‘
();

443  
	gHA_EXIT_SUCCESS
;

446 
	gRdb_šdex_m”ge
::
m”ge_buf_šfo
::
»ad_Ãxt_chunk_äom_disk
(
Fe
 
fd
) {

447 
m_disk_cu¼_off£t
 +ğ
m_cu¼_off£t
;

449 ià(
my_£ek
(
fd
, 
m_disk_cu¼_off£t
, 
SEEK_SET
, 
MYF
(0)è=ğ
MY_FILEPOS_ERROR
) {

451 
sql_´št_”rÜ
("Error seekingo†ocation in merge file on disk.");

452  
	gHA_EXIT_FAILURE
;

456 cÚ¡ 
size_t
 
	gby‹s_»ad
 =

457 
my_»ad
(
fd
, 
m_block
.
g‘
(), 
m_block_Ën
, 
MYF
(
MY_WME
));

458 ià(
	gby‹s_»ad
 =ğ(
size_t
)-1) {

460 
sql_´št_”rÜ
("Error„eading merge file from disk.");

461  
	gHA_EXIT_FAILURE
;

464 
	gm_cu¼_off£t
 = 0;

465  
	gHA_EXIT_SUCCESS
;

472 
	gRdb_šdex_m”ge
::
m”ge_»cÜd_com·»
(

473 cÚ¡ 
uch¬
 *cÚ¡ 
a_block
, cÚ¡ uch¬ *cÚ¡ 
b_block
,

474 cÚ¡ 
rocksdb
::
Com·¿tÜ
 *cÚ¡ 
com·¿tÜ
) {

475  
com·¿tÜ
->
Com·»
(
as_¦iû
(
a_block
),‡s_¦iû(
b_block
));

482 
	gRdb_šdex_m”ge
::
m”ge_»ad_»c
(cÚ¡ 
uch¬
 *cÚ¡ 
block
,

483 
rocksdb
::
Sliû
 *cÚ¡ 
key
,

484 
rocksdb
::
Sliû
 *cÚ¡ 
v®
) {

486 
»ad_¦iû
(
key
, 
block
);

487 
»ad_¦iû
(
v®
, 
block
 + 
RDB_MERGE_REC_DELIMITER
 + 
key
->
size
());

490 
	gRdb_šdex_m”ge
::
»ad_¦iû
(
rocksdb
::
Sliû
 *
¦iû
,

491 cÚ¡ 
uch¬
 *
block_±r
) {

492 
ušt64
 
	g¦iû_Ën
;

493 
m”ge_»ad_ušt64
(&
block_±r
, &
¦iû_Ën
);

495 *
	g¦iû
 = 
rocksdb
::
Sliû
(
»š‹½»t_ÿ¡
<cÚ¡ *>(
block_±r
), 
¦iû_Ën
);

498 
	gRdb_šdex_m”ge
::
m”ge_h—p_’Œy
::
»ad_»c
(
rocksdb
::
Sliû
 *cÚ¡ 
key
,

499 
rocksdb
::
Sliû
 *cÚ¡ 
v®
) {

500 cÚ¡ 
uch¬
 *
block_±r
 = 
m_block
;

501 cÚ¡‡utØ
	gÜig_off£t
 = 
m_chunk_šfo
->
m_cu¼_off£t
;

502 cÚ¡‡utØ
	gÜig_block
 = 
m_block
;

505 ià(
»ad_¦iû
(
key
, &
block_±r
) != 0) {

506  
HA_EXIT_FAILURE
;

509 
	gm_chunk_šfo
->
	gm_cu¼_off£t
 +ğ(
ušŒ_t
)
block_±r
 - (ušŒ_t)
m_block
;

510 
	gm_block
 +ğ(
ušŒ_t
)
block_±r
 - (ušŒ_t)
m_block
;

512 ià(
»ad_¦iû
(
v®
, &
block_±r
) != 0) {

513 
m_chunk_šfo
->
m_cu¼_off£t
 = 
Üig_off£t
;

514 
	gm_block
 = 
Üig_block
;

515  
	gHA_EXIT_FAILURE
;

518 
	gm_chunk_šfo
->
	gm_cu¼_off£t
 +ğ(
ušŒ_t
)
block_±r
 - (ušŒ_t)
m_block
;

519 
	gm_block
 +ğ(
ušŒ_t
)
block_±r
 - (ušŒ_t)
m_block
;

521  
	gHA_EXIT_SUCCESS
;

524 
	gRdb_šdex_m”ge
::
m”ge_h—p_’Œy
::
»ad_¦iû
(
rocksdb
::
Sliû
 *cÚ¡ 
¦iû
,

525 cÚ¡ 
uch¬
 **
block_±r
) {

526 ià(!
	gm_chunk_šfo
->
has_¥aû
(
RDB_MERGE_REC_DELIMITER
)) {

527  
	gHA_EXIT_FAILURE
;

530 
ušt64
 
	g¦iû_Ën
;

531 
m”ge_»ad_ušt64
(
block_±r
, &
¦iû_Ën
);

532 ià(!
	gm_chunk_šfo
->
has_¥aû
(
RDB_MERGE_REC_DELIMITER
 + 
¦iû_Ën
)) {

533  
	gHA_EXIT_FAILURE
;

536 *
	g¦iû
 =

537 
rocksdb
::
Sliû
(
»š‹½»t_ÿ¡
<cÚ¡ *>(*
block_±r
), 
¦iû_Ën
);

538 *
	gblock_±r
 +ğ
¦iû_Ën
;

539  
	gHA_EXIT_SUCCESS
;

542 
size_t
 
	gRdb_šdex_m”ge
::
m”ge_h—p_’Œy
::
´•¬e
(
Fe
 
fd
, 
ulÚglÚg
 
f_off£t
,

543 
ulÚglÚg
 
chunk_size
) {

544 
	gm_chunk_šfo
 = 
¡d
::
make_sh¬ed
<
m”ge_buf_šfo
>(
chunk_size
);

545 cÚ¡ 
size_t
 
	g»s
 = 
m_chunk_šfo
->
´•¬e
(
fd
, 
f_off£t
);

546 ià(
	g»s
 !ğ(
size_t
)-1) {

547 
m_block
 = 
m_chunk_šfo
->m_block.
g‘
(è+ 
RDB_MERGE_CHUNK_LEN
;

550  
	g»s
;

553 
size_t
 
	gRdb_šdex_m”ge
::
m”ge_buf_šfo
::
´•¬e
(
Fe
 
fd
, 
ulÚglÚg
 
f_off£t
) {

554 
	gm_disk_¡¬t_off£t
 = 
f_off£t
;

555 
	gm_disk_cu¼_off£t
 = 
f_off£t
;

561 ià(
my_£ek
(
fd
, 
f_off£t
, 
SEEK_SET
, 
MYF
(0)è=ğ
MY_FILEPOS_ERROR
) {

563 
sql_´št_”rÜ
("Error seekingo†ocation in merge file on disk.");

564  (
	gsize_t
)-1;

567 cÚ¡ 
size_t
 
	gby‹s_»ad
 =

568 
my_»ad
(
fd
, 
m_block
.
g‘
(), 
m_tÙ®_size
, 
MYF
(
MY_WME
));

569 ià(
	gby‹s_»ad
 =ğ(
size_t
)-1) {

571 
sql_´št_”rÜ
("Error„eading merge file from disk.");

572  (
	gsize_t
)-1;

579 cÚ¡ 
uch¬
 *
	gblock_±r
 = 
m_block
.
g‘
();

580 
m”ge_»ad_ušt64
(&
block_±r
, &
m_tÙ®_size
);

581 
	gm_cu¼_off£t
 +ğ
RDB_MERGE_CHUNK_LEN
;

582  
	gm_tÙ®_size
;

586 
	gRdb_šdex_m”ge
::
m”ge_buf_šfo
::
¡Üe_key_v®ue
(

587 cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®
) {

588 
¡Üe_¦iû
(
key
);

589 
¡Üe_¦iû
(
v®
);

592 
	gRdb_šdex_m”ge
::
m”ge_buf_šfo
::
¡Üe_¦iû
(cÚ¡ 
rocksdb
::
Sliû
 &
¦iû
) {

594 
m”ge_¡Üe_ušt64
(&
m_block
[
m_cu¼_off£t
], 
¦iû
.
size
());

597 
memıy
(&
m_block
[
m_cu¼_off£t
 + 
RDB_MERGE_REC_DELIMITER
], 
¦iû
.
d©a
(),

598 
¦iû
.
size
());

600 
	gm_cu¼_off£t
 +ğ
¦iû
.
size
(è+ 
RDB_MERGE_REC_DELIMITER
;

603 
	gRdb_šdex_m”ge
::
m”ge_»£t
() {

608 
m_off£t_Œ“
.
ş—r
();

611 ià(
	gm_»c_buf_unsÜ‹d
 && m_»c_buf_unsÜ‹d->
	gm_block
) {

612 
	gm_»c_buf_unsÜ‹d
->
	gm_cu¼_off£t
 = 0;

616 ià(
	gm_ouut_buf
 && m_ouut_buf->
	gm_block
) {

617 
	gm_ouut_buf
->
	gm_cu¼_off£t
 = 0;

	@rdb_index_merge.h

17 #´agm¨
Úû


20 
	~"../sql/log.h
"

21 
	~"hªdËr.h
"

22 
	~"my_glob®.h
"

25 
	~<queue
>

26 
	~<£t
>

27 
	~<veùÜ
>

30 
	~"rocksdb/db.h
"

33 
	~"rdb_com·¿tÜ.h
"

35 
Çme¥aû
 
	gmyrocks
 {

40 
	#RDB_MERGE_CHUNK_LEN
 (
size_t
)

	)

41 
	#RDB_MERGE_REC_DELIMITER
 (
size_t
)

	)

42 
	#RDB_MERGE_KEY_DELIMITER
 
RDB_MERGE_REC_DELIMITER


	)

43 
	#RDB_MERGE_VAL_DELIMITER
 
RDB_MERGE_REC_DELIMITER


	)

45 
şass
 
	gRdb_key_def
;

46 
şass
 
	gRdb_tbl_def
;

48 şas 
	cRdb_šdex_m”ge
 {

49 
Rdb_šdex_m”ge
(cÚ¡ Rdb_šdex_m”g&
p
èğ
d–‘e
;

50 
	gRdb_šdex_m”ge
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_šdex_m”ge
 &
p
èğ
d–‘e
;

52 
	gpublic
:

54 
	sm”ge_fe_šfo
 {

55 
Fe
 
m_fd
 = -1;

56 
ulÚg
 
	gm_num_sÜt_bufãrs
 = 0;

60 
	sm”ge_buf_šfo
 {

62 
	g¡d
::
unique_±r
<
uch¬
[]> 
m_block
;

63 cÚ¡ 
ulÚglÚg


64 
	gm_block_Ën
;

65 
ulÚglÚg
 
	gm_cu¼_off£t
;

66 
ulÚglÚg
 
	gm_disk_¡¬t_off£t
;

67 
ulÚglÚg
 
	gm_disk_cu¼_off£t
;

68 
ulÚglÚg
 
	gm_tÙ®_size
;

70 
¡Üe_key_v®ue
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®
)

71 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

73 
¡Üe_¦iû
(cÚ¡ 
rocksdb
::
Sliû
 &
¦iû
è
MY_ATTRIBUTE
((
__nÚnuÎ__
));

75 
size_t
 
´•¬e
(
Fe
 
fd
, 
ulÚglÚg
 
f_off£t
è
MY_ATTRIBUTE
((
__nÚnuÎ__
));

77 
»ad_Ãxt_chunk_äom_disk
(
Fe
 
fd
)

78 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

80 
šlše
 
boŞ
 
is_chunk_fšished
() const {

81  
	gm_cu¼_off£t
 + 
	gm_disk_cu¼_off£t
 - 
	gm_disk_¡¬t_off£t
 ==

82 
m_tÙ®_size
;

85 
šlše
 
boŞ
 
has_¥aû
(
ušt64
 
Ãeded
) const {

86  
	gm_cu¼_off£t
 + 
	gÃeded
 <ğ
m_block_Ën
;

89 
ex¶ic™
 
m”ge_buf_šfo
(cÚ¡ 
ulÚglÚg
 
m”ge_block_size
)

90 : 
m_block
(
nuÎ±r
), 
m_block_Ën
(
m”ge_block_size
), 
m_cu¼_off£t
(0),

91 
m_disk_¡¬t_off£t
(0), 
m_disk_cu¼_off£t
(0),

92 
m_tÙ®_size
(
m”ge_block_size
) {

94 
	gm_block
 = 
¡d
::
unique_±r
<
uch¬
[]>(
Ãw
 uch¬[
m”ge_block_size
]);

97 
mem£t
(
m_block
.
g‘
(), 0, 
m”ge_block_size
);

102 
	sm”ge_h—p_’Œy
 {

103 
	g¡d
::
sh¬ed_±r
<
m”ge_buf_šfo
> 
m_chunk_šfo
;

104 
uch¬
 *
	gm_block
;

105 cÚ¡ 
	grocksdb
::
Com·¿tÜ
 *cÚ¡ 
m_com·¿tÜ
;

106 
	grocksdb
::
Sliû
 
m_key
;

107 
	grocksdb
::
Sliû
 
m_v®
;

109 
size_t
 
´•¬e
(
Fe
 
fd
, 
ulÚglÚg
 
f_off£t
, ulÚglÚg 
chunk_size
)

110 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

112 
»ad_Ãxt_chunk_äom_disk
(
Fe
 
fd
)

113 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

115 
»ad_»c
(
rocksdb
::
Sliû
 *cÚ¡ 
key
,„ocksdb::Sliû *cÚ¡ 
v®
)

116 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

118 
»ad_¦iû
(
rocksdb
::
Sliû
 *cÚ¡ 
¦iû
, cÚ¡ 
uch¬
 **
block_±r
)

119 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

121 
ex¶ic™
 
m”ge_h—p_’Œy
(cÚ¡ 
rocksdb
::
Com·¿tÜ
 *cÚ¡ 
com·¿tÜ
)

122 : 
m_chunk_šfo
(
nuÎ±r
), 
m_block
ÒuÎ±r), 
m_com·¿tÜ
(
com·¿tÜ
) {}

125 
	sm”ge_h—p_com·¿tÜ
 {

126 
boŞ
 
İ”©Ü
()(cÚ¡ 
	g¡d
::
sh¬ed_±r
<
m”ge_h—p_’Œy
> &
lhs
,

127 cÚ¡ 
	g¡d
::
sh¬ed_±r
<
m”ge_h—p_’Œy
> &
rhs
) {

128  
lhs
->
m_com·¿tÜ
->
Com·»
(
rhs
->
m_key
,†hs->m_key) < 0;

133 
	sm”ge_»cÜd
 {

134 
uch¬
 *
	gm_block
;

135 cÚ¡ 
	grocksdb
::
Com·¿tÜ
 *cÚ¡ 
m_com·¿tÜ
;

137 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gm”ge_»cÜd
 &
	g»cÜd
) const {

138  
m”ge_»cÜd_com·»
(
this
->
m_block
, 
»cÜd
.m_block, 
m_com·¿tÜ
) <

142 
m”ge_»cÜd
(
uch¬
 *cÚ¡ 
block
,

143 cÚ¡ 
rocksdb
::
Com·¿tÜ
 *cÚ¡ 
com·¿tÜ
)

144 : 
m_block
(
block
), 
m_com·¿tÜ
(
com·¿tÜ
) {}

147 
	g´iv©e
:

148 cÚ¡ *
m_tmpfe_·th
;

149 cÚ¡ 
ulÚglÚg
 
	gm_m”ge_buf_size
;

150 cÚ¡ 
ulÚglÚg
 
	gm_m”ge_combše_»ad_size
;

151 cÚ¡ 
ulÚglÚg
 
	gm_m”ge_tmp_fe_»mov®_d–ay
;

152 
	grocksdb
::
CŞumnFamyHªdË
 *
m_cf_hªdË
;

153 
m”ge_fe_šfo
 
	gm_m”ge_fe
;

154 
	g¡d
::
sh¬ed_±r
<
m”ge_buf_šfo
> 
m_»c_buf_unsÜ‹d
;

155 
	g¡d
::
sh¬ed_±r
<
m”ge_buf_šfo
> 
m_ouut_buf
;

156 
	g¡d
::
£t
<
m”ge_»cÜd
> 
m_off£t_Œ“
;

157 
	g¡d
::
´iÜ™y_queue
<
¡d
::
sh¬ed_±r
<
m”ge_h—p_’Œy
>,

158 
	g¡d
::
veùÜ
<
¡d
::
sh¬ed_±r
<
m”ge_h—p_’Œy
>>,

159 
	gm”ge_h—p_com·¿tÜ
>

160 
	gm_m”ge_mš_h—p
;

162 
šlše
 
m”ge_¡Üe_ušt64
(
uch¬
 *cÚ¡ 
d¡
, 
ušt64
 
n
) {

163 
memıy
(
d¡
, &
n
, (n));

166 
šlše
 
m”ge_»ad_ušt64
(cÚ¡ 
uch¬
 **
buf_±r
,

167 
ušt64
 *cÚ¡ 
d¡
) {

168 
DBUG_ASSERT
(
buf_±r
 !ğ
nuÎ±r
);

169 
memıy
(
d¡
, *
buf_±r
, (
ušt64
));

170 *
	gbuf_±r
 +ğ(
ušt64
);

173 
šlše
 
	grocksdb
::
Sliû
 
as_¦iû
(cÚ¡ 
uch¬
 *
block
) {

174 
ušt64
 
Ën
;

175 
m”ge_»ad_ušt64
(&
block
, &
Ën
);

177  
	grocksdb
::
Sliû
(
»š‹½»t_ÿ¡
<cÚ¡ *>(
block
), 
Ën
);

180 
m”ge_»cÜd_com·»
(cÚ¡ 
uch¬
 *
a_block
, cÚ¡ uch¬ *
b_block
,

181 cÚ¡ 
rocksdb
::
Com·¿tÜ
 *cÚ¡ 
com·¿tÜ
)

182 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

184 
m”ge_»ad_»c
(cÚ¡ 
uch¬
 *cÚ¡ 
block
, 
rocksdb
::
Sliû
 *cÚ¡ 
key
,

185 
rocksdb
::
Sliû
 *cÚ¡ 
v®
è
MY_ATTRIBUTE
((
__nÚnuÎ__
));

187 
»ad_¦iû
(
rocksdb
::
Sliû
 *
¦iû
, cÚ¡ 
uch¬
 *
block_±r
)

188 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

190 
	gpublic
:

191 
Rdb_šdex_m”ge
(cÚ¡ *cÚ¡ 
tmpfe_·th
,

192 cÚ¡ 
ulÚglÚg
 &
m”ge_buf_size
,

193 cÚ¡ 
ulÚglÚg
 &
m”ge_combše_»ad_size
,

194 cÚ¡ 
ulÚglÚg
 &
m”ge_tmp_fe_»mov®_d–ay
,

195 
rocksdb
::
CŞumnFamyHªdË
 *
cf
);

196 ~
Rdb_šdex_m”ge
();

198 
š™
(è
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

200 
m”ge_fe_ü—‹
(è
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

202 
add
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®
)

203 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

205 
m”ge_buf_wr™e
(è
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

207 
Ãxt
(
rocksdb
::
Sliû
 *cÚ¡ 
key
,„ocksdb::Sliû *cÚ¡ 
v®
)

208 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

210 
m”ge_h—p_´•¬e
(è
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

212 
m”ge_h—p_tİ
(
rocksdb
::
Sliû
 *
key
,„ocksdb::Sliû *
v®
)

213 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

215 
m”ge_h—p_pİ_ªd_g‘_Ãxt
(
rocksdb
::
Sliû
 *cÚ¡ 
key
,

216 
rocksdb
::
Sliû
 *cÚ¡ 
v®
)

217 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

219 
m”ge_»£t
();

221 
	grocksdb
::
CŞumnFamyHªdË
 *
g‘_cf
(ècÚ¡ {  
m_cf_hªdË
; }

	@rdb_io_watchdog.cc

18 
	~"rdb_io_w©chdog.h
"

21 
	~<¡ršg
>

22 
	~<veùÜ
>

24 
Çme¥aû
 
	gmyrocks
 {

26 
	gRdb_io_w©chdog
::
expœe_io_ÿÎback
(
sigv®
 
tim”_d©a
) {

27 
DBUG_ASSERT
(
tim”_d©a
.
siv®_±r
 !ğ
nuÎ±r
);

33 ià(!
	gm_io_š_´og»ss
.
lßd
()) {

40 
sql_´št_”rÜ
("MyRocks has detected‡ combination of I/O„equests which "

43 
m_wr™e_timeout
);

45 
abÜt
();

48 
	gRdb_io_w©chdog
::
io_check_ÿÎback
(
sigv®
 
tim”_d©a
) {

49 
RDB_MUTEX_LOCK_CHECK
(
m_»£t_mu‹x
);

51 
DBUG_ASSERT
(
tim”_d©a
.
siv®_±r
 !ğ
nuÎ±r
);

53 
sigev’t
 
	ge
;

55 
	ge
.
	gsigev_nÙify
 = 
SIGEV_THREAD
;

56 
	ge
.
	gsigev_nÙify_funùiÚ
 = &
Rdb_io_w©chdog
::
expœe_io_ÿÎback_w¿µ”
;

57 
	ge
.
	gsigev_v®ue
.
	gsiv®_±r
 = 
this
;

58 
	ge
.
	gsigev_nÙify_©Œibu‹s
 = 
nuÎ±r
;

60 
	g»t
 = 
tim”_ü—‹
(
CLOCK_MONOTONIC
, &
e
, &
m_io_check_w©chdog_tim”
);

62 ià(
uÆik–y
(
»t
)) {

64 
sql_´št_w¬nšg
("C»©šg‡ w©chdog I/Oim” faed w™h %d.", 
”ºo
);

65 
RDB_MUTEX_UNLOCK_CHECK
(
m_»£t_mu‹x
);

69 
™im”¥ec
 
	gtim”_¥ec
;

70 
mem£t
(&
tim”_¥ec
, 0, (timer_spec));

73 
	gtim”_¥ec
.
	g™_v®ue
.
	gtv_£c
 = 
m_wr™e_timeout
;

75 
	g»t
 = 
tim”_£‰ime
(
m_io_check_w©chdog_tim”
, 0, &
tim”_¥ec
, 
nuÎ±r
);

77 ià(
uÆik–y
(
»t
)) {

79 
sql_´št_w¬nšg
("Settingime for‡ watchdog I/Oimer failed with %d.",

80 
”ºo
);

81 
RDB_MUTEX_UNLOCK_CHECK
(
m_»£t_mu‹x
);

85 
	gm_io_š_´og»ss
.
¡Üe
(
Œue
);

88 cÚ¡ 
	g¡d
::
¡ršg
 &
dœeùÜy
 : 
m_dœs_to_check
) {

89 
»t
 = 
check_wr™e_acûss
(
dœeùÜy
);

93 ià(
uÆik–y
(
»t
 !ğ
HA_EXIT_SUCCESS
)) {

95 
sql_´št_w¬nšg
("Unableo verify write‡ccesso %s (error code %d).",

96 
dœeùÜy
.
c_¡r
(), 
»t
);

100 
	gm_io_š_´og»ss
.
¡Üe
(
çl£
);

103 
	g»t
 = 
tim”_d–‘e
(
m_io_check_w©chdog_tim”
);

105 ià(
uÆik–y
(
»t
)) {

107 
sql_´št_w¬nšg
("D–‘šghw©chdog I/Oim” faed w™h %d.", 
”ºo
);

110 
	gm_io_check_w©chdog_tim”
 = 
nuÎ±r
;

112 
RDB_MUTEX_UNLOCK_CHECK
(
m_»£t_mu‹x
);

115 
	gRdb_io_w©chdog
::
check_wr™e_acûss
(cÚ¡ 
¡d
::
¡ršg
 &
dœÇme
) const {

116 
DBUG_ASSERT
(!
dœÇme
.
em±y
());

117 
DBUG_ASSERT
(
m_buf
 !ğ
nuÎ±r
);

119 cÚ¡ 
	g¡d
::
¡ršg
 
âame
 = 
dœÇme
 + 
FN_DIRSEP
 + 
RDB_IO_DUMMY_FILE_NAME
;

123 
	gfd
 = 
İ’
(
âame
.
c_¡r
(), 
O_WRONLY
 | 
O_DIRECT
 | 
O_CREAT
 | 
O_SYNC
,

124 
S_IRWXU
 | 
S_IWUSR
);

126 ià(
uÆik–y
(
fd
 == -1)) {

127  
fd
;

130 
	g»t
 = 
wr™e
(
fd
, 
m_buf
, 
RDB_IO_WRITE_BUFFER_SIZE
);

132 ià(
uÆik–y
(
»t
 !ğ
RDB_IO_WRITE_BUFFER_SIZE
)) {

133  
»t
;

136 
	g»t
 = 
şo£
(
fd
);

138 ià(
uÆik–y
(
»t
)) {

139  
	g»t
;

142 
	g»t
 = 
uÆšk
(
âame
.
c_¡r
());

144 ià(
uÆik–y
(
»t
)) {

145  
	g»t
;

148  
	gHA_EXIT_SUCCESS
;

151 
	gRdb_io_w©chdog
::
»£t_timeout
(cÚ¡ 
ušt32_t
 &
wr™e_timeout
) {

156 
RDB_MUTEX_LOCK_CHECK
(
m_»£t_mu‹x
);

158 
sigev’t
 
	ge
;

161 
	g»t
 = 
¡İ_tim”s
();

163 ià(
uÆik–y
(
»t
)) {

165 
sql_´št_w¬nšg
("Stİpšg I/Oim” çed w™h %d.", 
”ºo
);

166 
RDB_MUTEX_UNLOCK_CHECK
(
m_»£t_mu‹x
);

167  
	g»t
;

170 
	gm_wr™e_timeout
 = 
wr™e_timeout
;

171 
	gm_io_š_´og»ss
.
¡Üe
(
çl£
);

175 ià(!
	gwr™e_timeout
) {

176 
RDB_MUTEX_UNLOCK_CHECK
(
m_»£t_mu‹x
);

177  
	gHA_EXIT_SUCCESS
;

180 
ä“
(
m_buf
);

182 
	g»t
 = 
posix_mem®ign
(
»š‹½»t_ÿ¡
<**>(&
m_buf
),

183 
RDB_IO_WRITE_BUFFER_SIZE
, RDB_IO_WRITE_BUFFER_SIZE);

185 ià(
uÆik–y
(
»t
)) {

186 
	gm_buf
 = 
nuÎ±r
;

187 
RDB_MUTEX_UNLOCK_CHECK
(
m_»£t_mu‹x
);

189  
	g»t
;

192 
DBUG_ASSERT
(
m_buf
 !ğ
nuÎ±r
);

193 
mem£t
(
m_buf
, 0, 
RDB_IO_WRITE_BUFFER_SIZE
);

197 
DBUG_ASSERT
(
m_dœs_to_check
.
size
() > 0);

199 
	ge
.
	gsigev_nÙify
 = 
SIGEV_THREAD
;

200 
	ge
.
	gsigev_nÙify_funùiÚ
 = &
Rdb_io_w©chdog
::
io_check_ÿÎback_w¿µ”
;

201 
	ge
.
	gsigev_v®ue
.
	gsiv®_±r
 = 
this
;

202 
	ge
.
	gsigev_nÙify_©Œibu‹s
 = 
nuÎ±r
;

204 
	g»t
 = 
tim”_ü—‹
(
CLOCK_MONOTONIC
, &
e
, &
m_io_check_tim”
);

206 ià(
uÆik–y
(
»t
)) {

208 
sql_´št_w¬nšg
("C»©šg‡ I/Oim” faed w™h %d.", 
”ºo
);

209 
RDB_MUTEX_UNLOCK_CHECK
(
m_»£t_mu‹x
);

210  
	g»t
;

213 
™im”¥ec
 
	gtim”_¥ec
;

214 
mem£t
(&
tim”_¥ec
, 0, (timer_spec));

217 
	gtim”_¥ec
.
	g™_v®ue
.
	gtv_£c
 = 
m_wr™e_timeout
;

218 
	gtim”_¥ec
.
	g™_š‹rv®
.
	gtv_£c
 = 
m_wr™e_timeout
;

220 
	g»t
 = 
tim”_£‰ime
(
m_io_check_tim”
, 0, &
tim”_¥ec
, 
nuÎ±r
);

222 ià(
uÆik–y
(
»t
)) {

224 
sql_´št_w¬nšg
("Settingime for‡ watchdog I/Oimer failed with %d.",

225 
”ºo
);

228 
RDB_MUTEX_UNLOCK_CHECK
(
m_»£t_mu‹x
);

230  
	gHA_EXIT_SUCCESS
;

	@rdb_io_watchdog.h

17 #´agm¨
Úû


20 
	~<©omic
>

21 
	~<sigÇl.h
>

22 
	~<¡dlib.h
>

23 
	~<¡ršg
>

24 
	~<¡ršg.h
>

25 
	~<time.h
>

26 
	~<veùÜ
>

29 
	~"my_glob®.h
"

30 
	~"my_¡ackŒaû.h
"

33 
	~"rdb_uts.h
"

35 
Çme¥aû
 
	gmyrocks
 {

37 şas 
	cRdb_io_w©chdog
 {

38 cÚ¡ 
	gRDB_IO_WRITE_BUFFER_SIZE
 = 4096;

39 cÚ¡ *cÚ¡ 
	gRDB_IO_DUMMY_FILE_NAME
 = "myrocks_io_watchdog_write_file";

41 
	g´iv©e
:

42 
tim”_t
 
m_io_check_tim”
, 
	gm_io_check_w©chdog_tim”
;

43 
	g¡d
::
©omic
<
boŞ
> 
m_io_š_´og»ss
;

44 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
m_dœs_to_check
;

45 
ušt32_t
 
	gm_wr™e_timeout
;

46 
mysql_mu‹x_t
 
	gm_»£t_mu‹x
;

47 *
	gm_buf
;

49 
check_wr™e_acûss
(cÚ¡ 
¡d
::
¡ršg
 &
dœÇme
) const;

50 
io_check_ÿÎback
(
sigv®
 
tim”_d©a
);

51 
expœe_io_ÿÎback
(
sigv®
 
tim”_d©a
);

53 
¡İ_tim”s
() {

54 
	g»t
 = 0;

56 ià(
	gm_io_check_w©chdog_tim”
) {

57 
	g»t
 = 
tim”_d–‘e
(
m_io_check_w©chdog_tim”
);

59 ià(!
	g»t
) {

60 
	gm_io_check_w©chdog_tim”
 = 
nuÎ±r
;

64 ià(
	gm_io_check_tim”
 && !
	g»t
) {

65 
	g»t
 = 
tim”_d–‘e
(
m_io_check_tim”
);

67 ià(!
	g»t
) {

68 
	gm_io_check_tim”
 = 
nuÎ±r
;

72  
	g»t
;

75 
io_check_ÿÎback_w¿µ”
(
sigv®
 
tim”_d©a
) {

76 
Rdb_io_w©chdog
 *
	gio_w©chdog
 =

77 
¡©ic_ÿ¡
<
Rdb_io_w©chdog
 *>(
tim”_d©a
.
siv®_±r
);

78 
DBUG_ASSERT
(
io_w©chdog
 !ğ
nuÎ±r
);

80 
	gio_w©chdog
->
io_check_ÿÎback
(
tim”_d©a
);

83 
expœe_io_ÿÎback_w¿µ”
(
sigv®
 
tim”_d©a
) {

84 
Rdb_io_w©chdog
 *
	gio_w©chdog
 =

85 
¡©ic_ÿ¡
<
Rdb_io_w©chdog
 *>(
tim”_d©a
.
siv®_±r
);

86 
DBUG_ASSERT
(
io_w©chdog
 !ğ
nuÎ±r
);

88 
	gio_w©chdog
->
expœe_io_ÿÎback
(
tim”_d©a
);

91 
	gpublic
:

92 
ex¶ic™
 
Rdb_io_w©chdog
(cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
dœeùÜ›s
)

93 : 
m_io_check_tim”
(
nuÎ±r
), 
m_io_check_w©chdog_tim”
(nullptr),

94 
m_io_š_´og»ss
(
çl£
), 
m_dœs_to_check
(
¡d
::
move
(
dœeùÜ›s
)),

95 
m_buf
(
nuÎ±r
) {

96 
DBUG_ASSERT
(
m_dœs_to_check
.
size
() > 0);

97 
mysql_mu‹x_š™
(0, &
m_»£t_mu‹x
, 
MY_MUTEX_INIT_FAST
);

100 ~
Rdb_io_w©chdog
() {

102 
	g¡©ic_ÿ¡
<>(
¡İ_tim”s
());

103 
mysql_mu‹x_de¡roy
(&
m_»£t_mu‹x
);

104 
ä“
(
m_buf
);

107 
»£t_timeout
(cÚ¡ 
ušt32_t
 &
wr™e_timeout
);

109 
Rdb_io_w©chdog
(cÚ¡ Rdb_io_w©chdog &èğ
d–‘e
;

110 
	gRdb_io_w©chdog
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_io_w©chdog
 &èğ
d–‘e
;

	@rdb_mutex_wrapper.cc

18 
	~"rdb_mu‹x_w¿µ”.h
"

21 
	~"../sql/sql_şass.h
"

22 
	~"../sql/»¶iÿtiÚ.h
"

25 
	~"ha_rocksdb.h
"

26 
	~"rdb_uts.h
"

28 
usšg
 
Çme¥aû
 
	grocksdb
;

30 
Çme¥aû
 
	gmyrocks
 {

32 
PSI_¡age_šfo
 
	g¡age_wa™šg_Ú_row_lock2
 = {0, "Waiting for„ow†ock",

35 cÚ¡ 
št64_t
 
	gONE_SECOND_IN_MICROSECS
 = 1000 * 1000;

38 cÚ¡ 
št64_t
 
	gONE_YEAR_IN_MICROSECS
 =

39 
ONE_SECOND_IN_MICROSECS
 * 60 * 60 * 24 * 365;

41 
	gRdb_cÚd_v¬
::
Rdb_cÚd_v¬
(è{ 
mysql_cÚd_š™
(0, &
m_cÚd
, 
nuÎ±r
); }

43 
	gRdb_cÚd_v¬
::~
Rdb_cÚd_v¬
(è{ 
mysql_cÚd_de¡roy
(&
m_cÚd
); }

45 
Stus
 
	gRdb_cÚd_v¬
::
Wa™
(cÚ¡ 
¡d
::
sh¬ed_±r
<
T¿n§ùiÚDBMu‹x
> 
mu‹x_¬g
) {

46  
Wa™FÜ
(
mu‹x_¬g
, 
ONE_YEAR_IN_MICROSECS
);

63 
Stus


64 
	gRdb_cÚd_v¬
::
Wa™FÜ
(cÚ¡ 
¡d
::
sh¬ed_±r
<
T¿n§ùiÚDBMu‹x
> 
mu‹x_¬g
,

65 
št64_t
 
timeout_miüos
) {

66 autØ*
	gmu‹x_obj
 = 
»š‹½»t_ÿ¡
<
Rdb_mu‹x
 *>(
mu‹x_¬g
.
g‘
());

67 
DBUG_ASSERT
(
mu‹x_obj
 !ğ
nuÎ±r
);

69 
mysql_mu‹x_t
 *cÚ¡ 
	gmu‹x_±r
 = &
mu‹x_obj
->
m_mu‹x
;

71 
	g»s
 = 0;

72 
time¥ec
 
	gwa™_timeout
;

74 ià(
	gtimeout_miüos
 < 0)

75 
	gtimeout_miüos
 = 
ONE_YEAR_IN_MICROSECS
;

76 
£t_time¥ec_n£c
(
wa™_timeout
, 
timeout_miüos
 * 1000);

78 #iâdeà
STANDALONE_UNITTEST


79 
PSI_¡age_šfo
 
	gŞd_¡age
;

80 
mysql_mu‹x_as£¹_owÃr
(
mu‹x_±r
);

82 ià(
	gcu¼’t_thd
 && 
	gmu‹x_obj
->
	gm_Şd_¡age_šfo
.
couÁ
(
cu¼’t_thd
) == 0) {

83 
THD_ENTER_COND
(
cu¼’t_thd
, &
m_cÚd
, 
mu‹x_±r
, &
¡age_wa™šg_Ú_row_lock2
,

84 &
Şd_¡age
);

94 
	gmu‹x_obj
->
£t_uÆock_aùiÚ
(&
Şd_¡age
);

98 
boŞ
 
	gkËd
 = 
çl£
;

101 
	g»s
 = 
mysql_cÚd_timedwa™
(&
m_cÚd
, 
mu‹x_±r
, &
wa™_timeout
);

103 #iâdeà
STANDALONE_UNITTEST


104 ià(
	gcu¼’t_thd
)

105 
	gkËd
 = 
my_cÜe
::
thd_kËd
(
cu¼’t_thd
);

107 } !
	gkËd
 && 
	g»s
 =ğ
EINTR
);

109 ià(
	g»s
 || 
	gkËd
)

110  
	gStus
::
TimedOut
();

112  
	gStus
::
OK
();

145 
	gRdb_cÚd_v¬
::
NÙify
(è{ 
mysql_cÚd_sigÇl
(&
m_cÚd
); }

152 
	gRdb_cÚd_v¬
::
NÙifyAÎ
(è{ 
mysql_cÚd_brßdÿ¡
(&
m_cÚd
); }

154 
	gRdb_mu‹x
::
Rdb_mu‹x
() {

155 
mysql_mu‹x_š™
(0 , &
m_mu‹x
,

156 
MY_MUTEX_INIT_FAST
);

159 
	gRdb_mu‹x
::~
Rdb_mu‹x
(è{ 
mysql_mu‹x_de¡roy
(&
m_mu‹x
); }

161 
Stus
 
	gRdb_mu‹x
::
Lock
() {

162 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

163 
DBUG_ASSERT
(
m_Şd_¡age_šfo
.
couÁ
(
cu¼’t_thd
) == 0);

164  
	gStus
::
OK
();

172 
Stus
 
	gRdb_mu‹x
::
TryLockFÜ
(
št64_t
 
timeout_time
 
MY_ATTRIBUTE
((
__unu£d__
))) {

177 
RDB_MUTEX_LOCK_CHECK
(
m_mu‹x
);

178  
	gStus
::
OK
();

181 #iâdeà
STANDALONE_UNITTEST


182 
	gRdb_mu‹x
::
£t_uÆock_aùiÚ
(cÚ¡ 
PSI_¡age_šfo
 *cÚ¡ 
Şd_¡age_¬g
) {

183 
DBUG_ASSERT
(
Şd_¡age_¬g
 !ğ
nuÎ±r
);

185 
mysql_mu‹x_as£¹_owÃr
(&
m_mu‹x
);

186 
DBUG_ASSERT
(
m_Şd_¡age_šfo
.
couÁ
(
cu¼’t_thd
) == 0);

188 
	gm_Şd_¡age_šfo
[
cu¼’t_thd
] =

189 
¡d
::
make_sh¬ed
<
PSI_¡age_šfo
>(*
Şd_¡age_¬g
);

194 
	gRdb_mu‹x
::
UnLock
() {

195 #iâdeà
STANDALONE_UNITTEST


196 ià(
m_Şd_¡age_šfo
.
couÁ
(
cu¼’t_thd
) > 0) {

197 cÚ¡ 
¡d
::
sh¬ed_±r
<
PSI_¡age_šfo
> 
Şd_¡age
 =

198 
m_Şd_¡age_šfo
[
cu¼’t_thd
];

199 
	gm_Şd_¡age_šfo
.
”a£
(
cu¼’t_thd
);

201 
THD_EXIT_COND
(
cu¼’t_thd
, 
Şd_¡age
.
g‘
());

205 
RDB_MUTEX_UNLOCK_CHECK
(
m_mu‹x
);

	@rdb_mutex_wrapper.h

17 #´agm¨
Úû


20 
	~<chrÚo
>

21 
	~<cÚd™iÚ_v¬ŸbË
>

22 
	~<funùiÚ®
>

23 
	~<mu‹x
>

24 
	~<unÜd”ed_m­
>

27 
	~"my_sys.h
"

28 
	~"mysql/¶ugš.h
"

31 
	~"rocksdb/ut™›s/Œª§ùiÚ_db_mu‹x.h
"

33 
Çme¥aû
 
	gmyrocks
 {

35 şas 
	cRdb_mu‹x
 : 
public
 
rocksdb
::
T¿n§ùiÚDBMu‹x
 {

36 
Rdb_mu‹x
(cÚ¡ Rdb_mu‹x &
p
èğ
d–‘e
;

37 
	gRdb_mu‹x
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_mu‹x
 &
p
èğ
d–‘e
;

39 
	gpublic
:

40 
Rdb_mu‹x
();

41 
	gvœtu®
 ~
Rdb_mu‹x
();

49 
vœtu®
 
	grocksdb
::
Stus
 
Lock
(è
ov”ride
;

57 
vœtu®
 
	grocksdb
::
Stus


58 
TryLockFÜ
(
št64_t
 
timeout_time
 
MY_ATTRIBUTE
((
__unu£d__
))è
ov”ride
;

61 
vœtu®
 
UnLock
(è
	gov”ride
;

63 
	g´iv©e
:

64 
mysql_mu‹x_t
 
m_mu‹x
;

65 
ä›nd
 
şass
 
	gRdb_cÚd_v¬
;

67 #iâdeà
STANDALONE_UNITTEST


68 
£t_uÆock_aùiÚ
(cÚ¡ 
PSI_¡age_šfo
 *cÚ¡ 
Şd_¡age_¬g
);

69 
	g¡d
::
unÜd”ed_m­
<
THD
 *, std::
sh¬ed_±r
<
PSI_¡age_šfo
>> 
m_Şd_¡age_šfo
;

73 şas 
	cRdb_cÚd_v¬
 : 
public
 
rocksdb
::
T¿n§ùiÚDBCÚdV¬
 {

74 
Rdb_cÚd_v¬
(cÚ¡ Rdb_cÚd_v¬ &èğ
d–‘e
;

75 
	gRdb_cÚd_v¬
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_cÚd_v¬
 &èğ
d–‘e
;

77 
	gpublic
:

78 
Rdb_cÚd_v¬
();

79 
	gvœtu®
 ~
Rdb_cÚd_v¬
();

90 
vœtu®
 
	grocksdb
::
Stus


91 
Wa™
(cÚ¡ 
¡d
::
sh¬ed_±r
<
rocksdb
::
T¿n§ùiÚDBMu‹x
> 
mu‹x
è
ov”ride
;

105 
vœtu®
 
	grocksdb
::
Stus


106 
Wa™FÜ
(cÚ¡ 
¡d
::
sh¬ed_±r
<
rocksdb
::
T¿n§ùiÚDBMu‹x
> 
mu‹x
,

107 
št64_t
 
timeout_time
è
	gov”ride
;

111 
vœtu®
 
NÙify
(è
	gov”ride
;

114 
vœtu®
 
NÙifyAÎ
(è
	gov”ride
;

116 
	g´iv©e
:

117 
mysql_cÚd_t
 
m_cÚd
;

120 şas 
	cRdb_mu‹x_çùÜy
 : 
public
 
rocksdb
::
T¿n§ùiÚDBMu‹xFaùÜy
 {

121 
public
:

122 
Rdb_mu‹x_çùÜy
(cÚ¡ Rdb_mu‹x_çùÜy &èğ
d–‘e
;

123 
	gRdb_mu‹x_çùÜy
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_mu‹x_çùÜy
 &èğ
d–‘e
;

124 
Rdb_mu‹x_çùÜy
() {}

129 
vœtu®
 
	g¡d
::
sh¬ed_±r
<
rocksdb
::
T¿n§ùiÚDBMu‹x
>

130 
AÎoÿ‹Mu‹x
(è
ov”ride
 {

131  
¡d
::
make_sh¬ed
<
Rdb_mu‹x
>();

134 
vœtu®
 
	g¡d
::
sh¬ed_±r
<
rocksdb
::
T¿n§ùiÚDBCÚdV¬
>

135 
AÎoÿ‹CÚdV¬
(è
ov”ride
 {

136  
¡d
::
make_sh¬ed
<
Rdb_cÚd_v¬
>();

139 
	gvœtu®
 ~
Rdb_mu‹x_çùÜy
() {}

	@rdb_perf_context.cc

19 
	~"rdb_³rf_cÚ‹xt.h
"

22 
	~<¡ršg
>

25 
	~"rocksdb/io¡©s_cÚ‹xt.h
"

26 
	~"rocksdb/³rf_cÚ‹xt.h
"

29 
	~"ha_rocksdb_´Ùo.h
"

31 
Çme¥aû
 
	gmyrocks
 {

38 
	g¡d
::
¡ršg
 
rdb_pc_¡©_ty³s
[] = {

98 
	#IO_PERF_RECORD
(
_f›ld_
) \

100 ià(
rocksdb
::
	`g‘_³rf_cÚ‹xt
()->
_f›ld_
 > 0) \

101 
couÁ”s
->
m_v®ue
[
idx
] +ğ
rocksdb
::
	`g‘_³rf_cÚ‹xt
()->
_f›ld_
; \

102 
idx
++; \

103 } 0)

	)

104 
	#IO_STAT_RECORD
(
_f›ld_
) \

106 ià(
rocksdb
::
	`g‘_io¡©s_cÚ‹xt
()->
_f›ld_
 > 0) \

107 
couÁ”s
->
m_v®ue
[
idx
] +ğ
rocksdb
::
	`g‘_io¡©s_cÚ‹xt
()->
_f›ld_
; \

108 
idx
++; \

109 } 0)

	)

111 
h¬ve¡_diffs
(
Rdb_©omic_³rf_couÁ”s
 *cÚ¡ 
couÁ”s
) {

113 
size_t
 
	gidx
 = 0;

114 
IO_PERF_RECORD
(
u£r_key_com·risÚ_couÁ
);

115 
IO_PERF_RECORD
(
block_ÿche_h™_couÁ
);

116 
IO_PERF_RECORD
(
block_»ad_couÁ
);

117 
IO_PERF_RECORD
(
block_»ad_by‹
);

118 
IO_PERF_RECORD
(
block_»ad_time
);

119 
IO_PERF_RECORD
(
block_checksum_time
);

120 
IO_PERF_RECORD
(
block_decom´ess_time
);

121 
IO_PERF_RECORD
(
g‘_»ad_by‹s
);

122 
IO_PERF_RECORD
(
muÉig‘_»ad_by‹s
);

123 
IO_PERF_RECORD
(
™”_»ad_by‹s
);

124 
IO_PERF_RECORD
(
š‹º®_key_sk³d_couÁ
);

125 
IO_PERF_RECORD
(
š‹º®_d–‘e_sk³d_couÁ
);

126 
IO_PERF_RECORD
(
š‹º®_»ûÁ_sk³d_couÁ
);

127 
IO_PERF_RECORD
(
š‹º®_m”ge_couÁ
);

128 
IO_PERF_RECORD
(
g‘_¢­shÙ_time
);

129 
IO_PERF_RECORD
(
g‘_äom_membË_time
);

130 
IO_PERF_RECORD
(
g‘_äom_membË_couÁ
);

131 
IO_PERF_RECORD
(
g‘_po¡_´oûss_time
);

132 
IO_PERF_RECORD
(
g‘_äom_ouut_fes_time
);

133 
IO_PERF_RECORD
(
£ek_Ú_membË_time
);

134 
IO_PERF_RECORD
(
£ek_Ú_membË_couÁ
);

135 
IO_PERF_RECORD
(
Ãxt_Ú_membË_couÁ
);

136 
IO_PERF_RECORD
(
´ev_Ú_membË_couÁ
);

137 
IO_PERF_RECORD
(
£ek_chd_£ek_time
);

138 
IO_PERF_RECORD
(
£ek_chd_£ek_couÁ
);

139 
IO_PERF_RECORD
(
£ek_mš_h—p_time
);

140 
IO_PERF_RECORD
(
£ek_max_h—p_time
);

141 
IO_PERF_RECORD
(
£ek_š‹º®_£ek_time
);

142 
IO_PERF_RECORD
(
fšd_Ãxt_u£r_’Œy_time
);

143 
IO_PERF_RECORD
(
wr™e_w®_time
);

144 
IO_PERF_RECORD
(
wr™e_membË_time
);

145 
IO_PERF_RECORD
(
wr™e_d–ay_time
);

146 
IO_PERF_RECORD
(
wr™e_´e_ªd_po¡_´oûss_time
);

147 
IO_PERF_RECORD
(
db_mu‹x_lock_Çnos
);

148 
IO_PERF_RECORD
(
db_cÚd™iÚ_wa™_Çnos
);

149 
IO_PERF_RECORD
(
m”ge_İ”©Ü_time_Çnos
);

150 
IO_PERF_RECORD
(
»ad_šdex_block_Çnos
);

151 
IO_PERF_RECORD
(
»ad_f‹r_block_Çnos
);

152 
IO_PERF_RECORD
(
Ãw_bË_block_™”_Çnos
);

153 
IO_PERF_RECORD
(
Ãw_bË_™”©Ü_Çnos
);

154 
IO_PERF_RECORD
(
block_£ek_Çnos
);

155 
IO_PERF_RECORD
(
fšd_bË_Çnos
);

156 
IO_PERF_RECORD
(
bloom_membË_h™_couÁ
);

157 
IO_PERF_RECORD
(
bloom_membË_miss_couÁ
);

158 
IO_PERF_RECORD
(
bloom_s¡_h™_couÁ
);

159 
IO_PERF_RECORD
(
bloom_s¡_miss_couÁ
);

160 
IO_PERF_RECORD
(
key_lock_wa™_time
);

161 
IO_PERF_RECORD
(
key_lock_wa™_couÁ
);

163 
IO_STAT_RECORD
(
th»ad_poŞ_id
);

164 
IO_STAT_RECORD
(
by‹s_wr™‹n
);

165 
IO_STAT_RECORD
(
by‹s_»ad
);

166 
IO_STAT_RECORD
(
İ’_Çnos
);

167 
IO_STAT_RECORD
(
®loÿ‹_Çnos
);

168 
IO_STAT_RECORD
(
wr™e_Çnos
);

169 
IO_STAT_RECORD
(
»ad_Çnos
);

170 
IO_STAT_RECORD
(
¿nge_sync_Çnos
);

171 
IO_STAT_RECORD
(
logg”_Çnos
);

174 #undeà
IO_PERF_DIFF


175 #undeà
IO_STAT_DIFF


177 
Rdb_©omic_³rf_couÁ”s
 
	grdb_glob®_³rf_couÁ”s
;

179 
rdb_g‘_glob®_³rf_couÁ”s
(
Rdb_³rf_couÁ”s
 *cÚ¡ 
couÁ”s
) {

180 
DBUG_ASSERT
(
couÁ”s
 !ğ
nuÎ±r
);

182 
	gcouÁ”s
->
lßd
(
rdb_glob®_³rf_couÁ”s
);

185 
	gRdb_³rf_couÁ”s
::
lßd
(cÚ¡ 
Rdb_©omic_³rf_couÁ”s
 &
©omic_couÁ”s
) {

186 
i
 = 0; 
	gi
 < 
	gPC_MAX_IDX
; i++) {

187 
	gm_v®ue
[
i
] = 
©omic_couÁ”s
.
m_v®ue
[i].
lßd
(
¡d
::
memÜy_Üd”_»Ïxed
);

191 
boŞ
 
	gRdb_io_³rf
::
¡¬t
(cÚ¡ 
ušt32_t
 
³rf_cÚ‹xt_Ëv–
) {

192 cÚ¡ 
rocksdb
::
P”fLev–
 
³rf_Ëv–
 =

193 
¡©ic_ÿ¡
<
rocksdb
::
P”fLev–
>(
³rf_cÚ‹xt_Ëv–
);

195 ià(
	grocksdb
::
G‘P”fLev–
(è!ğ
³rf_Ëv–
) {

196 
rocksdb
::
S‘P”fLev–
(
³rf_Ëv–
);

199 ià(
	g³rf_Ëv–
 =ğ
rocksdb
::
kDi§bË
) {

200  
çl£
;

203 
	grocksdb
::
g‘_³rf_cÚ‹xt
()->
Re£t
();

204 
	grocksdb
::
g‘_io¡©s_cÚ‹xt
()->
Re£t
();

205  
	gŒue
;

208 
	gRdb_io_³rf
::
upd©e_by‹s_wr™‹n
(cÚ¡ 
ušt32_t
 
³rf_cÚ‹xt_Ëv–
,

209 
ulÚglÚg
 
by‹s_wr™‹n
) {

210 cÚ¡ 
	grocksdb
::
P”fLev–
 
³rf_Ëv–
 =

211 
¡©ic_ÿ¡
<
rocksdb
::
P”fLev–
>(
³rf_cÚ‹xt_Ëv–
);

212 ià(
	g³rf_Ëv–
 !ğ
rocksdb
::
kDi§bË
 && 
m_sh¬ed_io_³rf_wr™e
) {

213 
io_wr™e_by‹s
 +ğ
by‹s_wr™‹n
;

214 
	gio_wr™e_»que¡s
 += 1;

218 
	gRdb_io_³rf
::
’d_ªd_»cÜd
(cÚ¡ 
ušt32_t
 
³rf_cÚ‹xt_Ëv–
) {

219 cÚ¡ 
rocksdb
::
P”fLev–
 
³rf_Ëv–
 =

220 
¡©ic_ÿ¡
<
rocksdb
::
P”fLev–
>(
³rf_cÚ‹xt_Ëv–
);

222 ià(
	g³rf_Ëv–
 =ğ
rocksdb
::
kDi§bË
) {

226 ià(
	gm_©omic_couÁ”s
) {

227 
h¬ve¡_diffs
(
m_©omic_couÁ”s
);

229 
h¬ve¡_diffs
(&
rdb_glob®_³rf_couÁ”s
);

231 ià(
	gm_sh¬ed_io_³rf_»ad
 &&

232 (
	grocksdb
::
g‘_³rf_cÚ‹xt
()->
block_»ad_by‹
 != 0 ||

233 
rocksdb
::
g‘_³rf_cÚ‹xt
()->
block_»ad_couÁ
 != 0 ||

234 
rocksdb
::
g‘_³rf_cÚ‹xt
()->
block_»ad_time
 != 0)) {

235 
my_io_³rf_t
 
io_³rf_»ad
;

237 
	gio_³rf_»ad
.
š™
();

238 
	gio_³rf_»ad
.
	gby‹s
 = 
rocksdb
::
g‘_³rf_cÚ‹xt
()->
block_»ad_by‹
;

239 
	gio_³rf_»ad
.
	g»que¡s
 = 
rocksdb
::
g‘_³rf_cÚ‹xt
()->
block_»ad_couÁ
;

245 
	gio_³rf_»ad
.
	gsvc_time_max
 = 
io_³rf_»ad
.
svc_time
 =

246 
rocksdb
::
g‘_³rf_cÚ‹xt
()->
block_»ad_time
;

248 
	gm_sh¬ed_io_³rf_»ad
->
sum
(
io_³rf_»ad
);

249 
	gm_¡©s
->
	gbË_io_³rf_»ad
.
sum
(
io_³rf_»ad
);

252 ià(
	gm_sh¬ed_io_³rf_wr™e
 &&

253 (
	gio_wr™e_by‹s
 !ğ0 || 
io_wr™e_»que¡s
 != 0)) {

254 
my_io_³rf_t
 
io_³rf_wr™e
;

255 
	gio_³rf_wr™e
.
š™
();

256 
	gio_³rf_wr™e
.
	gby‹s
 = 
io_wr™e_by‹s
;

257 
	gio_³rf_wr™e
.
	g»que¡s
 = 
io_wr™e_»que¡s
;

258 
	gm_sh¬ed_io_³rf_wr™e
->
sum
(
io_³rf_wr™e
);

259 
	gm_¡©s
->
	gbË_io_³rf_wr™e
.
sum
(
io_³rf_wr™e
);

260 
	gio_wr™e_by‹s
 = 0;

261 
	gio_wr™e_»que¡s
 = 0;

264 ià(
	gm_¡©s
) {

265 ià(
	grocksdb
::
g‘_³rf_cÚ‹xt
()->
š‹º®_key_sk³d_couÁ
 != 0) {

266 
m_¡©s
->
key_sk³d
 +=

267 
rocksdb
::
g‘_³rf_cÚ‹xt
()->
š‹º®_key_sk³d_couÁ
;

270 ià(
	grocksdb
::
g‘_³rf_cÚ‹xt
()->
š‹º®_d–‘e_sk³d_couÁ
 != 0) {

271 
m_¡©s
->
d–‘e_sk³d
 +=

272 
rocksdb
::
g‘_³rf_cÚ‹xt
()->
š‹º®_d–‘e_sk³d_couÁ
;

	@rdb_perf_context.h

17 #´agm¨
Úû


20 
	~<©omic
>

21 
	~<c¡dšt
>

22 
	~<¡ršg
>

25 
	~"hªdËr.h
"

26 
	~<my_glob®.h
>

28 
Çme¥aû
 
	gmyrocks
 {

31 
	gPC_USER_KEY_COMPARISON_COUNT
 = 0,

32 
	gPC_BLOCK_CACHE_HIT_COUNT
,

33 
	gPC_BLOCK_READ_COUNT
,

34 
	gPC_BLOCK_READ_BYTE
,

35 
	gPC_BLOCK_READ_TIME
,

36 
	gPC_BLOCK_CHECKSUM_TIME
,

37 
	gPC_BLOCK_DECOMPRESS_TIME
,

38 
	gPC_GET_READ_BYTES
,

39 
	gPC_MULTIGET_READ_BYTES
,

40 
	gPC_ITER_READ_BYTES
,

41 
	gPC_KEY_SKIPPED
,

42 
	gPC_DELETE_SKIPPED
,

43 
	gPC_RECENT_SKIPPED
,

44 
	gPC_MERGE
,

45 
	gPC_GET_SNAPSHOT_TIME
,

46 
	gPC_GET_FROM_MEMTABLE_TIME
,

47 
	gPC_GET_FROM_MEMTABLE_COUNT
,

48 
	gPC_GET_POST_PROCESS_TIME
,

49 
	gPC_GET_FROM_OUTPUT_FILES_TIME
,

50 
	gPC_SEEK_ON_MEMTABLE_TIME
,

51 
	gPC_SEEK_ON_MEMTABLE_COUNT
,

52 
	gPC_NEXT_ON_MEMTABLE_COUNT
,

53 
	gPC_PREV_ON_MEMTABLE_COUNT
,

54 
	gPC_SEEK_CHILD_SEEK_TIME
,

55 
	gPC_SEEK_CHILD_SEEK_COUNT
,

56 
	gPC_SEEK_MIN_HEAP_TIME
,

57 
	gPC_SEEK_MAX_HEAP_TIME
,

58 
	gPC_SEEK_INTERNAL_SEEK_TIME
,

59 
	gPC_FIND_NEXT_USER_ENTRY_TIME
,

60 
	gPC_WRITE_WAL_TIME
,

61 
	gPC_WRITE_MEMTABLE_TIME
,

62 
	gPC_WRITE_DELAY_TIME
,

63 
	gPC_WRITE_PRE_AND_POST_PROCESSS_TIME
,

64 
	gPC_DB_MUTEX_LOCK_NANOS
,

65 
	gPC_DB_CONDITION_WAIT_NANOS
,

66 
	gPC_MERGE_OPERATOR_TIME_NANOS
,

67 
	gPC_READ_INDEX_BLOCK_NANOS
,

68 
	gPC_READ_FILTER_BLOCK_NANOS
,

69 
	gPC_NEW_TABLE_BLOCK_ITER_NANOS
,

70 
	gPC_NEW_TABLE_ITERATOR_NANOS
,

71 
	gPC_BLOCK_SEEK_NANOS
,

72 
	gPC_FIND_TABLE_NANOS
,

73 
	gPC_BLOOM_MEMTABLE_HIT_COUNT
,

74 
	gPC_BLOOM_MEMTABLE_MISS_COUNT
,

75 
	gPC_BLOOM_SST_HIT_COUNT
,

76 
	gPC_BLOOM_SST_MISS_COUNT
,

77 
	gPC_KEY_LOCK_WAIT_TIME
,

78 
	gPC_KEY_LOCK_WAIT_COUNT
,

79 
	gPC_IO_THREAD_POOL_ID
,

80 
	gPC_IO_BYTES_WRITTEN
,

81 
	gPC_IO_BYTES_READ
,

82 
	gPC_IO_OPEN_NANOS
,

83 
	gPC_IO_ALLOCATE_NANOS
,

84 
	gPC_IO_WRITE_NANOS
,

85 
	gPC_IO_READ_NANOS
,

86 
	gPC_IO_RANGE_SYNC_NANOS
,

87 
	gPC_IO_LOGGER_NANOS
,

88 
	gPC_MAX_IDX


91 
şass
 
	gRdb_³rf_couÁ”s
;

97 
	sRdb_©omic_³rf_couÁ”s
 {

98 
	g¡d
::
©omic_uÎÚg
 
m_v®ue
[
PC_MAX_IDX
];

105 şas 
	cRdb_³rf_couÁ”s
 {

106 
Rdb_³rf_couÁ”s
(cÚ¡ Rdb_³rf_couÁ” &èğ
d–‘e
;

107 
	gRdb_³rf_couÁ”s
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_³rf_couÁ”s
 &èğ
d–‘e
;

109 
	gpublic
:

110 
Rdb_³rf_couÁ”s
() = ;

111 
ušt64_t
 
	gm_v®ue
[
PC_MAX_IDX
];

113 
lßd
(cÚ¡ 
Rdb_©omic_³rf_couÁ”s
 &
©omic_couÁ”s
);

116 
¡d
::
¡ršg
 
rdb_pc_¡©_ty³s
[
PC_MAX_IDX
];

121 şas 
	cRdb_io_³rf
 {

123 
Rdb_©omic_³rf_couÁ”s
 *
	gm_©omic_couÁ”s
 = 
nuÎ±r
;

124 
my_io_³rf_©omic_t
 *
	gm_sh¬ed_io_³rf_»ad
 = 
nuÎ±r
;

125 
my_io_³rf_©omic_t
 *
	gm_sh¬ed_io_³rf_wr™e
 = 
nuÎ±r
;

126 
ha_¡©i¡ics
 *
	gm_¡©s
 = 
nuÎ±r
;

128 
ušt64_t
 
	gio_wr™e_by‹s
;

129 
ušt64_t
 
	gio_wr™e_»que¡s
;

131 
	gpublic
:

132 
Rdb_io_³rf
(cÚ¡ Rdb_io_³rà&èğ
d–‘e
;

133 
	gRdb_io_³rf
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_io_³rf
 &èğ
d–‘e
;

135 
š™
(
Rdb_©omic_³rf_couÁ”s
 *cÚ¡ 
©omic_couÁ”s
,

136 
my_io_³rf_©omic_t
 *cÚ¡ 
sh¬ed_io_³rf_»ad
,

137 
my_io_³rf_©omic_t
 *cÚ¡ 
sh¬ed_io_³rf_wr™e
,

138 
ha_¡©i¡ics
 *cÚ¡ 
¡©s
) {

139 
DBUG_ASSERT
(
©omic_couÁ”s
 !ğ
nuÎ±r
);

140 
DBUG_ASSERT
(
sh¬ed_io_³rf_»ad
 !ğ
nuÎ±r
);

141 
DBUG_ASSERT
(
sh¬ed_io_³rf_wr™e
 !ğ
nuÎ±r
);

142 
DBUG_ASSERT
(
¡©s
 !ğ
nuÎ±r
);

144 
	gm_©omic_couÁ”s
 = 
©omic_couÁ”s
;

145 
	gm_sh¬ed_io_³rf_»ad
 = 
sh¬ed_io_³rf_»ad
;

146 
	gm_sh¬ed_io_³rf_wr™e
 = 
sh¬ed_io_³rf_wr™e
;

147 
	gm_¡©s
 = 
¡©s
;

149 
	gio_wr™e_by‹s
 = 0;

150 
	gio_wr™e_»que¡s
 = 0;

153 
boŞ
 
¡¬t
(cÚ¡ 
ušt32_t
 
³rf_cÚ‹xt_Ëv–
);

154 
upd©e_by‹s_wr™‹n
(cÚ¡ 
ušt32_t
 
³rf_cÚ‹xt_Ëv–
,

155 
ulÚglÚg
 
by‹s_wr™‹n
);

156 
’d_ªd_»cÜd
(cÚ¡ 
ušt32_t
 
³rf_cÚ‹xt_Ëv–
);

158 
ex¶ic™
 
Rdb_io_³rf
()

159 : 
m_©omic_couÁ”s
(
nuÎ±r
), 
m_sh¬ed_io_³rf_»ad
(nullptr),

160 
m_¡©s
(
nuÎ±r
), 
io_wr™e_by‹s
(0), 
io_wr™e_»que¡s
(0) {}

	@rdb_psi.cc

16 #ifdeà
USE_PRAGMA_IMPLEMENTATION


17 #´agm¨
im¶em’tiÚ


20 
	#MYSQL_SERVER
 1

	)

23 
	~"rdb_psi.h
"

26 
	~<mysql/psi/mysql_¡age.h
>

28 
Çme¥aû
 
	gmyrocks
 {

34 
	gmy_cÜe
::
PSI_¡age_šfo
 
¡age_wa™šg_Ú_row_lock
 = {0, "Waiting for„ow†ock",

37 #ifdeà
HAVE_PSI_INTERFACE


38 
	gmy_cÜe
::
PSI_¡age_šfo
 *
®l_rocksdb_¡ages
[] = {&
¡age_wa™šg_Ú_row_lock
};

40 
	gmy_cÜe
::
PSI_th»ad_key
 
rdb_background_psi_th»ad_key
,

41 
	grdb_drİ_idx_psi_th»ad_key
;

43 
	gmy_cÜe
::
PSI_th»ad_šfo
 
®l_rocksdb_th»ads
[] = {

44 {&
rdb_background_psi_th»ad_key
, "background", 
PSI_FLAG_GLOBAL
},

45 {&
rdb_drİ_idx_psi_th»ad_key
, "drİ index", 
PSI_FLAG_GLOBAL
},

48 
	gmy_cÜe
::
PSI_mu‹x_key
 
rdb_psi_İ’_tbls_mu‹x_key
, 
	grdb_sigÇl_bg_psi_mu‹x_key
,

49 
	grdb_sigÇl_drİ_idx_psi_mu‹x_key
, 
	grdb_cŞÏtiÚ_d©a_mu‹x_key
,

50 
	grdb_mem_cmp_¥aû_mu‹x_key
, 
	gkey_mu‹x_tx_li¡
, 
	grdb_sysv¬s_psi_mu‹x_key
,

51 
	grdb_cfm_mu‹x_key
, 
	grdb_s¡_comm™_key
;

53 
	gmy_cÜe
::
PSI_mu‹x_šfo
 
®l_rocksdb_mu‹xes
[] = {

54 {&
rdb_psi_İ’_tbls_mu‹x_key
, "İ’abËs", 
PSI_FLAG_GLOBAL
},

55 {&
rdb_sigÇl_bg_psi_mu‹x_key
, "¡İ background", 
PSI_FLAG_GLOBAL
},

56 {&
rdb_sigÇl_drİ_idx_psi_mu‹x_key
, "sigÇÈdrİ index", 
PSI_FLAG_GLOBAL
},

57 {&
rdb_cŞÏtiÚ_d©a_mu‹x_key
, "cŞÏtiÚ d©¨š™", 
PSI_FLAG_GLOBAL
},

58 {&
rdb_mem_cmp_¥aû_mu‹x_key
, "collation space char data init",

59 
PSI_FLAG_GLOBAL
},

60 {&
key_mu‹x_tx_li¡
, "tx_li¡", 
PSI_FLAG_GLOBAL
},

61 {&
rdb_sysv¬s_psi_mu‹x_key
, "£‰šg sysv¬", 
PSI_FLAG_GLOBAL
},

62 {&
rdb_cfm_mu‹x_key
, "cŞumÀçmy mªag”", 
PSI_FLAG_GLOBAL
},

63 {&
rdb_s¡_comm™_key
, "s¡ comm™", 
PSI_FLAG_GLOBAL
},

66 
	gmy_cÜe
::
PSI_rwlock_key
 
key_rwlock_cŞÏtiÚ_exû±iÚ_li¡
,

67 
	gkey_rwlock_»ad_ä“_½l_bËs
, 
	gkey_rwlock_sk_unique_check_bËs
;

69 
	gmy_cÜe
::
PSI_rwlock_šfo
 
®l_rocksdb_rwlocks
[] = {

70 {&
key_rwlock_cŞÏtiÚ_exû±iÚ_li¡
, "collation_exception_list",

71 
PSI_FLAG_GLOBAL
},

72 {&
key_rwlock_»ad_ä“_½l_bËs
, "»ad_ä“_½l_bËs", 
PSI_FLAG_GLOBAL
},

73 {&
key_rwlock_sk_unique_check_bËs
, "skip_unique_check_tables",

74 
PSI_FLAG_GLOBAL
},

77 
	gmy_cÜe
::
PSI_cÚd_key
 
rdb_sigÇl_bg_psi_cÚd_key
,

78 
	grdb_sigÇl_drİ_idx_psi_cÚd_key
;

80 
	gmy_cÜe
::
PSI_cÚd_šfo
 
®l_rocksdb_cÚds
[] = {

81 {&
rdb_sigÇl_bg_psi_cÚd_key
, "cÚd sigÇÈbackground", 
PSI_FLAG_GLOBAL
},

82 {&
rdb_sigÇl_drİ_idx_psi_cÚd_key
, "cond signal drop index",

83 
PSI_FLAG_GLOBAL
},

86 
š™_rocksdb_psi_keys
() {

87 cÚ¡ *cÚ¡ 
	gÿ‹gÜy
 = "rocksdb";

88 
	gcouÁ
;

90 ià(
	gPSI_£rv”
 =ğ
nuÎ±r
)

93 
	gcouÁ
 = 
¬¿y_–em’ts
(
®l_rocksdb_mu‹xes
);

94 
	gPSI_£rv”
->
»gi¡”_mu‹x
(
ÿ‹gÜy
, 
®l_rocksdb_mu‹xes
, 
couÁ
);

96 
	gcouÁ
 = 
¬¿y_–em’ts
(
®l_rocksdb_rwlocks
);

97 
	gPSI_£rv”
->
»gi¡”_rwlock
(
ÿ‹gÜy
, 
®l_rocksdb_rwlocks
, 
couÁ
);

99 
	gcouÁ
 = 
¬¿y_–em’ts
(
®l_rocksdb_cÚds
);

104 
	gcouÁ
 = 
¬¿y_–em’ts
(
®l_rocksdb_¡ages
);

105 
mysql_¡age_»gi¡”
(
ÿ‹gÜy
, 
®l_rocksdb_¡ages
, 
couÁ
);

107 
	gcouÁ
 = 
¬¿y_–em’ts
(
®l_rocksdb_th»ads
);

108 
mysql_th»ad_»gi¡”
(
ÿ‹gÜy
, 
®l_rocksdb_th»ads
, 
couÁ
);

111 
š™_rocksdb_psi_keys
() {}

	@rdb_psi.h

15 #´agm¨
Úû


17 #iâdeà
_rdb_psi_h_


18 
	#_rdb_psi_h_


	)

21 
	~<my_glob®.h
>

22 
	~<my_±h»ad.h
>

23 
	~<mysql/psi/psi.h
>

26 
	~"rdb_uts.h
"

28 
Çme¥aû
 
	gmyrocks
 {

34 
my_cÜe
::
PSI_¡age_šfo
 
¡age_wa™šg_Ú_row_lock
;

36 #ifdeà
HAVE_PSI_INTERFACE


37 
my_cÜe
::
PSI_th»ad_key
 
rdb_background_psi_th»ad_key
,

38 
rdb_drİ_idx_psi_th»ad_key
;

40 
my_cÜe
::
PSI_mu‹x_key
 
rdb_psi_İ’_tbls_mu‹x_key
,

41 
rdb_sigÇl_bg_psi_mu‹x_key
, 
rdb_sigÇl_drİ_idx_psi_mu‹x_key
,

42 
rdb_cŞÏtiÚ_d©a_mu‹x_key
, 
rdb_mem_cmp_¥aû_mu‹x_key
,

43 
key_mu‹x_tx_li¡
, 
rdb_sysv¬s_psi_mu‹x_key
, 
rdb_cfm_mu‹x_key
,

44 
rdb_s¡_comm™_key
;

46 
my_cÜe
::
PSI_rwlock_key
 
key_rwlock_cŞÏtiÚ_exû±iÚ_li¡
,

47 
key_rwlock_»ad_ä“_½l_bËs
, 
key_rwlock_sk_unique_check_bËs
;

49 
my_cÜe
::
PSI_cÚd_key
 
rdb_sigÇl_bg_psi_cÚd_key
,

50 
rdb_sigÇl_drİ_idx_psi_cÚd_key
;

53 
š™_rocksdb_psi_keys
();

	@rdb_sst_info.cc

18 
	~"rdb_s¡_šfo.h
"

21 
	~<c¡dio
>

22 
	~<¡ršg
>

23 
	~<ut™y
>

24 
	~<veùÜ
>

27 
	~"../sql/log.h
"

28 
	~"my_dœ.h
"

31 
	~"rocksdb/db.h
"

32 
	~"rocksdb/İtiÚs.h
"

35 
	~"ha_rocksdb.h
"

36 
	~"ha_rocksdb_´Ùo.h
"

37 
	~"rdb_cf_İtiÚs.h
"

38 
	~"rdb_psi.h
"

40 
Çme¥aû
 
	gmyrocks
 {

42 
	gRdb_s¡_fe_Üd”ed
::
Rdb_s¡_fe
::Rdb_sst_file(

43 
rocksdb
::
DB
 *cÚ¡ 
db
,„ocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cf
,

44 cÚ¡ 
rocksdb
::
DBO±iÚs
 &
db_İtiÚs
, cÚ¡ 
¡d
::
¡ršg
 &
Çme
,

45 cÚ¡ 
boŞ
 
Œacšg
)

46 : 
m_db
(
db
), 
m_cf
(
cf
), 
m_db_İtiÚs
(
db_İtiÚs
), 
m_s¡_fe_wr™”
(
nuÎ±r
),

47 
m_Çme
(
Çme
), 
m_Œacšg
(
Œacšg
), 
m_com·¿tÜ
(
cf
->
G‘Com·¿tÜ
()) {

48 
DBUG_ASSERT
(
db
 !ğ
nuÎ±r
);

49 
DBUG_ASSERT
(
cf
 !ğ
nuÎ±r
);

52 
	gRdb_s¡_fe_Üd”ed
::
Rdb_s¡_fe
::~Rdb_sst_file() {

54 
d–‘e
 
m_s¡_fe_wr™”
;

55 
	gm_s¡_fe_wr™”
 = 
nuÎ±r
;

60 
	g¡d
::
»move
(
m_Çme
.
c_¡r
());

63 
	grocksdb
::
Stus
 
Rdb_s¡_fe_Üd”ed
::
Rdb_s¡_fe
::
İ’
() {

64 
DBUG_ASSERT
(
m_s¡_fe_wr™”
 =ğ
nuÎ±r
);

66 
	grocksdb
::
CŞumnFamyDesütÜ
 
cf_desü
;

68 
	grocksdb
::
Stus
 
s
 = 
m_cf
->
G‘DesütÜ
(&
cf_desü
);

69 ià(!
	gs
.
ok
()) {

70  
	gs
;

74 cÚ¡ 
	grocksdb
::
EnvO±iÚs
 
’v_İtiÚs
(
m_db_İtiÚs
);

75 cÚ¡ 
	grocksdb
::
O±iÚs
 
İtiÚs
(
m_db_İtiÚs
, 
cf_desü
.options);

77 
	gm_s¡_fe_wr™”
 =

78 
Ãw
 
rocksdb
::
S¡FeWr™”
(
’v_İtiÚs
, 
İtiÚs
, 
m_com·¿tÜ
, 
m_cf
, 
Œue
,

79 
rocksdb
::
Env
::
IOPriÜ™y
::
IO_TOTAL
,

80 
cf_desü
.
İtiÚs
.
İtimize_f‹rs_fÜ_h™s
);

82 
	gs
 = 
m_s¡_fe_wr™”
->
O³n
(
m_Çme
);

83 ià(
	gm_Œacšg
) {

85 
sql_´št_šfÜm©iÚ
("SST T¿cšg: O³n(%sè»tuºed %s", 
m_Çme
.
c_¡r
(),

86 
s
.
ok
() ? "ok" : "not ok");

89 ià(!
	gs
.
ok
()) {

90 
d–‘e
 
	gm_s¡_fe_wr™”
;

91 
	gm_s¡_fe_wr™”
 = 
nuÎ±r
;

94  
	gs
;

97 
	grocksdb
::
Stus


98 
Rdb_s¡_fe_Üd”ed
::
Rdb_s¡_fe
::
put
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

99 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
) {

100 
DBUG_ASSERT
(
m_s¡_fe_wr™”
 !ğ
nuÎ±r
);

103 #´agm¨
GCC
 
dŸgno¡ic
 
push


104 #´agm¨
GCC
 
dŸgno¡ic
 
ignÜed
 "-Wdeprecated-declarations"

105  
	gm_s¡_fe_wr™”
->
Add
(
key
, 
v®ue
);

108 
	g¡d
::
¡ršg


109 
Rdb_s¡_fe_Üd”ed
::
Rdb_s¡_fe
::
g’”©eKey
(cÚ¡ 
¡d
::
¡ršg
 &
key
) {

110 cÚ¡ 
hexdig™
[] = {'0', '1', '2', '3', '4', '5', '6', '7',

113 
	g¡d
::
¡ršg
 
»s
;

115 
	g»s
.
»£rve
(
key
.
size
() * 2);

117 autØ
	gch
 : 
key
) {

118 
»s
 +ğ
hexdig™
[((
ušt8_t
)
ch
) >> 4];

119 
	g»s
 +ğ
hexdig™
[((
ušt8_t
)
ch
) & 0x0F];

122  
	g»s
;

126 
	grocksdb
::
Stus
 
Rdb_s¡_fe_Üd”ed
::
Rdb_s¡_fe
::
comm™
() {

127 
DBUG_ASSERT
(
m_s¡_fe_wr™”
 !ğ
nuÎ±r
);

129 
	grocksdb
::
Stus
 
s
;

130 
	grocksdb
::
Ex‹º®S¡FeInfo
 
fešfo
;

133 
	gs
 = 
m_s¡_fe_wr™”
->
Fšish
(&
fešfo
);

134 ià(
	gm_Œacšg
) {

136 
sql_´št_šfÜm©iÚ
("SST Tracing: Finish„eturned %s",

137 
s
.
ok
() ? "ok" : "not ok");

140 ià(
	gs
.
ok
()) {

141 ià(
	gm_Œacšg
) {

143 
sql_´št_šfÜm©iÚ
("SST Tracing: Adding file %s, smallest key: %s, "

144 "Ïrge¡ key: %s, fsize: %" 
PRIu64
 ", "

145 "num_’Œ›s: %" 
PRIu64
,

146 
fešfo
.
fe_·th
.
c_¡r
(),

147 
g’”©eKey
(
fešfo
.
sm®Ë¡_key
).
c_¡r
(),

148 
g’”©eKey
(
fešfo
.
Ïrge¡_key
).
c_¡r
(),

149 
fešfo
.
fe_size
, fešfo.
num_’Œ›s
);

155 
	grocksdb
::
Inge¡Ex‹º®FeO±iÚs
 
İts
;

156 
	gİts
.
	gmove_fes
 = 
Œue
;

157 
	gİts
.
	g¢­shÙ_cÚsi¡’cy
 = 
çl£
;

158 
	gİts
.
	g®low_glob®_£qno
 = 
çl£
;

159 
	gİts
.
	g®low_blockšg_æush
 = 
çl£
;

160 
	gs
 = 
m_db
->
Inge¡Ex‹º®Fe
(
m_cf
, {
m_Çme
}, 
İts
);

162 ià(
	gm_Œacšg
) {

164 
sql_´št_šfÜm©iÚ
("SST Tracing: AddFile(%s)„eturned %s",

165 
fešfo
.
fe_·th
.
c_¡r
(),

166 
s
.
ok
() ? "ok" : "not ok");

170 
d–‘e
 
	gm_s¡_fe_wr™”
;

171 
	gm_s¡_fe_wr™”
 = 
nuÎ±r
;

173  
	gs
;

176 
	gRdb_s¡_fe_Üd”ed
::
Rdb_s¡_¡ack
::
push
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

177 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
) {

178 ià(
m_bufãr
 =ğ
nuÎ±r
) {

179 
m_bufãr
 = 
Ãw
 [
m_bufãr_size
];

183 
size_t
 
	gkey_off£t
 = 
m_off£t
;

184 
memıy
(
m_bufãr
 + 
m_off£t
, 
key
.
d©a
(), key.
size
());

185 
	gm_off£t
 +ğ
key
.
size
();

186 
memıy
(
m_bufãr
 + 
m_off£t
, 
v®ue
.
d©a
(), v®ue.
size
());

187 
	gm_off£t
 +ğ
v®ue
.
size
();

190 
	gm_¡ack
.
push
(
¡d
::
make_tu¶e
(
key_off£t
, 
key
.
size
(), 
v®ue
.size()));

193 
	g¡d
::
·œ
<
rocksdb
::
Sliû
, 
	grocksdb
::Slice>

194 
Rdb_s¡_fe_Üd”ed
::
Rdb_s¡_¡ack
::
tİ
() {

195 
size_t
 
off£t
, 
	gkey_Ën
, 
	gv®ue_Ën
;

197 
	g¡d
::
t›
(
off£t
, 
key_Ën
, 
v®ue_Ën
èğ
m_¡ack
.
tİ
();

201 
DBUG_ASSERT
(
m_bufãr
 !ğ
nuÎ±r
);

202 
	grocksdb
::
Sliû
 
key
(
m_bufãr
 + 
off£t
, 
key_Ën
);

203 
	grocksdb
::
Sliû
 
v®ue
(
m_bufãr
 + 
off£t
 + 
key_Ën
, 
v®ue_Ën
);

205  
	g¡d
::
make_·œ
(
key
, 
v®ue
);

208 
	gRdb_s¡_fe_Üd”ed
::
Rdb_s¡_fe_Üd”ed
(

209 
rocksdb
::
DB
 *cÚ¡ 
db
,„ocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cf
,

210 cÚ¡ 
rocksdb
::
DBO±iÚs
 &
db_İtiÚs
, cÚ¡ 
¡d
::
¡ršg
 &
Çme
,

211 cÚ¡ 
boŞ
 
Œacšg
, 
size_t
 
max_size
)

212 : 
m_u£_¡ack
(
çl£
), 
m_fœ¡
(
Œue
), 
m_¡ack
(
max_size
),

213 
m_fe
(
db
, 
cf
, 
db_İtiÚs
, 
Çme
, 
Œacšg
) {

214 
	gm_¡ack
.
»£t
();

217 
	grocksdb
::
Stus
 
Rdb_s¡_fe_Üd”ed
::
­¶y_fœ¡
() {

218 
rocksdb
::
Sliû
 
fœ¡_key_¦iû
(
m_fœ¡_key
);

219 
	grocksdb
::
Sliû
 
fœ¡_v®ue_¦iû
(
m_fœ¡_v®ue
);

220 
	grocksdb
::
Stus
 
s
;

222 ià(
	gm_u£_¡ack
) {

224 
	gm_¡ack
.
push
(
fœ¡_key_¦iû
, 
fœ¡_v®ue_¦iû
);

227 
	gs
 = 
m_fe
.
put
(
fœ¡_key_¦iû
, 
fœ¡_v®ue_¦iû
);

228 ià(!
	gs
.
ok
()) {

229  
	gs
;

234 
	gm_fœ¡_key
.
ş—r
();

235 
	gm_fœ¡_v®ue
.
ş—r
();

237  
	gs
;

240 
	grocksdb
::
Stus
 
Rdb_s¡_fe_Üd”ed
::
put
(cÚ¡ 
rocksdb
::
Sliû
 &
key
,

241 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
) {

242 
rocksdb
::
Stus
 
s
;

245 ià(
	gm_fœ¡
) {

246 
	gm_fœ¡_key
 = 
key
.
ToSŒšg
();

247 
	gm_fœ¡_v®ue
 = 
v®ue
.
ToSŒšg
();

248 
	gm_fœ¡
 = 
çl£
;

249  
	grocksdb
::
Stus
::
OK
();

255 ià(!
	gm_fœ¡_key
.
em±y
()) {

256 
	grocksdb
::
Sliû
 
fœ¡_key_¦iû
(
m_fœ¡_key
);

257 
	gcmp
 = 
m_fe
.
com·»
(
fœ¡_key_¦iû
, 
key
);

258 
	gm_u£_¡ack
 = (
cmp
 > 0);

261 
	gs
 = 
­¶y_fœ¡
();

262 ià(!
	gs
.
ok
()) {

263  
	gs
;

268 ià(
	gm_u£_¡ack
) {

269 
	gm_¡ack
.
push
(
key
, 
v®ue
);

271 
	gs
 = 
m_fe
.
put
(
key
, 
v®ue
);

274  
	gs
;

277 
	grocksdb
::
Stus
 
Rdb_s¡_fe_Üd”ed
::
comm™
() {

278 
rocksdb
::
Stus
 
s
;

281 ià(!
	gm_fœ¡_key
.
em±y
()) {

282 
	gs
 = 
­¶y_fœ¡
();

283 ià(!
	gs
.
ok
()) {

284  
	gs
;

288 ià(
	gm_u£_¡ack
) {

289 
	grocksdb
::
Sliû
 
key
;

290 
	grocksdb
::
Sliû
 
v®ue
;

294 !
	gm_¡ack
.
em±y
()) {

295 
	g¡d
::
t›
(
key
, 
v®ue
èğ
m_¡ack
.
tİ
();

296 
	gs
 = 
m_fe
.
put
(
key
, 
v®ue
);

297 ià(!
	gs
.
ok
()) {

298  
	gs
;

301 
	gm_¡ack
.
pİ
();

305 
	gm_¡ack
.
»£t
();

306 
	gm_u£_¡ack
 = 
çl£
;

310 
	gm_fœ¡
 = 
Œue
;

312  
	gm_fe
.
comm™
();

315 
	gRdb_s¡_šfo
::
Rdb_s¡_šfo
(
rocksdb
::
DB
 *cÚ¡ 
db
, cÚ¡ 
¡d
::
¡ršg
 &
bËÇme
,

316 cÚ¡ 
¡d
::
¡ršg
 &
šdexÇme
,

317 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cf
,

318 cÚ¡ 
rocksdb
::
DBO±iÚs
 &
db_İtiÚs
,

319 cÚ¡ 
boŞ
 &
Œacšg
)

320 : 
m_db
(
db
), 
m_cf
(
cf
), 
m_db_İtiÚs
(
db_İtiÚs
), 
m_cu¼_size
(0),

321 
m_s¡_couÁ
(0), 
m_background_”rÜ
(
HA_EXIT_SUCCESS
), 
m_comm™‹d
(
çl£
),

322 #ià
defšed
(
RDB_SST_INFO_USE_THREAD
)

323 
m_queue
(), 
m_mu‹x
(), 
m_cÚd
(), 
m_th»ad
(
nuÎ±r
), 
m_fšished
(
çl£
),

325 
m_s¡_fe
(
nuÎ±r
), 
m_Œacšg
(
Œacšg
), 
m_´št_ş›Á_”rÜ
(
Œue
) {

326 
	gm_´efix
 = 
db
->
G‘Name
() + "/";

328 
	g¡d
::
¡ršg
 
nÜm®ized_bË
;

329 ià(
rdb_nÜm®ize_bËÇme
(
bËÇme
.
c_¡r
(), &
nÜm®ized_bË
)) {

332 
	gm_´efix
 +ğ"çÎback_" + 
¡d
::
to_¡ršg
(
»š‹½»t_ÿ¡
<
šŒ_t
>(

333 
»š‹½»t_ÿ¡
<*>(
this
))) +

334 "_" + 
šdexÇme
 + "_";

336 
	gm_´efix
 +ğ
nÜm®ized_bË
 + "_" + 
šdexÇme
 + "_";

341 
	gm_´efix
 +ğ
¡d
::
to_¡ršg
(
m_´efix_couÁ”
.
ãtch_add
(1)) + "_";

343 
	grocksdb
::
CŞumnFamyDesütÜ
 
cf_desü
;

344 cÚ¡ 
	grocksdb
::
Stus
 
s
 = 
m_cf
->
G‘DesütÜ
(&
cf_desü
);

345 ià(!
	gs
.
ok
()) {

347 
	gm_max_size
 = 64 * 1024 * 1024;

350 
	gm_max_size
 = 
cf_desü
.
İtiÚs
.
rg‘_fe_size_ba£
 * 3;

352 
mysql_mu‹x_š™
(
rdb_s¡_comm™_key
, &
m_comm™_mu‹x
, 
MY_MUTEX_INIT_FAST
);

355 
	gRdb_s¡_šfo
::~
Rdb_s¡_šfo
() {

356 
DBUG_ASSERT
(
m_s¡_fe
 =ğ
nuÎ±r
);

357 #ià
defšed
(
RDB_SST_INFO_USE_THREAD
)

358 
DBUG_ASSERT
(
m_th»ad
 =ğ
nuÎ±r
);

360 
mysql_mu‹x_de¡roy
(&
m_comm™_mu‹x
);

363 
	gRdb_s¡_šfo
::
İ’_Ãw_s¡_fe
() {

364 
DBUG_ASSERT
(
m_s¡_fe
 =ğ
nuÎ±r
);

367 cÚ¡ 
	g¡d
::
¡ršg
 
Çme
 = 
m_´efix
 + 
¡d
::
to_¡ršg
(
m_s¡_couÁ
++è+ 
m_suffix
;

370 
	gm_s¡_fe
 = 
Ãw
 
Rdb_s¡_fe_Üd”ed
(
m_db
, 
m_cf
, 
m_db_İtiÚs
,

371 
Çme
, 
m_Œacšg
, 
m_max_size
);

374 cÚ¡ 
	grocksdb
::
Stus
 
s
 = 
m_s¡_fe
->
İ’
();

375 ià(!
	gs
.
ok
()) {

376 
£t_”rÜ_msg
(
m_s¡_fe
->
g‘_Çme
(), 
s
);

377 
d–‘e
 
	gm_s¡_fe
;

378 
	gm_s¡_fe
 = 
nuÎ±r
;

379  
	gHA_ERR_ROCKSDB_BULK_LOAD
;

382 
	gm_cu¼_size
 = 0;

384  
	gHA_EXIT_SUCCESS
;

387 
	gRdb_s¡_šfo
::
şo£_cu¼_s¡_fe
() {

388 
DBUG_ASSERT
(
m_s¡_fe
 !ğ
nuÎ±r
);

389 
DBUG_ASSERT
(
m_cu¼_size
 > 0);

391 #ià
defšed
(
RDB_SST_INFO_USE_THREAD
)

392 ià(
	gm_th»ad
 =ğ
nuÎ±r
) {

394 
m_th»ad
 = 
Ãw
 
¡d
::
th»ad
(
th»ad_fú
, 
this
);

397 
DBUG_ASSERT
(
m_th»ad
 !ğ
nuÎ±r
);

401 cÚ¡ 
	g¡d
::
lock_gu¬d
<
¡d
::
mu‹x
> 
gu¬d
(
m_mu‹x
);

402 
	gm_queue
.
push
(
m_s¡_fe
);

406 
	gm_cÚd
.
nÙify_Úe
();

408 cÚ¡ 
	grocksdb
::
Stus
 
s
 = 
m_s¡_fe
->
comm™
();

409 ià(!
	gs
.
ok
()) {

410 
£t_”rÜ_msg
(
m_s¡_fe
->
g‘_Çme
(), 
s
);

411 
£t_background_”rÜ
(
HA_ERR_ROCKSDB_BULK_LOAD
);

414 
d–‘e
 
	gm_s¡_fe
;

418 
	gm_s¡_fe
 = 
nuÎ±r
;

419 
	gm_cu¼_size
 = 0;

422 
	gRdb_s¡_šfo
::
put
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®ue
) {

423 
rc
;

425 
DBUG_ASSERT
(!
m_comm™‹d
);

427 ià(
	gm_cu¼_size
 + 
	gkey
.
size
(è+ 
	gv®ue
.size(è>ğ
m_max_size
) {

429 
şo£_cu¼_s¡_fe
();

433 ià(
have_background_”rÜ
()) {

434  
g‘_ªd_»£t_background_”rÜ
();

438 ià(
	gm_cu¼_size
 == 0) {

440 
rc
 = 
İ’_Ãw_s¡_fe
();

441 ià(
	grc
 != 0) {

442  
rc
;

446 
DBUG_ASSERT
(
m_s¡_fe
 !ğ
nuÎ±r
);

449 cÚ¡ 
	grocksdb
::
Stus
 
s
 = 
m_s¡_fe
->
put
(
key
, 
v®ue
);

450 ià(!
	gs
.
ok
()) {

451 
£t_”rÜ_msg
(
m_s¡_fe
->
g‘_Çme
(), 
s
);

452  
	gHA_ERR_ROCKSDB_BULK_LOAD
;

455 
	gm_cu¼_size
 +ğ
key
.
size
(è+ 
v®ue
.size();

457  
	gHA_EXIT_SUCCESS
;

460 
	gRdb_s¡_šfo
::
comm™
(
boŞ
 
´št_ş›Á_”rÜ
) {

461 
»t
 = 
HA_EXIT_SUCCESS
;

466 
RDB_MUTEX_LOCK_CHECK
(
m_comm™_mu‹x
);

468 ià(
	gm_comm™‹d
) {

469 
RDB_MUTEX_UNLOCK_CHECK
(
m_comm™_mu‹x
);

470  
	g»t
;

473 
	gm_´št_ş›Á_”rÜ
 = 
´št_ş›Á_”rÜ
;

475 ià(
	gm_cu¼_size
 > 0) {

477 
şo£_cu¼_s¡_fe
();

480 #ià
defšed
(
RDB_SST_INFO_USE_THREAD
)

481 ià(
	gm_th»ad
 !ğ
nuÎ±r
) {

483 
m_fšished
 = 
Œue
;

484 
	gm_cÚd
.
nÙify_Úe
();

487 
	gm_th»ad
->
još
();

488 
d–‘e
 
	gm_th»ad
;

489 
	gm_th»ad
 = 
nuÎ±r
;

493 
	gm_comm™‹d
 = 
Œue
;

494 
RDB_MUTEX_UNLOCK_CHECK
(
m_comm™_mu‹x
);

497 ià(
have_background_”rÜ
()) {

498 
	g»t
 = 
g‘_ªd_»£t_background_”rÜ
();

501 
	gm_´št_ş›Á_”rÜ
 = 
Œue
;

502  
	g»t
;

505 
	gRdb_s¡_šfo
::
£t_”rÜ_msg
(cÚ¡ 
¡d
::
¡ršg
 &
s¡_fe_Çme
,

506 cÚ¡ 
rocksdb
::
Stus
 &
s
) {

508 ià(!
m_´št_ş›Á_”rÜ
)

511 #ià
defšed
(
RDB_SST_INFO_USE_THREAD
)

515 cÚ¡ 
	g¡d
::
lock_gu¬d
<
¡d
::
mu‹x
> 
gu¬d
(
m_mu‹x
);

517 ià(
	gs
.
IsInv®idArgum’t
() &&

518 
¡rcmp
(
s
.
g‘S‹
(), "Keys must be‡dded in order") == 0) {

519 
my_´štf_”rÜ
(
ER_KEYS_OUT_OF_ORDER
,

522 
MYF
(0));

523 } ià(
	gs
.
IsInv®idArgum’t
() &&

524 
¡rcmp
(
s
.
g‘S‹
(), "Global seqno is„equired, but disabled") ==

526 
my_´štf_”rÜ
(
ER_OVERLAPPING_KEYS
, "Rows inserted during bulk†oad "

528 
MYF
(0));

530 
my_´štf_”rÜ
(
ER_UNKNOWN_ERROR
, "[%s] bulk†ßdƒ¼Ü: %s", 
MYF
(0),

531 
s¡_fe_Çme
.
c_¡r
(), 
s
.
ToSŒšg
().c_str());

535 #ià
defšed
(
RDB_SST_INFO_USE_THREAD
)

537 
	gRdb_s¡_šfo
::
th»ad_fú
(*
objeù
) {

538 
»š‹½»t_ÿ¡
<
Rdb_s¡_šfo
 *>(
objeù
)->
run_th»ad
();

541 
	gRdb_s¡_šfo
::
run_th»ad
() {

542 
¡d
::
unique_lock
<¡d::
mu‹x
> 
lk
(
m_mu‹x
);

546 
	gm_cÚd
.
wa™_fÜ
(
lk
, 
¡d
::
chrÚo
::
£cÚds
(1));

549 !
	gm_queue
.
em±y
()) {

550 
Rdb_s¡_fe_Üd”ed
 *cÚ¡ 
	gs¡_fe
 = 
m_queue
.
äÚt
();

551 
	gm_queue
.
pİ
();

554 
	glk
.
uÆock
();

557 cÚ¡ 
	grocksdb
::
Stus
 
s
 = 
s¡_fe
->
comm™
();

558 ià(!
	gs
.
ok
()) {

559 
£t_”rÜ_msg
(
s¡_fe
->
g‘_Çme
(), 
s
);

560 
£t_background_”rÜ
(
HA_ERR_ROCKSDB_BULK_LOAD
);

563 
d–‘e
 
	gs¡_fe
;

566 
	glk
.
lock
();

571 } !
	gm_fšished
);

573 
DBUG_ASSERT
(
m_queue
.
em±y
());

577 
	gRdb_s¡_šfo
::
š™
(cÚ¡ 
rocksdb
::
DB
 *cÚ¡ 
db
) {

578 cÚ¡ 
¡d
::
¡ršg
 
·th
 = 
db
->
G‘Name
(è+ 
FN_DIRSEP
;

579 
¡_my_dœ
 *cÚ¡ 
	gdœ_šfo
 = 
my_dœ
(
·th
.
c_¡r
(), 
MYF
(
MY_DONT_SORT
));

582 ià(
	gdœ_šfo
 =ğ
nuÎ±r
) {

584 
sql_´št_w¬nšg
("RocksDB: Could‚ot‡ccess database directory: %s",

585 
·th
.
c_¡r
());

590 cÚ¡ 
fešfo
 *
	gfe_šfo
 = 
dœ_šfo
->
dœ_’Œy
;

591 
ušt
 
	gii
 = 0; i˜< 
	gdœ_šfo
->
	gnumb”_off_fes
; ii++, 
	gfe_šfo
++) {

593 cÚ¡ 
	g¡d
::
¡ršg
 
Çme
 = 
fe_šfo
->name;

594 cÚ¡ 
size_t
 
	gpos
 = 
Çme
.
fšd
(
m_suffix
);

595 ià(
	gpos
 !ğ
¡d
::
¡ršg
::
Åos
 && 
Çme
.
size
(è- 
pos
 =ğ
m_suffix
.size()) {

597 cÚ¡ 
¡d
::
¡ršg
 
fuÎÇme
 = 
·th
 + 
Çme
;

598 
my_d–‘e
(
fuÎÇme
.
c_¡r
(), 
MYF
(0));

603 
my_dœ’d
(
dœ_šfo
);

606 
	g¡d
::
©omic
<
ušt64_t
> 
Rdb_s¡_šfo
::
m_´efix_couÁ”
(0);

607 
	g¡d
::
¡ršg
 
Rdb_s¡_šfo
::
m_suffix
 = ".bulk_load.tmp";

	@rdb_sst_info.h

17 #´agm¨
Úû


20 
	~<©omic
>

21 
	~<cÚd™iÚ_v¬ŸbË
>

22 
	~<mu‹x
>

23 
	~<queue
>

24 
	~<¡ack
>

25 
	~<¡ršg
>

26 
	~<th»ad
>

27 
	~<ut™y
>

28 
	~<veùÜ
>

31 
	~"rocksdb/db.h
"

32 
	~"rocksdb/s¡_fe_wr™”.h
"

35 
	~"rdb_uts.h
"

39 
Çme¥aû
 
	gmyrocks
 {

41 şas 
	cRdb_s¡_fe_Üd”ed
 {

42 
	g´iv©e
:

43 şas 
	cRdb_s¡_fe
 {

44 
´iv©e
:

45 
Rdb_s¡_fe
(cÚ¡ Rdb_s¡_f&
p
èğ
d–‘e
;

46 
	gRdb_s¡_fe
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_s¡_fe
 &
p
èğ
d–‘e
;

48 
	grocksdb
::
DB
 *cÚ¡ 
m_db
;

49 
	grocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
m_cf
;

50 cÚ¡ 
	grocksdb
::
DBO±iÚs
 &
m_db_İtiÚs
;

51 
	grocksdb
::
S¡FeWr™”
 *
m_s¡_fe_wr™”
;

52 cÚ¡ 
	g¡d
::
¡ršg
 
m_Çme
;

53 cÚ¡ 
boŞ
 
	gm_Œacšg
;

54 cÚ¡ 
	grocksdb
::
Com·¿tÜ
 *
m_com·¿tÜ
;

56 
	g¡d
::
¡ršg
 
g’”©eKey
(cÚ¡ 
¡d
::¡ršg &
key
);

58 
	gpublic
:

59 
Rdb_s¡_fe
(
rocksdb
::
DB
 *cÚ¡ 
db
,„ocksdb::
CŞumnFamyHªdË
 *cÚ¡ 
cf
,

60 cÚ¡ 
rocksdb
::
DBO±iÚs
 &
db_İtiÚs
, cÚ¡ 
¡d
::
¡ršg
 &
Çme
,

61 cÚ¡ 
boŞ
 
Œacšg
);

62 ~
Rdb_s¡_fe
();

64 
	grocksdb
::
Stus
 
İ’
();

65 
	grocksdb
::
Stus
 
put
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®ue
);

66 
	grocksdb
::
Stus
 
comm™
();

68 
šlše
 cÚ¡ 
	g¡d
::
¡ršg
 
g‘_Çme
(ècÚ¡ {  
m_Çme
; }

69 
šlše
 
com·»
(
rocksdb
::
Sliû
 
key1
,„ocksdb::Sliû 
key2
) {

70  
m_com·¿tÜ
->
Com·»
(
key1
, 
key2
);

74 şas 
	cRdb_s¡_¡ack
 {

75 
	g´iv©e
:

76 *
m_bufãr
;

77 
size_t
 
	gm_bufãr_size
;

78 
size_t
 
	gm_off£t
;

79 
	g¡d
::
¡ack
<
¡d
::
tu¶e
<
size_t
, 
	gsize_t
, size_t>> 
	gm_¡ack
;

81 
	gpublic
:

82 
ex¶ic™
 
Rdb_s¡_¡ack
(
size_t
 
max_size
)

83 : 
m_bufãr
(
nuÎ±r
), 
m_bufãr_size
(
max_size
) {}

84 ~
Rdb_s¡_¡ack
(è{ 
	gd–‘e
[] 
	gm_bufãr
; }

86 
»£t
(è{ 
	gm_off£t
 = 0; }

87 
boŞ
 
em±y
(è{  
	gm_¡ack
.empty(); }

88 
push
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®ue
);

89 
	g¡d
::
·œ
<
rocksdb
::
Sliû
, 
	grocksdb
::Sliû> 
tİ
();

90 
pİ
(è{ 
	gm_¡ack
.pop(); }

91 
size_t
 
size
(è{  
	gm_¡ack
.size(); }

94 
boŞ
 
	gm_u£_¡ack
;

95 
boŞ
 
	gm_fœ¡
;

96 
	g¡d
::
¡ršg
 
m_fœ¡_key
;

97 
	g¡d
::
¡ršg
 
m_fœ¡_v®ue
;

98 
Rdb_s¡_¡ack
 
	gm_¡ack
;

99 
Rdb_s¡_fe
 
	gm_fe
;

101 
	grocksdb
::
Stus
 
­¶y_fœ¡
();

103 
	gpublic
:

104 
Rdb_s¡_fe_Üd”ed
(
rocksdb
::
DB
 *cÚ¡ 
db
,

105 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cf
,

106 cÚ¡ 
rocksdb
::
DBO±iÚs
 &
db_İtiÚs
,

107 cÚ¡ 
¡d
::
¡ršg
 &
Çme
, cÚ¡ 
boŞ
 
Œacšg
,

108 
size_t
 
max_size
);

110 
šlše
 
	grocksdb
::
Stus
 
İ’
(è{  
m_fe
.open(); }

111 
	grocksdb
::
Stus
 
put
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®ue
);

112 
	grocksdb
::
Stus
 
comm™
();

113 
šlše
 cÚ¡ 
	g¡d
::
¡ršg
 
g‘_Çme
(ècÚ¡ {  
m_fe
.get_name(); }

116 şas 
	cRdb_s¡_šfo
 {

117 
	g´iv©e
:

118 
Rdb_s¡_šfo
(cÚ¡ Rdb_s¡_šfØ&
p
èğ
d–‘e
;

119 
	gRdb_s¡_šfo
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_s¡_šfo
 &
p
èğ
d–‘e
;

121 
	grocksdb
::
DB
 *cÚ¡ 
m_db
;

122 
	grocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
m_cf
;

123 cÚ¡ 
	grocksdb
::
DBO±iÚs
 &
m_db_İtiÚs
;

124 
ušt64_t
 
	gm_cu¼_size
;

125 
ušt64_t
 
	gm_max_size
;

126 
ušt
 
	gm_s¡_couÁ
;

127 
	g¡d
::
©omic
<> 
m_background_”rÜ
;

128 
	g¡d
::
¡ršg
 
m_´efix
;

129 
	g¡d
::
©omic
<
ušt64_t
> 
m_´efix_couÁ”
;

130 
	g¡d
::
¡ršg
 
m_suffix
;

131 
boŞ
 
	gm_comm™‹d
;

132 
mysql_mu‹x_t
 
	gm_comm™_mu‹x
;

133 #ià
defšed
(
RDB_SST_INFO_USE_THREAD
)

134 
	g¡d
::
queue
<
Rdb_s¡_fe_Üd”ed
 *> 
m_queue
;

135 
	g¡d
::
mu‹x
 
m_mu‹x
;

136 
	g¡d
::
cÚd™iÚ_v¬ŸbË
 
m_cÚd
;

137 
	g¡d
::
th»ad
 *
m_th»ad
;

138 
boŞ
 
	gm_fšished
;

140 
Rdb_s¡_fe_Üd”ed
 *
	gm_s¡_fe
;

141 cÚ¡ 
boŞ
 
	gm_Œacšg
;

142 
boŞ
 
	gm_´št_ş›Á_”rÜ
;

144 
İ’_Ãw_s¡_fe
();

145 
şo£_cu¼_s¡_fe
();

146 
£t_”rÜ_msg
(cÚ¡ 
¡d
::
¡ršg
 &
s¡_fe_Çme
,

147 cÚ¡ 
rocksdb
::
Stus
 &
s
);

149 #ià
defšed
(
RDB_SST_INFO_USE_THREAD
)

150 
run_th»ad
();

152 
th»ad_fú
(*
objeù
);

155 
	gpublic
:

156 
Rdb_s¡_šfo
(
rocksdb
::
DB
 *cÚ¡ 
db
, cÚ¡ 
¡d
::
¡ršg
 &
bËÇme
,

157 cÚ¡ 
¡d
::
¡ršg
 &
šdexÇme
,

158 
rocksdb
::
CŞumnFamyHªdË
 *cÚ¡ 
cf
,

159 cÚ¡ 
rocksdb
::
DBO±iÚs
 &
db_İtiÚs
, cÚ¡ 
boŞ
 &
Œacšg
);

160 ~
Rdb_s¡_šfo
();

162 
put
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû &
v®ue
);

163 
comm™
(
boŞ
 
´št_ş›Á_”rÜ
 = 
Œue
);

164 
boŞ
 
is_comm™‹d
(ècÚ¡ {  
	gm_comm™‹d
; }

166 
boŞ
 
have_background_”rÜ
(è{  
	gm_background_”rÜ
 != 0; }

168 
g‘_ªd_»£t_background_”rÜ
() {

169 
	g»t
 = 
m_background_”rÜ
;

170 !
	gm_background_”rÜ
.
com·»_exchªge_w—k
(
»t
, 
HA_EXIT_SUCCESS
)) {

174  
	g»t
;

177 
£t_background_”rÜ
(
code
) {

178 
	gex³ùed
 = 
HA_EXIT_SUCCESS
;

180 
	gm_background_”rÜ
.
com·»_exchªge_¡rÚg
(
ex³ùed
, 
code
);

183 
š™
(cÚ¡ 
rocksdb
::
DB
 *cÚ¡ 
db
);

	@rdb_threads.cc

18 #ifdeà
USE_PRAGMA_IMPLEMENTATION


19 #´agm¨
im¶em’tiÚ


23 
	~"rdb_th»ads.h
"

25 
Çme¥aû
 
	gmyrocks
 {

27 *
	gRdb_th»ad
::
th»ad_func
(*cÚ¡ 
th»ad_±r
) {

28 
DBUG_ASSERT
(
th»ad_±r
 !ğ
nuÎ±r
);

29 
Rdb_th»ad
 *cÚ¡ 
	gth»ad
 = 
¡©ic_ÿ¡
<Rdb_th»ad *cÚ¡>(
th»ad_±r
);

30 ià(!
	gth»ad
->
	gm_run_Úû
.
exchªge
(
Œue
)) {

31 
	gth»ad
->
£Šame
();

32 
	gth»ad
->
run
();

33 
	gth»ad
->
unš™
();

35  
	gnuÎ±r
;

38 
	gRdb_th»ad
::
š™
(

39 #ifdeà
HAVE_PSI_INTERFACE


40 
my_cÜe
::
PSI_mu‹x_key
 
¡İ_bg_psi_mu‹x_key
,

41 
my_cÜe
::
PSI_cÚd_key
 
¡İ_bg_psi_cÚd_key


44 
DBUG_ASSERT
(!
m_run_Úû
);

45 
mysql_mu‹x_š™
(
¡İ_bg_psi_mu‹x_key
, &
m_sigÇl_mu‹x
, 
MY_MUTEX_INIT_FAST
);

46 
mysql_cÚd_š™
(
¡İ_bg_psi_cÚd_key
, &
m_sigÇl_cÚd
, 
nuÎ±r
);

49 
	gRdb_th»ad
::
unš™
() {

50 
mysql_mu‹x_de¡roy
(&
m_sigÇl_mu‹x
);

51 
mysql_cÚd_de¡roy
(&
m_sigÇl_cÚd
);

54 
	gRdb_th»ad
::
ü—‹_th»ad
(cÚ¡ 
¡d
::
¡ršg
 &
th»ad_Çme


55 #ifdeà
HAVE_PSI_INTERFACE


57 
PSI_th»ad_key
 
background_psi_th»ad_key


62 
	gm_Çme
 = 
th»ad_Çme
;

64  
mysql_th»ad_ü—‹
(
background_psi_th»ad_key
, &
m_hªdË
, 
nuÎ±r
,

65 
th»ad_func
, 
this
);

68 
	gRdb_th»ad
::
sigÇl
(cÚ¡ 
boŞ
 &
¡İ_th»ad
) {

69 
RDB_MUTEX_LOCK_CHECK
(
m_sigÇl_mu‹x
);

71 ià(
	g¡İ_th»ad
) {

72 
	gm_¡İ
 = 
Œue
;

75 
mysql_cÚd_sigÇl
(&
m_sigÇl_cÚd
);

77 
RDB_MUTEX_UNLOCK_CHECK
(
m_sigÇl_mu‹x
);

	@rdb_threads.h

17 #´agm¨
Úû


20 
	~<¡ršg
>

23 
	~"my_glob®.h
"

24 
	~<mysql/psi/mysql_bË.h
>

25 
	~<mysql/th»ad_poŞ_´iv.h
>

28 
	~"rdb_uts.h
"

30 
Çme¥aû
 
	gmyrocks
 {

32 şas 
	cRdb_th»ad
 {

33 
	g´iv©e
:

35 
Rdb_th»ad
(const Rdb_thread &);

36 
	gRdb_th»ad
 &
	gİ”©Ü
=(cÚ¡ 
Rdb_th»ad
 &);

39 
	g¡d
::
©omic_boŞ
 
m_run_Úû
;

41 
±h»ad_t
 
	gm_hªdË
;

43 
	g¡d
::
¡ršg
 
m_Çme
;

45 
	g´Ùeùed
:

46 
mysql_mu‹x_t
 
m_sigÇl_mu‹x
;

47 
mysql_cÚd_t
 
	gm_sigÇl_cÚd
;

48 
boŞ
 
	gm_¡İ
 = 
çl£
;

50 
	gpublic
:

51 
Rdb_th»ad
(è: 
m_run_Úû
(
çl£
) {}

53 #ifdeà
HAVE_PSI_INTERFACE


54 
š™
(
my_cÜe
::
PSI_mu‹x_key
 
¡İ_bg_psi_mu‹x_key
,

55 
my_cÜe
::
PSI_cÚd_key
 
¡İ_bg_psi_cÚd_key
);

56 
ü—‹_th»ad
(cÚ¡ 
¡d
::
¡ršg
 &
th»ad_Çme
,

57 
my_cÜe
::
PSI_th»ad_key
 
background_psi_th»ad_key
);

59 
š™
();

60 
ü—‹_th»ad
(cÚ¡ 
¡d
::
¡ršg
 &
th»ad_Çme
);

63 
vœtu®
 
run
() = 0;

65 
sigÇl
(cÚ¡ 
boŞ
 &
¡İ_th»ad
 = 
çl£
);

67 
još
(è{  
±h»ad_još
(
m_hªdË
, 
nuÎ±r
); }

69 
£Šame
() {

83 
DBUG_ASSERT
(!
m_Çme
.
em±y
());

84 #ifdeà
__lšux__


85 
	g”r
 = 
±h»ad_£Šame_Å
(
m_hªdË
, 
m_Çme
.
c_¡r
());

86 ià(
	g”r
)

89 
sql_´št_w¬nšg
(

91 
m_Çme
.
c_¡r
(), 
”ºo
);

96 
unš™
();

98 
	gvœtu®
 ~
Rdb_th»ad
() {}

100 
	g´iv©e
:

101 *
th»ad_func
(*cÚ¡ 
th»ad_±r
);

110 şas 
	cRdb_background_th»ad
 : 
public
 
Rdb_th»ad
 {

111 
´iv©e
:

112 
boŞ
 
m_§ve_¡©s
 = 
çl£
;

114 
»£t
() {

115 
mysql_mu‹x_as£¹_owÃr
(&
m_sigÇl_mu‹x
);

116 
	gm_¡İ
 = 
çl£
;

117 
	gm_§ve_¡©s
 = 
çl£
;

120 
	gpublic
:

121 
vœtu®
 
run
(è
ov”ride
;

123 
»que¡_§ve_¡©s
() {

124 
RDB_MUTEX_LOCK_CHECK
(
m_sigÇl_mu‹x
);

126 
	gm_§ve_¡©s
 = 
Œue
;

128 
RDB_MUTEX_UNLOCK_CHECK
(
m_sigÇl_mu‹x
);

136 
	gRdb_drİ_šdex_th»ad
 : 
public
 
Rdb_th»ad
 {

137 
vœtu®
 
run
(è
ov”ride
;

	@rdb_utils.cc

18 
	~"rdb_uts.h
"

21 
	~<¬¿y
>

22 
	~<¡ršg
>

23 
	~<veùÜ
>

24 
	~<s¡»am
>

27 
	~<ùy³.h
>

30 
	~"ha_rocksdb.h
"

32 
Çme¥aû
 
	gmyrocks
 {

37 cÚ¡ *
rdb_sk_¥aûs
(cÚ¡ 
ch¬£t_šfo_¡
 *cÚ¡ 
cs
,

38 cÚ¡ *
¡r
) {

39 
DBUG_ASSERT
(
cs
 !ğ
nuÎ±r
);

40 
DBUG_ASSERT
(
¡r
 !ğ
nuÎ±r
);

42 
my_is¥aû
(
cs
, *
¡r
)) {

43 
	g¡r
++;

46  
	g¡r
;

54 
boŞ
 
rdb_com·»_¡ršgs_ic
(cÚ¡ *cÚ¡ 
¡r1
, cÚ¡ *cÚ¡ 
¡r2
) {

55 
DBUG_ASSERT
(
¡r1
 !ğ
nuÎ±r
);

56 
DBUG_ASSERT
(
¡r2
 !ğ
nuÎ±r
);

59 
size_t
 
	gii
;

60 
	gii
 = 0; 
	g¡r2
[
ii
]; ii++) {

61 ià(
touµ”
(
¡©ic_ÿ¡
<>(
¡r1
[
ii
])) !=

62 
touµ”
(
¡©ic_ÿ¡
<>(
¡r2
[
ii
]))) {

63  
çl£
;

67  
	gŒue
;

74 cÚ¡ *
rdb_fšd_š_¡ršg
(cÚ¡ *
¡r
, cÚ¡ *
·‰”n
,

75 
boŞ
 *cÚ¡ 
sucûeded
) {

76 
	gquÙe
 = '\0';

77 
boŞ
 
	gesÿ³
 = 
çl£
;

79 
DBUG_ASSERT
(
¡r
 !ğ
nuÎ±r
);

80 
DBUG_ASSERT
(
·‰”n
 !ğ
nuÎ±r
);

81 
DBUG_ASSERT
(
sucûeded
 !ğ
nuÎ±r
);

83 *
	gsucûeded
 = 
çl£
;

85 ; *
	g¡r
; str++) {

87 ià(*
	g¡r
 =ğ
quÙe
) {

89 ià(
esÿ³
) {

90 
esÿ³
 = 
çl£
;

94 
	gquÙe
 = '\0';

98 ià(
	gquÙe
 != '\0') {

100 
esÿ³
 = !esÿ³ && *
¡r
 == '\\';

103 ià(*
	g¡r
 =ğ'"' || *
¡r
 == '\'' || *str == '`') {

104 
quÙe
 = *
¡r
;

108 ià(
rdb_com·»_¡ršgs_ic
(
¡r
, 
·‰”n
)) {

109 *
	gsucûeded
 = 
Œue
;

110  
	g¡r
;

117  
	g¡r
;

123 cÚ¡ *
rdb_check_Ãxt_tok’
(cÚ¡ 
ch¬£t_šfo_¡
 *cÚ¡ 
cs
,

124 cÚ¡ *
¡r
, cÚ¡ *cÚ¡ 
·‰”n
,

125 
boŞ
 *cÚ¡ 
sucûeded
) {

126 
DBUG_ASSERT
(
cs
 !ğ
nuÎ±r
);

127 
DBUG_ASSERT
(
¡r
 !ğ
nuÎ±r
);

128 
DBUG_ASSERT
(
·‰”n
 !ğ
nuÎ±r
);

129 
DBUG_ASSERT
(
sucûeded
 !ğ
nuÎ±r
);

132 
	g¡r
 = 
rdb_sk_¥aûs
(
cs
, 
¡r
);

135 ià(
rdb_com·»_¡ršgs_ic
(
¡r
, 
·‰”n
)) {

136 *
	gsucûeded
 = 
Œue
;

137  
	g¡r
 + 
¡¾’
(
·‰”n
);

140 *
	gsucûeded
 = 
çl£
;

141  
	g¡r
;

147 cÚ¡ *
rdb_·r£_id
(cÚ¡ 
ch¬£t_šfo_¡
 *cÚ¡ 
cs
,

148 cÚ¡ *
¡r
, 
¡d
::
¡ršg
 *cÚ¡ 
id
) {

149 
DBUG_ASSERT
(
cs
 !ğ
nuÎ±r
);

150 
DBUG_ASSERT
(
¡r
 !ğ
nuÎ±r
);

153 
	g¡r
 = 
rdb_sk_¥aûs
(
cs
, 
¡r
);

155 ià(*
	g¡r
 == '\0') {

156  
¡r
;

159 
	gquÙe
 = '\0';

160 ià(*
	g¡r
 =ğ'`' || *
¡r
 == '"') {

161 
quÙe
 = *
¡r
++;

164 
size_t
 
	gËn
 = 0;

165 cÚ¡ *
	g¡¬t
 = 
¡r
;

167 ià(
	gquÙe
 != '\0') {

169 ià(*
	g¡r
 == '\0') {

170  
¡r
;

173 ià(*
	g¡r
 =ğ
quÙe
) {

174 
¡r
++;

175 ià(*
	g¡r
 !ğ
quÙe
) {

180 
	g¡r
++;

181 
	gËn
++;

184 !
my_is¥aû
(
cs
, *
¡r
è&& *
	g¡r
 != '(' && *str != ')' && *str != '.' &&

185 *
¡r
 != ',' && *str != '\0') {

186 
¡r
++;

187 
	gËn
++;

192 ià(
	gid
 !ğ
nuÎ±r
) {

193 *
id
 = 
¡d
::
¡ršg
("");

194 
	gid
->
»£rve
(
Ën
);

195 
	gËn
--) {

196 *
	gid
 +ğ*
¡¬t
;

197 ià(*
	g¡¬t
++ =ğ
quÙe
) {

198 
¡¬t
++;

203  
	g¡r
;

209 cÚ¡ *
rdb_sk_id
(cÚ¡ 
ch¬£t_šfo_¡
 *cÚ¡ 
cs
,

210 cÚ¡ *
¡r
) {

211 
DBUG_ASSERT
(
cs
 !ğ
nuÎ±r
);

212 
DBUG_ASSERT
(
¡r
 !ğ
nuÎ±r
);

214  
rdb_·r£_id
(
cs
, 
¡r
, 
nuÎ±r
);

220 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
·r£_što_tok’s
(

221 cÚ¡ 
¡d
::
¡ršg
& 
s
, cÚ¡ 
d–im
) {

222 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
tok’s
;

223 
	g¡d
::
¡ršg
 
t
;

224 
	g¡d
::
¡ršg¡»am
 
ss
(
s
);

226 
g‘lše
(
ss
, 
t
, 
d–im
)) {

227 
	gtok’s
.
push_back
(
t
);

230  
	gtok’s
;

233 cÚ¡ 
	g¡d
::
size_t
 
rdb_hex_by‹s_³r_ch¬
 = 2;

234 cÚ¡ 
	g¡d
::
¬¿y
<, 16> 
	grdb_hexdig™
 = {{'0', '1', '2', '3', '4', '5',

242 
	g¡d
::
¡ršg
 
rdb_hexdump
(cÚ¡ *
d©a
, cÚ¡ 
¡d
::
size_t
 
d©a_Ën
,

243 cÚ¡ 
¡d
::
size_t
 
maxsize
) {

244 
DBUG_ASSERT
(
d©a
 !ğ
nuÎ±r
);

247 
	g¡d
::
size_t
 
–ems
 = 
d©a_Ën
;

249 
	g¡d
::
size_t
 
Ën
 = 
–ems
 * 
rdb_hex_by‹s_³r_ch¬
;

250 
	g¡d
::
¡ršg
 
¡r
;

252 ià(
	gmaxsize
 !ğ0 && 
Ën
 > 
maxsize
) {

255 
–ems
 = (
maxsize
 - 2è/ 
rdb_hex_by‹s_³r_ch¬
;

256 
	gËn
 = 
–ems
 * 
rdb_hex_by‹s_³r_ch¬
 + 2;

260 
	g¡r
.
»£rve
(
Ën
);

263 
	g¡d
::
size_t
 
ii
 = 0; 
	gii
 < 
	g–ems
; ii++, 
	gd©a
++) {

264 
ušt8_t
 
	gch
 = (ušt8_t)*
d©a
;

265 
	g¡r
 +ğ
rdb_hexdig™
[
ch
 >> 4];

266 
	g¡r
 +ğ
rdb_hexdig™
[
ch
 & 0x0F];

270 ià(
	g–ems
 !ğ
d©a_Ën
) {

271 
¡r
 += "..";

274  
	g¡r
;

280 
boŞ
 
rdb_d©aba£_exi¡s
(cÚ¡ 
¡d
::
¡ršg
 &
db_Çme
) {

281 cÚ¡ 
¡d
::
¡ršg
 
dœ
 =

282 
¡d
::
¡ršg
(
mysql_»®_d©a_home
è+ 
FN_DIRSEP
 + 
db_Çme
;

283 
¡_my_dœ
 *cÚ¡ 
	gdœ_šfo
 =

284 
my_dœ
(
dœ
.
c_¡r
(), 
MYF
(
MY_DONT_SORT
 | 
MY_WANT_STAT
));

285 ià(
	gdœ_šfo
 =ğ
nuÎ±r
) {

286  
çl£
;

289 
my_dœ’d
(
dœ_šfo
);

290  
	gŒue
;

293 
rdb_log_¡©us_”rÜ
(cÚ¡ 
rocksdb
::
Stus
 &
s
, cÚ¡ *
msg
) {

294 ià(
	gmsg
 =ğ
nuÎ±r
) {

296 
sql_´št_”rÜ
("RocksDB: statusƒrror, code: %d,ƒrror message: %s",

297 
s
.
code
(), s.
ToSŒšg
().
c_¡r
());

302 
sql_´št_”rÜ
("RocksDB: %s, Stu Code: %d, Stus: %s", 
msg
, 
s
.
code
(),

303 
s
.
ToSŒšg
().
c_¡r
());

306 
boŞ
 
rdb_check_rocksdb_cÜru±iÚ
() {

307  !
my_acûss
(
myrocks
::
rdb_cÜru±iÚ_m¬k”_fe_Çme
().
c_¡r
(), 
F_OK
);

310 
rdb_³rsi¡_cÜru±iÚ_m¬k”
() {

311 cÚ¡ 
	g¡d
::
¡ršg
 &
feName
(
myrocks
::
rdb_cÜru±iÚ_m¬k”_fe_Çme
());

312 
	gfd
 = 
my_İ’
(
feName
.
c_¡r
(), 
O_CREAT
 | 
O_SYNC
, 
MYF
(
MY_WME
));

313 ià(
	gfd
 < 0) {

314 
sql_´št_”rÜ
("RocksDB: Can't create file %so mark„ocksdb‡s "

316 
feName
.
c_¡r
());

318 
sql_´št_šfÜm©iÚ
("RocksDB: Creatinghe file %so‡bort mysqld "

321 
feName
.
c_¡r
());

324 
	g»t
 = 
my_şo£
(
fd
, 
MYF
(
MY_WME
));

325 ià(
	g»t
) {

327 
sql_´št_”rÜ
("RocksDB: E¼Ü (%dèşosšghf%s", 
»t
,

328 
feName
.
c_¡r
());

	@rdb_utils.h

16 #´agm¨
Úû


19 
	~<chrÚo
>

20 
	~<¡ršg
>

21 
	~<veùÜ
>

24 
	~"../sql/log.h
"

25 
	~"my_¡ackŒaû.h
"

26 
	~"sql_¡ršg.h
"

29 
	~"rocksdb/¦iû.h
"

30 
	~"rocksdb/¡©us.h
"

32 #ifdeà
HAVE_JEMALLOC


33 
	~<jem®loc/jem®loc.h
>

36 
Çme¥aû
 
	gmyrocks
 {

43 #iâdeà
š‹rçû


44 
	#š‹rçû
 

	)

58 #iâdeà
my_cÜe


62 
	#my_cÜe


	)

80 #iâdeà
SHIP_ASSERT


81 
	#SHIP_ASSERT
(
ex´
) \

83 ià(!(
ex´
)) { \

84 
	`my_§ã_´štf_¡d”r
("\nShip‡ssert failure: \'%s\'\n", #expr); \

85 
	`abÜt
(); \

87 } 0)

	)

95 #iâdeà
DBUG_ASSERT_IMP


96 
	#DBUG_ASSERT_IMP
(
a
, 
b
è
	`DBUG_ASSERT
(!×è|| (b))

	)

103 #iâdeà
DBUG_ASSERT_IFF


104 
	#DBUG_ASSERT_IFF
(
a
, 
b
) \

105 
	`DBUG_ASSERT
(
¡©ic_ÿ¡
<
boŞ
>(
a
è=ğ¡©ic_ÿ¡<boŞ>(
b
))

	)

118 
	#DBUG_ENTER_FUNC
(è
	`DBUG_ENTER
(
__PRETTY_FUNCTION__
)

	)

133 
	#HA_EXIT_SUCCESS
 
FALSE


	)

134 
	#HA_EXIT_FAILURE
 
TRUE


	)

140 
	#RDB_MUTEX_LOCK_CHECK
(
m
) \

141 
	`rdb_check_mu‹x_ÿÎ_»suÉ
(
__PRETTY_FUNCTION__
, 
Œue
, 
	`mysql_mu‹x_lock
(&
m
))

	)

142 
	#RDB_MUTEX_UNLOCK_CHECK
(
m
) \

143 
	`rdb_check_mu‹x_ÿÎ_»suÉ
(
__PRETTY_FUNCTION__
, 
çl£
, \

144 
	`mysql_mu‹x_uÆock
(&
m
))

	)

149 cÚ¡ 
size_t
 
	gRDB_MAX_HEXDUMP_LEN
 = 1000;

155 
šlše
 
uch¬
 *
rdb_mysql_¡r_to_uch¬_¡r
(
my_cÜe
::
SŒšg
 *
¡r
) {

156 
DBUG_ASSERT
(
¡r
 !ğ
nuÎ±r
);

157  
	g»š‹½»t_ÿ¡
<
	guch¬
 *>(
	g¡r
->
c_±r
());

165 
šlše
 cÚ¡ 
uch¬
 *
rdb_¡d_¡r_to_uch¬_±r
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
) {

166  
»š‹½»t_ÿ¡
<cÚ¡ 
uch¬
 *>(
¡r
.
d©a
());

173 
cÚ¡ex´
 
rdb_cÚv”t_£c_to_ms
(
£c
) {

174  
	g¡d
::
chrÚo
::
mli£cÚds
(
¡d
::chrÚo::
£cÚds
(
£c
)).
couÁ
();

182 
šlše
 cÚ¡ 
uch¬
 *
rdb_¦iû_to_uch¬_±r
(cÚ¡ 
rocksdb
::
Sliû
 *
™em
) {

183 
DBUG_ASSERT
(
™em
 !ğ
nuÎ±r
);

184  
	g»š‹½»t_ÿ¡
<cÚ¡ 
	guch¬
 *>(
	g™em
->
d©a
());

193 
šlše
 
purge_®l_jem®loc_¬’as
() {

194 #ifdeà
HAVE_JEMALLOC


195 
	gÇ»Çs
 = 0;

196 
size_t
 
	gsz
 = ();

197 
	gÇme
[25] = {0};

201 
	g»suÉ
 = 
m®lùl
("¬’as.Ç»Çs", &
Ç»Çs
, &
sz
, 
nuÎ±r
, 0);

205 ià(
	g»suÉ
) {

206  
	g»suÉ
;

211 
¢´štf
(
Çme
, Òameè/ (), "¬’a.%d.purge", 
Ç»Çs
);

212 
	g»suÉ
 = 
m®lùl
(
Çme
, 
nuÎ±r
,‚ullptr,‚ullptr, 0);

214  
	g»suÉ
;

216  
	gEXIT_SUCCESS
;

226 
šlše
 
rdb_check_mu‹x_ÿÎ_»suÉ
(cÚ¡ *
funùiÚ_Çme
,

227 cÚ¡ 
boŞ
 
©‹m±_lock
,

228 cÚ¡ 
»suÉ
) {

229 ià(
uÆik–y
(
»suÉ
)) {

231 
sql_´št_”rÜ
("%s‡ mutex inside %s failed with‡n "

233 
©‹m±_lock
 ? "Lockšg" : "UÆockšg", 
funùiÚ_Çme
,

234 
»suÉ
);

238 
abÜt
();

242 
rdb_log_¡©us_”rÜ
(cÚ¡ 
rocksdb
::
Stus
 &
s
, cÚ¡ *
msg
 = 
nuÎ±r
);

246 
boŞ
 
rdb_check_rocksdb_cÜru±iÚ
();

250 
rdb_³rsi¡_cÜru±iÚ_m¬k”
();

256 cÚ¡ *
rdb_sk_¥aûs
(cÚ¡ 
ch¬£t_šfo_¡
 *cÚ¡ 
cs
,

257 cÚ¡ *
¡r
)

258 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

260 
boŞ
 
rdb_com·»_¡ršgs_ic
(cÚ¡ *cÚ¡ 
¡r1
, cÚ¡ *cÚ¡ 
¡r2
)

261 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

263 cÚ¡ *
rdb_fšd_š_¡ršg
(cÚ¡ *
¡r
, cÚ¡ *
·‰”n
,

264 
boŞ
 *cÚ¡ 
sucûeded
)

265 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

267 cÚ¡ *
rdb_check_Ãxt_tok’
(cÚ¡ 
ch¬£t_šfo_¡
 *cÚ¡ 
cs
,

268 cÚ¡ *
¡r
, cÚ¡ *cÚ¡ 
·‰”n
,

269 
boŞ
 *cÚ¡ 
sucûeded
)

270 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

272 cÚ¡ *
rdb_·r£_id
(cÚ¡ 
ch¬£t_šfo_¡
 *cÚ¡ 
cs
,

273 cÚ¡ *
¡r
, 
¡d
::
¡ršg
 *cÚ¡ 
id
)

274 
MY_ATTRIBUTE
((
__nÚnuÎ__
(1, 2), 
__w¬n_unu£d_»suÉ__
));

276 cÚ¡ *
rdb_sk_id
(cÚ¡ 
ch¬£t_šfo_¡
 *cÚ¡ 
cs
, cÚ¡ *
¡r
)

277 
MY_ATTRIBUTE
((
__nÚnuÎ__
, 
__w¬n_unu£d_»suÉ__
));

279 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
·r£_što_tok’s
(cÚ¡ std::¡ršg& 
s
,

280 cÚ¡ 
d–im
);

286 
	g¡d
::
¡ršg
 
rdb_hexdump
(cÚ¡ *
d©a
, cÚ¡ 
¡d
::
size_t
 
d©a_Ën
,

287 cÚ¡ 
¡d
::
size_t
 
maxsize
 = 0)

288 
MY_ATTRIBUTE
((
__nÚnuÎ__
));

293 
boŞ
 
rdb_d©aba£_exi¡s
(cÚ¡ 
¡d
::
¡ršg
 &
db_Çme
);

	@/usr/include/arpa/inet.h

18 #iâdeà
_ARPA_INET_H


19 
	#_ARPA_INET_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<Ãtš‘/š.h
>

25 #iâdeà
__sockËn_t_defšed


26 
__sockËn_t
 
	tsockËn_t
;

27 
	#__sockËn_t_defšed


	)

30 
__BEGIN_DECLS


34 
š_addr_t
 
	$š‘_addr
 (cÚ¡ *
__ı
è
__THROW
;

37 
š_addr_t
 
	$š‘_Êaof
 (
š_addr
 
__š
è
__THROW
;

41 
š_addr
 
	$š‘_mak—ddr
 (
š_addr_t
 
__Ãt
, in_addr_ˆ
__ho¡
)

42 
__THROW
;

45 
š_addr_t
 
	$š‘_Ãtof
 (
š_addr
 
__š
è
__THROW
;

49 
š_addr_t
 
	$š‘_ÃtwÜk
 (cÚ¡ *
__ı
è
__THROW
;

53 *
	$š‘_Áß
 (
š_addr
 
__š
è
__THROW
;

58 
	$š‘_±Ú
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

59 *
__»¡riù
 
__buf
è
__THROW
;

64 cÚ¡ *
	$š‘_Áİ
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

65 *
__»¡riù
 
__buf
, 
sockËn_t
 
__Ën
)

66 
__THROW
;

70 #ifdeà
__USE_MISC


73 
	$š‘_©Ú
 (cÚ¡ *
__ı
, 
š_addr
 *
__šp
è
__THROW
;

77 *
	$š‘_Ã
 (
š_addr_t
 
__Ãt
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

82 *
	$š‘_Ãt_Áİ
 (
__af
, cÚ¡ *
__ı
, 
__b™s
,

83 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

88 
	$š‘_Ãt_±Ú
 (
__af
, cÚ¡ *
__ı
,

89 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

94 
	$š‘_n§p_addr
 (cÚ¡ *
__ı
,

95 *
__buf
, 
__Ën
è
__THROW
;

99 *
	$š‘_n§p_Áß
 (
__Ën
, cÚ¡ *
__ı
,

100 *
__buf
è
__THROW
;

103 
__END_DECLS


	@/usr/include/ctype.h

23 #iâdef 
_CTYPE_H


24 
	#_CTYPE_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 
	g__BEGIN_DECLS


31 #iâdeà
_ISb™


40 
	~<’dŸn.h
>

41 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


42 
	#_ISb™
(
b™
è(1 << (b™))

	)

44 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

49 
	m_ISuµ”
 = 
_ISb™
 (0),

50 
	m_ISlow”
 = 
_ISb™
 (1),

51 
	m_IS®pha
 = 
_ISb™
 (2),

52 
	m_ISdig™
 = 
_ISb™
 (3),

53 
	m_ISxdig™
 = 
_ISb™
 (4),

54 
	m_IS¥aû
 = 
_ISb™
 (5),

55 
	m_IS´št
 = 
_ISb™
 (6),

56 
	m_ISg¿ph
 = 
_ISb™
 (7),

57 
	m_ISbÏnk
 = 
_ISb™
 (8),

58 
	m_ISúŒl
 = 
_ISb™
 (9),

59 
	m_ISpunù
 = 
_ISb™
 (10),

60 
	m_IS®num
 = 
_ISb™
 (11)

80 cÚ¡ **
	$__ùy³_b_loc
 ()

81 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

82 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

83 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

84 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

85 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

88 #iâdeà
__ılu¥lus


89 
	#__isùy³
(
c
, 
ty³
) \

90 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

91 #–ià
defšed
 
__USE_EXTERN_INLINES


92 
	#__isùy³_f
(
ty³
) \

93 
__ex‹º_šlše
 \

94 
is
##
	`ty³
 (
__c
è
__THROW
 \

96  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

97 
	}

	)
}

100 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

101 
	#__tßscii
(
c
è((cè& 0x7fè

	)

103 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

105 
__BEGIN_NAMESPACE_STD


111 
__exùy³
 (
i§Êum
);

112 
__exùy³
 (
i§Íha
);

113 
__exùy³
 (
isúŒl
);

114 
__exùy³
 (
isdig™
);

115 
__exùy³
 (
i¦ow”
);

116 
__exùy³
 (
isg¿ph
);

117 
__exùy³
 (
i¥ršt
);

118 
__exùy³
 (
i¥unù
);

119 
__exùy³
 (
is¥aû
);

120 
__exùy³
 (
isuµ”
);

121 
__exùy³
 (
isxdig™
);

125 
	$tŞow”
 (
__c
è
__THROW
;

128 
	$touµ”
 (
__c
è
__THROW
;

130 
__END_NAMESPACE_STD


134 #ifdef 
__USE_ISOC99


135 
__BEGIN_NAMESPACE_C99


137 
	`__exùy³
 (
isbÏnk
);

139 
__END_NAMESPACE_C99


142 #ifdeà
__USE_GNU


144 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

147 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


151 
	$i§scii
 (
__c
è
__THROW
;

155 
	$tßscii
 (
__c
è
__THROW
;

159 
	`__exùy³
 (
_touµ”
);

160 
	`__exùy³
 (
_tŞow”
);

164 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

165 (
__ex‹nsiÚ__
 \

166 ({ 
__»s
; \

167 ià( (
c
) > 1) \

169 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

171 
__c
 = (
c
); \

172 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

175 
__»s
 = 
f
 
¬gs
; \

178 
__»s
 = (
a
)[(è(
c
)]; \

179 
__»s
; 
	}
}))

	)

181 #ià!
defšed
 
__NO_CTYPE


182 #ifdeà
__isùy³_f


183 
	$__isùy³_f
 (
®num
)

184 
	$__isùy³_f
 (
®pha
)

185 
	$__isùy³_f
 (
úŒl
)

186 
	$__isùy³_f
 (
dig™
)

187 
	$__isùy³_f
 (
low”
)

188 
	$__isùy³_f
 (
g¿ph
)

189 
	$__isùy³_f
 (
´št
)

190 
	$__isùy³_f
 (
punù
)

191 
	$__isùy³_f
 (
¥aû
)

192 
	$__isùy³_f
 (
uµ”
)

193 
	$__isùy³_f
 (
xdig™
)

194 #ifdeà
__USE_ISOC99


195 
	$__isùy³_f
 (
bÏnk
)

197 #–ià
defšed
 
__isùy³


198 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

199 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

200 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

201 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

202 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

203 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

204 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

205 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

206 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

207 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

208 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

209 #ifdeà
__USE_ISOC99


210 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

214 #ifdeà
__USE_EXTERN_INLINES


215 
__ex‹º_šlše
 

216 
	`__NTH
 (
	$tŞow”
 (
__c
))

218  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

219 
	}
}

221 
__ex‹º_šlše
 

222 
__NTH
 (
	$touµ”
 (
__c
))

224  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

225 
	}
}

228 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


229 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

230 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

233 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


234 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

235 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

237 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

238 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

244 #ifdeà
__USE_XOPEN2K8


258 
	~<xloÿË.h
>

262 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

263 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

265 
	#__exùy³_l
(
Çme
) \

266 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

272 
__exùy³_l
 (
i§Êum_l
);

273 
__exùy³_l
 (
i§Íha_l
);

274 
__exùy³_l
 (
isúŒl_l
);

275 
__exùy³_l
 (
isdig™_l
);

276 
__exùy³_l
 (
i¦ow”_l
);

277 
__exùy³_l
 (
isg¿ph_l
);

278 
__exùy³_l
 (
i¥ršt_l
);

279 
__exùy³_l
 (
i¥unù_l
);

280 
__exùy³_l
 (
is¥aû_l
);

281 
__exùy³_l
 (
isuµ”_l
);

282 
__exùy³_l
 (
isxdig™_l
);

284 
__exùy³_l
 (
isbÏnk_l
);

288 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

289 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

292 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

293 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

295 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


296 
	#__tŞow”_l
(
c
, 
loÿË
) \

297 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

298 
	#__touµ”_l
(
c
, 
loÿË
) \

299 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

300 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

301 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

305 #iâdeà
__NO_CTYPE


306 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

307 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

308 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

309 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

310 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

311 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

312 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

313 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

314 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

315 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

316 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

318 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

320 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


321 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

322 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

325 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

326 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

327 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

328 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

329 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

330 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

331 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

332 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

333 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

334 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

335 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

337 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

339 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


340 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

341 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

348 
__END_DECLS


	@/usr/include/jemalloc/jemalloc.h

1 #iâdeà
JEMALLOC_H_


2 
	#JEMALLOC_H_


	)

3 #ifdeà
__ılu¥lus


8 
	#JEMALLOC_HAVE_ATTR


	)

11 
	#JEMALLOC_EXPERIMENTAL


	)

17 
	#JEMALLOC_OVERRIDE_MEMALIGN


	)

18 
	#JEMALLOC_OVERRIDE_VALLOC


	)

27 
	#JEMALLOC_USABLE_SIZE_CONST


	)

30 
	#LG_SIZEOF_PTR
 3

	)

37 #iâdeà
JEMALLOC_NO_RENAME


38 
	#je_m®loc_cÚf
 
m®loc_cÚf


	)

39 
	#je_m®loc_mes§ge
 
m®loc_mes§ge


	)

40 
	#je_m®loc
 
m®loc


	)

41 
	#je_ÿÎoc
 
ÿÎoc


	)

42 
	#je_posix_mem®ign
 
posix_mem®ign


	)

43 
	#je_®igÃd_®loc
 
®igÃd_®loc


	)

44 
	#je_»®loc
 
»®loc


	)

45 
	#je_ä“
 
ä“


	)

46 
	#je_m®locx
 
m®locx


	)

47 
	#je_¿Îocx
 
¿Îocx


	)

48 
	#je_x®locx
 
x®locx


	)

49 
	#je_§Îocx
 
§Îocx


	)

50 
	#je_d®locx
 
d®locx


	)

51 
	#je_ÇÎocx
 
ÇÎocx


	)

52 
	#je_m®lùl
 
m®lùl


	)

53 
	#je_m®lùÊam‘omib
 
m®lùÊam‘omib


	)

54 
	#je_m®lùlbymib
 
m®lùlbymib


	)

55 
	#je_m®loc_¡©s_´št
 
m®loc_¡©s_´št


	)

56 
	#je_m®loc_u§bË_size
 
m®loc_u§bË_size


	)

57 
	#je_mem®ign
 
mem®ign


	)

58 
	#je_v®loc
 
v®loc


	)

59 
	#je_®locm
 
®locm


	)

60 
	#je_d®locm
 
d®locm


	)

61 
	#je_ÇÎocm
 
ÇÎocm


	)

62 
	#je_¿Îocm
 
¿Îocm


	)

63 
	#je_§Îocm
 
§Îocm


	)

66 
	~<lim™s.h
>

67 
	~<¡ršgs.h
>

69 
	#JEMALLOC_VERSION
 "3.6.0-0-g46c0af68bd248b04df75e4f92d5fb804c3d75340"

	)

70 
	#JEMALLOC_VERSION_MAJOR
 3

	)

71 
	#JEMALLOC_VERSION_MINOR
 6

	)

72 
	#JEMALLOC_VERSION_BUGFIX
 0

	)

73 
	#JEMALLOC_VERSION_NREV
 0

	)

74 
	#JEMALLOC_VERSION_GID
 "46c0af68bd248b04df75e4f92d5fb804c3d75340"

	)

76 
	#MALLOCX_LG_ALIGN
(
Ï
èÖa)

	)

77 #ià
LG_SIZEOF_PTR
 == 2

78 
	#MALLOCX_ALIGN
(
a
è(
	`ffs
×)-1)

	)

80 
	#MALLOCX_ALIGN
(
a
) \

81 ((
a
 < (
size_t
)
INT_MAX
è? 
	`ffs
×)-1 : ffs×>>32)+31)

	)

83 
	#MALLOCX_ZERO
 (()0x40)

	)

85 
	#MALLOCX_ARENA
(
a
è(()((×)+1è<< 8))

	)

87 #ifdeà
JEMALLOC_EXPERIMENTAL


88 
	#ALLOCM_LG_ALIGN
(
Ï
èÖa)

	)

89 #ià
LG_SIZEOF_PTR
 == 2

90 
	#ALLOCM_ALIGN
(
a
è(
	`ffs
×)-1)

	)

92 
	#ALLOCM_ALIGN
(
a
) \

93 ((
a
 < (
size_t
)
INT_MAX
è? 
	`ffs
×)-1 : ffs×>>32)+31)

	)

95 
	#ALLOCM_ZERO
 (()0x40)

	)

96 
	#ALLOCM_NO_MOVE
 (()0x80)

	)

98 
	#ALLOCM_ARENA
(
a
è(()((×)+1è<< 8))

	)

99 
	#ALLOCM_SUCCESS
 0

	)

100 
	#ALLOCM_ERR_OOM
 1

	)

101 
	#ALLOCM_ERR_NOT_MOVED
 2

	)

104 #ifdeà
JEMALLOC_HAVE_ATTR


105 
	#JEMALLOC_ATTR
(
s
è
	`__©Œibu‹__
((s))

	)

106 
	#JEMALLOC_EXPORT
 
	`JEMALLOC_ATTR
(
	`visib™y
("deçuÉ"))

	)

107 
	#JEMALLOC_ALIGNED
(
s
è
	`JEMALLOC_ATTR
(
	`®igÃd
(s))

	)

108 
	#JEMALLOC_SECTION
(
s
è
	`JEMALLOC_ATTR
(
	`£ùiÚ
(s))

	)

109 
	#JEMALLOC_NOINLINE
 
	`JEMALLOC_ATTR
(
nošlše
)

	)

110 #–ià
_MSC_VER


111 
	#JEMALLOC_ATTR
(
s
)

	)

112 #ifdeà
DLLEXPORT


113 
	#JEMALLOC_EXPORT
 
	`__deş¥ec
(
dÎexpÜt
)

	)

115 
	#JEMALLOC_EXPORT
 
	`__deş¥ec
(
dÎimpÜt
)

	)

117 
	#JEMALLOC_ALIGNED
(
s
è
	`__deş¥ec
(
	`®ign
(s))

	)

118 
	#JEMALLOC_SECTION
(
s
è
	`__deş¥ec
(
	`®loÿ‹
(s))

	)

119 
	#JEMALLOC_NOINLINE
 
	`__deş¥ec
(
nošlše
)

	)

121 
	#JEMALLOC_ATTR
(
s
)

	)

122 
	#JEMALLOC_EXPORT


	)

123 
	#JEMALLOC_ALIGNED
(
s
)

	)

124 
	#JEMALLOC_SECTION
(
s
)

	)

125 
	#JEMALLOC_NOINLINE


	)

133 
JEMALLOC_EXPORT
 cÚ¡ *
je_m®loc_cÚf
;

134 
JEMALLOC_EXPORT
 (*
je_m®loc_mes§ge
)(*
cbİaque
,

135 cÚ¡ *
s
);

137 
JEMALLOC_EXPORT
 *
je_m®loc
(
size_t
 
size
è
JEMALLOC_ATTR
(
m®loc
);

138 
JEMALLOC_EXPORT
 *
je_ÿÎoc
(
size_t
 
num
, size_ˆ
size
)

139 
JEMALLOC_ATTR
(
m®loc
);

140 
JEMALLOC_EXPORT
 
je_posix_mem®ign
(**
mem±r
, 
size_t
 
®ignm’t
,

141 
size_t
 
size
è
JEMALLOC_ATTR
(
nÚnuÎ
(1));

142 
JEMALLOC_EXPORT
 *
je_®igÃd_®loc
(
size_t
 
®ignm’t
, size_ˆ
size
)

143 
JEMALLOC_ATTR
(
m®loc
);

144 
JEMALLOC_EXPORT
 *
je_»®loc
(*
±r
, 
size_t
 
size
);

145 
JEMALLOC_EXPORT
 
je_ä“
(*
±r
);

147 
JEMALLOC_EXPORT
 *
je_m®locx
(
size_t
 
size
, 
æags
);

148 
JEMALLOC_EXPORT
 *
je_¿Îocx
(*
±r
, 
size_t
 
size
, 
æags
);

149 
JEMALLOC_EXPORT
 
size_t
 
je_x®locx
(*
±r
, size_ˆ
size
, size_ˆ
exŒa
,

150 
æags
);

151 
JEMALLOC_EXPORT
 
size_t
 
je_§Îocx
(cÚ¡ *
±r
, 
æags
);

152 
JEMALLOC_EXPORT
 
je_d®locx
(*
±r
, 
æags
);

153 
JEMALLOC_EXPORT
 
size_t
 
je_ÇÎocx
(size_ˆ
size
, 
æags
);

155 
JEMALLOC_EXPORT
 
je_m®lùl
(cÚ¡ *
Çme
, *
Şdp
,

156 
size_t
 *
ŞdËÅ
, *
Ãwp
, size_ˆ
ÃwËn
);

157 
JEMALLOC_EXPORT
 
je_m®lùÊam‘omib
(cÚ¡ *
Çme
, 
size_t
 *
mibp
,

158 
size_t
 *
mibËÅ
);

159 
JEMALLOC_EXPORT
 
je_m®lùlbymib
(cÚ¡ 
size_t
 *
mib
, size_ˆ
mibËn
,

160 *
Şdp
, 
size_t
 *
ŞdËÅ
, *
Ãwp
, size_ˆ
ÃwËn
);

161 
JEMALLOC_EXPORT
 
je_m®loc_¡©s_´št
((*
wr™e_cb
)(*,

162 cÚ¡ *), *
je_cbİaque
, cÚ¡ *
İts
);

163 
JEMALLOC_EXPORT
 
size_t
 
je_m®loc_u§bË_size
(

164 
JEMALLOC_USABLE_SIZE_CONST
 *
±r
);

166 #ifdeà
JEMALLOC_OVERRIDE_MEMALIGN


167 
JEMALLOC_EXPORT
 * 
je_mem®ign
(
size_t
 
®ignm’t
, size_ˆ
size
)

168 
JEMALLOC_ATTR
(
m®loc
);

171 #ifdeà
JEMALLOC_OVERRIDE_VALLOC


172 
JEMALLOC_EXPORT
 * 
je_v®loc
(
size_t
 
size
è
JEMALLOC_ATTR
(
m®loc
);

175 #ifdeà
JEMALLOC_EXPERIMENTAL


176 
JEMALLOC_EXPORT
 
je_®locm
(**
±r
, 
size_t
 *
rsize
, size_ˆ
size
,

177 
æags
è
JEMALLOC_ATTR
(
nÚnuÎ
(1));

178 
JEMALLOC_EXPORT
 
je_¿Îocm
(**
±r
, 
size_t
 *
rsize
, size_ˆ
size
,

179 
size_t
 
exŒa
, 
æags
è
JEMALLOC_ATTR
(
nÚnuÎ
(1));

180 
JEMALLOC_EXPORT
 
je_§Îocm
(cÚ¡ *
±r
, 
size_t
 *
rsize
, 
æags
)

181 
JEMALLOC_ATTR
(
nÚnuÎ
(1));

182 
JEMALLOC_EXPORT
 
je_d®locm
(*
±r
, 
æags
)

183 
JEMALLOC_ATTR
(
nÚnuÎ
(1));

184 
JEMALLOC_EXPORT
 
je_ÇÎocm
(
size_t
 *
rsize
, size_ˆ
size
, 
æags
);

194 #ifdeà
JEMALLOC_MANGLE


195 #iâdeà
JEMALLOC_NO_DEMANGLE


196 
	#JEMALLOC_NO_DEMANGLE


	)

198 
	#m®loc_cÚf
 
je_m®loc_cÚf


	)

199 
	#m®loc_mes§ge
 
je_m®loc_mes§ge


	)

200 
	#m®loc
 
je_m®loc


	)

201 
	#ÿÎoc
 
je_ÿÎoc


	)

202 
	#posix_mem®ign
 
je_posix_mem®ign


	)

203 
	#®igÃd_®loc
 
je_®igÃd_®loc


	)

204 
	#»®loc
 
je_»®loc


	)

205 
	#ä“
 
je_ä“


	)

206 
	#m®locx
 
je_m®locx


	)

207 
	#¿Îocx
 
je_¿Îocx


	)

208 
	#x®locx
 
je_x®locx


	)

209 
	#§Îocx
 
je_§Îocx


	)

210 
	#d®locx
 
je_d®locx


	)

211 
	#ÇÎocx
 
je_ÇÎocx


	)

212 
	#m®lùl
 
je_m®lùl


	)

213 
	#m®lùÊam‘omib
 
je_m®lùÊam‘omib


	)

214 
	#m®lùlbymib
 
je_m®lùlbymib


	)

215 
	#m®loc_¡©s_´št
 
je_m®loc_¡©s_´št


	)

216 
	#m®loc_u§bË_size
 
je_m®loc_u§bË_size


	)

217 
	#mem®ign
 
je_mem®ign


	)

218 
	#v®loc
 
je_v®loc


	)

219 
	#®locm
 
je_®locm


	)

220 
	#d®locm
 
je_d®locm


	)

221 
	#ÇÎocm
 
je_ÇÎocm


	)

222 
	#¿Îocm
 
je_¿Îocm


	)

223 
	#§Îocm
 
je_§Îocm


	)

233 #iâdeà
JEMALLOC_NO_DEMANGLE


234 #undeà
je_m®loc_cÚf


235 #undeà
je_m®loc_mes§ge


236 #undeà
je_m®loc


237 #undeà
je_ÿÎoc


238 #undeà
je_posix_mem®ign


239 #undeà
je_®igÃd_®loc


240 #undeà
je_»®loc


241 #undeà
je_ä“


242 #undeà
je_m®locx


243 #undeà
je_¿Îocx


244 #undeà
je_x®locx


245 #undeà
je_§Îocx


246 #undeà
je_d®locx


247 #undeà
je_ÇÎocx


248 #undeà
je_m®lùl


249 #undeà
je_m®lùÊam‘omib


250 #undeà
je_m®lùlbymib


251 #undeà
je_m®loc_¡©s_´št


252 #undeà
je_m®loc_u§bË_size


253 #undeà
je_mem®ign


254 #undeà
je_v®loc


255 #undeà
je_®locm


256 #undeà
je_d®locm


257 #undeà
je_ÇÎocm


258 #undeà
je_¿Îocm


259 #undeà
je_§Îocm


262 #ifdeà
__ılu¥lus


	@/usr/include/signal.h

22 #iâdef 
_SIGNAL_H


24 #ià!
defšed
 
__Ãed_sig_©omic_t
 && !defšed 
__Ãed_sig£t_t


25 
	#_SIGNAL_H


	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	~<b™s/sig£t.h
>

36 #ià
defšed
 
__Ãed_sig_©omic_t
 || defšed 
_SIGNAL_H


37 #iâdeà
__sig_©omic_t_defšed


38 
	#__sig_©omic_t_defšed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_©omic_t
 
	tsig_©omic_t
;

41 
	g__END_NAMESPACE_STD


43 #undeà
__Ãed_sig_©omic_t


46 #ià
defšed
 
__Ãed_sig£t_t
 || (defšed 
_SIGNAL_H
 && defšed 
__USE_POSIX
)

47 #iâdeà
__sig£t_t_defšed


48 
	#__sig£t_t_defšed


	)

49 
__sig£t_t
 
	tsig£t_t
;

51 #undeà
__Ãed_sig£t_t


54 #ifdeà
_SIGNAL_H


56 
	~<b™s/ty³s.h
>

57 
	~<b™s/signum.h
>

59 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


60 #iâdeà
__pid_t_defšed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_defšed


	)

64 #ifdeà
__USE_XOPEN


66 #iâdeà
__uid_t_defšed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_defšed


	)

72 #ifdeà
__USE_POSIX199309


74 
	#__Ãed_time¥ec


	)

75 
	~<time.h
>

78 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_XOPEN_EXTENDED


80 
	~<b™s/sigšfo.h
>

85 (*
	t__sighªdËr_t
) ();

90 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

91 
__THROW
;

92 #ifdeà
__USE_GNU


93 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifdeà
__USE_BSD


102 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

103 
__THROW
;

106 #ifdeà
__REDIRECT_NTH


107 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

108 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

109 
__sysv_sigÇl
);

111 
	#sigÇl
 
__sysv_sigÇl


	)

114 
__END_NAMESPACE_STD


116 #ifdeà
__USE_XOPEN


119 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

120 
__THROW
;

126 #ifdeà
__USE_POSIX


127 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

130 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


134 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$¿i£
 (
__sig
è
__THROW
;

140 
__END_NAMESPACE_STD


142 #ifdeà
__USE_SVID


144 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

145 
__THROW
;

146 
	$gsigÇl
 (
__sig
è
__THROW
;

149 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN2K


151 
	`psigÇl
 (
__sig
, cÚ¡ *
__s
);

154 #ifdeà
__USE_XOPEN2K


156 
	`psigšfo
 (cÚ¡ 
sigšfo_t
 *
__pšfo
, cÚ¡ *
__s
);

169 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

171 #ifdeà
__FAVOR_BSD


174 
	$sig·u£
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

176 #ifdeà
__USE_XOPEN


177 #ifdeà
__GNUC__


178 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

181 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

187 #ifdeà
__USE_BSD


194 
	#sigmask
(
sig
è
	`__sigmask
(sig)

	)

197 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

200 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

203 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

207 #ifdeà
__USE_MISC


208 
	#NSIG
 
_NSIG


	)

211 #ifdeà
__USE_GNU


212 
__sighªdËr_t
 
	tsighªdËr_t
;

216 #ifdeà
__USE_BSD


217 
__sighªdËr_t
 
	tsig_t
;

220 #ifdeà
__USE_POSIX


223 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

226 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

229 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

232 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

235 
	$sigismemb”
 (cÚ¡ 
sig£t_t
 *
__£t
, 
__signo
)

236 
__THROW
 
	`__nÚnuÎ
 ((1));

238 #ifdeà
__USE_GNU


240 
	$sigi£m±y£t
 (cÚ¡ 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

243 
	$sigªd£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

244 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

247 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

248 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

253 
	~<b™s/sigaùiÚ.h
>

256 
	$sig´ocmask
 (
__how
, cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

257 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

264 
	$sigsu¥’d
 (cÚ¡ 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

267 
	$sigaùiÚ
 (
__sig
, cÚ¡ 
sigaùiÚ
 *
__»¡riù
 
__aù
,

268 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

271 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

278 
	$sigwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

279 
	`__nÚnuÎ
 ((1, 2));

281 #ifdeà
__USE_POSIX199309


286 
	$sigwa™šfo
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

287 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

294 
	$sigtimedwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

295 
sigšfo_t
 *
__»¡riù
 
__šfo
,

296 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
)

297 
	`__nÚnuÎ
 ((1));

301 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, cÚ¡ 
sigv®
 
__v®
)

302 
__THROW
;

307 #ifdeà
__USE_BSD


311 cÚ¡ *cÚ¡ 
_sys_sigli¡
[
_NSIG
];

312 cÚ¡ *cÚ¡ 
sys_sigli¡
[
_NSIG
];

315 
	ssigvec


317 
__sighªdËr_t
 
sv_hªdËr
;

318 
sv_mask
;

320 
sv_æags
;

321 
	#sv_Ú¡ack
 
sv_æags


	)

325 
	#SV_ONSTACK
 (1 << 0)

	)

326 
	#SV_INTERRUPT
 (1 << 1)

	)

327 
	#SV_RESETHAND
 (1 << 2)

	)

335 
	$sigvec
 (
__sig
, cÚ¡ 
sigvec
 *
__vec
,

336 
sigvec
 *
__ovec
è
__THROW
;

340 
	~<b™s/sigcÚ‹xt.h
>

343 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

348 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


349 
	#__Ãed_size_t


	)

350 
	~<¡ddef.h
>

355 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

357 
	~<b™s/sig¡ack.h
>

358 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


360 
	~<sys/ucÚ‹xt.h
>

366 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

367 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

371 
	$sig®t¡ack
 (cÚ¡ 
sig®t¡ack
 *
__»¡riù
 
__ss
,

372 
sig®t¡ack
 *
__»¡riù
 
__oss
è
__THROW
;

376 #ifdeà
__USE_XOPEN_EXTENDED


380 
	$sighŞd
 (
__sig
è
__THROW
;

383 
	$sig»l£
 (
__sig
è
__THROW
;

386 
	$sigignÜe
 (
__sig
è
__THROW
;

389 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

392 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


395 
	~<b™s/±h»adty³s.h
>

396 
	~<b™s/sigth»ad.h
>

403 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

405 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

409 
__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

34 
	g__BEGIN_DECLS


36 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


37 
	#_STDLIB_H
 1

	)

39 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


41 
	~<b™s/wa™æags.h
>

42 
	~<b™s/wa™¡©us.h
>

44 #ifdeà
__USE_BSD


49 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


50 
	#__WAIT_INT
(
¡©us
) \

51 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

52 { .
__š
 = (
¡©us
è}).
__i
))

	)

54 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

62 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
wa™
 *
	m__u±r
;

70 *
	m__Œ
;

71 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

85 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

90 #ifdeà
__WIFCONTINUED


91 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquÙ
;

100 
	m»m
;

101 } 
	tdiv_t
;

104 #iâdeà
__ldiv_t_defšed


107 
	mquÙ
;

108 
	m»m
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_defšed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


115 
__BEGIN_NAMESPACE_C99


117 
__ex‹nsiÚ__
 struct

119 
	mquÙ
;

120 
	m»m
;

121 } 
	tÎdiv_t
;

122 
	#__Îdiv_t_defšed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

139 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (cÚ¡ *
__ÅŒ
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

147 
	$©oi
 (cÚ¡ *
__ÅŒ
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

150 
	$©Ş
 (cÚ¡ *
__ÅŒ
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

152 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

155 
__BEGIN_NAMESPACE_C99


157 
__ex‹nsiÚ__
 
	$©Şl
 (cÚ¡ *
__ÅŒ
)

158 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

165 **
__»¡riù
 
__’d±r
)

166 
__THROW
 
	`__nÚnuÎ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

173 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

175 
	$¡¹Şd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

176 **
__»¡riù
 
__’d±r
)

177 
__THROW
 
	`__nÚnuÎ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$¡¹Ş
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

184 **
__»¡riù
 
__’d±r
, 
__ba£
)

185 
__THROW
 
	`__nÚnuÎ
 ((1));

187 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

188 **
__»¡riù
 
__’d±r
, 
__ba£
)

189 
__THROW
 
	`__nÚnuÎ
 ((1));

190 
__END_NAMESPACE_STD


192 #ià
defšed
 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_BSD


194 
__ex‹nsiÚ__


195 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

196 **
__»¡riù
 
__’d±r
, 
__ba£
)

197 
__THROW
 
	`__nÚnuÎ
 ((1));

199 
__ex‹nsiÚ__


200 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
)

202 
__THROW
 
	`__nÚnuÎ
 ((1));

205 #ià
defšed
 
__USE_ISOC99
 || (defšed 
__GLIBC_HAVE_LONG_LONG
 && defšed 
__USE_MISC
)

206 
__BEGIN_NAMESPACE_C99


208 
__ex‹nsiÚ__


209 
	$¡¹Şl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

210 **
__»¡riù
 
__’d±r
, 
__ba£
)

211 
__THROW
 
	`__nÚnuÎ
 ((1));

213 
__ex‹nsiÚ__


214 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

215 **
__»¡riù
 
__’d±r
, 
__ba£
)

216 
__THROW
 
	`__nÚnuÎ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifdeà
__USE_GNU


235 
	~<xloÿË.h
>

239 
	$¡¹Ş_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

240 **
__»¡riù
 
__’d±r
, 
__ba£
,

241 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

243 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

244 **
__»¡riù
 
__’d±r
,

245 
__ba£
, 
__loÿË_t
 
__loc
)

246 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

248 
__ex‹nsiÚ__


249 
	$¡¹Şl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

250 **
__»¡riù
 
__’d±r
, 
__ba£
,

251 
__loÿË_t
 
__loc
)

252 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

254 
__ex‹nsiÚ__


255 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

256 **
__»¡riù
 
__’d±r
,

257 
__ba£
, 
__loÿË_t
 
__loc
)

258 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

260 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

261 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

262 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

264 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

265 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

266 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

268 
	$¡¹Şd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

269 **
__»¡riù
 
__’d±r
,

270 
__loÿË_t
 
__loc
)

271 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

275 #ifdeà
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__ex‹º_šlše
 

278 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

280  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

281 
	}
}

282 
__ex‹º_šlše
 

283 
__NTH
 (
	$©Ş
 (cÚ¡ *
__ÅŒ
))

285  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

292 
__NTH
 (
	$©Şl
 (cÚ¡ *
__ÅŒ
))

294  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

308 
	$a64l
 (cÚ¡ *
__s
)

309 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

313 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


314 
	~<sys/ty³s.h
>

321 
	$¿ndom
 (è
__THROW
;

324 
	$¤ªdom
 (
__£ed
è
__THROW
;

330 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

331 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

335 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

338 #ifdeà
__USE_MISC


343 
	s¿ndom_d©a


345 
št32_t
 *
åŒ
;

346 
št32_t
 *
½Œ
;

347 
št32_t
 *
¡©e
;

348 
¿nd_ty³
;

349 
¿nd_deg
;

350 
¿nd_£p
;

351 
št32_t
 *
’d_±r
;

354 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

355 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

357 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

358 
__THROW
 
	`__nÚnuÎ
 ((2));

360 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

361 
size_t
 
__¡©–’
,

362 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

363 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

365 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

366 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

367 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$¿nd
 (è
__THROW
;

376 
	$¤ªd
 (
__£ed
è
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifdeà
__USE_POSIX


381 
	$¿nd_r
 (*
__£ed
è
__THROW
;

385 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


389 
	$d¿nd48
 (è
__THROW
;

390 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

393 
	$Ìªd48
 (è
__THROW
;

394 
	$Äªd48
 (
__xsubi
[3])

395 
__THROW
 
	`__nÚnuÎ
 ((1));

398 
	$m¿nd48
 (è
__THROW
;

399 
	$j¿nd48
 (
__xsubi
[3])

400 
__THROW
 
	`__nÚnuÎ
 ((1));

403 
	$¤ªd48
 (
__£edv®
è
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__nÚnuÎ
 ((1));

406 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

408 #ifdeà
__USE_MISC


412 
	sd¿nd48_d©a


414 
__x
[3];

415 
__Şd_x
[3];

416 
__c
;

417 
__š™
;

418 
__a
;

422 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

423 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

424 
	$”ªd48_r
 (
__xsubi
[3],

425 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

426 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

429 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

430 *
__»¡riù
 
__»suÉ
)

431 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

432 
	$Äªd48_r
 (
__xsubi
[3],

433 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

434 *
__»¡riù
 
__»suÉ
)

435 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

438 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

439 *
__»¡riù
 
__»suÉ
)

440 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

441 
	$j¿nd48_r
 (
__xsubi
[3],

442 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

443 *
__»¡riù
 
__»suÉ
)

444 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

447 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

448 
__THROW
 
	`__nÚnuÎ
 ((2));

450 
	$£ed48_r
 (
__£ed16v
[3],

451 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

453 
	$lcÚg48_r
 (
__·¿m
[7],

454 
d¿nd48_d©a
 *
__bufãr
)

455 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

461 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


462 
	#__m®loc_ªd_ÿÎoc_defšed


	)

463 
__BEGIN_NAMESPACE_STD


465 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

467 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

468 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

469 
__END_NAMESPACE_STD


472 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


473 
__BEGIN_NAMESPACE_STD


479 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

480 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

482 
	$ä“
 (*
__±r
è
__THROW
;

483 
__END_NAMESPACE_STD


485 #ifdef 
__USE_MISC


487 
	$cä“
 (*
__±r
è
__THROW
;

490 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


491 
	~<®loÿ.h
>

494 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

495 || 
defšed
 
__USE_BSD


497 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

500 #ifdeà
__USE_XOPEN2K


502 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

503 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

506 #ifdeà
__USE_ISOC11


508 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

509 
__THROW
 
__wur
 
	`__©Œibu‹__
 ((
__m®loc__
, 
	`__®loc_size__
 (2)));

512 
__BEGIN_NAMESPACE_STD


514 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

518 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

520 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


522 #ifdeà
__ılu¥lus


523 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

524 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

526 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

529 
__END_NAMESPACE_STD


531 #ifdef 
__USE_MISC


534 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

535 
__THROW
 
	`__nÚnuÎ
 ((1));

538 
__BEGIN_NAMESPACE_STD


542 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

544 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


548 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

550 
__END_NAMESPACE_STD


552 #ifdeà
__USE_ISOC99


553 
__BEGIN_NAMESPACE_C99


556 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

557 
__END_NAMESPACE_C99


561 
__BEGIN_NAMESPACE_STD


563 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

564 
__END_NAMESPACE_STD


566 #ifdeà
__USE_GNU


569 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

570 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

573 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


577 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

580 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


583 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

584 
__THROW
 
	`__nÚnuÎ
 ((2));

587 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

590 #ifdef 
__USE_MISC


594 
	$ş—»nv
 (è
__THROW
;

598 #ià
defšed
 
__USE_MISC
 \

599 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

605 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

608 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

609 || 
defšed
 
__USE_XOPEN2K8


618 #iâdeà
__USE_FILE_OFFSET64


619 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

621 #ifdeà
__REDIRECT


622 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

623 
	`__nÚnuÎ
 ((1)è
__wur
;

625 
	#mk¡emp
 
mk¡emp64


	)

628 #ifdeà
__USE_LARGEFILE64


629 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

633 #ifdeà
__USE_MISC


640 #iâdeà
__USE_FILE_OFFSET64


641 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

643 #ifdeà
__REDIRECT


644 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

645 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

647 
	#mk¡emps
 
mk¡emps64


	)

650 #ifdeà
__USE_LARGEFILE64


651 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

652 
	`__nÚnuÎ
 ((1)è
__wur
;

656 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


662 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

665 #ifdeà
__USE_GNU


672 #iâdeà
__USE_FILE_OFFSET64


673 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

675 #ifdeà
__REDIRECT


676 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

677 
	`__nÚnuÎ
 ((1)è
__wur
;

679 
	#mko¡emp
 
mko¡emp64


	)

682 #ifdeà
__USE_LARGEFILE64


683 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

692 #iâdeà
__USE_FILE_OFFSET64


693 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

694 
	`__nÚnuÎ
 ((1)è
__wur
;

696 #ifdeà
__REDIRECT


697 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

698 
__æags
), 
mko¡emps64
)

699 
	`__nÚnuÎ
 ((1)è
__wur
;

701 
	#mko¡emps
 
mko¡emps64


	)

704 #ifdeà
__USE_LARGEFILE64


705 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

706 
	`__nÚnuÎ
 ((1)è
__wur
;

711 
__BEGIN_NAMESPACE_STD


716 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

717 
__END_NAMESPACE_STD


720 #ifdef 
__USE_GNU


723 *
	$ÿnÚiÿlize_fe_Çme
 (cÚ¡ *
__Çme
)

724 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

727 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


733 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

734 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

739 #iâdeà
__COMPAR_FN_T


740 
	#__COMPAR_FN_T


	)

741 (*
	t__com·r_â_t
) (const *, const *);

743 #ifdef 
__USE_GNU


744 
__com·r_â_t
 
	tcom·risÚ_â_t
;

747 #ifdeà
__USE_GNU


748 (*
	t__com·r_d_â_t
) (const *, const *, *);

751 
__BEGIN_NAMESPACE_STD


754 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

755 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

756 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

760 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

761 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

762 #ifdeà
__USE_GNU


763 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

764 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

765 
	`__nÚnuÎ
 ((1, 4));

770 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

771 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

772 
__END_NAMESPACE_STD


774 #ifdeà
__USE_ISOC99


775 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

776 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

780 
__BEGIN_NAMESPACE_STD


784 
div_t
 
	$div
 (
__num”
, 
__d’om
)

785 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

786 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

787 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

788 
__END_NAMESPACE_STD


790 #ifdeà
__USE_ISOC99


791 
__BEGIN_NAMESPACE_C99


792 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

793 
__d’om
)

794 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

795 
__END_NAMESPACE_C99


799 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

800 || 
defšed
 
__USE_SVID


807 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

808 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

813 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

814 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

819 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

820 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

823 #ifdeà
__USE_MISC


825 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

826 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

827 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

828 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

829 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

830 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

831 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

832 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

837 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

838 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

839 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

840 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

841 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

842 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

844 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

845 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

846 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

847 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

848 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

849 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

850 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

851 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

856 
__BEGIN_NAMESPACE_STD


859 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

862 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

863 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
 
__wur
;

866 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
 
__wur
;

870 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

871 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

873 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

874 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

875 
__THROW
;

876 
__END_NAMESPACE_STD


879 #ifdeà
__USE_SVID


884 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

888 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


895 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

896 *cÚ¡ *
__»¡riù
 
__tok’s
,

897 **
__»¡riù
 
__v®u•
)

898 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

902 #ifdeà
__USE_XOPEN


904 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

910 #ifdeà
__USE_XOPEN2KXSI


912 
	$posix_İ’±
 (
__oæag
è
__wur
;

915 #ifdeà
__USE_XOPEN


920 
	$g¿Á±
 (
__fd
è
__THROW
;

924 
	$uÆock±
 (
__fd
è
__THROW
;

929 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

932 #ifdeà
__USE_GNU


936 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

937 
__THROW
 
	`__nÚnuÎ
 ((2));

940 
	`g‘±
 ();

943 #ifdeà
__USE_BSD


947 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

948 
__THROW
 
	`__nÚnuÎ
 ((1));

951 
	~<b™s/¡dlib-æßt.h
>

954 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


955 
	~<b™s/¡dlib.h
>

957 #ifdeà
__LDBL_COMPAT


958 
	~<b™s/¡dlib-ldbl.h
>

962 #undeà
__Ãed_m®loc_ªd_ÿÎoc


964 
__END_DECLS


	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


30 
	#__Ãed_size_t


	)

31 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

35 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

36 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

40 
__BEGIN_NAMESPACE_STD


42 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

43 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

46 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

47 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

48 
__END_NAMESPACE_STD


53 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


54 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

60 
__BEGIN_NAMESPACE_STD


62 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

65 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

66 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

69 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


72 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

74 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

75 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 #ifdeà
__OPTIMIZE__


78 
__ex‹º_®ways_šlše
 *

79 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


81  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

84 
__ex‹º_®ways_šlše
 const *

85 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


87  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

90 
	}
}

92 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

93 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

95 
__END_NAMESPACE_STD


97 #ifdeà
__USE_GNU


100 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


101 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

103 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

104 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

107 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

111 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


112 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

123 
__BEGIN_NAMESPACE_STD


125 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

128 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

129 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

133 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

134 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

137 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

140 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

141 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

147 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

151 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

152 
__THROW
 
	`__nÚnuÎ
 ((2));

153 
__END_NAMESPACE_STD


155 #ifdeà
__USE_XOPEN2K8


159 
	~<xloÿË.h
>

162 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

163 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

165 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

166 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

169 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

170 || 
defšed
 
__USE_XOPEN2K8


172 *
	$¡rdup
 (cÚ¡ *
__s
)

173 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

179 #ià
defšed
 
__USE_XOPEN2K8


180 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

181 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

184 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


186 
	#¡rdu·
(
s
) \

187 (
__ex‹nsiÚ__
 \

189 cÚ¡ *
__Şd
 = (
s
); \

190 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

191 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

192 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

193 
	}
}))

	)

196 
	#¡ºdu·
(
s
, 
n
) \

197 (
__ex‹nsiÚ__
 \

199 cÚ¡ *
__Şd
 = (
s
); \

200 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

201 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

202 
__Ãw
[
__Ën
] = '\0'; \

203 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

204 }))

	)

207 
	g__BEGIN_NAMESPACE_STD


209 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


212 *
¡rchr
 (*
__s
, 
__c
)

213 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

214 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

215 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

217 #ifdeà
__OPTIMIZE__


218 
__ex‹º_®ways_šlše
 *

219 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


221  
__butš_¡rchr
 (
__s
, 
__c
);

224 
__ex‹º_®ways_šlše
 const *

225 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


227  
__butš_¡rchr
 (
__s
, 
__c
);

232 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

233 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

236 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


239 *
	`¡¼chr
 (*
__s
, 
__c
)

240 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

241 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

242 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

244 #ifdeà
__OPTIMIZE__


245 
__ex‹º_®ways_šlše
 *

246 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


248  
	`__butš_¡¼chr
 (
__s
, 
__c
);

251 
__ex‹º_®ways_šlše
 const *

252 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


254  
	`__butš_¡¼chr
 (
__s
, 
__c
);

257 
	}
}

259 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

260 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

262 
__END_NAMESPACE_STD


264 #ifdeà
__USE_GNU


267 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


268 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

269 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

270 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

271 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

273 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

274 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

278 
__BEGIN_NAMESPACE_STD


281 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

282 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

285 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

286 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

288 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


291 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

292 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

293 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

294 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

296 #ifdeà
__OPTIMIZE__


297 
__ex‹º_®ways_šlše
 *

298 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


300  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

303 
__ex‹º_®ways_šlše
 const *

304 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


306  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

309 
	}
}

311 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

312 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

315 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


318 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

319 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

320 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

321 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

323 #ifdeà
__OPTIMIZE__


324 
__ex‹º_®ways_šlše
 *

325 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


327  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

330 
__ex‹º_®ways_šlše
 const *

331 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


333  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

336 
	}
}

338 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

339 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

344 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

345 
__THROW
 
	`__nÚnuÎ
 ((2));

346 
__END_NAMESPACE_STD


350 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

351 cÚ¡ *
__»¡riù
 
__d–im
,

352 **
__»¡riù
 
__§ve_±r
)

353 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

354 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


355 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

360 #ifdeà
__USE_GNU


362 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


363 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

364 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

365 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

366 cÚ¡ *
__ÃedË
)

367 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

370 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

374 #ifdeà
__USE_GNU


378 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

379 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

380 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

384 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

385 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

386 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

387 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

388 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

389 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

393 
__BEGIN_NAMESPACE_STD


395 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

396 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

397 
__END_NAMESPACE_STD


399 #ifdef 
__USE_XOPEN2K8


402 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

403 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

407 
__BEGIN_NAMESPACE_STD


409 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

410 
__END_NAMESPACE_STD


411 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


419 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


422 #ifdeà
__REDIRECT_NTH


423 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

424 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

425 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

427 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

428 
__THROW
 
	`__nÚnuÎ
 ((2));

429 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

434 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

435 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

439 #ifdeà
__USE_XOPEN2K8


441 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

447 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

449 #ifdeà
__USE_BSD


451 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

452 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

455 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

458 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

459 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

462 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


465 *
	`šdex
 (*
__s
, 
__c
)

466 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

467 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

468 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

470 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


471 
__ex‹º_®ways_šlše
 *

472 
	`šdex
 (*
__s
, 
__c
è
__THROW


474  
	`__butš_šdex
 (
__s
, 
__c
);

477 
__ex‹º_®ways_šlše
 const *

478 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


480  
	`__butš_šdex
 (
__s
, 
__c
);

483 
	}
}

485 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

486 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

490 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


493 *
	`ršdex
 (*
__s
, 
__c
)

494 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

495 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

496 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

498 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


499 
__ex‹º_®ways_šlše
 *

500 
	`ršdex
 (*
__s
, 
__c
è
__THROW


502  
	`__butš_ršdex
 (
__s
, 
__c
);

505 
__ex‹º_®ways_šlše
 const *

506 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


508  
	`__butš_ršdex
 (
__s
, 
__c
);

511 
	}
}

513 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

514 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

519 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

523 #ifdef 
__USE_GNU


524 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

525 #ifdeà
__GNUC__


526 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

527 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

532 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

533 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

536 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

537 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

540 #ifdef 
__USE_GNU


543 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

544 
__loÿË_t
 
__loc
)

545 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

547 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

548 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

549 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

552 #ifdef 
__USE_BSD


555 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

556 cÚ¡ *
__»¡riù
 
__d–im
)

557 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

560 #ifdef 
__USE_XOPEN2K8


562 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

565 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

566 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

567 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

568 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

572 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

573 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

574 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

575 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

576 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

577 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

580 #ifdef 
__USE_GNU


582 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

583 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

586 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

589 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 #iâdeà
ba£Çme


596 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


597 "C++" *
	$ba£Çme
 (*
__f’ame
)

598 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

599 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

600 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

602 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

608 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

609 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

610 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


630 
	~<b™s/¡ršg.h
>

633 
	~<b™s/¡ršg2.h
>

636 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


638 
	~<b™s/¡ršg3.h
>

642 
__END_DECLS


	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

53 
	#__şock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__şock_t
 
	tşock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
şock_t
)

66 #undeà
__Ãed_şock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__şockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

86 
	#__şockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__şockid_t
 
	tşockid_t
;

94 #undeà
__şockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
şock_t
 
	$şock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_SVID


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/bits/pthreadtypes.h

18 #iâdeà
_BITS_PTHREADTYPES_H


19 
	#_BITS_PTHREADTYPES_H
 1

	)

21 
	~<b™s/wÜdsize.h
>

23 #ifdeà
__x86_64__


24 #ià
__WORDSIZE
 == 64

25 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

26 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

27 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

28 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

29 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

30 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

31 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

32 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

33 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

35 
	#__SIZEOF_PTHREAD_ATTR_T
 32

	)

36 
	#__SIZEOF_PTHREAD_MUTEX_T
 32

	)

37 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

38 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

39 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

40 
	#__SIZEOF_PTHREAD_RWLOCK_T
 44

	)

41 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

42 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

43 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

46 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

47 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

48 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

49 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

50 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

51 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

52 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

53 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

54 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

60 
	t±h»ad_t
;

63 
	u±h»ad_©Œ_t


65 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

66 
	m__®ign
;

68 #iâdeà
__have_±h»ad_©Œ_t


69 
±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

70 
	#__have_±h»ad_©Œ_t
 1

	)

74 #ifdeà
__x86_64__


75 
	s__±h»ad_š‹º®_li¡


77 
__±h»ad_š‹º®_li¡
 *
	m__´ev
;

78 
__±h»ad_š‹º®_li¡
 *
	m__Ãxt
;

79 } 
	t__±h»ad_li¡_t
;

81 
	s__±h»ad_š‹º®_¦i¡


83 
__±h»ad_š‹º®_¦i¡
 *
	m__Ãxt
;

84 } 
	t__±h»ad_¦i¡_t
;

92 
	s__±h»ad_mu‹x_s


94 
	m__lock
;

95 
	m__couÁ
;

96 
	m__owÃr
;

97 #ifdeà
__x86_64__


98 
	m__nu£rs
;

102 
	m__kšd
;

103 #ifdeà
__x86_64__


104 
	m__¥šs
;

105 
	m__–isiÚ
;

106 
__±h»ad_li¡_t
 
	m__li¡
;

107 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

108 
	#__PTHREAD_MUTEX_HAVE_ELISION
 1

	)

110 
	m__nu£rs
;

111 
__ex‹nsiÚ__
 union

115 
	m__e¥šs
;

116 
	m__–isiÚ
;

117 
	#__¥šs
 
__–isiÚ_d©a
.
__e¥šs


	)

118 
	#__–isiÚ
 
__–isiÚ_d©a
.
__–isiÚ


	)

119 
	#__PTHREAD_MUTEX_HAVE_ELISION
 2

	)

120 } 
	m__–isiÚ_d©a
;

121 
__±h»ad_¦i¡_t
 
	m__li¡
;

124 } 
	m__d©a
;

125 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

126 
	m__®ign
;

127 } 
	t±h»ad_mu‹x_t
;

131 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

132 
	m__®ign
;

133 } 
	t±h»ad_mu‹x©Œ_t
;

142 
	m__lock
;

143 
	m__fu‹x
;

144 
__ex‹nsiÚ__
 
	m__tÙ®_£q
;

145 
__ex‹nsiÚ__
 
	m__wakeup_£q
;

146 
__ex‹nsiÚ__
 
	m__wok’_£q
;

147 *
	m__mu‹x
;

148 
	m__nwa™”s
;

149 
	m__brßdÿ¡_£q
;

150 } 
	m__d©a
;

151 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

152 
__ex‹nsiÚ__
 
	m__®ign
;

153 } 
	t±h»ad_cÚd_t
;

157 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

158 
	m__®ign
;

159 } 
	t±h»ad_cÚd©Œ_t
;

163 
	t±h»ad_key_t
;

167 
	t±h»ad_Úû_t
;

170 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


175 #ifdeà
__x86_64__


178 
	m__lock
;

179 
	m__Ä_»ad”s
;

180 
	m__»ad”s_wakeup
;

181 
	m__wr™”_wakeup
;

182 
	m__Ä_»ad”s_queued
;

183 
	m__Ä_wr™”s_queued
;

184 
	m__wr™”
;

185 
	m__sh¬ed
;

186 
	m__·d1
;

187 
	m__·d2
;

190 
	m__æags
;

191 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

192 } 
	m__d©a
;

196 
	m__lock
;

197 
	m__Ä_»ad”s
;

198 
	m__»ad”s_wakeup
;

199 
	m__wr™”_wakeup
;

200 
	m__Ä_»ad”s_queued
;

201 
	m__Ä_wr™”s_queued
;

204 
	m__æags
;

205 
	m__sh¬ed
;

206 
	m__·d1
;

207 
	m__·d2
;

208 
	m__wr™”
;

209 } 
	m__d©a
;

211 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

212 
	m__®ign
;

213 } 
	t±h»ad_rwlock_t
;

217 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

218 
	m__®ign
;

219 } 
	t±h»ad_rwlock©Œ_t
;

223 #ifdeà
__USE_XOPEN2K


225 vŞ©
	t±h»ad_¥šlock_t
;

232 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

233 
	m__®ign
;

234 } 
	t±h»ad_b¬r›r_t
;

238 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

239 
	m__®ign
;

240 } 
	t±h»ad_b¬r›¿‰r_t
;

244 #iâdeà
__x86_64__


246 
	#__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
	`__»g·rm__
 (1)))

	)

	@/usr/include/bits/sigaction.h

19 #iâdeà
_SIGNAL_H


24 
	ssigaùiÚ


27 #ifdeà
__USE_POSIX199309


31 
__sighªdËr_t
 
	m§_hªdËr
;

33 (*
	m§_sigaùiÚ
è(, 
	msigšfo_t
 *, *);

35 
	m__sigaùiÚ_hªdËr
;

36 
	#§_hªdËr
 
__sigaùiÚ_hªdËr
.
§_hªdËr


	)

37 
	#§_sigaùiÚ
 
__sigaùiÚ_hªdËr
.
§_sigaùiÚ


	)

39 
__sighªdËr_t
 
	m§_hªdËr
;

43 
__sig£t_t
 
	m§_mask
;

46 
	m§_æags
;

49 (*
	m§_»¡Ü”
) ();

53 
	#SA_NOCLDSTOP
 1

	)

54 
	#SA_NOCLDWAIT
 2

	)

55 
	#SA_SIGINFO
 4

	)

57 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_MISC


58 
	#SA_ONSTACK
 0x08000000

	)

60 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN2K8


61 
	#SA_RESTART
 0x10000000

	)

62 
	#SA_NODEFER
 0x40000000

	)

64 
	#SA_RESETHAND
 0x80000000

	)

66 #ifdeà
__USE_MISC


67 
	#SA_INTERRUPT
 0x20000000

	)

70 
	#SA_NOMASK
 
SA_NODEFER


	)

71 
	#SA_ONESHOT
 
SA_RESETHAND


	)

72 
	#SA_STACK
 
SA_ONSTACK


	)

76 
	#SIG_BLOCK
 0

	)

77 
	#SIG_UNBLOCK
 1

	)

78 
	#SIG_SETMASK
 2

	)

	@/usr/include/bits/sigcontext.h

18 #iâdeà
_BITS_SIGCONTEXT_H


19 
	#_BITS_SIGCONTEXT_H
 1

	)

21 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
_SYS_UCONTEXT_H


25 
	#FP_XSTATE_MAGIC1
 0x46505853U

	)

26 
	#FP_XSTATE_MAGIC2
 0x46505845U

	)

27 
	#FP_XSTATE_MAGIC2_SIZE
 (
FP_XSTATE_MAGIC2
)

	)

29 
	s_åx_sw_by‹s


31 
__ušt32_t
 
	mmagic1
;

32 
__ušt32_t
 
	mex‹nded_size
;

33 
__ušt64_t
 
	mx¡©e_bv
;

34 
__ušt32_t
 
	mx¡©e_size
;

35 
__ušt32_t
 
	m·ddšg
[7];

38 
	s_å»g


40 
	msignifiÿnd
[4];

41 
	mexpÚ’t
;

44 
	s_åx»g


46 
	msignifiÿnd
[4];

47 
	mexpÚ’t
;

48 
	m·ddšg
[3];

51 
	s_xmm»g


53 
__ušt32_t
 
	m–em’t
[4];

58 #iâdeà
__x86_64__


60 
	s_å¡©e


63 
__ušt32_t
 
	mcw
;

64 
__ušt32_t
 
	msw
;

65 
__ušt32_t
 
	mg
;

66 
__ušt32_t
 
	moff
;

67 
__ušt32_t
 
	mcs£l
;

68 
__ušt32_t
 
	md©aoff
;

69 
__ušt32_t
 
	md©a£l
;

70 
_å»g
 
	m_¡
[8];

71 
	m¡©us
;

72 
	mmagic
;

75 
__ušt32_t
 
	m_fx¤_’v
[6];

76 
__ušt32_t
 
	mmxc¤
;

77 
__ušt32_t
 
	m»£rved
;

78 
_åx»g
 
	m_fx¤_¡
[8];

79 
_xmm»g
 
	m_xmm
[8];

80 
__ušt32_t
 
	m·ddšg
[56];

83 #iâdeà
sigcÚ‹xt_¡ruù


88 
	#sigcÚ‹xt_¡ruù
 
sigcÚ‹xt


	)

91 
	#X86_FXSR_MAGIC
 0x0000

	)

93 
	ssigcÚ‹xt


95 
	mgs
, 
	m__gsh
;

96 
	mfs
, 
	m__fsh
;

97 
	mes
, 
	m__esh
;

98 
	mds
, 
	m__dsh
;

99 
	medi
;

100 
	mesi
;

101 
	mebp
;

102 
	me¥
;

103 
	mebx
;

104 
	medx
;

105 
	mecx
;

106 
	m—x
;

107 
	mŒ­no
;

108 
	m”r
;

109 
	me
;

110 
	mcs
, 
	m__csh
;

111 
	meæags
;

112 
	me¥_©_sigÇl
;

113 
	mss
, 
	m__ssh
;

114 
_å¡©e
 * 
	må¡©e
;

115 
	mŞdmask
;

116 
	mü2
;

121 
	s_å¡©e


124 
__ušt16_t
 
	mcwd
;

125 
__ušt16_t
 
	mswd
;

126 
__ušt16_t
 
	máw
;

127 
__ušt16_t
 
	mfİ
;

128 
__ušt64_t
 
	mr
;

129 
__ušt64_t
 
	mrdp
;

130 
__ušt32_t
 
	mmxc¤
;

131 
__ušt32_t
 
	mmxü_mask
;

132 
_åx»g
 
	m_¡
[8];

133 
_xmm»g
 
	m_xmm
[16];

134 
__ušt32_t
 
	m·ddšg
[24];

137 
	ssigcÚ‹xt


139 
__ušt64_t
 
	mr8
;

140 
__ušt64_t
 
	mr9
;

141 
__ušt64_t
 
	mr10
;

142 
__ušt64_t
 
	mr11
;

143 
__ušt64_t
 
	mr12
;

144 
__ušt64_t
 
	mr13
;

145 
__ušt64_t
 
	mr14
;

146 
__ušt64_t
 
	mr15
;

147 
__ušt64_t
 
	mrdi
;

148 
__ušt64_t
 
	mrsi
;

149 
__ušt64_t
 
	mrbp
;

150 
__ušt64_t
 
	mrbx
;

151 
__ušt64_t
 
	mrdx
;

152 
__ušt64_t
 
	m¿x
;

153 
__ušt64_t
 
	mrcx
;

154 
__ušt64_t
 
	mr¥
;

155 
__ušt64_t
 
	mr
;

156 
__ušt64_t
 
	meæags
;

157 
	mcs
;

158 
	mgs
;

159 
	mfs
;

160 
	m__·d0
;

161 
__ušt64_t
 
	m”r
;

162 
__ušt64_t
 
	mŒ­no
;

163 
__ušt64_t
 
	mŞdmask
;

164 
__ušt64_t
 
	mü2
;

165 
__ex‹nsiÚ__
 union

167 
_å¡©e
 * 
	må¡©e
;

168 
__ušt64_t
 
	m__å¡©e_wÜd
;

170 
__ušt64_t
 
	m__»£rved1
 [8];

175 
	s_x§ve_hdr


177 
__ušt64_t
 
	mx¡©e_bv
;

178 
__ušt64_t
 
	m»£rved1
[2];

179 
__ušt64_t
 
	m»£rved2
[5];

182 
	s_ymmh_¡©e


184 
__ušt32_t
 
	mymmh_¥aû
[64];

187 
	s_x¡©e


189 
_å¡©e
 
	må¡©e
;

190 
_x§ve_hdr
 
	mx¡©e_hdr
;

191 
_ymmh_¡©e
 
	mymmh
;

	@/usr/include/bits/siginfo.h

19 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
__Ãed_sigšfo_t
 \

20 && !
defšed
 
	g__Ãed_sigev’t_t


24 
	~<b™s/wÜdsize.h
>

26 #ià(!
defšed
 
__have_sigv®_t
 \

27 && (
defšed
 
	g_SIGNAL_H
 || defšed 
	g__Ãed_sigšfo_t
 \

28 || 
defšed
 
	g__Ãed_sigev’t_t
))

29 
	#__have_sigv®_t
 1

	)

32 
	usigv®


34 
	msiv®_št
;

35 *
	msiv®_±r
;

36 } 
	tsigv®_t
;

39 #ià(!
defšed
 
__have_sigšfo_t
 \

40 && (
defšed
 
	g_SIGNAL_H
 || defšed 
	g__Ãed_sigšfo_t
))

41 
	#__have_sigšfo_t
 1

	)

43 
	#__SI_MAX_SIZE
 128

	)

44 #ià
__WORDSIZE
 == 64

45 
	#__SI_PAD_SIZE
 ((
__SI_MAX_SIZE
 /  ()è- 4)

	)

47 
	#__SI_PAD_SIZE
 ((
__SI_MAX_SIZE
 /  ()è- 3)

	)

50 #ià
defšed
 
__x86_64__
 && 
__WORDSIZE
 == 32

55 
__şock_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
 (4))è
	t__sigchld_şock_t
;

56 
	#__SI_ALIGNMENT
 
	`__©Œibu‹__
 ((
	`__®igÃd__
 (8)))

	)

58 
__şock_t
 
	t__sigchld_şock_t
;

59 
	#__SI_ALIGNMENT


	)

64 
si_signo
;

65 
si_”ºo
;

67 
si_code
;

71 
_·d
[
__SI_PAD_SIZE
];

76 
__pid_t
 
si_pid
;

77 
__uid_t
 
si_uid
;

78 } 
_kl
;

83 
si_tid
;

84 
si_ov”run
;

85 
sigv®_t
 
si_sigv®
;

86 } 
_tim”
;

91 
__pid_t
 
si_pid
;

92 
__uid_t
 
si_uid
;

93 
sigv®_t
 
si_sigv®
;

94 } 
_¹
;

99 
__pid_t
 
si_pid
;

100 
__uid_t
 
si_uid
;

101 
si_¡©us
;

102 
__sigchld_şock_t
 
si_utime
;

103 
__sigchld_şock_t
 
si_¡ime
;

104 } 
_sigchld
;

109 *
si_addr
;

110 } 
_sigçuÉ
;

115 
si_bªd
;

116 
si_fd
;

117 } 
_sigpŞl
;

122 *
_ÿÎ_addr
;

123 
_sysÿÎ
;

124 
_¬ch
;

125 } 
_sigsys
;

126 } 
_sif›lds
;

127 } 
	tsigšfo_t
 
	t__SI_ALIGNMENT
;

131 
	#si_pid
 
_sif›lds
.
_kl
.
si_pid


	)

132 
	#si_uid
 
_sif›lds
.
_kl
.
si_uid


	)

133 
	#si_tim”id
 
_sif›lds
.
_tim”
.
si_tid


	)

134 
	#si_ov”run
 
_sif›lds
.
_tim”
.
si_ov”run


	)

135 
	#si_¡©us
 
_sif›lds
.
_sigchld
.
si_¡©us


	)

136 
	#si_utime
 
_sif›lds
.
_sigchld
.
si_utime


	)

137 
	#si_¡ime
 
_sif›lds
.
_sigchld
.
si_¡ime


	)

138 
	#si_v®ue
 
_sif›lds
.
_¹
.
si_sigv®


	)

139 
	#si_št
 
_sif›lds
.
_¹
.
si_sigv®
.
siv®_št


	)

140 
	#si_±r
 
_sif›lds
.
_¹
.
si_sigv®
.
siv®_±r


	)

141 
	#si_addr
 
_sif›lds
.
_sigçuÉ
.
si_addr


	)

142 
	#si_bªd
 
_sif›lds
.
_sigpŞl
.
si_bªd


	)

143 
	#si_fd
 
_sif›lds
.
_sigpŞl
.
si_fd


	)

144 
	#si_ÿÎ_addr
 
_sif›lds
.
_sigsys
.
_ÿÎ_addr


	)

145 
	#si_sysÿÎ
 
_sif›lds
.
_sigsys
.
_sysÿÎ


	)

146 
	#si_¬ch
 
_sif›lds
.
_sigsys
.
_¬ch


	)

153 
SI_ASYNCNL
 = -60,

154 
	#SI_ASYNCNL
 
SI_ASYNCNL


	)

155 
SI_TKILL
 = -6,

156 
	#SI_TKILL
 
SI_TKILL


	)

157 
SI_SIGIO
,

158 
	#SI_SIGIO
 
SI_SIGIO


	)

159 
SI_ASYNCIO
,

160 
	#SI_ASYNCIO
 
SI_ASYNCIO


	)

161 
SI_MESGQ
,

162 
	#SI_MESGQ
 
SI_MESGQ


	)

163 
SI_TIMER
,

164 
	#SI_TIMER
 
SI_TIMER


	)

165 
SI_QUEUE
,

166 
	#SI_QUEUE
 
SI_QUEUE


	)

167 
SI_USER
,

168 
	#SI_USER
 
SI_USER


	)

169 
SI_KERNEL
 = 0x80

170 
	#SI_KERNEL
 
SI_KERNEL


	)

177 
ILL_ILLOPC
 = 1,

178 
	#ILL_ILLOPC
 
ILL_ILLOPC


	)

179 
ILL_ILLOPN
,

180 
	#ILL_ILLOPN
 
ILL_ILLOPN


	)

181 
ILL_ILLADR
,

182 
	#ILL_ILLADR
 
ILL_ILLADR


	)

183 
ILL_ILLTRP
,

184 
	#ILL_ILLTRP
 
ILL_ILLTRP


	)

185 
ILL_PRVOPC
,

186 
	#ILL_PRVOPC
 
ILL_PRVOPC


	)

187 
ILL_PRVREG
,

188 
	#ILL_PRVREG
 
ILL_PRVREG


	)

189 
ILL_COPROC
,

190 
	#ILL_COPROC
 
ILL_COPROC


	)

191 
ILL_BADSTK


192 
	#ILL_BADSTK
 
ILL_BADSTK


	)

198 
FPE_INTDIV
 = 1,

199 
	#FPE_INTDIV
 
FPE_INTDIV


	)

200 
FPE_INTOVF
,

201 
	#FPE_INTOVF
 
FPE_INTOVF


	)

202 
FPE_FLTDIV
,

203 
	#FPE_FLTDIV
 
FPE_FLTDIV


	)

204 
FPE_FLTOVF
,

205 
	#FPE_FLTOVF
 
FPE_FLTOVF


	)

206 
FPE_FLTUND
,

207 
	#FPE_FLTUND
 
FPE_FLTUND


	)

208 
FPE_FLTRES
,

209 
	#FPE_FLTRES
 
FPE_FLTRES


	)

210 
FPE_FLTINV
,

211 
	#FPE_FLTINV
 
FPE_FLTINV


	)

212 
FPE_FLTSUB


213 
	#FPE_FLTSUB
 
FPE_FLTSUB


	)

219 
SEGV_MAPERR
 = 1,

220 
	#SEGV_MAPERR
 
SEGV_MAPERR


	)

221 
SEGV_ACCERR


222 
	#SEGV_ACCERR
 
SEGV_ACCERR


	)

228 
BUS_ADRALN
 = 1,

229 
	#BUS_ADRALN
 
BUS_ADRALN


	)

230 
BUS_ADRERR
,

231 
	#BUS_ADRERR
 
BUS_ADRERR


	)

232 
BUS_OBJERR


233 
	#BUS_OBJERR
 
BUS_OBJERR


	)

239 
TRAP_BRKPT
 = 1,

240 
	#TRAP_BRKPT
 
TRAP_BRKPT


	)

241 
TRAP_TRACE


242 
	#TRAP_TRACE
 
TRAP_TRACE


	)

248 
CLD_EXITED
 = 1,

249 
	#CLD_EXITED
 
CLD_EXITED


	)

250 
CLD_KILLED
,

251 
	#CLD_KILLED
 
CLD_KILLED


	)

252 
CLD_DUMPED
,

253 
	#CLD_DUMPED
 
CLD_DUMPED


	)

254 
CLD_TRAPPED
,

255 
	#CLD_TRAPPED
 
CLD_TRAPPED


	)

256 
CLD_STOPPED
,

257 
	#CLD_STOPPED
 
CLD_STOPPED


	)

258 
CLD_CONTINUED


259 
	#CLD_CONTINUED
 
CLD_CONTINUED


	)

265 
POLL_IN
 = 1,

266 
	#POLL_IN
 
POLL_IN


	)

267 
POLL_OUT
,

268 
	#POLL_OUT
 
POLL_OUT


	)

269 
POLL_MSG
,

270 
	#POLL_MSG
 
POLL_MSG


	)

271 
POLL_ERR
,

272 
	#POLL_ERR
 
POLL_ERR


	)

273 
POLL_PRI
,

274 
	#POLL_PRI
 
POLL_PRI


	)

275 
POLL_HUP


276 
	#POLL_HUP
 
POLL_HUP


	)

279 #undeà
__Ãed_sigšfo_t


283 #ià(
defšed
 
_SIGNAL_H
 || defšed 
__Ãed_sigev’t_t
) \

284 && !
defšed
 
__have_sigev’t_t


285 
	#__have_sigev’t_t
 1

	)

288 
	#__SIGEV_MAX_SIZE
 64

	)

289 #ià
__WORDSIZE
 == 64

290 
	#__SIGEV_PAD_SIZE
 ((
__SIGEV_MAX_SIZE
 /  ()è- 4)

	)

292 
	#__SIGEV_PAD_SIZE
 ((
__SIGEV_MAX_SIZE
 /  ()è- 3)

	)

296 #iâdeà
__have_±h»ad_©Œ_t


297 
±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

298 
	#__have_±h»ad_©Œ_t
 1

	)

301 
	ssigev’t


303 
sigv®_t
 
sigev_v®ue
;

304 
sigev_signo
;

305 
sigev_nÙify
;

309 
_·d
[
__SIGEV_PAD_SIZE
];

313 
__pid_t
 
_tid
;

317 (*
_funùiÚ
è(
sigv®_t
);

318 
±h»ad_©Œ_t
 *
_©Œibu‹
;

319 } 
_sigev_th»ad
;

320 } 
_sigev_un
;

321 } 
	tsigev’t_t
;

324 
	#sigev_nÙify_funùiÚ
 
_sigev_un
.
_sigev_th»ad
.
_funùiÚ


	)

325 
	#sigev_nÙify_©Œibu‹s
 
_sigev_un
.
_sigev_th»ad
.
_©Œibu‹


	)

330 
SIGEV_SIGNAL
 = 0,

331 
	#SIGEV_SIGNAL
 
SIGEV_SIGNAL


	)

332 
SIGEV_NONE
,

333 
	#SIGEV_NONE
 
SIGEV_NONE


	)

334 
SIGEV_THREAD
,

335 
	#SIGEV_THREAD
 
SIGEV_THREAD


	)

337 
SIGEV_THREAD_ID
 = 4

338 
	#SIGEV_THREAD_ID
 
SIGEV_THREAD_ID


	)

	@/usr/include/bits/signum.h

19 #ifdef 
_SIGNAL_H


22 
	#SIG_ERR
 ((
__sighªdËr_t
è-1è

	)

23 
	#SIG_DFL
 ((
__sighªdËr_t
è0è

	)

24 
	#SIG_IGN
 ((
__sighªdËr_t
è1è

	)

26 #ifdeà
__USE_UNIX98


27 
	#SIG_HOLD
 ((
__sighªdËr_t
è2è

	)

32 
	#SIGHUP
 1

	)

33 
	#SIGINT
 2

	)

34 
	#SIGQUIT
 3

	)

35 
	#SIGILL
 4

	)

36 
	#SIGTRAP
 5

	)

37 
	#SIGABRT
 6

	)

38 
	#SIGIOT
 6

	)

39 
	#SIGBUS
 7

	)

40 
	#SIGFPE
 8

	)

41 
	#SIGKILL
 9

	)

42 
	#SIGUSR1
 10

	)

43 
	#SIGSEGV
 11

	)

44 
	#SIGUSR2
 12

	)

45 
	#SIGPIPE
 13

	)

46 
	#SIGALRM
 14

	)

47 
	#SIGTERM
 15

	)

48 
	#SIGSTKFLT
 16

	)

49 
	#SIGCLD
 
SIGCHLD


	)

50 
	#SIGCHLD
 17

	)

51 
	#SIGCONT
 18

	)

52 
	#SIGSTOP
 19

	)

53 
	#SIGTSTP
 20

	)

54 
	#SIGTTIN
 21

	)

55 
	#SIGTTOU
 22

	)

56 
	#SIGURG
 23

	)

57 
	#SIGXCPU
 24

	)

58 
	#SIGXFSZ
 25

	)

59 
	#SIGVTALRM
 26

	)

60 
	#SIGPROF
 27

	)

61 
	#SIGWINCH
 28

	)

62 
	#SIGPOLL
 
SIGIO


	)

63 
	#SIGIO
 29

	)

64 
	#SIGPWR
 30

	)

65 
	#SIGSYS
 31

	)

66 
	#SIGUNUSED
 31

	)

68 
	#_NSIG
 65

	)

71 
	#SIGRTMIN
 (
	`__libc_cu¼’t_sig¹mš
 ())

	)

72 
	#SIGRTMAX
 (
	`__libc_cu¼’t_sig¹max
 ())

	)

76 
	#__SIGRTMIN
 32

	)

77 
	#__SIGRTMAX
 (
_NSIG
 - 1)

	)

	@/usr/include/bits/sigset.h

20 #iâdef 
_SIGSET_H_ty³s


21 
	#_SIGSET_H_ty³s
 1

	)

23 
	t__sig_©omic_t
;

27 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

30 
	m__v®
[
_SIGSET_NWORDS
];

31 } 
	t__sig£t_t
;

42 #ià!
defšed
 
_SIGSET_H_âs
 && defšed 
_SIGNAL_H


43 
	#_SIGSET_H_âs
 1

	)

45 #iâdeà
_EXTERN_INLINE


46 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

50 
	#__sigmask
(
sig
) \

51 (((è1è<< (((
sig
è- 1è% (8 *  ())))

	)

54 
	#__sigwÜd
(
sig
è(((sigè- 1è/ (8 *  ()))

	)

56 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

57 
	#__sigem±y£t
(
£t
) \

58 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

59 
sig£t_t
 *
__£t
 = (
£t
); \

60 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = 0; \

61 0; }))

	)

62 
	#__sigfl£t
(
£t
) \

63 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

64 
sig£t_t
 *
__£t
 = (
£t
); \

65 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = ~0UL; \

66 0; }))

	)

68 #ifdeà
__USE_GNU


72 
	#__sigi£m±y£t
(
£t
) \

73 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

74 cÚ¡ 
sig£t_t
 *
__£t
 = (
£t
); \

75 
__»t
 = 
__£t
->
__v®
[--
__út
]; \

76 !
__»t
 && --
__út
 >= 0) \

77 
__»t
 = 
__£t
->
__v®
[
__út
]; \

78 
__»t
 =ğ0; }))

	)

79 
	#__sigªd£t
(
de¡
, 
Ëá
, 
right
) \

80 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

81 
sig£t_t
 *
__de¡
 = (
de¡
); \

82 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

83 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

84 --
__út
 >= 0) \

85 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

86 & 
__right
->
__v®
[
__út
]); \

87 0; }))

	)

88 
	#__sigÜ£t
(
de¡
, 
Ëá
, 
right
) \

89 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

90 
sig£t_t
 *
__de¡
 = (
de¡
); \

91 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

92 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

93 --
__út
 >= 0) \

94 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

95 | 
__right
->
__v®
[
__út
]); \

96 0; }))

	)

103 
__sigismemb”
 (cÚ¡ 
__sig£t_t
 *, );

104 
__sigadd£t
 (
__sig£t_t
 *, );

105 
__sigd–£t
 (
__sig£t_t
 *, );

107 #ifdeà
__USE_EXTERN_INLINES


108 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

109 
_EXTERN_INLINE
 \

110 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

112 
__mask
 = 
	`__sigmask
 (
__sig
); \

113 
__wÜd
 = 
	`__sigwÜd
 (
__sig
); \

114  
BODY
; \

115 }

	)

117 
__SIGSETFN
 (
__sigismemb”
, (
__£t
->
__v®
[
__wÜd
] & 
__mask
) ? 1 : 0, const)

118 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__v®
[
__wÜd
] |ğ
__mask
), 0), )

119 
__SIGSETFN
 (
__sigd–£t
, ((
__£t
->
__v®
[
__wÜd
] &ğ~
__mask
), 0), )

121 #undeà
__SIGSETFN


	@/usr/include/bits/sigstack.h

19 #iâdeà
_SIGNAL_H


25 
	ssig¡ack


27 *
	mss_¥
;

28 
	mss_Ú¡ack
;

35 
	mSS_ONSTACK
 = 1,

36 
	#SS_ONSTACK
 
SS_ONSTACK


	)

37 
	mSS_DISABLE


38 
	#SS_DISABLE
 
SS_DISABLE


	)

42 
	#MINSIGSTKSZ
 2048

	)

45 
	#SIGSTKSZ
 8192

	)

49 
	ssig®t¡ack


51 *
	mss_¥
;

52 
	mss_æags
;

53 
size_t
 
	mss_size
;

54 } 
	t¡ack_t
;

	@/usr/include/bits/sigthread.h

19 #iâdeà
_BITS_SIGTHREAD_H


20 
	#_BITS_SIGTHREAD_H
 1

	)

22 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
_PTHREAD_H


30 
	$±h»ad_sigmask
 (
__how
,

31 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__Ãwmask
,

32 
__sig£t_t
 *
__»¡riù
 
__Şdmask
)
__THROW
;

35 
	$±h»ad_kl
 (
±h»ad_t
 
__th»adid
, 
__signo
è
__THROW
;

37 #ifdeà
__USE_GNU


39 
	$±h»ad_sigqueue
 (
±h»ad_t
 
__th»adid
, 
__signo
,

40 cÚ¡ 
sigv®
 
__v®ue
è
__THROW
;

	@/usr/include/bits/stdlib-float.h

19 #iâdeà
_STDLIB_H


23 #ifdeà
__USE_EXTERN_INLINES


24 
__BEGIN_NAMESPACE_STD


25 
__ex‹º_šlše
 

26 
__NTH
 (
	$©of
 (cÚ¡ *
__ÅŒ
))

28  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

29 
	}
}

30 
	g__END_NAMESPACE_STD


	@/usr/include/bits/stdlib-ldbl.h

19 #iâdeà
_STDLIB_H


23 #ifdef 
__USE_ISOC99


24 
__BEGIN_NAMESPACE_C99


25 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd
, 
¡¹od
)

26 
__END_NAMESPACE_C99


29 #ifdeà
__USE_GNU


30 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd_l
, 
¡¹od_l
)

33 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


34 #ifdeà
__USE_MISC


35 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

36 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

37 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

38 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

39 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

19 #iâdeà
_STDLIB_H


23 *
	$__»®·th_chk
 (cÚ¡ *
__»¡riù
 
__Çme
,

24 *
__»¡riù
 
__»sŞved
,

25 
size_t
 
__»sŞvedËn
è
__THROW
 
__wur
;

26 *
	`__REDIRECT_NTH
 (
__»®·th_®Ÿs
,

27 (cÚ¡ *
__»¡riù
 
__Çme
,

28 *
__»¡riù
 
__»sŞved
), 
»®·th
è
__wur
;

29 *
	`__REDIRECT_NTH
 (
__»®·th_chk_w¬n
,

30 (cÚ¡ *
__»¡riù
 
__Çme
,

31 *
__»¡riù
 
__»sŞved
,

32 
size_t
 
__»sŞvedËn
), 
__»®·th_chk
è
__wur


33 
	`__w¬Ç‰r
 ("second‡rgument of„ealpath must beƒither NULL or‡t "

36 
__fÜtify_funùiÚ
 
__wur
 *

37 
	`__NTH
 (
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
, *__»¡riù 
__»sŞved
))

39 ià(
	`__bos
 (
__»sŞved
è!ğ(
size_t
) -1)

41 #ià
defšed
 
_LIBC_LIMITS_H_
 && defšed 
PATH_MAX


42 ià(
	`__bos
 (
__»sŞved
è< 
PATH_MAX
)

43  
	`__»®·th_chk_w¬n
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

45  
	`__»®·th_chk
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

48  
	`__»®·th_®Ÿs
 (
__Çme
, 
__»sŞved
);

49 
	}
}

52 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

53 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

54 
	`__REDIRECT_NTH
 (
__±¢ame_r_®Ÿs
, (
__fd
, *
__buf
,

55 
size_t
 
__buæ’
), 
±¢ame_r
)

56 
	`__nÚnuÎ
 ((2));

57 
	`__REDIRECT_NTH
 (
__±¢ame_r_chk_w¬n
,

58 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

59 
size_t
 
__Ä—l
), 
__±¢ame_r_chk
)

60 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ptsname_r called with buflen biggerhan "

63 
__fÜtify_funùiÚ
 

64 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

66 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

68 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

69  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

70 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

71  
	`__±¢ame_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

73  
	`__±¢ame_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

74 
	}
}

77 
	$__wùomb_chk
 (*
__s
, 
wch¬_t
 
__wch¬
, 
size_t
 
__buæ’
)

78 
__THROW
 
__wur
;

79 
	`__REDIRECT_NTH
 (
__wùomb_®Ÿs
, (*
__s
, 
wch¬_t
 
__wch¬
),

80 
wùomb
è
__wur
;

82 
__fÜtify_funùiÚ
 
__wur
 

83 
	`__NTH
 (
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
))

88 
	#__STDLIB_MB_LEN_MAX
 16

	)

89 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__STDLIB_MB_LEN_MAX


92 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

93  
	`__wùomb_chk
 (
__s
, 
__wch¬
, 
	`__bos
 (__s));

94  
	`__wùomb_®Ÿs
 (
__s
, 
__wch¬
);

95 
	}
}

98 
size_t
 
	$__mb¡owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

99 cÚ¡ *
__»¡riù
 
__¤c
,

100 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

101 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_®Ÿs
,

102 (
wch¬_t
 *
__»¡riù
 
__d¡
,

103 cÚ¡ *
__»¡riù
 
__¤c
,

104 
size_t
 
__Ën
), 
mb¡owcs
);

105 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_chk_w¬n
,

106 (
wch¬_t
 *
__»¡riù
 
__d¡
,

107 cÚ¡ *
__»¡riù
 
__¤c
,

108 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__mb¡owcs_chk
)

109 
	`__w¬Ç‰r
 ("mbstowcs called with dst buffer smallerhan†en "

112 
__fÜtify_funùiÚ
 
size_t


113 
	`__NTH
 (
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, cÚ¡ *__»¡riù 
__¤c
,

114 
size_t
 
__Ën
))

116 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

118 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

119  
	`__mb¡owcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
,

120 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

122 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

123  
	`__mb¡owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
,

124 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

126  
	`__mb¡owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

127 
	}
}

130 
size_t
 
	$__wc¡ombs_chk
 (*
__»¡riù
 
__d¡
,

131 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

132 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

133 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_®Ÿs
,

134 (*
__»¡riù
 
__d¡
,

135 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

136 
size_t
 
__Ën
), 
wc¡ombs
);

137 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_chk_w¬n
,

138 (*
__»¡riù
 
__d¡
,

139 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

140 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__wc¡ombs_chk
)

141 
	`__w¬Ç‰r
 ("wcstombs called with dst buffer smallerhan†en");

143 
__fÜtify_funùiÚ
 
size_t


144 
	`__NTH
 (
	$wc¡ombs
 (*
__»¡riù
 
__d¡
, cÚ¡ 
wch¬_t
 *__»¡riù 
__¤c
,

145 
size_t
 
__Ën
))

147 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

149 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

150  
	`__wc¡ombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

151 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

152  
	`__wc¡ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

154  
	`__wc¡ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

155 
	}
}

	@/usr/include/bits/string.h

19 #iâdeà
_STRING_H


24 
	#_STRING_ARCH_uÇligÃd
 1

	)

28 #ià!
defšed
 
__x86_64__
 && (defšed 
__i486__
 || defšed 
__³Áium__
 \

29 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

30 || 
defšed
 
	g__nocÚa__
 || defšed 
	g__©om__
 \

31 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__cÜei7__
 \

32 || 
defšed
 
	g__k6__
 || defšed 
	g__geode__
 \

33 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

34 || 
defšed
 
	g__amdçm10__
)

38 #ià!
defšed
 
__NO_STRING_INLINES
 && defšed 
__USE_STRING_INLINES
 \

39 && 
defšed
 
	g__GNUC__
 && __GNUC__ >ğ2 && !
__BOUNDED_POINTERS__


41 #iâdeà
__STRING_INLINE


42 #iâdeà
__ex‹º_šlše


43 
	#__STRING_INLINE
 
šlše


	)

45 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

50 
	#__STRING_SMALL_GET16
(
¤c
, 
idx
) \

51 ((((cÚ¡ *è(
¤c
))[
idx
 + 1] << 8) \

52 | ((cÚ¡ *è(
¤c
))[
idx
])

	)

53 
	#__STRING_SMALL_GET32
(
¤c
, 
idx
) \

54 (((((cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

55 | ((cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

56 | ((cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

57 | ((cÚ¡ *è(
¤c
))[
idx
])

	)

61 
	#_HAVE_STRING_ARCH_memıy
 1

	)

62 
	#memıy
(
de¡
, 
¤c
, 
n
) \

63 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) \

64 ? 
	`__memıy_c
 ((
de¡
), (
¤c
), (
n
)) \

65 : 
	`__memıy_g
 ((
de¡
), (
¤c
), (
n
))))

	)

66 
	#__memıy_c
(
de¡
, 
¤c
, 
n
) \

67 ((
n
) == 0 \

68 ? (
de¡
) \

69 : (((
n
) % 4 == 0) \

70 ? 
	`__memıy_by4
 (
de¡
, 
¤c
, 
n
) \

71 : (((
n
) % 2 == 0) \

72 ? 
	`__memıy_by2
 (
de¡
, 
¤c
, 
n
) \

73 : 
	`__memıy_g
 (
de¡
, 
¤c
, 
n
))))

	)

75 
__STRING_INLINE
 *
__memıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
,

76 
size_t
 
__n
);

78 
__STRING_INLINE
 *

79 
	$__memıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

81 
__d0
, 
__d1
;

82 *
__tmp
 = 
__de¡
;

83 
__asm__
 
__vŞ©e__


91 : "=&r" (
__d0
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

92 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
 / 4)

94  
__de¡
;

95 
	}
}

97 
__STRING_INLINE
 *
__memıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
,

98 
size_t
 
__n
);

100 
__STRING_INLINE
 *

101 
	$__memıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

103 
__d0
, 
__d1
;

104 *
__tmp
 = 
__de¡
;

105 
__asm__
 
__vŞ©e__


118 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

119 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
 / 2)

121  
__de¡
;

122 
	}
}

124 
__STRING_INLINE
 *
__memıy_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
);

126 
__STRING_INLINE
 *

127 
	$__memıy_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

129 
__d0
, 
__d1
, 
__d2
;

130 *
__tmp
 = 
__de¡
;

131 
__asm__
 
__vŞ©e__


142 : "=&c" (
__d0
), "=&D" (
__d1
), "=&S" (
__d2
),

143 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

144 : "0" (
__n
), "1" (
__tmp
), "2" (
__¤c
),

145 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
)

147  
__de¡
;

148 
	}
}

150 
	#_HAVE_STRING_ARCH_memmove
 1

	)

151 #iâdeà
_FORCE_INLINES


154 
	#memmove
(
de¡
, 
¤c
, 
n
è
	`__memmove_g
 (de¡, src,‚)

	)

156 
__STRING_INLINE
 *
	$__memmove_g
 (*, cÚ¡ *, 
size_t
)

157 
	`__asm__
 ("memmove");

159 
__STRING_INLINE
 *

160 
	$__memmove_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

162 
__d0
, 
__d1
, 
__d2
;

163 *
__tmp
 = 
__de¡
;

164 ià(
__de¡
 < 
__¤c
)

165 
__asm__
 
__vŞ©e__


168 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

169 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

170 : "0" (
__n
), "1" (
__¤c
), "2" (
__tmp
),

171 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
));

173 
__asm__
 
__vŞ©e__


177 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

178 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

179 : "0" (
__n
), "1" (__À- 1 + (cÚ¡ *è
__¤c
),

180 "2" (
__n
 - 1 + (*è
__tmp
),

181 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
));

182  
__de¡
;

183 
	}
}

187 
	#_HAVE_STRING_ARCH_memcmp
 1

	)

188 #iâdeà
_FORCE_INLINES


189 #iâdeà
__PIC__


191 
__STRING_INLINE
 

192 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

194 
__d0
, 
__d1
, 
__d2
;

195 
__»s
;

196 
__asm__
 
__vŞ©e__


204 : "=&a" (
__»s
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

205 : "0" (0), "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

206 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s1
),

207 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s2
)

209  
__»s
;

210 
	}
}

215 
	#_HAVE_STRING_ARCH_mem£t
 1

	)

216 
	#_USE_STRING_ARCH_mem£t
 1

	)

217 
	#mem£t
(
s
, 
c
, 
n
) \

218 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

219 ? ((
n
) == 1 \

220 ? 
	`__mem£t_c1
 ((
s
), (
c
)) \

221 : 
	`__mem£t_gc
 ((
s
), (
c
), (
n
))) \

222 : (
	`__butš_cÚ¡ªt_p
 (
c
) \

223 ? (
	`__butš_cÚ¡ªt_p
 (
n
) \

224 ? 
	`__mem£t_cú
 ((
s
), (
c
), (
n
)) \

225 : 
	`mem£t
 ((
s
), (
c
), (
n
))) \

226 : (
	`__butš_cÚ¡ªt_p
 (
n
) \

227 ? 
	`__mem£t_gú
 ((
s
), (
c
), (
n
)) \

228 : 
	`mem£t
 ((
s
), (
c
), (
n
))))))

	)

230 
	#__mem£t_c1
(
s
, 
c
è({ *
__s
 = (s); \

231 *((*è
__s
èğ(è(
c
); \

232 
__s
; })

	)

234 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

235 ({ *
__s
 = (
s
); \

237 
__ui
; \

238 
__usi
; \

239 
__uc
; \

240 } *
__u
 = 
__s
; \

241 
__c
 = ((è((è(
c
))) * 0x01010101; \

247 ià((
n
) == 3 || (n) >= 5) \

248 
__asm__
 
	`__vŞ©e__
 ("" : "ô" (
__c
) : "0" (__c)); \

251 
n
) \

254 
__u
->
__ui
 = 
__c
; \

255 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

257 
__u
->
__ui
 = 
__c
; \

258 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

260 
__u
->
__ui
 = 
__c
; \

261 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

263 
__u
->
__usi
 = (è
__c
; \

264 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

265 
__u
->
__uc
 = (è
__c
; \

269 
__u
->
__ui
 = 
__c
; \

270 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

272 
__u
->
__ui
 = 
__c
; \

273 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

275 
__u
->
__ui
 = 
__c
; \

276 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

278 
__u
->
__usi
 = (è
__c
; \

282 
__u
->
__ui
 = 
__c
; \

283 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

285 
__u
->
__ui
 = 
__c
; \

286 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

288 
__u
->
__ui
 = 
__c
; \

289 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

291 
__u
->
__uc
 = (è
__c
; \

295 
__u
->
__ui
 = 
__c
; \

296 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

298 
__u
->
__ui
 = 
__c
; \

299 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

301 
__u
->
__ui
 = 
__c
; \

302 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

304 
__u
->
__ui
 = 
__c
; \

309 
__s
; })

	)

311 
	#__mem£t_cú
(
s
, 
c
, 
n
) \

312 (((
n
) % 4 == 0) \

313 ? 
	`__mem£t_cú_by4
 (
s
, ((è((è(
c
))) * 0x01010101,\

314 
n
) \

315 : (((
n
) % 2 == 0) \

316 ? 
	`__mem£t_cú_by2
 (
s
, \

317 ((è((è(
c
))) * 0x01010101,\

318 
n
) \

319 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

321 
__STRING_INLINE
 *
__mem£t_cú_by4
 (*
__s
, 
__c
,

322 
size_t
 
__n
);

324 
__STRING_INLINE
 *

325 
	$__mem£t_cú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

327 *
__tmp
 = 
__s
;

328 
__d0
;

329 #ifdeà
__i686__


330 
__asm__
 
__vŞ©e__


333 : "=&a" (
__c
), "=&D" (
__tmp
), "=&c" (
__d0
),

334 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

335 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

338 
__asm__
 
__vŞ©e__


344 : "=&r" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

345 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

346 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

349  
__s
;

350 
	}
}

352 
__STRING_INLINE
 *
__mem£t_cú_by2
 (*
__s
, 
__c
,

353 
size_t
 
__n
);

355 
__STRING_INLINE
 *

356 
	$__mem£t_cú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

358 
__d0
, 
__d1
;

359 *
__tmp
 = 
__s
;

360 #ifdeà
__i686__


361 
__asm__
 
__vŞ©e__


365 : "=&a" (
__d0
), "=&D" (
__tmp
), "=&c" (
__d1
),

366 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

367 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

370 
__asm__
 
__vŞ©e__


376 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

377 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

378 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

381  
__s
;

382 
	}
}

384 
	#__mem£t_gú
(
s
, 
c
, 
n
) \

385 (((
n
) % 4 == 0) \

386 ? 
	`__mem£t_gú_by4
 (
s
, 
c
, 
n
) \

387 : (((
n
) % 2 == 0) \

388 ? 
	`__mem£t_gú_by2
 (
s
, 
c
, 
n
) \

389 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

391 
__STRING_INLINE
 *
__mem£t_gú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
);

393 
__STRING_INLINE
 *

394 
	$__mem£t_gú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

396 *
__tmp
 = 
__s
;

397 
__d0
;

398 
__asm__
 
__vŞ©e__


408 : "=&q" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

409 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

410 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

412  
__s
;

413 
	}
}

415 
__STRING_INLINE
 *
__mem£t_gú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
);

417 
__STRING_INLINE
 *

418 
	$__mem£t_gú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

420 
__d0
, 
__d1
;

421 *
__tmp
 = 
__s
;

422 
__asm__
 
__vŞ©e__


433 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

434 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

435 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

437  
__s
;

438 
	}
}

442 
	#_HAVE_STRING_ARCH_memchr
 1

	)

443 #iâdeà
_FORCE_INLINES


444 
__STRING_INLINE
 *

445 
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

447 
__d0
;

448 #ifdeà
__i686__


449 
__d1
;

451 *
__»s
;

452 ià(
__n
 == 0)

453  
NULL
;

454 #ifdeà
__i686__


455 
__asm__
 
__vŞ©e__


459 : "=D" (
__»s
), "=&c" (
__d0
), "=&r" (
__d1
)

460 : "a" (
__c
), "0" (
__s
), "1" (
__n
), "2" (1),

461 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

464 
__asm__
 
__vŞ©e__


470 : "=D" (
__»s
), "=&c" (
__d0
)

471 : "a" (
__c
), "0" (
__s
), "1" (
__n
),

472 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

475  
__»s
 - 1;

476 
	}
}

479 
	#_HAVE_STRING_ARCH_memrchr
 1

	)

480 #iâdeà
_FORCE_INLINES


481 
__STRING_INLINE
 *
__memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
);

483 
__STRING_INLINE
 *

484 
	$__memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

486 
__d0
;

487 #ifdeà
__i686__


488 
__d1
;

490 *
__»s
;

491 ià(
__n
 == 0)

492  
NULL
;

493 #ifdeà
__i686__


494 
__asm__
 
__vŞ©e__


500 : "=D" (
__»s
), "=&c" (
__d0
), "=&r" (
__d1
)

501 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n), "2" (-1),

502 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

505 
__asm__
 
__vŞ©e__


512 : "=D" (
__»s
), "=&c" (
__d0
)

513 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n),

514 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

517  
__»s
;

518 
	}
}

519 #ifdeà
__USE_GNU


520 
	#memrchr
(
s
, 
c
, 
n
è
	`__memrchr
 ((s), (c), (n))

	)

525 
	#_HAVE_STRING_ARCH_¿wmemchr
 1

	)

526 
__STRING_INLINE
 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

528 #iâdeà
_FORCE_INLINES


529 
__STRING_INLINE
 *

530 
	$__¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

532 
__d0
;

533 *
__»s
;

534 
__asm__
 
__vŞ©e__


537 : "=D" (
__»s
), "=&c" (
__d0
)

538 : "a" (
__c
), "0" (
__s
), "1" (0xffffffff),

539 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

541  
__»s
 - 1;

542 
	}
}

543 #ifdeà
__USE_GNU


544 
__STRING_INLINE
 *

545 
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

547  
	`__¿wmemchr
 (
__s
, 
__c
);

548 
	}
}

554 
	#_HAVE_STRING_ARCH_¡¾’
 1

	)

555 
	#¡¾’
(
¡r
) \

556 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¡r
) \

557 ? 
	`__butš_¡¾’
 (
¡r
) \

558 : 
	`__¡¾’_g
 (
¡r
)))

	)

559 
__STRING_INLINE
 
size_t
 
__¡¾’_g
 (cÚ¡ *
__¡r
);

561 
__STRING_INLINE
 
size_t


562 
	$__¡¾’_g
 (cÚ¡ *
__¡r
)

564 
__dummy
;

565 cÚ¡ *
__tmp
 = 
__¡r
;

566 
__asm__
 
__vŞ©e__


572 : "ô" (
__tmp
), "=&q" (
__dummy
)

573 : "0" (
__¡r
),

574 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¡r
)

576  
__tmp
 - 
__¡r
 - 1;

577 
	}
}

581 
	#_HAVE_STRING_ARCH_¡rıy
 1

	)

582 
	#¡rıy
(
de¡
, 
¤c
) \

583 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

584 ? ( ((
¤c
)[0]è=ğ1 && 
	`¡¾’
 (src) + 1 <= 8 \

585 ? 
	`__¡rıy_a_sm®l
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

586 : (*è
	`memıy
 ((*è(
de¡
), \

587 (cÚ¡ *è(
¤c
), \

588 
	`¡¾’
 (
¤c
) + 1)) \

589 : 
	`__¡rıy_g
 ((
de¡
), (
¤c
))))

	)

591 
	#__¡rıy_a_sm®l
(
de¡
, 
¤c
, 
¤ş’
) \

592 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

594 
__ui
; \

595 
__usi
; \

596 
__uc
; \

597 
__c
; \

598 } *
__u
 = (*è
__de¡
; \

599 
¤ş’
) \

602 
__u
->
__uc
 = '\0'; \

605 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

608 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

609 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

610 
__u
->
__uc
 = '\0'; \

613 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

616 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

617 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

618 
__u
->
__uc
 = '\0'; \

621 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

622 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

623 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

626 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

627 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

628 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

629 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

630 
__u
->
__uc
 = '\0'; \

633 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

634 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

635 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 4); \

638 (*è
__de¡
; }))

	)

640 
__STRING_INLINE
 *
__¡rıy_g
 (*
__de¡
, cÚ¡ *
__¤c
);

642 
__STRING_INLINE
 *

643 
	$__¡rıy_g
 (*
__de¡
, cÚ¡ *
__¤c
)

645 *
__tmp
 = 
__de¡
;

646 
__dummy
;

647 
__asm__
 
__vŞ©e__


656 : "=&r" (
__¤c
), "=&r" (
__tmp
), "=&q" (
__dummy
),

657 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

658 : "0" (
__¤c
), "1" (
__tmp
),

659 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

661  
__de¡
;

662 
	}
}

665 #ifdeà
__USE_GNU


666 
	#_HAVE_STRING_ARCH_¡pıy
 1

	)

668 
	#__¡pıy
(
de¡
, 
¤c
) \

669 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

670 ? (
	`¡¾’
 (
¤c
) + 1 <= 8 \

671 ? 
	`__¡pıy_a_sm®l
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

672 : 
	`__¡pıy_c
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1)) \

673 : 
	`__¡pıy_g
 ((
de¡
), (
¤c
))))

	)

674 
	#__¡pıy_c
(
de¡
, 
¤c
, 
¤ş’
) \

675 ((
¤ş’
) % 4 == 0 \

676 ? 
	`__mempıy_by4
 (
de¡
, 
¤c
, 
¤ş’
) - 1 \

677 : ((
¤ş’
) % 2 == 0 \

678 ? 
	`__mempıy_by2
 (
de¡
, 
¤c
, 
¤ş’
) - 1 \

679 : 
	`__mempıy_byn
 (
de¡
, 
¤c
, 
¤ş’
è- 1))

	)

682 
	#¡pıy
(
de¡
, 
¤c
è
	`__¡pıy
 ((de¡), (¤c))

	)

684 
	#__¡pıy_a_sm®l
(
de¡
, 
¤c
, 
¤ş’
) \

685 (
	`__ex‹nsiÚ__
 ({ union { \

686 
__ui
; \

687 
__usi
; \

688 
__uc
; \

689 
__c
; \

690 } *
__u
 = (*è(
de¡
); \

691 
¤ş’
) \

694 
__u
->
__uc
 = '\0'; \

697 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

698 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1); \

701 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

702 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

703 
__u
->
__uc
 = '\0'; \

706 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

707 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3); \

710 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

711 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

712 
__u
->
__uc
 = '\0'; \

715 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

716 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

717 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

718 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1); \

721 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

722 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

723 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

724 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

725 
__u
->
__uc
 = '\0'; \

728 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

729 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

730 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 4); \

731 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3); \

734 (*è
__u
; }))

	)

736 
__STRING_INLINE
 *
__mempıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
,

737 
size_t
 
__¤ş’
);

739 
__STRING_INLINE
 *

740 
	$__mempıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

742 *
__tmp
 = 
__de¡
;

743 
__d0
, 
__d1
;

744 
__asm__
 
__vŞ©e__


752 : "=&r" (
__d0
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

753 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 4)

755  
__tmp
;

756 
	}
}

758 
__STRING_INLINE
 *
__mempıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
,

759 
size_t
 
__¤ş’
);

761 
__STRING_INLINE
 *

762 
	$__mempıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

764 *
__tmp
 = 
__de¡
;

765 
__d0
, 
__d1
;

766 
__asm__
 
__vŞ©e__


779 : "=&q" (
__d0
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
),

780 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

781 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 2),

782 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

784  
__tmp
 + 2;

785 
	}
}

787 
__STRING_INLINE
 *
__mempıy_byn
 (*
__de¡
, cÚ¡ *
__¤c
,

788 
size_t
 
__¤ş’
);

790 
__STRING_INLINE
 *

791 
	$__mempıy_byn
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

793 
__d0
, 
__d1
;

794 *
__tmp
 = 
__de¡
;

795 
__asm__
 
__vŞ©e__


806 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

807 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

808 : "0" (
__tmp
), "1" (
__¤ş’
), "2" (
__¤c
),

809 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

811  
__tmp
;

812 
	}
}

814 
__STRING_INLINE
 *
__¡pıy_g
 (*
__de¡
, cÚ¡ *
__¤c
);

816 
__STRING_INLINE
 *

817 
	$__¡pıy_g
 (*
__de¡
, cÚ¡ *
__¤c
)

819 *
__tmp
 = 
__de¡
;

820 
__dummy
;

821 
__asm__
 
__vŞ©e__


830 : "=&r" (
__¤c
), "ô" (
__tmp
), "=&q" (
__dummy
),

831 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

832 : "0" (
__¤c
), "1" (
__tmp
),

833 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

835  
__tmp
 - 1;

836 
	}
}

841 
	#_HAVE_STRING_ARCH_¡ºıy
 1

	)

842 
	#¡ºıy
(
de¡
, 
¤c
, 
n
) \

843 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

844 ? ((
	`¡¾’
 (
¤c
è+ 1 >ğ((
size_t
è(
n
)) \

845 ? (*è
	`memıy
 ((*è(
de¡
), \

846 (cÚ¡ *è(
¤c
), 
n
) \

847 : 
	`__¡ºıy_cg
 ((
de¡
), (
¤c
), 
	`¡¾’
 (¤cè+ 1, 
n
))) \

848 : 
	`__¡ºıy_gg
 ((
de¡
), (
¤c
), 
n
)))

	)

849 
	#__¡ºıy_cg
(
de¡
, 
¤c
, 
¤ş’
, 
n
) \

850 (((
¤ş’
) % 4 == 0) \

851 ? 
	`__¡ºıy_by4
 (
de¡
, 
¤c
, 
¤ş’
, 
n
) \

852 : (((
¤ş’
) % 2 == 0) \

853 ? 
	`__¡ºıy_by2
 (
de¡
, 
¤c
, 
¤ş’
, 
n
) \

854 : 
	`__¡ºıy_byn
 (
de¡
, 
¤c
, 
¤ş’
, 
n
)))

	)

856 
__STRING_INLINE
 *
__¡ºıy_by4
 (*
__de¡
, cÚ¡ 
__¤c
[],

857 
size_t
 
__¤ş’
, size_ˆ
__n
);

859 
__STRING_INLINE
 *

860 
	$__¡ºıy_by4
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

862 *
__tmp
 = 
__de¡
;

863 
__dummy1
, 
__dummy2
;

864 
__asm__
 
__vŞ©e__


872 : "=&r" (
__dummy1
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__dummy2
),

873 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

874 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 4),

875 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

877 (è
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__¤ş’
);

878  
__de¡
;

879 
	}
}

881 
__STRING_INLINE
 *
__¡ºıy_by2
 (*
__de¡
, cÚ¡ 
__¤c
[],

882 
size_t
 
__¤ş’
, size_ˆ
__n
);

884 
__STRING_INLINE
 *

885 
	$__¡ºıy_by2
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

887 *
__tmp
 = 
__de¡
;

888 
__dummy1
, 
__dummy2
;

889 
__asm__
 
__vŞ©e__


902 : "=&q" (
__dummy1
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__dummy2
),

903 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

904 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 2),

905 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

907 (è
	`mem£t
 (
__tmp
 + 2, '\0', 
__n
 - 
__¤ş’
);

908  
__de¡
;

909 
	}
}

911 
__STRING_INLINE
 *
__¡ºıy_byn
 (*
__de¡
, cÚ¡ 
__¤c
[],

912 
size_t
 
__¤ş’
, size_ˆ
__n
);

914 
__STRING_INLINE
 *

915 
	$__¡ºıy_byn
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

917 
__d0
, 
__d1
;

918 *
__tmp
 = 
__de¡
;

919 
__asm__
 
__vŞ©e__


930 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

931 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

932 : "1" (
__¤ş’
), "0" (
__tmp
),"2" (
__¤c
),

933 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

935 (è
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__¤ş’
);

936  
__de¡
;

937 
	}
}

939 
__STRING_INLINE
 *
__¡ºıy_gg
 (*
__de¡
, cÚ¡ *
__¤c
,

940 
size_t
 
__n
);

942 
__STRING_INLINE
 *

943 
	$__¡ºıy_gg
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

945 *
__tmp
 = 
__de¡
;

946 
__dummy
;

947 ià(
__n
 > 0)

948 
__asm__
 
__vŞ©e__


964 : "=&r" (
__¤c
), "=&r" (
__tmp
), "=&q" (
__dummy
), "=&r" (
__n
)

965 : "0" (
__¤c
), "1" (
__tmp
), "3" (
__n
)

968  
__de¡
;

969 
	}
}

973 
	#_HAVE_STRING_ARCH_¡rÿt
 1

	)

974 
	#¡rÿt
(
de¡
, 
¤c
) \

975 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

976 ? 
	`__¡rÿt_c
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

977 : 
	`__¡rÿt_g
 ((
de¡
), (
¤c
))))

	)

979 
__STRING_INLINE
 *
__¡rÿt_c
 (*
__de¡
, cÚ¡ 
__¤c
[],

980 
size_t
 
__¤ş’
);

982 
__STRING_INLINE
 *

983 
	$__¡rÿt_c
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
)

985 #ifdeà
__i686__


986 
__d0
;

987 *
__tmp
;

988 
__asm__
 
__vŞ©e__


990 : "=D" (
__tmp
), "=&c" (
__d0
),

991 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

992 : "0" (
__de¡
), "1" (0xffffffff), "a" (0),

993 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

995 --
__tmp
;

997 *
__tmp
 = 
__de¡
 - 1;

998 
__asm__
 
__vŞ©e__


1003 : "ô" (
__tmp
),

1004 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1005 : "0" (
__tmp
),

1006 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

1009 (è
	`memıy
 (
__tmp
, 
__¤c
, 
__¤ş’
);

1010  
__de¡
;

1011 
	}
}

1013 
__STRING_INLINE
 *
__¡rÿt_g
 (*
__de¡
, cÚ¡ *
__¤c
);

1015 
__STRING_INLINE
 *

1016 
	$__¡rÿt_g
 (*
__de¡
, cÚ¡ *
__¤c
)

1018 *
__tmp
 = 
__de¡
 - 1;

1019 
__dummy
;

1020 
__asm__
 
__vŞ©e__


1032 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__¤c
),

1033 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1034 : "1" (
__tmp
), "2" (
__¤c
),

1035 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

1037  
__de¡
;

1038 
	}
}

1042 
	#_HAVE_STRING_ARCH_¡ºÿt
 1

	)

1043 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

1044 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

1045 
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

1046 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

1047 ? 
	`¡rÿt
 (
__de¡
, (
¤c
)) \

1048 : (*(*)
	`__mempıy
 (
	`¡rchr
 (
__de¡
, '\0'), \

1049 (cÚ¡ *è(
¤c
), \

1050 (
n
)èğ0, 
__de¡
)) \

1051 : 
	`__¡ºÿt_g
 (
__de¡
, (
¤c
), (
n
)); }))

	)

1053 
__STRING_INLINE
 *
__¡ºÿt_g
 (*
__de¡
, cÚ¡ 
__¤c
[],

1054 
size_t
 
__n
);

1056 
__STRING_INLINE
 *

1057 
	$__¡ºÿt_g
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__n
)

1059 *
__tmp
 = 
__de¡
;

1060 
__dummy
;

1061 #ifdeà
__i686__


1062 
__asm__
 
__vŞ©e__


1076 : "=&a" (
__dummy
), "=&D" (
__tmp
), "=&S" (
__¤c
), "=&c" (
__n
)

1077 : "g" (
__n
), "0" (0), "1" (
__tmp
), "2" (
__¤c
), "3" (0xffffffff)

1080 --
__tmp
;

1081 
__asm__
 
__vŞ©e__


1098 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__n
)

1099 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
)

1102  
__de¡
;

1103 
	}
}

1107 
	#_HAVE_STRING_ARCH_¡rcmp
 1

	)

1108 
	#¡rcmp
(
s1
, 
s2
) \

1109 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

1110 && ( ((
s1
)[0]è!ğ1 || 
	`¡¾’
 (s1) >= 4) \

1111 && ( ((
s2
)[0]è!ğ1 || 
	`¡¾’
 (s2) >= 4) \

1112 ? 
	`memcmp
 ((cÚ¡ *è(
s1
), (cÚ¡ *è(
s2
), \

1113 (
	`¡¾’
 (
s1
è< sŒËÀ(
s2
) \

1114 ? 
	`¡¾’
 (
s1
è: sŒËÀ(
s2
)) + 1) \

1115 : (
	`__butš_cÚ¡ªt_p
 (
s1
) &&  ((s1)[0]) == 1 \

1116 &&  ((
s2
)[0]è=ğ1 && 
	`¡¾’
 (
s1
) < 4 \

1117 ? (
	`__butš_cÚ¡ªt_p
 (
s2
) &&  ((s2)[0]) == 1 \

1118 ? 
	`__¡rcmp_cc
 ((cÚ¡ *è(
s1
), \

1119 (cÚ¡ *è(
s2
), \

1120 
	`¡¾’
 (
s1
)) \

1121 : 
	`__¡rcmp_cg
 ((cÚ¡ *è(
s1
), \

1122 (cÚ¡ *è(
s2
), \

1123 
	`¡¾’
 (
s1
))) \

1124 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&&  ((
s1
)[0]) == 1 \

1125 &&  ((
s2
)[0]è=ğ1 && 
	`¡¾’
 (s2) < 4 \

1126 ? (
	`__butš_cÚ¡ªt_p
 (
s1
) \

1127 ? 
	`__¡rcmp_cc
 ((cÚ¡ *è(
s1
), \

1128 (cÚ¡ *è(
s2
), \

1129 
	`¡¾’
 (
s2
)) \

1130 : 
	`__¡rcmp_gc
 ((cÚ¡ *è(
s1
), \

1131 (cÚ¡ *è(
s2
), \

1132 
	`¡¾’
 (
s2
))) \

1133 : 
	`__¡rcmp_gg
 ((
s1
), (
s2
))))))

	)

1135 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

1136 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = (
s1
)[0] - (
s2
)[0]; \

1137 ià(
l
 > 0 && 
__»suÉ
 == 0) \

1139 
__»suÉ
 = (
s1
)[1] - (
s2
)[1]; \

1140 ià(
l
 > 1 && 
__»suÉ
 == 0) \

1142 
__»suÉ
 = (
s1
)[2] - (
s2
)[2]; \

1143 ià(
l
 > 2 && 
__»suÉ
 == 0) \

1144 
__»suÉ
 = (
s1
)[3] - (
s2
)[3]; \

1147 
__»suÉ
; }))

	)

1149 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

1150 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s2
 = (
s2
); \

1151 
__»suÉ
 = (
s1
)[0] - 
__s2
[0]; \

1152 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

1154 
__»suÉ
 = (
s1
)[1] - 
__s2
[1]; \

1155 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

1157 
__»suÉ
 = (
s1
)[2] - 
__s2
[2]; \

1158 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

1159 
__»suÉ
 = (
s1
)[3] - 
__s2
[3]; \

1162 
__»suÉ
; }))

	)

1164 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
) \

1165 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s1
 = (
s1
); \

1166 
__»suÉ
 = 
__s1
[0] - (
s2
)[0]; \

1167 ià(
l2
 > 0 && 
__»suÉ
 == 0) \

1169 
__»suÉ
 = 
__s1
[1] - (
s2
)[1]; \

1170 ià(
l2
 > 1 && 
__»suÉ
 == 0) \

1172 
__»suÉ
 = 
__s1
[2] - (
s2
)[2]; \

1173 ià(
l2
 > 2 && 
__»suÉ
 == 0) \

1174 
__»suÉ
 = 
__s1
[3] - (
s2
)[3]; \

1177 
__»suÉ
; }))

	)

1179 
__STRING_INLINE
 
__¡rcmp_gg
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
);

1181 
__STRING_INLINE
 

1182 
	$__¡rcmp_gg
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

1184 
__»s
;

1185 
__asm__
 
__vŞ©e__


1201 : "=q" (
__»s
), "=&r" (
__s1
), "=&r" (
__s2
)

1202 : "1" (
__s1
), "2" (
__s2
),

1203 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s1
),

1204 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s2
)

1206  
__»s
;

1207 
	}
}

1211 
	#_HAVE_STRING_ARCH_¡ºcmp
 1

	)

1212 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

1213 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`¡¾’
 (s1è< ((
size_t
è(
n
)) \

1214 ? 
	`¡rcmp
 ((
s1
), (
s2
)) \

1215 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`¡¾’
 (s2è< ((
size_t
è(
n
))\

1216 ? 
	`¡rcmp
 ((
s1
), (
s2
)) \

1217 : 
	`__¡ºcmp_g
 ((
s1
), (
s2
), (
n
)))))

	)

1219 
__STRING_INLINE
 
__¡ºcmp_g
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

1220 
size_t
 
__n
);

1222 
__STRING_INLINE
 

1223 
	$__¡ºcmp_g
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

1225 
__»s
;

1226 
__asm__
 
__vŞ©e__


1245 : "=q" (
__»s
), "=&r" (
__s1
), "=&r" (
__s2
), "=&r" (
__n
)

1246 : "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

1247 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s1
),

1248 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s2
)

1250  
__»s
;

1251 
	}
}

1255 
	#_HAVE_STRING_ARCH_¡rchr
 1

	)

1256 
	#_USE_STRING_ARCH_¡rchr
 1

	)

1257 
	#¡rchr
(
s
, 
c
) \

1258 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1259 ? ((
c
) == '\0' \

1260 ? (*è
	`__¿wmemchr
 ((
s
), (
c
)) \

1261 : 
	`__¡rchr_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1262 : 
	`__¡rchr_g
 ((
s
), (
c
))))

	)

1264 
__STRING_INLINE
 *
__¡rchr_c
 (cÚ¡ *
__s
, 
__c
);

1266 
__STRING_INLINE
 *

1267 
	$__¡rchr_c
 (cÚ¡ *
__s
, 
__c
)

1269 
__d0
;

1270 *
__»s
;

1271 
__asm__
 
__vŞ©e__


1281 : "ô" (
__»s
), "=&a" (
__d0
)

1282 : "0" (
__s
), "1" (
__c
),

1283 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1285  
__»s
;

1286 
	}
}

1288 
__STRING_INLINE
 *
__¡rchr_g
 (cÚ¡ *
__s
, 
__c
);

1290 
__STRING_INLINE
 *

1291 
	$__¡rchr_g
 (cÚ¡ *
__s
, 
__c
)

1293 
__d0
;

1294 *
__»s
;

1295 
__asm__
 
__vŞ©e__


1306 : "ô" (
__»s
), "=&a" (
__d0
)

1307 : "0" (
__s
), "1" (
__c
),

1308 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1310  
__»s
;

1311 
	}
}

1315 
	#_HAVE_STRING_ARCH_¡rchºul
 1

	)

1316 
	#__¡rchºul
(
s
, 
c
) \

1317 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1318 ? ((
c
) == '\0' \

1319 ? (*è
	`__¿wmemchr
 ((
s
), 
c
) \

1320 : 
	`__¡rchºul_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1321 : 
	`__¡rchºul_g
 ((
s
), 
c
)))

	)

1323 
__STRING_INLINE
 *
__¡rchºul_c
 (cÚ¡ *
__s
, 
__c
);

1325 
__STRING_INLINE
 *

1326 
	$__¡rchºul_c
 (cÚ¡ *
__s
, 
__c
)

1328 
__d0
;

1329 *
__»s
;

1330 
__asm__
 
__vŞ©e__


1340 : "ô" (
__»s
), "=&a" (
__d0
)

1341 : "0" (
__s
), "1" (
__c
),

1342 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1344  
__»s
;

1345 
	}
}

1347 
__STRING_INLINE
 *
__¡rchºul_g
 (cÚ¡ *
__s
, 
__c
);

1349 
__STRING_INLINE
 *

1350 
	$__¡rchºul_g
 (cÚ¡ *
__s
, 
__c
)

1352 
__d0
;

1353 *
__»s
;

1354 
__asm__
 
__vŞ©e__


1365 : "ô" (
__»s
), "=&a" (
__d0
)

1366 : "0" (
__s
), "1" (
__c
),

1367 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1369  
__»s
;

1370 
	}
}

1371 #ifdeà
__USE_GNU


1372 
	#¡rchºul
(
s
, 
c
è
	`__¡rchºul
 ((s), (c))

	)

1376 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1378 
	#_HAVE_STRING_ARCH_šdex
 1

	)

1379 
	#šdex
(
s
, 
c
) \

1380 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1381 ? 
	`__¡rchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1382 : 
	`__¡rchr_g
 ((
s
), (
c
))))

	)

1387 
	#_HAVE_STRING_ARCH_¡¼chr
 1

	)

1388 
	#¡¼chr
(
s
, 
c
) \

1389 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1390 ? 
	`__¡¼chr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1391 : 
	`__¡¼chr_g
 ((
s
), (
c
))))

	)

1393 #ifdeà
__i686__


1394 
__STRING_INLINE
 *
__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
);

1396 
__STRING_INLINE
 *

1397 
	$__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
)

1399 
__d0
, 
__d1
;

1400 *
__»s
;

1401 
__asm__
 
__vŞ©e__


1409 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1410 : "0" (1), "1" (
__s
), "2" (
__c
),

1411 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1413  
__»s
 - 1;

1414 
	}
}

1416 
__STRING_INLINE
 *
__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
);

1418 
__STRING_INLINE
 *

1419 
	$__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
)

1421 
__d0
, 
__d1
;

1422 *
__»s
;

1423 
__asm__
 
__vŞ©e__


1432 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1433 : "0" (1), "1" (
__s
), "2" (
__c
),

1434 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1436  
__»s
 - 1;

1437 
	}
}

1439 
__STRING_INLINE
 *
__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
);

1441 
__STRING_INLINE
 *

1442 
	$__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
)

1444 
__d0
, 
__d1
;

1445 *
__»s
;

1446 
__asm__
 
__vŞ©e__


1456 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1457 : "0" (0), "1" (
__s
), "2" (
__c
),

1458 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1460  
__»s
;

1461 
	}
}

1463 
__STRING_INLINE
 *
__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
);

1465 
__STRING_INLINE
 *

1466 
	$__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
)

1468 
__d0
, 
__d1
;

1469 *
__»s
;

1470 
__asm__
 
__vŞ©e__


1481 : "ô" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1482 : "0" (0), "1" (
__s
), "2" (
__c
),

1483 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1485  
__»s
;

1486 
	}
}

1490 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1492 
	#_HAVE_STRING_ARCH_ršdex
 1

	)

1493 
	#ršdex
(
s
, 
c
) \

1494 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1495 ? 
	`__¡¼chr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1496 : 
	`__¡¼chr_g
 ((
s
), (
c
))))

	)

1502 
	#_HAVE_STRING_ARCH_¡rc¥n
 1

	)

1503 
	#¡rc¥n
(
s
, 
»jeù
) \

1504 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
»jeù
) &&  ((reject)[0]) == 1 \

1505 ? ((
»jeù
)[0] == '\0' \

1506 ? 
	`¡¾’
 (
s
) \

1507 : ((
»jeù
)[1] == '\0' \

1508 ? 
	`__¡rc¥n_c1
 ((
s
), (((
»jeù
)[0] << 8) & 0xff00)) \

1509 : 
	`__¡rc¥n_cg
 ((
s
), (
»jeù
), 
	`¡¾’
 (reject)))) \

1510 : 
	`__¡rc¥n_g
 ((
s
), (
»jeù
))))

	)

1512 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
);

1514 #iâdeà
_FORCE_INLINES


1515 
__STRING_INLINE
 
size_t


1516 
	$__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
)

1518 
__d0
;

1519 *
__»s
;

1520 
__asm__
 
__vŞ©e__


1529 : "ô" (
__»s
), "=&a" (
__d0
)

1530 : "0" (
__s
), "1" (
__»jeù
),

1531 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1533  (
__»s
 - 1è- 
__s
;

1534 
	}
}

1537 
__STRING_INLINE
 
size_t
 
__¡rc¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__»jeù
[],

1538 
size_t
 
__»jeù_Ën
);

1540 
__STRING_INLINE
 
size_t


1541 
	$__¡rc¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__»jeù
[], 
size_t
 
__»jeù_Ën
)

1543 
__d0
, 
__d1
, 
__d2
;

1544 cÚ¡ *
__»s
;

1545 
__asm__
 
__vŞ©e__


1556 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1557 : "0" (
__s
), "d" (
__»jeù
), "g" (
__»jeù_Ën
)

1559  (
__»s
 - 1è- 
__s
;

1560 
	}
}

1562 
__STRING_INLINE
 
size_t
 
__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
);

1563 #ifdeà
__PIC__


1565 
__STRING_INLINE
 
size_t


1566 
	$__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

1568 
__d0
, 
__d1
, 
__d2
;

1569 cÚ¡ *
__»s
;

1570 
__asm__
 
__vŞ©e__


1587 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1588 : "r" (
__»jeù
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1590  (
__»s
 - 1è- 
__s
;

1591 
	}
}

1593 
__STRING_INLINE
 
size_t


1594 
	$__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

1596 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1597 cÚ¡ *
__»s
;

1598 
__asm__
 
__vŞ©e__


1612 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1613 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__»jeù
), "b" (__reject)

1616  (
__»s
 - 1è- 
__s
;

1617 
	}
}

1623 
	#_HAVE_STRING_ARCH_¡r¥n
 1

	)

1624 
	#¡r¥n
(
s
, 
acû±
) \

1625 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
acû±
) &&  ((accept)[0]) == 1 \

1626 ? ((
acû±
)[0] == '\0' \

1627 ? ((è(
s
), 0) \

1628 : ((
acû±
)[1] == '\0' \

1629 ? 
	`__¡r¥n_c1
 ((
s
), (((
acû±
)[0] << 8 ) & 0xff00)) \

1630 : 
	`__¡r¥n_cg
 ((
s
), (
acû±
), 
	`¡¾’
 (accept)))) \

1631 : 
	`__¡r¥n_g
 ((
s
), (
acû±
))))

	)

1633 #iâdeà
_FORCE_INLINES


1634 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
);

1636 
__STRING_INLINE
 
size_t


1637 
	$__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
)

1639 
__d0
;

1640 *
__»s
;

1642 
__asm__
 
__vŞ©e__


1648 : "ô" (
__»s
), "=&q" (
__d0
)

1649 : "0" (
__s
), "1" (
__acû±
),

1650 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1652  (
__»s
 - 1è- 
__s
;

1653 
	}
}

1656 
__STRING_INLINE
 
size_t
 
__¡r¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[],

1657 
size_t
 
__acû±_Ën
);

1659 
__STRING_INLINE
 
size_t


1660 
	$__¡r¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[], 
size_t
 
__acû±_Ën
)

1662 
__d0
, 
__d1
, 
__d2
;

1663 cÚ¡ *
__»s
;

1664 
__asm__
 
__vŞ©e__


1675 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1676 : "0" (
__s
), "g" (
__acû±
), "g" (
__acû±_Ën
),

1679 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
),

1680 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__acû±_Ën
]; } *)
__acû±
)

1682  (
__»s
 - 1è- 
__s
;

1683 
	}
}

1685 
__STRING_INLINE
 
size_t
 
__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
);

1686 #ifdeà
__PIC__


1688 
__STRING_INLINE
 
size_t


1689 
	$__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1691 
__d0
, 
__d1
, 
__d2
;

1692 cÚ¡ *
__»s
;

1693 
__asm__
 
__vŞ©e__


1709 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1710 : "d" (
__acû±
), "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (__accept)

1712  (
__»s
 - 1è- 
__s
;

1713 
	}
}

1715 
__STRING_INLINE
 
size_t


1716 
	$__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1718 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1719 cÚ¡ *
__»s
;

1720 
__asm__
 
__vŞ©e__


1734 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1735 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__acû±
), "b" (__accept)

1737  (
__»s
 - 1è- 
__s
;

1738 
	}
}

1743 
	#_HAVE_STRING_ARCH_¡½brk
 1

	)

1744 
	#¡½brk
(
s
, 
acû±
) \

1745 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
acû±
) &&  ((accept)[0]) == 1 \

1746 ? ((
acû±
)[0] == '\0' \

1747 ? ((è(
s
), (*) 0) \

1748 : ((
acû±
)[1] == '\0' \

1749 ? 
	`¡rchr
 ((
s
), (
acû±
)[0]) \

1750 : 
	`__¡½brk_cg
 ((
s
), (
acû±
), 
	`¡¾’
 (accept)))) \

1751 : 
	`__¡½brk_g
 ((
s
), (
acû±
))))

	)

1753 
__STRING_INLINE
 *
__¡½brk_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[],

1754 
size_t
 
__acû±_Ën
);

1756 
__STRING_INLINE
 *

1757 
	$__¡½brk_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[], 
size_t
 
__acû±_Ën
)

1759 
__d0
, 
__d1
, 
__d2
;

1760 *
__»s
;

1761 
__asm__
 
__vŞ©e__


1776 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1777 : "0" (
__s
), "d" (
__acû±
), "g" (
__acû±_Ën
)

1779  
__»s
;

1780 
	}
}

1782 
__STRING_INLINE
 *
__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
);

1783 #ifdeà
__PIC__


1785 
__STRING_INLINE
 *

1786 
	$__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1788 
__d0
, 
__d1
, 
__d2
;

1789 *
__»s
;

1790 
__asm__
 
__vŞ©e__


1811 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1812 : "d" (
__acû±
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1814  
__»s
;

1815 
	}
}

1817 
__STRING_INLINE
 *

1818 
	$__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1820 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1821 *
__»s
;

1822 
__asm__
 
__vŞ©e__


1841 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&d" (
__d2
), "=&D" (
__d3
)

1842 : "0" (
__s
), "1" (0), "2" (0xffffffff), "b" (
__acû±
)

1844  
__»s
;

1845 
	}
}

1850 
	#_HAVE_STRING_ARCH_¡r¡r
 1

	)

1851 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1852 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
ÃedË
) &&  ((needle)[0]) == 1 \

1853 ? ((
ÃedË
)[0] == '\0' \

1854 ? (
hay¡ack
) \

1855 : ((
ÃedË
)[1] == '\0' \

1856 ? 
	`¡rchr
 ((
hay¡ack
), (
ÃedË
)[0]) \

1857 : 
	`__¡r¡r_cg
 ((
hay¡ack
), (
ÃedË
), \

1858 
	`¡¾’
 (
ÃedË
)))) \

1859 : 
	`__¡r¡r_g
 ((
hay¡ack
), (
ÃedË
))))

	)

1863 
__STRING_INLINE
 *
__¡r¡r_cg
 (cÚ¡ *
__hay¡ack
,

1864 cÚ¡ 
__ÃedË
[],

1865 
size_t
 
__ÃedË_Ën
);

1867 
__STRING_INLINE
 *

1868 
	$__¡r¡r_cg
 (cÚ¡ *
__hay¡ack
, cÚ¡ 
__ÃedË
[],

1869 
size_t
 
__ÃedË_Ën
)

1871 
__d0
, 
__d1
, 
__d2
;

1872 *
__»s
;

1873 
__asm__
 
__vŞ©e__


1886 : "=&a" (
__»s
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

1887 : "g" (
__ÃedË_Ën
), "1" (
__hay¡ack
), "d" (
__ÃedË
)

1889  
__»s
;

1890 
	}
}

1892 
__STRING_INLINE
 *
__¡r¡r_g
 (cÚ¡ *
__hay¡ack
,

1893 cÚ¡ *
__ÃedË
);

1894 #ifdeà
__PIC__


1896 
__STRING_INLINE
 *

1897 
	$__¡r¡r_g
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

1899 
__d0
, 
__d1
, 
__d2
;

1900 *
__»s
;

1901 
__asm__
 
__vŞ©e__


1920 : "=&a" (
__»s
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
)

1921 : "0" (0), "1" (0xffffffff), "2" (
__hay¡ack
), "3" (
__ÃedË
),

1922 "d" (
__ÃedË
)

1924  
__»s
;

1925 
	}
}

1927 
__STRING_INLINE
 *

1928 
	$__¡r¡r_g
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

1930 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1931 *
__»s
;

1932 
__asm__
 
__vŞ©e__


1949 : "=&a" (
__»s
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1950 : "0" (0), "1" (0xffffffff), "2" (
__hay¡ack
), "3" (
__ÃedË
),

1951 "b" (
__ÃedË
)

1953  
__»s
;

1954 
	}
}

1960 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1961 #ifdeà
__i686__


1962 
	#_HAVE_STRING_ARCH_ffs
 1

	)

1963 
	#ffs
(
wÜd
è(
	`__butš_cÚ¡ªt_p
 (word) \

1964 ? 
	`__butš_ffs
 (
wÜd
) \

1965 : ({ 
__út
, 
__tmp
; \

1966 
__asm__
 
__vŞ©e__
 \

1969 : "=&r" (
__út
), "ô" (
__tmp
) \

1970 : "rm" (
wÜd
), "1" (-1)); \

1971 
__út
 + 1; }))

	)

1973 #iâdeà
ff¦


1974 
	#ff¦
(
wÜd
è
	`ffs
(wÜd)

	)

1979 #iâdeà
_FORCE_INLINES


1980 #undeà
__STRING_INLINE


	@/usr/include/bits/string2.h

20 #iâdeà
_STRING_H


24 #ià!
defšed
 
__NO_STRING_INLINES
 && !defšed 
__BOUNDED_POINTERS__


41 #iâdeà
__STRING_INLINE


42 #ifdeà
__ılu¥lus


43 
	#__STRING_INLINE
 
šlše


	)

45 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

49 #ià
_STRING_ARCH_uÇligÃd


51 
	~<’dŸn.h
>

52 
	~<b™s/ty³s.h
>

54 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


55 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

56 (((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1] << 8 \

57 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
])

	)

58 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

59 (((((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

60 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

61 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

62 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
])

	)

64 
	#__STRING2_SMALL_GET16
(
¤c
, 
idx
) \

65 (((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
] << 8 \

66 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1])

	)

67 
	#__STRING2_SMALL_GET32
(
¤c
, 
idx
) \

68 (((((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
] << 8 \

69 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

70 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

71 | ((cÚ¡ *è(cÚ¡ *è(
¤c
))[
idx
 + 3])

	)

76 
	#__STRING2_COPY_TYPE
(
N
) \

77 ¡ruù { 
__¬r
[
N
]; } \

78 
	t__©Œibu‹__
 ((
	t__·cked__
)è
	t__STRING2_COPY_ARR
##
	tN


	)

79 
	t__STRING2_COPY_TYPE
 (2);

80 
__STRING2_COPY_TYPE
 (3);

81 
__STRING2_COPY_TYPE
 (4);

82 
__STRING2_COPY_TYPE
 (5);

83 
__STRING2_COPY_TYPE
 (6);

84 
__STRING2_COPY_TYPE
 (7);

85 
__STRING2_COPY_TYPE
 (8);

86 #undeà
__STRING2_COPY_TYPE


92 
	#__¡ršg2_1b±r_p
(
__x
) \

93 ((
size_t
)(cÚ¡ *)((
__x
è+ 1è- (size_t)(cÚ¡ *)(__xè=ğ1)

	)

96 #ià!
defšed
 
_HAVE_STRING_ARCH_mem£t


97 #ià!
__GNUC_PREREQ
 (3, 0)

98 #ià
_STRING_ARCH_uÇligÃd


99 
	#mem£t
(
s
, 
c
, 
n
) \

100 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

101 ? ((
n
) == 1 \

102 ? 
	`__mem£t_1
 (
s
, 
c
) \

103 : 
	`__mem£t_gc
 (
s
, 
c
, 
n
)) \

104 : (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

105 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

106 : 
	`mem£t
 (
s
, 
c
, 
n
))))

	)

108 
	#__mem£t_1
(
s
, 
c
è({ *
__s
 = (s); \

109 *((
__ušt8_t
 *è
__s
èğ(__ušt8_tè
c
; __s; })

	)

111 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

112 ({ *
__s
 = (
s
); \

114 
__ui
; \

115 
__usi
; \

116 
__uc
; \

117 } *
__u
 = 
__s
; \

118 
__ušt8_t
 
__c
 = (__ušt8_tè(
c
); \

121 (è(
n
)) \

124 
__u
->
__ui
 = 
__c
 * 0x01010101; \

125 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

127 
__u
->
__ui
 = 
__c
 * 0x01010101; \

128 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

130 
__u
->
__ui
 = 
__c
 * 0x01010101; \

131 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

133 
__u
->
__usi
 = (è
__c
 * 0x0101; \

134 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

135 
__u
->
__uc
 = (è
__c
; \

139 
__u
->
__ui
 = 
__c
 * 0x01010101; \

140 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

142 
__u
->
__ui
 = 
__c
 * 0x01010101; \

143 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

145 
__u
->
__ui
 = 
__c
 * 0x01010101; \

146 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

148 
__u
->
__usi
 = (è
__c
 * 0x0101; \

152 
__u
->
__ui
 = 
__c
 * 0x01010101; \

153 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

155 
__u
->
__ui
 = 
__c
 * 0x01010101; \

156 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

158 
__u
->
__ui
 = 
__c
 * 0x01010101; \

159 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

161 
__u
->
__uc
 = (è
__c
; \

165 
__u
->
__ui
 = 
__c
 * 0x01010101; \

166 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

168 
__u
->
__ui
 = 
__c
 * 0x01010101; \

169 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

171 
__u
->
__ui
 = 
__c
 * 0x01010101; \

172 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

174 
__u
->
__ui
 = 
__c
 * 0x01010101; \

179 
__s
; })

	)

181 
	#mem£t
(
s
, 
c
, 
n
) \

182 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

183 ? ({ *
__s
 = (
s
); 
	`__bz”o
 (__s, 
n
); __s; }) \

184 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

193 #ià
__GNUC_PREREQ
 (2, 91)

194 
	#__bz”o
(
s
, 
n
è
	`__butš_mem£t
 (s, '\0',‚)

	)

202 #ifdeà
__USE_GNU


203 #ià!
defšed
 
_HAVE_STRING_ARCH_mempıy
 || defšed 
_FORCE_INLINES


204 #iâdeà
_HAVE_STRING_ARCH_mempıy


205 #ià
__GNUC_PREREQ
 (3, 4)

206 
	#__mempıy
(
de¡
, 
¤c
, 
n
è
	`__butš_mempıy
 (de¡, src,‚)

	)

207 #–ià
__GNUC_PREREQ
 (3, 0)

208 
	#__mempıy
(
de¡
, 
¤c
, 
n
) \

209 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

210 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

211 ? 
	`__butš_memıy
 (
de¡
, 
¤c
, 
n
) + (n) \

212 : 
	`__mempıy
 (
de¡
, 
¤c
, 
n
)))

	)

214 
	#__mempıy
(
de¡
, 
¤c
, 
n
) \

215 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

216 && 
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
n
 <= 8 \

217 ? 
	`__mempıy_sm®l
 (
de¡
, 
	`__mempıy_¬gs
 (
¤c
), 
n
) \

218 : 
	`__mempıy
 (
de¡
, 
¤c
, 
n
)))

	)

222 
	#mempıy
(
de¡
, 
¤c
, 
n
è
	`__mempıy
 (de¡, src,‚)

	)

225 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


226 #ià
_STRING_ARCH_uÇligÃd


227 #iâdeà
_FORCE_INLINES


228 
	#__mempıy_¬gs
(
¤c
) \

229 ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[2], \

230 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[6], \

231 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

232 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

233 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

234 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

236 
__STRING_INLINE
 *
__mempıy_sm®l
 (*, , , , ,

237 
__ušt16_t
, __ušt16_t, 
__ušt32_t
,

238 
__ušt32_t
, 
size_t
);

239 
__STRING_INLINE
 *

240 
	$__mempıy_sm®l
 (*
__de¡1
,

241 
__¤c0_1
, 
__¤c2_1
, 
__¤c4_1
, 
__¤c6_1
,

242 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

243 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

244 
size_t
 
__¤ş’
)

247 
__ušt32_t
 
__ui
;

248 
__ušt16_t
 
__usi
;

249 
__uc
;

250 
__c
;

251 } *
__u
 = 
__de¡1
;

252 (è
__¤ş’
)

255 
__u
->
__c
 = 
__¤c0_1
;

256 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

259 
__u
->
__usi
 = 
__¤c0_2
;

260 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

263 
__u
->
__usi
 = 
__¤c0_2
;

264 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

265 
__u
->
__c
 = 
__¤c2_1
;

266 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

269 
__u
->
__ui
 = 
__¤c0_4
;

270 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

273 
__u
->
__ui
 = 
__¤c0_4
;

274 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

275 
__u
->
__c
 = 
__¤c4_1
;

276 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

279 
__u
->
__ui
 = 
__¤c0_4
;

280 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

281 
__u
->
__usi
 = 
__¤c4_2
;

282 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

285 
__u
->
__ui
 = 
__¤c0_4
;

286 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

287 
__u
->
__usi
 = 
__¤c4_2
;

288 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

289 
__u
->
__c
 = 
__¤c6_1
;

290 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

293 
__u
->
__ui
 = 
__¤c0_4
;

294 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

295 
__u
->
__ui
 = 
__¤c4_4
;

296 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

299  (*è
__u
;

300 
	}
}

302 #iâdeà
_FORCE_INLINES


303 
	#__mempıy_¬gs
(
¤c
) \

304 ((cÚ¡ *è(
¤c
))[0], \

305 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

306 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1] } }), \

307 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

308 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

309 ((cÚ¡ *è(
¤c
))[2] } }), \

310 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

311 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

312 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3] } }), \

313 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

314 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

315 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

316 ((cÚ¡ *è(
¤c
))[4] } }), \

317 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

318 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

319 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

320 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5] } }), \

321 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

322 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

323 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

324 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

325 ((cÚ¡ *è(
¤c
))[6] } }), \

326 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

327 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

328 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

329 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

330 ((cÚ¡ *è(
¤c
))[6], ((cÚ¡ *è(¤c))[7] } })

	)

332 
__STRING_INLINE
 *
__mempıy_sm®l
 (*, , 
__STRING2_COPY_ARR2
,

333 
__STRING2_COPY_ARR3
,

334 
__STRING2_COPY_ARR4
,

335 
__STRING2_COPY_ARR5
,

336 
__STRING2_COPY_ARR6
,

337 
__STRING2_COPY_ARR7
,

338 
__STRING2_COPY_ARR8
, 
size_t
);

339 
__STRING_INLINE
 *

340 
	$__mempıy_sm®l
 (*
__de¡
, 
__¤c1
,

341 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

342 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

343 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

344 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

347 
__c
;

348 
__STRING2_COPY_ARR2
 
__sÿ2
;

349 
__STRING2_COPY_ARR3
 
__sÿ3
;

350 
__STRING2_COPY_ARR4
 
__sÿ4
;

351 
__STRING2_COPY_ARR5
 
__sÿ5
;

352 
__STRING2_COPY_ARR6
 
__sÿ6
;

353 
__STRING2_COPY_ARR7
 
__sÿ7
;

354 
__STRING2_COPY_ARR8
 
__sÿ8
;

355 } *
__u
 = 
__de¡
;

356 (è
__¤ş’
)

359 
__u
->
__c
 = 
__¤c1
;

362 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

365 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

368 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

371 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

374 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

377 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

380 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

383  
	`__ex‹nsiÚ__
 ((*è
__u
 + 
__¤ş’
);

384 
	}
}

392 #iâdeà
_HAVE_STRING_ARCH_¡rchr


393 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

394 #ià
__GNUC_PREREQ
 (3, 2)

395 
	#¡rchr
(
s
, 
c
) \

396 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
è&& !__butš_cÚ¡ªt_°(
s
) \

397 && (
c
) == '\0' \

398 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

399 : 
	`__butš_¡rchr
 (
s
, 
c
)))

	)

401 
	#¡rchr
(
s
, 
c
) \

402 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) && (c) == '\0' \

403 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

404 : 
	`¡rchr
 (
s
, 
c
)))

	)

410 #ià(!
defšed
 
_HAVE_STRING_ARCH_¡rıy
 && !
__GNUC_PREREQ
 (3, 0)) \

411 || 
defšed
 
	g_FORCE_INLINES


412 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rıy
 && !
__GNUC_PREREQ
 (3, 0)

413 
	#¡rıy
(
de¡
, 
¤c
) \

414 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

415 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

416 ? 
	`__¡rıy_sm®l
 (
de¡
, 
	`__¡rıy_¬gs
 (
¤c
), \

417 
	`¡¾’
 (
¤c
) + 1) \

418 : (*è
	`memıy
 (
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1)) \

419 : 
	`¡rıy
 (
de¡
, 
¤c
)))

	)

422 #ià
_STRING_ARCH_uÇligÃd


423 #iâdeà
_FORCE_INLINES


424 
	#__¡rıy_¬gs
(
¤c
) \

425 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

426 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

427 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

428 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

430 
__STRING_INLINE
 *
__¡rıy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

431 
__ušt32_t
, __ušt32_t, 
size_t
);

432 
__STRING_INLINE
 *

433 
	$__¡rıy_sm®l
 (*
__de¡
,

434 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

435 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

436 
size_t
 
__¤ş’
)

439 
__ušt32_t
 
__ui
;

440 
__ušt16_t
 
__usi
;

441 
__uc
;

442 } *
__u
 = (*è
__de¡
;

443 (è
__¤ş’
)

446 
__u
->
__uc
 = '\0';

449 
__u
->
__usi
 = 
__¤c0_2
;

452 
__u
->
__usi
 = 
__¤c0_2
;

453 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

454 
__u
->
__uc
 = '\0';

457 
__u
->
__ui
 = 
__¤c0_4
;

460 
__u
->
__ui
 = 
__¤c0_4
;

461 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

462 
__u
->
__uc
 = '\0';

465 
__u
->
__ui
 = 
__¤c0_4
;

466 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

467 
__u
->
__usi
 = 
__¤c4_2
;

470 
__u
->
__ui
 = 
__¤c0_4
;

471 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

472 
__u
->
__usi
 = 
__¤c4_2
;

473 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

474 
__u
->
__uc
 = '\0';

477 
__u
->
__ui
 = 
__¤c0_4
;

478 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

479 
__u
->
__ui
 = 
__¤c4_4
;

482  
__de¡
;

483 
	}
}

485 #iâdeà
_FORCE_INLINES


486 
	#__¡rıy_¬gs
(
¤c
) \

487 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

488 { { ((cÚ¡ *è(
¤c
))[0], '\0' } }), \

489 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

490 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

492 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

493 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

494 ((cÚ¡ *è(
¤c
))[2], '\0' } }), \

495 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

496 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

497 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

499 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

500 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

501 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

502 ((cÚ¡ *è(
¤c
))[4], '\0' } }), \

503 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

504 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

505 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

506 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

508 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

509 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

510 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

511 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

512 ((cÚ¡ *è(
¤c
))[6], '\0' } })

	)

514 
__STRING_INLINE
 *
__¡rıy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

515 
__STRING2_COPY_ARR3
,

516 
__STRING2_COPY_ARR4
,

517 
__STRING2_COPY_ARR5
,

518 
__STRING2_COPY_ARR6
,

519 
__STRING2_COPY_ARR7
,

520 
__STRING2_COPY_ARR8
, 
size_t
);

521 
__STRING_INLINE
 *

522 
	$__¡rıy_sm®l
 (*
__de¡
,

523 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

524 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

525 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

526 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

529 
__c
;

530 
__STRING2_COPY_ARR2
 
__sÿ2
;

531 
__STRING2_COPY_ARR3
 
__sÿ3
;

532 
__STRING2_COPY_ARR4
 
__sÿ4
;

533 
__STRING2_COPY_ARR5
 
__sÿ5
;

534 
__STRING2_COPY_ARR6
 
__sÿ6
;

535 
__STRING2_COPY_ARR7
 
__sÿ7
;

536 
__STRING2_COPY_ARR8
 
__sÿ8
;

537 } *
__u
 = (*è
__de¡
;

538 (è
__¤ş’
)

541 
__u
->
__c
 = '\0';

544 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

547 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

550 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

553 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

556 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

559 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

562 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

565  
__de¡
;

566 
	}
}

572 #ifdeà
__USE_GNU


573 #ià!
defšed
 
_HAVE_STRING_ARCH_¡pıy
 || defšed 
_FORCE_INLINES


574 #iâdeà
_HAVE_STRING_ARCH_¡pıy


575 #ià
__GNUC_PREREQ
 (3, 4)

576 
	#__¡pıy
(
de¡
, 
¤c
è
	`__butš_¡pıy
 (de¡, src)

	)

577 #–ià
__GNUC_PREREQ
 (3, 0)

578 
	#__¡pıy
(
de¡
, 
¤c
) \

579 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

580 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

581 ? 
	`__butš_¡rıy
 (
de¡
, 
¤c
è+ 
	`¡¾’
 (src) \

582 : ((*è(
__mempıy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

584 : 
	`__¡pıy
 (
de¡
, 
¤c
)))

	)

586 
	#__¡pıy
(
de¡
, 
¤c
) \

587 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

588 ? (
	`__¡ršg2_1b±r_p
 (
¤c
è&& 
	`¡¾’
 (src) + 1 <= 8 \

589 ? 
	`__¡pıy_sm®l
 (
de¡
, 
	`__¡pıy_¬gs
 (
¤c
), \

590 
	`¡¾’
 (
¤c
) + 1) \

591 : ((*è(
__mempıy
è(
de¡
, 
¤c
, 
	`¡¾’
 (src) + 1) \

593 : 
	`__¡pıy
 (
de¡
, 
¤c
)))

	)

597 
	#¡pıy
(
de¡
, 
¤c
è
	`__¡pıy
 (de¡, src)

	)

600 #ià!
__GNUC_PREREQ
 (3, 0è|| 
defšed
 
_FORCE_INLINES


601 #ià
_STRING_ARCH_uÇligÃd


602 #iâdeà
_FORCE_INLINES


603 
	#__¡pıy_¬gs
(
¤c
) \

604 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 0), \

605 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET16
 (
¤c
, 4), \

606 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 0), \

607 
__ex‹nsiÚ__
 
	`__STRING2_SMALL_GET32
 (
¤c
, 4)

	)

609 
__STRING_INLINE
 *
__¡pıy_sm®l
 (*, 
__ušt16_t
, __uint16_t,

610 
__ušt32_t
, __ušt32_t, 
size_t
);

611 
__STRING_INLINE
 *

612 
	$__¡pıy_sm®l
 (*
__de¡
,

613 
__ušt16_t
 
__¤c0_2
, __ušt16_ˆ
__¤c4_2
,

614 
__ušt32_t
 
__¤c0_4
, __ušt32_ˆ
__¤c4_4
,

615 
size_t
 
__¤ş’
)

618 
__ui
;

619 
__usi
;

620 
__uc
;

621 
__c
;

622 } *
__u
 = (*è
__de¡
;

623 (è
__¤ş’
)

626 
__u
->
__uc
 = '\0';

629 
__u
->
__usi
 = 
__¤c0_2
;

630 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

633 
__u
->
__usi
 = 
__¤c0_2
;

634 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

635 
__u
->
__uc
 = '\0';

638 
__u
->
__ui
 = 
__¤c0_4
;

639 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

642 
__u
->
__ui
 = 
__¤c0_4
;

643 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

644 
__u
->
__uc
 = '\0';

647 
__u
->
__ui
 = 
__¤c0_4
;

648 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

649 
__u
->
__usi
 = 
__¤c4_2
;

650 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1);

653 
__u
->
__ui
 = 
__¤c0_4
;

654 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

655 
__u
->
__usi
 = 
__¤c4_2
;

656 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2);

657 
__u
->
__uc
 = '\0';

660 
__u
->
__ui
 = 
__¤c0_4
;

661 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4);

662 
__u
->
__ui
 = 
__¤c4_4
;

663 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3);

666  &
__u
->
__c
;

667 
	}
}

669 #iâdeà
_FORCE_INLINES


670 
	#__¡pıy_¬gs
(
¤c
) \

671 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR2
) \

672 { { ((cÚ¡ *è(
¤c
))[0], '\0' } }), \

673 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR3
) \

674 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

676 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR4
) \

677 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

678 ((cÚ¡ *è(
¤c
))[2], '\0' } }), \

679 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR5
) \

680 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

681 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

683 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR6
) \

684 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

685 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

686 ((cÚ¡ *è(
¤c
))[4], '\0' } }), \

687 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR7
) \

688 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

689 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

690 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

692 
	`__ex‹nsiÚ__
 ((
__STRING2_COPY_ARR8
) \

693 { { ((cÚ¡ *è(
¤c
))[0], ((const *) (src))[1], \

694 ((cÚ¡ *è(
¤c
))[2], ((const *) (src))[3], \

695 ((cÚ¡ *è(
¤c
))[4], ((const *) (src))[5], \

696 ((cÚ¡ *è(
¤c
))[6], '\0' } })

	)

698 
__STRING_INLINE
 *
__¡pıy_sm®l
 (*, 
__STRING2_COPY_ARR2
,

699 
__STRING2_COPY_ARR3
,

700 
__STRING2_COPY_ARR4
,

701 
__STRING2_COPY_ARR5
,

702 
__STRING2_COPY_ARR6
,

703 
__STRING2_COPY_ARR7
,

704 
__STRING2_COPY_ARR8
, 
size_t
);

705 
__STRING_INLINE
 *

706 
	$__¡pıy_sm®l
 (*
__de¡
,

707 
__STRING2_COPY_ARR2
 
__¤c2
, 
__STRING2_COPY_ARR3
 
__¤c3
,

708 
__STRING2_COPY_ARR4
 
__¤c4
, 
__STRING2_COPY_ARR5
 
__¤c5
,

709 
__STRING2_COPY_ARR6
 
__¤c6
, 
__STRING2_COPY_ARR7
 
__¤c7
,

710 
__STRING2_COPY_ARR8
 
__¤c8
, 
size_t
 
__¤ş’
)

713 
__c
;

714 
__STRING2_COPY_ARR2
 
__sÿ2
;

715 
__STRING2_COPY_ARR3
 
__sÿ3
;

716 
__STRING2_COPY_ARR4
 
__sÿ4
;

717 
__STRING2_COPY_ARR5
 
__sÿ5
;

718 
__STRING2_COPY_ARR6
 
__sÿ6
;

719 
__STRING2_COPY_ARR7
 
__sÿ7
;

720 
__STRING2_COPY_ARR8
 
__sÿ8
;

721 } *
__u
 = (*è
__de¡
;

722 (è
__¤ş’
)

725 
__u
->
__c
 = '\0';

728 
__ex‹nsiÚ__
 
__u
->
__sÿ2
 = 
__¤c2
;

731 
__ex‹nsiÚ__
 
__u
->
__sÿ3
 = 
__¤c3
;

734 
__ex‹nsiÚ__
 
__u
->
__sÿ4
 = 
__¤c4
;

737 
__ex‹nsiÚ__
 
__u
->
__sÿ5
 = 
__¤c5
;

740 
__ex‹nsiÚ__
 
__u
->
__sÿ6
 = 
__¤c6
;

743 
__ex‹nsiÚ__
 
__u
->
__sÿ7
 = 
__¤c7
;

746 
__ex‹nsiÚ__
 
__u
->
__sÿ8
 = 
__¤c8
;

749  
__de¡
 + 
__¤ş’
 - 1;

750 
	}
}

758 #iâdeà
_HAVE_STRING_ARCH_¡ºıy


759 #ià
__GNUC_PREREQ
 (3, 2)

760 
	#¡ºıy
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºıy
 (de¡, src,‚)

	)

762 
	#¡ºıy
(
de¡
, 
¤c
, 
n
) \

763 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

764 ? (
	`¡¾’
 (
¤c
è+ 1 >ğ((
size_t
è(
n
)) \

765 ? (*è
	`memıy
 (
de¡
, 
¤c
, 
n
) \

766 : 
	`¡ºıy
 (
de¡
, 
¤c
, 
n
)) \

767 : 
	`¡ºıy
 (
de¡
, 
¤c
, 
n
)))

	)

773 #iâdeà
_HAVE_STRING_ARCH_¡ºÿt


774 #ifdeà
_USE_STRING_ARCH_¡rchr


775 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

776 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

777 
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

778 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

779 ? 
	`¡rÿt
 (
__de¡
, 
¤c
) \

780 : (*((*è
	`__mempıy
 (
	`¡rchr
 (
__de¡
, '\0'), \

781 
¤c
, 
n
)èğ'\0', 
__de¡
)) \

782 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
); }))

	)

783 #–ià
__GNUC_PREREQ
 (3, 2)

784 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºÿt
 (de¡, src,‚)

	)

786 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

787 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

788 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

789 ? 
	`¡rÿt
 (
de¡
, 
¤c
) \

790 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)) \

791 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
)))

	)

797 #iâdeà
_HAVE_STRING_ARCH_¡rcmp


798 #ià
__GNUC_PREREQ
 (3, 2)

799 
	#¡rcmp
(
s1
, 
s2
) \

800 
__ex‹nsiÚ__
 \

801 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

802 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

803 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

804 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

805 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

806 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

807 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

808 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

809 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

810 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

811 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

812 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

813 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

814 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

815 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

816 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

817 : 
	`__butš_¡rcmp
 (
s1
, 
s2
)))); })

	)

819 
	#¡rcmp
(
s1
, 
s2
) \

820 
__ex‹nsiÚ__
 \

821 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

822 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

823 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), 
__s2_Ën
 = sŒËÀ(
s2
), \

824 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

825 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

826 ? 
	`memcmp
 ((cÚ¡ *è(
s1
), (cÚ¡ *è(
s2
), \

827 (
__s1_Ën
 < 
__s2_Ën
 ? __s1_len : __s2_len) + 1) \

828 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

829 && (
__s1_Ën
 = 
	`¡¾’
 (
s1
), __s1_len < 4) \

830 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

831 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s1_Ën
) \

832 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

833 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

834 && (
__s2_Ën
 = 
	`¡¾’
 (
s2
), __s2_len < 4) \

835 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

836 ? 
	`__¡rcmp_cc
 (
s1
, 
s2
, 
__s2_Ën
) \

837 : 
	`__¡rcmp_gc
 (
s1
, 
s2
, 
__s2_Ën
)) \

838 : 
	`¡rcmp
 (
s1
, 
s2
)))); })

	)

841 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

842 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = \

843 (((cÚ¡ *è(cÚ¡ *è(
s1
))[0] \

844 - ((cÚ¡ *è(cÚ¡ *)(
s2
))[0]); \

845 ià(
l
 > 0 && 
__»suÉ
 == 0) \

847 
__»suÉ
 = (((const *) \

848 (cÚ¡ *è(
s1
))[1] \

850 (cÚ¡ *è(
s2
))[1]); \

851 ià(
l
 > 1 && 
__»suÉ
 == 0) \

853 
__»suÉ
 = \

855 (cÚ¡ *è(
s1
))[2] \

857 (cÚ¡ *è(
s2
))[2]); \

858 ià(
l
 > 2 && 
__»suÉ
 == 0) \

859 
__»suÉ
 = \

861 (cÚ¡ *è(
s1
))[3] \

863 (cÚ¡ *è(
s2
))[3]); \

866 
__»suÉ
; }))

	)

868 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

869 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s2
 = \

870 (cÚ¡ *è(cÚ¡ *è(
s2
); \

871 
__»suÉ
 = \

872 (((cÚ¡ *è(cÚ¡ *è(
s1
))[0] \

873 - 
__s2
[0]); \

874 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

876 
__»suÉ
 = (((const *) \

877 (cÚ¡ *è(
s1
))[1] - 
__s2
[1]); \

878 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

880 
__»suÉ
 = (((const *) \

881 (cÚ¡ *è(
s1
))[2] - 
__s2
[2]); \

882 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

883 
__»suÉ
 = (((const *) \

884 (cÚ¡ *è(
s1
))[3] \

885 - 
__s2
[3]); \

888 
__»suÉ
; }))

	)

890 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
) \

891 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s1
 = \

892 (cÚ¡ *è(cÚ¡ *è(
s1
); \

893 
__»suÉ
 = \

894 
__s1
[0] - ((const *) \

895 (cÚ¡ *è(
s2
))[0]; \

896 ià(
l2
 > 0 && 
__»suÉ
 == 0) \

898 
__»suÉ
 = (
__s1
[1] \

900 (cÚ¡ *è(
s2
))[1]); \

901 ià(
l2
 > 1 && 
__»suÉ
 == 0) \

903 
__»suÉ
 = \

904 (
__s1
[2] - ((const *) \

905 (cÚ¡ *è(
s2
))[2]); \

906 ià(
l2
 > 2 && 
__»suÉ
 == 0) \

907 
__»suÉ
 = \

908 (
__s1
[3] \

910 (cÚ¡ *è(
s2
))[3]); \

913 
__»suÉ
; }))

	)

918 #iâdeà
_HAVE_STRING_ARCH_¡ºcmp


919 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

920 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) \

921 && ((
	`__butš_cÚ¡ªt_p
 (
s1
) \

922 && 
	`¡¾’
 (
s1
è< ((
size_t
è(
n
))) \

923 || (
	`__butš_cÚ¡ªt_p
 (
s2
) \

924 && 
	`¡¾’
 (
s2
è< ((
size_t
è(
n
)))) \

925 ? 
	`¡rcmp
 (
s1
, 
s2
è: 
	`¡ºcmp
 (s1, s2, 
n
)))

	)

931 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rc¥n
 || defšed 
_FORCE_INLINES


932 #iâdeà
_HAVE_STRING_ARCH_¡rc¥n


933 #ià
__GNUC_PREREQ
 (3, 2)

934 
	#¡rc¥n
(
s
, 
»jeù
) \

935 
__ex‹nsiÚ__
 \

936 ({ 
__r0
, 
__r1
, 
__r2
; \

937 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

938 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

939 ? 
	`__butš_¡rc¥n
 (
s
, 
»jeù
) \

940 : ((
__r0
 = ((cÚ¡ *è(
»jeù
))[0], __r0 == '\0') \

941 ? 
	`¡¾’
 (
s
) \

942 : ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], __r1 == '\0') \

943 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

944 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

945 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

946 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

947 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

948 : 
	`__butš_¡rc¥n
 (
s
, 
»jeù
)))))) \

949 : 
	`__butš_¡rc¥n
 (
s
, 
»jeù
)); })

	)

951 
	#¡rc¥n
(
s
, 
»jeù
) \

952 
__ex‹nsiÚ__
 \

953 ({ 
__r0
, 
__r1
, 
__r2
; \

954 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

955 ? ((
__r0
 = ((cÚ¡ *è(
»jeù
))[0], __r0 == '\0') \

956 ? 
	`¡¾’
 (
s
) \

957 : ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], __r1 == '\0') \

958 ? 
	`__¡rc¥n_c1
 (
s
, 
__r0
) \

959 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

960 ? 
	`__¡rc¥n_c2
 (
s
, 
__r0
, 
__r1
) \

961 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

962 ? 
	`__¡rc¥n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

963 : 
	`¡rc¥n
 (
s
, 
»jeù
))))) \

964 : 
	`¡rc¥n
 (
s
, 
»jeù
)); })

	)

968 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
);

969 
__STRING_INLINE
 
size_t


970 
	$__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
)

972 
size_t
 
__»suÉ
 = 0;

973 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù
)

974 ++
__»suÉ
;

975  
__»suÉ
;

976 
	}
}

978 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c2
 (cÚ¡ *
__s
, 
__»jeù1
,

979 
__»jeù2
);

980 
__STRING_INLINE
 
size_t


981 
	$__¡rc¥n_c2
 (cÚ¡ *
__s
, 
__»jeù1
, 
__»jeù2
)

983 
size_t
 
__»suÉ
 = 0;

984 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù1


985 && 
__s
[
__»suÉ
] !ğ
__»jeù2
)

986 ++
__»suÉ
;

987  
__»suÉ
;

988 
	}
}

990 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c3
 (cÚ¡ *
__s
, 
__»jeù1
,

991 
__»jeù2
, 
__»jeù3
);

992 
__STRING_INLINE
 
size_t


993 
	$__¡rc¥n_c3
 (cÚ¡ *
__s
, 
__»jeù1
, 
__»jeù2
,

994 
__»jeù3
)

996 
size_t
 
__»suÉ
 = 0;

997 
__s
[
__»suÉ
] !ğ'\0' && __s[__»suÉ] !ğ
__»jeù1


998 && 
__s
[
__»suÉ
] !ğ
__»jeù2
 && __s[__»suÉ] !ğ
__»jeù3
)

999 ++
__»suÉ
;

1000  
__»suÉ
;

1001 
	}
}

1007 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¥n
 || defšed 
_FORCE_INLINES


1008 #iâdeà
_HAVE_STRING_ARCH_¡r¥n


1009 #ià
__GNUC_PREREQ
 (3, 2)

1010 
	#¡r¥n
(
s
, 
acû±
) \

1011 
__ex‹nsiÚ__
 \

1012 ({ 
__a0
, 
__a1
, 
__a2
; \

1013 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1014 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

1015 ? 
	`__butš_¡r¥n
 (
s
, 
acû±
) \

1016 : ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1017 ? ((è(
s
), (
size_t
) 0) \

1018 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1019 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

1020 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1021 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

1022 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1023 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1024 : 
	`__butš_¡r¥n
 (
s
, 
acû±
)))))) \

1025 : 
	`__butš_¡r¥n
 (
s
, 
acû±
)); })

	)

1027 
	#¡r¥n
(
s
, 
acû±
) \

1028 
__ex‹nsiÚ__
 \

1029 ({ 
__a0
, 
__a1
, 
__a2
; \

1030 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1031 ? ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1032 ? ((è(
s
), (
size_t
) 0) \

1033 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1034 ? 
	`__¡r¥n_c1
 (
s
, 
__a0
) \

1035 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1036 ? 
	`__¡r¥n_c2
 (
s
, 
__a0
, 
__a1
) \

1037 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1038 ? 
	`__¡r¥n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1039 : 
	`¡r¥n
 (
s
, 
acû±
))))) \

1040 : 
	`¡r¥n
 (
s
, 
acû±
)); })

	)

1044 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
);

1045 
__STRING_INLINE
 
size_t


1046 
	$__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
)

1048 
size_t
 
__»suÉ
 = 0;

1050 
__s
[
__»suÉ
] =ğ
__acû±
)

1051 ++
__»suÉ
;

1052  
__»suÉ
;

1053 
	}
}

1055 
__STRING_INLINE
 
size_t
 
__¡r¥n_c2
 (cÚ¡ *
__s
, 
__acû±1
,

1056 
__acû±2
);

1057 
__STRING_INLINE
 
size_t


1058 
	$__¡r¥n_c2
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
)

1060 
size_t
 
__»suÉ
 = 0;

1062 
__s
[
__»suÉ
] =ğ
__acû±1
 || __s[__»suÉ] =ğ
__acû±2
)

1063 ++
__»suÉ
;

1064  
__»suÉ
;

1065 
	}
}

1067 
__STRING_INLINE
 
size_t
 
__¡r¥n_c3
 (cÚ¡ *
__s
, 
__acû±1
,

1068 
__acû±2
, 
__acû±3
);

1069 
__STRING_INLINE
 
size_t


1070 
	$__¡r¥n_c3
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
, 
__acû±3
)

1072 
size_t
 
__»suÉ
 = 0;

1074 
__s
[
__»suÉ
] =ğ
__acû±1
 || __s[__»suÉ] =ğ
__acû±2


1075 || 
__s
[
__»suÉ
] =ğ
__acû±3
)

1076 ++
__»suÉ
;

1077  
__»suÉ
;

1078 
	}
}

1083 #ià!
defšed
 
_HAVE_STRING_ARCH_¡½brk
 || defšed 
_FORCE_INLINES


1084 #iâdeà
_HAVE_STRING_ARCH_¡½brk


1085 #ià
__GNUC_PREREQ
 (3, 2)

1086 
	#¡½brk
(
s
, 
acû±
) \

1087 
__ex‹nsiÚ__
 \

1088 ({ 
__a0
, 
__a1
, 
__a2
; \

1089 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1090 ? ((
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s)) \

1091 ? 
	`__butš_¡½brk
 (
s
, 
acû±
) \

1092 : ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1093 ? ((è(
s
), (*è
NULL
) \

1094 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1095 ? 
	`__butš_¡rchr
 (
s
, 
__a0
) \

1096 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1097 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1098 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1099 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1100 : 
	`__butš_¡½brk
 (
s
, 
acû±
)))))) \

1101 : 
	`__butš_¡½brk
 (
s
, 
acû±
)); })

	)

1103 
	#¡½brk
(
s
, 
acû±
) \

1104 
__ex‹nsiÚ__
 \

1105 ({ 
__a0
, 
__a1
, 
__a2
; \

1106 (
	`__butš_cÚ¡ªt_p
 (
acû±
è&& 
	`__¡ršg2_1b±r_p
 (accept) \

1107 ? ((
__a0
 = ((cÚ¡ *è(
acû±
))[0], __a0 == '\0') \

1108 ? ((è(
s
), (*è
NULL
) \

1109 : ((
__a1
 = ((cÚ¡ *è(
acû±
))[1], __a1 == '\0') \

1110 ? 
	`¡rchr
 (
s
, 
__a0
) \

1111 : ((
__a2
 = ((cÚ¡ *è(
acû±
))[2], __a2 == '\0') \

1112 ? 
	`__¡½brk_c2
 (
s
, 
__a0
, 
__a1
) \

1113 : (((cÚ¡ *è(
acû±
))[3] == '\0' \

1114 ? 
	`__¡½brk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1115 : 
	`¡½brk
 (
s
, 
acû±
))))) \

1116 : 
	`¡½brk
 (
s
, 
acû±
)); })

	)

1120 
__STRING_INLINE
 *
__¡½brk_c2
 (cÚ¡ *
__s
, 
__acû±1
,

1121 
__acû±2
);

1122 
__STRING_INLINE
 *

1123 
	$__¡½brk_c2
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
)

1126 *
__s
 !ğ'\0' && *__ !ğ
__acû±1
 && *__ !ğ
__acû±2
)

1127 ++
__s
;

1128  *
__s
 =ğ'\0' ? 
NULL
 : (*è(
size_t
) __s;

1129 
	}
}

1131 
__STRING_INLINE
 *
__¡½brk_c3
 (cÚ¡ *
__s
, 
__acû±1
,

1132 
__acû±2
, 
__acû±3
);

1133 
__STRING_INLINE
 *

1134 
	$__¡½brk_c3
 (cÚ¡ *
__s
, 
__acû±1
, 
__acû±2
, 
__acû±3
)

1137 *
__s
 !ğ'\0' && *__ !ğ
__acû±1
 && *__ !ğ
__acû±2


1138 && *
__s
 !ğ
__acû±3
)

1139 ++
__s
;

1140  *
__s
 =ğ'\0' ? 
NULL
 : (*è(
size_t
) __s;

1141 
	}
}

1147 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r¡r
 && !
__GNUC_PREREQ
 (2, 97)

1148 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1149 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
ÃedË
è&& 
	`__¡ršg2_1b±r_p
 (needle) \

1150 ? (((cÚ¡ *è(
ÃedË
))[0] == '\0' \

1151 ? (*è(
size_t
è(
hay¡ack
) \

1152 : (((cÚ¡ *è(
ÃedË
))[1] == '\0' \

1153 ? 
	`¡rchr
 (
hay¡ack
, \

1154 ((cÚ¡ *è(
ÃedË
))[0]) \

1155 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
))) \

1156 : 
	`¡r¡r
 (
hay¡ack
, 
ÃedË
)))

	)

1160 #ià!
defšed
 
_HAVE_STRING_ARCH_¡¹ok_r
 || defšed 
_FORCE_INLINES


1161 #iâdeà
_HAVE_STRING_ARCH_¡¹ok_r


1162 
	#__¡¹ok_r
(
s
, 
£p
, 
Ãx
) \

1163 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
£p
è&& 
	`__¡ršg2_1b±r_p
 (sep) \

1164 && ((cÚ¡ *è(
£p
))[0] != '\0' \

1165 && ((cÚ¡ *è(
£p
))[1] == '\0' \

1166 ? 
	`__¡¹ok_r_1c
 (
s
, ((cÚ¡ *è(
£p
))[0], 
Ãx
) \

1167 : 
	`__¡¹ok_r
 (
s
, 
£p
, 
Ãx
)))

	)

1170 
__STRING_INLINE
 *
__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
);

1171 
__STRING_INLINE
 *

1172 
	$__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
)

1174 *
__»suÉ
;

1175 ià(
__s
 =ğ
NULL
)

1176 
__s
 = *
__Ãx
;

1177 *
__s
 =ğ
__£p
)

1178 ++
__s
;

1179 
__»suÉ
 = 
NULL
;

1180 ià(*
__s
 != '\0')

1182 
__»suÉ
 = 
__s
++;

1183 *
__s
 != '\0')

1184 ià(*
__s
++ =ğ
__£p
)

1186 
__s
[-1] = '\0';

1190 *
__Ãx
 = 
__s
;

1191  
__»suÉ
;

1192 
	}
}

1193 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


1194 
	#¡¹ok_r
(
s
, 
£p
, 
Ãx
è
	`__¡¹ok_r
 (s, s•,‚ex)

	)

1199 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r£p
 || defšed 
_FORCE_INLINES


1200 #iâdeà
_HAVE_STRING_ARCH_¡r£p


1202 *
__¡r£p_g
 (**
__¡ršgp
, cÚ¡ *
__d–im
);

1203 
	#__¡r£p
(
s
, 
»jeù
) \

1204 
__ex‹nsiÚ__
 \

1205 ({ 
__r0
, 
__r1
, 
__r2
; \

1206 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

1207 && (
__r0
 = ((cÚ¡ *è(
»jeù
))[0], \

1208 ((cÚ¡ *è(
»jeù
))[0] != '\0') \

1209 ? ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], \

1210 ((cÚ¡ *è(
»jeù
))[1] == '\0') \

1211 ? 
	`__¡r£p_1c
 (
s
, 
__r0
) \

1212 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

1213 ? 
	`__¡r£p_2c
 (
s
, 
__r0
, 
__r1
) \

1214 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

1215 ? 
	`__¡r£p_3c
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

1216 : 
	`__¡r£p_g
 (
s
, 
»jeù
)))) \

1217 : 
	`__¡r£p_g
 (
s
, 
»jeù
)); })

	)

1220 
__STRING_INLINE
 *
__¡r£p_1c
 (**
__s
, 
__»jeù
);

1221 
__STRING_INLINE
 *

1222 
	$__¡r£p_1c
 (**
__s
, 
__»jeù
)

1224 *
__»tv®
 = *
__s
;

1225 ià(
__»tv®
 !ğ
NULL
 && (*
__s
 = 
	`¡rchr
 (__»tv®, 
__»jeù
)) != NULL)

1226 *(*
__s
)++ = '\0';

1227  
__»tv®
;

1228 
	}
}

1230 
__STRING_INLINE
 *
__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
);

1231 
__STRING_INLINE
 *

1232 
	$__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
)

1234 *
__»tv®
 = *
__s
;

1235 ià(
__»tv®
 !ğ
NULL
)

1237 *
__ı
 = 
__»tv®
;

1240 ià(*
__ı
 == '\0')

1242 
__ı
 = 
NULL
;

1245 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
)

1247 *
__ı
++ = '\0';

1250 ++
__ı
;

1252 *
__s
 = 
__ı
;

1254  
__»tv®
;

1255 
	}
}

1257 
__STRING_INLINE
 *
__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
,

1258 
__»jeù3
);

1259 
__STRING_INLINE
 *

1260 
	$__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
, 
__»jeù3
)

1262 *
__»tv®
 = *
__s
;

1263 ià(
__»tv®
 !ğ
NULL
)

1265 *
__ı
 = 
__»tv®
;

1268 ià(*
__ı
 == '\0')

1270 
__ı
 = 
NULL
;

1273 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
 || *__ı =ğ
__»jeù3
)

1275 *
__ı
++ = '\0';

1278 ++
__ı
;

1280 *
__s
 = 
__ı
;

1282  
__»tv®
;

1283 
	}
}

1284 #ifdeà
__USE_BSD


1285 
	#¡r£p
(
s
, 
»jeù
è
	`__¡r£p
 (s,„ejeù)

	)

1292 #ifdeà
__USE_MISC


1294 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rdup
 || !defšed 
_HAVE_STRING_ARCH_¡ºdup


1295 
	#__Ãed_m®loc_ªd_ÿÎoc


	)

1296 
	~<¡dlib.h
>

1299 #iâdeà
_HAVE_STRING_ARCH_¡rdup


1301 *
	$__¡rdup
 (cÚ¡ *
__¡ršg
è
__THROW
 
__©Œibu‹_m®loc__
;

1302 
	#__¡rdup
(
s
) \

1303 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1304 ? (((cÚ¡ *è(
s
))[0] == '\0' \

1305 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1306 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1307 *
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1308 ià(
__»tv®
 !ğ
NULL
) \

1309 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, 
__Ën
); \

1310 
__»tv®
; 
	}
})) \

1311 : 
	`__¡rdup
 (
s
)))

	)

1313 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


1314 
	#¡rdup
(
s
è
	`__¡rdup
 (s)

	)

1318 #iâdeà
_HAVE_STRING_ARCH_¡ºdup


1320 *
	$__¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

1321 
__THROW
 
__©Œibu‹_m®loc__
;

1322 
	#__¡ºdup
(
s
, 
n
) \

1323 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

1324 ? (((cÚ¡ *è(
s
))[0] == '\0' \

1325 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

1326 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

1327 
size_t
 
__n
 = (
n
); \

1328 *
__»tv®
; \

1329 ià(
__n
 < 
__Ën
) \

1330 
__Ën
 = 
__n
 + 1; \

1331 
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

1332 ià(
__»tv®
 !ğ
NULL
) \

1334 
__»tv®
[
__Ën
 - 1] = '\0'; \

1335 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, \

1336 
__Ën
 - 1); \

1338 
__»tv®
; 
	}
})) \

1339 : 
	`__¡ºdup
 (
s
, 
n
)))

	)

1341 #ifdeà
__USE_GNU


1342 
	#¡ºdup
(
s
, 
n
è
	`__¡ºdup
 (s,‚)

	)

1348 #iâdeà
_FORCE_INLINES


1349 #undeà
__STRING_INLINE


	@/usr/include/bits/string3.h

18 #iâdeà
_STRING_H


22 
__w¬ndeş
 (
__w¬n_mem£t_z”o_Ën
,

25 #iâdeà
__ılu¥lus


29 #undeà
memıy


30 #undeà
memmove


31 #undeà
mem£t


32 #undeà
¡rÿt


33 #undeà
¡rıy


34 #undeà
¡ºÿt


35 #undeà
¡ºıy


36 #ifdeà
__USE_GNU


37 #undeà
mempıy


38 #undeà
¡pıy


40 #ifdeà
__USE_BSD


41 #undeà
bcİy


42 #undeà
bz”o


47 
__fÜtify_funùiÚ
 *

48 
__NTH
 (
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

49 
size_t
 
__Ën
))

51  
	`__butš___memıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

52 
	}
}

54 
__fÜtify_funùiÚ
 *

55 
__NTH
 (
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__Ën
))

57  
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

58 
	}
}

60 #ifdeà
__USE_GNU


61 
__fÜtify_funùiÚ
 *

62 
__NTH
 (
	$mempıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

63 
size_t
 
__Ën
))

65  
	`__butš___mempıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

66 
	}
}

75 
__fÜtify_funùiÚ
 *

76 
__NTH
 (
	$mem£t
 (*
__de¡
, 
__ch
, 
size_t
 
__Ën
))

78 ià(
	`__butš_cÚ¡ªt_p
 (
__Ën
) && __len == 0

79 && (!
	`__butš_cÚ¡ªt_p
 (
__ch
) || __ch != 0))

81 
	`__w¬n_mem£t_z”o_Ën
 ();

82  
__de¡
;

84  
	`__butš___mem£t_chk
 (
__de¡
, 
__ch
, 
__Ën
, 
	`__bos0
 (__dest));

85 
	}
}

87 #ifdeà
__USE_BSD


88 
__fÜtify_funùiÚ
 

89 
__NTH
 (
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__Ën
))

91 (è
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

92 
	}
}

94 
__fÜtify_funùiÚ
 

95 
__NTH
 (
	$bz”o
 (*
__de¡
, 
size_t
 
__Ën
))

97 (è
	`__butš___mem£t_chk
 (
__de¡
, '\0', 
__Ën
, 
	`__bos0
 (__dest));

98 
	}
}

101 
__fÜtify_funùiÚ
 *

102 
__NTH
 (
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

104  
	`__butš___¡rıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

105 
	}
}

107 #ifdeà
__USE_GNU


108 
__fÜtify_funùiÚ
 *

109 
__NTH
 (
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

111  
	`__butš___¡pıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

112 
	}
}

116 
__fÜtify_funùiÚ
 *

117 
__NTH
 (
	$¡ºıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

118 
size_t
 
__Ën
))

120  
	`__butš___¡ºıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

121 
	}
}

124 *
	$__¡²ıy_chk
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

125 
size_t
 
__de¡Ën
è
__THROW
;

126 *
	`__REDIRECT_NTH
 (
__¡²ıy_®Ÿs
, (*
__de¡
, cÚ¡ *
__¤c
,

127 
size_t
 
__n
), 
¡²ıy
);

129 
__fÜtify_funùiÚ
 *

130 
	`__NTH
 (
	$¡²ıy
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
))

132 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1

133 && (!
	`__butš_cÚ¡ªt_p
 (
__n
è|| __À<ğ
	`__bos
 (
__de¡
)))

134  
	`__¡²ıy_chk
 (
__de¡
, 
__¤c
, 
__n
, 
	`__bos
 (__dest));

135  
	`__¡²ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

136 
	}
}

139 
__fÜtify_funùiÚ
 *

140 
__NTH
 (
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

142  
	`__butš___¡rÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

143 
	}
}

146 
__fÜtify_funùiÚ
 *

147 
__NTH
 (
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

148 
size_t
 
__Ën
))

150  
	`__butš___¡ºÿt_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

151 
	}
}

	@/usr/include/bits/time.h

23 #ià
defšed
 
__Ãed_timev®
 || defšed 
__USE_GNU


24 #iâdeà
_STRUCT_TIMEVAL


25 
	#_STRUCT_TIMEVAL
 1

	)

26 
	~<b™s/ty³s.h
>

30 
	stimev®


32 
__time_t
 
	mtv_£c
;

33 
__su£cÚds_t
 
	mtv_u£c
;

38 #iâdeà
__Ãed_timev®


39 #iâdeà
_BITS_TIME_H


40 
	#_BITS_TIME_H
 1

	)

48 
	#CLOCKS_PER_SEC
 1000000l

	)

50 #ià(!
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_POSIX
) \

51 && !
defšed
 
	g__USE_XOPEN2K


54 
	~<b™s/ty³s.h
>

55 
__syscÚf
 ();

56 
	#CLK_TCK
 ((
__şock_t
è
	`__syscÚf
 (2)è

	)

59 #ifdeà
__USE_POSIX199309


61 
	#CLOCK_REALTIME
 0

	)

63 
	#CLOCK_MONOTONIC
 1

	)

65 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

67 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

69 
	#CLOCK_MONOTONIC_RAW
 4

	)

71 
	#CLOCK_REALTIME_COARSE
 5

	)

73 
	#CLOCK_MONOTONIC_COARSE
 6

	)

75 
	#CLOCK_BOOTTIME
 7

	)

77 
	#CLOCK_REALTIME_ALARM
 8

	)

79 
	#CLOCK_BOOTTIME_ALARM
 9

	)

82 
	#TIMER_ABSTIME
 1

	)

85 #ifdeà
__USE_GNU


86 
	~<b™s/timex.h
>

88 
__BEGIN_DECLS


91 
	$şock_adjtime
 (
__şockid_t
 
__şock_id
, 
timex
 *
__utx
è
__THROW
;

93 
__END_DECLS


99 #undeà
__Ãed_timev®


	@/usr/include/bits/types.h

23 #iâdef 
_BITS_TYPES_H


24 
	#_BITS_TYPES_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wÜdsize.h
>

30 
	t__u_ch¬
;

31 
	t__u_shÜt
;

32 
	t__u_št
;

33 
	t__u_lÚg
;

36 sigÃd 
	t__št8_t
;

37 
	t__ušt8_t
;

38 sigÃd 
	t__št16_t
;

39 
	t__ušt16_t
;

40 sigÃd 
	t__št32_t
;

41 
	t__ušt32_t
;

42 #ià
__WORDSIZE
 == 64

43 sigÃd 
	t__št64_t
;

44 
	t__ušt64_t
;

45 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


46 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

47 
__ex‹nsiÚ__
 
	t__ušt64_t
;

51 #ià
__WORDSIZE
 == 64

52 
	t__quad_t
;

53 
	t__u_quad_t
;

54 #–ià
defšed
 
__GLIBC_HAVE_LONG_LONG


55 
__ex‹nsiÚ__
 
	t__quad_t
;

56 
__ex‹nsiÚ__
 
	t__u_quad_t
;

60 
	m__v®
[2];

61 } 
	t__quad_t
;

64 
__u_lÚg
 
	m__v®
[2];

65 } 
	t__u_quad_t
;

98 
	#__S16_TYPE
 

	)

99 
	#__U16_TYPE
 

	)

100 
	#__S32_TYPE
 

	)

101 
	#__U32_TYPE
 

	)

102 
	#__SLONGWORD_TYPE
 

	)

103 
	#__ULONGWORD_TYPE
 

	)

104 #ià
__WORDSIZE
 == 32

105 
	#__SQUAD_TYPE
 
__quad_t


	)

106 
	#__UQUAD_TYPE
 
__u_quad_t


	)

107 
	#__SWORD_TYPE
 

	)

108 
	#__UWORD_TYPE
 

	)

109 
	#__SLONG32_TYPE
 

	)

110 
	#__ULONG32_TYPE
 

	)

111 
	#__S64_TYPE
 
__quad_t


	)

112 
	#__U64_TYPE
 
__u_quad_t


	)

115 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

116 #–ià
__WORDSIZE
 == 64

117 
	t__SQUAD_TYPE
 

	)

118 
	t__UQUAD_TYPE
 

	)

119 
	t__SWORD_TYPE
 

	)

120 
	t__UWORD_TYPE
 

	)

121 
	t__SLONG32_TYPE
 

	)

122 
	t__ULONG32_TYPE
 

	)

123 
	t__S64_TYPE
 

	)

124 
	t__U64_TYPE
 

	)

126 
	t__STD_TYPE
 

	)

130 
	~<b™s/ty³sizes.h
>

133 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

134 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

135 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

136 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

137 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

138 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

139 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

140 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

141 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

142 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

143 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

144 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__şock_t
;

145 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

146 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

147 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

148 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

149 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

150 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

152 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

153 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

156 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__şockid_t
;

159 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

162 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

167 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

168 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

171 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

172 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

175 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfút_t
;

176 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfút64_t
;

179 
__STD_TYPE
 
__FSWORD_T_TYPE
 
	g__fswÜd_t
;

181 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

184 
__STD_TYPE
 
__SYSCALL_SLONG_TYPE
 
	g__sysÿÎ_¦Úg_t
;

186 
__STD_TYPE
 
__SYSCALL_ULONG_TYPE
 
	g__sysÿÎ_ulÚg_t
;

190 
__off64_t
 
	t__loff_t
;

191 
__quad_t
 *
	t__qaddr_t
;

192 *
	t__ÿddr_t
;

195 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

198 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

201 #undeà
__STD_TYPE


	@/usr/include/bits/waitflags.h

19 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


25 
	#WNOHANG
 1

	)

26 
	#WUNTRACED
 2

	)

29 
	#WSTOPPED
 2

	)

30 
	#WEXITED
 4

	)

31 
	#WCONTINUED
 8

	)

32 
	#WNOWAIT
 0x01000000

	)

34 
	#__WNOTHREAD
 0x20000000

	)

36 
	#__WALL
 0x40000000

	)

37 
	#__WCLONE
 0x80000000

	)

	@/usr/include/bits/waitstatus.h

19 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


28 
	#__WEXITSTATUS
(
¡©us
è(((¡©usè& 0xff00è>> 8)

	)

31 
	#__WTERMSIG
(
¡©us
è((¡©usè& 0x7f)

	)

34 
	#__WSTOPSIG
(
¡©us
è
	`__WEXITSTATUS
(¡©us)

	)

37 
	#__WIFEXITED
(
¡©us
è(
	`__WTERMSIG
(¡©usè=ğ0)

	)

40 
	#__WIFSIGNALED
(
¡©us
) \

41 (((sigÃd è(((
¡©us
è& 0x7fè+ 1è>> 1è> 0)

	)

44 
	#__WIFSTOPPED
(
¡©us
è(((¡©usè& 0xffè=ğ0x7f)

	)

48 #ifdeà
WCONTINUED


49 
	#__WIFCONTINUED
(
¡©us
è((¡©usè=ğ
__W_CONTINUED
)

	)

53 
	#__WCOREDUMP
(
¡©us
è((¡©usè& 
__WCOREFLAG
)

	)

56 
	#__W_EXITCODE
(
»t
, 
sig
è(Ô‘è<< 8 | (sig))

	)

57 
	#__W_STOPCODE
(
sig
è((sigè<< 8 | 0x7f)

	)

58 
	#__W_CONTINUED
 0xffff

	)

59 
	#__WCOREFLAG
 0x80

	)

62 #ifdef 
__USE_BSD


64 
	~<’dŸn.h
>

66 
	uwa™


68 
	mw_¡©us
;

71 #if 
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


72 
	m__w_‹rmsig
:7;

73 
	m__w_cÜedump
:1;

74 
	m__w_»tcode
:8;

77 #if 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


79 
	m__w_»tcode
:8;

80 
	m__w_cÜedump
:1;

81 
	m__w_‹rmsig
:7;

83 } 
	m__wa™_‹rmš©ed
;

86 #if 
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


87 
	m__w_¡İv®
:8;

88 
	m__w_¡İsig
:8;

91 #if 
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


93 
	m__w_¡İsig
:8;

94 
	m__w_¡İv®
:8;

96 } 
	m__wa™_¡İ³d
;

99 
	#w_‹rmsig
 
__wa™_‹rmš©ed
.
__w_‹rmsig


	)

100 
	#w_cÜedump
 
__wa™_‹rmš©ed
.
__w_cÜedump


	)

101 
	#w_»tcode
 
__wa™_‹rmš©ed
.
__w_»tcode


	)

102 
	#w_¡İsig
 
__wa™_¡İ³d
.
__w_¡İsig


	)

103 
	#w_¡İv®
 
__wa™_¡İ³d
.
__w_¡İv®


	)

	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_BSD
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

62 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


63 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

64 
	#htŞe16
(
x
è(x)

	)

65 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

66 
	#Ë16toh
(
x
è(x)

	)

68 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

69 
	#htŞe32
(
x
è(x)

	)

70 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

71 
	#Ë32toh
(
x
è(x)

	)

73 #ià
__GLIBC_HAVE_LONG_LONG


74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è(x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è(x)

	)

81 
	#htobe16
(
x
è(x)

	)

82 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

83 
	#be16toh
(
x
è(x)

	)

84 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

86 
	#htobe32
(
x
è(x)

	)

87 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

88 
	#be32toh
(
x
è(x)

	)

89 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

91 #ià
__GLIBC_HAVE_LONG_LONG


92 
	#htobe64
(
x
è(x)

	)

93 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

94 
	#be64toh
(
x
è(x)

	)

95 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

98 #undeà
__USE_ISOC11


99 #undeà
__USE_ISOC99


100 #undeà
__USE_ISOC95


101 #undeà
__USE_ISOCXX11


102 #undeà
__USE_POSIX


103 #undeà
__USE_POSIX2


104 #undeà
__USE_POSIX199309


105 #undeà
__USE_POSIX199506


106 #undeà
__USE_XOPEN


107 #undeà
__USE_XOPEN_EXTENDED


108 #undeà
__USE_UNIX98


109 #undeà
__USE_XOPEN2K


110 #undeà
__USE_XOPEN2KXSI


111 #undeà
__USE_XOPEN2K8


112 #undeà
__USE_XOPEN2K8XSI


113 #undeà
__USE_LARGEFILE


114 #undeà
__USE_LARGEFILE64


115 #undeà
__USE_FILE_OFFSET64


116 #undeà
__USE_BSD


117 #undeà
__USE_SVID


118 #undeà
__USE_MISC


119 #undeà
__USE_ATFILE


120 #undeà
__USE_GNU


121 #undeà
__USE_REENTRANT


122 #undeà
__USE_FORTIFY_LEVEL


123 #undeà
__FAVOR_BSD


124 #undeà
__KERNEL_STRICT_NAMES


128 #iâdeà
_LOOSE_KERNEL_NAMES


129 
	#__KERNEL_STRICT_NAMES


	)

133 
	#__USE_ANSI
 1

	)

142 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


143 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

144 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

146 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

151 #ià
defšed
 
_BSD_SOURCE
 && \

152 !(
defšed
 
	g_POSIX_SOURCE
 || defšed 
	g_POSIX_C_SOURCE
 || \

153 
defšed
 
	g_XOPEN_SOURCE
 || defšed 
	g_GNU_SOURCE
 || defšed 
	g_SVID_SOURCE
)

154 
	#__FAVOR_BSD
 1

	)

158 #ifdeà
_GNU_SOURCE


159 #undeà
_ISOC95_SOURCE


160 
	#_ISOC95_SOURCE
 1

	)

161 #undeà
_ISOC99_SOURCE


162 
	#_ISOC99_SOURCE
 1

	)

163 #undeà
_ISOC11_SOURCE


164 
	#_ISOC11_SOURCE
 1

	)

165 #undeà
_POSIX_SOURCE


166 
	#_POSIX_SOURCE
 1

	)

167 #undeà
_POSIX_C_SOURCE


168 
	#_POSIX_C_SOURCE
 200809L

	)

169 #undeà
_XOPEN_SOURCE


170 
	#_XOPEN_SOURCE
 700

	)

171 #undeà
_XOPEN_SOURCE_EXTENDED


172 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

173 #undeà
_LARGEFILE64_SOURCE


174 
	#_LARGEFILE64_SOURCE
 1

	)

175 #undeà
_BSD_SOURCE


176 
	#_BSD_SOURCE
 1

	)

177 #undeà
_SVID_SOURCE


178 
	#_SVID_SOURCE
 1

	)

179 #undeà
_ATFILE_SOURCE


180 
	#_ATFILE_SOURCE
 1

	)

185 #ià(!
defšed
 
__STRICT_ANSI__
 && !defšed 
_ISOC99_SOURCE
 && \

186 !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 && \

187 !
defšed
 
	g_XOPEN_SOURCE
 && !defšed 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
)

188 
	#_BSD_SOURCE
 1

	)

189 
	#_SVID_SOURCE
 1

	)

193 #ià(
defšed
 
_ISOC11_SOURCE
 \

194 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

195 
	#__USE_ISOC11
 1

	)

199 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

200 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

201 
	#__USE_ISOC99
 1

	)

205 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

206 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

207 
	#__USE_ISOC95
 1

	)

214 #ià((
defšed
 
__ılu¥lus
 && __cplusplus >= 201103L) \

215 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

216 
	#__USE_ISOCXX11
 1

	)

221 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

222 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

223 
	#_POSIX_SOURCE
 1

	)

224 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

225 
	#_POSIX_C_SOURCE
 2

	)

226 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

227 
	#_POSIX_C_SOURCE
 199506L

	)

228 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

229 
	#_POSIX_C_SOURCE
 200112L

	)

231 
	#_POSIX_C_SOURCE
 200809L

	)

233 
	#__USE_POSIX_IMPLICITLY
 1

	)

236 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


237 
	#__USE_POSIX
 1

	)

240 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


241 
	#__USE_POSIX2
 1

	)

244 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

245 
	#__USE_POSIX199309
 1

	)

248 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

249 
	#__USE_POSIX199506
 1

	)

252 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

253 
	#__USE_XOPEN2K
 1

	)

254 #undeà
__USE_ISOC95


255 
	#__USE_ISOC95
 1

	)

256 #undeà
__USE_ISOC99


257 
	#__USE_ISOC99
 1

	)

260 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

261 
	#__USE_XOPEN2K8
 1

	)

262 #undeà
_ATFILE_SOURCE


263 
	#_ATFILE_SOURCE
 1

	)

266 #ifdef 
_XOPEN_SOURCE


267 
	#__USE_XOPEN
 1

	)

268 #ià(
_XOPEN_SOURCE
 - 0) >= 500

269 
	#__USE_XOPEN_EXTENDED
 1

	)

270 
	#__USE_UNIX98
 1

	)

271 #undeà
_LARGEFILE_SOURCE


272 
	#_LARGEFILE_SOURCE
 1

	)

273 #ià(
_XOPEN_SOURCE
 - 0) >= 600

274 #ià(
_XOPEN_SOURCE
 - 0) >= 700

275 
	#__USE_XOPEN2K8
 1

	)

276 
	#__USE_XOPEN2K8XSI
 1

	)

278 
	#__USE_XOPEN2K
 1

	)

279 
	#__USE_XOPEN2KXSI
 1

	)

280 #undeà
__USE_ISOC95


281 
	#__USE_ISOC95
 1

	)

282 #undeà
__USE_ISOC99


283 
	#__USE_ISOC99
 1

	)

286 #ifdeà
_XOPEN_SOURCE_EXTENDED


287 
	#__USE_XOPEN_EXTENDED
 1

	)

292 #ifdeà
_LARGEFILE_SOURCE


293 
	#__USE_LARGEFILE
 1

	)

296 #ifdeà
_LARGEFILE64_SOURCE


297 
	#__USE_LARGEFILE64
 1

	)

300 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

301 
	#__USE_FILE_OFFSET64
 1

	)

304 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


305 
	#__USE_MISC
 1

	)

308 #ifdef 
_BSD_SOURCE


309 
	#__USE_BSD
 1

	)

312 #ifdef 
_SVID_SOURCE


313 
	#__USE_SVID
 1

	)

316 #ifdef 
_ATFILE_SOURCE


317 
	#__USE_ATFILE
 1

	)

320 #ifdef 
_GNU_SOURCE


321 
	#__USE_GNU
 1

	)

324 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


325 
	#__USE_REENTRANT
 1

	)

328 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0

329 #ià!
defšed
 
__OPTIMIZE__
 || __OPTIMIZE__ <= 0

330 #w¬nšg 
_FORTIFY_SOURCE
 
»quœes
 
compšg
 
w™h
 
İtimiz©iÚ
 (-
O
)

331 #–ià!
__GNUC_PREREQ
 (4, 1)

332 #w¬nšg 
_FORTIFY_SOURCE
 
»quœes
 
GCC
 4.1 
Ü
 
Ï‹r


333 #–ià
_FORTIFY_SOURCE
 > 1

334 
	#__USE_FORTIFY_LEVEL
 2

	)

336 
	#__USE_FORTIFY_LEVEL
 1

	)

339 #iâdeà
__USE_FORTIFY_LEVEL


340 
	#__USE_FORTIFY_LEVEL
 0

	)

345 
	~<¡dc-´edef.h
>

353 #undeà
__GNU_LIBRARY__


354 
	#__GNU_LIBRARY__
 6

	)

358 
	#__GLIBC__
 2

	)

359 
	#__GLIBC_MINOR__
 17

	)

361 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

362 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

365 #ià
defšed
 
__GNUC__
 \

366 || (
defšed
 
	g__PGI
 && defšed 
	g__i386__
 ) \

367 || (
defšed
 
	g__INTEL_COMPILER
 && (defšed 
	g__i386__
 || defšed 
	g__Ÿ64__
)) \

368 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

369 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

373 #iâdeà
__ASSEMBLER__


374 #iâdeà
_SYS_CDEFS_H


375 
	~<sys/cdefs.h
>

380 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


381 
	#__USE_LARGEFILE
 1

	)

382 
	#__USE_LARGEFILE64
 1

	)

388 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

389 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

390 && 
defšed
 
	g__ex‹º_šlše


391 
	#__USE_EXTERN_INLINES
 1

	)

399 
	~<gnu/¡ubs.h
>

	@/usr/include/limits.h

23 #iâdeà
_LIBC_LIMITS_H_


24 
	#_LIBC_LIMITS_H_
 1

	)

26 
	~<ã©u»s.h
>

32 
	#MB_LEN_MAX
 16

	)

37 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

42 #iâdeà
_LIMITS_H


43 
	#_LIMITS_H
 1

	)

45 
	~<b™s/wÜdsize.h
>

54 
	#CHAR_BIT
 8

	)

57 
	#SCHAR_MIN
 (-128)

	)

58 
	#SCHAR_MAX
 127

	)

61 
	#UCHAR_MAX
 255

	)

64 #ifdeà
__CHAR_UNSIGNED__


65 
	#CHAR_MIN
 0

	)

66 
	#CHAR_MAX
 
UCHAR_MAX


	)

68 
	#CHAR_MIN
 
SCHAR_MIN


	)

69 
	#CHAR_MAX
 
SCHAR_MAX


	)

73 
	#SHRT_MIN
 (-32768)

	)

74 
	#SHRT_MAX
 32767

	)

77 
	#USHRT_MAX
 65535

	)

80 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

81 
	#INT_MAX
 2147483647

	)

84 
	#UINT_MAX
 4294967295U

	)

87 #ià
__WORDSIZE
 == 64

88 
	#LONG_MAX
 9223372036854775807L

	)

90 
	#LONG_MAX
 2147483647L

	)

92 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

95 #ià
__WORDSIZE
 == 64

96 
	#ULONG_MAX
 18446744073709551615UL

	)

98 
	#ULONG_MAX
 4294967295UL

	)

101 #ifdeà
__USE_ISOC99


104 
	#LLONG_MAX
 9223372036854775807LL

	)

105 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

108 
	#ULLONG_MAX
 18446744073709551615ULL

	)

122 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


124 #šşude_Ãxˆ<
lim™s
.
h
>

130 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


131 #iâdeà
LLONG_MIN


132 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

134 #iâdeà
LLONG_MAX


135 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

137 #iâdeà
ULLONG_MAX


138 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

142 #ifdef 
__USE_POSIX


144 
	~<b™s/posix1_lim.h
>

147 #ifdef 
__USE_POSIX2


148 
	~<b™s/posix2_lim.h
>

151 #ifdef 
__USE_XOPEN


152 
	~<b™s/xİ’_lim.h
>

	@/usr/include/netinet/in.h

19 #iâdef 
_NETINET_IN_H


20 
	#_NETINET_IN_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	~<¡dšt.h
>

24 
	~<sys/sock‘.h
>

25 
	~<b™s/ty³s.h
>

28 
__BEGIN_DECLS


31 
ušt32_t
 
	tš_addr_t
;

32 
	sš_addr


34 
š_addr_t
 
	ms_addr
;

38 
	~<b™s/š.h
>

43 
	mIPPROTO_IP
 = 0,

44 
	#IPPROTO_IP
 
IPPROTO_IP


	)

45 
	mIPPROTO_ICMP
 = 1,

46 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

47 
	mIPPROTO_IGMP
 = 2,

48 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

49 
	mIPPROTO_IPIP
 = 4,

50 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

51 
	mIPPROTO_TCP
 = 6,

52 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

53 
	mIPPROTO_EGP
 = 8,

54 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

55 
	mIPPROTO_PUP
 = 12,

56 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

57 
	mIPPROTO_UDP
 = 17,

58 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

59 
	mIPPROTO_IDP
 = 22,

60 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

61 
	mIPPROTO_TP
 = 29,

62 
	#IPPROTO_TP
 
IPPROTO_TP


	)

63 
	mIPPROTO_DCCP
 = 33,

64 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

65 
	mIPPROTO_IPV6
 = 41,

66 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

67 
	mIPPROTO_RSVP
 = 46,

68 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

69 
	mIPPROTO_GRE
 = 47,

70 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

71 
	mIPPROTO_ESP
 = 50,

72 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

73 
	mIPPROTO_AH
 = 51,

74 
	#IPPROTO_AH
 
IPPROTO_AH


	)

75 
	mIPPROTO_MTP
 = 92,

76 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

77 
	mIPPROTO_BEETPH
 = 94,

78 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

79 
	mIPPROTO_ENCAP
 = 98,

80 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

81 
	mIPPROTO_PIM
 = 103,

82 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

83 
	mIPPROTO_COMP
 = 108,

84 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

85 
	mIPPROTO_SCTP
 = 132,

86 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

87 
	mIPPROTO_UDPLITE
 = 136,

88 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

89 
	mIPPROTO_RAW
 = 255,

90 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

91 
	mIPPROTO_MAX


97 #ià!
__USE_KERNEL_IPV6_DEFS


100 
	mIPPROTO_HOPOPTS
 = 0,

101 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

102 
	mIPPROTO_ROUTING
 = 43,

103 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

104 
	mIPPROTO_FRAGMENT
 = 44,

105 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

106 
	mIPPROTO_ICMPV6
 = 58,

107 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

108 
	mIPPROTO_NONE
 = 59,

109 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

110 
	mIPPROTO_DSTOPTS
 = 60,

111 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

112 
	mIPPROTO_MH
 = 135

113 
	#IPPROTO_MH
 
IPPROTO_MH


	)

118 
ušt16_t
 
	tš_pÜt_t
;

123 
	mIPPORT_ECHO
 = 7,

124 
	mIPPORT_DISCARD
 = 9,

125 
	mIPPORT_SYSTAT
 = 11,

126 
	mIPPORT_DAYTIME
 = 13,

127 
	mIPPORT_NETSTAT
 = 15,

128 
	mIPPORT_FTP
 = 21,

129 
	mIPPORT_TELNET
 = 23,

130 
	mIPPORT_SMTP
 = 25,

131 
	mIPPORT_TIMESERVER
 = 37,

132 
	mIPPORT_NAMESERVER
 = 42,

133 
	mIPPORT_WHOIS
 = 43,

134 
	mIPPORT_MTP
 = 57,

136 
	mIPPORT_TFTP
 = 69,

137 
	mIPPORT_RJE
 = 77,

138 
	mIPPORT_FINGER
 = 79,

139 
	mIPPORT_TTYLINK
 = 87,

140 
	mIPPORT_SUPDUP
 = 95,

143 
	mIPPORT_EXECSERVER
 = 512,

144 
	mIPPORT_LOGINSERVER
 = 513,

145 
	mIPPORT_CMDSERVER
 = 514,

146 
	mIPPORT_EFSSERVER
 = 520,

149 
	mIPPORT_BIFFUDP
 = 512,

150 
	mIPPORT_WHOSERVER
 = 513,

151 
	mIPPORT_ROUTESERVER
 = 520,

154 
	mIPPORT_RESERVED
 = 1024,

157 
	mIPPORT_USERRESERVED
 = 5000

165 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

166 
	#IN_CLASSA_NET
 0xff000000

	)

167 
	#IN_CLASSA_NSHIFT
 24

	)

168 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

169 
	#IN_CLASSA_MAX
 128

	)

171 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

172 
	#IN_CLASSB_NET
 0xffff0000

	)

173 
	#IN_CLASSB_NSHIFT
 16

	)

174 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

175 
	#IN_CLASSB_MAX
 65536

	)

177 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

178 
	#IN_CLASSC_NET
 0xffffff00

	)

179 
	#IN_CLASSC_NSHIFT
 8

	)

180 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

182 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

183 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

185 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

186 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

189 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

191 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

193 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

196 
	#IN_LOOPBACKNET
 127

	)

198 #iâdeà
INADDR_LOOPBACK


199 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

203 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

204 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

205 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

206 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

208 #ià!
__USE_KERNEL_IPV6_DEFS


210 
	sš6_addr


214 
ušt8_t
 
	m__u6_addr8
[16];

215 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


216 
ušt16_t
 
	m__u6_addr16
[8];

217 
ušt32_t
 
	m__u6_addr32
[4];

219 } 
	m__š6_u
;

220 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

221 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


222 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

223 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

228 cÚ¡ 
š6_addr
 
š6addr_ªy
;

229 cÚ¡ 
š6_addr
 
š6addr_loİback
;

230 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

231 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

233 
	#INET_ADDRSTRLEN
 16

	)

234 
	#INET6_ADDRSTRLEN
 46

	)

238 
	ssockaddr_š


240 
__SOCKADDR_COMMON
 (
sš_
);

241 
š_pÜt_t
 
	msš_pÜt
;

242 
š_addr
 
	msš_addr
;

245 
	msš_z”o
[ (
sockaddr
) -

246 
__SOCKADDR_COMMON_SIZE
 -

247  (
š_pÜt_t
) -

248  (
š_addr
)];

251 #ià!
__USE_KERNEL_IPV6_DEFS


253 
	ssockaddr_š6


255 
__SOCKADDR_COMMON
 (
sš6_
);

256 
š_pÜt_t
 
	msš6_pÜt
;

257 
ušt32_t
 
	msš6_æowšfo
;

258 
š6_addr
 
	msš6_addr
;

259 
ušt32_t
 
	msš6_scİe_id
;

263 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


265 
	s_m»q


268 
š_addr
 
	mimr_muÉŸddr
;

271 
š_addr
 
	mimr_š‹rçû
;

274 
	s_m»q_sourû


277 
š_addr
 
	mimr_muÉŸddr
;

280 
š_addr
 
	mimr_š‹rçû
;

283 
š_addr
 
	mimr_sourûaddr
;

287 #ià!
__USE_KERNEL_IPV6_DEFS


289 
	sv6_m»q


292 
š6_addr
 
	mv6mr_muÉŸddr
;

295 
	mv6mr_š‹rçû
;

299 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


301 
	sgroup_»q


304 
ušt32_t
 
	mgr_š‹rçû
;

307 
sockaddr_¡Üage
 
	mgr_group
;

310 
	sgroup_sourû_»q


313 
ušt32_t
 
	mg¤_š‹rçû
;

316 
sockaddr_¡Üage
 
	mg¤_group
;

319 
sockaddr_¡Üage
 
	mg¤_sourû
;

324 
	s_msf‹r


327 
š_addr
 
	mimsf_muÉŸddr
;

330 
š_addr
 
	mimsf_š‹rçû
;

333 
ušt32_t
 
	mimsf_fmode
;

336 
ušt32_t
 
	mimsf_num¤c
;

338 
š_addr
 
	mimsf_¦i¡
[1];

341 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

342 -  (
š_addr
) \

343 + (
num¤c
è*  (
š_addr
))

	)

345 
	sgroup_f‹r


348 
ušt32_t
 
	mgf_š‹rçû
;

351 
sockaddr_¡Üage
 
	mgf_group
;

354 
ušt32_t
 
	mgf_fmode
;

357 
ušt32_t
 
	mgf_num¤c
;

359 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

362 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

363 -  (
sockaddr_¡Üage
) \

364 + ((
num¤c
) \

365 *  (
sockaddr_¡Üage
)))

	)

375 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

376 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

377 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

378 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

379 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

380 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

381 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

383 
	~<’dŸn.h
>

386 
	~<b™s/by‹sw­.h
>

388 #ifdeà
__OPTIMIZE__


392 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


395 
	#Áohl
(
x
è(x)

	)

396 
	#Áohs
(
x
è(x)

	)

397 
	#htÚl
(
x
è(x)

	)

398 
	#htÚs
(
x
è(x)

	)

400 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


401 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

402 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

403 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

404 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

409 #ifdeà
__GNUC__


410 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

411 (
__ex‹nsiÚ__
 \

412 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

413 
__a
->
s6_addr32
[0] == 0 \

414 && 
__a
->
s6_addr32
[1] == 0 \

415 && 
__a
->
s6_addr32
[2] == 0 \

416 && 
__a
->
s6_addr32
[3] =ğ0; 
	}
}))

	)

418 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

419 (
__ex‹nsiÚ__
 \

420 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

421 
__a
->
s6_addr32
[0] == 0 \

422 && 
__a
->
s6_addr32
[1] == 0 \

423 && 
__a
->
s6_addr32
[2] == 0 \

424 && 
__a
->
s6_addr32
[3] =ğ
	`htÚl
 (1); }))

	)

426 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

427 (
__ex‹nsiÚ__
 \

428 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

429 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xã800000); }))

	)

431 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

432 (
__ex‹nsiÚ__
 \

433 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

434 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xãc00000); }))

	)

436 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

437 (
__ex‹nsiÚ__
 \

438 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

439 
__a
->
s6_addr32
[0] == 0 \

440 && 
__a
->
s6_addr32
[1] == 0 \

441 && 
__a
->
s6_addr32
[2] =ğ
	`htÚl
 (0xffff); }))

	)

443 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

444 (
__ex‹nsiÚ__
 \

445 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

446 
__a
->
s6_addr32
[0] == 0 \

447 && 
__a
->
s6_addr32
[1] == 0 \

448 && 
__a
->
s6_addr32
[2] == 0 \

449 && 
	`Áohl
 (
__a
->
s6_addr32
[3]è> 1; }))

	)

451 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

452 (
__ex‹nsiÚ__
 \

453 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

454 cÚ¡ 
š6_addr
 *
__b
 = (cÚ¡ š6_add¸*è(
b
); \

455 
__a
->
s6_addr32
[0] =ğ
__b
->s6_addr32[0] \

456 && 
__a
->
s6_addr32
[1] =ğ
__b
->s6_addr32[1] \

457 && 
__a
->
s6_addr32
[2] =ğ
__b
->s6_addr32[2] \

458 && 
__a
->
s6_addr32
[3] =ğ
__b
->s6_addr32[3]; }))

	)

460 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

461 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

462 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

463 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

464 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

466 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

467 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

468 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

469 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

470 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

472 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

473 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

474 =ğ
	`htÚl
 (0xã800000))

	)

476 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

477 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

478 =ğ
	`htÚl
 (0xãc00000))

	)

480 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

481 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

482 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

483 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

485 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

486 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

487 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

488 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0) \

489 && (
	`Áohl
 (((cÚ¡ 
ušt32_t
 *è(
a
))[3]è> 1))

	)

491 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

492 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[0]) \

493 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[1]) \

494 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[2]) \

495 && (((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

498 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((cÚ¡ 
ušt8_t
 *è×))[0] =ğ0xff)

	)

500 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


502 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

505 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

506 
__THROW
;

510 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

511 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

512 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

514 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

515 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

516 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

518 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

519 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

520 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

522 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

523 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

524 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

526 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

527 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

528 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

531 #ifdeà
__USE_GNU


532 
cmsghdr
;

534 #ià!
__USE_KERNEL_IPV6_DEFS


536 
	sš6_pktšfo


538 
š6_addr
 
i6_addr
;

539 
i6_ifšdex
;

543 
	s6_mtušfo


545 
sockaddr_š6
 
6m_addr
;

546 
ušt32_t
 
6m_mtu
;

551 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

552 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

553 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

554 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

555 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

556 cÚ¡ 
ušt8_t
 *
__ty³p
, 
__muÉx
,

557 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

558 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

559 
__muÉx
, 
__¶usy
)

560 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

561 
	$š‘6_İtiÚ_Ãxt
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

562 
ušt8_t
 **
__Œp
)

563 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

564 
	$š‘6_İtiÚ_fšd
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

565 
ušt8_t
 **
__Œp
, 
__ty³
)

566 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

570 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

571 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

572 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

573 **
__d©abuå
è
__THROW
;

574 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

575 
__THROW
;

576 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

577 
sockËn_t
 
__v®Ën
è
__THROW
;

578 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

579 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

580 **
__d©abuå
è
__THROW
;

581 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

582 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

583 **
__d©abuå
è
__THROW
;

584 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

585 
sockËn_t
 
__v®Ën
è
__THROW
;

589 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

590 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

591 
__£gm’ts
è
__THROW
;

592 
	$š‘6_¹h_add
 (*
__bp
, cÚ¡ 
š6_addr
 *
__addr
è
__THROW
;

593 
	$š‘6_¹h_»v”£
 (cÚ¡ *
__š
, *
__out
è
__THROW
;

594 
	$š‘6_¹h_£gm’ts
 (cÚ¡ *
__bp
è
__THROW
;

595 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (cÚ¡ *
__bp
, 
__šdex
)

596 
__THROW
;

602 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

603 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

604 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

605 
__THROW
;

608 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

609 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

610 
ušt32_t
 
__num¤c
,

611 cÚ¡ 
š_addr
 *
__¦i¡
)

612 
__THROW
;

616 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

617 cÚ¡ 
sockaddr
 *
__group
,

618 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

619 
ušt32_t
 *
__num¤c
,

620 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

623 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

624 cÚ¡ 
sockaddr
 *
__group
,

625 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

626 
ušt32_t
 
__num¤c
,

627 cÚ¡ 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

630 
__END_DECLS


	@/usr/include/strings.h

19 #iâdef 
_STRINGS_H


20 
	#_STRINGS_H
 1

	)

25 #ià!
defšed
 
_STRING_H
 || !defšed 
__USE_BSD


27 
	~<ã©u»s.h
>

28 
	#__Ãed_size_t


	)

29 
	~<¡ddef.h
>

32 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

33 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

36 
	g__BEGIN_DECLS


38 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


40 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

41 
__THROW
 
__©Œibu‹_pu»__
;

44 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
è
__THROW
;

47 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
;

50 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


53 *
	`šdex
 (*
__s
, 
__c
)

54 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

55 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

56 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

58 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRING_H_PROTO


59 
__ex‹º_®ways_šlše
 *

60 
	`šdex
 (*
__s
, 
__c
è
__THROW


62  
	`__butš_šdex
 (
__s
, 
__c
);

65 
__ex‹º_®ways_šlše
 const *

66 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


68  
	`__butš_šdex
 (
__s
, 
__c
);

71 
	}
}

73 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

74 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


81 *
	`ršdex
 (*
__s
, 
__c
)

82 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

83 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

84 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

86 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRING_H_PROTO


87 
__ex‹º_®ways_šlše
 *

88 
	`ršdex
 (*
__s
, 
__c
è
__THROW


90  
	`__butš_ršdex
 (
__s
, 
__c
);

93 
__ex‹º_®ways_šlše
 const *

94 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


96  
	`__butš_ršdex
 (
__s
, 
__c
);

99 
	}
}

101 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

102 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8
 || defšed 
__USE_XOPEN2K8XSI


109 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((const));

113 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

114 
__THROW
 
__©Œibu‹_pu»__
;

117 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

118 
__THROW
 
__©Œibu‹_pu»__
;

120 #ifdef 
__USE_XOPEN2K8


124 
	~<xloÿË.h
>

128 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
__loÿË_t
 
__loc
)

129 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

131 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

132 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

133 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

136 
__END_DECLS


	@/usr/include/sys/types.h

22 #iâdef 
_SYS_TYPES_H


23 
	#_SYS_TYPES_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ty³s.h
>

31 #ifdef 
__USE_BSD


32 #iâdeà
__u_ch¬_defšed


33 
__u_ch¬
 
	tu_ch¬
;

34 
__u_shÜt
 
	tu_shÜt
;

35 
__u_št
 
	tu_št
;

36 
__u_lÚg
 
	tu_lÚg
;

37 
__quad_t
 
	tquad_t
;

38 
__u_quad_t
 
	tu_quad_t
;

39 
__fsid_t
 
	tfsid_t
;

40 
	#__u_ch¬_defšed


	)

44 
__loff_t
 
	tloff_t
;

46 #iâdeà
__šo_t_defšed


47 #iâdeà
__USE_FILE_OFFSET64


48 
__šo_t
 
	tšo_t
;

50 
__šo64_t
 
	tšo_t
;

52 
	#__šo_t_defšed


	)

54 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


55 
__šo64_t
 
	tšo64_t
;

56 
	#__šo64_t_defšed


	)

59 #iâdeà
__dev_t_defšed


60 
__dev_t
 
	tdev_t
;

61 
	#__dev_t_defšed


	)

64 #iâdeà
__gid_t_defšed


65 
__gid_t
 
	tgid_t
;

66 
	#__gid_t_defšed


	)

69 #iâdeà
__mode_t_defšed


70 
__mode_t
 
	tmode_t
;

71 
	#__mode_t_defšed


	)

74 #iâdeà
__Æšk_t_defšed


75 
__Æšk_t
 
	tÆšk_t
;

76 
	#__Æšk_t_defšed


	)

79 #iâdeà
__uid_t_defšed


80 
__uid_t
 
	tuid_t
;

81 
	#__uid_t_defšed


	)

84 #iâdeà
__off_t_defšed


85 #iâdeà
__USE_FILE_OFFSET64


86 
__off_t
 
	toff_t
;

88 
__off64_t
 
	toff_t
;

90 
	#__off_t_defšed


	)

92 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


93 
__off64_t
 
	toff64_t
;

94 
	#__off64_t_defšed


	)

97 #iâdeà
__pid_t_defšed


98 
__pid_t
 
	tpid_t
;

99 
	#__pid_t_defšed


	)

102 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
) \

103 && !
defšed
 
__id_t_defšed


104 
__id_t
 
	tid_t
;

105 
	#__id_t_defšed


	)

108 #iâdeà
__ssize_t_defšed


109 
__ssize_t
 
	tssize_t
;

110 
	#__ssize_t_defšed


	)

113 #ifdef 
__USE_BSD


114 #iâdeà
__daddr_t_defšed


115 
__daddr_t
 
	tdaddr_t
;

116 
__ÿddr_t
 
	tÿddr_t
;

117 
	#__daddr_t_defšed


	)

121 #ià(
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN
è&& !defšed 
__key_t_defšed


122 
__key_t
 
	tkey_t
;

123 
	#__key_t_defšed


	)

126 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


127 
	#__Ãed_şock_t


	)

129 
	#__Ãed_time_t


	)

130 
	#__Ãed_tim”_t


	)

131 
	#__Ãed_şockid_t


	)

132 
	~<time.h
>

134 #ifdeà
__USE_XOPEN


135 #iâdeà
__u£cÚds_t_defšed


136 
__u£cÚds_t
 
	tu£cÚds_t
;

137 
	#__u£cÚds_t_defšed


	)

139 #iâdeà
__su£cÚds_t_defšed


140 
__su£cÚds_t
 
	tsu£cÚds_t
;

141 
	#__su£cÚds_t_defšed


	)

145 
	#__Ãed_size_t


	)

146 
	~<¡ddef.h
>

148 #ifdeà
__USE_MISC


150 
	tulÚg
;

151 
	tushÜt
;

152 
	tušt
;

157 #ià!
__GNUC_PREREQ
 (2, 7)

160 #iâdeà
__št8_t_defšed


161 
	#__št8_t_defšed


	)

162 
	tšt8_t
;

163 
	tšt16_t
;

164 
	tšt32_t
;

165 #ià
__WORDSIZE
 == 64

166 
	tšt64_t
;

167 #–ià
__GLIBC_HAVE_LONG_LONG


168 
__ex‹nsiÚ__
 
	tšt64_t
;

173 
	tu_št8_t
;

174 
	tu_št16_t
;

175 
	tu_št32_t
;

176 #ià
__WORDSIZE
 == 64

177 
	tu_št64_t
;

178 #–ià
__GLIBC_HAVE_LONG_LONG


179 
__ex‹nsiÚ__
 
	tu_št64_t
;

182 
	t»gi¡”_t
;

187 
	#__štN_t
(
N
, 
MODE
) \

188 ##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

189 
	t__u_štN_t
(
	tN
, 
	tMODE
) \

190 
	tu_št
##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

192 #iâdeà
	t__št8_t_defšed


193 
	t__št8_t_defšed


	)

194 
	t__štN_t
 (8, 
	t__QI__
);

195 
__štN_t
 (16, 
__HI__
);

196 
__štN_t
 (32, 
__SI__
);

197 
__štN_t
 (64, 
__DI__
);

200 
__u_štN_t
 (8, 
__QI__
);

201 
__u_štN_t
 (16, 
__HI__
);

202 
__u_štN_t
 (32, 
__SI__
);

203 
__u_štN_t
 (64, 
__DI__
);

205 
	t»gi¡”_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__wÜd__
)));

211 
	#__BIT_TYPES_DEFINED__
 1

	)

214 #ifdef 
__USE_BSD


216 
	~<’dŸn.h
>

219 
	~<sys/£Ëù.h
>

222 
	~<sys/sysmaüos.h
>

226 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
) \

227 && !
defšed
 
__blksize_t_defšed


228 
__blksize_t
 
	tblksize_t
;

229 
	#__blksize_t_defšed


	)

233 #iâdeà
__USE_FILE_OFFSET64


234 #iâdeà
__blkút_t_defšed


235 
__blkút_t
 
	tblkút_t
;

236 
	#__blkút_t_defšed


	)

238 #iâdeà
__fsblkút_t_defšed


239 
__fsblkút_t
 
	tfsblkút_t
;

240 
	#__fsblkút_t_defšed


	)

242 #iâdeà
__fsfút_t_defšed


243 
__fsfút_t
 
	tfsfút_t
;

244 
	#__fsfút_t_defšed


	)

247 #iâdeà
__blkút_t_defšed


248 
__blkút64_t
 
	tblkút_t
;

249 
	#__blkút_t_defšed


	)

251 #iâdeà
__fsblkút_t_defšed


252 
__fsblkút64_t
 
	tfsblkút_t
;

253 
	#__fsblkút_t_defšed


	)

255 #iâdeà
__fsfút_t_defšed


256 
__fsfút64_t
 
	tfsfút_t
;

257 
	#__fsfút_t_defšed


	)

261 #ifdeà
__USE_LARGEFILE64


262 
__blkút64_t
 
	tblkút64_t
;

263 
__fsblkút64_t
 
	tfsblkút64_t
;

264 
__fsfút64_t
 
	tfsfút64_t
;

269 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


270 
	~<b™s/±h»adty³s.h
>

273 
	g__END_DECLS


	@/usr/include/sys/ucontext.h

18 #iâdeà
_SYS_UCONTEXT_H


19 
	#_SYS_UCONTEXT_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<sigÇl.h
>

26 
	~<b™s/sigcÚ‹xt.h
>

28 #ifdeà
__x86_64__


31 
__ex‹nsiÚ__
 
	tg»g_t
;

34 
	#NGREG
 23

	)

37 
g»g_t
 
	tg»g£t_t
[
NGREG
];

39 #ifdeà
__USE_GNU


43 
	mREG_R8
 = 0,

44 
	#REG_R8
 
REG_R8


	)

45 
	mREG_R9
,

46 
	#REG_R9
 
REG_R9


	)

47 
	mREG_R10
,

48 
	#REG_R10
 
REG_R10


	)

49 
	mREG_R11
,

50 
	#REG_R11
 
REG_R11


	)

51 
	mREG_R12
,

52 
	#REG_R12
 
REG_R12


	)

53 
	mREG_R13
,

54 
	#REG_R13
 
REG_R13


	)

55 
	mREG_R14
,

56 
	#REG_R14
 
REG_R14


	)

57 
	mREG_R15
,

58 
	#REG_R15
 
REG_R15


	)

59 
	mREG_RDI
,

60 
	#REG_RDI
 
REG_RDI


	)

61 
	mREG_RSI
,

62 
	#REG_RSI
 
REG_RSI


	)

63 
	mREG_RBP
,

64 
	#REG_RBP
 
REG_RBP


	)

65 
	mREG_RBX
,

66 
	#REG_RBX
 
REG_RBX


	)

67 
	mREG_RDX
,

68 
	#REG_RDX
 
REG_RDX


	)

69 
	mREG_RAX
,

70 
	#REG_RAX
 
REG_RAX


	)

71 
	mREG_RCX
,

72 
	#REG_RCX
 
REG_RCX


	)

73 
	mREG_RSP
,

74 
	#REG_RSP
 
REG_RSP


	)

75 
	mREG_RIP
,

76 
	#REG_RIP
 
REG_RIP


	)

77 
	mREG_EFL
,

78 
	#REG_EFL
 
REG_EFL


	)

79 
	mREG_CSGSFS
,

80 
	#REG_CSGSFS
 
REG_CSGSFS


	)

81 
	mREG_ERR
,

82 
	#REG_ERR
 
REG_ERR


	)

83 
	mREG_TRAPNO
,

84 
	#REG_TRAPNO
 
REG_TRAPNO


	)

85 
	mREG_OLDMASK
,

86 
	#REG_OLDMASK
 
REG_OLDMASK


	)

87 
	mREG_CR2


88 
	#REG_CR2
 
REG_CR2


	)

92 
	s_libc_åx»g


94 
	msignifiÿnd
[4];

95 
	mexpÚ’t
;

96 
	m·ddšg
[3];

99 
	s_libc_xmm»g


101 
__ušt32_t
 
	m–em’t
[4];

104 
	s_libc_å¡©e


107 
__ušt16_t
 
	mcwd
;

108 
__ušt16_t
 
	mswd
;

109 
__ušt16_t
 
	máw
;

110 
__ušt16_t
 
	mfİ
;

111 
__ušt64_t
 
	mr
;

112 
__ušt64_t
 
	mrdp
;

113 
__ušt32_t
 
	mmxc¤
;

114 
__ušt32_t
 
	mmxü_mask
;

115 
_libc_åx»g
 
	m_¡
[8];

116 
_libc_xmm»g
 
	m_xmm
[16];

117 
__ušt32_t
 
	m·ddšg
[24];

121 
_libc_å¡©e
 *
	tå»g£t_t
;

126 
g»g£t_t
 
	mg»gs
;

128 
å»g£t_t
 
	må»gs
;

129 
__ex‹nsiÚ__
 
	m__»£rved1
 [8];

130 } 
	tmcÚ‹xt_t
;

133 
	sucÚ‹xt


135 
	muc_æags
;

136 
ucÚ‹xt
 *
	muc_lšk
;

137 
¡ack_t
 
	muc_¡ack
;

138 
mcÚ‹xt_t
 
	muc_mcÚ‹xt
;

139 
__sig£t_t
 
	muc_sigmask
;

140 
_libc_å¡©e
 
	m__å»gs_mem
;

141 } 
	tucÚ‹xt_t
;

146 
	tg»g_t
;

149 
	#NGREG
 19

	)

152 
g»g_t
 
	tg»g£t_t
[
NGREG
];

154 #ifdeà
__USE_GNU


158 
	mREG_GS
 = 0,

159 
	#REG_GS
 
REG_GS


	)

160 
	mREG_FS
,

161 
	#REG_FS
 
REG_FS


	)

162 
	mREG_ES
,

163 
	#REG_ES
 
REG_ES


	)

164 
	mREG_DS
,

165 
	#REG_DS
 
REG_DS


	)

166 
	mREG_EDI
,

167 
	#REG_EDI
 
REG_EDI


	)

168 
	mREG_ESI
,

169 
	#REG_ESI
 
REG_ESI


	)

170 
	mREG_EBP
,

171 
	#REG_EBP
 
REG_EBP


	)

172 
	mREG_ESP
,

173 
	#REG_ESP
 
REG_ESP


	)

174 
	mREG_EBX
,

175 
	#REG_EBX
 
REG_EBX


	)

176 
	mREG_EDX
,

177 
	#REG_EDX
 
REG_EDX


	)

178 
	mREG_ECX
,

179 
	#REG_ECX
 
REG_ECX


	)

180 
	mREG_EAX
,

181 
	#REG_EAX
 
REG_EAX


	)

182 
	mREG_TRAPNO
,

183 
	#REG_TRAPNO
 
REG_TRAPNO


	)

184 
	mREG_ERR
,

185 
	#REG_ERR
 
REG_ERR


	)

186 
	mREG_EIP
,

187 
	#REG_EIP
 
REG_EIP


	)

188 
	mREG_CS
,

189 
	#REG_CS
 
REG_CS


	)

190 
	mREG_EFL
,

191 
	#REG_EFL
 
REG_EFL


	)

192 
	mREG_UESP
,

193 
	#REG_UESP
 
REG_UESP


	)

194 
	mREG_SS


195 
	#REG_SS
 
REG_SS


	)

200 
	s_libc_å»g


202 
	msignifiÿnd
[4];

203 
	mexpÚ’t
;

206 
	s_libc_å¡©e


208 
	mcw
;

209 
	msw
;

210 
	mg
;

211 
	moff
;

212 
	mcs£l
;

213 
	md©aoff
;

214 
	md©a£l
;

215 
_libc_å»g
 
	m_¡
[8];

216 
	m¡©us
;

220 
_libc_å¡©e
 *
	tå»g£t_t
;

225 
g»g£t_t
 
	mg»gs
;

228 
å»g£t_t
 
	må»gs
;

229 
	mŞdmask
;

230 
	mü2
;

231 } 
	tmcÚ‹xt_t
;

234 
	sucÚ‹xt


236 
	muc_æags
;

237 
ucÚ‹xt
 *
	muc_lšk
;

238 
¡ack_t
 
	muc_¡ack
;

239 
mcÚ‹xt_t
 
	muc_mcÚ‹xt
;

240 
__sig£t_t
 
	muc_sigmask
;

241 
_libc_å¡©e
 
	m__å»gs_mem
;

242 } 
	tucÚ‹xt_t
;

	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tŞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/bits/byteswap.h

19 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


23 #iâdeà
_BITS_BYTESWAP_H


24 
	#_BITS_BYTESWAP_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

28 
	~<b™s/wÜdsize.h
>

31 
	#__bsw­_cÚ¡ªt_16
(
x
) \

32 ((è((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8)))

	)

35 
	~<b™s/by‹sw­-16.h
>

38 
	#__bsw­_cÚ¡ªt_32
(
x
) \

39 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

40 (((
x
è& 0x0000ff00è<< 8è| (((xè& 0x000000ffè<< 24))

	)

42 #ifdeà
__GNUC__


43 #ià
__GNUC_PREREQ
 (4, 3)

44 
__šlše
 

45 
	$__bsw­_32
 (
__bsx
)

47  
	`__butš_bsw­32
 (
__bsx
);

48 
	}
}

49 #–ià
__GNUC__
 >= 2

50 #ià
__WORDSIZE
 =ğ64 || (
defšed
 
__i486__
 || defšed 
__³Áium__
 \

51 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

52 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

53 || 
defšed
 
	g__k6__
 || defšed 
	g__nocÚa__
 \

54 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__geode__
 \

55 || 
defšed
 
	g__amdçm10__
)

58 
	#__bsw­_32
(
x
) \

59 (
__ex‹nsiÚ__
 \

60 ({ 
__v
, 
__x
 = (
x
); \

61 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

62 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

64 
	`__asm__
 ("bsw­ %0" : "ô" (
__v
è: "0" (
__x
)); \

65 
__v
; }))

	)

67 
	#__bsw­_32
(
x
) \

68 (
__ex‹nsiÚ__
 \

69 ({ 
__v
, 
__x
 = (
x
); \

70 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

71 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

73 
	`__asm__
 ("rorw $8, %w0;" \

76 : "ô" (
__v
) \

77 : "0" (
__x
) \

79 
__v
; }))

	)

82 
	#__bsw­_32
(
x
) \

83 (
__ex‹nsiÚ__
 \

84 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_32
 (__x); }))

	)

87 
__šlše
 

88 
	$__bsw­_32
 (
__bsx
)

90  
	`__bsw­_cÚ¡ªt_32
 (
__bsx
);

91 
	}
}

95 #ià
__GNUC_PREREQ
 (2, 0)

97 
	#__bsw­_cÚ¡ªt_64
(
x
) \

98 (
	`__ex‹nsiÚ__
 ((((
x
) & 0xff00000000000000ull) >> 56) \

99 | (((
x
) & 0x00ff000000000000ull) >> 40) \

100 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

101 | (((
x
) & 0x000000ff00000000ull) >> 8) \

102 | (((
x
) & 0x00000000ff000000ull) << 8) \

103 | (((
x
) & 0x0000000000ff0000ull) << 24) \

104 | (((
x
) & 0x000000000000ff00ull) << 40) \

105 | (((
x
è& 0x00000000000000ffuÎè<< 56)))

	)

107 #ià
__GNUC_PREREQ
 (4, 3)

108 
__šlše
 
__ušt64_t


109 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

111  
	`__butš_bsw­64
 (
__bsx
);

112 
	}
}

113 #–ià
__WORDSIZE
 == 64

114 
	#__bsw­_64
(
x
) \

115 (
__ex‹nsiÚ__
 \

116 ({ 
__ušt64_t
 
__v
, 
__x
 = (
x
); \

117 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

118 
__v
 = 
	`__bsw­_cÚ¡ªt_64
 (
__x
); \

120 
	`__asm__
 ("bsw­ %q0" : "ô" (
__v
è: "0" (
__x
)); \

121 
__v
; }))

	)

123 
	#__bsw­_64
(
x
) \

124 (
__ex‹nsiÚ__
 \

125 ({ uniÚ { 
__ex‹nsiÚ__
 
__ušt64_t
 
__Î
; \

126 
__l
[2]; } 
__w
, 
__r
; \

127 ià(
	`__butš_cÚ¡ªt_p
 (
x
)) \

128 
__r
.
__Î
 = 
	`__bsw­_cÚ¡ªt_64
 (
x
); \

131 
__w
.
__Î
 = (
x
); \

132 
__r
.
__l
[0] = 
	`__bsw­_32
 (
__w
.__l[1]); \

133 
__r
.
__l
[1] = 
	`__bsw­_32
 (
__w
.__l[0]); \

135 
__r
.
__Î
; }))

	)

137 #–ià
__GLIBC_HAVE_LONG_LONG


138 
	#__bsw­_cÚ¡ªt_64
(
x
) \

139 ((((
x
) & 0xff00000000000000ull) >> 56) \

140 | (((
x
) & 0x00ff000000000000ull) >> 40) \

141 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

142 | (((
x
) & 0x000000ff00000000ull) >> 8) \

143 | (((
x
) & 0x00000000ff000000ull) << 8) \

144 | (((
x
) & 0x0000000000ff0000ull) << 24) \

145 | (((
x
) & 0x000000000000ff00ull) << 40) \

146 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

148 
__šlše
 
__ušt64_t


149 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

151  
	`__bsw­_cÚ¡ªt_64
 (
__bsx
);

152 
	}
}

	@/usr/include/bits/endian.h

3 #iâdeà
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/in.h

20 #iâdeà
_NETINET_IN_H


32 #ià
defšed
 
_UAPI_LINUX_IN6_H
 \

33 || 
defšed
 
	g_UAPI_IPV6_H
 \

34 || 
defšed
 
	g_LINUX_IN6_H
 \

35 || 
defšed
 
	g_IPV6_H


39 
	#__USE_KERNEL_IPV6_DEFS
 1

	)

41 
	#__USE_KERNEL_IPV6_DEFS
 0

	)

47 
	#IP_OPTIONS
 4

	)

48 
	#IP_HDRINCL
 3

	)

49 
	#IP_TOS
 1

	)

50 
	#IP_TTL
 2

	)

51 
	#IP_RECVOPTS
 6

	)

53 
	#IP_RECVRETOPTS
 
IP_RETOPTS


	)

54 
	#IP_RETOPTS
 7

	)

55 
	#IP_MULTICAST_IF
 32

	)

56 
	#IP_MULTICAST_TTL
 33

	)

57 
	#IP_MULTICAST_LOOP
 34

	)

58 
	#IP_ADD_MEMBERSHIP
 35

	)

59 
	#IP_DROP_MEMBERSHIP
 36

	)

60 
	#IP_UNBLOCK_SOURCE
 37

	)

61 
	#IP_BLOCK_SOURCE
 38

	)

62 
	#IP_ADD_SOURCE_MEMBERSHIP
 39

	)

63 
	#IP_DROP_SOURCE_MEMBERSHIP
 40

	)

64 
	#IP_MSFILTER
 41

	)

65 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


66 
	#MCAST_JOIN_GROUP
 42

	)

67 
	#MCAST_BLOCK_SOURCE
 43

	)

68 
	#MCAST_UNBLOCK_SOURCE
 44

	)

69 
	#MCAST_LEAVE_GROUP
 45

	)

70 
	#MCAST_JOIN_SOURCE_GROUP
 46

	)

71 
	#MCAST_LEAVE_SOURCE_GROUP
 47

	)

72 
	#MCAST_MSFILTER
 48

	)

73 
	#IP_MULTICAST_ALL
 49

	)

74 
	#IP_UNICAST_IF
 50

	)

76 
	#MCAST_EXCLUDE
 0

	)

77 
	#MCAST_INCLUDE
 1

	)

80 
	#IP_ROUTER_ALERT
 5

	)

81 
	#IP_PKTINFO
 8

	)

82 
	#IP_PKTOPTIONS
 9

	)

83 
	#IP_PMTUDISC
 10

	)

84 
	#IP_MTU_DISCOVER
 10

	)

85 
	#IP_RECVERR
 11

	)

86 
	#IP_RECVTTL
 12

	)

87 
	#IP_RECVTOS
 13

	)

88 
	#IP_MTU
 14

	)

89 
	#IP_FREEBIND
 15

	)

90 
	#IP_IPSEC_POLICY
 16

	)

91 
	#IP_XFRM_POLICY
 17

	)

92 
	#IP_PASSSEC
 18

	)

93 
	#IP_TRANSPARENT
 19

	)

94 
	#IP_MULTICAST_ALL
 49

	)

97 
	#IP_ORIGDSTADDR
 20

	)

98 
	#IP_RECVORIGDSTADDR
 
IP_ORIGDSTADDR


	)

100 
	#IP_MINTTL
 21

	)

104 
	#IP_PMTUDISC_DONT
 0

	)

105 
	#IP_PMTUDISC_WANT
 1

	)

106 
	#IP_PMTUDISC_DO
 2

	)

107 
	#IP_PMTUDISC_PROBE
 3

	)

110 
	#SOL_IP
 0

	)

112 
	#IP_DEFAULT_MULTICAST_TTL
 1

	)

113 
	#IP_DEFAULT_MULTICAST_LOOP
 1

	)

114 
	#IP_MAX_MEMBERSHIPS
 20

	)

116 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


120 
	s_İts


122 
š_addr
 
	m_d¡
;

123 
	m_İts
[40];

127 
	s_m»qn


129 
š_addr
 
	mimr_muÉŸddr
;

130 
š_addr
 
	mimr_add»ss
;

131 
	mimr_ifšdex
;

135 
	sš_pktšfo


137 
	mi_ifšdex
;

138 
š_addr
 
	mi_¥ec_d¡
;

139 
š_addr
 
	mi_addr
;

146 
	#IPV6_ADDRFORM
 1

	)

147 
	#IPV6_2292PKTINFO
 2

	)

148 
	#IPV6_2292HOPOPTS
 3

	)

149 
	#IPV6_2292DSTOPTS
 4

	)

150 
	#IPV6_2292RTHDR
 5

	)

151 
	#IPV6_2292PKTOPTIONS
 6

	)

152 
	#IPV6_CHECKSUM
 7

	)

153 
	#IPV6_2292HOPLIMIT
 8

	)

155 
	#SCM_SRCRT
 
IPV6_RXSRCRT


	)

157 
	#IPV6_NEXTHOP
 9

	)

158 
	#IPV6_AUTHHDR
 10

	)

159 
	#IPV6_UNICAST_HOPS
 16

	)

160 
	#IPV6_MULTICAST_IF
 17

	)

161 
	#IPV6_MULTICAST_HOPS
 18

	)

162 
	#IPV6_MULTICAST_LOOP
 19

	)

163 
	#IPV6_JOIN_GROUP
 20

	)

164 
	#IPV6_LEAVE_GROUP
 21

	)

165 
	#IPV6_ROUTER_ALERT
 22

	)

166 
	#IPV6_MTU_DISCOVER
 23

	)

167 
	#IPV6_MTU
 24

	)

168 
	#IPV6_RECVERR
 25

	)

169 
	#IPV6_V6ONLY
 26

	)

170 
	#IPV6_JOIN_ANYCAST
 27

	)

171 
	#IPV6_LEAVE_ANYCAST
 28

	)

172 
	#IPV6_IPSEC_POLICY
 34

	)

173 
	#IPV6_XFRM_POLICY
 35

	)

175 
	#IPV6_RECVPKTINFO
 49

	)

176 
	#IPV6_PKTINFO
 50

	)

177 
	#IPV6_RECVHOPLIMIT
 51

	)

178 
	#IPV6_HOPLIMIT
 52

	)

179 
	#IPV6_RECVHOPOPTS
 53

	)

180 
	#IPV6_HOPOPTS
 54

	)

181 
	#IPV6_RTHDRDSTOPTS
 55

	)

182 
	#IPV6_RECVRTHDR
 56

	)

183 
	#IPV6_RTHDR
 57

	)

184 
	#IPV6_RECVDSTOPTS
 58

	)

185 
	#IPV6_DSTOPTS
 59

	)

187 
	#IPV6_RECVTCLASS
 66

	)

188 
	#IPV6_TCLASS
 67

	)

191 #ià!
__USE_KERNEL_IPV6_DEFS


192 
	#IPV6_ADD_MEMBERSHIP
 
IPV6_JOIN_GROUP


	)

193 
	#IPV6_DROP_MEMBERSHIP
 
IPV6_LEAVE_GROUP


	)

195 
	#IPV6_RXHOPOPTS
 
IPV6_HOPOPTS


	)

196 
	#IPV6_RXDSTOPTS
 
IPV6_DSTOPTS


	)

199 
	#IPV6_PMTUDISC_DONT
 0

	)

200 
	#IPV6_PMTUDISC_WANT
 1

	)

201 
	#IPV6_PMTUDISC_DO
 2

	)

202 
	#IPV6_PMTUDISC_PROBE
 3

	)

205 
	#SOL_IPV6
 41

	)

206 
	#SOL_ICMPV6
 58

	)

209 
	#IPV6_RTHDR_LOOSE
 0

	)

210 
	#IPV6_RTHDR_STRICT
 1

	)

212 
	#IPV6_RTHDR_TYPE_0
 0

	)

	@/usr/include/bits/posix1_lim.h

24 #iâdef 
_BITS_POSIX1_LIM_H


25 
	#_BITS_POSIX1_LIM_H
 1

	)

31 
	#_POSIX_AIO_LISTIO_MAX
 2

	)

34 
	#_POSIX_AIO_MAX
 1

	)

37 
	#_POSIX_ARG_MAX
 4096

	)

40 #ifdeà
__USE_XOPEN2K


41 
	#_POSIX_CHILD_MAX
 25

	)

43 
	#_POSIX_CHILD_MAX
 6

	)

47 
	#_POSIX_DELAYTIMER_MAX
 32

	)

51 
	#_POSIX_HOST_NAME_MAX
 255

	)

54 
	#_POSIX_LINK_MAX
 8

	)

57 
	#_POSIX_LOGIN_NAME_MAX
 9

	)

60 
	#_POSIX_MAX_CANON
 255

	)

64 
	#_POSIX_MAX_INPUT
 255

	)

67 
	#_POSIX_MQ_OPEN_MAX
 8

	)

70 
	#_POSIX_MQ_PRIO_MAX
 32

	)

73 
	#_POSIX_NAME_MAX
 14

	)

76 #ifdeà
__USE_XOPEN2K


77 
	#_POSIX_NGROUPS_MAX
 8

	)

79 
	#_POSIX_NGROUPS_MAX
 0

	)

83 #ifdeà
__USE_XOPEN2K


84 
	#_POSIX_OPEN_MAX
 20

	)

86 
	#_POSIX_OPEN_MAX
 16

	)

89 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


92 
	#_POSIX_FD_SETSIZE
 
_POSIX_OPEN_MAX


	)

96 
	#_POSIX_PATH_MAX
 256

	)

99 
	#_POSIX_PIPE_BUF
 512

	)

103 
	#_POSIX_RE_DUP_MAX
 255

	)

106 
	#_POSIX_RTSIG_MAX
 8

	)

109 
	#_POSIX_SEM_NSEMS_MAX
 256

	)

112 
	#_POSIX_SEM_VALUE_MAX
 32767

	)

115 
	#_POSIX_SIGQUEUE_MAX
 32

	)

118 
	#_POSIX_SSIZE_MAX
 32767

	)

121 
	#_POSIX_STREAM_MAX
 8

	)

124 
	#_POSIX_SYMLINK_MAX
 255

	)

128 
	#_POSIX_SYMLOOP_MAX
 8

	)

131 
	#_POSIX_TIMER_MAX
 32

	)

134 
	#_POSIX_TTY_NAME_MAX
 9

	)

137 #ifdeà
__USE_XOPEN2K


138 
	#_POSIX_TZNAME_MAX
 6

	)

140 
	#_POSIX_TZNAME_MAX
 3

	)

143 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


145 
	#_POSIX_QLIMIT
 1

	)

149 
	#_POSIX_HIWAT
 
_POSIX_PIPE_BUF


	)

152 
	#_POSIX_UIO_MAXIOV
 16

	)

156 
	#_POSIX_CLOCKRES_MIN
 20000000

	)

160 
	~<b™s/loÿl_lim.h
>

163 #iâdef 
SSIZE_MAX


164 
	#SSIZE_MAX
 
LONG_MAX


	)

171 #iâdef 
NGROUPS_MAX


172 
	#NGROUPS_MAX
 8

	)

	@/usr/include/bits/posix2_lim.h

22 #iâdef 
_BITS_POSIX2_LIM_H


23 
	#_BITS_POSIX2_LIM_H
 1

	)

27 
	#_POSIX2_BC_BASE_MAX
 99

	)

30 
	#_POSIX2_BC_DIM_MAX
 2048

	)

33 
	#_POSIX2_BC_SCALE_MAX
 99

	)

36 
	#_POSIX2_BC_STRING_MAX
 1000

	)

40 
	#_POSIX2_COLL_WEIGHTS_MAX
 2

	)

44 
	#_POSIX2_EXPR_NEST_MAX
 32

	)

47 
	#_POSIX2_LINE_MAX
 2048

	)

51 
	#_POSIX2_RE_DUP_MAX
 255

	)

55 
	#_POSIX2_CHARCLASS_NAME_MAX
 14

	)

62 #iâdef 
BC_BASE_MAX


63 
	#BC_BASE_MAX
 
_POSIX2_BC_BASE_MAX


	)

65 #iâdef 
BC_DIM_MAX


66 
	#BC_DIM_MAX
 
_POSIX2_BC_DIM_MAX


	)

68 #iâdef 
BC_SCALE_MAX


69 
	#BC_SCALE_MAX
 
_POSIX2_BC_SCALE_MAX


	)

71 #iâdef 
BC_STRING_MAX


72 
	#BC_STRING_MAX
 
_POSIX2_BC_STRING_MAX


	)

74 #iâdef 
COLL_WEIGHTS_MAX


75 
	#COLL_WEIGHTS_MAX
 255

	)

77 #iâdef 
EXPR_NEST_MAX


78 
	#EXPR_NEST_MAX
 
_POSIX2_EXPR_NEST_MAX


	)

80 #iâdef 
LINE_MAX


81 
	#LINE_MAX
 
_POSIX2_LINE_MAX


	)

83 #iâdef 
CHARCLASS_NAME_MAX


84 
	#CHARCLASS_NAME_MAX
 2048

	)

88 
	#RE_DUP_MAX
 (0x7fff)

	)

	@/usr/include/bits/timex.h

18 #iâdef 
_BITS_TIMEX_H


19 
	#_BITS_TIMEX_H
 1

	)

21 
	~<b™s/ty³s.h
>

25 
	stimex


27 
	mmodes
;

28 
__sysÿÎ_¦Úg_t
 
	moff£t
;

29 
__sysÿÎ_¦Úg_t
 
	mäeq
;

30 
__sysÿÎ_¦Úg_t
 
	mmax”rÜ
;

31 
__sysÿÎ_¦Úg_t
 
	me¡”rÜ
;

32 
	m¡©us
;

33 
__sysÿÎ_¦Úg_t
 
	mcÚ¡ªt
;

34 
__sysÿÎ_¦Úg_t
 
	m´ecisiÚ
;

35 
__sysÿÎ_¦Úg_t
 
	mtŞ”ªû
;

36 
timev®
 
	mtime
;

37 
__sysÿÎ_¦Úg_t
 
	mtick
;

38 
__sysÿÎ_¦Úg_t
 
	mµsäeq
;

39 
__sysÿÎ_¦Úg_t
 
	mj™‹r
;

40 
	mshiá
;

41 
__sysÿÎ_¦Úg_t
 
	m¡ab
;

42 
__sysÿÎ_¦Úg_t
 
	mj™út
;

43 
__sysÿÎ_¦Úg_t
 
	mÿlút
;

44 
__sysÿÎ_¦Úg_t
 
	m”rút
;

45 
__sysÿÎ_¦Úg_t
 
	m¡bút
;

47 
	mi
;

56 
	#ADJ_OFFSET
 0x0001

	)

57 
	#ADJ_FREQUENCY
 0x0002

	)

58 
	#ADJ_MAXERROR
 0x0004

	)

59 
	#ADJ_ESTERROR
 0x0008

	)

60 
	#ADJ_STATUS
 0x0010

	)

61 
	#ADJ_TIMECONST
 0x0020

	)

62 
	#ADJ_TAI
 0x0080

	)

63 
	#ADJ_MICRO
 0x1000

	)

64 
	#ADJ_NANO
 0x2000

	)

65 
	#ADJ_TICK
 0x4000

	)

66 
	#ADJ_OFFSET_SINGLESHOT
 0x8001

	)

67 
	#ADJ_OFFSET_SS_READ
 0xa001

	)

70 
	#MOD_OFFSET
 
ADJ_OFFSET


	)

71 
	#MOD_FREQUENCY
 
ADJ_FREQUENCY


	)

72 
	#MOD_MAXERROR
 
ADJ_MAXERROR


	)

73 
	#MOD_ESTERROR
 
ADJ_ESTERROR


	)

74 
	#MOD_STATUS
 
ADJ_STATUS


	)

75 
	#MOD_TIMECONST
 
ADJ_TIMECONST


	)

76 
	#MOD_CLKB
 
ADJ_TICK


	)

77 
	#MOD_CLKA
 
ADJ_OFFSET_SINGLESHOT


	)

78 
	#MOD_TAI
 
ADJ_TAI


	)

79 
	#MOD_MICRO
 
ADJ_MICRO


	)

80 
	#MOD_NANO
 
ADJ_NANO


	)

84 
	#STA_PLL
 0x0001

	)

85 
	#STA_PPSFREQ
 0x0002

	)

86 
	#STA_PPSTIME
 0x0004

	)

87 
	#STA_FLL
 0x0008

	)

89 
	#STA_INS
 0x0010

	)

90 
	#STA_DEL
 0x0020

	)

91 
	#STA_UNSYNC
 0x0040

	)

92 
	#STA_FREQHOLD
 0x0080

	)

94 
	#STA_PPSSIGNAL
 0x0100

	)

95 
	#STA_PPSJITTER
 0x0200

	)

96 
	#STA_PPSWANDER
 0x0400

	)

97 
	#STA_PPSERROR
 0x0800

	)

99 
	#STA_CLOCKERR
 0x1000

	)

100 
	#STA_NANO
 0x2000

	)

101 
	#STA_MODE
 0x4000

	)

102 
	#STA_CLK
 0x8000

	)

105 
	#STA_RONLY
 (
STA_PPSSIGNAL
 | 
STA_PPSJITTER
 | 
STA_PPSWANDER
 | \

106 
STA_PPSERROR
 | 
STA_CLOCKERR
 | 
STA_NANO
 | 
STA_MODE
 | 
STA_CLK
)

	)

	@/usr/include/bits/typesizes.h

19 #iâdeà
_BITS_TYPES_H


23 #iâdef 
_BITS_TYPESIZES_H


24 
	#_BITS_TYPESIZES_H
 1

	)

30 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


31 
	#__SYSCALL_SLONG_TYPE
 
__SQUAD_TYPE


	)

32 
	#__SYSCALL_ULONG_TYPE
 
__UQUAD_TYPE


	)

34 
	#__SYSCALL_SLONG_TYPE
 
__SLONGWORD_TYPE


	)

35 
	#__SYSCALL_ULONG_TYPE
 
__ULONGWORD_TYPE


	)

38 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

39 
	#__UID_T_TYPE
 
__U32_TYPE


	)

40 
	#__GID_T_TYPE
 
__U32_TYPE


	)

41 
	#__INO_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

42 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

43 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

44 #ifdeà
__x86_64__


45 
	#__NLINK_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

46 
	#__FSWORD_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

48 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

49 
	#__FSWORD_T_TYPE
 
__SWORD_TYPE


	)

51 
	#__OFF_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

52 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

53 
	#__PID_T_TYPE
 
__S32_TYPE


	)

54 
	#__RLIM_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

55 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

56 
	#__BLKCNT_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

57 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

58 
	#__FSBLKCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

59 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

60 
	#__FSFILCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

61 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

62 
	#__ID_T_TYPE
 
__U32_TYPE


	)

63 
	#__CLOCK_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

64 
	#__TIME_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

65 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

66 
	#__SUSECONDS_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

67 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

68 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

69 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

70 
	#__TIMER_T_TYPE
 *

	)

71 
	#__BLKSIZE_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

72 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

73 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

75 #ifdeà
__x86_64__


79 
	#__OFF_T_MATCHES_OFF64_T
 1

	)

82 
	#__INO_T_MATCHES_INO64_T
 1

	)

86 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__
 && !defšed 
__ILP32__


4 
	#__WORDSIZE
 64

	)

6 
	#__WORDSIZE
 32

	)

9 #ifdeà
__x86_64__


10 
	#__WORDSIZE_TIME64_COMPAT32
 1

	)

12 
	#__SYSCALL_WORDSIZE
 64

	)

	@/usr/include/bits/xopen_lim.h

29 #iâdeà
_XOPEN_LIM_H


30 
	#_XOPEN_LIM_H
 1

	)

32 
	#__Ãed_IOV_MAX


	)

33 
	~<b™s/¡dio_lim.h
>

65 
	#_XOPEN_IOV_MAX
 
_POSIX_UIO_MAXIOV


	)

70 
	#NL_ARGMAX
 
_POSIX_ARG_MAX


	)

73 
	#NL_LANGMAX
 
_POSIX2_LINE_MAX


	)

76 
	#NL_MSGMAX
 
INT_MAX


	)

80 
	#NL_NMAX
 
INT_MAX


	)

83 
	#NL_SETMAX
 
INT_MAX


	)

86 
	#NL_TEXTMAX
 
INT_MAX


	)

89 
	#NZERO
 20

	)

93 #ifdeà
INT_MAX


94 #ià
INT_MAX
 == 32767

95 
	#WORD_BIT
 16

	)

97 #ià
INT_MAX
 == 2147483647

98 
	#WORD_BIT
 32

	)

101 
	#WORD_BIT
 64

	)

104 #–ià
defšed
 
__INT_MAX__


105 #ià
__INT_MAX__
 == 32767

106 
	#WORD_BIT
 16

	)

108 #ià
__INT_MAX__
 == 2147483647

109 
	#WORD_BIT
 32

	)

112 
	#WORD_BIT
 64

	)

116 
	#WORD_BIT
 32

	)

120 #ifdeà
LONG_MAX


121 #ià
LONG_MAX
 == 2147483647

122 
	#LONG_BIT
 32

	)

125 
	#LONG_BIT
 64

	)

127 #–ià
defšed
 
__LONG_MAX__


128 #ià
__LONG_MAX__
 == 2147483647

129 
	#LONG_BIT
 32

	)

132 
	#LONG_BIT
 64

	)

135 
	~<b™s/wÜdsize.h
>

136 #ià
__WORDSIZE
 == 64

137 
	#LONG_BIT
 64

	)

139 
	#LONG_BIT
 32

	)

	@/usr/include/gnu/stubs.h

6 #ià!
defšed
 
__x86_64__


7 
	~<gnu/¡ubs-32.h
>

9 #ià
defšed
 
__x86_64__
 && defšed 
__LP64__


10 
	~<gnu/¡ubs-64.h
>

12 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


13 
	~<gnu/¡ubs-x32.h
>

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

30 
	#__STDC_IEC_559__
 1

	)

31 
	#__STDC_IEC_559_COMPLEX__
 1

	)

35 
	#__STDC_ISO_10646__
 201103L

	)

38 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/stdint.h

22 #iâdeà
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/wch¬.h
>

27 
	~<b™s/wÜdsize.h
>

34 #iâdeà
__št8_t_defšed


35 
	#__št8_t_defšed


	)

36 sigÃd 
	tšt8_t
;

37 
	tšt16_t
;

38 
	tšt32_t
;

39 #ià
__WORDSIZE
 == 64

40 
	tšt64_t
;

42 
__ex‹nsiÚ__


43 
	tšt64_t
;

48 
	tušt8_t
;

49 
	tušt16_t
;

50 #iâdeà
__ušt32_t_defšed


51 
	tušt32_t
;

52 
	#__ušt32_t_defšed


	)

54 #ià
__WORDSIZE
 == 64

55 
	tušt64_t
;

57 
__ex‹nsiÚ__


58 
	tušt64_t
;

65 sigÃd 
	tšt_Ëa¡8_t
;

66 
	tšt_Ëa¡16_t
;

67 
	tšt_Ëa¡32_t
;

68 #ià
__WORDSIZE
 == 64

69 
	tšt_Ëa¡64_t
;

71 
__ex‹nsiÚ__


72 
	tšt_Ëa¡64_t
;

76 
	tušt_Ëa¡8_t
;

77 
	tušt_Ëa¡16_t
;

78 
	tušt_Ëa¡32_t
;

79 #ià
__WORDSIZE
 == 64

80 
	tušt_Ëa¡64_t
;

82 
__ex‹nsiÚ__


83 
	tušt_Ëa¡64_t
;

90 sigÃd 
	tšt_ç¡8_t
;

91 #ià
__WORDSIZE
 == 64

92 
	tšt_ç¡16_t
;

93 
	tšt_ç¡32_t
;

94 
	tšt_ç¡64_t
;

96 
	tšt_ç¡16_t
;

97 
	tšt_ç¡32_t
;

98 
__ex‹nsiÚ__


99 
	tšt_ç¡64_t
;

103 
	tušt_ç¡8_t
;

104 #ià
__WORDSIZE
 == 64

105 
	tušt_ç¡16_t
;

106 
	tušt_ç¡32_t
;

107 
	tušt_ç¡64_t
;

109 
	tušt_ç¡16_t
;

110 
	tušt_ç¡32_t
;

111 
__ex‹nsiÚ__


112 
	tušt_ç¡64_t
;

117 #ià
__WORDSIZE
 == 64

118 #iâdeà
__šŒ_t_defšed


119 
	tšŒ_t
;

120 
	#__šŒ_t_defšed


	)

122 
	tušŒ_t
;

124 #iâdeà
__šŒ_t_defšed


125 
	tšŒ_t
;

126 
	#__šŒ_t_defšed


	)

128 
	tušŒ_t
;

133 #ià
__WORDSIZE
 == 64

134 
	tštmax_t
;

135 
	tuštmax_t
;

137 
__ex‹nsiÚ__


138 
	tštmax_t
;

139 
__ex‹nsiÚ__


140 
	tuštmax_t
;

144 #ià
__WORDSIZE
 == 64

145 
	#__INT64_C
(
c
èø## 
L


	)

146 
	#__UINT64_C
(
c
èø## 
UL


	)

148 
	#__INT64_C
(
c
èø## 
LL


	)

149 
	#__UINT64_C
(
c
èø## 
ULL


	)

155 
	#INT8_MIN
 (-128)

	)

156 
	#INT16_MIN
 (-32767-1)

	)

157 
	#INT32_MIN
 (-2147483647-1)

	)

158 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

160 
	#INT8_MAX
 (127)

	)

161 
	#INT16_MAX
 (32767)

	)

162 
	#INT32_MAX
 (2147483647)

	)

163 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

166 
	#UINT8_MAX
 (255)

	)

167 
	#UINT16_MAX
 (65535)

	)

168 
	#UINT32_MAX
 (4294967295U)

	)

169 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

173 
	#INT_LEAST8_MIN
 (-128)

	)

174 
	#INT_LEAST16_MIN
 (-32767-1)

	)

175 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

176 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

178 
	#INT_LEAST8_MAX
 (127)

	)

179 
	#INT_LEAST16_MAX
 (32767)

	)

180 
	#INT_LEAST32_MAX
 (2147483647)

	)

181 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

184 
	#UINT_LEAST8_MAX
 (255)

	)

185 
	#UINT_LEAST16_MAX
 (65535)

	)

186 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

187 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

191 
	#INT_FAST8_MIN
 (-128)

	)

192 #ià
__WORDSIZE
 == 64

193 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

194 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

196 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

197 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

199 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

201 
	#INT_FAST8_MAX
 (127)

	)

202 #ià
__WORDSIZE
 == 64

203 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

204 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

206 
	#INT_FAST16_MAX
 (2147483647)

	)

207 
	#INT_FAST32_MAX
 (2147483647)

	)

209 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINT_FAST8_MAX
 (255)

	)

213 #ià
__WORDSIZE
 == 64

214 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

215 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

217 
	#UINT_FAST16_MAX
 (4294967295U)

	)

218 
	#UINT_FAST32_MAX
 (4294967295U)

	)

220 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

224 #ià
__WORDSIZE
 == 64

225 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

226 
	#INTPTR_MAX
 (9223372036854775807L)

	)

227 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

229 
	#INTPTR_MIN
 (-2147483647-1)

	)

230 
	#INTPTR_MAX
 (2147483647)

	)

231 
	#UINTPTR_MAX
 (4294967295U)

	)

236 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

238 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

241 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

247 #ià
__WORDSIZE
 == 64

248 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

249 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

251 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

252 
	#PTRDIFF_MAX
 (2147483647)

	)

256 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

257 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

260 #ià
__WORDSIZE
 == 64

261 
	#SIZE_MAX
 (18446744073709551615UL)

	)

263 #ifdeà
__WORDSIZE32_SIZE_ULONG


264 
	#SIZE_MAX
 (4294967295UL)

	)

266 
	#SIZE_MAX
 (4294967295U)

	)

271 #iâdeà
WCHAR_MIN


273 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

274 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

278 
	#WINT_MIN
 (0u)

	)

279 
	#WINT_MAX
 (4294967295u)

	)

283 
	#INT8_C
(
c
è
	)
c

284 
	#INT16_C
(
c
è
	)
c

285 
	#INT32_C
(
c
è
	)
c

286 #ià
__WORDSIZE
 == 64

287 
	#INT64_C
(
c
èø## 
L


	)

289 
	#INT64_C
(
c
èø## 
LL


	)

293 
	#UINT8_C
(
c
è
	)
c

294 
	#UINT16_C
(
c
è
	)
c

295 
	#UINT32_C
(
c
èø## 
U


	)

296 #ià
__WORDSIZE
 == 64

297 
	#UINT64_C
(
c
èø## 
UL


	)

299 
	#UINT64_C
(
c
èø## 
ULL


	)

303 #ià
__WORDSIZE
 == 64

304 
	#INTMAX_C
(
c
èø## 
L


	)

305 
	#UINTMAX_C
(
c
èø## 
UL


	)

307 
	#INTMAX_C
(
c
èø## 
LL


	)

308 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/sys/cdefs.h

19 #iâdef 
_SYS_CDEFS_H


20 
	#_SYS_CDEFS_H
 1

	)

23 #iâdeà
_FEATURES_H


24 
	~<ã©u»s.h
>

30 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


35 #undeà
__P


36 #undeà
__PMT


38 #ifdeà
__GNUC__


42 #ià
__GNUC_PREREQ
 (4, 6è&& !
defšed
 
_LIBC


43 
	#__LEAF
 , 
__Ëaf__


	)

44 
	#__LEAF_ATTR
 
	`__©Œibu‹__
 ((
__Ëaf__
))

	)

46 
	#__LEAF


	)

47 
	#__LEAF_ATTR


	)

55 #ià!
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

56 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
))

	)

57 
	#__THROWNL
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

58 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
)è
	)
fct

60 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

61 
	#__THROW
 
	`throw
 ()

	)

62 
	#__THROWNL
 
	`throw
 ()

	)

63 
	#__NTH
(
fù
è
__LEAF_ATTR
 fù 
	`throw
 ()

	)

65 
	#__THROW


	)

66 
	#__THROWNL


	)

67 
	#__NTH
(
fù
è
	)
fct

73 
	#__šlše


	)

75 
	#__THROW


	)

76 
	#__THROWNL


	)

77 
	#__NTH
(
fù
è
	)
fct

83 
	#__P
(
¬gs
è
	)
args

84 
	#__PMT
(
¬gs
è
	)
args

89 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

90 
	#__STRING
(
x
è#x

	)

93 
	#__±r_t
 *

	)

94 
	#__lÚg_doubË_t
 

	)

98 #ifdef 
__ılu¥lus


99 
	#__BEGIN_DECLS
 "C" {

	)

100 
	#__END_DECLS
 }

	)

102 
	#__BEGIN_DECLS


	)

103 
	#__END_DECLS


	)

112 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES


113 
	#__BEGIN_NAMESPACE_STD
 
Çme¥aû
 
¡d
 {

	)

114 
	#__END_NAMESPACE_STD
 }

	)

115 
	#__USING_NAMESPACE_STD
(
Çme
è
usšg
 
¡d
::Çme;

	)

116 
	#__BEGIN_NAMESPACE_C99
 
Çme¥aû
 
__c99
 {

	)

117 
	#__END_NAMESPACE_C99
 }

	)

118 
	#__USING_NAMESPACE_C99
(
Çme
è
usšg
 
__c99
::Çme;

	)

123 
	#__BEGIN_NAMESPACE_STD


	)

124 
	#__END_NAMESPACE_STD


	)

125 
	#__USING_NAMESPACE_STD
(
Çme
)

	)

126 
	#__BEGIN_NAMESPACE_C99


	)

127 
	#__END_NAMESPACE_C99


	)

128 
	#__USING_NAMESPACE_C99
(
Çme
)

	)

133 #iâdeà
__BOUNDED_POINTERS__


134 
	#__bounded


	)

135 
	#__unbounded


	)

136 
	#__±rv®ue


	)

141 
	#__bos
(
±r
è
	`__butš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

142 
	#__bos0
(
±r
è
	`__butš_objeù_size
 (±r, 0)

	)

144 #ià
__GNUC_PREREQ
 (4,3)

145 
	#__w¬ndeş
(
Çme
, 
msg
) \

146 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

147 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

148 
	#__”rÜdeş
(
Çme
, 
msg
) \

149 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

151 
	#__w¬ndeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

152 
	#__w¬Ç‰r
(
msg
)

	)

153 
	#__”rÜdeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

157 #ià
__GNUC_PREREQ
 (2,97)

159 
	#__æex¬r
 []

	)

161 #ifdeà
__GNUC__


162 
	#__æex¬r
 [0]

	)

164 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

165 
	#__æex¬r
 []

	)

168 
	#__æex¬r
 [1]

	)

184 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

186 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

187 #ifdeà
__ılu¥lus


188 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

189 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

190 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

191 
Çme
 
´Ùo
 
__THROWNL
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

193 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

194 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

195 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

196 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROWNL


	)

198 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

199 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

212 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

213 
	#__©Œibu‹__
(
xyz
è

	)

219 #ià
__GNUC_PREREQ
 (2,96)

220 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

222 
	#__©Œibu‹_m®loc__


	)

228 #ià
__GNUC_PREREQ
 (2,96)

229 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

231 
	#__©Œibu‹_pu»__


	)

235 #ià
__GNUC_PREREQ
 (2,5)

236 
	#__©Œibu‹_cÚ¡__
 
	`__©Œibu‹__
 ((
__cÚ¡__
))

	)

238 
	#__©Œibu‹_cÚ¡__


	)

244 #ià
__GNUC_PREREQ
 (3,1)

245 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

246 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

248 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

249 
	#__©Œibu‹_nošlše__


	)

253 #ià
__GNUC_PREREQ
 (3,2)

254 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

256 
	#__©Œibu‹_d•»ÿ‹d__


	)

265 #ià
__GNUC_PREREQ
 (2,8)

266 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

268 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

275 #ià
__GNUC_PREREQ
 (2,97)

276 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

277 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

279 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

284 #ià
__GNUC_PREREQ
 (3,3)

285 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

287 
	#__nÚnuÎ
(
·¿ms
)

	)

292 #ià
__GNUC_PREREQ
 (3,4)

293 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

294 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

295 #ià
__USE_FORTIFY_LEVEL
 > 0

296 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

299 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

301 #iâdeà
__wur


302 
	#__wur


	)

306 #ià
__GNUC_PREREQ
 (3,2)

307 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

309 
	#__®ways_šlše
 
__šlše


	)

314 #ià
__GNUC_PREREQ
 (4,3)

315 
	#__©Œibu‹_¬tificŸl__
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

317 
	#__©Œibu‹_¬tificŸl__


	)

329 #ià(!
defšed
 
__ılu¥lus
 || 
__GNUC_PREREQ
 (4,3) \

330 || (
defšed
 
__şªg__
 && (defšed 
__GNUC_STDC_INLINE__
 \

331 || 
defšed
 
__GNUC_GNU_INLINE__
)))

332 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__ılu¥lus


333 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

334 
	#__ex‹º_®ways_šlše
 \

335 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

337 
	#__ex‹º_šlše
 
__šlše


	)

338 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

342 #ifdeà
__ex‹º_®ways_šlše


343 
	#__fÜtify_funùiÚ
 
__ex‹º_®ways_šlše
 
__©Œibu‹_¬tificŸl__


	)

348 #ià
__GNUC_PREREQ
 (4,3)

349 
	#__va_¬g_·ck
(è
	`__butš_va_¬g_·ck
 ()

	)

350 
	#__va_¬g_·ck_Ën
(è
	`__butš_va_¬g_·ck_Ën
 ()

	)

357 #ià!
__GNUC_PREREQ
 (2,8)

358 
	#__ex‹nsiÚ__


	)

362 #ià!
__GNUC_PREREQ
 (2,92)

363 
	#__»¡riù


	)

369 #ià
__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


370 
	#__»¡riù_¬r
 
__»¡riù


	)

372 #ifdeà
__GNUC__


373 
	#__»¡riù_¬r


	)

375 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

376 
	#__»¡riù_¬r
 
»¡riù


	)

379 
	#__»¡riù_¬r


	)

384 #ià
__GNUC__
 >= 3

385 
	#__glibc_uÆik–y
(
cÚd
è
	`__butš_ex³ù
((cÚd), 0)

	)

386 
	#__glibc_lik–y
(
cÚd
è
	`__butš_ex³ù
((cÚd), 1)

	)

388 
	#__glibc_uÆik–y
(
cÚd
è(cÚd)

	)

389 
	#__glibc_lik–y
(
cÚd
è(cÚd)

	)

392 
	~<b™s/wÜdsize.h
>

394 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


395 
	#__LDBL_COMPAT
 1

	)

396 #ifdeà
__REDIRECT


397 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

398 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

399 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

400 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

401 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

402 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

403 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

404 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

405 
	#__LDBL_REDIR_DECL
(
Çme
) \

406 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

407 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

408 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

409 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

410 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

413 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


414 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

415 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

416 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

417 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

418 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

419 #ifdeà
__REDIRECT


420 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

421 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

422 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

	@/usr/include/sys/select.h

21 #iâdeà
_SYS_SELECT_H


22 
	#_SYS_SELECT_H
 1

	)

24 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

30 
	~<b™s/£Ëù.h
>

33 
	~<b™s/sig£t.h
>

35 #iâdeà
__sig£t_t_defšed


36 
	#__sig£t_t_defšed


	)

37 
__sig£t_t
 
	tsig£t_t
;

41 
	#__Ãed_time_t


	)

42 
	#__Ãed_time¥ec


	)

43 
	~<time.h
>

44 
	#__Ãed_timev®


	)

45 
	~<b™s/time.h
>

47 #iâdeà
__su£cÚds_t_defšed


48 
__su£cÚds_t
 
	tsu£cÚds_t
;

49 
	#__su£cÚds_t_defšed


	)

54 
	t__fd_mask
;

57 #undeà
__NFDBITS


59 
	#__NFDBITS
 (8 * (è (
__fd_mask
))

	)

60 
	#__FD_ELT
(
d
è((dè/ 
__NFDBITS
)

	)

61 
	#__FD_MASK
(
d
è((
__fd_mask
è1 << ((dè% 
__NFDBITS
))

	)

68 #ifdeà
__USE_XOPEN


69 
__fd_mask
 
	mfds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

70 
	#__FDS_BITS
(
£t
è((£t)->
fds_b™s
)

	)

72 
__fd_mask
 
	m__fds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
è((£t)->
__fds_b™s
)

	)

75 } 
	tfd_£t
;

78 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

80 #ifdeà
__USE_MISC


82 
__fd_mask
 
	tfd_mask
;

85 
	#NFDBITS
 
__NFDBITS


	)

90 
	#FD_SET
(
fd
, 
fd£
è
	`__FD_SET
 (fd, fd£)

	)

91 
	#FD_CLR
(
fd
, 
fd£
è
	`__FD_CLR
 (fd, fd£)

	)

92 
	#FD_ISSET
(
fd
, 
fd£
è
	`__FD_ISSET
 (fd, fd£)

	)

93 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
 (fd£)

	)

96 
__BEGIN_DECLS


106 
£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

107 
fd_£t
 *
__»¡riù
 
__wr™efds
,

108 
fd_£t
 *
__»¡riù
 
__exû±fds
,

109 
timev®
 *
__»¡riù
 
__timeout
);

111 #ifdeà
__USE_XOPEN2K


118 
p£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

119 
fd_£t
 *
__»¡riù
 
__wr™efds
,

120 
fd_£t
 *
__»¡riù
 
__exû±fds
,

121 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
,

122 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__sigmask
);

127 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__GNUC__


128 
	~<b™s/£Ëù2.h
>

131 
	g__END_DECLS


	@/usr/include/sys/socket.h

20 #iâdef 
_SYS_SOCKET_H


21 
	#_SYS_SOCKET_H
 1

	)

23 
	~<ã©u»s.h
>

25 
	g__BEGIN_DECLS


27 
	~<sys/uio.h
>

28 
	#__Ãed_size_t


	)

29 
	~<¡ddef.h
>

30 #ifdeà
__USE_GNU


32 
	~<b™s/sig£t.h
>

39 
	~<b™s/sock‘.h
>

41 #ifdeà
__USE_BSD


44 
	sosockaddr


46 
	m§_çmy
;

47 
	m§_d©a
[14];

55 
	mSHUT_RD
 = 0,

56 
	#SHUT_RD
 
SHUT_RD


	)

57 
	mSHUT_WR
,

58 
	#SHUT_WR
 
SHUT_WR


	)

59 
	mSHUT_RDWR


60 
	#SHUT_RDWR
 
SHUT_RDWR


	)

69 #ià
defšed
 
__ılu¥lus
 || !
__GNUC_PREREQ
 (2, 7è|| !defšed 
__USE_GNU


70 
	#__SOCKADDR_ARG
 
sockaddr
 *
__»¡riù


	)

71 
	#__CONST_SOCKADDR_ARG
 cÚ¡ 
sockaddr
 *

	)

75 
	#__SOCKADDR_ALLTYPES
 \

76 
	`__SOCKADDR_ONETYPE
 (
sockaddr
) \

77 
	`__SOCKADDR_ONETYPE
 (
sockaddr_©
) \

78 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ax25
) \

79 
	`__SOCKADDR_ONETYPE
 (
sockaddr_dl
) \

80 
	`__SOCKADDR_ONETYPE
 (
sockaddr_eÚ
) \

81 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š
) \

82 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š6
) \

83 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š¬p
) \

84 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x
) \

85 
	`__SOCKADDR_ONETYPE
 (
sockaddr_iso
) \

86 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ns
) \

87 
	`__SOCKADDR_ONETYPE
 (
sockaddr_un
) \

88 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x25
)

	)

90 
	#__SOCKADDR_ONETYPE
(
ty³
èty³ *
__»¡riù
 
__
##ty³##__;

	)

91 uniÚ { 
	m__SOCKADDR_ALLTYPES


92 } 
	t__SOCKADDR_ARG
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

93 #undeà
__SOCKADDR_ONETYPE


94 
	#__SOCKADDR_ONETYPE
(
ty³
ècÚ¡ ty³ *
__»¡riù
 
__
##ty³##__;

	)

95 uniÚ { 
	m__SOCKADDR_ALLTYPES


96 } 
	t__CONST_SOCKADDR_ARG
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

97 #undeà
__SOCKADDR_ONETYPE


100 #ifdeà
__USE_GNU


102 
	smmsghdr


104 
msghdr
 
	mmsg_hdr
;

105 
	mmsg_Ën
;

114 
	$sock‘
 (
__domaš
, 
__ty³
, 
__´ÙocŞ
è
__THROW
;

120 
	$sock‘·œ
 (
__domaš
, 
__ty³
, 
__´ÙocŞ
,

121 
__fds
[2]è
__THROW
;

124 
	$bšd
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockËn_t
 
__Ën
)

125 
__THROW
;

128 
	$g‘sockÇme
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

129 
sockËn_t
 *
__»¡riù
 
__Ën
è
__THROW
;

138 
	`cÚÃù
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockËn_t
 
__Ën
);

142 
	$g‘³”Çme
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

143 
sockËn_t
 *
__»¡riù
 
__Ën
è
__THROW
;

150 
ssize_t
 
	`£nd
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
, 
__æags
);

157 
ssize_t
 
	`»cv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__æags
);

164 
ssize_t
 
	`£ndto
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

165 
__æags
, 
__CONST_SOCKADDR_ARG
 
__addr
,

166 
sockËn_t
 
__addr_Ën
);

175 
ssize_t
 
	`»cväom
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

176 
__æags
, 
__SOCKADDR_ARG
 
__addr
,

177 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

185 
ssize_t
 
	`£ndmsg
 (
__fd
, cÚ¡ 
msghdr
 *
__mes§ge
,

186 
__æags
);

188 #ifdeà
__USE_GNU


194 
	`£ndmmsg
 (
__fd
, 
mmsghdr
 *
__vmes§ges
,

195 
__vËn
, 
__æags
);

203 
ssize_t
 
	`»cvmsg
 (
__fd
, 
msghdr
 *
__mes§ge
, 
__æags
);

205 #ifdeà
__USE_GNU


211 
	`»cvmmsg
 (
__fd
, 
mmsghdr
 *
__vmes§ges
,

212 
__vËn
, 
__æags
,

213 cÚ¡ 
time¥ec
 *
__tmo
);

220 
	$g‘sockİt
 (
__fd
, 
__Ëv–
, 
__İŠame
,

221 *
__»¡riù
 
__İtv®
,

222 
sockËn_t
 *
__»¡riù
 
__İ’
è
__THROW
;

227 
	$£tsockİt
 (
__fd
, 
__Ëv–
, 
__İŠame
,

228 cÚ¡ *
__İtv®
, 
sockËn_t
 
__İ’
è
__THROW
;

234 
	$li¡’
 (
__fd
, 
__n
è
__THROW
;

244 
	`acû±
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

245 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

247 #ifdeà
__USE_GNU


252 
	`acû±4
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

253 
sockËn_t
 *
__»¡riù
 
__addr_Ën
, 
__æags
);

262 
	$shutdown
 (
__fd
, 
__how
è
__THROW
;

265 #ifdeà
__USE_XOPEN2K


267 
	$sock©m¬k
 (
__fd
è
__THROW
;

271 #ifdeà
__USE_MISC


275 
	$isfdty³
 (
__fd
, 
__fdty³
è
__THROW
;

280 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


281 
	~<b™s/sock‘2.h
>

284 
__END_DECLS


	@/usr/include/sys/sysmacros.h

20 #iâdeà
_SYS_SYSMACROS_H


21 
	#_SYS_SYSMACROS_H
 1

	)

23 
	~<ã©u»s.h
>

28 #ifdeà
__GLIBC_HAVE_LONG_LONG


29 
__BEGIN_DECLS


31 
__ex‹nsiÚ__


32 
	$gnu_dev_majÜ
 (
__dev
)

33 
__THROW
 
__©Œibu‹_cÚ¡__
;

34 
__ex‹nsiÚ__


35 
	$gnu_dev_mšÜ
 (
__dev
)

36 
__THROW
 
__©Œibu‹_cÚ¡__
;

37 
__ex‹nsiÚ__


38 
	$gnu_dev_makedev
 (
__majÜ
,

39 
__mšÜ
)

40 
__THROW
 
__©Œibu‹_cÚ¡__
;

42 #ià
defšed
 
__GNUC__
 && __GNUC__ >ğ2 && defšed 
__USE_EXTERN_INLINES


43 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

44 
	`__NTH
 (
	$gnu_dev_majÜ
 (
__dev
))

46  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

47 
	}
}

49 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

50 
__NTH
 (
	$gnu_dev_mšÜ
 (
__dev
))

52  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

53 
	}
}

55 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

56 
__NTH
 (
	$gnu_dev_makedev
 (
__majÜ
, 
__mšÜ
))

58  ((
__mšÜ
 & 0xffè| ((
__majÜ
 & 0xfff) << 8)

59 | (((è(
__mšÜ
 & ~0xff)) << 12)

60 | (((è(
__majÜ
 & ~0xfff)) << 32));

61 
	}
}

63 
	g__END_DECLS


66 
	#majÜ
(
dev
è
	`gnu_dev_majÜ
 (dev)

	)

67 
	#mšÜ
(
dev
è
	`gnu_dev_mšÜ
 (dev)

	)

68 
	#makedev
(
maj
, 
mš
è
	`gnu_dev_makedev
 (maj, mš)

	)

	@/usr/include/bits/byteswap-16.h

19 #iâdeà
_BITS_BYTESWAP_H


23 #ifdeà
__GNUC__


24 #ià
__GNUC__
 >= 2

25 
	#__bsw­_16
(
x
) \

26 (
__ex‹nsiÚ__
 \

27 ({ 
__v
, 
__x
 = (è(
x
); \

28 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

29 
__v
 = 
	`__bsw­_cÚ¡ªt_16
 (
__x
); \

31 
	`__asm__
 ("rorw $8, %w0" \

32 : "ô" (
__v
) \

33 : "0" (
__x
) \

35 
__v
; }))

	)

38 
	#__bsw­_16
(
x
) \

39 (
__ex‹nsiÚ__
 \

40 ({ 
__x
 = (è(
x
); \

41 
	`__bsw­_cÚ¡ªt_16
 (
__x
); }))

	)

44 
__šlše
 

45 
	$__bsw­_16
 (
__bsx
)

47  
	`__bsw­_cÚ¡ªt_16
 (
__bsx
);

48 
	}
}

	@/usr/include/bits/local_lim.h

24 #iâdeà
NR_OPEN


25 
	#__undef_NR_OPEN


	)

27 #iâdeà
LINK_MAX


28 
	#__undef_LINK_MAX


	)

30 #iâdeà
OPEN_MAX


31 
	#__undef_OPEN_MAX


	)

33 #iâdeà
ARG_MAX


34 
	#__undef_ARG_MAX


	)

38 
	~<lšux/lim™s.h
>

41 #ifdeà
__undef_NR_OPEN


42 #undeà
NR_OPEN


43 #undeà
__undef_NR_OPEN


46 #ifdeà
__undef_LINK_MAX


47 #undeà
LINK_MAX


48 #undeà
__undef_LINK_MAX


51 #ifdeà
__undef_OPEN_MAX


52 #undeà
OPEN_MAX


53 #undeà
__undef_OPEN_MAX


56 #ifdeà
__undef_ARG_MAX


57 #undeà
ARG_MAX


58 #undeà
__undef_ARG_MAX


62 
	#_POSIX_THREAD_KEYS_MAX
 128

	)

64 
	#PTHREAD_KEYS_MAX
 1024

	)

67 
	#_POSIX_THREAD_DESTRUCTOR_ITERATIONS
 4

	)

69 
	#PTHREAD_DESTRUCTOR_ITERATIONS
 
_POSIX_THREAD_DESTRUCTOR_ITERATIONS


	)

72 
	#_POSIX_THREAD_THREADS_MAX
 64

	)

74 #undeà
PTHREAD_THREADS_MAX


78 
	#AIO_PRIO_DELTA_MAX
 20

	)

81 
	#PTHREAD_STACK_MIN
 16384

	)

84 
	#DELAYTIMER_MAX
 2147483647

	)

87 
	#TTY_NAME_MAX
 32

	)

90 
	#LOGIN_NAME_MAX
 256

	)

93 
	#HOST_NAME_MAX
 64

	)

96 
	#MQ_PRIO_MAX
 32768

	)

99 
	#SEM_VALUE_MAX
 (2147483647)

	)

	@/usr/include/bits/select.h

18 #iâdeà
_SYS_SELECT_H


22 
	~<b™s/wÜdsize.h
>

25 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

27 #ià
__WORDSIZE
 == 64

28 
	#__FD_ZERO_STOS
 "¡osq"

	)

30 
	#__FD_ZERO_STOS
 "¡o¦"

	)

33 
	#__FD_ZERO
(
fd¥
) \

35 
__d0
, 
__d1
; \

36 
__asm__
 
	`__vŞ©e__
 ("şd;„•; " 
__FD_ZERO_STOS
 \

37 : "=c" (
__d0
), "=D" (
__d1
) \

38 : "a" (0), "0" ( (
fd_£t
) \

39 /  (
__fd_mask
)), \

40 "1" (&
	`__FDS_BITS
 (
fd¥
)[0]) \

42 } 0)

	)

48 
	#__FD_ZERO
(
£t
) \

50 
__i
; \

51 
fd_£t
 *
__¬r
 = (
£t
); \

52 
__i
 = 0; __˜<  (
fd_£t
è/  (
__fd_mask
); ++__i) \

53 
	`__FDS_BITS
 (
__¬r
)[
__i
] = 0; \

54 } 0)

	)

58 
	#__FD_SET
(
d
, 
£t
) \

59 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] |ğ
	`__FD_MASK
 (d)))

	)

60 
	#__FD_CLR
(
d
, 
£t
) \

61 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] &ğ~
	`__FD_MASK
 (d)))

	)

62 
	#__FD_ISSET
(
d
, 
£t
) \

63 ((
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] & 
	`__FD_MASK
 (d)è!ğ0)

	)

	@/usr/include/bits/select2.h

19 #iâdeà
_SYS_SELECT_H


24 
__fd–t_chk
 (
__d
);

25 
	$__fd–t_w¬n
 (
__d
)

26 
	`__w¬Ç‰r
 ("bit outside of fd_set selected");

27 #undeà
__FD_ELT


28 
	#__FD_ELT
(
d
) \

29 
__ex‹nsiÚ__
 \

30 ({ 
__d
 = (
d
); \

31 (
	`__butš_cÚ¡ªt_p
 (
__d
) \

32 ? (0 <ğ
__d
 && __d < 
__FD_SETSIZE
 \

33 ? (
__d
 / 
__NFDBITS
) \

34 : 
	`__fd–t_w¬n
 (
__d
)) \

35 : 
	`__fd–t_chk
 (
__d
)); 
	}
})

	)

	@/usr/include/bits/socket.h

20 #iâdeà
__BITS_SOCKET_H


21 
	#__BITS_SOCKET_H


	)

23 #iâdeà
_SYS_SOCKET_H


27 
	#__Ãed_size_t


	)

28 
	~<¡ddef.h
>

30 
	~<sys/ty³s.h
>

33 #iâdeà
__sockËn_t_defšed


34 
__sockËn_t
 
	tsockËn_t
;

35 
	#__sockËn_t_defšed


	)

39 
	~<b™s/sock‘_ty³.h
>

42 
	#PF_UNSPEC
 0

	)

43 
	#PF_LOCAL
 1

	)

44 
	#PF_UNIX
 
PF_LOCAL


	)

45 
	#PF_FILE
 
PF_LOCAL


	)

46 
	#PF_INET
 2

	)

47 
	#PF_AX25
 3

	)

48 
	#PF_IPX
 4

	)

49 
	#PF_APPLETALK
 5

	)

50 
	#PF_NETROM
 6

	)

51 
	#PF_BRIDGE
 7

	)

52 
	#PF_ATMPVC
 8

	)

53 
	#PF_X25
 9

	)

54 
	#PF_INET6
 10

	)

55 
	#PF_ROSE
 11

	)

56 
	#PF_DECÃt
 12

	)

57 
	#PF_NETBEUI
 13

	)

58 
	#PF_SECURITY
 14

	)

59 
	#PF_KEY
 15

	)

60 
	#PF_NETLINK
 16

	)

61 
	#PF_ROUTE
 
PF_NETLINK


	)

62 
	#PF_PACKET
 17

	)

63 
	#PF_ASH
 18

	)

64 
	#PF_ECONET
 19

	)

65 
	#PF_ATMSVC
 20

	)

66 
	#PF_RDS
 21

	)

67 
	#PF_SNA
 22

	)

68 
	#PF_IRDA
 23

	)

69 
	#PF_PPPOX
 24

	)

70 
	#PF_WANPIPE
 25

	)

71 
	#PF_LLC
 26

	)

72 
	#PF_CAN
 29

	)

73 
	#PF_TIPC
 30

	)

74 
	#PF_BLUETOOTH
 31

	)

75 
	#PF_IUCV
 32

	)

76 
	#PF_RXRPC
 33

	)

77 
	#PF_ISDN
 34

	)

78 
	#PF_PHONET
 35

	)

79 
	#PF_IEEE802154
 36

	)

80 
	#PF_CAIF
 37

	)

81 
	#PF_ALG
 38

	)

82 
	#PF_NFC
 39

	)

83 
	#PF_VSOCK
 40

	)

84 
	#PF_MAX
 41

	)

87 
	#AF_UNSPEC
 
PF_UNSPEC


	)

88 
	#AF_LOCAL
 
PF_LOCAL


	)

89 
	#AF_UNIX
 
PF_UNIX


	)

90 
	#AF_FILE
 
PF_FILE


	)

91 
	#AF_INET
 
PF_INET


	)

92 
	#AF_AX25
 
PF_AX25


	)

93 
	#AF_IPX
 
PF_IPX


	)

94 
	#AF_APPLETALK
 
PF_APPLETALK


	)

95 
	#AF_NETROM
 
PF_NETROM


	)

96 
	#AF_BRIDGE
 
PF_BRIDGE


	)

97 
	#AF_ATMPVC
 
PF_ATMPVC


	)

98 
	#AF_X25
 
PF_X25


	)

99 
	#AF_INET6
 
PF_INET6


	)

100 
	#AF_ROSE
 
PF_ROSE


	)

101 
	#AF_DECÃt
 
PF_DECÃt


	)

102 
	#AF_NETBEUI
 
PF_NETBEUI


	)

103 
	#AF_SECURITY
 
PF_SECURITY


	)

104 
	#AF_KEY
 
PF_KEY


	)

105 
	#AF_NETLINK
 
PF_NETLINK


	)

106 
	#AF_ROUTE
 
PF_ROUTE


	)

107 
	#AF_PACKET
 
PF_PACKET


	)

108 
	#AF_ASH
 
PF_ASH


	)

109 
	#AF_ECONET
 
PF_ECONET


	)

110 
	#AF_ATMSVC
 
PF_ATMSVC


	)

111 
	#AF_RDS
 
PF_RDS


	)

112 
	#AF_SNA
 
PF_SNA


	)

113 
	#AF_IRDA
 
PF_IRDA


	)

114 
	#AF_PPPOX
 
PF_PPPOX


	)

115 
	#AF_WANPIPE
 
PF_WANPIPE


	)

116 
	#AF_LLC
 
PF_LLC


	)

117 
	#AF_CAN
 
PF_CAN


	)

118 
	#AF_TIPC
 
PF_TIPC


	)

119 
	#AF_BLUETOOTH
 
PF_BLUETOOTH


	)

120 
	#AF_IUCV
 
PF_IUCV


	)

121 
	#AF_RXRPC
 
PF_RXRPC


	)

122 
	#AF_ISDN
 
PF_ISDN


	)

123 
	#AF_PHONET
 
PF_PHONET


	)

124 
	#AF_IEEE802154
 
PF_IEEE802154


	)

125 
	#AF_CAIF
 
PF_CAIF


	)

126 
	#AF_ALG
 
PF_ALG


	)

127 
	#AF_NFC
 
PF_NFC


	)

128 
	#AF_VSOCK
 
PF_VSOCK


	)

129 
	#AF_MAX
 
PF_MAX


	)

135 
	#SOL_RAW
 255

	)

136 
	#SOL_DECNET
 261

	)

137 
	#SOL_X25
 262

	)

138 
	#SOL_PACKET
 263

	)

139 
	#SOL_ATM
 264

	)

140 
	#SOL_AAL
 265

	)

141 
	#SOL_IRDA
 266

	)

144 
	#SOMAXCONN
 128

	)

147 
	~<b™s/sockaddr.h
>

150 
	ssockaddr


152 
__SOCKADDR_COMMON
 (
§_
);

153 
	m§_d©a
[14];

159 
	#__ss_®igÁy³
 

	)

160 
	#_SS_PADSIZE
 \

161 (
_SS_SIZE
 - 
__SOCKADDR_COMMON_SIZE
 -  (
__ss_®igÁy³
))

	)

163 
	ssockaddr_¡Üage


165 
__SOCKADDR_COMMON
 (
ss_
);

166 
	m__ss_·ddšg
[
_SS_PADSIZE
];

167 
__ss_®igÁy³
 
	m__ss_®ign
;

174 
	mMSG_OOB
 = 0x01,

175 
	#MSG_OOB
 
MSG_OOB


	)

176 
	mMSG_PEEK
 = 0x02,

177 
	#MSG_PEEK
 
MSG_PEEK


	)

178 
	mMSG_DONTROUTE
 = 0x04,

179 
	#MSG_DONTROUTE
 
MSG_DONTROUTE


	)

180 #ifdeà
__USE_GNU


182 
	mMSG_TRYHARD
 = 
MSG_DONTROUTE
,

183 
	#MSG_TRYHARD
 
MSG_DONTROUTE


	)

185 
	mMSG_CTRUNC
 = 0x08,

186 
	#MSG_CTRUNC
 
MSG_CTRUNC


	)

187 
	mMSG_PROXY
 = 0x10,

188 
	#MSG_PROXY
 
MSG_PROXY


	)

189 
	mMSG_TRUNC
 = 0x20,

190 
	#MSG_TRUNC
 
MSG_TRUNC


	)

191 
	mMSG_DONTWAIT
 = 0x40,

192 
	#MSG_DONTWAIT
 
MSG_DONTWAIT


	)

193 
	mMSG_EOR
 = 0x80,

194 
	#MSG_EOR
 
MSG_EOR


	)

195 
	mMSG_WAITALL
 = 0x100,

196 
	#MSG_WAITALL
 
MSG_WAITALL


	)

197 
	mMSG_FIN
 = 0x200,

198 
	#MSG_FIN
 
MSG_FIN


	)

199 
	mMSG_SYN
 = 0x400,

200 
	#MSG_SYN
 
MSG_SYN


	)

201 
	mMSG_CONFIRM
 = 0x800,

202 
	#MSG_CONFIRM
 
MSG_CONFIRM


	)

203 
	mMSG_RST
 = 0x1000,

204 
	#MSG_RST
 
MSG_RST


	)

205 
	mMSG_ERRQUEUE
 = 0x2000,

206 
	#MSG_ERRQUEUE
 
MSG_ERRQUEUE


	)

207 
	mMSG_NOSIGNAL
 = 0x4000,

208 
	#MSG_NOSIGNAL
 
MSG_NOSIGNAL


	)

209 
	mMSG_MORE
 = 0x8000,

210 
	#MSG_MORE
 
MSG_MORE


	)

211 
	mMSG_WAITFORONE
 = 0x10000,

212 
	#MSG_WAITFORONE
 
MSG_WAITFORONE


	)

213 
	mMSG_FASTOPEN
 = 0x20000000,

214 
	#MSG_FASTOPEN
 
MSG_FASTOPEN


	)

216 
	mMSG_CMSG_CLOEXEC
 = 0x40000000

219 
	#MSG_CMSG_CLOEXEC
 
MSG_CMSG_CLOEXEC


	)

225 
	smsghdr


227 *
	mmsg_Çme
;

228 
sockËn_t
 
	mmsg_Çm–’
;

230 
iovec
 *
	mmsg_iov
;

231 
size_t
 
	mmsg_iovËn
;

233 *
	mmsg_cÚŒŞ
;

234 
size_t
 
	mmsg_cÚŒŞËn
;

239 
	mmsg_æags
;

243 
	scmsghdr


245 
size_t
 
	mcmsg_Ën
;

250 
	mcmsg_Ëv–
;

251 
	mcmsg_ty³
;

252 #ià(!
defšed
 
__STRICT_ANSI__
 && 
__GNUC__
 >ğ2è|| 
__STDC_VERSION__
 >= 199901L

253 
__ex‹nsiÚ__
 
__cmsg_d©a
 
	m__æex¬r
;

258 #ià(!
defšed
 
__STRICT_ANSI__
 && 
__GNUC__
 >ğ2è|| 
__STDC_VERSION__
 >= 199901L

259 
	#CMSG_DATA
(
cmsg
è((cmsg)->
__cmsg_d©a
)

	)

261 
	#CMSG_DATA
(
cmsg
è((*è((
cmsghdr
 *è(cmsgè+ 1))

	)

263 
	#CMSG_NXTHDR
(
mhdr
, 
cmsg
è
	`__cmsg_nxthdr
 (mhdr, cmsg)

	)

264 
	#CMSG_FIRSTHDR
(
mhdr
) \

265 ((
size_t
è(
mhdr
)->
msg_cÚŒŞËn
 >ğ (
cmsghdr
) \

266 ? (
cmsghdr
 *è(
mhdr
)->
msg_cÚŒŞ
 : (cmsghd¸*è0)

	)

267 
	#CMSG_ALIGN
(
Ën
è((Ö’è+  (
size_t
) - 1) \

268 & (
size_t
è~( (size_tè- 1))

	)

269 
	#CMSG_SPACE
(
Ën
è(
	`CMSG_ALIGN
 (len) \

270 + 
	`CMSG_ALIGN
 ( (
cmsghdr
)))

	)

271 
	#CMSG_LEN
(
Ën
è(
	`CMSG_ALIGN
 ( (
cmsghdr
)è+ (Ën))

	)

273 
cmsghdr
 *
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
,

274 
cmsghdr
 *
__cmsg
è
__THROW
;

275 #ifdeà
__USE_EXTERN_INLINES


276 #iâdeà
_EXTERN_INLINE


277 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

279 
_EXTERN_INLINE
 
cmsghdr
 *

280 
	`__NTH
 (
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
, 
cmsghdr
 *
__cmsg
))

282 ià((
size_t
è
__cmsg
->
cmsg_Ën
 <  (
cmsghdr
))

284  (
cmsghdr
 *) 0;

286 
__cmsg
 = (
cmsghdr
 *) ((*) __cmsg

287 + 
	`CMSG_ALIGN
 (
__cmsg
->
cmsg_Ën
));

288 ià((*è(
__cmsg
 + 1è> ((*è
__mhdr
->
msg_cÚŒŞ


289 + 
__mhdr
->
msg_cÚŒŞËn
)

290 || ((*è
__cmsg
 + 
	`CMSG_ALIGN
 (__cmsg->
cmsg_Ën
)

291 > ((*è
__mhdr
->
msg_cÚŒŞ
 + __mhdr->
msg_cÚŒŞËn
)))

293  (
cmsghdr
 *) 0;

294  
__cmsg
;

295 
	}
}

302 
	mSCM_RIGHTS
 = 0x01

303 
	#SCM_RIGHTS
 
SCM_RIGHTS


	)

304 #ifdeà
__USE_GNU


305 , 
	mSCM_CREDENTIALS
 = 0x02

306 
	#SCM_CREDENTIALS
 
SCM_CREDENTIALS


	)

310 #ifdeà
__USE_GNU


312 
	suüed


314 
pid_t
 
	mpid
;

315 
uid_t
 
	muid
;

316 
gid_t
 
	mgid
;

321 #ià!
defšed
 
__USE_MISC
 && !defšed 
__USE_GNU


322 #iâdeà
FIOGETOWN


323 
	#__SYS_SOCKET_H_undef_FIOGETOWN


	)

325 #iâdeà
FIOSETOWN


326 
	#__SYS_SOCKET_H_undef_FIOSETOWN


	)

328 #iâdeà
SIOCATMARK


329 
	#__SYS_SOCKET_H_undef_SIOCATMARK


	)

331 #iâdeà
SIOCGPGRP


332 
	#__SYS_SOCKET_H_undef_SIOCGPGRP


	)

334 #iâdeà
SIOCGSTAMP


335 
	#__SYS_SOCKET_H_undef_SIOCGSTAMP


	)

337 #iâdeà
SIOCGSTAMPNS


338 
	#__SYS_SOCKET_H_undef_SIOCGSTAMPNS


	)

340 #iâdeà
SIOCSPGRP


341 
	#__SYS_SOCKET_H_undef_SIOCSPGRP


	)

346 
	~<asm/sock‘.h
>

348 #ià!
defšed
 
__USE_MISC
 && !defšed 
__USE_GNU


349 #ifdeà
__SYS_SOCKET_H_undef_FIOGETOWN


350 #undeà
__SYS_SOCKET_H_undef_FIOGETOWN


351 #undeà
FIOGETOWN


353 #ifdeà
__SYS_SOCKET_H_undef_FIOSETOWN


354 #undeà
__SYS_SOCKET_H_undef_FIOSETOWN


355 #undeà
FIOSETOWN


357 #ifdeà
__SYS_SOCKET_H_undef_SIOCATMARK


358 #undeà
__SYS_SOCKET_H_undef_SIOCATMARK


359 #undeà
SIOCATMARK


361 #ifdeà
__SYS_SOCKET_H_undef_SIOCGPGRP


362 #undeà
__SYS_SOCKET_H_undef_SIOCGPGRP


363 #undeà
SIOCGPGRP


365 #ifdeà
__SYS_SOCKET_H_undef_SIOCGSTAMP


366 #undeà
__SYS_SOCKET_H_undef_SIOCGSTAMP


367 #undeà
SIOCGSTAMP


369 #ifdeà
__SYS_SOCKET_H_undef_SIOCGSTAMPNS


370 #undeà
__SYS_SOCKET_H_undef_SIOCGSTAMPNS


371 #undeà
SIOCGSTAMPNS


373 #ifdeà
__SYS_SOCKET_H_undef_SIOCSPGRP


374 #undeà
__SYS_SOCKET_H_undef_SIOCSPGRP


375 #undeà
SIOCSPGRP


380 
	slšg”


382 
	ml_Úoff
;

383 
	ml_lšg”
;

	@/usr/include/bits/socket2.h

19 #iâdeà
_SYS_SOCKET_H


23 
ssize_t
 
__»cv_chk
 (
__fd
, *
__buf
, 
size_t
 
__n
, size_ˆ
__buæ’
,

24 
__æags
);

25 
ssize_t
 
__REDIRECT
 (
__»cv_®Ÿs
, (
__fd
, *
__buf
, 
size_t
 
__n
,

26 
__æags
), 
»cv
);

27 
ssize_t
 
__REDIRECT
 (
__»cv_chk_w¬n
,

28 (
__fd
, *
__buf
, 
size_t
 
__n
, size_ˆ
__buæ’
,

29 
__æags
), 
__»cv_chk
)

30 
__w¬Ç‰r
 ("recv called with bigger†engthhan size of destination "

33 
__fÜtify_funùiÚ
 
ssize_t


34 
	$»cv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__æags
)

36 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

38 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

39  
	`__»cv_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
);

41 ià(
__n
 > 
	`__bos0
 (
__buf
))

42  
	`__»cv_chk_w¬n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
);

44  
	`__»cv_®Ÿs
 (
__fd
, 
__buf
, 
__n
, 
__æags
);

45 
	}
}

47 
ssize_t
 
__»cväom_chk
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

48 
size_t
 
__buæ’
, 
__æags
,

49 
__SOCKADDR_ARG
 
__addr
,

50 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

51 
ssize_t
 
__REDIRECT
 (
__»cväom_®Ÿs
,

52 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

53 
__æags
, 
__SOCKADDR_ARG
 
__addr
,

54 
sockËn_t
 *
__»¡riù
 
__addr_Ën
), 
»cväom
);

55 
ssize_t
 
__REDIRECT
 (
__»cväom_chk_w¬n
,

56 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

57 
size_t
 
__buæ’
, 
__æags
,

58 
__SOCKADDR_ARG
 
__addr
,

59 
sockËn_t
 *
__»¡riù
 
__addr_Ën
), 
__»cväom_chk
)

60 
__w¬Ç‰r
 ("recvfrom called with bigger†engthhan size of "

63 
__fÜtify_funùiÚ
 
ssize_t


64 
	$»cväom
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
, 
__æags
,

65 
__SOCKADDR_ARG
 
__addr
, 
sockËn_t
 *
__»¡riù
 
__addr_Ën
)

67 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

69 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

70  
	`__»cväom_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
,

71 
__addr
, 
__addr_Ën
);

72 ià(
__n
 > 
	`__bos0
 (
__buf
))

73  
	`__»cväom_chk_w¬n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
,

74 
__addr
, 
__addr_Ën
);

76  
	`__»cväom_®Ÿs
 (
__fd
, 
__buf
, 
__n
, 
__æags
, 
__addr
, 
__addr_Ën
);

77 
	}
}

	@/usr/include/bits/stdio_lim.h

18 #ià!
defšed
 
_STDIO_H
 && !defšed 
__Ãed_FOPEN_MAX
 && !defšed 
__Ãed_IOV_MAX


22 #ifdeà
_STDIO_H


23 
	#L_tm²am
 20

	)

24 
	#TMP_MAX
 238328

	)

25 
	#FILENAME_MAX
 4096

	)

27 #ifdeà
__USE_POSIX


28 
	#L_ù”mid
 9

	)

29 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


30 
	#L_cu£rid
 9

	)

35 #ià
defšed
 
__Ãed_FOPEN_MAX
 || defšed 
_STDIO_H


36 #undeà
FOPEN_MAX


37 
	#FOPEN_MAX
 16

	)

40 #ià
defšed
 
__Ãed_IOV_MAX
 && !defšed 
IOV_MAX


41 
	#IOV_MAX
 1024

	)

	@/usr/include/bits/wchar.h

19 #iâdeà
_BITS_WCHAR_H


20 
	#_BITS_WCHAR_H
 1

	)

22 
	~<b™s/wÜdsize.h
>

24 #ià
__WORDSIZE
 == 64

25 
	#__WCHAR_MIN
 (-2147483647 - 1)

	)

26 
	#__WCHAR_MAX
 (2147483647)

	)

28 
	#__WCHAR_MIN
 (-2147483647È- 1l)

	)

29 
	#__WCHAR_MAX
 (2147483647l)

	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ç‰ach


	)

13 
	#__¡ub_fchæags


	)

14 
	#__¡ub_fd‘ach


	)

15 
	#__¡ub_g‘msg


	)

16 
	#__¡ub_g‰y


	)

17 
	#__¡ub_lchmod


	)

18 
	#__¡ub_putmsg


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/sys/uio.h

19 #iâdeà
_SYS_UIO_H


20 
	#_SYS_UIO_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	~<sys/ty³s.h
>

26 
	g__BEGIN_DECLS


29 
	~<b™s/uio.h
>

40 
ssize_t
 
	$»adv
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
)

41 
__wur
;

51 
ssize_t
 
	$wr™ev
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
)

52 
__wur
;

55 #ifdeà
__USE_BSD


56 #iâdeà
__USE_FILE_OFFSET64


66 
ssize_t
 
	$´—dv
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

67 
__off_t
 
__off£t
è
__wur
;

78 
ssize_t
 
	$pwr™ev
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

79 
__off_t
 
__off£t
è
__wur
;

81 #ifdeà
__REDIRECT


82 
ssize_t
 
	`__REDIRECT
 (
´—dv
, (
__fd
, cÚ¡ 
iovec
 *
__iovec
,

83 
__couÁ
, 
__off64_t
 
__off£t
),

84 
´—dv64
è
__wur
;

85 
ssize_t
 
	`__REDIRECT
 (
pwr™ev
, (
__fd
, cÚ¡ 
iovec
 *
__iovec
,

86 
__couÁ
, 
__off64_t
 
__off£t
),

87 
pwr™ev64
è
__wur
;

89 
	#´—dv
 
´—dv64


	)

90 
	#pwr™ev
 
pwr™ev64


	)

94 #ifdeà
__USE_LARGEFILE64


104 
ssize_t
 
	$´—dv64
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

105 
__off64_t
 
__off£t
è
__wur
;

116 
ssize_t
 
	$pwr™ev64
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

117 
__off64_t
 
__off£t
è
__wur
;

121 
__END_DECLS


	@/usr/include/asm/socket.h

1 
	~<asm-g’”ic/sock‘.h
>

	@/usr/include/bits/sockaddr.h

23 #iâdeà
_BITS_SOCKADDR_H


24 
	#_BITS_SOCKADDR_H
 1

	)

28 
	t§_çmy_t
;

34 
	#__SOCKADDR_COMMON
(
§_´efix
) \

35 
§_çmy_t
 
§_´efix
##
çmy


	)

37 
	#__SOCKADDR_COMMON_SIZE
 ( ())

	)

40 
	#_SS_SIZE
 128

	)

	@/usr/include/bits/socket_type.h

19 #iâdeà
_SYS_SOCKET_H


24 
	e__sock‘_ty³


26 
	mSOCK_STREAM
 = 1,

28 
	#SOCK_STREAM
 
SOCK_STREAM


	)

29 
	mSOCK_DGRAM
 = 2,

31 
	#SOCK_DGRAM
 
SOCK_DGRAM


	)

32 
	mSOCK_RAW
 = 3,

33 
	#SOCK_RAW
 
SOCK_RAW


	)

34 
	mSOCK_RDM
 = 4,

35 
	#SOCK_RDM
 
SOCK_RDM


	)

36 
	mSOCK_SEQPACKET
 = 5,

38 
	#SOCK_SEQPACKET
 
SOCK_SEQPACKET


	)

39 
	mSOCK_DCCP
 = 6,

40 
	#SOCK_DCCP
 
SOCK_DCCP


	)

41 
	mSOCK_PACKET
 = 10,

44 
	#SOCK_PACKET
 
SOCK_PACKET


	)

49 
	mSOCK_CLOEXEC
 = 02000000,

51 
	#SOCK_CLOEXEC
 
SOCK_CLOEXEC


	)

52 
	mSOCK_NONBLOCK
 = 00004000

54 
	#SOCK_NONBLOCK
 
SOCK_NONBLOCK


	)

	@/usr/include/bits/uio.h

18 #ià!
defšed
 
_SYS_UIO_H
 && !defšed 
_FCNTL_H


22 #iâdeà
_BITS_UIO_H


23 
	#_BITS_UIO_H
 1

	)

25 
	~<sys/ty³s.h
>

39 
	#UIO_MAXIOV
 1024

	)

43 
	siovec


45 *
	miov_ba£
;

46 
size_t
 
	miov_Ën
;

52 #ifdeà
__USE_GNU


53 #ià
defšed
 
_SYS_UIO_H
 && !defšed 
_BITS_UIO_H_FOR_SYS_UIO_H


54 
	#_BITS_UIO_H_FOR_SYS_UIO_H
 1

	)

56 
__BEGIN_DECLS


59 
ssize_t
 
	$´oûss_vm_»adv
 (
pid_t
 
__pid
, cÚ¡ 
iovec
 *
__lvec
,

60 
__liovút
,

61 cÚ¡ 
iovec
 *
__rvec
,

62 
__riovút
,

63 
__æags
)

64 
__THROW
;

67 
ssize_t
 
	$´oûss_vm_wr™ev
 (
pid_t
 
__pid
, cÚ¡ 
iovec
 *
__lvec
,

68 
__liovút
,

69 cÚ¡ 
iovec
 *
__rvec
,

70 
__riovút
,

71 
__æags
)

72 
__THROW
;

74 
__END_DECLS


	@/usr/include/linux/limits.h

1 #iâdeà
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/asm-generic/socket.h

1 #iâdeà
__ASM_GENERIC_SOCKET_H


2 
	#__ASM_GENERIC_SOCKET_H


	)

4 
	~<asm/sockios.h
>

7 
	#SOL_SOCKET
 1

	)

9 
	#SO_DEBUG
 1

	)

10 
	#SO_REUSEADDR
 2

	)

11 
	#SO_TYPE
 3

	)

12 
	#SO_ERROR
 4

	)

13 
	#SO_DONTROUTE
 5

	)

14 
	#SO_BROADCAST
 6

	)

15 
	#SO_SNDBUF
 7

	)

16 
	#SO_RCVBUF
 8

	)

17 
	#SO_SNDBUFFORCE
 32

	)

18 
	#SO_RCVBUFFORCE
 33

	)

19 
	#SO_KEEPALIVE
 9

	)

20 
	#SO_OOBINLINE
 10

	)

21 
	#SO_NO_CHECK
 11

	)

22 
	#SO_PRIORITY
 12

	)

23 
	#SO_LINGER
 13

	)

24 
	#SO_BSDCOMPAT
 14

	)

25 
	#SO_REUSEPORT
 15

	)

26 #iâdeà
SO_PASSCRED


27 
	#SO_PASSCRED
 16

	)

28 
	#SO_PEERCRED
 17

	)

29 
	#SO_RCVLOWAT
 18

	)

30 
	#SO_SNDLOWAT
 19

	)

31 
	#SO_RCVTIMEO
 20

	)

32 
	#SO_SNDTIMEO
 21

	)

36 
	#SO_SECURITY_AUTHENTICATION
 22

	)

37 
	#SO_SECURITY_ENCRYPTION_TRANSPORT
 23

	)

38 
	#SO_SECURITY_ENCRYPTION_NETWORK
 24

	)

40 
	#SO_BINDTODEVICE
 25

	)

43 
	#SO_ATTACH_FILTER
 26

	)

44 
	#SO_DETACH_FILTER
 27

	)

45 
	#SO_GET_FILTER
 
SO_ATTACH_FILTER


	)

47 
	#SO_PEERNAME
 28

	)

48 
	#SO_TIMESTAMP
 29

	)

49 
	#SCM_TIMESTAMP
 
SO_TIMESTAMP


	)

51 
	#SO_ACCEPTCONN
 30

	)

53 
	#SO_PEERSEC
 31

	)

54 
	#SO_PASSSEC
 34

	)

55 
	#SO_TIMESTAMPNS
 35

	)

56 
	#SCM_TIMESTAMPNS
 
SO_TIMESTAMPNS


	)

58 
	#SO_MARK
 36

	)

60 
	#SO_TIMESTAMPING
 37

	)

61 
	#SCM_TIMESTAMPING
 
SO_TIMESTAMPING


	)

63 
	#SO_PROTOCOL
 38

	)

64 
	#SO_DOMAIN
 39

	)

66 
	#SO_RXQ_OVFL
 40

	)

68 
	#SO_WIFI_STATUS
 41

	)

69 
	#SCM_WIFI_STATUS
 
SO_WIFI_STATUS


	)

70 
	#SO_PEEK_OFF
 42

	)

73 
	#SO_NOFCS
 43

	)

75 
	#SO_LOCK_FILTER
 44

	)

77 
	#SO_SELECT_ERR_QUEUE
 45

	)

79 
	#SO_BUSY_POLL
 46

	)

81 
	#SO_MAX_PACING_RATE
 47

	)

83 
	#SO_BPF_EXTENSIONS
 48

	)

	@/usr/include/asm/sockios.h

1 
	~<asm-g’”ic/sockios.h
>

	@/usr/include/asm-generic/sockios.h

1 #iâdeà
__ASM_GENERIC_SOCKIOS_H


2 
	#__ASM_GENERIC_SOCKIOS_H


	)

5 
	#FIOSETOWN
 0x8901

	)

6 
	#SIOCSPGRP
 0x8902

	)

7 
	#FIOGETOWN
 0x8903

	)

8 
	#SIOCGPGRP
 0x8904

	)

9 
	#SIOCATMARK
 0x8905

	)

10 
	#SIOCGSTAMP
 0x8906

	)

11 
	#SIOCGSTAMPNS
 0x8907

	)

	@
1
.
1
/usr/include
103
2418
event_listener.cc
event_listener.h
ha_rocksdb.cc
ha_rocksdb.h
ha_rocksdb_proto.h
logger.h
properties_collector.cc
properties_collector.h
rdb_buff.h
rdb_cf_manager.cc
rdb_cf_manager.h
rdb_cf_options.cc
rdb_cf_options.h
rdb_compact_filter.h
rdb_comparator.h
rdb_datadic.cc
rdb_datadic.h
rdb_i_s.cc
rdb_i_s.h
rdb_index_merge.cc
rdb_index_merge.h
rdb_io_watchdog.cc
rdb_io_watchdog.h
rdb_mutex_wrapper.cc
rdb_mutex_wrapper.h
rdb_perf_context.cc
rdb_perf_context.h
rdb_psi.cc
rdb_psi.h
rdb_sst_info.cc
rdb_sst_info.h
rdb_threads.cc
rdb_threads.h
rdb_utils.cc
rdb_utils.h
/usr/include/arpa/inet.h
/usr/include/ctype.h
/usr/include/jemalloc/jemalloc.h
/usr/include/signal.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/time.h
/usr/include/alloca.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/sigaction.h
/usr/include/bits/sigcontext.h
/usr/include/bits/siginfo.h
/usr/include/bits/signum.h
/usr/include/bits/sigset.h
/usr/include/bits/sigstack.h
/usr/include/bits/sigthread.h
/usr/include/bits/stdlib-float.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/string.h
/usr/include/bits/string2.h
/usr/include/bits/string3.h
/usr/include/bits/time.h
/usr/include/bits/types.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/limits.h
/usr/include/netinet/in.h
/usr/include/strings.h
/usr/include/sys/types.h
/usr/include/sys/ucontext.h
/usr/include/xlocale.h
/usr/include/bits/byteswap.h
/usr/include/bits/endian.h
/usr/include/bits/in.h
/usr/include/bits/posix1_lim.h
/usr/include/bits/posix2_lim.h
/usr/include/bits/timex.h
/usr/include/bits/typesizes.h
/usr/include/bits/wordsize.h
/usr/include/bits/xopen_lim.h
/usr/include/gnu/stubs.h
/usr/include/stdc-predef.h
/usr/include/stdint.h
/usr/include/sys/cdefs.h
/usr/include/sys/select.h
/usr/include/sys/socket.h
/usr/include/sys/sysmacros.h
/usr/include/bits/byteswap-16.h
/usr/include/bits/local_lim.h
/usr/include/bits/select.h
/usr/include/bits/select2.h
/usr/include/bits/socket.h
/usr/include/bits/socket2.h
/usr/include/bits/stdio_lim.h
/usr/include/bits/wchar.h
/usr/include/gnu/stubs-64.h
/usr/include/sys/uio.h
/usr/include/asm/socket.h
/usr/include/bits/sockaddr.h
/usr/include/bits/socket_type.h
/usr/include/bits/uio.h
/usr/include/linux/limits.h
/usr/include/asm-generic/socket.h
/usr/include/asm/sockios.h
/usr/include/asm-generic/sockios.h
